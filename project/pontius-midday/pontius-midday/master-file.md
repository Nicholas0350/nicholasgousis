Project Structure:
├── LICENSE
├── README.md
├── SECURITY.md
├── apps
├── biome.json
├── bun.lockb
├── codefetch
│   └── codefetch.txt
├── github.png
├── midday.code-workspace
├── package.json
├── packages
├── tsconfig.json
└── turbo.json


.cursorrules
```
1 | You are an expert in TypeScript, Node.js, Next.js App Router, React, Shadcn UI, Radix UI and Tailwind.
2 |
3 | Code Style and Structure
4 |   - Write concise, technical TypeScript code with accurate examples.
5 |   - Use functional and declarative programming patterns; avoid classes.
6 |   - Prefer iteration and modularization over code duplication.
7 |   - Use descriptive variable names with auxiliary verbs (e.g., isLoading, hasError).
8 |   - Structure files: exported component, subcomponents, helpers, static content, types.
9 |
10 | Naming Conventions
11 |   - Use lowercase with dashes for directories (e.g., components/auth-wizard).
12 |   - Favor named exports for components.
13 |
14 | TypeScript Usage
15 |   - Use TypeScript for all code; prefer interfaces over types.
16 |   - Avoid enums; use maps instead.
17 |   - Use functional components with TypeScript interfaces.
18 |
19 | Syntax and Formatting
20 |   - Use the "function" keyword for pure functions.
21 |   - Avoid unnecessary curly braces in conditionals; use concise syntax for simple statements.
22 |   - Use declarative JSX.
23 |
24 | UI and Styling
25 |   - Use Shadcn UI, Radix, and Tailwind for components and styling.
26 |   - Implement responsive design with Tailwind CSS; use a mobile-first approach.
27 |
28 | Performance Optimization
29 |   - Minimize 'use client', 'useEffect', and 'setState'; favor React Server Components (RSC).
30 |   - Wrap client components in Suspense with fallback.
31 |   - Use dynamic loading for non-critical components.
32 |   - Optimize images: use WebP format, include size data, implement lazy loading.
33 |
34 | Next.js Specifics
35 |   - Use next-safe-action for all server actions:
36 |   - Implement type-safe server actions with proper validation.
37 |   - Utilize the `action` function from next-safe-action for creating actions.
38 |   - Define input schemas using Zod for robust type checking and validation.
39 |   - Handle errors gracefully and return appropriate responses.
40 |   - Use import type { ActionResponse } from '@/types/actions'
41 |   - Ensure all server actions return the ActionResponse type
42 |   - Implement consistent error handling and success responses using ActionResponse
43 |   - Example:
44 |     ```typescript
45 |     'use server'
46 |
47 |     import { createSafeActionClient } from 'next-safe-action'
48 |     import { z } from 'zod'
49 |     import type { ActionResponse } from '@/app/actions/actions'
50 |
51 |     const schema = z.object({
52 |       value: z.string()
53 |     })
54 |
55 |     export const someAction = createSafeActionClient()
56 |       .schema(schema)
57 |       .action(async (input): Promise<ActionResponse> => {
58 |         try {
59 |           // Action logic here
60 |           return { success: true, data: /* result */ }
61 |         } catch (error) {
62 |           return { success: false, error: error instanceof AppError ? error : appErrors.UNEXPECTED_ERROR, }
63 |         }
64 |       })
65 |     ```
66 |   - Use useQueryState for all query state management.
67 |   - Example:
68 |     ```typescript
69 |     'use client'
70 |
71 |     import { useQueryState } from 'nuqs'
72 |
73 |     export function Demo() {
74 |       const [name, setName] = useQueryState('name')
75 |       return (
76 |         <>
77 |           <input value={name || ''} onChange={e => setName(e.target.value)} />
78 |           <button onClick={() => setName(null)}>Clear</button>
79 |           <p>Hello, {name || 'anonymous visitor'}!</p>
80 |         </>
81 |       )
82 |     }
83 |     ```
84 |
85 | Key Conventions
86 |   - Use 'nuqs' for URL search parameter state management.
87 |   - Optimize Web Vitals (LCP, CLS, FID).
88 |   - Limit 'use client':
89 |     - Favor server components and Next.js SSR.
90 |     - Use only for Web API access in small components.
91 |     - Avoid for data fetching or state management.
92 |
93 |   Follow Next.js docs for Data Fetching, Rendering, and Routing.
94 |
```

.nvmrc
```
1 | 20.11.0
```

SECURITY.md
```
1 | # Security
2 |
3 | Contact: [security@midday.ai](mailto:security@midday.ai)
4 |
5 | Based on [https://supabase.com/.well-known/security.txt](https://supabase.com/.well-known/security.txt)
6 |
7 | At Midday, we consider the security of our systems a top priority. But no matter
8 | how much effort we put into system security, there can still be vulnerabilities
9 | present.
10 |
11 | If you discover a vulnerability, we would like to know about it so we can take
12 | steps to address it as quickly as possible. We would like to ask you to help us
13 | better protect our clients and our systems.
14 |
15 | ## Out of scope vulnerabilities
16 |
17 | - Clickjacking on pages with no sensitive actions.
18 | - Unauthenticated/logout/login CSRF.
19 | - Attacks requiring MITM or physical access to a user's device.
20 | - Any activity that could lead to the disruption of our service (DoS).
21 | - Content spoofing and text injection issues without showing an attack
22 |   vector/without being able to modify HTML/CSS.
23 | - Email spoofing
24 | - Missing DNSSEC, CAA, CSP headers
25 | - Lack of Secure or HTTP only flag on non-sensitive cookies
26 | - Deadlinks
27 |
28 | ## Please do the following
29 |
30 | - E-mail your findings to [security@midday.ai](mailto:security@midday.ai).
31 | - Do not run automated scanners on our infrastructure or dashboard. If you wish
32 |   to do this, contact us and we will set up a sandbox for you.
33 | - Do not take advantage of the vulnerability or problem you have discovered,
34 |   for example by downloading more data than necessary to demonstrate the
35 |   vulnerability or deleting or modifying other people's data,
36 | - Do not reveal the problem to others until it has been resolved,
37 | - Do not use attacks on physical security, social engineering, distributed
38 |   denial of service, spam or applications of third parties,
39 | - Do provide sufficient information to reproduce the problem, so we will be
40 |   able to resolve it as quickly as possible. Usually, the IP address or the URL
41 |   of the affected system and a description of the vulnerability will be
42 |   sufficient, but complex vulnerabilities may require further explanation.
43 |
44 | ## What we promise
45 |
46 | - We will respond to your report within 3 business days with our evaluation of
47 |   the report and an expected resolution date,
48 | - If you have followed the instructions above, we will not take any legal
49 |   action against you in regard to the report,
50 | - We will handle your report with strict confidentiality, and not pass on your
51 |   personal details to third parties without your permission,
52 | - We will keep you informed of the progress towards resolving the problem,
53 | - In the public information concerning the problem reported, we will give your
54 |   name as the discoverer of the problem (unless you desire otherwise), and
55 | - We strive to resolve all problems as quickly as possible, and we would like
56 |   to play an active role in the ultimate publication on the problem after it
57 |   is resolved.
```

biome.json
```
1 | {
2 |   "$schema": "./node_modules/@biomejs/biome/configuration_schema.json",
3 |   "organizeImports": {
4 |     "enabled": true
5 |   },
6 |   "linter": {
7 |     "ignore": [".wrangler", "node_modules"],
8 |     "enabled": true,
9 |     "rules": {
10 |       "recommended": true,
11 |       "a11y": {
12 |         "noSvgWithoutTitle": "off",
13 |         "useKeyWithClickEvents": "off"
14 |       },
15 |       "style": {
16 |         "noNonNullAssertion": "off"
17 |       },
18 |       "correctness": {
19 |         "useExhaustiveDependencies": "off"
20 |       }
21 |     }
22 |   },
23 |   "formatter": {
24 |     "indentStyle": "space"
25 |   }
26 | }
```

midday.code-workspace
```
1 | {
2 |   "folders": [
3 |     {
4 |       "name": "project-root",
5 |       "path": "./"
6 |     },
7 |     {
8 |       "name": "supabase-functions",
9 |       "path": "packages/supabase/functions"
10 |     }
11 |   ],
12 |   "settings": {
13 |     "files.exclude": {
14 |       "packages/supabase/functions/": true
15 |     }
16 |   }
17 | }
```

package.json
```
1 | {
2 |   "name": "midday",
3 |   "private": true,
4 |   "workspaces": [
5 |     "packages/*",
6 |     "apps/*",
7 |     "packages/email/*"
8 |   ],
9 |   "scripts": {
10 |     "build": "turbo build",
11 |     "clean": "git clean -xdf node_modules",
12 |     "clean:workspaces": "turbo clean",
13 |     "dev": "turbo dev --parallel",
14 |     "test": "turbo test --parallel",
15 |     "start:dashboard": "turbo start --filter=@midday/dashboard",
16 |     "start:website": "turbo start --filter=@midday/website",
17 |     "dev:api": "turbo dev --filter=@midday/api",
18 |     "dev:dashboard": "turbo dev --filter=@midday/dashboard",
19 |     "build:dashboard": "turbo build --filter=@midday/dashboard",
20 |     "dev:engine": "turbo dev --filter=@midday/engine",
21 |     "dev:website": "turbo dev --filter=@midday/website ",
22 |     "dev:desktop": "turbo dev --filter=@midday/desktop",
23 |     "jobs:dashboard": "turbo jobs --filter=@midday/dashboard",
24 |     "format": "biome format --write .",
25 |     "lint": "turbo lint && manypkg check",
26 |     "typecheck": "turbo typecheck"
27 |   },
28 |   "dependencies": {
29 |     "@biomejs/biome": "1.9.4",
30 |     "@manypkg/cli": "^0.23.0",
31 |     "turbo": "2.3.3",
32 |     "typescript": "^5.7.2"
33 |   },
34 |   "packageManager": "bun@1.1.38",
35 |   "resolutions": {
36 |     "jackspeak": "2.1.1"
37 |   }
38 | }
```

tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json"
3 | }
```

turbo.json
```
1 | {
2 |   "$schema": "https://turborepo.org/schema.json",
3 |   "globalDependencies": ["**/.env"],
4 |   "ui": "stream",
5 |   "tasks": {
6 |     "topo": {
7 |       "dependsOn": ["^topo"]
8 |     },
9 |     "build": {
10 |       "env": [
11 |         "SUPABASE_SERVICE_KEY",
12 |         "SUPABASE_API_KEY",
13 |         "RESEND_API_KEY",
14 |         "RESEND_AUDIENCE_ID",
15 |         "GOCARDLESS_SECRET_ID",
16 |         "GOCARDLESS_SECRET_KEY",
17 |         "UPSTASH_REDIS_REST_URL",
18 |         "UPSTASH_REDIS_REST_TOKEN",
19 |         "NOVU_API_KEY",
20 |         "DUB_API_KEY",
21 |         "API_ROUTE_SECRET",
22 |         "TELLER_CERTIFICATE",
23 |         "TELLER_CERTIFICATE_PRIVATE_KEY",
24 |         "MIDDAY_ENGINE_API_KEY",
25 |         "PLAID_CLIENT_ID",
26 |         "PLAID_SECRET",
27 |         "GITHUB_TOKEN",
28 |         "PLAIN_API_KEY",
29 |         "BASELIME_SERVICE",
30 |         "BASELIME_API_KEY",
31 |         "OPENAI_API_KEY",
32 |         "MISTRAL_API_KEY",
33 |         "OPENPANEL_SECRET_KEY",
34 |         "SENTRY_AUTH_TOKEN",
35 |         "SENTRY_ORG",
36 |         "SENTRY_PROJECT",
37 |         "SENTRY_SUPPRESS_GLOBAL_ERROR_HANDLER_FILE_WARNING",
38 |         "SLACK_CLIENT_SECRET",
39 |         "SLACK_CLIENT_ID",
40 |         "SLACK_SIGNING_SECRET"
41 |       ],
42 |       "inputs": ["$TURBO_DEFAULT$", ".env"],
43 |       "dependsOn": ["^build"],
44 |       "outputs": [".next/**", "!.next/cache/**", "next-env.d.ts", ".expo/**"]
45 |     },
46 |     "start": {
47 |       "cache": false
48 |     },
49 |     "test": {
50 |       "cache": false
51 |     },
52 |     "dev": {
53 |       "inputs": ["$TURBO_DEFAULT$", ".env"],
54 |       "persistent": true,
55 |       "cache": false
56 |     },
57 |     "jobs": {
58 |       "persistent": true,
59 |       "cache": false
60 |     },
61 |     "format": {},
62 |     "lint": {
63 |       "dependsOn": ["^topo"]
64 |     },
65 |     "typecheck": {
66 |       "dependsOn": ["^topo"],
67 |       "outputs": ["node_modules/.cache/tsbuildinfo.json"]
68 |     }
69 |   }
70 | }
```

.github/workflows/preview-dashboard.yaml
```
1 | name: Preview Deployment - Dashboard
2 | env:
3 |   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
4 |   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_DASHBOARD }}
5 |   TURBO_TOKEN: ${{ secrets.VERCEL_TOKEN }}
6 |   TURBO_TEAM: ${{ secrets.VERCEL_ORG_ID }}
7 |   SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT }}
8 |   SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
9 |   SENTRY_ORG: ${{ secrets.SENTRY_ORG }}
10 |   SENTRY_SUPPRESS_GLOBAL_ERROR_HANDLER_FILE_WARNING: true
11 | on:
12 |   push:
13 |     branches-ignore:
14 |       - main
15 |     paths:
16 |       - apps/dashboard/**
17 |       - packages/**
18 | jobs:
19 |   deploy-preview:
20 |     runs-on: ubuntu-latest
21 |     steps:
22 |       - uses: actions/checkout@v4
23 |       - uses: oven-sh/setup-bun@v1
24 |         with:
25 |           bun-version: latest
26 |       - name: Install dependencies
27 |         run: bun install
28 |       # - name: 🔦 Run linter
29 |       #   run: bun run lint --filter=@midday/dashboard
30 |       # - name: 🪐 Check TypeScript
31 |       #   run: bun run typecheck --filter=@midday/dashboard
32 |       - name: 🧪 Run unit tests
33 |         run: bun run test
34 |       - name: 📤 Pull Vercel Environment Information
35 |         run: bunx vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}
36 |       - name: 🏗 Build Project Artifacts
37 |         run: bunx vercel build --token=${{ secrets.VERCEL_TOKEN }}
38 |       - name: 🔄 Deploy Background Jobs
39 |         env:
40 |           TRIGGER_ACCESS_TOKEN: ${{ secrets.TRIGGER_ACCESS_TOKEN }}
41 |         run: |
42 |           TRIGGER_PROJECT_ID=${{ secrets.TRIGGER_PROJECT_ID }} bunx trigger.dev@3.3.7 deploy --env staging
43 |         working-directory: apps/dashboard
44 |       - name: 🚀 Deploy to Vercel
45 |         run: bunx vercel deploy --prebuilt --archive=tgz --token=${{ secrets.VERCEL_TOKEN }}
```

.github/workflows/preview-engine.yml
```
1 | name: Preview Deployment - Engine
2 | env:
3 |   CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
4 | on:
5 |   push:
6 |     branches-ignore:
7 |       - main
8 |     paths:
9 |       - apps/engine/**
10 | jobs:
11 |   deploy-preview:
12 |     runs-on: ubuntu-latest
13 |     steps:
14 |       - uses: actions/checkout@v4
15 |       - uses: oven-sh/setup-bun@v1
16 |         with:
17 |           bun-version: latest
18 |       - name: Install dependencies
19 |         run: bun install
20 |       - name: 🔦 Run linter
21 |         run: bun run lint
22 |         working-directory: ./apps/engine
23 |       - name: 🪐 Check TypeScript
24 |         run: bun run check:types
25 |         working-directory: ./apps/engine
26 |       - name: 🧪 Run unit tests
27 |         run: bun test
28 |         working-directory: ./apps/engine
29 |       - name: Deploy Project Artifacts to Cloudflare
30 |         uses: cloudflare/wrangler-action@v3
31 |         with:
32 |           packageManager: bun
33 |           apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
34 |           workingDirectory: "apps/engine"
35 |           wranglerVersion: "3.93.0"
36 |           command: deploy --minify src/index.ts --env staging
```

.github/workflows/preview-website.yml
```
1 | name: Preview Deployment - Website
2 | env:
3 |   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
4 |   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_WEBSITE }}
5 |   TURBO_TOKEN: ${{ secrets.VERCEL_TOKEN }}
6 |   TURBO_TEAM: ${{ secrets.VERCEL_ORG_ID }}
7 | on:
8 |   push:
9 |     branches-ignore:
10 |       - main
11 |     paths:
12 |       - apps/website/**
13 |       - packages/**
14 | jobs:
15 |   deploy-preview:
16 |     runs-on: ubuntu-latest
17 |     steps:
18 |       - uses: actions/checkout@v4
19 |       - uses: oven-sh/setup-bun@v1
20 |         with:
21 |           bun-version: latest
22 |       - name: Install dependencies
23 |         run: bun install
24 |       # - name: 🔦 Run linter
25 |       #   run: bun run lint --filter=@midday/website
26 |       # - name: 🪐 Check TypeScript
27 |       #   run: bun run typecheck --filter=@midday/website
28 |       - name: 📤 Pull Vercel Environment Information
29 |         run: bunx vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}
30 |       - name: 🏗 Build Project Artifacts
31 |         run: bunx vercel build --token=${{ secrets.VERCEL_TOKEN }}
32 |       - name: Deploy Project Artifacts to Vercel
33 |         run: bunx vercel deploy --prebuilt --archive=tgz --token=${{ secrets.VERCEL_TOKEN }}
```

.github/workflows/production-dashboard.yml
```
1 | name: Production Deployment - Dashboard
2 | env:
3 |   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
4 |   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_DASHBOARD }}
5 |   TURBO_TOKEN: ${{ secrets.VERCEL_TOKEN }}
6 |   TURBO_TEAM: ${{ secrets.VERCEL_ORG_ID }}
7 |   SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT }}
8 |   SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
9 |   SENTRY_ORG: ${{ secrets.SENTRY_ORG }}
10 |   SENTRY_SUPPRESS_GLOBAL_ERROR_HANDLER_FILE_WARNING: true
11 | on:
12 |   push:
13 |     branches:
14 |       - main
15 |     paths:
16 |       - apps/dashboard/**
17 |       - packages/**
18 | jobs:
19 |   deploy-production:
20 |     runs-on: ubuntu-latest
21 |     steps:
22 |       - uses: actions/checkout@v4
23 |       - uses: oven-sh/setup-bun@v1
24 |         with:
25 |           bun-version: latest
26 |       - name: Install dependencies
27 |         run: bun install
28 |       # - name: 🔦 Run linter
29 |       #   run: bun run lint --filter=@midday/dashboard
30 |       # - name: 🪐 Check TypeScript
31 |       #   run: bun run typecheck --filter=@midday/dashboard
32 |       - name: 🧪 Run unit tests
33 |         run: bun run test
34 |       - name: 📤 Pull Vercel Environment Information
35 |         run: bunx vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
36 |       - name: 🏗 Build Project Artifacts
37 |         run: bunx vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
38 |       - name: 🔄 Deploy Background Jobs
39 |         env:
40 |           TRIGGER_ACCESS_TOKEN: ${{ secrets.TRIGGER_ACCESS_TOKEN }}
41 |         run: |
42 |           TRIGGER_PROJECT_ID=${{ secrets.TRIGGER_PROJECT_ID }} bunx trigger.dev@3.3.7 deploy
43 |         working-directory: apps/dashboard
44 |       - name: 🚀 Deploy to Vercel
45 |         run: |
46 |           bunx vercel deploy --prebuilt --prod --archive=tgz --token=${{ secrets.VERCEL_TOKEN }} > domain.txt
47 |           bunx vercel alias --scope=${{ secrets.VERCEL_ORG_ID }} --token=${{ secrets.VERCEL_TOKEN }} set `cat domain.txt` app.midday.ai
```

.github/workflows/production-email.yml
```
1 | name: Production Deployment - Email
2 | env:
3 |   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
4 |   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_EMAIL }}
5 |   TURBO_TOKEN: ${{ secrets.VERCEL_TOKEN }}
6 |   TURBO_TEAM: ${{ secrets.VERCEL_ORG_ID }}
7 | on:
8 |   push:
9 |     branches:
10 |       - main
11 |     paths:
12 |       - packages/email/**
13 | jobs:
14 |   deploy-production:
15 |     runs-on: ubuntu-latest
16 |     steps:
17 |       - uses: actions/checkout@v4
18 |       - uses: oven-sh/setup-bun@v1
19 |         with:
20 |           bun-version: latest
21 |       - name: Install dependencies
22 |         run: bun install
23 |       # - name: 🔦 Run linter
24 |       #   run: bun run lint --filter=@midday/email
25 |       # - name: 🪐 Check TypeScript
26 |       #   run: bun run typecheck --filter=@midday/email
27 |       - name: 📤 Pull Vercel Environment Information
28 |         run: bunx vercel env pull .env --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
29 |       - name: 📤 Pull Vercel Environment Information
30 |         run: bunx vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
31 |       - name: 🏗 Build Project Artifacts
32 |         run: bunx vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
33 |       - name: Deploy Project Artifacts to Vercel
34 |         run: |
35 |           bunx vercel deploy --prebuilt --prod --archive=tgz --token=${{ secrets.VERCEL_TOKEN }} > domain.txt
36 |           bunx vercel alias --scope=${{ secrets.VERCEL_ORG_ID }} --token=${{ secrets.VERCEL_TOKEN }} set `cat domain.txt` email.midday.ai
```

.github/workflows/production-engine.yml
```
1 | name: Production Deployment - Engine
2 | env:
3 |   CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
4 | on:
5 |   push:
6 |     branches:
7 |       - main
8 |     paths:
9 |       - apps/engine/**
10 | jobs:
11 |   deploy-production:
12 |     runs-on: ubuntu-latest
13 |     steps:
14 |       - uses: actions/checkout@v4
15 |       - uses: oven-sh/setup-bun@v1
16 |         with:
17 |           bun-version: latest
18 |       - name: Install dependencies
19 |         run: bun install
20 |       - name: 🔦 Run linter
21 |         run: bun run lint
22 |         working-directory: ./apps/engine
23 |       - name: 🪐 Check TypeScript
24 |         run: bun run check:types
25 |         working-directory: ./apps/engine
26 |       - name: 🧪 Run unit tests
27 |         run: bun test
28 |         working-directory: ./apps/engine
29 |       - name: Deploy Project Artifacts to Cloudflare
30 |         uses: cloudflare/wrangler-action@v3
31 |         with:
32 |           packageManager: bun
33 |           apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
34 |           workingDirectory: "apps/engine"
35 |           wranglerVersion: "3.93.0"
36 |           command: deploy --minify src/index.ts --env production
```

.github/workflows/production-website.yml
```
1 | name: Production Deployment - Website
2 | env:
3 |   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
4 |   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_WEBSITE }}
5 |   TURBO_TOKEN: ${{ secrets.VERCEL_TOKEN }}
6 |   TURBO_TEAM: ${{ secrets.VERCEL_ORG_ID }}
7 |   NODE_OPTIONS: --max-old-space-size=4096
8 | on:
9 |   push:
10 |     branches:
11 |       - main
12 |     paths:
13 |       - apps/website/**
14 |       - packages/**
15 |       - "!packages/email/**"
16 | jobs:
17 |   deploy-production:
18 |     runs-on: ubuntu-latest
19 |     steps:
20 |       - uses: actions/checkout@v4
21 |       - uses: oven-sh/setup-bun@v1
22 |         with:
23 |           bun-version: latest
24 |       - name: Install dependencies
25 |         run: bun install
26 |       # - name: 🔦 Run linter
27 |       #   run: bun run lint --filter=@midday/website
28 |       # - name: 🪐 Check TypeScript
29 |       #   run: bun run typecheck --filter=@midday/website
30 |       - name: 📤 Pull Vercel Environment Information
31 |         run: bunx vercel env pull .env --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
32 |       - name: 📤 Pull Vercel Environment Information
33 |         run: bunx vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
34 |       - name: 🏗 Build Project Artifacts
35 |         run: bunx vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
36 |       - name: Deploy Project Artifacts to Vercel
37 |         run: |
38 |           bunx vercel deploy --prebuilt --prod --archive=tgz --token=${{ secrets.VERCEL_TOKEN }} > domain.txt
39 |           bunx vercel alias --scope=${{ secrets.VERCEL_ORG_ID }} --token=${{ secrets.VERCEL_TOKEN }} set `cat domain.txt` midday.ai
```

apps/api/package.json
```
1 | {
2 |   "name": "@midday/api",
3 |   "private": true,
4 |   "scripts": {
5 |     "dev": "supabase start",
6 |     "login": "supabase login",
7 |     "db:reset": ""
8 |   },
9 |   "dependencies": {
10 |     "supabase": "^1.200.3"
11 |   }
12 | }
```

apps/dashboard/image-loader.ts
```
1 | interface ImageLoaderParams {
2 |   src: string;
3 |   width: number;
4 |   quality?: number;
5 | }
6 |
7 | const CDN_URL = "https://midday.ai";
8 |
9 | export default function imageLoader({
10 |   src,
11 |   width,
12 |   quality = 80,
13 | }: ImageLoaderParams): string {
14 |   if (src.startsWith("/_next")) {
15 |     return `${CDN_URL}/cdn-cgi/image/width=${width},quality=${quality}/https://app.midday.ai${src}`;
16 |   }
17 |   return `${CDN_URL}/cdn-cgi/image/width=${width},quality=${quality}/${src}`;
18 | }
```

apps/dashboard/next.config.mjs
```
1 | import "./src/env.mjs";
2 |
3 | import bundleAnalyzer from "@next/bundle-analyzer";
4 | import { withSentryConfig } from "@sentry/nextjs";
5 |
6 | const withBundleAnalyzer = bundleAnalyzer({
7 |   enabled: process.env.ANALYZE === "true",
8 | });
9 |
10 | /** @type {import("next").NextConfig} */
11 | const config = {
12 |   poweredByHeader: false,
13 |   reactStrictMode: true,
14 |   images: {
15 |     loader: "custom",
16 |     loaderFile: "./image-loader.ts",
17 |     remotePatterns: [
18 |       {
19 |         protocol: "https",
20 |         hostname: "**",
21 |       },
22 |     ],
23 |   },
24 |   transpilePackages: ["@midday/ui", "@midday/tailwind", "@midday/invoice"],
25 |   eslint: {
26 |     ignoreDuringBuilds: true,
27 |   },
28 |   logging: {
29 |     fetches: {
30 |       fullUrl: process.env.LOG_FETCHES === "true",
31 |     },
32 |   },
33 |   typescript: {
34 |     ignoreBuildErrors: true,
35 |   },
36 |   experimental: {
37 |     instrumentationHook: process.env.NODE_ENV === "production",
38 |     serverComponentsExternalPackages: ["@trigger.dev/sdk"],
39 |   },
40 |   async headers() {
41 |     return [
42 |       {
43 |         source: "/((?!api/proxy).*)",
44 |         headers: [
45 |           {
46 |             key: "X-Frame-Options",
47 |             value: "DENY",
48 |           },
49 |         ],
50 |       },
51 |     ];
52 |   },
53 | };
54 |
55 | export default withSentryConfig(withBundleAnalyzer(config), {
56 |   silent: !process.env.CI,
57 |   telemetry: false,
58 |   widenClientFileUpload: true,
59 |   hideSourceMaps: true,
60 |   disableLogger: true,
61 |   tunnelRoute: "/monitoring",
62 |   sourcemaps: {
63 |     disable: true,
64 |   },
65 | });
```

apps/dashboard/package.json
```
1 | {
2 |   "name": "@midday/dashboard",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "scripts": {
6 |     "build": "NODE_ENV=production next build",
7 |     "clean": "git clean -xdf .next .turbo node_modules",
8 |     "jobs": "trigger dev",
9 |     "jobs:deploy": "trigger deploy",
10 |     "dev": "TZ=UTC next dev -p 3001",
11 |     "lint": "next lint",
12 |     "format": "biome format --write .",
13 |     "start": "next start",
14 |     "typecheck": "tsc --noEmit"
15 |   },
16 |   "dependencies": {
17 |     "@ai-sdk/openai": "^0.0.66",
18 |     "@date-fns/tz": "^1.1.2",
19 |     "@fast-csv/format": "5.0.0",
20 |     "@hookform/resolvers": "^3.9.0",
21 |     "@midday/app-store": "workspace:*",
22 |     "@midday/events": "workspace:*",
23 |     "@midday/inbox": "workspace:*",
24 |     "@midday/invoice": "workspace:*",
25 |     "@midday/kv": "workspace:*",
26 |     "@midday/location": "workspace:*",
27 |     "@midday/notification": "workspace:*",
28 |     "@midday/supabase": "workspace:*",
29 |     "@midday/ui": "workspace:*",
30 |     "@midday/utils": "workspace:*",
31 |     "@novu/headless": "^2.0.3",
32 |     "@number-flow/react": "^0.4.1",
33 |     "@react-google-maps/api": "^2.20.3",
34 |     "@sentry/nextjs": "^8",
35 |     "@supabase/sentry-js-integration": "^0.3.0",
36 |     "@tanstack/react-table": "^8.20.5",
37 |     "@team-plain/typescript-sdk": "4.7.0",
38 |     "@todesktop/client-active-win": "^0.15.0",
39 |     "@todesktop/client-core": "^1.12.0",
40 |     "@todesktop/runtime": "^1.6.4",
41 |     "@trigger.dev/react-hooks": "3.3.7",
42 |     "@trigger.dev/sdk": "3.3.7",
43 |     "@uidotdev/usehooks": "^2.4.1",
44 |     "@upstash/ratelimit": "^2.0.4",
45 |     "@zip.js/zip.js": "2.7.52",
46 |     "ai": "3.4.9",
47 |     "change-case": "^5.4.4",
48 |     "date-fns": "^4.1.0",
49 |     "dub": "^0.38.1",
50 |     "framer-motion": "^11.12.0",
51 |     "geist": "^1.3.1",
52 |     "little-date": "^1.0.0",
53 |     "lottie-react": "^2.4.0",
54 |     "ms": "^2.1.3",
55 |     "next": "14.2.1",
56 |     "next-international": "1.2.4",
57 |     "next-safe-action": "^7.9.3",
58 |     "next-themes": "^0.3.0",
59 |     "nuqs": "^1.19.3",
60 |     "papaparse": "^5.4.1",
61 |     "react": "18.3.1",
62 |     "react-colorful": "^5.6.1",
63 |     "react-dom": "18.3.1",
64 |     "react-dropzone": "^14.2.3",
65 |     "react-hook-form": "^7.53.0",
66 |     "react-hotkeys-hook": "^4.5.1",
67 |     "react-intersection-observer": "^9.13.1",
68 |     "react-markdown": "^9.0.1",
69 |     "react-plaid-link": "^3.6.0",
70 |     "react-use-draggable-scroll": "^0.4.7",
71 |     "recharts": "^2.12.7",
72 |     "resend": "^4.0.1",
73 |     "sharp": "^0.33.5",
74 |     "tus-js-client": "4.1.0",
75 |     "use-long-press": "^3.2.0",
76 |     "use-places-autocomplete": "^4.0.1",
77 |     "zod": "^3.23.8",
78 |     "zustand": "^4.5.5"
79 |   },
80 |   "devDependencies": {
81 |     "@midday/tsconfig": "workspace:*",
82 |     "@next/bundle-analyzer": "14.2.1",
83 |     "@t3-oss/env-nextjs": "^0.11.1",
84 |     "@todesktop/tailwind-variants": "^1.0.1",
85 |     "@types/node": "^22.7.4",
86 |     "@types/papaparse": "^5.3.15",
87 |     "@types/react": "^18.3.11",
88 |     "@types/react-dom": "^18.3.0",
89 |     "trigger.dev": "3.3.7",
90 |     "typescript": "^5.6.3"
91 |   }
92 | }
```

apps/dashboard/postcss.config.cjs
```
1 | // @ts-expect-error - No types for postcss
2 | module.exports = require("@midday/ui/postcss");
```

apps/dashboard/sentry.client.config.ts
```
1 | import { createClient } from "@midday/supabase/client";
2 | import * as Sentry from "@sentry/nextjs";
3 | import { supabaseIntegration } from "@supabase/sentry-js-integration";
4 |
5 | const client = createClient();
6 |
7 | Sentry.init({
8 |   dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
9 |   tracesSampleRate: 1,
10 |   debug: false,
11 |   enabled: process.env.NODE_ENV === "production",
12 |   integrations: [
13 |     supabaseIntegration(client, Sentry, {
14 |       tracing: true,
15 |       breadcrumbs: true,
16 |       errors: true,
17 |     }),
18 |   ],
19 | });
```

apps/dashboard/sentry.edge.config.ts
```
1 | import * as Sentry from "@sentry/nextjs";
2 |
3 | Sentry.init({
4 |   dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
5 |   enabled: process.env.NODE_ENV === "production",
6 |   tracesSampleRate: 1,
7 |   debug: false,
8 | });
```

apps/dashboard/sentry.server.config.ts
```
1 | import { createClient } from "@midday/supabase/client";
2 | import * as Sentry from "@sentry/nextjs";
3 | import { supabaseIntegration } from "@supabase/sentry-js-integration";
4 |
5 | const client = createClient();
6 |
7 | Sentry.init({
8 |   dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
9 |   tracesSampleRate: 1,
10 |   debug: false,
11 |   enabled: process.env.NODE_ENV === "production",
12 |   integrations: [
13 |     supabaseIntegration(client, Sentry, {
14 |       tracing: true,
15 |       breadcrumbs: true,
16 |       errors: true,
17 |     }),
18 |   ],
19 | });
```

apps/dashboard/tailwind.config.ts
```
1 | import baseConfig from "@midday/ui/tailwind.config";
2 | import type { Config } from "tailwindcss";
3 |
4 | export default {
5 |   content: [
6 |     "./src/**/*.{ts,tsx}",
7 |     "../../packages/ui/src/**/*.{ts,tsx}",
8 |     "../../packages/invoice/src/**/*.{ts,tsx}",
9 |   ],
10 |   presets: [baseConfig],
11 |   plugins: [require("@todesktop/tailwind-variants")],
12 | } satisfies Config;
```

apps/dashboard/trigger.config.ts
```
1 | import { defineConfig } from "@trigger.dev/sdk/v3";
2 |
3 | export default defineConfig({
4 |   project: process.env.TRIGGER_PROJECT_ID!,
5 |   runtime: "node",
6 |   logLevel: "log",
7 |   retries: {
8 |     enabledInDev: false,
9 |     default: {
10 |       maxAttempts: 3,
11 |       minTimeoutInMs: 1000,
12 |       maxTimeoutInMs: 10000,
13 |       factor: 2,
14 |       randomize: true,
15 |     },
16 |   },
17 |   build: {
18 |     external: ["sharp"],
19 |   },
20 |   dirs: ["./jobs/tasks"],
21 | });
```

apps/dashboard/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/nextjs.json",
3 |   "compilerOptions": {
4 |     "baseUrl": ".",
5 |     "paths": {
6 |       "@/*": ["./src/*"]
7 |     },
8 |     "strict": true
9 |   },
10 |   "include": [
11 |     "next-env.d.ts",
12 |     "next.config.js",
13 |     "**/*.ts",
14 |     "**/*.tsx",
15 |     ".next/types/**/*.ts",
16 |     "tailwind.config.ts"
17 |   ],
18 |   "exclude": ["node_modules"]
19 | }
```

apps/dashboard/vercel.json
```
1 | {
2 |   "version": 2,
3 |   "public": false,
4 |   "github": {
5 |     "enabled": false
6 |   },
7 |   "regions": ["fra1", "sfo1", "iad1"]
8 | }
```

apps/docs/examples.mdx
```
1 | ---
2 | title: "Examples"
3 | "og:title": "Midday API Examples - Build with the Midday API"
4 | description: "Explore ideas and examples of what you can build with the Midday API"
5 | icon: github
6 | ---
```

apps/docs/integrations.mdx
```
1 | ---
2 | title: "Integrations"
3 | "og:title": "Midday Integrations: Connect Midday to services"
4 | description: "Integrate Midday with your services."
5 | icon: object-union
6 | ---
```

apps/docs/introduction.mdx
```
1 | ---
2 | title: Introduction
3 | "og:title": "Getting Started with Midday.ai - Documentation"
4 | description: "Midday.ai | Run your business smarter."
5 | icon: rocket
6 | ---
7 |
8 | <Frame>
9 |   <img src="/images/header.png" alt="Midday header" width="1200" height="630" />
10 | </Frame>
11 |
12 | You can self-host Midday on your own cloud infrastructure for greater control over your data. This guide will walk you through the entire process of setting up Midday.
13 |
14 | ## Prerequisites
15 |
16 | Before you begin, make sure you have the following:
17 |
18 | - A [GitHub](https://github.com/) account
19 | - An [Upstash](https://upstash.com/) account
20 | - A [Supabase](https://supabase.com/) account
21 | - A [Vercel](https://vercel.com/) account
```

apps/docs/local-development.mdx
```
1 | ---
2 | title: "Local Development"
3 | "og:title": "How to setup Midday for Local Development"
4 | description: "A guide on how to run Midday's codebase locally."
5 | icon: code
6 | ---
7 |
8 | ###
9 |
10 | ## Introduction
11 |
12 | Midday's codebase is set up in a monorepo via [Turborepo](https://turbo.build/repo) and is fully [open-source on GitHub](https://git.new/midday).
13 |
14 | Here's the monorepo structure:
15 |
16 | ```
17 | apps
18 | ├── api
19 | ├── dashboard
20 | ├── docs
21 | ├── engine
22 | ├── mobile
23 | ├── website
24 | packages
25 | ├── documents
26 | ├── email
27 | ├── events
28 | ├── import
29 | ├── inbox
30 | ├── jobs
31 | ├── kv
32 | ├── location
33 | ├── notification
34 | ├── supabase
35 | ├── tsconfig
36 | ├── ui
37 | ├── utils
38 | ```
39 |
40 | The `apps` directory contains the code for:
41 |
42 | - `api`: The backend for Midday (supabase).
43 | - `dashboard`: Midday's application ([app.midday.ai](https://app.midday.ai)).
44 | - `docs`: Midday's documentation site ([midday.ai/docs](https://midday.ai/docs)).
45 | - `engine`: Midday's bank engine ([midday.ai/engine](https://midday.ai/engine)).
46 | - `mobile`: Midday's mobile app.
47 | - `website`: Midday's website app ([midday.ai](https://midday.ai)).
48 |
49 | The `packages` directory contains the code for:
50 |
51 | - `documents`: OCR for receipts.
52 | - `events`: Analytics library.
53 | - `import`: CSV-importer.
54 | - `inbox`: Inbox utils.
55 | - `jobs`: Background jobs.
56 | - `kv`: Key value storage client.
57 | - `location`: Location related utils.
58 | - `notification`: Notifications client.
59 | - `supabase`: Queries and client.
60 | - `tsconfig`: The TypeScript configuration for Midday's web app.
61 | - `ui`: UI component library.
62 | - `utils`: A collection of utility functions and constants used across Midday's codebase.
63 |
64 | ## Running Midday locally
65 |
66 | To run Midday locally, you'll need to set up the following:
67 |
68 | - A [Supabase](https://supabase.com/) account
69 | - An [Upstash](https://upstash.com/) account
70 |
71 | ## Step 1: Local setup
72 |
73 | First, you'll need to clone the Midday repo and install the dependencies.
74 |
75 | <Steps>
76 |
77 |   <Step title="Clone the repo">
78 |
79 | First, clone the [midday.ai repo](https://d.to/github) into a public GitHub repository.
80 |
81 |     ```bash Terminal
82 |     git clone https://github.com/midday-ai/midday.git
83 |     ```
84 |
85 |   </Step>
86 |
87 |   <Step title="Install dependencies">
88 |
89 |     Run the following command to install the dependencies:
90 |
91 |     ```bash Terminal
92 |     bun i
93 |     ```
94 |
95 |   </Step>
96 |
97 | </Steps>
```

apps/docs/mint.json
```
1 | {
2 |     "$schema": "https://mintlify.com/schema.json",
3 |     "name": "Midday.ai Docs",
4 |     "logo": {
5 |       "dark": "/logos/logotype-dark.svg",
6 |       "light": "/logos/logotype.svg",
7 |       "href": "https://midday.ai"
8 |     },
9 |     "favicon": "/logos/favicon.png",
10 |     "colors": {
11 |       "primary": "#1D1D1D",
12 |       "light": "#F2F1EF",
13 |       "dark": "#1D1D1D",
14 |       "background": {
15 |         "dark": "#121212",
16 |         "light": "#FFFFFF"
17 |       },
18 |       "anchors": {
19 |         "from": "#FF7F57",
20 |         "to": "#9563FF"
21 |       }
22 |     },
23 |     "topbarLinks": [
24 |       {
25 |         "name": "Support",
26 |         "url": "mailto:support@midday.ai"
27 |       }
28 |     ],
29 |     "topbarCtaButton": {
30 |       "name": "Dashboard",
31 |       "url": "https://app.midday.ai"
32 |     },
33 |     "openapi": "https://engine.midday.ai/openapi",
34 |     "tabs": [
35 |       {
36 |         "name": "Engine API Reference",
37 |         "url": "api-reference/engine"
38 |       }
39 |     ],
40 |     "anchors": [
41 |       {
42 |         "name": "Help Center",
43 |         "icon": "question",
44 |         "url": "https://midday.ai/support"
45 |       },
46 |       {
47 |         "name": "GitHub",
48 |         "icon": "github",
49 |         "url": "https://git.new/midday"
50 |       }
51 |     ],
52 |     "navigation": [
53 |       {
54 |         "group": "Getting Started",
55 |         "pages": ["introduction"]
56 |       },
57 |       {
58 |         "group": "Resources",
59 |         "pages": ["integrations", "examples"]
60 |       },
61 |       {
62 |         "group": "Open source",
63 |         "pages": ["local-development", "self-hosting"]
64 |       },
65 |       {
66 |         "group": "Engine API Reference",
67 |         "pages": [
68 |           "api-reference/engine/introduction"
69 |         ]
70 |       },
71 |       {
72 |         "group": "Links",
73 |         "pages": [
74 |           "api-reference/engine/endpoint/get-transactions",
75 |           "api-reference/engine/endpoint/get-accounts",
76 |           "api-reference/engine/endpoint/get-account-balance",
77 |           "api-reference/engine/endpoint/search-institutions",
78 |           "api-reference/engine/endpoint/auth-link-gocardless",
79 |           "api-reference/engine/endpoint/exchange-token-gocardless",
80 |           "api-reference/engine/endpoint/auth-link-plaid",
81 |           "api-reference/engine/endpoint/exchange-token-plaid",
82 |           "api-reference/engine/endpoint/health"
83 |         ]
84 |       }
85 |     ],
86 |     "api": {
87 |       "maintainOrder": true
88 |     },
89 |     "feedback": {
90 |       "thumbsRating": true
91 |     },
92 |     "footerSocials": {
93 |       "twitter": "https://twitter.com/middayai",
94 |       "github": "https://git.new/midday",
95 |       "website": "https://midday.ai",
96 |       "linkedin": "https://www.linkedin.com/company/midday-ai"
97 |     }
98 |   }
```

apps/docs/package.json
```
1 | {
2 |   "name": "@midday/docs",
3 |   "scripts": {
4 |     "dev": "mintlify dev --port 3004",
5 |     "generate:engine": "bunx @mintlify/scraping@latest openapi-file http://localhost:3002/openapi -o api-reference/engine/endpoint"
6 |   },
7 |   "devDependencies": {
8 |     "mintlify": "^4.0.236"
9 |   }
10 | }
```

apps/docs/self-hosting.mdx
```
1 | ---
2 | title: "Self-hosting Midday"
3 | "og:title": "How to self-host Midday in 8 easy steps"
4 | description: "An end-to-end guide on how to self-host Midday"
5 | icon: server
6 | ---
```

apps/engine/.dev.vars-example
```
1 | API_SECRET_KEY=secret
2 | GOCARDLESS_SECRET_ID=
3 | GOCARDLESS_SECRET_KEY=
4 | PLAID_CLIENT_ID=
5 | PLAID_SECRET=
6 | PLAID_ENVIRONMENT=sandbox
7 | TYPESENSE_API_KEY=
8 | TYPESENSE_ENDPOINT=
9 | TYPESENSE_ENDPOINT_US=
10 | TYPESENSE_ENDPOINT_EU=
11 | TYPESENSE_ENDPOINT_AU=
```

apps/engine/package.json
```
1 | {
2 |   "name": "@midday/engine",
3 |   "scripts": {
4 |     "dev": "NODE_ENV=development wrangler dev src/index.ts --port 3002",
5 |     "deploy": "wrangler deploy --minify src/index.ts",
6 |     "clean": "rm -rf .turbo node_modules",
7 |     "lint": "biome check .",
8 |     "format": "biome format --write .",
9 |     "check:types": "tsc --noEmit"
10 |   },
11 |   "dependencies": {
12 |     "@hono/swagger-ui": "^0.5.0",
13 |     "@hono/zod-openapi": "^0.18.3",
14 |     "@hono/zod-validator": "^0.4.1",
15 |     "hono": "^4.6.13",
16 |     "plaid": "^30.0.0",
17 |     "typesense": "^1.8.2",
18 |     "workers-ai-provider": "^0.0.10",
19 |     "xior": "^0.6.1",
20 |     "zod": "^3.23.8"
21 |   },
22 |   "devDependencies": {
23 |     "@cloudflare/workers-types": "^4.20241205.0",
24 |     "@types/bun": "^1.1.14",
25 |     "wrangler": "^3.93.0"
26 |   },
27 |   "exports": {
28 |     "./client": "./src/client/index.ts",
29 |     "./gocardless/utils": "./src/providers/gocardless/utils.ts"
30 |   }
31 | }
```

apps/engine/tsconfig.json
```
1 | {
2 |   "compilerOptions": {
3 |     "moduleResolution": "Bundler",
4 |     "baseUrl": ".",
5 |     "paths": {
6 |       "@/*": ["./src/*"]
7 |     },
8 |     "strict": true,
9 |     "types": ["@cloudflare/workers-types", "bun-types"],
10 |     "jsx": "react-jsx",
11 |     "jsxImportSource": "hono/jsx",
12 |     "lib": ["ESNext"],
13 |     "target": "ESNext",
14 |     "module": "ESNext",
15 |     "moduleDetection": "force",
16 |     "allowJs": true,
17 |     "skipLibCheck": true,
18 |     "noFallthroughCasesInSwitch": true
19 |   }
20 | }
```

apps/engine/wrangler.toml
```
1 | compatibility_date = "2024-11-11"
2 | workers_dev = false
3 | logpush = true
4 |
5 | [observability]
6 | enabled = true
7 |
8 |
9 | [env.production]
10 | name = "engine"
11 | route = { pattern = "engine.midday.ai/*", zone_name = "midday.ai" }
12 |
13 | kv_namespaces = [
14 |   { binding = "KV", id = "1ce9f0355d854a569f72bfccbfbea369" },
15 |   { binding = "ENRICH_KV", id = "1ce9f0355d854a569f72bfccbfbea369" }
16 | ]
17 |
18 | mtls_certificates = [
19 |   { binding = "TELLER_CERT", certificate_id = "76fdbac8-e96b-4a1e-922c-e54891b7371c" }
20 | ]
21 |
22 | r2_buckets = [
23 |   { binding = "STORAGE", bucket_name = "engine-assets", preview_bucket_name = "", jurisdiction = "eu" }
24 | ]
25 |
26 | [env.production.ai]
27 | binding = "AI"
28 | provider = "llama"
29 | model = "llama-3.3"
30 | jurisdiction = "eu"
31 |
32 | [env.staging]
33 | name = "engine-staging"
34 | route = { pattern = "engine-staging.midday.ai/*", zone_name = "midday.ai" }
35 |
36 | kv_namespaces = [
37 |   { binding = "KV", id = "825dc18b2a38463492ff0db06ba99fc8" },
38 |   { binding = "ENRICH_KV", id = "72051e71ec964899a3d0da95df04b92f" }
39 | ]
40 |
41 | mtls_certificates = [
42 |   { binding = "TELLER_CERT", certificate_id = "76fdbac8-e96b-4a1e-922c-e54891b7371c" }
43 | ]
44 |
45 | r2_buckets = [
46 |   { binding = "STORAGE", bucket_name = "engine-assets", preview_bucket_name = "", jurisdiction = "eu" }
47 | ]
48 |
49 | [env.staging.ai]
50 | binding = "AI"
51 | provider = "llama"
52 | model = "llama-3.3"
53 | jurisdiction = "eu"
```

apps/mobile/package.json
```
1 | {
2 |   "name": "mobile",
3 |   "version": "0.0.0",
4 |   "private": true
5 | }
```

apps/website/image-loader.ts
```
1 | interface ImageLoaderParams {
2 |   src: string;
3 |   width: number;
4 |   quality?: number;
5 | }
6 |
7 | export default function imageLoader({
8 |   src,
9 |   width,
10 |   quality = 80,
11 | }: ImageLoaderParams): string {
12 |   return `https://midday.ai/cdn-cgi/image/width=${width},quality=${quality}/${src}`;
13 | }
```

apps/website/next.config.mjs
```
1 | /** @type {import("next").NextConfig} */
2 | const config = {
3 |   poweredByHeader: false,
4 |   reactStrictMode: true,
5 |   transpilePackages: ["@midday/ui", "@midday/tailwind", "next-mdx-remote"],
6 |   eslint: {
7 |     ignoreDuringBuilds: true,
8 |   },
9 |   typescript: {
10 |     ignoreBuildErrors: true,
11 |   },
12 |   experimental: {
13 |     inlineCss: true,
14 |   },
15 |   images: {
16 |     loader: "custom",
17 |     loaderFile: "./image-loader.ts",
18 |     remotePatterns: [
19 |       {
20 |         protocol: "https",
21 |         hostname: "**",
22 |       },
23 |     ],
24 |   },
25 |   async redirects() {
26 |     return [
27 |       {
28 |         source: "/en/(.*)",
29 |         destination: "/",
30 |         permanent: true,
31 |       },
32 |       {
33 |         source: "/public-beta",
34 |         destination: "/",
35 |         permanent: true,
36 |       },
37 |       {
38 |         source: "/pitch",
39 |         destination: "/",
40 |         permanent: true,
41 |       },
42 |     ];
43 |   },
44 | };
45 |
46 | export default config;
```

apps/website/package.json
```
1 | {
2 |   "name": "@midday/website",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "scripts": {
6 |     "build": "NODE_ENV=production next build",
7 |     "clean": "git clean -xdf .next .turbo node_modules",
8 |     "dev": "TZ=UTC next dev --turbopack -p 3000",
9 |     "lint": "next lint",
10 |     "format": "biome format --write .",
11 |     "start": "next start",
12 |     "typecheck": "tsc --noEmit"
13 |   },
14 |   "dependencies": {
15 |     "@midday/supabase": "workspace:*",
16 |     "@midday/ui": "workspace:*",
17 |     "@openpanel/nextjs": "^1.0.7",
18 |     "@openstatus/react": "^0.0.3",
19 |     "@team-plain/typescript-sdk": "5.5.0",
20 |     "@uidotdev/usehooks": "^2.4.1",
21 |     "date-fns": "^4.1.0",
22 |     "framer-motion": "^11.13.5",
23 |     "geist": "^1.3.1",
24 |     "next": "15.1.0",
25 |     "next-mdx-remote": "^5.0.0",
26 |     "next-safe-action": "^7.9.9",
27 |     "react": "19.0.0",
28 |     "react-dom": "19.0.0",
29 |     "react-hls-player": "^3.0.7",
30 |     "react-use-draggable-scroll": "^0.4.7",
31 |     "resend": "^4.0.1",
32 |     "server-only": "^0.0.1",
33 |     "sharp": "^0.33.5",
34 |     "sugar-high": "^0.7.5"
35 |   },
36 |   "devDependencies": {
37 |     "@midday/tsconfig": "workspace:*",
38 |     "@types/node": "^22.10.1",
39 |     "@types/react": "19.0.1",
40 |     "@types/react-dom": "npm:types-react-dom@19.0.0-alpha.3"
41 |   },
42 |   "overrides": {
43 |     "@types/react": "npm:types-react@19.0.0-rc.1",
44 |     "@types/react-dom": "npm:types-react-dom@19.0.0-rc.1"
45 |   }
46 | }
```

apps/website/postcss.config.cjs
```
1 | module.exports = require("@midday/ui/postcss");
```

apps/website/tailwind.config.ts
```
1 | import baseConfig from "@midday/ui/tailwind.config";
2 | import type { Config } from "tailwindcss";
3 |
4 | export default {
5 |   content: ["./src/**/*.{ts,tsx}", "../../packages/ui/src/**/*.{ts,tsx}"],
6 |   presets: [baseConfig],
7 |   theme: {
8 |     container: {
9 |       center: true,
10 |     },
11 |   },
12 | } satisfies Config;
```

apps/website/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/nextjs.json",
3 |   "compilerOptions": {
4 |     "baseUrl": ".",
5 |     "paths": {
6 |       "@/*": ["./src/*"]
7 |     }
8 |   },
9 |   "include": [
10 |     "next-env.d.ts",
11 |     "next.config.js",
12 |     "**/*.ts",
13 |     "**/*.tsx",
14 |     ".next/types/**/*.ts",
15 |     "tailwind.config.ts"
16 |   ],
17 |   "exclude": ["node_modules"]
18 | }
```

apps/website/vercel.json
```
1 | {
2 |   "version": 2,
3 |   "public": false,
4 |   "github": {
5 |     "enabled": false
6 |   },
7 |   "regions": ["fra1", "sfo1", "iad1"]
8 | }
```

packages/app-store/package.json
```
1 | {
2 |   "name": "@midday/app-store",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "sideEffects": false,
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit"
11 |   },
12 |   "dependencies": {
13 |     "@ai-sdk/openai": "^0.0.66",
14 |     "@slack/bolt": "^3.22.0",
15 |     "@slack/web-api": "^7.5.0",
16 |     "ai": "^3.4.9",
17 |     "zod": "^3.23.8"
18 |   },
19 |   "devDependencies": {
20 |     "@types/node": "^22.7.4",
21 |     "typescript": "^5.6.3"
22 |   },
23 |   "exports": {
24 |     ".": "./src/index.ts",
25 |     "./slack": "./src/slack/index.ts",
26 |     "./slack-notifications": "./src/slack/lib/notifications/transactions.ts",
27 |     "./slack-client": "./src/slack/lib/client.ts",
28 |     "./db": "./src/db/index.ts"
29 |   }
30 | }
```

packages/app-store/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src", "."],
4 |   "exclude": ["node_modules"]
5 | }
```

packages/documents/package.json
```
1 | {
2 |   "name": "@midday/documents",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "src/index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit",
11 |     "test": "bun test src"
12 |   },
13 |   "dependencies": {
14 |     "@ai-sdk/openai": "^0.0.66",
15 |     "@azure-rest/ai-document-intelligence": "^1.0.0-beta.3",
16 |     "@midday/utils": "workspace:*",
17 |     "ai": "3.4.9",
18 |     "base64-arraybuffer": "^1.0.2",
19 |     "change-case": "^5.4.4",
20 |     "heic-convert": "1.2.4",
21 |     "zod": "^3.23.8"
22 |   },
23 |   "devDependencies": {
24 |     "@types/bun": "^1.1.10",
25 |     "@types/heic-convert": "1.2.3",
26 |     "request": "^2.88.2"
27 |   }
28 | }
```

packages/documents/tsconfig.json
```
1 | {
2 |     "extends": "@midday/tsconfig/nextjs.json",
3 |     "include": ["src"],
4 |     "exclude": ["node_modules"]
5 |   }
```

packages/email/package.json
```
1 | {
2 |   "name": "@midday/email",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit",
11 |     "dev": "email dev -p 3003",
12 |     "build": "email build",
13 |     "start": "email start"
14 |   },
15 |   "dependencies": {
16 |     "@midday/ui": "workspace:*",
17 |     "@midday/utils": "workspace:*",
18 |     "@react-email/components": "0.0.31",
19 |     "@react-email/render": "0.0.10",
20 |     "@react-email/tailwind": "1.0.4",
21 |     "date-fns": "^4.1.0",
22 |     "react-email": "3.0.4",
23 |     "responsive-react-email": "^0.0.5"
24 |   },
25 |   "devDependencies": {
26 |     "typescript": "^5.7.2"
27 |   }
28 | }
```

packages/email/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["emails", "components"],
4 |   "exclude": ["node_modules"],
5 |   "compilerOptions": {
6 |     "baseUrl": ".",
7 |     "module": "NodeNext",
8 |     "moduleResolution": "NodeNext",
9 |     "jsx": "react-jsx",
10 |     "jsxImportSource": "react"
11 |   }
12 | }
```

packages/email/vercel.json
```
1 | {
2 |   "version": 2,
3 |   "public": false,
4 |   "github": {
5 |     "enabled": false
6 |   },
7 |   "regions": ["fra1", "sfo1", "iad1"]
8 | }
```

packages/events/package.json
```
1 | {
2 |   "name": "@midday/events",
3 |   "version": "1.0.0",
4 |   "main": "src/index.ts",
5 |   "private": true,
6 |   "sideEffects": false,
7 |   "scripts": {
8 |     "clean": "rm -rf .turbo node_modules",
9 |     "lint": "biome check .",
10 |     "format": "biome --write .",
11 |     "typecheck": "tsc --noEmit"
12 |   },
13 |   "dependencies": {
14 |     "@openpanel/nextjs": "^1.0.6",
15 |     "@vercel/functions": "^1.5.0"
16 |   },
17 |   "devDependencies": {
18 |     "typescript": "^5.6.3"
19 |   },
20 |   "exports": {
21 |     "./server": "./src/server.ts",
22 |     "./client": "./src/client.tsx",
23 |     "./events": "./src/events.ts"
24 |   }
25 | }
```

packages/events/tsconfig.json
```
1 | {
2 |     "extends": "@midday/tsconfig/nextjs.json",
3 |     "include": ["src"],
4 |     "exclude": ["node_modules"]
5 |   }
```

packages/import/package.json
```
1 | {
2 |   "name": "@midday/import",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "src/index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit",
11 |     "test": "bun test src"
12 |   },
13 |   "dependencies": {
14 |     "change-case": "^5.4.4",
15 |     "date-fns-tz": "^3.2.0",
16 |     "uuid": "^10.0.0"
17 |   },
18 |   "exports": {
19 |     ".": "./src/index.ts",
20 |     "./mappings": "./src/mappings.ts",
21 |     "./transform": "./src/transform.ts",
22 |     "./validate": "./src/validate.ts"
23 |   }
24 | }
```

packages/inbox/package.json
```
1 | {
2 |   "name": "@midday/inbox",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "src/index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit",
11 |     "test": "bun test src"
12 |   },
13 |   "dependencies": {
14 |     "zod": "^3.23.8"
15 |   }
16 | }
```

packages/invoice/package.json
```
1 | {
2 |   "name": "@midday/invoice",
3 |   "private": true,
4 |   "main": "src/index.tsx",
5 |   "scripts": {
6 |     "clean": "rm -rf .turbo node_modules",
7 |     "lint": "biome check .",
8 |     "format": "biome format --write .",
9 |     "typecheck": "tsc --noEmit"
10 |   },
11 |   "exports": {
12 |     ".": "./src/index.tsx",
13 |     "./token": "./src/token/index.ts",
14 |     "./number": "./src/utils/number.ts",
15 |     "./templates/html": "./src/templates/html/index.tsx",
16 |     "./templates/pdf": "./src/templates/pdf/index.tsx",
17 |     "./templates/og": "./src/templates/og/index.tsx",
18 |     "./editor": "./src/editor/index.tsx",
19 |     "./calculate": "./src/utils/calculate.ts",
20 |     "./format-to-html": "./src/templates/html/format.tsx",
21 |     "./default": "./src/utils/default.ts",
22 |     "./content": "./src/utils/content.ts"
23 |   },
24 |   "dependencies": {
25 |     "@midday/ui": "workspace:*",
26 |     "@midday/utils": "workspace:*",
27 |     "@react-pdf/renderer": "^4.0.0",
28 |     "date-fns": "^4.1.0",
29 |     "jose": "^5.9.6",
30 |     "qrcode": "^1.5.4"
31 |   }
32 | }
```

packages/invoice/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src"],
4 |   "exclude": ["node_modules"],
5 |   "compilerOptions": {
6 |     "module": "ESNext",
7 |     "moduleResolution": "Node",
8 |     "jsx": "react-jsx",
9 |     "jsxImportSource": "react"
10 |   }
11 | }
```

packages/kv/package.json
```
1 | {
2 |   "name": "@midday/kv",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "src/index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit"
11 |   },
12 |   "dependencies": {
13 |     "@upstash/redis": "^1.34.2",
14 |     "server-only": "^0.0.1"
15 |   }
16 | }
```

packages/kv/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src"],
4 |   "exclude": ["node_modules"]
5 | }
```

packages/location/package.json
```
1 | {
2 |   "name": "@midday/location",
3 |   "version": "1.0.0",
4 |   "main": "src/index.ts",
5 |   "private": true,
6 |   "sideEffects": false,
7 |   "scripts": {
8 |     "clean": "rm -rf .turbo node_modules",
9 |     "lint": "biome check .",
10 |     "format": "biome --write .",
11 |     "typecheck": "tsc --noEmit"
12 |   },
13 |   "exports": {
14 |     ".": "./src/index.ts",
15 |     "./countries": "./src/countries.ts",
16 |     "./countries-intl": "./src/countries-intl.ts",
17 |     "./currencies": "./src/currencies.ts",
18 |     "./country-flags": "./src/country-flags.ts"
19 |   },
20 |   "devDependencies": {
21 |     "typescript": "^5.6.3"
22 |   }
23 | }
```

packages/location/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src"],
4 |   "exclude": ["node_modules"]
5 | }
```

packages/notification/package.json
```
1 | {
2 |   "name": "@midday/notification",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "main": "src/index.ts",
6 |   "scripts": {
7 |     "clean": "rm -rf .turbo node_modules",
8 |     "lint": "biome check .",
9 |     "format": "biome format --write .",
10 |     "typecheck": "tsc --noEmit"
11 |   },
12 |   "dependencies": {
13 |     "@novu/node": "^2.0.1",
14 |     "nanoid": "^5.0.7"
15 |   },
16 |   "devDependencies": {
17 |     "typescript": "^5.6.3"
18 |   }
19 | }
```

packages/notification/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src"],
4 |   "exclude": ["node_modules"]
5 | }
```

packages/supabase/package.json
```
1 | {
2 |   "name": "@midday/supabase",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "scripts": {
6 |     "clean": "rm -rf .turbo node_modules",
7 |     "lint": "biome check .",
8 |     "format": "biome format --write .",
9 |     "typecheck": "tsc --noEmit",
10 |     "db:generate": "supabase gen types --lang=typescript --project-id $PROJECT_ID --schema public > src/types/db.ts"
11 |   },
12 |   "dependencies": {
13 |     "@date-fns/utc": "^2.1.0",
14 |     "@supabase/postgrest-js": "^1.17.3",
15 |     "@supabase/ssr": "^0.5.1",
16 |     "date-fns": "^4.1.0",
17 |     "react": "18.3.1",
18 |     "server-only": "^0.0.1",
19 |     "supabase": "^1.219.2"
20 |   },
21 |   "devDependencies": {
22 |     "@supabase/supabase-js": "^2.46.1",
23 |     "typescript": "^5.6.3"
24 |   },
25 |   "exports": {
26 |     "./server": "./src/client/server.ts",
27 |     "./client": "./src/client/client.ts",
28 |     "./client-query": "./src/queries/client.ts",
29 |     "./job": "./src/client/job.ts",
30 |     "./mutations": "./src/mutations/index.ts",
31 |     "./middleware": "./src/client/middleware.ts",
32 |     "./queries": "./src/queries/index.ts",
33 |     "./cached-queries": "./src/queries/cached-queries.ts",
34 |     "./storage": "./src/utils/storage.ts",
35 |     "./types": "./src/types/index.ts"
36 |   }
37 | }
```

packages/supabase/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["src", "."],
4 |   "exclude": ["node_modules"]
5 | }
```

packages/tsconfig/base.json
```
1 | {
2 | 	"$schema": "https://json.schemastore.org/tsconfig",
3 | 	"display": "Default",
4 | 	"compilerOptions": {
5 | 	  "esModuleInterop": true,
6 | 	  "incremental": false,
7 | 	  "isolatedModules": true,
8 | 	  "lib": ["es2022", "DOM", "DOM.Iterable"],
9 | 	  "module": "NodeNext",
10 | 	  "moduleDetection": "force",
11 | 	  "moduleResolution": "NodeNext",
12 | 	  "noUncheckedIndexedAccess": true,
13 | 	  "resolveJsonModule": true,
14 | 	  "skipLibCheck": true,
15 | 	  "strict": true,
16 | 	  "target": "ES2022"
17 | 	}
18 |   }
```

packages/tsconfig/nextjs.json
```
1 | {
2 |     "$schema": "https://json.schemastore.org/tsconfig",
3 |     "display": "Next.js",
4 |     "extends": "./base.json",
5 |     "compilerOptions": {
6 |       "plugins": [{ "name": "next" }],
7 |       "module": "ESNext",
8 |       "moduleResolution": "Bundler",
9 |       "allowJs": true,
10 |       "jsx": "preserve",
11 |       "noEmit": true
12 |     }
13 |   }
```

packages/tsconfig/package.json
```
1 | {
2 |     "name": "@midday/tsconfig",
3 |     "private": true,
4 |     "version": "1.0.0",
5 |     "files": [
6 |         "base.json"
7 |     ]
8 | }
```

packages/tsconfig/react-library.json
```
1 | {
2 |     "$schema": "https://json.schemastore.org/tsconfig",
3 |     "display": "React Library",
4 |     "extends": "./base.json",
5 |     "compilerOptions": {
6 |       "jsx": "react-jsx"
7 |     }
8 |   }
```

packages/ui/package.json
```
1 | {
2 |   "name": "@midday/ui",
3 |   "version": "1.0.0",
4 |   "private": true,
5 |   "sideEffects": false,
6 |   "files": ["tailwind.config.ts", "postcss.config.js", "globals.css"],
7 |   "scripts": {
8 |     "clean": "rm -rf .turbo node_modules",
9 |     "lint": "biome check .",
10 |     "format": "biome --write .",
11 |     "typecheck": "tsc --noEmit"
12 |   },
13 |   "devDependencies": {
14 |     "autoprefixer": "^10.4.20",
15 |     "react": "18.3.1",
16 |     "react-dom": "18.3.1",
17 |     "typescript": "^5.6.3"
18 |   },
19 |   "exports": {
20 |     "./animated-size-container": "./src/components/animated-size-container.tsx",
21 |     "./accordion": "./src/components/accordion.tsx",
22 |     "./alert-dialog": "./src/components/alert-dialog.tsx",
23 |     "./breadcrumb": "./src/components/breadcrumb.tsx",
24 |     "./alert": "./src/components/alert.tsx",
25 |     "./chart": "./src/components/chart.tsx",
26 |     "./currency-input": "./src/components/currency-input.tsx",
27 |     "./submit-button": "./src/components/submit-button.tsx",
28 |     "./avatar": "./src/components/avatar.tsx",
29 |     "./button": "./src/components/button.tsx",
30 |     "./calendar": "./src/components/calendar.tsx",
31 |     "./card": "./src/components/card.tsx",
32 |     "./slider": "./src/components/slider.tsx",
33 |     "./carousel": "./src/components/carousel.tsx",
34 |     "./checkbox": "./src/components/checkbox.tsx",
35 |     "./collapsible": "./src/components/collapsible.tsx",
36 |     "./combobox": "./src/components/combobox.tsx",
37 |     "./combobox-dropdown": "./src/components/combobox-dropdown.tsx",
38 |     "./command": "./src/components/command.tsx",
39 |     "./context-menu": "./src/components/context-menu.tsx",
40 |     "./date-range-picker": "./src/components/date-range-picker.tsx",
41 |     "./dialog": "./src/components/dialog.tsx",
42 |     "./drawer": "./src/components/drawer.tsx",
43 |     "./dropdown-menu": "./src/components/dropdown-menu.tsx",
44 |     "./form": "./src/components/form.tsx",
45 |     "./editor": "./src/components/editor/index.tsx",
46 |     "./globals.css": "./src/globals.css",
47 |     "./hover-card": "./src/components/hover-card.tsx",
48 |     "./icons": "./src/components/icons.tsx",
49 |     "./input": "./src/components/input.tsx",
50 |     "./input-otp": "./src/components/input-otp.tsx",
51 |     "./label": "./src/components/label.tsx",
52 |     "./navigation-menu": "./src/components/navigation-menu.tsx",
53 |     "./popover": "./src/components/popover.tsx",
54 |     "./postcss": "./postcss.config.js",
55 |     "./progress": "./src/components/progress.tsx",
56 |     "./radio-group": "./src/components/radio-group.tsx",
57 |     "./scroll-area": "./src/components/scroll-area.tsx",
58 |     "./select": "./src/components/select.tsx",
59 |     "./sheet": "./src/components/sheet.tsx",
60 |     "./badge": "./src/components/badge.tsx",
61 |     "./separator": "./src/components/separator.tsx",
62 |     "./skeleton": "./src/components/skeleton.tsx",
63 |     "./spinner": "./src/components/spinner.tsx",
64 |     "./switch": "./src/components/switch.tsx",
65 |     "./multiple-selector": "./src/components/multiple-selector.tsx",
66 |     "./table": "./src/components/table.tsx",
67 |     "./tabs": "./src/components/tabs.tsx",
68 |     "./tailwind.config": "./tailwind.config.ts",
69 |     "./textarea": "./src/components/textarea.tsx",
70 |     "./toast": "./src/components/toast.tsx",
71 |     "./toaster": "./src/components/toaster.tsx",
72 |     "./tooltip": "./src/components/tooltip.tsx",
73 |     "./time-range-input": "./src/components/time-range-input.tsx",
74 |     "./use-toast": "./src/components/use-toast.tsx",
75 |     "./cn": "./src/utils/cn.ts",
76 |     "./truncate": "./src/utils/truncate.ts",
77 |     "./hooks": "./src/hooks/index.ts",
78 |     "./quantity-input": "./src/components/quantity-input.tsx"
79 |   },
80 |   "dependencies": {
81 |     "@mui/icons-material": "^6.1.6",
82 |     "@radix-ui/react-accordion": "^1.2.1",
83 |     "@radix-ui/react-alert-dialog": "^1.1.2",
84 |     "@radix-ui/react-avatar": "^1.1.1",
85 |     "@radix-ui/react-checkbox": "^1.1.2",
86 |     "@radix-ui/react-collapsible": "^1.1.1",
87 |     "@radix-ui/react-context-menu": "^2.2.2",
88 |     "@radix-ui/react-dialog": "^1.1.2",
89 |     "@radix-ui/react-dropdown-menu": "^2.1.2",
90 |     "@radix-ui/react-hover-card": "^1.1.2",
91 |     "@radix-ui/react-icons": "^1.3.0",
92 |     "@radix-ui/react-label": "^2.1.0",
93 |     "@radix-ui/react-navigation-menu": "^1.2.1",
94 |     "@radix-ui/react-popover": "^1.1.2",
95 |     "@radix-ui/react-progress": "^1.1.0",
96 |     "@radix-ui/react-radio-group": "^1.2.1",
97 |     "@radix-ui/react-scroll-area": "^1.2.0",
98 |     "@radix-ui/react-select": "^2.1.2",
99 |     "@radix-ui/react-separator": "^1.1.0",
100 |     "@radix-ui/react-slider": "^1.2.1",
101 |     "@radix-ui/react-slot": "^1.1.0",
102 |     "@radix-ui/react-switch": "^1.1.1",
103 |     "@radix-ui/react-tabs": "^1.1.1",
104 |     "@radix-ui/react-toast": "^1.2.2",
105 |     "@radix-ui/react-tooltip": "^1.1.3",
106 |     "@tiptap/extension-bold": "^2.9.1",
107 |     "@tiptap/extension-link": "^2.9.1",
108 |     "@tiptap/extension-placeholder": "^2.9.1",
109 |     "@tiptap/extension-underline": "^2.9.1",
110 |     "@tiptap/pm": "^2.9.1",
[TRUNCATED]
```

packages/ui/postcss.config.js
```
1 | module.exports = {
2 |   plugins: {
3 |     tailwindcss: {},
4 |     autoprefixer: {},
5 |   },
6 | };
```

packages/ui/tailwind.config.ts
```
1 | import type { Config } from "tailwindcss";
2 |
3 | export default {
4 |   darkMode: ["class"],
5 |   content: ["./src/**/*.{ts,tsx}"],
6 |   safelist: ["dark", "light"],
7 |   theme: {
8 |     extend: {
9 |       colors: {
10 |         fontFamily: {
11 |           sans: "var(--font-geist-sans)",
12 |           mono: "var(--font-geist-mono)",
13 |         },
14 |         border: "hsl(var(--border))",
15 |         input: "hsl(var(--input))",
16 |         ring: "hsl(var(--ring))",
17 |         background: "hsl(var(--background))",
18 |         foreground: "hsl(var(--foreground))",
19 |         primary: {
20 |           DEFAULT: "hsl(var(--primary))",
21 |           foreground: "hsl(var(--primary-foreground))",
22 |         },
23 |         secondary: {
24 |           DEFAULT: "hsl(var(--secondary))",
25 |           foreground: "hsl(var(--secondary-foreground))",
26 |         },
27 |         destructive: {
28 |           DEFAULT: "hsl(var(--destructive))",
29 |           foreground: "hsl(var(--destructive-foreground))",
30 |         },
31 |         muted: {
32 |           DEFAULT: "hsl(var(--muted))",
33 |           foreground: "hsl(var(--muted-foreground))",
34 |         },
35 |         accent: {
36 |           DEFAULT: "hsl(var(--accent))",
37 |           foreground: "hsl(var(--accent-foreground))",
38 |         },
39 |         popover: {
40 |           DEFAULT: "hsl(var(--popover))",
41 |           foreground: "hsl(var(--popover-foreground))",
42 |         },
43 |         card: {
44 |           DEFAULT: "hsl(var(--card))",
45 |           foreground: "hsl(var(--card-foreground))",
46 |         },
47 |       },
48 |       borderRadius: {
49 |         lg: "var(--radius)",
50 |         md: "calc(var(--radius) - 2px)",
51 |         sm: "calc(var(--radius) - 4px)",
52 |       },
53 |       keyframes: {
54 |         "accordion-down": {
55 |           from: { height: "0" },
56 |           to: { height: "var(--radix-accordion-content-height)" },
57 |         },
58 |         "accordion-up": {
59 |           from: { height: "var(--radix-accordion-content-height)" },
60 |           to: { height: "0" },
61 |         },
62 |         jiggle: {
63 |           "0%": {
64 |             transform: "rotate(-4deg)",
65 |           },
66 |           "50%": {
67 |             transform: "rotate(4deg)",
68 |           },
69 |         },
70 |         "caret-blink": {
71 |           "0%,70%,100%": { opacity: "1" },
72 |           "20%,50%": { opacity: "0" },
73 |         },
74 |         scroll: {
75 |           to: {
76 |             transform: "translate(calc(-50% - 0.5rem))",
77 |           },
78 |         },
79 |         moveHorizontal: {
80 |           "0%": {
81 |             transform: "translateX(-50%) translateY(-10%)",
82 |           },
83 |           "50%": {
84 |             transform: "translateX(50%) translateY(10%)",
85 |           },
86 |           "100%": {
87 |             transform: "translateX(-50%) translateY(-10%)",
88 |           },
89 |         },
90 |         moveInCircle: {
91 |           "0%": {
92 |             transform: "rotate(0deg)",
93 |           },
94 |           "50%": {
95 |             transform: "rotate(180deg)",
96 |           },
97 |           "100%": {
98 |             transform: "rotate(360deg)",
99 |           },
100 |         },
101 |         moveVertical: {
102 |           "0%": {
103 |             transform: "translateY(-50%)",
104 |           },
105 |           "50%": {
106 |             transform: "translateY(50%)",
107 |           },
108 |           "100%": {
109 |             transform: "translateY(-50%)",
110 |           },
111 |         },
112 |         "webgl-scale-in-fade": {
113 |           "0%": {
114 |             opacity: "0",
115 |             transform: "scale(.7)",
116 |           },
117 |           "100%": {
118 |             opacity: "1",
119 |             transform: "scale(1)",
120 |           },
121 |         },
122 |         "open-scale-up-fade": {
123 |           "0%": {
124 |             opacity: "0",
125 |             transform: "scale(.98) translateY(5px)",
126 |           },
127 |           "100%": {
128 |             opacity: "1",
129 |             transform: "scale(1) translateY(0)",
130 |           },
131 |         },
132 |       },
133 |       animation: {
134 |         "animate-webgl-scale-in-fade": "webgl-scale-in-fade 1s ease-in-out",
135 |         "open-scale-up-fade": "open-scale-up-fade",
136 |         "accordion-down": "accordion-down 0.2s ease-out",
137 |         "accordion-up": "accordion-up 0.2s ease-out",
138 |         "caret-blink": "caret-blink 1.25s ease-out infinite",
139 |         first: "moveVertical 30s ease infinite",
140 |         second: "moveInCircle 20s reverse infinite",
141 |         third: "moveInCircle 40s linear infinite",
142 |         fourth: "moveHorizontal 40s ease infinite",
143 |         fifth: "moveInCircle 20s ease infinite",
144 |         scroll:
145 |           "scroll var(--animation-duration, 40s) var(--animation-direction, forwards) linear infinite",
146 |       },
147 |       screens: {
148 |         "3xl": "1800px",
149 |       },
150 |     },
151 |   },
152 |   plugins: [require("tailwindcss-animate")],
153 | } satisfies Config;
```

packages/ui/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/react-library.json",
3 |   "compilerOptions": {
4 |     "baseUrl": ".",
5 |     "paths": {
6 |       "@/*": ["./src/*"]
7 |     }
8 |   },
9 |   "include": ["src"],
10 |   "exclude": ["node_modules"]
11 | }
```

packages/utils/package.json
```
1 | {
2 |   "name": "@midday/utils",
3 |   "version": "1.0.0",
4 |   "main": "src/index.ts",
5 |   "private": true,
6 |   "sideEffects": false,
7 |   "scripts": {
8 |     "clean": "rm -rf .turbo node_modules",
9 |     "lint": "biome check .",
10 |     "format": "biome --write .",
11 |     "typecheck": "tsc --noEmit"
12 |   },
13 |   "devDependencies": {
14 |     "typescript": "^5.5.4"
15 |   },
16 |   "exports": {
17 |     ".": "./src/index.ts",
18 |     "./envs": "./src/envs.ts",
19 |     "./format": "./src/format.ts"
20 |   }
21 | }
```

packages/utils/tsconfig.json
```
1 | {
2 |   "extends": "@midday/tsconfig/base.json",
3 |   "include": ["."],
4 |   "exclude": ["node_modules"]
5 | }
```

apps/api/supabase/config.toml
```
1 | project_id = "pytddvqiozwrhfbwqazp"
2 |
3 | [api]
4 | enabled = true
5 | port = 54321
6 | schemas = ["public", "storage"]
7 | extra_search_path = ["public", "extensions"]
8 | max_rows = 1000000
9 |
10 | [auth]
11 | site_url = "http://localhost:3001"
12 | additional_redirect_urls = ["https://localhost:3001", "http://localhost:54321/auth/v1/callback"]
13 | jwt_expiry = 36000
14 |
15 | [db]
16 | port = 54322
17 |
18 | [studio]
19 | port = 54323
20 |
21 | [auth.external.google]
22 | enabled = true
23 | client_id = "env(GOOGLE_CLIENT_ID)"
24 | secret = "env(GOOGLE_SECRET)"
25 | redirect_uri = "http://localhost:54321/auth/v1/callback"
26 |
27 | [auth.email]
28 | double_confirm_changes = true
29 | enable_confirmations = true
30 | enable_signup = true
31 |
32 | [analytics]
33 | enabled = true
34 | port = 54327
35 | vector_port = 54328
36 | backend = "postgres"
```

apps/dashboard/src/instrumentation.ts
```
1 | import * as Sentry from "@sentry/nextjs";
2 |
3 | // Errors from Nested React Server Components
4 | export const onRequestError = Sentry.captureRequestError;
5 |
6 | export async function register() {
7 |   if (process.env.NEXT_RUNTIME === "nodejs") {
8 |     await import("../sentry.server.config");
9 |   }
10 |
11 |   if (process.env.NEXT_RUNTIME === "edge") {
12 |     await import("../sentry.edge.config");
13 |   }
14 | }
```

apps/dashboard/src/middleware.ts
```
1 | import { updateSession } from "@midday/supabase/middleware";
2 | import { createClient } from "@midday/supabase/server";
3 | import { createI18nMiddleware } from "next-international/middleware";
4 | import { type NextRequest, NextResponse } from "next/server";
5 |
6 | const I18nMiddleware = createI18nMiddleware({
7 |   locales: ["en"],
8 |   defaultLocale: "en",
9 |   urlMappingStrategy: "rewrite",
10 | });
11 |
12 | export async function middleware(request: NextRequest) {
13 |   const response = await updateSession(request, I18nMiddleware(request));
14 |   const supabase = createClient();
15 |   const url = new URL("/", request.url);
16 |   const nextUrl = request.nextUrl;
17 |
18 |   const pathnameLocale = nextUrl.pathname.split("/", 2)?.[1];
19 |
20 |   // Remove the locale from the pathname
21 |   const pathnameWithoutLocale = pathnameLocale
22 |     ? nextUrl.pathname.slice(pathnameLocale.length + 1)
23 |     : nextUrl.pathname;
24 |
25 |   // Create a new URL without the locale in the pathname
26 |   const newUrl = new URL(pathnameWithoutLocale || "/", request.url);
27 |
28 |   const {
29 |     data: { session },
30 |   } = await supabase.auth.getSession();
31 |
32 |   // Not authenticated
33 |   if (
34 |     !session &&
35 |     newUrl.pathname !== "/login" &&
36 |     !newUrl.pathname.includes("/report") &&
37 |     !newUrl.pathname.includes("/i/")
38 |   ) {
39 |     const encodedSearchParams = `${newUrl.pathname.substring(1)}${
40 |       newUrl.search
41 |     }`;
42 |
43 |     const url = new URL("/login", request.url);
44 |
45 |     if (encodedSearchParams) {
46 |       url.searchParams.append("return_to", encodedSearchParams);
47 |     }
48 |
49 |     return NextResponse.redirect(url);
50 |   }
51 |
52 |   // If authenticated but no full_name redirect to user setup page
53 |   if (
54 |     newUrl.pathname !== "/setup" &&
55 |     newUrl.pathname !== "/teams/create" &&
56 |     session &&
57 |     !session?.user?.user_metadata?.full_name
58 |   ) {
59 |     // Check if the URL contains an invite code
60 |     const inviteCodeMatch = newUrl.pathname.startsWith("/teams/invite/");
61 |
62 |     if (inviteCodeMatch) {
63 |       return NextResponse.redirect(`${url.origin}${newUrl.pathname}`);
64 |     }
65 |
66 |     return NextResponse.redirect(`${url.origin}/setup`);
67 |   }
68 |
69 |   const { data: mfaData } =
70 |     await supabase.auth.mfa.getAuthenticatorAssuranceLevel();
71 |
72 |   // Enrolled for mfa but not verified
73 |   if (
74 |     mfaData &&
75 |     mfaData.nextLevel === "aal2" &&
76 |     mfaData.nextLevel !== mfaData.currentLevel &&
77 |     newUrl.pathname !== "/mfa/verify"
78 |   ) {
79 |     return NextResponse.redirect(`${url.origin}/mfa/verify`);
80 |   }
81 |
82 |   return response;
83 | }
84 |
85 | export const config = {
86 |   matcher: ["/((?!_next/static|_next/image|favicon.ico|api|monitoring).*)"],
87 | };
```

apps/engine/src/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { swaggerUI } from "@hono/swagger-ui";
3 | import { OpenAPIHono } from "@hono/zod-openapi";
4 | import { requestId } from "hono/request-id";
5 | import {
6 |   authMiddleware,
7 |   cacheMiddleware,
8 |   loggingMiddleware,
9 |   securityMiddleware,
10 | } from "./middleware";
11 | import accountRoutes from "./routes/accounts";
12 | import authRoutes from "./routes/auth";
13 | import connectionRoutes from "./routes/connections";
14 | import enrichRoutes from "./routes/enrich";
15 | import healthRoutes from "./routes/health";
16 | import institutionRoutes from "./routes/institutions";
17 | import ratesRoutes from "./routes/rates";
18 | import transactionsRoutes from "./routes/transactions";
19 |
20 | const app = new OpenAPIHono<{ Bindings: Bindings }>({
21 |   defaultHook: (result, c) => {
22 |     if (!result.success) {
23 |       return c.json({ success: false, errors: result.error.errors }, 422);
24 |     }
25 |   },
26 | });
27 |
28 | app.use("*", requestId());
29 | app.use(authMiddleware);
30 | app.use(securityMiddleware);
31 | app.use(loggingMiddleware);
32 | app.get("/institutions", cacheMiddleware);
33 | app.get("/rates", cacheMiddleware);
34 |
35 | app.openAPIRegistry.registerComponent("securitySchemes", "Bearer", {
36 |   type: "http",
37 |   scheme: "bearer",
38 | });
39 |
40 | app.get(
41 |   "/",
42 |   swaggerUI({
43 |     url: "/openapi",
44 |   }),
45 | );
46 |
47 | app.doc("/openapi", {
48 |   openapi: "3.1.0",
49 |   info: {
50 |     version: "1.0.0",
51 |     title: "Midday Engine API",
52 |   },
53 | });
54 |
55 | const appRoutes = app
56 |   .route("/transactions", transactionsRoutes)
57 |   .route("/accounts", accountRoutes)
58 |   .route("/institutions", institutionRoutes)
59 |   .route("/rates", ratesRoutes)
60 |   .route("/auth", authRoutes)
61 |   .route("/connections", connectionRoutes)
62 |   .route("/health", healthRoutes)
63 |   .route("/enrich", enrichRoutes);
64 |
65 | export type AppType = typeof appRoutes;
66 |
67 | export default app;
```

apps/engine/src/middleware.ts
```
1 | import type { Context, Next } from "hono";
2 | import { env } from "hono/adapter";
3 | import { bearerAuth } from "hono/bearer-auth";
4 | import { cache } from "hono/cache";
5 | import { logger } from "hono/logger";
6 | import { secureHeaders } from "hono/secure-headers";
7 | import { logger as customLogger } from "./utils/logger";
8 |
9 | const PUBLIC_PATHS = ["/", "/openapi", "/health"];
10 |
11 | const authMiddleware = (c: Context, next: Next) => {
12 |   if (PUBLIC_PATHS.includes(c.req.path)) {
13 |     return next();
14 |   }
15 |
16 |   const { API_SECRET_KEY } = env(c);
17 |
18 |   const bearer = bearerAuth({ token: API_SECRET_KEY });
19 |
20 |   return bearer(c, next);
21 | };
22 |
23 | const cacheMiddleware = (c: Context, next: Next) => {
24 |   if (process.env.NODE_ENV === "development") {
25 |     return next();
26 |   }
27 |
28 |   return cache({
29 |     cacheName: "engine",
30 |     cacheControl: "max-age=3600",
31 |   })(c, next);
32 | };
33 |
34 | const securityMiddleware = secureHeaders();
35 | const loggingMiddleware = logger(customLogger);
36 |
37 | export {
38 |   authMiddleware,
39 |   cacheMiddleware,
40 |   securityMiddleware,
41 |   loggingMiddleware,
42 | };
```

apps/engine/tasks/download-gocardless.ts
```
1 | import { getFileExtension } from "@/utils/logo";
2 | import { batchPromises, saveImageFromURL } from "./utils";
3 |
4 | const GO_CARDLESS_CDN = "https://cdn-logos.gocardless.com/ais/";
5 |
6 | async function main() {
7 |   const response = await fetch(
8 |     "https://bankaccountdata.gocardless.com/api/v2/institutions/",
9 |   );
10 |
11 |   const data = await response.json();
12 |
13 |   // @ts-ignore
14 |   const tasks = data?.map(async (institution) => {
15 |     const fileName = `${institution.id}.${getFileExtension(institution.logo)}`;
16 |
17 |     return saveImageFromURL(`${GO_CARDLESS_CDN}/${fileName}`, fileName);
18 |   });
19 |
20 |   await batchPromises(tasks);
21 | }
22 |
23 | main();
```

apps/engine/tasks/download-teller.ts
```
1 | import { batchPromises, getTellerData, saveImageFromURL } from "./utils";
2 |
3 | const TELLER_CDN = "https://teller.io/images/banks";
4 |
5 | async function main() {
6 |   const data = await getTellerData();
7 |
8 |   const tasks = data.map(async (institution) => {
9 |     const fileName = `${institution.id}.jpg`;
10 |
11 |     return saveImageFromURL(`${TELLER_CDN}/${fileName}`, fileName);
12 |   });
13 |
14 |   await batchPromises(tasks);
15 | }
16 |
17 | main();
```

apps/engine/tasks/get-institutions.ts
```
1 | import { GoCardLessApi } from "@/providers/gocardless/gocardless-api";
2 | import { PlaidApi } from "@/providers/plaid/plaid-api";
3 | import { getFileExtension, getLogoURL } from "@/utils/logo";
4 | import { getPopularity, getTellerData, matchLogoURL } from "./utils";
5 |
6 | export async function getGoCardLessInstitutions() {
7 |   const provider = new GoCardLessApi({
8 |     // @ts-ignore
9 |     envs: {
10 |       GOCARDLESS_SECRET_ID: process.env.GOCARDLESS_SECRET_ID!,
11 |       GOCARDLESS_SECRET_KEY: process.env.GOCARDLESS_SECRET_KEY!,
12 |     },
13 |   });
14 |
15 |   const data = await provider.getInstitutions();
16 |
17 |   return data.map((institution) => {
18 |     const ext = getFileExtension(institution.logo);
19 |
20 |     return {
21 |       id: institution.id,
22 |       name: institution.name,
23 |       logo: getLogoURL(institution.id, ext),
24 |       countries: institution.countries,
25 |       available_history: institution.transaction_total_days,
26 |       popularity: getPopularity(institution.id),
27 |       provider: "gocardless",
28 |     };
29 |   });
30 | }
31 |
32 | export async function getTellerInstitutions() {
33 |   const data = await getTellerData();
34 |
35 |   return data.map((institution) => ({
36 |     id: institution.id,
37 |     name: institution.name,
38 |     logo: getLogoURL(institution.id),
39 |     countries: ["US"],
40 |     popularity: getPopularity(institution.id) ?? 10, // Make Teller higher priority,
41 |     provider: "teller",
42 |   }));
43 | }
44 |
45 | export async function getPlaidInstitutions() {
46 |   const provider = new PlaidApi({
47 |     // @ts-ignore
48 |     envs: {
49 |       PLAID_CLIENT_ID: process.env.PLAID_CLIENT_ID!,
50 |       PLAID_SECRET: process.env.PLAID_SECRET!,
51 |     },
52 |   });
53 |
54 |   const data = await provider.getInstitutions();
55 |
56 |   return data.map((institution) => {
57 |     return {
58 |       id: institution.institution_id,
59 |       name: institution.name,
60 |       logo: institution.logo
61 |         ? getLogoURL(institution.institution_id)
62 |         : matchLogoURL(institution.institution_id),
63 |       countries: institution.country_codes,
64 |       popularity: getPopularity(institution.institution_id),
65 |       provider: "plaid",
66 |     };
67 |   });
68 | }
69 |
70 | export async function getInstitutions() {
71 |   const data = await Promise.all([
72 |     getGoCardLessInstitutions(),
73 |     getTellerInstitutions(),
74 |     getPlaidInstitutions(),
75 |   ]);
76 |
77 |   return data.flat();
78 | }
```

apps/engine/tasks/import.ts
```
1 | import Typesense from "typesense";
2 | import { getInstitutions } from "./get-institutions";
3 |
4 | const typesense = new Typesense.Client({
5 |   nodes: [
6 |     {
7 |       host: process.env.TYPESENSE_ENDPOINT!,
8 |       port: 443,
9 |       protocol: "https",
10 |     },
11 |   ],
12 |   apiKey: process.env.TYPESENSE_API_KEY!,
13 |   numRetries: 3,
14 |   connectionTimeoutSeconds: 120,
15 |   logLevel: "debug",
16 | });
17 |
18 | // const schema = {
19 | //   name: "institutions",
20 | //   num_documents: 0,
21 | //   fields: [
22 | //     {
23 | //       name: "name",
24 | //       type: "string",
25 | //       facet: false,
26 | //     },
27 | //     {
28 | //       name: "countries",
29 | //       type: "string[]",
30 | //       facet: true,
31 | //     },
32 | //     {
33 | //       name: "provider",
34 | //       type: "string",
35 | //       facet: true,
36 | //     },
37 | //     {
38 | //       name: "popularity",
39 | //       type: "int32",
40 | //       facet: false,
41 | //     },
42 | //   ],
43 | //   default_sorting_field: "popularity",
44 | // };
45 |
46 | async function main() {
47 |   const documents = await getInstitutions();
48 |
49 |   // await typesense.collections("institutions").delete();
50 |
51 |   try {
52 |     // await typesense.collections().create(schema);
53 |     await typesense
54 |       .collections("institutions")
55 |       .documents()
56 |       .import(documents, { action: "upsert" });
57 |   } catch (error) {
58 |     // @ts-ignore
59 |     console.log(error.importResults);
60 |   }
61 | }
62 |
63 | main();
```

apps/engine/tasks/utils.ts
```
1 | import fs from "node:fs";
2 | import path from "node:path";
3 | import { getLogoURL } from "@/utils/logo";
4 |
5 | const PRIORITY_INSTITUTIONS = [
6 |   // US
7 |   "chase", // Chase
8 |   "wells_fargo", // Wells Fargo
9 |   "bank_of_america", // Bank Of America
10 |   "pnc", // PNC
11 |   "credit_one", // CreditOne
12 |   "capital_one", // CapitalOne
13 |   "us_bank", // US Bank
14 |   "usaa", // USAA
15 |   "mercury", // Mercury
16 |   "citibank", // Citibank
17 |   "silicon_valley_bank", // Silicon Valley Bank
18 |   "first_republic", // First Republic
19 |   "brex", // Brex
20 |   "amex", // American Express
21 |   "ins_133680", // Angel List
22 |   "morgan_stanley", // Morgan Stanley
23 |   "truist", // Truist
24 |   "td_bank", // TD Bank
25 |   "ins_29", // KeyBank
26 |   "ins_19", // Regions Bank
27 |   "fifth_third", // Fifth Third Bank
28 |   "ins_111098", // Citizens Bank
29 |   "ins_100103", // Comerica Bank
30 |   "ins_21", // Huntington Bank
31 | ];
32 |
33 | export function getPopularity(id: string) {
34 |   if (PRIORITY_INSTITUTIONS.includes(id)) {
35 |     return 100 - PRIORITY_INSTITUTIONS.indexOf(id);
36 |   }
37 |
38 |   return 0;
39 | }
40 |
41 | export function matchLogoURL(id: string) {
42 |   switch (id) {
43 |     case "ins_56":
44 |       return getLogoURL("chase");
45 |     case "ins_127991":
46 |       return getLogoURL("wells_fargo");
47 |     case "ins_116236":
48 |       return getLogoURL("ins_116236");
49 |     case "ins_133019":
50 |       return getLogoURL("wise");
51 |     case "ins_126265":
52 |     case "ins_126523":
53 |     case "ins_115575":
54 |     case "ins_117163":
55 |       return getLogoURL("vancity");
56 |     case "ins_133354":
57 |       return getLogoURL("ins_133354");
58 |     case "ins_118853":
59 |       return getLogoURL("walmart");
60 |     case "ins_126283":
61 |       return getLogoURL("rocky");
62 |     case "ins_115771":
63 |       return getLogoURL("revelstoke");
64 |     case "ins_133347":
65 |       return getLogoURL("ins_133347");
66 |     case "ins_117642":
67 |       return getLogoURL("ins_117642");
68 |     case "ins_116219":
69 |       return getLogoURL("ins_116219");
70 |     case "ins_119478":
71 |       return getLogoURL("ins_119478");
72 |     case "ins_117634":
73 |       return getLogoURL("ins_117634");
74 |     case "ins_117635":
75 |       return getLogoURL("ins_117635");
76 |     case "ins_117600":
77 |       return getLogoURL("ins_117600");
78 |     case "ins_118849":
79 |     case "ins_129638":
80 |       return getLogoURL("ins_118849");
81 |     case "ins_116229":
82 |       return getLogoURL("ins_116229");
83 |     case "ins_117643":
84 |       return getLogoURL("ins_117643");
85 |     case "ins_118897":
86 |       return getLogoURL("ins_118897");
87 |     case "ins_119483":
88 |       return getLogoURL("ins_119483");
89 |     case "ins_119481":
90 |       return getLogoURL("ins_119481");
91 |     case "ins_117542":
92 |       return getLogoURL("ins_117542");
93 |     case "ins_116216":
94 |       return getLogoURL("ins_116216");
95 |     case "ins_118903":
96 |       return getLogoURL("ins_118903");
97 |     default:
98 |       return null;
99 |   }
100 | }
101 |
102 | export function saveImageFromString(base64String: string, filePath: string) {
103 |   const buffer = Buffer.from(base64String, "base64");
104 |
105 |   try {
106 |     fs.writeFileSync(filePath, buffer);
107 |     console.log(`Image saved successfully to ${filePath}`);
108 |   } catch (err) {
109 |     console.error(`Error saving image: ${err}`);
110 |   }
111 | }
112 |
113 | export async function saveImageFromURL(
114 |   url: string,
115 |   fileName: string,
116 | ): Promise<void> {
117 |   try {
118 |     const response = await fetch(url);
119 |
120 |     if (!response.ok) {
121 |       throw new Error(`Failed to fetch image: ${response.statusText}`);
122 |     }
123 |
124 |     const buffer = await response.arrayBuffer();
125 |
126 |     const fullPath = path.resolve(path.join("tasks", "logos", fileName));
127 |
128 |     // @ts-ignore
129 |     fs.writeFile(fullPath, buffer, (err) => {
130 |       if (err) {
131 |         throw new Error(`Failed to save image: ${err.message}`);
132 |       }
133 |       console.log(`Image saved to ${fullPath}`);
134 |     });
135 |   } catch (error) {
136 |     console.error(`Error: ${error}`);
137 |   }
138 | }
139 |
140 | export function saveFile(filePath: string, content: string) {
141 |   try {
142 |     fs.writeFileSync(filePath, content);
143 |     console.log(`File saved successfully to ${filePath}`);
144 |   } catch (err) {
145 |     console.error(`Error saving file: ${err}`);
146 |   }
147 | }
148 |
149 | const TELLER_ENDPOINT = "https://api.teller.io/institutions";
150 |
151 | type TellerResponse = {
152 |   id: string;
153 |   name: string;
154 |   capabilities: string[];
155 | };
156 |
157 | export async function getTellerData() {
158 |   const response = await fetch(TELLER_ENDPOINT);
159 |
160 |   const data = (await response.json()) as TellerResponse[];
161 |
[TRUNCATED]
```

packages/app-store/src/index.ts
```
1 | import calApp from "./cal/config";
2 | import fortnoxApp from "./fortnox/config";
3 | import quickBooksApp from "./quick-books/config";
4 | import raycastApp from "./raycast/config";
5 | import slackApp from "./slack/config";
6 | import vismaApp from "./visma/config";
7 | import xeroApp from "./xero/config";
8 | import zapierApp from "./zapier/config";
9 |
10 | export const apps = [
11 |   slackApp,
12 |   raycastApp,
13 |   quickBooksApp,
14 |   xeroApp,
15 |   calApp,
16 |   fortnoxApp,
17 |   vismaApp,
18 |   zapierApp,
19 | ];
```

packages/documents/src/client.ts
```
1 | import { ExpenseProcessor } from "./processors/expense/expense-processor";
2 | import { InvoiceProcessor } from "./processors/invoice/invoice-processor";
3 | import type {
4 |   DocumentClientParams,
5 |   GetDocumentRequest,
6 |   GetDocumentResponse,
7 | } from "./types";
8 |
9 | export class DocumentClient {
10 |   #processor;
11 |
12 |   constructor({ contentType }: DocumentClientParams) {
13 |     switch (contentType) {
14 |       case "application/pdf":
15 |         this.#processor = new InvoiceProcessor();
16 |         break;
17 |       default:
18 |         this.#processor = new ExpenseProcessor();
19 |     }
20 |   }
21 |
22 |   public async getDocument(
23 |     params: GetDocumentRequest,
24 |   ): Promise<GetDocumentResponse> {
25 |     return this.#processor.getDocument(params);
26 |   }
27 | }
```

packages/documents/src/index.ts
```
1 | export * from "./client";
2 | export * from "./prepare";
3 | export * from "./utils";
4 | export * from "./processors/layout";
```

packages/documents/src/interface.ts
```
1 | import type { GetDocumentRequest, GetDocumentResponse } from "./types";
2 |
3 | export interface Processor {
4 |   getDocument: (params: GetDocumentRequest) => Promise<GetDocumentResponse>;
5 | }
```

packages/documents/src/prepare.ts
```
1 | import { stripSpecialCharacters } from "@midday/utils";
2 | import { decode } from "base64-arraybuffer";
3 | import convert from "heic-convert";
4 | import sharp from "sharp";
5 | import type { Document, DocumentResponse } from "./types";
6 |
7 | const MAX_SIZE = 1500;
8 |
9 | export async function prepareDocument(
10 |   document: Document,
11 | ): Promise<DocumentResponse> {
12 |   const buffer = decode(document.Content);
13 |   const fileName = document.Name.split(".")?.at(0) ?? "File";
14 |   const sanitizedName = stripSpecialCharacters(fileName);
15 |
16 |   switch (document.ContentType) {
17 |     case "application/octet-stream":
18 |     case "application/pdf": {
19 |       return {
20 |         content: buffer,
21 |         mimeType: "application/pdf",
22 |         size: document.ContentLength,
23 |         name: fileName,
24 |         fileName: `${sanitizedName}.pdf`,
25 |       };
26 |     }
27 |     case "image/heic": {
28 |       const decodedImage = await convert({
29 |         // @ts-ignore
30 |         buffer: new Uint8Array(buffer),
31 |         format: "JPEG",
32 |         quality: 1,
33 |       });
34 |
35 |       const image = await sharp(decodedImage)
36 |         .rotate()
37 |         .resize({ width: MAX_SIZE })
38 |         .toFormat("jpeg")
39 |         .toBuffer();
40 |
41 |       return {
42 |         content: image,
43 |         mimeType: "image/jpeg",
44 |         size: image.byteLength,
45 |         name: fileName,
46 |         fileName: `${sanitizedName}.jpg`,
47 |       };
48 |     }
49 |     default: {
50 |       const image = await sharp(buffer)
51 |         .rotate()
52 |         .resize({ width: MAX_SIZE })
53 |         .toFormat("jpeg")
54 |         .toBuffer();
55 |
56 |       return {
57 |         content: image,
58 |         mimeType: "image/jpeg",
59 |         size: image.byteLength,
60 |         name: fileName,
61 |         fileName: `${sanitizedName}.jpg`,
62 |       };
63 |     }
64 |   }
65 | }
```

packages/documents/src/types.ts
```
1 | export type Document = {
2 |   Content: string;
3 |   ContentType: string;
4 |   ContentLength: number;
5 |   Name: string;
6 | };
7 |
8 | export type MimeType = "application/pdf" | "image/jpeg";
9 |
10 | export type DocumentResponse = {
11 |   content: Buffer | ArrayBuffer;
12 |   mimeType: MimeType;
13 |   size: number;
14 |   fileName: string;
15 |   name: string;
16 | };
17 |
18 | export type DocumentClientParams = {
19 |   contentType: string;
20 | };
21 |
22 | export type GetDocumentRequest = {
23 |   content: string;
24 | };
25 |
26 | export type GetDocumentResponse = {
27 |   name?: string | null;
28 |   date?: string | null;
29 |   amount?: number | null;
30 |   currency?: string | null;
31 |   website?: string | null;
32 |   type?: string | null;
33 |   description?: string | null;
34 | };
35 |
36 | export interface Attachment {
37 |   ContentLength: number;
38 |   Content: string;
39 |   Name: string;
40 |   ContentType: string;
41 |   ContentID: string;
42 | }
43 |
44 | export type Attachments = Attachment[];
```

packages/documents/src/utils.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import { getAllowedAttachments, getDomainFromEmail } from "./utils";
3 |
4 | test("Get domain from email", () => {
5 |   expect(getDomainFromEmail("invoice@supabase.com")).toMatch("supabase.com");
6 | });
7 |
8 | test("Should return 2 allowed attachments", () => {
9 |   expect(
10 |     getAllowedAttachments([
11 |       {
12 |         ContentLength: 51899,
13 |         Name: "DigitalOcean Invoice 2023 Apr (33-11).pdf",
14 |         ContentType: "application/pdf",
15 |         ContentID: "",
16 |         Content: "",
17 |       },
18 |       {
19 |         ContentLength: 51899,
20 |         Name: "Photo.jpg",
21 |         ContentType: "image/jpeg",
22 |         ContentID: "",
23 |         Content: "",
24 |       },
25 |       {
26 |         ContentLength: 673,
27 |         Name: "ergerwed",
28 |         ContentType: "application/pgp-keys",
29 |         ContentID: "",
30 |         Content: "",
31 |       },
32 |       {
33 |         ContentLength: 249,
34 |         Name: "wedwed",
35 |         ContentType: "application/pgp-signature",
36 |         ContentID: "",
37 |         Content: "",
38 |       },
39 |     ]),
40 |   ).toBeArrayOfSize(2);
41 | });
```

packages/documents/src/utils.ts
```
1 | import type { DocumentFieldOutput } from "@azure-rest/ai-document-intelligence";
2 | import type { Attachments } from "./types";
3 |
4 | export const allowedMimeTypes = [
5 |   "image/heic",
6 |   "image/png",
7 |   "image/jpeg",
8 |   "image/jpg",
9 |   "application/pdf",
10 |   "application/octet-stream",
11 | ];
12 |
13 | export function getAllowedAttachments(attachments?: Attachments) {
14 |   return attachments?.filter((attachment) =>
15 |     allowedMimeTypes.includes(attachment.ContentType),
16 |   );
17 | }
18 |
19 | export function getCurrency(field?: DocumentFieldOutput) {
20 |   return field?.valueCurrency?.currencyCode ?? "USD";
21 | }
22 |
23 | export function extractRootDomain(content?: string) {
24 |   const domainPattern =
25 |     /(?:https?:\/\/)?(?:www\.)?([a-zA-Z0-9-]+\.[a-zA-Z]{2,})(?:\/|$)/g;
26 |
27 |   const match = content?.match(domainPattern);
28 |
29 |   if (!match) {
30 |     return null;
31 |   }
32 |
33 |   const matchWithoutProtocol = match
34 |     .at(0)
35 |     ?.replace(/(?:https?:\/\/)?(?:www\.)?/, "");
36 |
37 |   const rootDomain = matchWithoutProtocol?.split("/").at(0);
38 |
39 |   return rootDomain;
40 | }
41 |
42 | export function getDomainFromEmail(email?: string | null): string | null {
43 |   const emailPattern = /^[^\s@]+@([^\s@]+)$/;
44 |   const match = email?.match(emailPattern);
45 |   const domain = match?.at(1);
46 |
47 |   if (!domain) return null;
48 |
49 |   const domainParts = domain.split(".");
50 |
51 |   if (domainParts.length > 2) {
52 |     return domainParts.slice(-2).join(".");
53 |   }
54 |
55 |   return domain;
56 | }
```

packages/email/components/column.tsx
```
1 | import { Img, Row, Section, Text } from "@react-email/components";
2 |
3 | type Props = {
4 |   title: string;
5 |   description: string;
6 |   imgSrc: string;
7 |   footer?: string;
8 | };
9 |
10 | export function Column({ title, description, footer, imgSrc }: Props) {
11 |   return (
12 |     <Section className="text-left p-0 m-0 text-left">
13 |       <Section className="p-0 m-0 w-full w-full w-[265px] inline-block align-top box-border mb-4 md:mb-0 text-left">
14 |         <Section className="text-left p-0 m-0 pb-10">
15 |           <Img src={imgSrc} alt={title} className="w-[245px]" />
16 |         </Section>
17 |       </Section>
18 |       <Section className="inline-block align-top box-border w-full w-[280px] text-left">
19 |         <Section className="text-left p-0 m-0">
20 |           <Text className="pt-0 m-0 font-medium mb-2">{title}</Text>
21 |           <Text className="text-[#707070] p-0 m-0">{description}</Text>
22 |           <Text className="text-[#707070] p-0 mt-2">{footer}</Text>
23 |         </Section>
24 |       </Section>
25 |     </Section>
26 |   );
27 | }
```

packages/email/components/dual-column.tsx
```
1 | import { Section } from "@react-email/section";
2 | import type React from "react";
3 |
4 | interface DualColumnProps {
5 |   styles?: Omit<
6 |     React.CSSProperties,
7 |     "padding" | "paddingLeft" | "paddingRight" | "paddingTop" | "paddingBottom"
8 |   >;
9 |   pX?: number;
10 |   pY?: number;
11 |   columnOneContent: React.ReactNode;
12 |   columnOneStyles?: React.CSSProperties;
13 |   columnTwoContent: React.ReactNode;
14 |   columnTwoStyles?: React.CSSProperties;
15 | }
16 |
17 | export const DualColumn: React.FC<DualColumnProps> = ({
18 |   pX = 0,
19 |   pY = 0,
20 |   columnOneContent,
21 |   columnTwoContent,
22 |   columnOneStyles,
23 |   columnTwoStyles,
24 |   styles,
25 | }) => {
26 |   const colMaxWidth = pX ? (600 - 2 * pX) / 2 : 600 / 2;
27 |
28 |   return (
29 |     <Section
30 |     //   style={{ ...twoColumnWrapper, ...styles, padding: `${pY}px ${pX}px` }}
31 |     >
32 |       <Section
33 |         style={{
34 |           //   ...twoColumnCol,
35 |           ...columnOneStyles,
36 |           maxWidth: colMaxWidth,
37 |         }}
38 |       >
39 |         {columnOneContent}
40 |       </Section>
41 |       <Section
42 |       // style={{ ...twoColumnCol, ...columnTwoStyles, maxWidth: colMaxWidth }}
43 |       >
44 |         {columnTwoContent}
45 |       </Section>
46 |     </Section>
47 |   );
48 | };
```

packages/email/components/footer.tsx
```
1 | import { getEmailUrl } from "@midday/utils/envs";
2 | import {
3 |   Column,
4 |   Hr,
5 |   Img,
6 |   Link,
7 |   Row,
8 |   Section,
9 |   Text,
10 | } from "@react-email/components";
11 | import { TripleColumn } from "responsive-react-email";
12 |
13 | const baseUrl = getEmailUrl();
14 |
15 | export function Footer() {
16 |   return (
17 |     <Section className="w-full">
18 |       <Hr />
19 |
20 |       <br />
21 |
22 |       <Text className="text-[21px] font-regular">
23 |         Run your business smarter.
24 |       </Text>
25 |
26 |       <br />
27 |
28 |       <TripleColumn
29 |         pX={0}
30 |         pY={0}
31 |         styles={{ textAlign: "left" }}
32 |         columnOneContent={
33 |           <Section className="text-left p-0 m-0">
34 |             <Row>
35 |               <Text className="font-medium">Features</Text>
36 |             </Row>
37 |
38 |             <Row className="mb-1.5">
39 |               <Link
40 |                 className="text-[#707070] text-[14px]"
41 |                 href="https://go.midday.ai/bOp4NOx"
42 |               >
43 |                 Overview
44 |               </Link>
45 |             </Row>
46 |             <Row className="mb-1.5">
47 |               <Link
48 |                 className="text-[#707070] text-[14px]"
49 |                 href="https://go.midday.ai/VFcNsmQ"
50 |               >
51 |                 Inbox
52 |               </Link>
53 |             </Row>
54 |             <Row className="mb-1.5">
55 |               <Link
56 |                 className="text-[#707070] text-[14px]"
57 |                 href="https://go.midday.ai/uA06kWO"
58 |               >
59 |                 Vault
60 |               </Link>
61 |             </Row>
62 |             <Row className="mb-1.5">
63 |               <Link
64 |                 className="text-[#707070] text-[14px]"
65 |                 href="https://go.midday.ai/x7Fow9L"
66 |               >
67 |                 Tracker
68 |               </Link>
69 |             </Row>
70 |
71 |             <Row className="mb-1.5">
72 |               <Link
73 |                 className="text-[#707070] text-[14px]"
74 |                 href="https://go.midday.ai/fkYXc95"
75 |               >
76 |                 Invoice
77 |               </Link>
78 |             </Row>
79 |
80 |             <Row className="mb-1.5">
81 |               <Link
82 |                 className="text-[#707070] text-[14px]"
83 |                 href="https://go.midday.ai/dEnP9h5"
84 |               >
85 |                 Pricing
86 |               </Link>
87 |             </Row>
88 |
89 |             <Row className="mb-1.5">
90 |               <Link
91 |                 className="text-[#707070] text-[14px]"
92 |                 href="https://go.midday.ai/E24P3oY"
93 |               >
94 |                 Engine
95 |               </Link>
96 |             </Row>
97 |
98 |             <Row className="mb-1.5">
99 |               <Link
100 |                 className="text-[#707070] text-[14px]"
101 |                 href="https://midday.ai/download"
102 |               >
103 |                 Download
104 |               </Link>
105 |             </Row>
106 |           </Section>
107 |         }
108 |         columnOneStyles={{ paddingRight: 0, paddingLeft: 0, width: 185 }}
109 |         columnTwoContent={
110 |           <Section className="text-left p-0 m-0">
111 |             <Row>
112 |               <Text className="font-medium">Resources</Text>
113 |             </Row>
114 |             <Row className="mb-1.5">
115 |               <Link
116 |                 className="text-[#707070] text-[14px]"
117 |                 href="https://go.midday.ai/fhEy5CL"
118 |               >
119 |                 Homepage
120 |               </Link>
121 |             </Row>
122 |             <Row className="mb-1.5">
123 |               <Link
124 |                 className="text-[#707070] text-[14px]"
125 |                 href="https://git.new/midday"
126 |               >
127 |                 Github
128 |               </Link>
129 |             </Row>
130 |             <Row className="mb-1.5">
131 |               <Link
132 |                 className="text-[#707070] text-[14px]"
133 |                 href="https://go.midday.ai/ZrhEMbR"
134 |               >
135 |                 Support
136 |               </Link>
137 |             </Row>
138 |             <Row className="mb-1.5">
139 |               <Link
140 |                 className="text-[#707070] text-[14px]"
141 |                 href="https://go.midday.ai/rofdWKi"
142 |               >
143 |                 Terms of service
144 |               </Link>
145 |             </Row>
146 |             <Row className="mb-1.5">
147 |               <Link
148 |                 className="text-[#707070] text-[14px]"
149 |                 href="https://go.midday.ai/TJIL5mQ"
150 |               >
151 |                 Privacy policy
152 |               </Link>
153 |             </Row>
154 |
155 |             <Row className="mb-1.5">
156 |               <Link
157 |                 className="text-[#707070] text-[14px]"
158 |                 href="https://go.midday.ai/IQ1kcN0"
159 |               >
160 |                 Branding
161 |               </Link>
162 |             </Row>
163 |
164 |             <Row className="mb-1.5">
165 |               <Link
166 |                 className="text-[#707070] text-[14px]"
167 |                 href="https://go.midday.ai/x5ohOs7"
168 |               >
169 |                 Feature Request
170 |               </Link>
171 |             </Row>
172 |           </Section>
173 |         }
[TRUNCATED]
```

packages/email/components/get-started.tsx
```
1 | import { Button, Section } from "@react-email/components";
2 |
3 | export function GetStarted() {
4 |   return (
5 |     <Section className="text-center mt-[50px] mb-[50px]">
6 |       <Button
7 |         className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
8 |         href="https://go.midday.ai/VmJhYxE"
9 |       >
10 |         Get started
11 |       </Button>
12 |     </Section>
13 |   );
14 | }
```

packages/email/components/logo.tsx
```
1 | import { getEmailUrl } from "@midday/utils/envs";
2 | import { Img, Section } from "@react-email/components";
3 |
4 | const baseUrl = getEmailUrl();
5 |
6 | export function Logo() {
7 |   return (
8 |     <Section className="mt-[32px]">
9 |       <Img
10 |         src={`${baseUrl}/email/logo.png`}
11 |         width="45"
12 |         height="45"
13 |         alt="Midday"
14 |         className="my-0 mx-auto block"
15 |       />
16 |     </Section>
17 |   );
18 | }
```

packages/email/emails/connection-expire.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { addDays, formatDistance } from "date-fns";
14 | import { Footer } from "../components/footer";
15 | import { Logo } from "../components/logo";
16 |
17 | interface Props {
18 |   fullName: string;
19 |   expiresAt: string;
20 |   bankName: string;
21 |   teamName: string;
22 | }
23 |
24 | export const ConnectionExpireEmail = ({
25 |   fullName = "Viktor Hofte",
26 |   expiresAt = addDays(new Date(), 4).toISOString(),
27 |   bankName = "Revolut",
28 |   teamName = "Midday",
29 | }: Props) => {
30 |   const firstName = fullName.split(" ").at(0);
31 |   const text = `Hi ${firstName}, We wanted to inform you that our connection to your bank ${bankName} for your team ${teamName} will expire in ${formatDistance(new Date(expiresAt), new Date())}.`;
32 |
33 |   return (
34 |     <Html>
35 |       <Tailwind>
36 |         <head>
37 |           <Font
38 |             fontFamily="Geist"
39 |             fallbackFontFamily="Helvetica"
40 |             webFont={{
41 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
42 |               format: "woff2",
43 |             }}
44 |             fontWeight={400}
45 |             fontStyle="normal"
46 |           />
47 |
48 |           <Font
49 |             fontFamily="Geist"
50 |             fallbackFontFamily="Helvetica"
51 |             webFont={{
52 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
53 |               format: "woff2",
54 |             }}
55 |             fontWeight={500}
56 |             fontStyle="normal"
57 |           />
58 |         </head>
59 |         <Preview>{text}</Preview>
60 |
61 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
62 |           <Container
63 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
64 |             style={{ borderStyle: "solid", borderWidth: 1 }}
65 |           >
66 |             <Logo />
67 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
68 |               Bank Connection Expiring Soon
69 |             </Heading>
70 |
71 |             <br />
72 |
73 |             <span className="font-medium">Hi {firstName},</span>
74 |             <Text className="text-[#121212]">
75 |               We hope you're having a great day!
76 |               <br />
77 |               <br />
78 |               We wanted to inform you that our connection to your bank{" "}
79 |               <strong>{bankName}</strong> for your team{" "}
80 |               <strong>{teamName}</strong> will expire in{" "}
81 |               {formatDistance(new Date(expiresAt), new Date())}. To ensure that
82 |               Midday continues to run smoothly, please reconnect your bank.
83 |               <br />
84 |               <br />
85 |               The good news? It only takes 60 seconds to get everything back on
86 |               track!
87 |             </Text>
88 |
89 |             <Section className="text-center mt-[50px] mb-[50px]">
90 |               <Button
91 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
92 |                 href="https://go.midday.ai/34Xt7XK"
93 |               >
94 |                 Reconnect
95 |               </Button>
96 |             </Section>
97 |
98 |             <Text className="text-[#121212]">
99 |               If you have any questions, please don't hesitate to reach out by
100 |               just replying to this email.
101 |             </Text>
102 |
103 |             <br />
104 |
105 |             <Footer />
106 |           </Container>
107 |         </Body>
108 |       </Tailwind>
109 |     </Html>
110 |   );
111 | };
112 |
113 | export default ConnectionExpireEmail;
```

packages/email/emails/connection-issue.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   fullName: string;
18 |   bankName: string;
19 |   teamName: string;
20 | }
21 |
22 | export const ConnectionIssueEmail = ({
23 |   fullName = "Viktor Hofte",
24 |   bankName = "Revolut",
25 |   teamName = "Midday",
26 | }: Props) => {
27 |   const firstName = fullName.split(" ").at(0);
28 |   const text = `Hi ${firstName}, We wanted to inform you that our connection to your bank ${bankName} for your team ${teamName} is currently disconnected.`;
29 |
30 |   return (
31 |     <Html>
32 |       <Tailwind>
33 |         <head>
34 |           <Font
35 |             fontFamily="Geist"
36 |             fallbackFontFamily="Helvetica"
37 |             webFont={{
38 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
39 |               format: "woff2",
40 |             }}
41 |             fontWeight={400}
42 |             fontStyle="normal"
43 |           />
44 |
45 |           <Font
46 |             fontFamily="Geist"
47 |             fallbackFontFamily="Helvetica"
48 |             webFont={{
49 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
50 |               format: "woff2",
51 |             }}
52 |             fontWeight={500}
53 |             fontStyle="normal"
54 |           />
55 |         </head>
56 |         <Preview>{text}</Preview>
57 |
58 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
59 |           <Container
60 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
61 |             style={{ borderStyle: "solid", borderWidth: 1 }}
62 |           >
63 |             <Logo />
64 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
65 |               Bank Connection Issue
66 |             </Heading>
67 |
68 |             <br />
69 |
70 |             <span className="font-medium">Hi {firstName},</span>
71 |             <Text className="text-[#121212]">
72 |               We hope you're having a great day!
73 |               <br />
74 |               <br />
75 |               We wanted to let you know that your bank{" "}
76 |               <strong>{bankName}</strong> for team <strong>{teamName}</strong>{" "}
77 |               is currently disconnected. To keep Midday running smoothly, we'll
78 |               need you to reconnect your bank.
79 |               <br />
80 |               <br />
81 |               The good news? It only takes 60 seconds to get everything back on
82 |               track!
83 |             </Text>
84 |
85 |             <Section className="text-center mt-[50px] mb-[50px]">
86 |               <Button
87 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
88 |                 href="https://go.midday.ai/34Xt7XK"
89 |               >
90 |                 Reconnect
91 |               </Button>
92 |             </Section>
93 |
94 |             <Text className="text-[#121212]">
95 |               If you have any questions, please don't hesitate to reach out by
96 |               just replying to this email.
97 |             </Text>
98 |
99 |             <br />
100 |
101 |             <Footer />
102 |           </Container>
103 |         </Body>
104 |       </Tailwind>
105 |     </Html>
106 |   );
107 | };
108 |
109 | export default ConnectionIssueEmail;
```

packages/email/emails/invite.tsx
```
1 | import { getAppUrl } from "@midday/utils/envs";
2 | import {
3 |   Body,
4 |   Button,
5 |   Container,
6 |   Font,
7 |   Head,
8 |   Heading,
9 |   Html,
10 |   Link,
11 |   Preview,
12 |   Section,
13 |   Tailwind,
14 |   Text,
15 | } from "@react-email/components";
16 | import { Footer } from "../components/footer";
17 | import { Logo } from "../components/logo";
18 | import { getI18n } from "../locales";
19 |
20 | interface Props {
21 |   email?: string;
22 |   invitedByEmail?: string;
23 |   invitedByName?: string;
24 |   teamName?: string;
25 |   inviteCode?: string;
26 |   ip?: string;
27 |   location?: string;
28 |   locale: string;
29 | }
30 |
31 | const baseAppUrl = getAppUrl();
32 |
33 | export const InviteEmail = ({
34 |   invitedByEmail = "bukinoshita@example.com",
35 |   invitedByName = "Pontus Abrahamsson",
36 |   email = "pontus@lostisland.co",
37 |   teamName = "Acme Co",
38 |   inviteCode = "jnwe9203frnwefl239jweflasn1230oqef",
39 |   ip = "204.13.186.218",
40 |   location = "São Paulo, Brazil",
41 |   locale = "en",
42 | }: Props) => {
43 |   const { t } = getI18n({ locale });
44 |   const inviteLink = `${baseAppUrl}/teams/invite/${inviteCode}`;
45 |
46 |   return (
47 |     <Html>
48 |       <Tailwind>
49 |         <head>
50 |           <Font
51 |             fontFamily="Geist"
52 |             fallbackFontFamily="Helvetica"
53 |             webFont={{
54 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
55 |               format: "woff2",
56 |             }}
57 |             fontWeight={400}
58 |             fontStyle="normal"
59 |           />
60 |
61 |           <Font
62 |             fontFamily="Geist"
63 |             fallbackFontFamily="Helvetica"
64 |             webFont={{
65 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
66 |               format: "woff2",
67 |             }}
68 |             fontWeight={500}
69 |             fontStyle="normal"
70 |           />
71 |         </head>
72 |         <Preview>{t("invite.preview", { teamName })}</Preview>
73 |
74 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
75 |           <Container
76 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
77 |             style={{ borderStyle: "solid", borderWidth: 1 }}
78 |           >
79 |             <Logo />
80 |             <Heading className="mx-0 my-[30px] p-0 text-[24px] font-normal text-[#121212] text-center">
81 |               {t("invite.title1")} <strong>{teamName}</strong>{" "}
82 |               {t("invite.title2")} <strong>Midday</strong>
83 |             </Heading>
84 |
85 |             <Text className="text-[14px] leading-[24px] text-[#121212]">
86 |               {invitedByName} (
87 |               <Link
88 |                 href={`mailto:${invitedByEmail}`}
89 |                 className="text-[#121212] no-underline"
90 |               >
91 |                 {invitedByEmail}
92 |               </Link>
93 |               ) {t("invite.link1")} <strong>{teamName}</strong>{" "}
94 |               {t("invite.link2")} <strong>Midday</strong>.
95 |             </Text>
96 |             <Section className="mb-[42px] mt-[32px] text-center">
97 |               <Button
98 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
99 |                 href={inviteLink}
100 |               >
101 |                 {t("invite.join")}
102 |               </Button>
103 |             </Section>
104 |
105 |             <Text className="text-[14px] leading-[24px] text-[#707070] break-all">
106 |               {t("invite.link3")}:{" "}
107 |               <Link href={inviteLink} className="text-[#707070] underline">
108 |                 {inviteLink}
109 |               </Link>
110 |             </Text>
111 |
112 |             <br />
113 |             <Section>
114 |               <Text className="text-[12px] leading-[24px] text-[#666666]">
115 |                 {t("invite.footer1")}{" "}
116 |                 <span className="text-[#121212] ">{email}</span>.{" "}
117 |                 {t("invite.footer2")}{" "}
118 |                 <span className="text-[#121212] ">{ip}</span>{" "}
119 |                 {t("invite.footer3")}{" "}
120 |                 <span className="text-[#121212] ">{location}</span>.{" "}
121 |                 {t("invite.footer4")}
122 |               </Text>
123 |             </Section>
124 |
125 |             <br />
126 |
127 |             <Footer />
128 |           </Container>
129 |         </Body>
130 |       </Tailwind>
131 |     </Html>
132 |   );
133 | };
134 |
135 | export default InviteEmail;
```

packages/email/emails/invoice-comment.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   invoiceNumber: string;
18 |   link: string;
19 | }
20 |
21 | export const InvoiceCommentEmail = ({
22 |   invoiceNumber = "INV-0001",
23 |   link = "https://app.midday.ai/i/1234567890",
24 | }: Props) => {
25 |   const text = `New comment on Invoice ${invoiceNumber}`;
26 |
27 |   return (
28 |     <Html>
29 |       <Tailwind>
30 |         <head>
31 |           <Font
32 |             fontFamily="Geist"
33 |             fallbackFontFamily="Helvetica"
34 |             webFont={{
35 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
36 |               format: "woff2",
37 |             }}
38 |             fontWeight={400}
39 |             fontStyle="normal"
40 |           />
41 |
42 |           <Font
43 |             fontFamily="Geist"
44 |             fallbackFontFamily="Helvetica"
45 |             webFont={{
46 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
47 |               format: "woff2",
48 |             }}
49 |             fontWeight={500}
50 |             fontStyle="normal"
51 |           />
52 |         </head>
53 |         <Preview>{text}</Preview>
54 |
55 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
56 |           <Container
57 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
58 |             style={{ borderStyle: "solid", borderWidth: 1 }}
59 |           >
60 |             <Logo />
61 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
62 |               New comment on Invoice <br /> {invoiceNumber}
63 |             </Heading>
64 |
65 |             <br />
66 |
67 |             <Text className="text-[#121212]">
68 |               Check the latest update on your invoice and respond directly by
69 |               viewing the invoice.
70 |             </Text>
71 |
72 |             <Section className="text-center mt-[50px] mb-[50px]">
73 |               <Button
74 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
75 |                 href={link}
76 |               >
77 |                 View invoice
78 |               </Button>
79 |             </Section>
80 |
81 |             <br />
82 |
83 |             <Footer />
84 |           </Container>
85 |         </Body>
86 |       </Tailwind>
87 |     </Html>
88 |   );
89 | };
90 |
91 | export default InvoiceCommentEmail;
```

packages/email/emails/invoice-overdue.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   customerName: string;
18 |   invoiceNumber: string;
19 |   link: string;
20 | }
21 |
22 | export const InvoiceOverdueEmail = ({
23 |   customerName = "Customer",
24 |   invoiceNumber = "INV-0001",
25 |   link = "https://app.midday.ai/invoices?invoiceId=40b25275-258c-48e0-9678-57324cd770a6&type=details",
26 | }: Props) => {
27 |   const text = `Invoice ${invoiceNumber} is now overdue`;
28 |
29 |   return (
30 |     <Html>
31 |       <Tailwind>
32 |         <head>
33 |           <Font
34 |             fontFamily="Geist"
35 |             fallbackFontFamily="Helvetica"
36 |             webFont={{
37 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
38 |               format: "woff2",
39 |             }}
40 |             fontWeight={400}
41 |             fontStyle="normal"
42 |           />
43 |
44 |           <Font
45 |             fontFamily="Geist"
46 |             fallbackFontFamily="Helvetica"
47 |             webFont={{
48 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
49 |               format: "woff2",
50 |             }}
51 |             fontWeight={500}
52 |             fontStyle="normal"
53 |           />
54 |         </head>
55 |         <Preview>{text}</Preview>
56 |
57 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
58 |           <Container
59 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
60 |             style={{ borderStyle: "solid", borderWidth: 1 }}
61 |           >
62 |             <Logo />
63 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
64 |               Invoice {invoiceNumber} <br />
65 |               is now overdue
66 |             </Heading>
67 |
68 |             <br />
69 |
70 |             <Text className="text-[#121212]">
71 |               Invoice <span className="font-medium">{invoiceNumber}</span> to{" "}
72 |               <span className="font-medium">{customerName}</span> is now
73 |               overdue. We've checked your account but haven't found a matching
74 |               transaction.
75 |               <br />
76 |               <br />
77 |               Please review the invoice details page to verify if payment has
78 |               been made through another method.
79 |               <br />
80 |               <br />
81 |               If needed, you can send a payment reminder to your customer or
82 |               update the invoice status manually if it has already been paid.
83 |               <br />
84 |               <br />
85 |             </Text>
86 |
87 |             <Section className="text-center mt-[50px] mb-[50px]">
88 |               <Button
89 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
90 |                 href={link}
91 |               >
92 |                 View invoice details
93 |               </Button>
94 |             </Section>
95 |
96 |             <br />
97 |
98 |             <Footer />
99 |           </Container>
100 |         </Body>
101 |       </Tailwind>
102 |     </Html>
103 |   );
104 | };
105 |
106 | export default InvoiceOverdueEmail;
```

packages/email/emails/invoice-paid.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   invoiceNumber: string;
18 |   link: string;
19 | }
20 |
21 | export const InvoicePaidEmail = ({
22 |   invoiceNumber = "INV-0001",
23 |   link = "https://app.midday.ai/invoices?invoiceId=40b25275-258c-48e0-9678-57324cd770a6&type=details",
24 | }: Props) => {
25 |   const text = `Invoice ${invoiceNumber} has been paid`;
26 |
27 |   return (
28 |     <Html>
29 |       <Tailwind>
30 |         <head>
31 |           <Font
32 |             fontFamily="Geist"
33 |             fallbackFontFamily="Helvetica"
34 |             webFont={{
35 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
36 |               format: "woff2",
37 |             }}
38 |             fontWeight={400}
39 |             fontStyle="normal"
40 |           />
41 |
42 |           <Font
43 |             fontFamily="Geist"
44 |             fallbackFontFamily="Helvetica"
45 |             webFont={{
46 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
47 |               format: "woff2",
48 |             }}
49 |             fontWeight={500}
50 |             fontStyle="normal"
51 |           />
52 |         </head>
53 |         <Preview>{text}</Preview>
54 |
55 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
56 |           <Container
57 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
58 |             style={{ borderStyle: "solid", borderWidth: 1 }}
59 |           >
60 |             <Logo />
61 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
62 |               Invoice {invoiceNumber} <br /> has been Paid
63 |             </Heading>
64 |
65 |             <br />
66 |
67 |             <Text className="text-[#121212]">
68 |               Great news! We found a matching transaction for this invoice in
69 |               your account and have marked it accordingly.
70 |               <br />
71 |               <br />
72 |               The invoice has been linked to the transaction in your records.
73 |               Please take a moment to check that everything looks right.
74 |             </Text>
75 |
76 |             <Section className="text-center mt-[50px] mb-[50px]">
77 |               <Button
78 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
79 |                 href={link}
80 |               >
81 |                 View invoice details
82 |               </Button>
83 |             </Section>
84 |
85 |             <br />
86 |
87 |             <Footer />
88 |           </Container>
89 |         </Body>
90 |       </Tailwind>
91 |     </Html>
92 |   );
93 | };
94 |
95 | export default InvoicePaidEmail;
```

packages/email/emails/invoice-reminder.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   companyName: string;
18 |   teamName: string;
19 |   invoiceNumber: string;
20 |   link: string;
21 | }
22 |
23 | export const InvoiceReminderEmail = ({
24 |   companyName = "Customer",
25 |   teamName = "Midday",
26 |   invoiceNumber = "INV-0001",
27 |   link = "https://app.midday.ai/i/1234567890",
28 | }: Props) => {
29 |   const text = `Reminder: Payment for ${invoiceNumber}`;
30 |
31 |   return (
32 |     <Html>
33 |       <Tailwind>
34 |         <head>
35 |           <Font
36 |             fontFamily="Geist"
37 |             fallbackFontFamily="Helvetica"
38 |             webFont={{
39 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
40 |               format: "woff2",
41 |             }}
42 |             fontWeight={400}
43 |             fontStyle="normal"
44 |           />
45 |
46 |           <Font
47 |             fontFamily="Geist"
48 |             fallbackFontFamily="Helvetica"
49 |             webFont={{
50 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
51 |               format: "woff2",
52 |             }}
53 |             fontWeight={500}
54 |             fontStyle="normal"
55 |           />
56 |         </head>
57 |         <Preview>{text}</Preview>
58 |
59 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
60 |           <Container
61 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
62 |             style={{ borderStyle: "solid", borderWidth: 1 }}
63 |           >
64 |             <Logo />
65 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
66 |               Payment Reminder: Invoice {invoiceNumber} <br />
67 |               from {teamName}
68 |             </Heading>
69 |
70 |             <br />
71 |
72 |             <span className="font-medium">Hi {companyName},</span>
73 |             <Text className="text-[#121212]">
74 |               This is a friendly reminder about your pending invoice. We kindly
75 |               ask you to review and process the payment at your earliest
76 |               convenience. If you have any questions or need clarification,
77 |               please don't hesitate to reply to this email.
78 |             </Text>
79 |
80 |             <Section className="text-center mt-[50px] mb-[50px]">
81 |               <Button
82 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
83 |                 href={link}
84 |               >
85 |                 View invoice
86 |               </Button>
87 |             </Section>
88 |
89 |             <br />
90 |
91 |             <Footer />
92 |           </Container>
93 |         </Body>
94 |       </Tailwind>
95 |     </Html>
96 |   );
97 | };
98 |
99 | export default InvoiceReminderEmail;
```

packages/email/emails/invoice.tsx
```
1 | import {
2 |   Body,
3 |   Button,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Preview,
9 |   Section,
10 |   Tailwind,
11 |   Text,
12 | } from "@react-email/components";
13 | import { Footer } from "../components/footer";
14 | import { Logo } from "../components/logo";
15 |
16 | interface Props {
17 |   customerName: string;
18 |   teamName: string;
19 |   link: string;
20 | }
21 |
22 | export const InvoiceEmail = ({
23 |   customerName = "Customer",
24 |   teamName = "Midday",
25 |   link = "https://app.midday.ai/i/1234567890",
26 | }: Props) => {
27 |   const text = `You’ve Received an Invoice from ${teamName}`;
28 |
29 |   return (
30 |     <Html>
31 |       <Tailwind>
32 |         <head>
33 |           <Font
34 |             fontFamily="Geist"
35 |             fallbackFontFamily="Helvetica"
36 |             webFont={{
37 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
38 |               format: "woff2",
39 |             }}
40 |             fontWeight={400}
41 |             fontStyle="normal"
42 |           />
43 |
44 |           <Font
45 |             fontFamily="Geist"
46 |             fallbackFontFamily="Helvetica"
47 |             webFont={{
48 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
49 |               format: "woff2",
50 |             }}
51 |             fontWeight={500}
52 |             fontStyle="normal"
53 |           />
54 |         </head>
55 |         <Preview>{text}</Preview>
56 |
57 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
58 |           <Container
59 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
60 |             style={{ borderStyle: "solid", borderWidth: 1 }}
61 |           >
62 |             <Logo />
63 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
64 |               You’ve Received an Invoice <br /> from {teamName}
65 |             </Heading>
66 |
67 |             <br />
68 |
69 |             <span className="font-medium">Hi {customerName},</span>
70 |             <Text className="text-[#121212]">
71 |               Please review your invoice and make sure to pay it on time. If you
72 |               have any questions, feel free to reply to this email.
73 |             </Text>
74 |
75 |             <Section className="text-center mt-[50px] mb-[50px]">
76 |               <Button
77 |                 className="bg-transparent text-primary text-[14px] text-[#121212] font-medium no-underline text-center px-6 py-3 border border-solid border-[#121212]"
78 |                 href={link}
79 |               >
80 |                 View invoice
81 |               </Button>
82 |             </Section>
83 |
84 |             <br />
85 |
86 |             <Footer />
87 |           </Container>
88 |         </Body>
89 |       </Tailwind>
90 |     </Html>
91 |   );
92 | };
93 |
94 | export default InvoiceEmail;
```

packages/email/emails/transactions.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { getAppUrl } from "@midday/utils/envs";
3 | import {
4 |   Body,
5 |   Button,
6 |   Container,
7 |   Font,
8 |   Heading,
9 |   Html,
10 |   Link,
11 |   Preview,
12 |   Section,
13 |   Tailwind,
14 |   Text,
15 | } from "@react-email/components";
16 | import { format } from "date-fns";
17 | import { Footer } from "../components/footer";
18 | import { Logo } from "../components/logo";
19 | import { getI18n } from "../locales";
20 |
21 | type Transaction = {
22 |   id: string;
23 |   date: string;
24 |   amount: number;
25 |   name: string;
26 |   currency: string;
27 |   category?: string;
28 | };
29 |
30 | interface Props {
31 |   fullName: string;
32 |   transactions: Transaction[];
33 |   locale: string;
34 |   teamName: string;
35 | }
36 |
37 | const defaultTransactions = [
38 |   {
39 |     id: "1",
40 |     date: new Date().toISOString(),
41 |     amount: -1000,
42 |     currency: "USD",
43 |     name: "Spotify",
44 |   },
45 |   {
46 |     id: "2",
47 |     date: new Date().toISOString(),
48 |     amount: 1000,
49 |     currency: "USD",
50 |     name: "H23504959",
51 |     category: "income",
52 |   },
53 |   {
54 |     id: "3",
55 |     date: new Date().toISOString(),
56 |     amount: -1000,
57 |     currency: "USD",
58 |     name: "Webflow",
59 |   },
60 |   {
61 |     id: "4",
62 |     date: new Date().toISOString(),
63 |     amount: -1000,
64 |     currency: "USD",
65 |     name: "Netflix",
66 |   },
67 |   {
68 |     id: "5",
69 |     date: new Date().toISOString(),
70 |     amount: -2500,
71 |     currency: "USD",
72 |     name: "Adobe Creative Cloud",
73 |   },
74 |   {
75 |     id: "6",
76 |     date: new Date().toISOString(),
77 |     amount: -1499,
78 |     currency: "USD",
79 |     name: "Amazon Prime",
80 |   },
81 |   {
82 |     id: "7",
83 |     date: new Date().toISOString(),
84 |     amount: -999,
85 |     currency: "USD",
86 |     name: "Disney+",
87 |   },
88 |   {
89 |     id: "8",
90 |     date: new Date().toISOString(),
91 |     amount: -1299,
92 |     currency: "USD",
93 |     name: "Microsoft 365",
94 |   },
95 |   {
96 |     id: "9",
97 |     date: new Date().toISOString(),
98 |     amount: -899,
99 |     currency: "USD",
100 |     name: "Apple Music",
101 |   },
102 |   {
103 |     id: "10",
104 |     date: new Date().toISOString(),
105 |     amount: -1599,
106 |     currency: "USD",
107 |     name: "HBO Max",
108 |   },
109 |   {
110 |     id: "11",
111 |     date: new Date().toISOString(),
112 |     amount: -1999,
113 |     currency: "USD",
114 |     name: "Adobe Photoshop",
115 |   },
116 |   {
117 |     id: "12",
118 |     date: new Date().toISOString(),
119 |     amount: -799,
120 |     currency: "USD",
121 |     name: "YouTube Premium",
122 |   },
123 |   {
124 |     id: "13",
125 |     date: new Date().toISOString(),
126 |     amount: -1499,
127 |     currency: "USD",
128 |     name: "Dropbox Plus",
129 |   },
130 |   {
131 |     id: "14",
132 |     date: new Date().toISOString(),
133 |     amount: -999,
134 |     currency: "USD",
135 |     name: "Nintendo Online",
136 |   },
137 |   {
138 |     id: "15",
139 |     date: new Date().toISOString(),
140 |     amount: -1299,
141 |     currency: "USD",
142 |     name: "Slack",
143 |   },
144 | ];
145 |
146 | const baseAppUrl = getAppUrl();
147 |
148 | export const TransactionsEmail = ({
149 |   fullName = "Viktor Hofte",
150 |   transactions = defaultTransactions,
151 |   locale = "en",
152 |   teamName = "Viktor Hofte AB",
153 | }: Props) => {
154 |   const { t } = getI18n({ locale });
155 |   const firstName = fullName.split(" ").at(0);
156 |
157 |   const previewText = t("transactions.preview", {
158 |     firstName,
159 |     numberOfTransactions: transactions.length,
160 |   });
161 |
162 |   const displayedTransactions = transactions.slice(0, 10);
163 |
164 |   return (
165 |     <Html>
166 |       <Tailwind>
167 |         <head>
168 |           <Font
169 |             fontFamily="Geist"
170 |             fallbackFontFamily="Helvetica"
171 |             webFont={{
172 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
173 |               format: "woff2",
174 |             }}
175 |             fontWeight={400}
176 |             fontStyle="normal"
177 |           />
178 |
179 |           <Font
180 |             fontFamily="Geist"
181 |             fallbackFontFamily="Helvetica"
182 |             webFont={{
183 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
184 |               format: "woff2",
185 |             }}
186 |             fontWeight={500}
187 |             fontStyle="normal"
188 |           />
189 |         </head>
190 |         <Preview>{previewText}</Preview>
191 |
192 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
193 |           <Container
194 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
195 |             style={{ borderStyle: "solid", borderWidth: 1 }}
196 |           >
197 |             <Logo />
[TRUNCATED]
```

packages/email/emails/welcome.tsx
```
1 | import { getEmailUrl } from "@midday/utils/envs";
2 | import {
3 |   Body,
4 |   Container,
5 |   Font,
6 |   Heading,
7 |   Html,
8 |   Img,
9 |   Link,
10 |   Preview,
11 |   Tailwind,
12 |   Text,
13 | } from "@react-email/components";
14 | import { Footer } from "../components/footer";
15 | import { GetStarted } from "../components/get-started";
16 | import { Logo } from "../components/logo";
17 |
18 | interface Props {
19 |   fullName: string;
20 | }
21 |
22 | const baseUrl = getEmailUrl();
23 |
24 | export const WelcomeEmail = ({ fullName = "Viktor Hofte" }: Props) => {
25 |   const firstName = fullName.split(" ").at(0);
26 |   const text = `Hi ${firstName}, Welcome to Midday! I'm Pontus, one of the founders. It's really important to us that you have a great experience ramping up.`;
27 |
28 |   return (
29 |     <Html>
30 |       <Tailwind>
31 |         <head>
32 |           <Font
33 |             fontFamily="Geist"
34 |             fallbackFontFamily="Helvetica"
35 |             webFont={{
36 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-400-normal.woff2",
37 |               format: "woff2",
38 |             }}
39 |             fontWeight={400}
40 |             fontStyle="normal"
41 |           />
42 |
43 |           <Font
44 |             fontFamily="Geist"
45 |             fallbackFontFamily="Helvetica"
46 |             webFont={{
47 |               url: "https://cdn.jsdelivr.net/npm/@fontsource/geist-sans@5.0.1/files/geist-sans-latin-500-normal.woff2",
48 |               format: "woff2",
49 |             }}
50 |             fontWeight={500}
51 |             fontStyle="normal"
52 |           />
53 |         </head>
54 |         <Preview>{text}</Preview>
55 |
56 |         <Body className="bg-[#fff] my-auto mx-auto font-sans">
57 |           <Container
58 |             className="border-transparent md:border-[#E8E7E1] my-[40px] mx-auto p-[20px] max-w-[600px]"
59 |             style={{ borderStyle: "solid", borderWidth: 1 }}
60 |           >
61 |             <Logo />
62 |             <Heading className="text-[#121212] text-[21px] font-normal text-center p-0 my-[30px] mx-0">
63 |               Welcome to Midday
64 |             </Heading>
65 |
66 |             <br />
67 |
68 |             <span className="font-medium">Hi {firstName},</span>
69 |             <Text className="text-[#121212]">
70 |               Welcome to Midday! I'm Pontus, one of the founders.
71 |               <br />
72 |               <br />
73 |               We've been working on Midday for the past months, and during this
74 |               time, we've implemented the basic functionality to get started.
75 |               However, with your feedback, we can make the right decisions to
76 |               help run your business smarter.
77 |               <br />
78 |               <br />
79 |               During our beta phase, you may encounter some bugs, but we
80 |               genuinely want all your feedback.
81 |               <br />
82 |               <br />
83 |               Should you have any questions, please don't hesitate to reply
84 |               directly to this email or to{" "}
85 |               <Link
86 |                 href="https://cal.com/pontus-midday/15min"
87 |                 className="text-[#121212] underline"
88 |               >
89 |                 schedule a call with me
90 |               </Link>
91 |               .
92 |             </Text>
93 |
94 |             <br />
95 |
96 |             <Img
97 |               src={`${baseUrl}/email/founders.jpeg`}
98 |               alt="Founders"
99 |               className="my-0 mx-auto block w-full"
100 |             />
101 |
102 |             <Text className="text-[#707070]">Best regards, founders</Text>
103 |
104 |             <Img
105 |               src={`${baseUrl}/email/signature.png`}
106 |               alt="Signature"
107 |               className="block w-full w-[143px] h-[20px]"
108 |             />
109 |
110 |             <br />
111 |             <br />
112 |
113 |             <GetStarted />
114 |
115 |             <br />
116 |
117 |             <Footer />
118 |           </Container>
119 |         </Body>
120 |       </Tailwind>
121 |     </Html>
122 |   );
123 | };
124 |
125 | export default WelcomeEmail;
```

packages/email/locales/index.ts
```
1 | import { type TranslationParams, translations } from "./translations";
2 |
3 | type Options = {
4 |   locale?: string;
5 | };
6 |
7 | const supportedLocales = ["en", "sv"];
8 |
9 | export function getI18n({ locale = "en" }: Options) {
10 |   // Ensure locale is supported, fallback to English if not
11 |   const safeLocale = supportedLocales.includes(locale) ? locale : "en";
12 |
13 |   // Get translations for the locale
14 |   const getTranslation = (key: string, params?: TranslationParams) => {
15 |     const translationSet = translations(safeLocale, params);
16 |
17 |     if (!translationSet || !(key in translationSet)) {
18 |       return key; // Fallback to key if translation missing
19 |     }
20 |
21 |     return translationSet[key];
22 |   };
23 |
24 |   return {
25 |     t: getTranslation,
26 |   };
27 | }
```

packages/email/locales/translations.ts
```
1 | export interface TranslationParams {
2 |   [key: string]: string | number | undefined;
3 | }
4 |
5 | export function translations(locale: string, params?: TranslationParams) {
6 |   switch (locale) {
7 |     case "en":
8 |       return {
9 |         "notifications.match": `We matched the transaction “${params?.transactionName}” against “${params?.fileName}”`,
10 |         "notifications.transactions":
11 |           params?.numberOfTransactions &&
12 |           typeof params?.numberOfTransactions === "number" &&
13 |           params?.numberOfTransactions > 1
14 |             ? `You have ${params?.numberOfTransactions} new transactions`
15 |             : `You have a new transaction of ${params?.amount} from ${params?.name}`,
16 |         "notifications.invoicePaid": `Invoice ${params?.invoiceNumber} has been paid`,
17 |         "notifications.invoiceOverdue": `Invoice ${params?.invoiceNumber} is overdue`,
18 |         "transactions.subject": "New transactions",
19 |         "transactions.preview": `Hi ${params?.firstName}, You have ${
20 |           params?.numberOfTransactions
21 |         } ${
22 |           params?.numberOfTransactions > 1
23 |             ? "new transactions"
24 |             : "new transaction"
25 |         }`,
26 |         "transactions.title1": "You have ",
27 |         "transactions.title2": `${params?.numberOfTransactions} ${
28 |           params?.numberOfTransactions > 1
29 |             ? "new transactions"
30 |             : "new transaction"
31 |         }`,
32 |         "transactions.description1": `Hi ${params?.firstName}`,
33 |         "transactions.description2": "We found",
34 |         "transactions.description3": `${params?.numberOfTransactions} ${
35 |           params?.numberOfTransactions > 1
36 |             ? "new transactions"
37 |             : "new transaction"
38 |         }`,
39 |         "transactions.description4": `for your team ${params?.teamName}, we will try to match those against receipts in your inbox for up to 45 days. Additionally, you can simply reply to this email with the receipts.`,
40 |         "transactions.button": "View transactions",
41 |         "transactions.settings": "Notification preferences",
42 |         "transactions.amount": "Amount",
43 |         "transactions.date": "Date",
44 |         "transactions.description": "Description",
45 |         "invite.subject": `${params?.invitedByName} invited you to the ${params?.teamName} team on Midday`,
46 |         "invite.preview": `Join ${params?.teamName} on Midday`,
47 |         "invite.title1": "Join",
48 |         "invite.title2": "on",
49 |         "invite.link1": "has invited you to the",
50 |         "invite.link2": "team on",
51 |         "invite.join": "Join the team",
52 |         "invite.link3": "or copy and paste this URL into your browser",
53 |         "invite.footer1": "This invitation was intended for",
54 |         "invite.footer2": "This invite was sent from",
55 |         "invite.footer3": "located in",
56 |         "invite.footer4":
57 |           "If you were not expecting this invitation, you can ignore this email. If you are concerned about your account's safety, please reply to this email to get in touch with us.",
58 |         "invoice.overdue.subject": `Invoice #${params?.invoiceNumber} is overdue`,
59 |         "invoice.paid.subject": `Invoice #${params?.invoiceNumber} has been paid`,
60 |       };
61 |     case "sv":
62 |       return {
63 |         "notifications.match": `Vi matchade transaktionen “${params?.transactionName}” mot “${params?.fileName}”`,
64 |         "notifications.transactions":
65 |           params?.numberOfTransactions &&
66 |           typeof params?.numberOfTransactions === "number" &&
67 |           params?.numberOfTransactions > 1
68 |             ? `Du har ${params?.numberOfTransactions} nya transaktioner`
69 |             : `Du har en ny transaktion på ${params?.amount} från ${params?.name}`,
70 |         "notifications.invoicePaid": `Faktura ${params?.invoiceNumber} har betalats`,
71 |         "notifications.invoiceOverdue": `Faktura ${params?.invoiceNumber} är försenad`,
72 |         "transactions.subject": "Nya transaktioner",
73 |         "transactions.preview": `Hej ${params?.firstName}, Vi hittade ${
74 |           params?.numberOfTransactions
75 |         } ${
76 |           params?.numberOfTransactions > 1
77 |             ? "nya transaktioner"
78 |             : "nya transaktion"
79 |         } .`,
80 |         "transactions.title1": "Du har ",
81 |         "transactions.title2": `${params?.numberOfTransactions} ${
82 |           params?.numberOfTransactions > 1
83 |             ? "nya transaktioner"
84 |             : "nya transaktion"
85 |         }`,
86 |         "transactions.description1": `Hej ${params?.firstName}`,
87 |         "transactions.description2": "Vi hittade",
88 |         "transactions.description3": `${params?.numberOfTransactions} ${
89 |           params?.numberOfTransactions > 1
90 |             ? "nya transaktioner"
91 |             : "nya transaktion"
92 |         }`,
93 |         "transactions.description4":
94 |           "på ditt konto som vi försöker matcha mot kvitton i din inkorg i upp till 45 dagar. Du kan också svara på detta email med dina kvitton.",
95 |         "transactions.button": "Visa transaktioner",
96 |         "transactions.footer":
97 |           " Nam imperdiet congue volutpat. Nulla quis facilisis lacus. Vivamus convallis sit amet lectus eget tincidunt. Vestibulum vehicula rutrum nisl, sed faucibus neque. Donec lacus mi, rhoncus at dictum eget, pulvinar at metus. Donec cursus tellus erat, a hendrerit elit rutrum ut. Fusce quis tristique ligula. Etiam sit amet enim vitae mauris auctor blandit id et nibh.",
98 |         "transactions.settings": "Inställningar",
99 |         "transactions.amount": "Belopp",
100 |         "transactions.date": "Datum",
101 |         "transactions.description": "Beskrivning",
102 |         "invite.subject": `${params?.invitedByName} bjöd in dig till ${params?.teamName} på Midday`,
103 |         "invite.preview": `Gå med i ${params?.teamName} på Midday`,
104 |         "invite.title1": "Gå med",
105 |         "invite.title2": "på",
[TRUNCATED]
```

packages/events/src/client.tsx
```
1 | import {
2 |   OpenPanelComponent,
3 |   type PostEventPayload,
4 |   useOpenPanel,
5 | } from "@openpanel/nextjs";
6 |
7 | const isProd = process.env.NODE_ENV === "production";
8 |
9 | const Provider = () => (
10 |   <OpenPanelComponent
11 |     clientId={process.env.NEXT_PUBLIC_OPENPANEL_CLIENT_ID!}
12 |     trackAttributes={true}
13 |     trackScreenViews={isProd}
14 |     trackOutgoingLinks={isProd}
15 |   />
16 | );
17 |
18 | const track = (options: { event: string } & PostEventPayload["properties"]) => {
19 |   const { track: openTrack } = useOpenPanel();
20 |
21 |   if (!isProd) {
22 |     console.log("Track", options);
23 |     return;
24 |   }
25 |
26 |   const { event, ...rest } = options;
27 |
28 |   openTrack(event, rest);
29 | };
30 |
31 | export { Provider, track };
```

packages/events/src/events.ts
```
1 | export const LogEvents = {
2 |   Waitlist: {
3 |     name: "User Joined Waitlist",
4 |     channel: "waitlist",
5 |   },
6 |   SignIn: {
7 |     name: "User Signed In",
8 |     channel: "login",
9 |   },
10 |   SignOut: {
11 |     name: "User Signed Out",
12 |     channel: "login",
13 |   },
14 |   Registered: {
15 |     name: "User Registered",
16 |     channel: "registered",
17 |   },
18 |   ProjectCreated: {
19 |     name: "Project Created",
20 |     channel: "tracker",
21 |   },
22 |   ProjectDeleted: {
23 |     name: "Project Deleted",
24 |     channel: "tracker",
25 |   },
26 |   ProjectUpdated: {
27 |     name: "Project Updated",
28 |     channel: "tracker",
29 |   },
30 |   ProjectReport: {
31 |     name: "Project Report",
32 |     channel: "report",
33 |   },
34 |   TrackerCreateEntry: {
35 |     name: "Tracker Create Entry",
36 |     channel: "tracker",
37 |   },
38 |   TrackerDeleteEntry: {
39 |     name: "Tracker Delete Entry",
40 |     channel: "tracker",
41 |   },
42 |   ConnectBankCompleted: {
43 |     name: "Connect Bank Completed",
44 |     channel: "bank",
45 |   },
46 |   ConnectBankProvider: {
47 |     name: "Connect Bank Provider",
48 |     channel: "bank",
49 |   },
50 |   ConnectBankCanceled: {
51 |     name: "Connect Bank Canceled",
52 |     channel: "bank",
53 |   },
54 |   ConnectBankAuthorized: {
55 |     name: "Connect Bank Authorized",
56 |     channel: "bank",
57 |   },
58 |   GoCardLessLinkFailed: {
59 |     name: "GoCardLess Link Failed",
60 |     channel: "gocardless",
61 |   },
62 |   ConnectBankFailed: {
63 |     name: "Connect Bank Failed",
64 |     channel: "bank",
65 |   },
66 |   BankAccountCreate: {
67 |     name: "Create Bank Account",
68 |     channel: "bank",
69 |   },
70 |   DeleteBank: {
71 |     name: "Delete Bank",
72 |     channel: "bank",
73 |   },
74 |   UpdateBank: {
75 |     name: "Update Bank",
76 |     channel: "bank",
77 |   },
78 |   OverviewReport: {
79 |     name: "Overview Report",
80 |     channel: "report",
81 |   },
82 |   AcceptInvite: {
83 |     name: "Accept Invite",
84 |     channel: "invite",
85 |   },
86 |   DeleteInvite: {
87 |     name: "Delete Invite",
88 |     channel: "invite",
89 |   },
90 |   DeclineInvite: {
91 |     name: "Decline Invite",
92 |     channel: "invite",
93 |   },
94 |   InviteTeamMembers: {
95 |     name: "Invite Team Member",
96 |     channel: "invite",
97 |   },
98 |   UserRoleChange: {
99 |     name: "User Role Change",
100 |     channel: "user",
101 |   },
102 |   DeleteUser: {
103 |     name: "Delete User",
104 |     channel: "user",
105 |   },
106 |   ChangeTeam: {
107 |     name: "Change Team",
108 |     channel: "team",
109 |   },
110 |   CreateTeam: {
111 |     name: "Create Team",
112 |     channel: "team",
113 |   },
114 |   LeaveTeam: {
115 |     name: "Leave Team",
116 |     channel: "team",
117 |   },
118 |   DeleteTeam: {
119 |     name: "Delete Team",
120 |     channel: "team",
121 |   },
122 |   DeleteTeamMember: {
123 |     name: "Delete Team Member",
124 |     channel: "team",
125 |   },
126 |   CreateAttachment: {
127 |     name: "Create Attachment",
128 |     channel: "transaction",
129 |   },
130 |   ExportTransactions: {
131 |     name: "Export Transaction",
132 |     channel: "transaction",
133 |   },
134 |   DeleteAttachment: {
135 |     name: "Delete Attachment",
136 |     channel: "transaction",
137 |   },
138 |   TransactionsManualSync: {
139 |     name: "Manual Sync",
140 |     channel: "transaction",
141 |   },
142 |   CreateFolder: {
143 |     name: "Create Folder",
144 |     channel: "vault",
145 |   },
146 |   DeleteFolder: {
147 |     name: "Delete Folder",
148 |     channel: "vault",
149 |   },
150 |   DeleteFile: {
151 |     name: "Delete File",
152 |     channel: "vault",
153 |   },
154 |   ShareFile: {
155 |     name: "Share File",
156 |     channel: "vault",
157 |   },
158 |   MfaVerify: {
159 |     name: "MFA Verify",
160 |     channel: "security",
161 |   },
162 |   SendFeedback: {
163 |     name: "Send Feedback",
164 |     channel: "feedback",
165 |   },
166 |   InboxInbound: {
167 |     name: "Inbox Inbound",
168 |     channel: "inbox",
169 |   },
170 |   ImportTransactions: {
171 |     name: "Import Transactions",
172 |     channel: "import",
173 |   },
174 |   SupportTicket: {
175 |     name: "Support Ticket",
176 |     channel: "support",
177 |   },
178 |   CategoryCreate: {
179 |     name: "Category Create",
180 |     channel: "category",
181 |   },
182 |   CategoryDelete: {
183 |     name: "Category Delete",
184 |     channel: "category",
185 |   },
186 |   CreateTransaction: {
187 |     name: "Create Transaction",
188 |     channel: "transaction",
189 |   },
190 |   UpdateBaseCurrency: {
191 |     name: "Update Base Currency",
192 |     channel: "transaction",
193 |   },
194 |   UpdateCurrency: {
195 |     name: "Update Currency",
196 |     channel: "transaction",
197 |   },
198 |   DisconnectApp: {
199 |     name: "Disconnect App",
200 |     channel: "app",
201 |   },
202 |   UpdateAppSettings: {
203 |     name: "Update App Settings",
204 |     channel: "app",
205 |   },
206 |   GoCardLessLinkCreated: {
207 |     name: "GoCardLess Link Created",
208 |     channel: "gocardless",
209 |   },
210 |   CreateCustomer: {
211 |     name: "Create Customer",
212 |     channel: "customer",
213 |   },
214 |   DeleteCustomer: {
215 |     name: "Delete Customer",
216 |     channel: "customer",
217 |   },
218 |   CreateTag: {
219 |     name: "Create Tag",
220 |     channel: "tag",
221 |   },
222 |   CreateTransactionTag: {
223 |     name: "Create Transaction Tag",
224 |     channel: "tag",
225 |   },
226 |   DeleteTransactionTag: {
227 |     name: "Delete Transaction Tag",
228 |     channel: "tag",
229 |   },
[TRUNCATED]
```

packages/events/src/server.ts
```
1 | import { OpenPanel, type PostEventPayload } from "@openpanel/nextjs";
2 | import { waitUntil } from "@vercel/functions";
3 | import { cookies } from "next/headers";
4 |
5 | type Props = {
6 |   userId?: string;
7 |   fullName?: string | null;
8 | };
9 |
10 | export const setupAnalytics = async (options?: Props) => {
11 |   const { userId, fullName } = options ?? {};
12 |   const trackingConsent =
13 |     !cookies().has("tracking-consent") ||
14 |     cookies().get("tracking-consent")?.value === "1";
15 |
16 |   const client = new OpenPanel({
17 |     clientId: process.env.NEXT_PUBLIC_OPENPANEL_CLIENT_ID!,
18 |     clientSecret: process.env.OPENPANEL_SECRET_KEY!,
19 |   });
20 |
21 |   if (trackingConsent && userId && fullName) {
22 |     const [firstName, lastName] = fullName.split(" ");
23 |
24 |     waitUntil(
25 |       client.identify({
26 |         profileId: userId,
27 |         firstName,
28 |         lastName,
29 |       }),
30 |     );
31 |   }
32 |
33 |   return {
34 |     track: (options: { event: string } & PostEventPayload["properties"]) => {
35 |       if (process.env.NODE_ENV !== "production") {
36 |         console.log("Track", options);
37 |         return;
38 |       }
39 |
40 |       const { event, ...rest } = options;
41 |
42 |       waitUntil(client.track(event, rest));
43 |     },
44 |   };
45 | };
```

packages/import/src/index.ts
```
1 | export * from "./utils";
```

packages/import/src/mappings.ts
```
1 | import type { Transaction } from "./types";
2 |
3 | export const mapTransactions = (
4 |   data: Record<string, string>[],
5 |   mappings: Record<string, string>,
6 |   currency: string,
7 |   teamId: string,
8 |   bankAccountId: string,
9 | ): Transaction[] => {
10 |   return data.map((row) => ({
11 |     ...(Object.fromEntries(
12 |       Object.entries(mappings)
13 |         .filter(([_, value]) => value !== "")
14 |         .map(([key, value]) => [key, row[value]]),
15 |     ) as Transaction),
16 |     currency,
17 |     teamId,
18 |     bankAccountId,
19 |   }));
20 | };
```

packages/import/src/transform.ts
```
1 | import { capitalCase } from "change-case";
2 | import { v4 as uuidv4 } from "uuid";
3 | import type { Transaction } from "./types";
4 | import { formatAmountValue, formatDate } from "./utils";
5 |
6 | export function transform({
7 |   transaction,
8 |   inverted,
9 | }: {
10 |   transaction: Transaction;
11 |   inverted: boolean;
12 | }) {
13 |   return {
14 |     internal_id: `${transaction.teamId}_${uuidv4()}`,
15 |     team_id: transaction.teamId,
16 |     status: "posted",
17 |     method: "other",
18 |     date: formatDate(transaction.date),
19 |     amount: formatAmountValue({ amount: transaction.amount, inverted }),
20 |     name: transaction?.description && capitalCase(transaction.description),
21 |     manual: true,
22 |     category_slug:
23 |       formatAmountValue({ amount: transaction.amount, inverted }) > 0
24 |         ? "income"
25 |         : null,
26 |     bank_account_id: transaction.bankAccountId,
27 |     currency: transaction.currency.toUpperCase(),
28 |     notified: true,
29 |   };
30 | }
```

packages/import/src/types.ts
```
1 | export type Transaction = {
2 |   date: string;
3 |   description: string;
4 |   amount: string;
5 |   teamId: string;
6 |   bankAccountId: string;
7 |   currency: string;
8 | };
```

packages/import/src/utils.test.ts
```
1 | import { describe, expect, it } from "bun:test";
2 | import { formatAmountValue, formatDate } from "./utils";
3 |
4 | describe("formatAmountValue", () => {
5 |   it("should handle numbers with comma as decimal separator", () => {
6 |     expect(formatAmountValue({ amount: "1.234,56" })).toBe(1234.56);
7 |   });
8 |
9 |   it("should handle numbers with period as thousands separator", () => {
10 |     expect(formatAmountValue({ amount: "1.234.56" })).toBe(1234.56);
11 |   });
12 |
13 |   it("should handle numbers with period as decimal separator", () => {
14 |     expect(formatAmountValue({ amount: "1234.56" })).toBe(1234.56);
15 |   });
16 |
17 |   it("should handle plain numbers", () => {
18 |     expect(formatAmountValue({ amount: "1234" })).toBe(1234);
19 |   });
20 |
21 |   it("should invert the amount when inverted is true", () => {
22 |     expect(formatAmountValue({ amount: "1234.56", inverted: true })).toBe(
23 |       -1234.56,
24 |     );
25 |   });
26 |
27 |   it("should handle negative numbers", () => {
28 |     expect(formatAmountValue({ amount: "-1234.56" })).toBe(-1234.56);
29 |   });
30 |
31 |   it("should invert negative numbers when inverted is true", () => {
32 |     expect(formatAmountValue({ amount: "-1234.56", inverted: true })).toBe(
33 |       1234.56,
34 |     );
35 |   });
36 |
37 |   it("should handle zero", () => {
38 |     expect(formatAmountValue({ amount: "0" })).toBe(0);
39 |     expect(formatAmountValue({ amount: "0", inverted: true })).toBe(-0);
40 |   });
41 | });
42 |
43 | describe("formatDate", () => {
44 |   it("should format a valid date string", () => {
45 |     expect(formatDate("2023-05-15")).toBe("2023-05-15");
46 |   });
47 |
48 |   it("should handle date strings with non-date characters", () => {
49 |     expect(formatDate("2023/05/15")).toBe("2023-05-15");
50 |     expect(formatDate("May 15, 2023")).toBe("2023-05-15");
51 |   });
52 |
53 |   it("should return undefined for invalid date strings", () => {
54 |     expect(formatDate("invalid-date")).toBeUndefined();
55 |     expect(formatDate("2023-13-45")).toBeUndefined();
56 |   });
57 |
58 |   it("should handle different date formats", () => {
59 |     expect(formatDate("05/15/2023")).toBe("2023-05-15");
60 |   });
61 |
62 |   it("should handle dates with time", () => {
63 |     expect(formatDate("2023-05-15T14:30:00")).toBe("2023-05-15");
64 |   });
65 |
66 |   it("should handle dates dot separated", () => {
67 |     expect(formatDate("04.09.2024")).toBe("2024-09-04");
68 |   });
69 |
70 |   it("should handle dates with time", () => {
71 |     expect(formatDate("08.05.2024 09:12:07")).toBe("2024-05-08");
72 |   });
73 |
74 |   it("should handle dates 07/Aug/2024", () => {
75 |     expect(formatDate("07/Aug/2024")).toBe("2024-08-07");
76 |   });
77 |
78 |   it("should handle dates 24-08-2024", () => {
79 |     expect(formatDate("24-08-2024")).toBe("2024-08-24");
80 |   });
81 |
82 |   it("should handle dates in dd-MM-yyyy format", () => {
83 |     expect(formatDate("24-09-2024")).toBe("2024-09-24");
84 |   });
85 |
86 |   it("should handle short date format", () => {
87 |     expect(formatDate("11/4/24")).toBe("2024-04-11");
88 |   });
89 | });
```

packages/import/src/utils.ts
```
1 | import { isValid, parse, parseISO } from "date-fns";
2 |
3 | function ensureValidYear(dateString: string | undefined): string | undefined {
4 |   if (!dateString) return undefined;
5 |
6 |   const [year, month, day] = dateString.split("-");
7 |   const correctedYear =
8 |     year?.length === 4
9 |       ? year.startsWith("20")
10 |         ? year
11 |         : `20${year.slice(2)}`
12 |       : `20${year}`;
13 |
14 |   return `${correctedYear}-${month}-${day}`;
15 | }
16 |
17 | export function formatDate(date: string) {
18 |   const formats = [
19 |     "dd/MMM/yyyy",
20 |     "dd/MM/yyyy",
21 |     "yyyy-MM-dd",
22 |     "MM/dd/yyyy",
23 |     "dd.MM.yyyy",
24 |     "dd-MM-yyyy",
25 |     "yyyy/MM/dd",
26 |     "MM-dd-yyyy",
27 |     "yyyy.MM.dd",
28 |     "dd MMM yyyy",
29 |     "MMM dd, yyyy",
30 |     "MMMM dd, yyyy",
31 |     "yyyy-MM-dd'T'HH:mm:ss",
32 |     "yyyy-MM-dd HH:mm:ss",
33 |     "dd/MM/yyyy HH:mm:ss",
34 |     "MM/dd/yyyy HH:mm:ss",
35 |     "yyyy/MM/dd HH:mm:ss",
36 |     "dd.MM.yyyy HH:mm:ss",
37 |     "dd-MM-yyyy HH:mm:ss",
38 |     "yyyy-MM-dd'T'HH:mm:ss.SSSZ",
39 |     "yyyy-MM-dd'T'HH:mm:ss",
40 |     "d/M/yy",
41 |   ];
42 |
43 |   for (const format of formats) {
44 |     const parsedDate = parse(date, format, new Date());
45 |     if (isValid(parsedDate)) {
46 |       return ensureValidYear(parsedDate.toISOString().split("T")[0]);
47 |     }
48 |   }
49 |
50 |   try {
51 |     const parsedDate = parseISO(date);
52 |     if (isValid(parsedDate)) {
53 |       return ensureValidYear(parsedDate.toISOString().split("T")[0]);
54 |     }
55 |   } catch {
56 |     // Continue if parseISO fails
57 |   }
58 |
59 |   // If the date includes a time, we don't need to remove the time.
60 |   const value = date.includes("T") ? date : date.replace(/[^0-9-\.\/]/g, "");
61 |
62 |   try {
63 |     const parsedDate = parseISO(value);
64 |     if (isValid(parsedDate)) {
65 |       return ensureValidYear(parsedDate.toISOString().split("T")[0]);
66 |     }
67 |   } catch {
68 |     // Continue if parseISO fails
69 |   }
70 |
71 |   // If all parsing attempts fail, return undefined
72 |   return undefined;
73 | }
74 |
75 | export function formatAmountValue({
76 |   amount,
77 |   inverted,
78 | }: { amount: string; inverted?: boolean }) {
79 |   let value: number;
80 |
81 |   // Handle special minus sign (−) by replacing with standard minus (-)
82 |   const normalizedAmount = amount.replace(/−/g, "-");
83 |
84 |   if (normalizedAmount.includes(",")) {
85 |     // Remove thousands separators and replace the comma with a period.
86 |     value = +normalizedAmount.replace(/\./g, "").replace(",", ".");
87 |   } else if (normalizedAmount.match(/\.\d{2}$/)) {
88 |     // If it ends with .XX, it's likely a decimal; remove internal periods.
89 |     value = +normalizedAmount.replace(/\.(?=\d{3})/g, "");
90 |   } else {
91 |     // If neither condition is met, convert the amount directly to a number
92 |     value = +normalizedAmount;
93 |   }
94 |
95 |   if (inverted) {
96 |     return +(value * -1);
97 |   }
98 |
99 |   return value;
100 | }
```

packages/import/src/validate.ts
```
1 | import { z } from "zod";
2 | import type { Transaction } from "./types";
3 |
4 | export const createTransactionSchema = z.object({
5 |   name: z.string(),
6 |   currency: z.string(),
7 |   bank_account_id: z.string(),
8 |   team_id: z.string(),
9 |   internal_id: z.string(),
10 |   status: z.enum(["posted", "pending"]),
11 |   method: z.enum(["card", "bank", "other"]),
12 |   date: z.coerce.date(),
13 |   amount: z.number(),
14 |   manual: z.boolean(),
15 |   category_slug: z.string().nullable(),
16 | });
17 |
18 | export const validateTransactions = (transactions: Transaction[]) => {
19 |   const processedTransactions = transactions.map((transaction) =>
20 |     createTransactionSchema.safeParse(transaction),
21 |   );
22 |
23 |   const validTransactions = processedTransactions.filter(
24 |     (transaction) => transaction.success,
25 |   );
26 |
27 |   const invalidTransactions = processedTransactions.filter(
28 |     (transaction) => !transaction.success,
29 |   );
30 |
31 |   return {
32 |     validTransactions: validTransactions.map((transaction) => transaction.data),
33 |     invalidTransactions: invalidTransactions.map(
34 |       (transaction) => transaction.error,
35 |     ),
36 |   };
37 | };
```

packages/inbox/src/index.ts
```
1 | export * from "./schema";
2 | export * from "./utils";
```

packages/inbox/src/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const inboxAttachment = z.object({
4 |   Name: z.string(),
5 |   Content: z.string(),
6 |   ContentType: z.string(),
7 |   ContentID: z.string(),
8 |   ContentLength: z.number(),
9 | });
10 |
11 | export const inboxWebhookPostSchema = z.object({
12 |   OriginalRecipient: z.union([
13 |     z
14 |       .string({ required_error: "OriginalRecipient is required" })
15 |       .email({ message: "Invalid email format" })
16 |       .endsWith("@inbox.midday.ai", { message: "Invalid email domain" }),
17 |     z
18 |       .string({ required_error: "OriginalRecipient is required" })
19 |       .email({ message: "Invalid email format" })
20 |       .endsWith("@inbox.staging.midday.ai", {
21 |         message: "Invalid email domain",
22 |       }),
23 |   ]),
24 |   Attachments: z.array(inboxAttachment).optional(),
25 |   Subject: z.string().optional(),
26 |   TextBody: z.string().optional(),
27 |   HtmlBody: z.string().optional(),
28 |   FromFull: z.object({
29 |     Name: z.string(),
30 |     Email: z.string(),
31 |   }),
32 |   MessageID: z.string({ required_error: "MessageID is required" }),
33 | });
```

packages/inbox/src/tsconfig.json
```
1 | {
2 |     "extends": "@midday/tsconfig/base.json",
3 |     "include": ["src"],
4 |     "exclude": ["node_modules"]
5 |   }
```

packages/inbox/src/utils.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import { getInboxEmail, getInboxIdFromEmail } from ".";
3 |
4 | test("Get inbox id from email", () => {
5 |   expect(getInboxIdFromEmail("egr34f@inbox.midday.ai")).toMatch("egr34f");
6 | });
7 |
8 | test("Get inbox email by id", () => {
9 |   expect(getInboxEmail("egr34f")).toMatch("egr34f@inbox.staging.midday.ai");
10 | });
```

packages/inbox/src/utils.ts
```
1 | export function getInboxIdFromEmail(email: string) {
2 |   return email.split("@").at(0);
3 | }
4 |
5 | export function getInboxEmail(inboxId: string) {
6 |   if (process.env.NODE_ENV !== "production") {
7 |     return `${inboxId}@inbox.staging.midday.ai`;
8 |   }
9 |
10 |   return `${inboxId}@inbox.midday.ai`;
11 | }
```

packages/invoice/src/index.tsx
```
1 | export * from "./templates/html";
2 | export * from "./templates/pdf";
3 | export * from "./templates/og";
4 | export * from "./editor";
5 | export * from "./utils/logo";
6 |
7 | export { renderToStream, renderToBuffer } from "@react-pdf/renderer";
```

packages/kv/src/index.ts
```
1 | import "server-only";
2 |
3 | import { Redis } from "@upstash/redis";
4 |
5 | export const client = new Redis({
6 |   url: process.env.UPSTASH_REDIS_REST_URL!,
7 |   token: process.env.UPSTASH_REDIS_REST_TOKEN!,
8 | });
```

packages/location/src/countries-intl.json
```
1 | [
2 |   {
3 |     "name": "Afghanistan",
4 |     "alpha2": "AF",
5 |     "alpha3": "AFG",
6 |     "numeric": "004",
7 |     "locales": ["ps-AF", "fa-AF", "uz-Arab-AF"],
8 |     "default_locale": "ps-AF",
9 |     "currency": "AFN",
10 |     "latitude": "33.93911",
11 |     "longitude": "67.709953",
12 |     "currency_name": "Afghani",
13 |     "languages": ["ps", "uz", "tk"],
14 |     "capital": "Kabul",
15 |     "emoji": "🇦🇫",
16 |     "emojiU": "U+1F1E6 U+1F1EB",
17 |     "fips": "AF",
18 |     "internet": "AF",
19 |     "continent": "Asia",
20 |     "region": "South Asia"
21 |   },
22 |   {
23 |     "name": "Albania",
24 |     "alpha2": "AL",
25 |     "alpha3": "ALB",
26 |     "numeric": "008",
27 |     "locales": ["sq-AL"],
28 |     "default_locale": "sq-AL",
29 |     "currency": "ALL",
30 |     "latitude": "41.153332",
31 |     "longitude": "20.168331",
32 |     "currency_name": "Lek",
33 |     "languages": ["sq"],
34 |     "capital": "Tirana",
35 |     "emoji": "🇦🇱",
36 |     "emojiU": "U+1F1E6 U+1F1F1",
37 |     "fips": "AL",
38 |     "internet": "AL",
39 |     "continent": "Europe",
40 |     "region": "South East Europe"
41 |   },
42 |   {
43 |     "name": "Algeria",
44 |     "alpha2": "DZ",
45 |     "alpha3": "DZA",
46 |     "numeric": "012",
47 |     "locales": ["ar-DZ", "kab-DZ"],
48 |     "default_locale": "ar-DZ",
49 |     "currency": "DZD",
50 |     "latitude": "28.033886",
51 |     "longitude": "1.659626",
52 |     "currency_name": "Algerian Dinar",
53 |     "languages": ["ar"],
54 |     "capital": "Algiers",
55 |     "emoji": "🇩🇿",
56 |     "emojiU": "U+1F1E9 U+1F1FF",
57 |     "fips": "AG",
58 |     "internet": "DZ",
59 |     "continent": "Africa",
60 |     "region": "Northern Africa"
61 |   },
62 |   {
63 |     "name": "American Samoa",
64 |     "alpha2": "AS",
65 |     "alpha3": "ASM",
66 |     "numeric": "016",
67 |     "locales": ["en-AS"],
68 |     "default_locale": "en-AS",
69 |     "currency": "USD",
70 |     "latitude": "-14.270972",
71 |     "longitude": "-170.132217",
72 |     "currency_name": "US Dollar",
73 |     "languages": ["en", "sm"],
74 |     "capital": "Pago Pago",
75 |     "emoji": "🇦🇸",
76 |     "emojiU": "U+1F1E6 U+1F1F8",
77 |     "fips": "AQ",
78 |     "internet": "AS",
79 |     "continent": "Oceania",
80 |     "region": "Pacific"
81 |   },
82 |   {
83 |     "name": "Andorra",
84 |     "alpha2": "AD",
85 |     "alpha3": "AND",
86 |     "numeric": "020",
87 |     "locales": ["ca"],
88 |     "default_locale": "ca",
89 |     "currency": "EUR",
90 |     "latitude": "42.546245",
91 |     "longitude": "1.601554",
92 |     "currency_name": "Euro",
93 |     "languages": ["ca"],
94 |     "capital": "Andorra la Vella",
95 |     "emoji": "🇦🇩",
96 |     "emojiU": "U+1F1E6 U+1F1E9",
97 |     "fips": "AN",
98 |     "internet": "AD",
99 |     "continent": "Europe",
100 |     "region": "South West Europe"
101 |   },
102 |   {
103 |     "name": "Angola",
104 |     "alpha2": "AO",
105 |     "alpha3": "AGO",
106 |     "numeric": "024",
107 |     "locales": ["pt"],
108 |     "default_locale": "pt",
109 |     "currency": "AOA",
110 |     "latitude": "-11.202692",
111 |     "longitude": "17.873887",
112 |     "currency_name": "Kwanza",
113 |     "languages": ["pt"],
114 |     "capital": "Luanda",
115 |     "emoji": "🇦🇴",
116 |     "emojiU": "U+1F1E6 U+1F1F4",
117 |     "fips": "AO",
118 |     "internet": "AO",
119 |     "continent": "Africa",
120 |     "region": "Southern Africa"
121 |   },
122 |   {
123 |     "name": "Anguilla",
124 |     "alpha2": "AI",
125 |     "alpha3": "AIA",
126 |     "numeric": "660",
127 |     "locales": ["en"],
128 |     "default_locale": "en",
129 |     "currency": "XCD",
130 |     "latitude": "18.220554",
131 |     "longitude": "-63.068615",
132 |     "currency_name": "East Caribbean Dollar",
133 |     "languages": ["en"],
134 |     "capital": "The Valley",
135 |     "emoji": "🇦🇮",
136 |     "emojiU": "U+1F1E6 U+1F1EE",
137 |     "fips": "AV",
138 |     "internet": "AI",
139 |     "continent": "Americas",
140 |     "region": "West Indies"
141 |   },
142 |   {
143 |     "name": "Antigua and Barbuda",
144 |     "alpha2": "AG",
145 |     "alpha3": "ATG",
146 |     "numeric": "028",
147 |     "locales": ["en"],
148 |     "default_locale": "en",
149 |     "currency": "XCD",
150 |     "latitude": "17.060816",
151 |     "longitude": "-61.796428",
152 |     "currency_name": "East Caribbean Dollar",
153 |     "languages": ["en"],
154 |     "capital": "Saint John's",
155 |     "emoji": "🇦🇬",
156 |     "emojiU": "U+1F1E6 U+1F1EC",
157 |     "fips": "AC",
158 |     "internet": "AG",
159 |     "continent": "Americas",
160 |     "region": "West Indies"
161 |   },
162 |   {
163 |     "name": "Argentina",
164 |     "alpha2": "AR",
165 |     "alpha3": "ARG",
166 |     "numeric": "032",
167 |     "locales": ["es-AR"],
168 |     "default_locale": "es-AR",
169 |     "currency": "ARS",
170 |     "latitude": "-38.416097",
171 |     "longitude": "-63.616672",
172 |     "currency_name": "Argentine Peso",
173 |     "languages": ["es", "gn"],
174 |     "capital": "Buenos Aires",
175 |     "emoji": "🇦🇷",
176 |     "emojiU": "U+1F1E6 U+1F1F7",
177 |     "fips": "AR",
178 |     "internet": "AR",
179 |     "continent": "Americas",
180 |     "region": "South America"
181 |   },
182 |   {
183 |     "name": "Armenia",
184 |     "alpha2": "AM",
185 |     "alpha3": "ARM",
186 |     "numeric": "051",
187 |     "locales": ["hy-AM"],
188 |     "default_locale": "hy-AM",
189 |     "currency": "AMD",
190 |     "latitude": "40.069099",
191 |     "longitude": "45.038189",
[TRUNCATED]
```

packages/location/src/countries-intl.ts
```
1 | import countries from "./countries-intl.json";
2 |
3 | export { countries };
```

packages/location/src/countries.json
```
1 | [
2 |     {
3 |       "cca2": "AW",
4 |       "currencies": { "AWG": { "name": "Aruban florin", "symbol": "ƒ" } },
5 |       "languages": { "nld": "Dutch", "pap": "Papiamento" },
6 |       "flag": "🇦🇼"
7 |     },
8 |     {
9 |       "cca2": "AF",
10 |       "currencies": { "AFN": { "name": "Afghan afghani", "symbol": "؋" } },
11 |       "languages": { "prs": "Dari", "pus": "Pashto", "tuk": "Turkmen" },
12 |       "flag": "🇦🇫"
13 |     },
14 |     {
15 |       "cca2": "AO",
16 |       "currencies": { "AOA": { "name": "Angolan kwanza", "symbol": "Kz" } },
17 |       "languages": { "por": "Portuguese" },
18 |       "flag": "🇦🇴"
19 |     },
20 |     {
21 |       "cca2": "AI",
22 |       "currencies": {
23 |         "XCD": { "name": "Eastern Caribbean dollar", "symbol": "$" }
24 |       },
25 |       "languages": { "eng": "English" },
26 |       "flag": "🇦🇮"
27 |     },
28 |     {
29 |       "cca2": "AX",
30 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
31 |       "languages": { "swe": "Swedish" },
32 |       "flag": "🇦🇽"
33 |     },
34 |     {
35 |       "cca2": "AL",
36 |       "currencies": { "ALL": { "name": "Albanian lek", "symbol": "L" } },
37 |       "languages": { "sqi": "Albanian" },
38 |       "flag": "🇦🇱"
39 |     },
40 |     {
41 |       "cca2": "AD",
42 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
43 |       "languages": { "cat": "Catalan" },
44 |       "flag": "🇦🇩"
45 |     },
46 |     {
47 |       "cca2": "AE",
48 |       "currencies": {
49 |         "AED": { "name": "United Arab Emirates dirham", "symbol": "د.إ" }
50 |       },
51 |       "languages": { "ara": "Arabic" },
52 |       "flag": "🇦🇪"
53 |     },
54 |     {
55 |       "cca2": "AR",
56 |       "currencies": { "ARS": { "name": "Argentine peso", "symbol": "$" } },
57 |       "languages": { "grn": "Guaraní", "spa": "Spanish" },
58 |       "flag": "🇦🇷"
59 |     },
60 |     {
61 |       "cca2": "AM",
62 |       "currencies": { "AMD": { "name": "Armenian dram", "symbol": "֏" } },
63 |       "languages": { "hye": "Armenian" },
64 |       "flag": "🇦🇲"
65 |     },
66 |     {
67 |       "cca2": "AS",
68 |       "currencies": { "USD": { "name": "United States dollar", "symbol": "$" } },
69 |       "languages": { "eng": "English", "smo": "Samoan" },
70 |       "flag": "🇦🇸"
71 |     },
72 |     { "cca2": "AQ", "currencies": [], "languages": {}, "flag": "🇦🇶" },
73 |     {
74 |       "cca2": "TF",
75 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
76 |       "languages": { "fra": "French" },
77 |       "flag": "🇹🇫"
78 |     },
79 |     {
80 |       "cca2": "AG",
81 |       "currencies": {
82 |         "XCD": { "name": "Eastern Caribbean dollar", "symbol": "$" }
83 |       },
84 |       "languages": { "eng": "English" },
85 |       "flag": "🇦🇬"
86 |     },
87 |     {
88 |       "cca2": "AU",
89 |       "currencies": { "AUD": { "name": "Australian dollar", "symbol": "$" } },
90 |       "languages": { "eng": "English" },
91 |       "flag": "🇦🇺"
92 |     },
93 |     {
94 |       "cca2": "AT",
95 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
96 |       "languages": { "bar": "Austro-Bavarian German" },
97 |       "flag": "🇦🇹"
98 |     },
99 |     {
100 |       "cca2": "AZ",
101 |       "currencies": { "AZN": { "name": "Azerbaijani manat", "symbol": "₼" } },
102 |       "languages": { "aze": "Azerbaijani", "rus": "Russian" },
103 |       "flag": "🇦🇿"
104 |     },
105 |     {
106 |       "cca2": "BI",
107 |       "currencies": { "BIF": { "name": "Burundian franc", "symbol": "Fr" } },
108 |       "languages": { "fra": "French", "run": "Kirundi" },
109 |       "flag": "🇧🇮"
110 |     },
111 |     {
112 |       "cca2": "BE",
113 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
114 |       "languages": { "deu": "German", "fra": "French", "nld": "Dutch" },
115 |       "flag": "🇧🇪"
116 |     },
117 |     {
118 |       "cca2": "BJ",
119 |       "currencies": {
120 |         "XOF": { "name": "West African CFA franc", "symbol": "Fr" }
121 |       },
122 |       "languages": { "fra": "French" },
123 |       "flag": "🇧🇯"
124 |     },
125 |     {
126 |       "cca2": "BF",
127 |       "currencies": {
128 |         "XOF": { "name": "West African CFA franc", "symbol": "Fr" }
129 |       },
130 |       "languages": { "fra": "French" },
131 |       "flag": "🇧🇫"
132 |     },
133 |     {
134 |       "cca2": "BD",
135 |       "currencies": { "BDT": { "name": "Bangladeshi taka", "symbol": "৳" } },
136 |       "languages": { "ben": "Bengali" },
137 |       "flag": "🇧🇩"
138 |     },
139 |     {
140 |       "cca2": "BG",
141 |       "currencies": { "BGN": { "name": "Bulgarian lev", "symbol": "лв" } },
142 |       "languages": { "bul": "Bulgarian" },
143 |       "flag": "🇧🇬"
144 |     },
145 |     {
146 |       "cca2": "BH",
147 |       "currencies": { "BHD": { "name": "Bahraini dinar", "symbol": ".د.ب" } },
148 |       "languages": { "ara": "Arabic" },
149 |       "flag": "🇧🇭"
150 |     },
151 |     {
152 |       "cca2": "BS",
153 |       "currencies": {
154 |         "BSD": { "name": "Bahamian dollar", "symbol": "$" },
155 |         "USD": { "name": "United States dollar", "symbol": "$" }
156 |       },
157 |       "languages": { "eng": "English" },
158 |       "flag": "🇧🇸"
159 |     },
160 |     {
161 |       "cca2": "BA",
162 |       "currencies": {
163 |         "BAM": { "name": "Bosnia and Herzegovina convertible mark", "symbol": "" }
164 |       },
165 |       "languages": { "bos": "Bosnian", "hrv": "Croatian", "srp": "Serbian" },
166 |       "flag": "🇧🇦"
167 |     },
168 |     {
169 |       "cca2": "BL",
170 |       "currencies": { "EUR": { "name": "Euro", "symbol": "€" } },
171 |       "languages": { "fra": "French" },
172 |       "flag": "🇧🇱"
173 |     },
174 |     {
175 |       "cca2": "SH",
176 |       "currencies": {
177 |         "GBP": { "name": "Pound sterling", "symbol": "£" },
178 |         "SHP": { "name": "Saint Helena pound", "symbol": "£" }
179 |       },
180 |       "languages": { "eng": "English" },
181 |       "flag": "🇸🇭"
182 |     },
183 |     {
184 |       "cca2": "BY",
185 |       "currencies": { "BYN": { "name": "Belarusian ruble", "symbol": "Br" } },
186 |       "languages": { "bel": "Belarusian", "rus": "Russian" },
187 |       "flag": "🇧🇾"
188 |     },
189 |     {
[TRUNCATED]
```

packages/location/src/countries.ts
```
1 | import countries from "./countries.json";
2 |
3 | export { countries };
```

packages/location/src/country-flags.ts
```
1 | export default {
2 |   AC: {
3 |     code: "AC",
4 |     unicode: "U+1F1E6 U+1F1E8",
5 |     name: "Ascension Island",
6 |     emoji: "🇦🇨",
7 |   },
8 |   AD: {
9 |     code: "AD",
10 |     unicode: "U+1F1E6 U+1F1E9",
11 |     name: "Andorra",
12 |     emoji: "🇦🇩",
13 |   },
14 |   AE: {
15 |     code: "AE",
16 |     unicode: "U+1F1E6 U+1F1EA",
17 |     name: "United Arab Emirates",
18 |     emoji: "🇦🇪",
19 |   },
20 |   AF: {
21 |     code: "AF",
22 |     unicode: "U+1F1E6 U+1F1EB",
23 |     name: "Afghanistan",
24 |     emoji: "🇦🇫",
25 |   },
26 |   AG: {
27 |     code: "AG",
28 |     unicode: "U+1F1E6 U+1F1EC",
29 |     name: "Antigua & Barbuda",
30 |     emoji: "🇦🇬",
31 |   },
32 |   AI: {
33 |     code: "AI",
34 |     unicode: "U+1F1E6 U+1F1EE",
35 |     name: "Anguilla",
36 |     emoji: "🇦🇮",
37 |   },
38 |   AL: {
39 |     code: "AL",
40 |     unicode: "U+1F1E6 U+1F1F1",
41 |     name: "Albania",
42 |     emoji: "🇦🇱",
43 |   },
44 |   AM: {
45 |     code: "AM",
46 |     unicode: "U+1F1E6 U+1F1F2",
47 |     name: "Armenia",
48 |     emoji: "🇦🇲",
49 |   },
50 |   AO: {
51 |     code: "AO",
52 |     unicode: "U+1F1E6 U+1F1F4",
53 |     name: "Angola",
54 |     emoji: "🇦🇴",
55 |   },
56 |   AQ: {
57 |     code: "AQ",
58 |     unicode: "U+1F1E6 U+1F1F6",
59 |     name: "Antarctica",
60 |     emoji: "🇦🇶",
61 |   },
62 |   AR: {
63 |     code: "AR",
64 |     unicode: "U+1F1E6 U+1F1F7",
65 |     name: "Argentina",
66 |     emoji: "🇦🇷",
67 |   },
68 |   AS: {
69 |     code: "AS",
70 |     unicode: "U+1F1E6 U+1F1F8",
71 |     name: "American Samoa",
72 |     emoji: "🇦🇸",
73 |   },
74 |   AT: {
75 |     code: "AT",
76 |     unicode: "U+1F1E6 U+1F1F9",
77 |     name: "Austria",
78 |     emoji: "🇦🇹",
79 |   },
80 |   AU: {
81 |     code: "AU",
82 |     unicode: "U+1F1E6 U+1F1FA",
83 |     name: "Australia",
84 |     emoji: "🇦🇺",
85 |   },
86 |   AW: {
87 |     code: "AW",
88 |     unicode: "U+1F1E6 U+1F1FC",
89 |     name: "Aruba",
90 |     emoji: "🇦🇼",
91 |   },
92 |   AX: {
93 |     code: "AX",
94 |     unicode: "U+1F1E6 U+1F1FD",
95 |     name: "Åland Islands",
96 |     emoji: "🇦🇽",
97 |   },
98 |   AZ: {
99 |     code: "AZ",
100 |     unicode: "U+1F1E6 U+1F1FF",
101 |     name: "Azerbaijan",
102 |     emoji: "🇦🇿",
103 |   },
104 |   BA: {
105 |     code: "BA",
106 |     unicode: "U+1F1E7 U+1F1E6",
107 |     name: "Bosnia & Herzegovina",
108 |     emoji: "🇧🇦",
109 |   },
110 |   BB: {
111 |     code: "BB",
112 |     unicode: "U+1F1E7 U+1F1E7",
113 |     name: "Barbados",
114 |     emoji: "🇧🇧",
115 |   },
116 |   BD: {
117 |     code: "BD",
118 |     unicode: "U+1F1E7 U+1F1E9",
119 |     name: "Bangladesh",
120 |     emoji: "🇧🇩",
121 |   },
122 |   BE: {
123 |     code: "BE",
124 |     unicode: "U+1F1E7 U+1F1EA",
125 |     name: "Belgium",
126 |     emoji: "🇧🇪",
127 |   },
128 |   BF: {
129 |     code: "BF",
130 |     unicode: "U+1F1E7 U+1F1EB",
131 |     name: "Burkina Faso",
132 |     emoji: "🇧🇫",
133 |   },
134 |   BG: {
135 |     code: "BG",
136 |     unicode: "U+1F1E7 U+1F1EC",
137 |     name: "Bulgaria",
138 |     emoji: "🇧🇬",
139 |   },
140 |   BH: {
141 |     code: "BH",
142 |     unicode: "U+1F1E7 U+1F1ED",
143 |     name: "Bahrain",
144 |     emoji: "🇧🇭",
145 |   },
146 |   BI: {
147 |     code: "BI",
148 |     unicode: "U+1F1E7 U+1F1EE",
149 |     name: "Burundi",
150 |     emoji: "🇧🇮",
151 |   },
152 |   BJ: {
153 |     code: "BJ",
154 |     unicode: "U+1F1E7 U+1F1EF",
155 |     name: "Benin",
156 |     emoji: "🇧🇯",
157 |   },
158 |   BL: {
159 |     code: "BL",
160 |     unicode: "U+1F1E7 U+1F1F1",
161 |     name: "St. Barthélemy",
162 |     emoji: "🇧🇱",
163 |   },
164 |   BM: {
165 |     code: "BM",
166 |     unicode: "U+1F1E7 U+1F1F2",
167 |     name: "Bermuda",
168 |     emoji: "🇧🇲",
169 |   },
170 |   BN: {
171 |     code: "BN",
172 |     unicode: "U+1F1E7 U+1F1F3",
173 |     name: "Brunei",
174 |     emoji: "🇧🇳",
175 |   },
176 |   BO: {
177 |     code: "BO",
178 |     unicode: "U+1F1E7 U+1F1F4",
179 |     name: "Bolivia",
180 |     emoji: "🇧🇴",
181 |   },
182 |   BQ: {
183 |     code: "BQ",
184 |     unicode: "U+1F1E7 U+1F1F6",
185 |     name: "Caribbean Netherlands",
186 |     emoji: "🇧🇶",
187 |   },
188 |   BR: {
189 |     code: "BR",
190 |     unicode: "U+1F1E7 U+1F1F7",
191 |     name: "Brazil",
192 |     emoji: "🇧🇷",
193 |   },
194 |   BS: {
195 |     code: "BS",
196 |     unicode: "U+1F1E7 U+1F1F8",
197 |     name: "Bahamas",
198 |     emoji: "🇧🇸",
199 |   },
200 |   BT: {
201 |     code: "BT",
202 |     unicode: "U+1F1E7 U+1F1F9",
203 |     name: "Bhutan",
204 |     emoji: "🇧🇹",
205 |   },
206 |   BV: {
207 |     code: "BV",
208 |     unicode: "U+1F1E7 U+1F1FB",
209 |     name: "Bouvet Island",
210 |     emoji: "🇧🇻",
211 |   },
212 |   BW: {
213 |     code: "BW",
214 |     unicode: "U+1F1E7 U+1F1FC",
215 |     name: "Botswana",
216 |     emoji: "🇧🇼",
217 |   },
218 |   BY: {
219 |     code: "BY",
220 |     unicode: "U+1F1E7 U+1F1FE",
221 |     name: "Belarus",
[TRUNCATED]
```

packages/location/src/currencies.ts
```
1 | /**
2 |  * An object that maps a 2 char country code to its official 3 char currency code.
3 |  * [View all supported countries](https://github.com/sumup-oss/intl-js/blob/main/src/data/currencies.ts).
4 |  */
5 | export const currencies = {
6 |   // Andorra
7 |   AD: "EUR",
8 |   // United Arab Emirates
9 |   AE: "AED",
10 |   // Afghanistan
11 |   AF: "AFN",
12 |   // Antigua and Barbuda
13 |   AG: "XCD",
14 |   // Anguilla
15 |   AI: "XCD",
16 |   // Albania
17 |   AL: "ALL",
18 |   // Armenia
19 |   AM: "AMD",
20 |   // Netherlands Antilles
21 |   AN: "ANG",
22 |   // Angola
23 |   AO: "AOA",
24 |   // Antarctica
25 |   AQ: "AQD",
26 |   // Argentina
27 |   AR: "ARS",
28 |   // American Samoa
29 |   AS: "USD",
30 |   // Austria
31 |   AT: "EUR",
32 |   // Australia
33 |   AU: "AUD",
34 |   // Aruba
35 |   AW: "ANG",
36 |   // Aland Islands
37 |   AX: "EUR",
38 |   // Azerbaijan
39 |   AZ: "AZN",
40 |   // Bosnia and Herzegovina
41 |   BA: "BAM",
42 |   // Barbados
43 |   BB: "BBD",
44 |   // Bangladesh
45 |   BD: "BDT",
46 |   // Belgium
47 |   BE: "EUR",
48 |   // Burkina Faso
49 |   BF: "XOF",
50 |   // Bulgaria
51 |   BG: "BGN",
52 |   // Bahrain
53 |   BH: "BHD",
54 |   // Burundi
55 |   BI: "BIF",
56 |   // Benin
57 |   BJ: "XOF",
58 |   // Saint Barthelemy
59 |   BL: "EUR",
60 |   // Bermuda
61 |   BM: "BMD",
62 |   // Brunei Darussalam
63 |   BN: "BND",
64 |   // Bolivia
65 |   BO: "BOB",
66 |   // Brazil
67 |   BR: "BRL",
68 |   // Bahamas
69 |   BS: "BSD",
70 |   // Bhutan
71 |   BT: "INR",
72 |   // Bouvet Island
73 |   BV: "NOK",
74 |   // Botswana
75 |   BW: "BWP",
76 |   // Belarus
77 |   BY: "BYR",
78 |   // Belize
79 |   BZ: "BZD",
80 |   // Canada
81 |   CA: "CAD",
82 |   // Cocos (Keeling) Islands
83 |   CC: "AUD",
84 |   // Congo
85 |   CD: "CDF",
86 |   // Central African Republic
87 |   CF: "XAF",
88 |   // Congo Republic of the Democratic
89 |   CG: "XAF",
90 |   // Switzerland
91 |   CH: "CHF",
92 |   // Ivory Coast
93 |   CI: "XOF",
94 |   // Cook Islands
95 |   CK: "NZD",
96 |   // Chile
97 |   CL: "CLP",
98 |   // Cameroon
99 |   CM: "XAF",
100 |   // China
101 |   CN: "CNY",
102 |   // Colombia
103 |   CO: "COP",
104 |   // Costa Rica
105 |   CR: "CRC",
106 |   // Cuba
107 |   CU: "CUP",
108 |   // Cape Verde
109 |   CV: "CVE",
110 |   // Christmas Island
111 |   CX: "AUD",
112 |   // Cyprus
113 |   CY: "EUR",
114 |   // Czech Republic
115 |   CZ: "CZK",
116 |   // Germany
117 |   DE: "EUR",
118 |   // Djibouti
119 |   DJ: "DJF",
120 |   // Denmark
121 |   DK: "DKK",
122 |   // Dominica
123 |   DM: "XCD",
124 |   // Dominican Republic
125 |   DO: "DOP",
126 |   // Algeria
127 |   DZ: "DZD",
128 |   // Ecuador
129 |   EC: "USD",
130 |   // Estonia
131 |   EE: "EUR",
132 |   // Egypt
133 |   EG: "EGP",
134 |   // Western Sahara
135 |   EH: "MAD",
136 |   // Eritrea
137 |   ER: "ERN",
138 |   // Spain
139 |   ES: "EUR",
140 |   // Ethiopia
141 |   ET: "ETB",
142 |   // Finland
143 |   FI: "EUR",
144 |   // Fiji
145 |   FJ: "FJD",
146 |   // Falkland Islands (Malvinas)
147 |   FK: "FKP",
148 |   // Micronesia Federated States of
149 |   FM: "USD",
150 |   // Faroe Islands
151 |   FO: "DKK",
152 |   // France
153 |   FR: "EUR",
154 |   // Gabon
155 |   GA: "XAF",
156 |   // United Kingdom
157 |   GB: "GBP",
158 |   // Grenada
159 |   GD: "XCD",
160 |   // Georgia
161 |   GE: "GEL",
162 |   // French Guiana
163 |   GF: "EUR",
164 |   // Guernsey
165 |   GG: "GGP",
166 |   // Ghana
167 |   GH: "GHS",
168 |   // Gibraltar
169 |   GI: "GIP",
170 |   // Greenland
171 |   GL: "DKK",
172 |   // Gambia
173 |   GM: "GMD",
174 |   // Guinea
175 |   GN: "GNF",
176 |   // Guadeloupe
177 |   GP: "EUR",
178 |   // Equatorial Guinea
179 |   GQ: "XAF",
180 |   // Greece
181 |   GR: "EUR",
182 |   // South Georgia and the South Sandwich Islands
183 |   GS: "GBP",
184 |   // Guatemala
185 |   GT: "GTQ",
186 |   // Guam
187 |   GU: "USD",
188 |   // Guinea-Bissau
189 |   GW: "XOF",
190 |   // Guyana
191 |   GY: "GYD",
192 |   // Hong Kong
193 |   HK: "HKD",
194 |   // Heard and Mc Donald Islands
195 |   HM: "AUD",
196 |   // Honduras
197 |   HN: "HNL",
198 |   // Croatia (Hrvatska)
199 |   HR: "EUR",
200 |   // Haiti
201 |   HT: "HTG",
202 |   // Hungary
203 |   HU: "HUF",
204 |   // Indonesia
205 |   ID: "IDR",
206 |   // Ireland
207 |   IE: "EUR",
208 |   // Israel
209 |   IL: "ILS",
210 |   // Isle of Man
211 |   IM: "GBP",
212 |   // India
[TRUNCATED]
```

packages/location/src/eu-countries.ts
```
1 | export const EU_COUNTRY_CODES = [
2 |   "AT",
3 |   "BE",
4 |   "BG",
5 |   "HR",
6 |   "CY",
7 |   "CZ",
8 |   "DK",
9 |   "EE",
10 |   "FI",
11 |   "FR",
12 |   "DE",
13 |   "GR",
14 |   "HU",
15 |   "IE",
16 |   "IT",
17 |   "LV",
18 |   "LT",
19 |   "LU",
20 |   "MT",
21 |   "NL",
22 |   "PL",
23 |   "PT",
24 |   "RO",
25 |   "SK",
26 |   "SI",
27 |   "ES",
28 |   "SE",
29 |   "GB",
30 |   "GI",
31 |   "IS",
32 |   "LI",
33 |   "NO",
34 |   "CH",
35 |   "ME",
36 |   "MK",
37 |   "RS",
38 |   "TR",
39 |   "AL",
40 |   "BA",
41 |   "XK",
42 |   "AD",
43 |   "BY",
44 |   "MD",
45 |   "MC",
46 |   "RU",
47 |   "UA",
48 |   "VA",
49 |   "AX",
50 |   "FO",
51 |   "GL",
52 |   "SJ",
53 |   "IM",
54 |   "JE",
55 |   "GG",
56 |   "RS",
57 |   "ME",
58 |   "XK",
59 |   "RS",
60 | ];
```

packages/location/src/index.ts
```
1 | import { headers } from "next/headers";
2 | import countries from "./countries.json";
3 | import flags from "./country-flags";
4 | import { currencies } from "./currencies";
5 | import { EU_COUNTRY_CODES } from "./eu-countries";
6 | import timezones from "./timezones.json";
7 |
8 | export function getCountryCode() {
9 |   return headers().get("x-vercel-ip-country") || "SE";
10 | }
11 |
12 | export function getTimezone() {
13 |   return headers().get("x-vercel-ip-timezone") || "Europe/Berlin";
14 | }
15 |
16 | export function getLocale() {
17 |   return headers().get("x-vercel-ip-locale") || "en-US";
18 | }
19 |
20 | export function getTimezones() {
21 |   return timezones;
22 | }
23 | export function getCurrency() {
24 |   const countryCode = getCountryCode();
25 |
26 |   return currencies[countryCode as keyof typeof currencies];
27 | }
28 |
29 | export function getDateFormat() {
30 |   const country = getCountryCode();
31 |
32 |   // US uses MM/dd/yyyy
33 |   if (country === "US") {
34 |     return "MM/dd/yyyy";
35 |   }
36 |
37 |   // China, Japan, Korea, Taiwan use yyyy-MM-dd
38 |   if (["CN", "JP", "KR", "TW"].includes(country)) {
39 |     return "yyyy-MM-dd";
40 |   }
41 |   // Most Latin American, African, and some Asian countries use dd/MM/yyyy
42 |   if (["AU", "NZ", "IN", "ZA", "BR", "AR"].includes(country)) {
43 |     return "dd/MM/yyyy";
44 |   }
45 |
46 |   // Default to yyyy-MM-dd for other countries
47 |   return "yyyy-MM-dd";
48 | }
49 |
50 | export function getCountryInfo() {
51 |   const country = getCountryCode();
52 |
53 |   const countryInfo = countries.find((x) => x.cca2 === country);
54 |
55 |   const currencyCode =
56 |     countryInfo && Object.keys(countryInfo.currencies)?.at(0);
57 |   const currency = countryInfo?.currencies[currencyCode];
58 |   const languages =
59 |     countryInfo && Object.values(countryInfo.languages).join(", ");
60 |
61 |   return {
62 |     currencyCode,
63 |     currency,
64 |     languages,
65 |   };
66 | }
67 |
68 | export function isEU() {
69 |   const countryCode = getCountryCode();
70 |
71 |   if (countryCode && EU_COUNTRY_CODES.includes(countryCode)) {
72 |     return true;
73 |   }
74 |
75 |   return false;
76 | }
77 |
78 | export function getCountry() {
79 |   const country = getCountryCode();
80 |
81 |   return flags[country];
82 | }
```

packages/location/src/timezones.json
```
1 | [
2 |   {
3 |     "label": "Pacific/Midway (GMT-11:00)",
4 |     "tzCode": "Pacific/Midway",
5 |     "name": "(GMT-11:00) Midway",
6 |     "utc": "-11:00"
7 |   },
8 |   {
9 |     "label": "Pacific/Niue (GMT-11:00)",
10 |     "tzCode": "Pacific/Niue",
11 |     "name": "(GMT-11:00) Alofi",
12 |     "utc": "-11:00"
13 |   },
14 |   {
15 |     "label": "Pacific/Pago_Pago (GMT-11:00)",
16 |     "tzCode": "Pacific/Pago_Pago",
17 |     "name": "(GMT-11:00) Pago Pago, Tāfuna, Ta`ū, Taulaga",
18 |     "utc": "-11:00"
19 |   },
20 |   {
21 |     "label": "America/Adak (GMT-10:00)",
22 |     "tzCode": "America/Adak",
23 |     "name": "(GMT-10:00) Adak",
24 |     "utc": "-10:00"
25 |   },
26 |   {
27 |     "label": "Pacific/Honolulu (GMT-10:00)",
28 |     "tzCode": "Pacific/Honolulu",
29 |     "name": "(GMT-10:00) Honolulu, East Honolulu, Pearl City, Hilo, Kailua",
30 |     "utc": "-10:00"
31 |   },
32 |   {
33 |     "label": "Pacific/Rarotonga (GMT-10:00)",
34 |     "tzCode": "Pacific/Rarotonga",
35 |     "name": "(GMT-10:00) Avarua",
36 |     "utc": "-10:00"
37 |   },
38 |   {
39 |     "label": "Pacific/Tahiti (GMT-10:00)",
40 |     "tzCode": "Pacific/Tahiti",
41 |     "name": "(GMT-10:00) Faaa, Papeete, Punaauia, Pirae, Mahina",
42 |     "utc": "-10:00"
43 |   },
44 |   {
45 |     "label": "Pacific/Marquesas (GMT-09:30)",
46 |     "tzCode": "Pacific/Marquesas",
47 |     "name": "(GMT-09:30) Taiohae",
48 |     "utc": "-09:30"
49 |   },
50 |   {
51 |     "label": "America/Anchorage (GMT-09:00)",
52 |     "tzCode": "America/Anchorage",
53 |     "name": "(GMT-09:00) Anchorage, Fairbanks, Eagle River, Badger, Knik-Fairview",
54 |     "utc": "-09:00"
55 |   },
56 |   {
57 |     "label": "America/Juneau (GMT-09:00)",
58 |     "tzCode": "America/Juneau",
59 |     "name": "(GMT-09:00) Juneau",
60 |     "utc": "-09:00"
61 |   },
62 |   {
63 |     "label": "America/Metlakatla (GMT-09:00)",
64 |     "tzCode": "America/Metlakatla",
65 |     "name": "(GMT-09:00) Metlakatla",
66 |     "utc": "-09:00"
67 |   },
68 |   {
69 |     "label": "America/Nome (GMT-09:00)",
70 |     "tzCode": "America/Nome",
71 |     "name": "(GMT-09:00) Nome",
72 |     "utc": "-09:00"
73 |   },
74 |   {
75 |     "label": "America/Sitka (GMT-09:00)",
76 |     "tzCode": "America/Sitka",
77 |     "name": "(GMT-09:00) Sitka, Ketchikan",
78 |     "utc": "-09:00"
79 |   },
80 |   {
81 |     "label": "America/Yakutat (GMT-09:00)",
82 |     "tzCode": "America/Yakutat",
83 |     "name": "(GMT-09:00) Yakutat",
84 |     "utc": "-09:00"
85 |   },
86 |   {
87 |     "label": "Pacific/Gambier (GMT-09:00)",
88 |     "tzCode": "Pacific/Gambier",
89 |     "name": "(GMT-09:00) Gambier",
90 |     "utc": "-09:00"
91 |   },
92 |   {
93 |     "label": "America/Los_Angeles (GMT-08:00)",
94 |     "tzCode": "America/Los_Angeles",
95 |     "name": "(GMT-08:00) Los Angeles, San Diego, San Jose, San Francisco, Seattle",
96 |     "utc": "-08:00"
97 |   },
98 |   {
99 |     "label": "America/Tijuana (GMT-08:00)",
100 |     "tzCode": "America/Tijuana",
101 |     "name": "(GMT-08:00) Tijuana, Mexicali, Ensenada, Rosarito, Tecate",
102 |     "utc": "-08:00"
103 |   },
104 |   {
105 |     "label": "America/Vancouver (GMT-08:00)",
106 |     "tzCode": "America/Vancouver",
107 |     "name": "(GMT-08:00) Vancouver, Surrey, Okanagan, Victoria, Burnaby",
108 |     "utc": "-08:00"
109 |   },
110 |   {
111 |     "label": "Pacific/Pitcairn (GMT-08:00)",
112 |     "tzCode": "Pacific/Pitcairn",
113 |     "name": "(GMT-08:00) Adamstown",
114 |     "utc": "-08:00"
115 |   },
116 |   {
117 |     "label": "America/Boise (GMT-07:00)",
118 |     "tzCode": "America/Boise",
119 |     "name": "(GMT-07:00) Boise, Meridian, Nampa, Idaho Falls, Pocatello",
120 |     "utc": "-07:00"
121 |   },
122 |   {
123 |     "label": "America/Cambridge_Bay (GMT-07:00)",
124 |     "tzCode": "America/Cambridge_Bay",
125 |     "name": "(GMT-07:00) Cambridge Bay",
126 |     "utc": "-07:00"
127 |   },
128 |   {
129 |     "label": "America/Chihuahua (GMT-07:00)",
130 |     "tzCode": "America/Chihuahua",
131 |     "name": "(GMT-07:00) Chihuahua, Ciudad Delicias, Cuauhtémoc, Parral, Nuevo Casas Grandes",
132 |     "utc": "-07:00"
133 |   },
134 |   {
135 |     "label": "America/Creston (GMT-07:00)",
136 |     "tzCode": "America/Creston",
137 |     "name": "(GMT-07:00) Creston",
138 |     "utc": "-07:00"
139 |   },
140 |   {
141 |     "label": "America/Dawson (GMT-07:00)",
142 |     "tzCode": "America/Dawson",
143 |     "name": "(GMT-07:00) Dawson",
144 |     "utc": "-07:00"
145 |   },
146 |   {
147 |     "label": "America/Dawson_Creek (GMT-07:00)",
148 |     "tzCode": "America/Dawson_Creek",
149 |     "name": "(GMT-07:00) Fort St. John, Dawson Creek",
150 |     "utc": "-07:00"
151 |   },
152 |   {
153 |     "label": "America/Denver (GMT-07:00)",
154 |     "tzCode": "America/Denver",
155 |     "name": "(GMT-07:00) Denver, El Paso, Albuquerque, Colorado Springs, Aurora",
156 |     "utc": "-07:00"
157 |   },
[TRUNCATED]
```

packages/notification/src/index.ts
```
1 | import { Novu } from "@novu/node";
2 | import { nanoid } from "nanoid";
3 |
4 | const novu = new Novu(process.env.NOVU_API_KEY!);
5 |
6 | const API_ENDPOINT = "https://api.novu.co/v1";
7 |
8 | export enum TriggerEvents {
9 |   TransactionNewInApp = "transaction_new_in_app",
10 |   TransactionsNewInApp = "transactions_new_in_app",
11 |   TransactionNewEmail = "transaction_new_email",
12 |   InboxNewInApp = "inbox_new_in_app",
13 |   MatchNewInApp = "match_in_app",
14 |   InvoicePaidInApp = "invoice_paid_in_app",
15 |   InvoicePaidEmail = "invoice_paid_email",
16 |   InvoiceOverdueInApp = "invoice_overdue_in_app",
17 |   InvoiceOverdueEmail = "invoice_overdue_email",
18 | }
19 |
20 | export enum NotificationTypes {
21 |   Transaction = "transaction",
22 |   Transactions = "transactions",
23 |   Inbox = "inbox",
24 |   Match = "match",
25 |   Invoice = "invoice",
26 | }
27 |
28 | type TriggerUser = {
29 |   subscriberId: string;
30 |   email: string;
31 |   fullName: string;
32 |   avatarUrl?: string;
33 |   teamId: string;
34 | };
35 |
36 | type TriggerPayload = {
37 |   name: TriggerEvents;
38 |   payload: any;
39 |   user: TriggerUser;
40 |   replyTo?: string;
41 |   tenant?: string; // NOTE: Currently no way to listen for messages with tenant, we use team_id + user_id for unique
42 | };
43 |
44 | export async function trigger(data: TriggerPayload) {
45 |   try {
46 |     await novu.trigger(data.name, {
47 |       to: {
48 |         ...data.user,
49 |         //   Prefix subscriber id with team id
50 |         subscriberId: `${data.user.teamId}_${data.user.subscriberId}`,
51 |       },
52 |       payload: data.payload,
53 |       tenant: data.tenant,
54 |       overrides: {
55 |         email: {
56 |           replyTo: data.replyTo,
57 |           // @ts-ignore
58 |           headers: {
59 |             "X-Entity-Ref-ID": nanoid(),
60 |           },
61 |         },
62 |       },
63 |     });
64 |   } catch (error) {
65 |     console.log(error);
66 |   }
67 | }
68 |
69 | export async function triggerBulk(events: TriggerPayload[]) {
70 |   try {
71 |     await novu.bulkTrigger(
72 |       events.map((data) => ({
73 |         name: data.name,
74 |         to: {
75 |           ...data.user,
76 |           //   Prefix subscriber id with team id
77 |           subscriberId: `${data.user.teamId}_${data.user.subscriberId}`,
78 |         },
79 |         payload: data.payload,
80 |         tenant: data.tenant,
81 |         overrides: {
82 |           email: {
83 |             replyTo: data.replyTo,
84 |             headers: {
85 |               "X-Entity-Ref-ID": nanoid(),
86 |             },
87 |           },
88 |         },
89 |       })),
90 |     );
91 |   } catch (error) {
92 |     console.log(error);
93 |   }
94 | }
95 |
96 | type GetSubscriberPreferencesParams = {
97 |   teamId: string;
98 |   subscriberId: string;
99 | };
100 |
101 | export async function getSubscriberPreferences({
102 |   subscriberId,
103 |   teamId,
104 | }: GetSubscriberPreferencesParams) {
105 |   const response = await fetch(
106 |     `${API_ENDPOINT}/subscribers/${teamId}_${subscriberId}/preferences?includeInactiveChannels=false`,
107 |     {
108 |       method: "GET",
109 |       headers: {
110 |         Authorization: `ApiKey ${process.env.NOVU_API_KEY!}`,
111 |       },
112 |     },
113 |   );
114 |
115 |   return response.json();
116 | }
117 |
118 | type UpdateSubscriberPreferenceParams = {
119 |   subscriberId: string;
120 |   teamId: string;
121 |   templateId: string;
122 |   type: string;
123 |   enabled: boolean;
124 | };
125 |
126 | export async function updateSubscriberPreference({
127 |   subscriberId,
128 |   teamId,
129 |   templateId,
130 |   type,
131 |   enabled,
132 | }: UpdateSubscriberPreferenceParams) {
133 |   const response = await fetch(
134 |     `${API_ENDPOINT}/subscribers/${teamId}_${subscriberId}/preferences/${templateId}`,
135 |     {
136 |       method: "PATCH",
137 |       headers: {
138 |         Authorization: `ApiKey ${process.env.NOVU_API_KEY!}`,
139 |         "Content-Type": "application/json",
140 |       },
141 |       body: JSON.stringify({
142 |         channel: {
143 |           type,
144 |           enabled,
145 |         },
146 |       }),
147 |     },
148 |   );
149 |
150 |   return response.json();
151 | }
```

packages/ui/src/globals.css
```
1 | @tailwind base;
2 | @tailwind components;
3 | @tailwind utilities;
4 |
5 | @layer base {
6 |   :root {
7 |     --background: 0, 0%, 100%;
8 |     --foreground: 0, 0%, 7%;
9 |     --card: 45 18% 96%;
10 |     --card-foreground: 240 10% 3.9%;
11 |     --popover: 45 18% 96%;
12 |     --popover-foreground: 240 10% 3.9%;
13 |     --primary: 240 5.9% 10%;
14 |     --primary-foreground: 0 0% 98%;
15 |     --secondary: 40, 11%, 89%;
16 |     --secondary-foreground: 240 5.9% 10%;
17 |     --muted: 40, 11%, 89%;
18 |     --muted-foreground: 240 3.8% 46.1%;
19 |     --accent: 40, 10%, 94%;
20 |     --accent-foreground: 240 5.9% 10%;
21 |     --destructive: 0 84.2% 60.2%;
22 |     --destructive-foreground: 0 0% 98%;
23 |     --muted-foreground: 0, 0%, 38%;
24 |     --border: 45, 5%, 85%;
25 |     --input: 240 5.9% 90%;
26 |     --ring: 240 5.9% 10%;
27 |     --radius: 0.5rem;
28 |   }
29 |
30 |   .dark {
31 |     --background: 0, 0%, 7%;
32 |     --foreground: 0 0% 98%;
33 |     --card: 0, 0%, 7%;
34 |     --card-foreground: 0 0% 98%;
35 |     --popover: 0, 0%, 7%;
36 |     --popover-foreground: 0 0% 98%;
37 |     --primary: 0 0% 98%;
38 |     --primary-foreground: 240 5.9% 10%;
39 |     --secondary: 0, 0%, 11%;
40 |     --secondary-foreground: 0 0% 98%;
41 |     --muted: 0, 0%, 11%;
42 |     --muted-foreground: 240 5% 64.9%;
43 |     --accent: 0, 0%, 11%;
44 |     --accent-foreground: 0 0% 98%;
45 |     --destructive: 359, 100%, 61%;
46 |     --destructive-foreground: 0, 0%, 100%;
47 |     --muted-foreground: 0, 0%, 38%;
48 |     --border: 0, 0%, 17%;
49 |     --input: 0, 0%, 11%;
50 |     --ring: 240 4.9% 83.9%;
51 |   }
52 | }
53 |
54 | @layer base {
55 |   * {
56 |     @apply border-border;
57 |   }
58 |   body {
59 |     font-family: var(--font-sans), system-ui, sans-serif;
60 |     @apply bg-background text-foreground;
61 |   }
62 | }
63 |
64 |  .scrollbar-hide::-webkit-scrollbar {
65 |   display: none;
66 | }
67 |
68 |  .scrollbar-hide {
69 |   -ms-overflow-style: none;
70 |   scrollbar-width: none;
71 | }
72 |
73 | [type="search"]::-webkit-search-cancel-button,
74 | [type="search"]::-webkit-search-decoration {
75 |   -webkit-appearance: none;
76 |   appearance: none;
77 | }
78 |
79 | @keyframes dialog-overlay-show {
80 |   from {
81 |     opacity: 0;
82 |   }
83 |   to {
84 |     opacity: 1;
85 |   }
86 | }
87 |
88 | @keyframes dialog-overlay-hide {
89 |   from {
90 |     opacity: 1;
91 |   }
92 |   to {
93 |     opacity: 0;
94 |   }
95 | }
96 |
97 | @keyframes dialog-content-show {
98 |   from {
99 |     opacity: 0;
100 |     transform: translate(-50%, -50%) scale(0.97);
101 |   }
102 |   to {
103 |     opacity: 1;
104 |     transform: translate(-50%, -50%) scale(1);
105 |   }
106 | }
107 |
108 | @keyframes dialog-content-hide {
109 |   from {
110 |     opacity: 1;
111 |     transform: translate(-50%, -50%) scale(1);
112 |   }
113 |   to {
114 |     opacity: 0;
115 |     transform: translate(-50%, -50%) scale(0.97);
116 |   }
117 | }
118 |
119 | /* Spinner */
120 | .loading-wrapper {
121 |   height: var(--spinner-size);
122 |   width: var(--spinner-size);
123 |   position: absolute;
124 |   inset: 0;
125 |   z-index: 10;
126 | }
127 |
128 | .loading-wrapper[data-visible='false'] {
129 |   transform-origin: center;
130 |   animation: fade-out 0.2s ease forwards;
131 | }
132 |
133 | .spinner {
134 |   position: relative;
135 |   top: 50%;
136 |   left: 50%;
137 |   height: var(--spinner-size);
138 |   width: var(--spinner-size);
139 | }
140 |
141 | .loading-parent {
142 |   display: flex;
143 |   height: 16px;
144 |   width: 16px;
145 |   position: relative;
146 |   justify-content: flex-start;
147 |   align-items: center;
148 |   flex-shrink: 0;
149 |   margin-left: -3px;
150 |   margin-right: 4px;
151 | }
152 |
153 | .loading-bar {
154 |   animation: loading 1.2s linear infinite;
155 |   background: hsl(0, 0%, 43.5%);
156 |   border-radius: 6px;
157 |   height: 8%;
158 |   left: -10%;
159 |   position: absolute;
160 |   top: -3.9%;
161 |   width: 24%;
162 | }
163 |
164 | .loading-bar:nth-child(1) {
165 |   animation-delay: -1.2s;
166 |   /* Rotate trick to avoid adding an additional pixel in some sizes */
167 |   transform: rotate(0.0001deg) translate(146%);
168 | }
169 |
170 | .loading-bar:nth-child(2) {
171 |   animation-delay: -1.1s;
172 |   transform: rotate(30deg) translate(146%);
173 | }
174 |
175 | .loading-bar:nth-child(3) {
176 |   animation-delay: -1s;
[TRUNCATED]
```

packages/utils/src/envs.ts
```
1 | export function getAppUrl() {
2 |   if (
3 |     process.env.VERCEL_ENV === "production" ||
4 |     process.env.NODE_ENV === "production"
5 |   ) {
6 |     return "https://app.midday.ai";
7 |   }
8 |
9 |   if (process.env.VERCEL_ENV === "preview") {
10 |     return `https://${process.env.VERCEL_URL}`;
11 |   }
12 |
13 |   return "http://localhost:3001";
14 | }
15 |
16 | export function getEmailUrl() {
17 |   if (process.env.NODE_ENV === "development") {
18 |     return "http://localhost:3000";
19 |   }
20 |
21 |   return "https://midday.ai";
22 | }
23 |
24 | export function getWebsiteUrl() {
25 |   if (
26 |     process.env.VERCEL_ENV === "production" ||
27 |     process.env.NODE_ENV === "production"
28 |   ) {
29 |     return "https://midday.ai";
30 |   }
31 |
32 |   if (process.env.VERCEL_ENV === "preview") {
33 |     return `https://${process.env.VERCEL_URL}`;
34 |   }
35 |
36 |   return "http://localhost:3000";
37 | }
38 |
39 | export function getCdnUrl() {
40 |   return "https://cdn.midday.ai";
41 | }
```

packages/utils/src/format.ts
```
1 | type FormatAmountParams = {
2 |   currency: string;
3 |   amount: number;
4 |   locale?: string;
5 |   minimumFractionDigits?: number;
6 |   maximumFractionDigits?: number;
7 | };
8 |
9 | export function formatAmount({
10 |   currency,
11 |   amount,
12 |   locale = "en-US",
13 |   minimumFractionDigits,
14 |   maximumFractionDigits,
15 | }: FormatAmountParams) {
16 |   if (!currency) {
17 |     return;
18 |   }
19 |
20 |   return Intl.NumberFormat(locale, {
21 |     style: "currency",
22 |     currency,
23 |     minimumFractionDigits,
24 |     maximumFractionDigits,
25 |   }).format(amount);
26 | }
```

packages/utils/src/index.ts
```
1 | export function stripSpecialCharacters(inputString: string) {
2 |   // Remove special characters and spaces, keep alphanumeric, hyphens/underscores, and dots
3 |   return inputString
4 |     .replace(/[^a-zA-Z0-9-_\s.]/g, "") // Remove special chars except hyphen/underscore/dot
5 |     .replace(/\s+/g, "-") // Replace spaces with hyphens
6 |     .toLowerCase(); // Convert to lowercase for consistency
7 | }
8 |
9 | export function shuffle(array: any) {
10 |   for (let i = array.length - 1; i > 0; i--) {
11 |     const j = Math.floor(Math.random() * (i + 1));
12 |     [array[i], array[j]] = [array[j], array[i]];
13 |   }
14 |   return array;
15 | }
16 |
17 | export enum FileType {
18 |   Pdf = "application/pdf",
19 |   Heic = "image/heic",
20 | }
21 |
22 | export const isSupportedFilePreview = (type: FileType) => {
23 |   if (!type) {
24 |     return false;
25 |   }
26 |
27 |   if (type === FileType.Heic) {
28 |     return false;
29 |   }
30 |
31 |   if (type?.startsWith("image")) {
32 |     return true;
33 |   }
34 |
35 |   switch (type) {
36 |     case FileType.Pdf:
37 |       return true;
38 |     default:
39 |       return false;
40 |   }
41 | };
```

apps/api/supabase/migrations/20240624104607_remote_schema.sql
```
1 |
2 | SET statement_timeout = 0;
3 | SET lock_timeout = 0;
4 | SET idle_in_transaction_session_timeout = 0;
5 | SET client_encoding = 'UTF8';
6 | SET standard_conforming_strings = on;
7 | SELECT pg_catalog.set_config('search_path', '', false);
8 | SET check_function_bodies = false;
9 | SET xmloption = content;
10 | SET client_min_messages = warning;
11 | SET row_security = off;
12 |
13 | CREATE EXTENSION IF NOT EXISTS "pg_net" WITH SCHEMA "extensions";
14 |
15 | CREATE EXTENSION IF NOT EXISTS "pgsodium" WITH SCHEMA "pgsodium";
16 |
17 | CREATE SCHEMA IF NOT EXISTS "private";
18 |
19 | ALTER SCHEMA "private" OWNER TO "postgres";
20 |
21 | COMMENT ON SCHEMA "public" IS 'standard public schema';
22 |
23 | CREATE EXTENSION IF NOT EXISTS "pg_stat_statements" WITH SCHEMA "extensions";
24 |
25 | CREATE EXTENSION IF NOT EXISTS "pg_trgm" WITH SCHEMA "public";
26 |
27 | CREATE EXTENSION IF NOT EXISTS "pgcrypto" WITH SCHEMA "extensions";
28 |
29 | CREATE EXTENSION IF NOT EXISTS "pgjwt" WITH SCHEMA "extensions";
30 |
31 | CREATE EXTENSION IF NOT EXISTS "supabase_vault" WITH SCHEMA "vault";
32 |
33 | CREATE EXTENSION IF NOT EXISTS "unaccent" WITH SCHEMA "public";
34 |
35 | CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA "extensions";
36 |
37 | CREATE EXTENSION IF NOT EXISTS "vector" WITH SCHEMA "extensions";
38 |
39 | CREATE TYPE "public"."account_type" AS ENUM (
40 |     'depository',
41 |     'credit',
42 |     'other_asset',
43 |     'loan',
44 |     'other_liability'
45 | );
46 |
47 | ALTER TYPE "public"."account_type" OWNER TO "postgres";
48 |
49 | CREATE TYPE "public"."bankProviders" AS ENUM (
50 |     'gocardless',
51 |     'plaid',
52 |     'teller'
53 | );
54 |
55 | ALTER TYPE "public"."bankProviders" OWNER TO "postgres";
56 |
57 | CREATE TYPE "public"."bank_providers" AS ENUM (
58 |     'gocardless',
59 |     'plaid',
60 |     'teller'
61 | );
62 |
63 | ALTER TYPE "public"."bank_providers" OWNER TO "postgres";
64 |
65 | CREATE TYPE "public"."inbox_status" AS ENUM (
66 |     'processing',
67 |     'pending',
68 |     'archived',
69 |     'new',
70 |     'deleted'
71 | );
72 |
73 | ALTER TYPE "public"."inbox_status" OWNER TO "postgres";
74 |
75 | CREATE TYPE "public"."metrics_record" AS (
76 | 	"date" "date",
77 | 	"value" integer
78 | );
79 |
80 | ALTER TYPE "public"."metrics_record" OWNER TO "postgres";
81 |
82 | CREATE TYPE "public"."reportTypes" AS ENUM (
83 |     'profit',
84 |     'revenue',
85 |     'burn_rate'
86 | );
87 |
88 | ALTER TYPE "public"."reportTypes" OWNER TO "postgres";
89 |
90 | CREATE TYPE "public"."teamRoles" AS ENUM (
91 |     'owner',
92 |     'member'
93 | );
94 |
95 | ALTER TYPE "public"."teamRoles" OWNER TO "postgres";
96 |
97 | CREATE TYPE "public"."trackerStatus" AS ENUM (
98 |     'in_progress',
99 |     'completed'
100 | );
101 |
102 | ALTER TYPE "public"."trackerStatus" OWNER TO "postgres";
103 |
104 | CREATE TYPE "public"."transactionCategories" AS ENUM (
105 |     'travel',
106 |     'office_supplies',
107 |     'meals',
108 |     'software',
109 |     'rent',
110 |     'income',
111 |     'equipment',
112 |     'transfer',
113 |     'internet_and_telephone',
114 |     'facilities_expenses',
115 |     'activity',
116 |     'uncategorized',
117 |     'taxes',
118 |     'other',
119 |     'salary',
120 |     'fees'
121 | );
122 |
123 | ALTER TYPE "public"."transactionCategories" OWNER TO "postgres";
124 |
125 | CREATE TYPE "public"."transactionMethods" AS ENUM (
126 |     'payment',
127 |     'card_purchase',
128 |     'card_atm',
129 |     'transfer',
130 |     'other',
131 |     'unknown',
132 |     'ach',
133 |     'interest',
134 |     'deposit',
135 |     'wire',
136 |     'fee'
137 | );
138 |
139 | ALTER TYPE "public"."transactionMethods" OWNER TO "postgres";
140 |
141 | CREATE TYPE "public"."transactionStatus" AS ENUM (
142 |     'posted',
143 |     'pending',
144 |     'excluded',
145 |     'completed'
146 | );
147 |
148 | ALTER TYPE "public"."transactionStatus" OWNER TO "postgres";
149 |
150 | CREATE OR REPLACE FUNCTION "private"."get_invites_for_authenticated_user"() RETURNS SETOF "uuid"
151 |     LANGUAGE "sql" STABLE SECURITY DEFINER
152 |     SET "search_path" TO 'public'
153 |     AS $$
154 |   select team_id
155 |   from user_invites
156 |   where email = auth.jwt() ->> 'email'
157 | $$;
158 |
159 | ALTER FUNCTION "private"."get_invites_for_authenticated_user"() OWNER TO "postgres";
160 |
161 | CREATE OR REPLACE FUNCTION "private"."get_teams_for_authenticated_user"() RETURNS SETOF "uuid"
162 |     LANGUAGE "sql" STABLE SECURITY DEFINER
163 |     SET "search_path" TO 'public'
164 |     AS $$
165 |   select team_id
166 |   from users_on_team
167 |   where user_id = auth.uid()
168 | $$;
169 |
[TRUNCATED]
```

apps/api/supabase/migrations/20240625111157_remote_schema.sql
```
1 | create or replace view "private"."current_user_teams" as  SELECT ( SELECT auth.uid() AS uid) AS user_id,
2 |     t.team_id
3 |    FROM users_on_team t
4 |   WHERE (t.user_id = ( SELECT auth.uid() AS uid));
5 |
6 |
7 |
8 | drop policy "Enable read access for all users" on "public"."users_on_team";
9 |
10 | set check_function_bodies = off;
11 |
12 | create or replace view "public"."current_user_teams" as  SELECT ( SELECT auth.uid() AS uid) AS user_id,
13 |     t.team_id
14 |    FROM users_on_team t
15 |   WHERE (t.user_id = ( SELECT auth.uid() AS uid));
16 |
17 |
18 | CREATE OR REPLACE FUNCTION public.get_current_user_team_id()
19 |  RETURNS uuid
20 |  LANGUAGE plpgsql
21 | AS $function$
22 | BEGIN
23 |   RETURN (SELECT team_id FROM users WHERE id = (SELECT auth.uid()));
24 | END;
25 | $function$
26 | ;
27 |
28 | create policy "New Policy Name"
29 | on "public"."users_on_team"
30 | as permissive
31 | for select
32 | to authenticated
33 | using ((EXISTS ( SELECT 1
34 |    FROM private.current_user_teams cut
35 |   WHERE ((cut.user_id = ( SELECT auth.uid() AS uid)) AND (cut.team_id = users_on_team.team_id)))));
36 |
37 |
38 |
```

apps/api/supabase/migrations/20240625112143_remote_schema.sql
```
1 | drop policy "New Policy Name" on "public"."users_on_team";
2 |
3 | drop view if exists "public"."current_user_teams";
4 |
5 | create policy "Select for current user teams"
6 | on "public"."users_on_team"
7 | as permissive
8 | for select
9 | to authenticated
10 | using ((EXISTS ( SELECT 1
11 |    FROM private.current_user_teams cut
12 |   WHERE ((cut.user_id = ( SELECT auth.uid() AS uid)) AND (cut.team_id = users_on_team.team_id)))));
13 |
14 |
15 |
```

apps/api/supabase/migrations/20240703160414_remote_schema.sql
```
1 | drop trigger if exists "update_enrich_transaction_trigger" on "public"."transactions";
2 |
3 | drop function if exists "public"."get_spending_v2"(team_id uuid, date_from date, date_to date, currency_target text);
4 |
5 | create table "public"."total_amount" (
6 |     "sum" numeric
7 | );
8 |
9 |
10 | CREATE INDEX reports_team_id_idx ON public.reports USING btree (team_id);
11 |
12 | CREATE INDEX tracker_entries_team_id_idx ON public.tracker_entries USING btree (team_id);
13 |
14 | CREATE INDEX tracker_projects_team_id_idx ON public.tracker_projects USING btree (team_id);
15 |
16 | CREATE INDEX tracker_reports_team_id_idx ON public.tracker_reports USING btree (team_id);
17 |
18 | CREATE INDEX transaction_categories_team_id_idx ON public.transaction_categories USING btree (team_id);
19 |
20 | CREATE INDEX transaction_enrichments_category_slug_team_id_idx ON public.transaction_enrichments USING btree (category_slug, team_id);
21 |
22 | CREATE INDEX transactions_assigned_id_idx ON public.transactions USING btree (assigned_id);
23 |
24 | CREATE INDEX transactions_bank_account_id_idx ON public.transactions USING btree (bank_account_id);
25 |
26 | CREATE INDEX user_invites_team_id_idx ON public.user_invites USING btree (team_id);
27 |
28 | CREATE INDEX users_on_team_user_id_idx ON public.users_on_team USING btree (user_id);
29 |
30 | CREATE INDEX users_team_id_idx ON public.users USING btree (team_id);
31 |
32 | set check_function_bodies = off;
33 |
34 | CREATE OR REPLACE FUNCTION public.get_spending(team_id uuid, date_from date, date_to date, currency_target text)
35 |  RETURNS TABLE(name text, slug text, amount numeric, currency text, color text, percentage numeric)
36 |  LANGUAGE plpgsql
37 | AS $function$declare
38 |     total_amount numeric;
39 | begin
40 |     select sum(t.amount) into total_amount
41 |     from transactions as t
42 |     where t.team_id = get_spending.team_id
43 |         and t.category_slug != 'transfer'
44 |         and t.currency = currency_target
45 |         and t.date >= date_from
46 |         and t.date <= date_to
47 |         and t.amount < 0;
48 |
49 |     return query
50 |     select
51 |         coalesce(category.name, 'Uncategorized') AS name,
52 |         coalesce(category.slug, 'uncategorized') as slug,
53 |         sum(t.amount) as amount,
54 |         t.currency,
55 |         coalesce(category.color, '#606060') as color,
56 |         case
57 |             when ((sum(t.amount) / total_amount) * 100) > 1 then
58 |                 round((sum(t.amount) / total_amount) * 100)
59 |             else
60 |                 round((sum(t.amount) / total_amount) * 100, 2)
61 |         end as percentage
62 |     from
63 |         transactions as t
64 |     left join
65 |         transaction_categories as category on t.team_id = category.team_id and t.category_slug = category.slug
66 |     where
67 |         t.team_id = get_spending.team_id
68 |         and t.category_slug != 'transfer'
69 |         and t.currency = currency_target
70 |         and t.date >= date_from
71 |         and t.date <= date_to
72 |         and t.amount < 0
73 |     group by
74 |         category.name,
75 |         coalesce(category.slug, 'uncategorized'),
76 |         t.currency,
77 |         category.color
78 |     order by
79 |         sum(t.amount) asc;
80 | end;$function$
81 | ;
82 |
83 | grant delete on table "public"."total_amount" to "anon";
84 |
85 | grant insert on table "public"."total_amount" to "anon";
86 |
87 | grant references on table "public"."total_amount" to "anon";
88 |
89 | grant select on table "public"."total_amount" to "anon";
90 |
91 | grant trigger on table "public"."total_amount" to "anon";
92 |
93 | grant truncate on table "public"."total_amount" to "anon";
94 |
95 | grant update on table "public"."total_amount" to "anon";
96 |
97 | grant delete on table "public"."total_amount" to "authenticated";
98 |
99 | grant insert on table "public"."total_amount" to "authenticated";
100 |
101 | grant references on table "public"."total_amount" to "authenticated";
102 |
103 | grant select on table "public"."total_amount" to "authenticated";
104 |
105 | grant trigger on table "public"."total_amount" to "authenticated";
106 |
107 | grant truncate on table "public"."total_amount" to "authenticated";
108 |
109 | grant update on table "public"."total_amount" to "authenticated";
110 |
111 | grant delete on table "public"."total_amount" to "service_role";
112 |
113 | grant insert on table "public"."total_amount" to "service_role";
114 |
[TRUNCATED]
```

apps/api/supabase/migrations/20240917165251_remote_schema.sql
```
1 | create type "public"."connection_status" as enum ('disconnected', 'connected', 'unknown');
2 |
3 | create type "public"."inbox_type" as enum ('invoice', 'expense');
4 |
5 | create type "public"."transaction_frequency" as enum ('weekly', 'biweekly', 'monthly', 'semi_monthly', 'annually', 'irregular', 'unknown');
6 |
7 | drop trigger if exists "match_transaction" on "public"."transactions";
8 |
9 | drop trigger if exists "enrich_transaction" on "public"."transactions";
10 |
11 | revoke delete on table "public"."total_amount" from "anon";
12 |
13 | revoke insert on table "public"."total_amount" from "anon";
14 |
15 | revoke references on table "public"."total_amount" from "anon";
16 |
17 | revoke select on table "public"."total_amount" from "anon";
18 |
19 | revoke trigger on table "public"."total_amount" from "anon";
20 |
21 | revoke truncate on table "public"."total_amount" from "anon";
22 |
23 | revoke update on table "public"."total_amount" from "anon";
24 |
25 | revoke delete on table "public"."total_amount" from "authenticated";
26 |
27 | revoke insert on table "public"."total_amount" from "authenticated";
28 |
29 | revoke references on table "public"."total_amount" from "authenticated";
30 |
31 | revoke select on table "public"."total_amount" from "authenticated";
32 |
33 | revoke trigger on table "public"."total_amount" from "authenticated";
34 |
35 | revoke truncate on table "public"."total_amount" from "authenticated";
36 |
37 | revoke update on table "public"."total_amount" from "authenticated";
38 |
39 | revoke delete on table "public"."total_amount" from "service_role";
40 |
41 | revoke insert on table "public"."total_amount" from "service_role";
42 |
43 | revoke references on table "public"."total_amount" from "service_role";
44 |
45 | revoke select on table "public"."total_amount" from "service_role";
46 |
47 | revoke trigger on table "public"."total_amount" from "service_role";
48 |
49 | revoke truncate on table "public"."total_amount" from "service_role";
50 |
51 | revoke update on table "public"."total_amount" from "service_role";
52 |
53 | drop table "public"."total_amount";
54 |
55 | alter type "public"."reportTypes" rename to "reportTypes__old_version_to_be_dropped";
56 |
57 | create type "public"."reportTypes" as enum ('profit', 'revenue', 'burn_rate', 'expense');
58 |
59 | create table "public"."documents" (
60 |     "id" uuid not null default gen_random_uuid(),
61 |     "name" text,
62 |     "created_at" timestamp with time zone default now(),
63 |     "metadata" jsonb,
64 |     "path_tokens" text[],
65 |     "team_id" uuid,
66 |     "parent_id" text,
67 |     "object_id" uuid,
68 |     "owner_id" uuid,
69 |     "tag" text,
70 |     "title" text,
71 |     "body" text,
72 |     "fts" tsvector generated always as (to_tsvector('english'::regconfig, ((title || ' '::text) || body))) stored
73 | );
74 |
75 |
76 | alter table "public"."documents" enable row level security;
77 |
78 | create table "public"."exchange_rates" (
79 |     "id" uuid not null default gen_random_uuid(),
80 |     "base" text,
81 |     "rate" numeric,
82 |     "target" text,
83 |     "updated_at" timestamp with time zone
84 | );
85 |
86 |
87 | alter table "public"."exchange_rates" enable row level security;
88 |
89 | alter table "public"."reports" alter column type type "public"."reportTypes" using type::text::"public"."reportTypes";
90 |
91 | drop type "public"."reportTypes__old_version_to_be_dropped";
92 |
93 | alter table "public"."bank_accounts" drop column "last_accessed";
94 |
95 | alter table "public"."bank_accounts" add column "base_balance" numeric;
96 |
97 | alter table "public"."bank_accounts" add column "base_currency" text;
98 |
99 | alter table "public"."bank_connections" add column "error_details" text;
100 |
101 | alter table "public"."bank_connections" add column "last_accessed" timestamp with time zone;
102 |
103 | alter table "public"."bank_connections" add column "reference_id" text;
104 |
105 | alter table "public"."bank_connections" add column "status" connection_status default 'connected'::connection_status;
106 |
107 | alter table "public"."inbox" drop column "due_date";
108 |
109 | alter table "public"."inbox" add column "base_amount" numeric;
110 |
111 | alter table "public"."inbox" add column "base_currency" text;
112 |
113 | alter table "public"."inbox" add column "date" date;
114 |
115 | alter table "public"."inbox" add column "description" text;
116 |
117 | alter table "public"."inbox" add column "type" inbox_type;
118 |
119 | alter table "public"."teams" add column "base_currency" text;
120 |
121 | alter table "public"."teams" add column "document_classification" boolean default false;
122 |
123 | alter table "public"."transaction_enrichments" alter column "system" set default false;
124 |
125 | alter table "public"."transactions" drop column "currency_rate";
126 |
[TRUNCATED]
```

apps/api/supabase/migrations/20240917165404_remote_schema.sql
```
1 | CREATE TRIGGER on_auth_user_created AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION handle_new_user();
2 |
3 | CREATE TRIGGER user_registered AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION webhook('webhook/registered');
4 |
5 |
6 | set check_function_bodies = off;
7 |
8 | CREATE OR REPLACE FUNCTION storage.handle_empty_folder_placeholder()
9 |  RETURNS trigger
10 |  LANGUAGE plpgsql
11 | AS $function$
12 | DECLARE
13 |     name_tokens text[];
14 |     modified_name text;
15 | BEGIN
16 |     -- Split the name into an array of tokens based on '/'
17 |     name_tokens := string_to_array(NEW.name, '/');
18 |
19 |     -- Check if the last item in name_tokens is '.emptyFolderPlaceholder'
20 |     IF name_tokens[array_length(name_tokens, 1)] = '.emptyFolderPlaceholder' THEN
21 |
22 |         -- Change the last item to '.folderPlaceholder'
23 |         name_tokens[array_length(name_tokens, 1)] := '.folderPlaceholder';
24 |
25 |         -- Reassemble the tokens back into a string
26 |         modified_name := array_to_string(name_tokens, '/');
27 |
28 |         -- Insert a new row with the modified name
29 |         INSERT INTO storage.objects (bucket_id, name, owner, owner_id, team_id, parent_path)
30 |         VALUES (
31 |             NEW.bucket_id,
32 |             modified_name,
33 |             NEW.owner,
34 |             NEW.owner_id,
35 |             NEW.team_id,
36 |             NEW.parent_path
37 |         );
38 |     END IF;
39 |
40 |     -- Insert the original row
41 |     RETURN NEW;
42 | END;
43 | $function$
44 | ;
45 |
46 | CREATE OR REPLACE FUNCTION storage.extension(name text)
47 |  RETURNS text
48 |  LANGUAGE plpgsql
49 | AS $function$
50 | DECLARE
51 | _parts text[];
52 | _filename text;
53 | BEGIN
54 |     select string_to_array(name, '/') into _parts;
55 |     select _parts[array_length(_parts,1)] into _filename;
56 |     -- @todo return the last part instead of 2
57 |     return split_part(_filename, '.', 2);
58 | END
59 | $function$
60 | ;
61 |
62 | CREATE OR REPLACE FUNCTION storage.filename(name text)
63 |  RETURNS text
64 |  LANGUAGE plpgsql
65 | AS $function$
66 | DECLARE
67 | _parts text[];
68 | BEGIN
69 |     select string_to_array(name, '/') into _parts;
70 |     return _parts[array_length(_parts,1)];
71 | END
72 | $function$
73 | ;
74 |
75 | CREATE OR REPLACE FUNCTION storage.foldername(name text)
76 |  RETURNS text[]
77 |  LANGUAGE plpgsql
78 | AS $function$
79 | DECLARE
80 | _parts text[];
81 | BEGIN
82 |     select string_to_array(name, '/') into _parts;
83 |     return _parts[1:array_length(_parts,1)-1];
84 | END
85 | $function$
86 | ;
87 |
88 | create policy "Give members access to team folder 1oj01fe_0"
89 | on "storage"."objects"
90 | as permissive
91 | for select
92 | to public
93 | using (((bucket_id = 'avatars'::text) AND (EXISTS ( SELECT 1
94 |    FROM users_on_team
95 |   WHERE ((users_on_team.user_id = auth.uid()) AND ((users_on_team.team_id)::text = (storage.foldername(objects.name))[1]))))));
96 |
97 |
98 | create policy "Give members access to team folder 1oj01fe_1"
99 | on "storage"."objects"
100 | as permissive
101 | for insert
102 | to public
103 | with check (((bucket_id = 'avatars'::text) AND (EXISTS ( SELECT 1
104 |    FROM users_on_team
105 |   WHERE ((users_on_team.user_id = auth.uid()) AND ((users_on_team.team_id)::text = (storage.foldername(objects.name))[1]))))));
106 |
107 |
108 | create policy "Give members access to team folder 1oj01fe_2"
109 | on "storage"."objects"
110 | as permissive
111 | for update
112 | to public
113 | using (((bucket_id = 'avatars'::text) AND (EXISTS ( SELECT 1
114 |    FROM users_on_team
115 |   WHERE ((users_on_team.user_id = auth.uid()) AND ((users_on_team.team_id)::text = (storage.foldername(objects.name))[1]))))));
116 |
117 |
118 | create policy "Give members access to team folder 1oj01fe_3"
119 | on "storage"."objects"
120 | as permissive
121 | for delete
122 | to public
123 | using (((bucket_id = 'avatars'::text) AND (EXISTS ( SELECT 1
124 |    FROM users_on_team
125 |   WHERE ((users_on_team.user_id = auth.uid()) AND ((users_on_team.team_id)::text = (storage.foldername(objects.name))[1]))))));
126 |
127 |
128 | create policy "Give members access to team folder 1uo56a_0"
129 | on "storage"."objects"
130 | as permissive
131 | for select
132 | to authenticated
133 | using (((bucket_id = 'vault'::text) AND (EXISTS ( SELECT 1
[TRUNCATED]
```

apps/api/supabase/migrations/20241007083408_remote_schema.sql
```
1 | drop policy "Entries can be updated by a member of the team" on "public"."tracker_entries";
2 |
3 | create table "public"."apps" (
4 |     "id" uuid not null default gen_random_uuid(),
5 |     "team_id" uuid default gen_random_uuid(),
6 |     "config" jsonb,
7 |     "created_at" timestamp with time zone default now(),
8 |     "app_id" text not null,
9 |     "created_by" uuid default gen_random_uuid(),
10 |     "settings" jsonb
11 | );
12 |
13 |
14 | alter table "public"."apps" enable row level security;
15 |
16 | alter table "public"."tracker_entries" alter column "start" set data type timestamp with time zone using "start"::timestamp with time zone;
17 |
18 | alter table "public"."tracker_entries" alter column "stop" set data type timestamp with time zone using "stop"::timestamp with time zone;
19 |
20 | alter table "public"."users" add column "time_format" numeric default '24'::numeric;
21 |
22 | CREATE UNIQUE INDEX integrations_pkey ON public.apps USING btree (id);
23 |
24 | CREATE UNIQUE INDEX unique_app_id_team_id ON public.apps USING btree (app_id, team_id);
25 |
26 | alter table "public"."apps" add constraint "integrations_pkey" PRIMARY KEY using index "integrations_pkey";
27 |
28 | alter table "public"."apps" add constraint "apps_created_by_fkey" FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE not valid;
29 |
30 | alter table "public"."apps" validate constraint "apps_created_by_fkey";
31 |
32 | alter table "public"."apps" add constraint "integrations_team_id_fkey" FOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE CASCADE not valid;
33 |
34 | alter table "public"."apps" validate constraint "integrations_team_id_fkey";
35 |
36 | alter table "public"."apps" add constraint "unique_app_id_team_id" UNIQUE using index "unique_app_id_team_id";
37 |
38 | set check_function_bodies = off;
39 |
40 | CREATE OR REPLACE FUNCTION public.get_assigned_users_for_project(tracker_projects)
41 |  RETURNS json
42 |  LANGUAGE sql
43 | AS $function$
44 |   SELECT COALESCE(
45 |     (SELECT json_agg(
46 |       json_build_object(
47 |         'user_id', u.id,
48 |         'full_name', u.full_name,
49 |         'avatar_url', u.avatar_url
50 |       )
51 |     )
52 |     FROM (
53 |       SELECT DISTINCT u.id, u.full_name, u.avatar_url
54 |       FROM public.users u
55 |       JOIN public.tracker_entries te ON u.id = te.assigned_id
56 |       WHERE te.project_id = $1.id
57 |     ) u
58 |   ), '[]'::json);
59 | $function$
60 | ;
61 |
62 | CREATE OR REPLACE FUNCTION public.get_project_total_amount(tracker_projects)
63 |  RETURNS numeric
64 |  LANGUAGE sql
65 | AS $function$
66 |   SELECT COALESCE(
67 |     (SELECT
68 |       CASE
69 |         WHEN $1.rate IS NOT NULL THEN
70 |           ROUND(SUM(te.duration) * $1.rate / 3600, 2)
71 |         ELSE
72 |           0
73 |       END
74 |     FROM public.tracker_entries te
75 |     WHERE te.project_id = $1.id
76 |     ), 0
77 |   );
78 | $function$
79 | ;
80 |
81 | CREATE OR REPLACE FUNCTION public.get_runway_v4(team_id text, date_from date, date_to date, base_currency text DEFAULT NULL::text)
82 |  RETURNS numeric
83 |  LANGUAGE plpgsql
84 | AS $function$
85 | declare
86 |     target_currency text;
87 |     total_balance numeric;
88 |     avg_burn_rate numeric;
89 |     number_of_months numeric;
90 | begin
91 |     if get_runway_v4.base_currency is not null then
92 |         target_currency := get_runway_v4.base_currency;
93 |     else
94 |         select teams.base_currency into target_currency
95 |         from teams
96 |         where teams.id = get_runway_v4.team_id;
97 |     end if;
98 |
99 |     select * from get_total_balance_v3(team_id, target_currency) into total_balance;
100 |
101 |     select (extract(year FROM date_to) - extract(year FROM date_from)) * 12 +
102 |            extract(month FROM date_to) - extract(month FROM date_from)
103 |     into number_of_months;
104 |
105 |     select round(avg(value))
106 |     from get_burn_rate_v3(team_id, date_from, date_to, target_currency)
107 |     into avg_burn_rate;
108 |
109 |     if avg_burn_rate = 0 then
110 |         return null;
111 |     else
112 |         return round(total_balance / avg_burn_rate);
113 |     end if;
114 | end;
115 |
116 | $function$
117 | ;
118 |
119 | CREATE OR REPLACE FUNCTION public.calculate_bank_account_base_balance()
120 |  RETURNS trigger
121 |  LANGUAGE plpgsql
122 | AS $function$declare
123 |     team_base_currency text;
124 |     exchange_rate numeric;
125 | begin
[TRUNCATED]
```

apps/api/supabase/migrations/seed.sql
```
1 |
2 | SELECT vault.create_secret('http://localhost:3001/api', 'WEBHOOK_ENDPOINT', 'Webhook endpoint URL');
3 | SELECT vault.create_secret('6c369443-1a88-444e-b459-7e662c1fff9e', 'WEBHOOK_SECRET', 'Webhook secret key');
```

apps/dashboard/jobs/utils/base-currency.ts
```
1 | type GetAccountBalanceParams = {
2 |   currency: string;
3 |   balance: number;
4 |   baseCurrency: string;
5 |   rate: number | null;
6 | };
7 |
8 | export function getAccountBalance({
9 |   currency,
10 |   balance,
11 |   baseCurrency,
12 |   rate,
13 | }: GetAccountBalanceParams) {
14 |   if (currency === baseCurrency) {
15 |     return balance;
16 |   }
17 |
18 |   return +(balance * (rate ?? 1)).toFixed(2);
19 | }
20 |
21 | type GetTransactionAmountParams = {
22 |   amount: number;
23 |   currency: string;
24 |   baseCurrency: string;
25 |   rate: number | null;
26 | };
27 |
28 | export function getTransactionAmount({
29 |   amount,
30 |   currency,
31 |   baseCurrency,
32 |   rate,
33 | }: GetTransactionAmountParams) {
34 |   if (currency === baseCurrency) {
35 |     return amount;
36 |   }
37 |
38 |   return +(amount * (rate ?? 1)).toFixed(2);
39 | }
```

apps/dashboard/jobs/utils/blob.ts
```
1 | export async function blobToSerializable(blob: Blob) {
2 |   const arrayBuffer = await blob.arrayBuffer();
3 |   return Array.from(new Uint8Array(arrayBuffer));
4 | }
5 |
6 | export function serializableToBlob(array: number[], contentType = "") {
7 |   return new Blob([new Uint8Array(array)], { type: contentType });
8 | }
```

apps/dashboard/jobs/utils/generate-cron-tag.ts
```
1 | export function generateCronTag(teamId: string): string {
2 |   // Use teamId to generate a deterministic random minute and hour
3 |   const hash = Array.from(teamId).reduce(
4 |     (acc, char) => acc + char.charCodeAt(0),
5 |     0,
6 |   );
7 |
8 |   // Generate minute (0-59) and hour (0-23) based on hash
9 |   const minute = hash % 60;
10 |   const hour = hash % 24;
11 |
12 |   // Return cron expression that runs daily at the generated time
13 |   // Format: minute hour * * *
14 |   return `${minute} ${hour} * * *`;
15 | }
```

apps/dashboard/jobs/utils/inbox-notifications.ts
```
1 | import { NotificationTypes } from "@midday/notification";
2 | import { triggerBulk } from "@midday/notification";
3 | import { TriggerEvents } from "@midday/notification";
4 | import { createClient } from "@midday/supabase/job";
5 |
6 | export async function handleInboxNotifications({
7 |   inboxId,
8 |   description,
9 |   teamId,
10 | }: {
11 |   inboxId: string;
12 |   description: string;
13 |   teamId: string;
14 | }) {
15 |   const supabase = createClient();
16 |
17 |   // Get all users on team
18 |   const { data: usersData } = await supabase
19 |     .from("users_on_team")
20 |     .select("user:users(id, full_name, avatar_url, email, locale)")
21 |     .eq("team_id", teamId)
22 |     .eq("role", "owner")
23 |     .throwOnError();
24 |
25 |   if (!usersData?.length) {
26 |     return;
27 |   }
28 |
29 |   const notificationEvents = await Promise.all(
30 |     usersData.map(async ({ user }) => {
31 |       if (!user) return [];
32 |
33 |       return [
34 |         {
35 |           name: TriggerEvents.InboxNewInApp,
36 |           payload: {
37 |             recordId: inboxId,
38 |             description,
39 |             type: NotificationTypes.Inbox,
40 |           },
41 |           user: {
42 |             subscriberId: user.id,
43 |             teamId,
44 |             email: user.email,
45 |             fullName: user.full_name,
46 |             avatarUrl: user.avatar_url,
47 |           },
48 |         },
49 |       ];
50 |     }),
51 |   );
52 |
53 |   if (notificationEvents.length) {
54 |     triggerBulk(notificationEvents?.flat());
55 |   }
56 | }
```

apps/dashboard/jobs/utils/invoice-notifications.tsx
```
1 | import { InvoiceOverdueEmail } from "@midday/email/emails/invoice-overdue";
2 | import { InvoicePaidEmail } from "@midday/email/emails/invoice-paid";
3 | import { getI18n } from "@midday/email/locales";
4 | import {
5 |   NotificationTypes,
6 |   TriggerEvents,
7 |   triggerBulk,
8 | } from "@midday/notification";
9 | import { getAppUrl } from "@midday/utils/envs";
10 | import { render } from "@react-email/render";
11 | import { logger } from "@trigger.dev/sdk/v3";
12 |
13 | export async function handlePaidInvoiceNotifications({
14 |   user,
15 |   invoiceId,
16 |   invoiceNumber,
17 | }: {
18 |   user: any[];
19 |   invoiceId: string;
20 |   invoiceNumber: string;
21 | }) {
22 |   const link = `${getAppUrl()}/invoices?invoiceId=${invoiceId}&type=details`;
23 |
24 |   const paidNotificationEvents = user
25 |     ?.map(({ user, team_id }) => {
26 |       const { t } = getI18n({ locale: user?.locale ?? "en" });
27 |
28 |       if (!user) {
29 |         return null;
30 |       }
31 |
32 |       return {
33 |         name: TriggerEvents.InvoicePaidInApp,
34 |         payload: {
35 |           type: NotificationTypes.Invoice,
36 |           recordId: invoiceId,
37 |           description: t("notifications.invoicePaid", {
38 |             invoiceNumber,
39 |           }),
40 |         },
41 |         user: {
42 |           subscriberId: user.id,
43 |           teamId: team_id,
44 |           email: user.email,
45 |           fullName: user.full_name,
46 |           avatarUrl: user.avatar_url,
47 |         },
48 |       };
49 |     })
50 |     .filter(Boolean);
51 |
52 |   try {
53 |     await triggerBulk(paidNotificationEvents);
54 |   } catch (error) {
55 |     await logger.error("Paid invoice notification", { error });
56 |   }
57 |
58 |   const paidEmailPromises = user
59 |     ?.map(async ({ user, team_id }) => {
60 |       const { t } = getI18n({ locale: user?.locale ?? "en" });
61 |
62 |       if (!user) {
63 |         return null;
64 |       }
65 |
66 |       const html = await render(
67 |         <InvoicePaidEmail invoiceNumber={invoiceNumber} link={link} />,
68 |       );
69 |
70 |       return {
71 |         name: TriggerEvents.InvoicePaidEmail,
72 |         payload: {
73 |           subject: t("invoice.paid.subject", { invoiceNumber }),
74 |           html,
75 |         },
76 |         user: {
77 |           subscriberId: user.id,
78 |           teamId: team_id,
79 |           email: user.email,
80 |           fullName: user.full_name,
81 |           avatarUrl: user.avatar_url,
82 |         },
83 |       };
84 |     })
85 |     .filter(Boolean);
86 |
87 |   const validPaidEmailPromises = await Promise.all(paidEmailPromises);
88 |
89 |   try {
90 |     await triggerBulk(validPaidEmailPromises);
91 |   } catch (error) {
92 |     await logger.error("Paid invoice email", { error });
93 |   }
94 | }
95 |
96 | export async function handleOverdueInvoiceNotifications({
97 |   user,
98 |   invoiceId,
99 |   invoiceNumber,
100 |   customerName,
101 | }: {
102 |   user: any[];
103 |   invoiceId: string;
104 |   invoiceNumber: string;
105 |   customerName: string;
106 | }) {
107 |   const link = `${getAppUrl()}/invoices?invoiceId=${invoiceId}&type=details`;
108 |
109 |   const overdueNotificationEvents = user
110 |     ?.map(({ user, team_id }) => {
111 |       const { t } = getI18n({ locale: user?.locale ?? "en" });
112 |
113 |       if (!user) {
114 |         return null;
115 |       }
116 |
117 |       return {
118 |         name: TriggerEvents.InvoiceOverdueInApp,
119 |         payload: {
120 |           type: NotificationTypes.Invoice,
121 |           recordId: invoiceId,
122 |           description: t("notifications.invoiceOverdue", {
123 |             invoiceNumber,
124 |           }),
125 |         },
126 |         user: {
127 |           subscriberId: user.id,
128 |           teamId: team_id,
129 |           email: user.email,
130 |           fullName: user.full_name,
131 |           avatarUrl: user.avatar_url,
132 |         },
133 |       };
134 |     })
135 |     .filter(Boolean);
136 |
137 |   try {
138 |     await triggerBulk(overdueNotificationEvents);
139 |   } catch (error) {
140 |     await logger.error("Overdue invoice notification", { error });
141 |   }
142 |
143 |   const overdueEmailPromises = user
144 |     ?.map(async ({ user, team_id }) => {
145 |       const { t } = getI18n({ locale: user?.locale ?? "en" });
146 |
147 |       if (!user) {
148 |         return null;
149 |       }
150 |
151 |       const html = await render(
152 |         <InvoiceOverdueEmail
153 |           invoiceNumber={invoiceNumber}
154 |           customerName={customerName}
155 |           link={link}
156 |         />,
157 |       );
158 |
159 |       return {
160 |         name: TriggerEvents.InvoiceOverdueEmail,
161 |         payload: {
162 |           subject: t("invoice.overdue.subject", { invoiceNumber }),
163 |           html,
164 |         },
165 |         user: {
166 |           subscriberId: user.id,
167 |           teamId: team_id,
168 |           email: user.email,
169 |           fullName: user.full_name,
170 |           avatarUrl: user.avatar_url,
171 |         },
172 |       };
173 |     })
174 |     .filter(Boolean);
175 |
176 |   const validOverdueEmailPromises = await Promise.all(overdueEmailPromises);
177 |
178 |   try {
179 |     await triggerBulk(validOverdueEmailPromises);
180 |   } catch (error) {
181 |     await logger.error("Overdue invoice email", { error });
182 |   }
183 | }
```

apps/dashboard/jobs/utils/parse-error.ts
```
1 | export function parseAPIError(error: unknown) {
2 |   if (typeof error === "object" && error !== null && "error" in error) {
3 |     const apiError = error as { error: { code: string; message: string } };
4 |     return {
5 |       code: apiError.error.code,
6 |       message: apiError.error.message,
7 |     };
8 |   }
9 |   return { code: "unknown", message: "An unknown error occurred" };
10 | }
```

apps/dashboard/jobs/utils/process-batch.ts
```
1 | export async function processBatch<T, R>(
2 |   items: T[],
3 |   limit: number,
4 |   fn: (batch: T[]) => Promise<R[]>,
5 | ): Promise<R[]> {
6 |   const batches: T[][] = [];
7 |   let result: R[] = [];
8 |
9 |   // Split the items into batches
10 |   for (let i = 0; i < items?.length; i += limit) {
11 |     batches.push(items.slice(i, i + limit));
12 |   }
13 |
14 |   // Process batches serially
15 |   for (const batch of batches) {
16 |     const processedBatch = await fn(batch);
17 |     result = result.concat(processedBatch);
18 |   }
19 |
20 |   return result;
21 | }
```

apps/dashboard/jobs/utils/revalidate-cache.ts
```
1 | export async function revalidateCache({
2 |   tag,
3 |   id,
4 | }: {
5 |   tag: string;
6 |   id: string;
7 | }) {
8 |   return fetch(
9 |     `${process.env.MIDDAY_PUBLIC_APP_URL}/api/webhook/cache/revalidate`,
10 |     {
11 |       headers: {
12 |         Authorization: `Bearer ${process.env.MIDDAY_CACHE_API_SECRET}`,
13 |       },
14 |       method: "POST",
15 |       body: JSON.stringify({ tag, id }),
16 |     },
17 |   );
18 | }
```

apps/dashboard/jobs/utils/transaction-notifications.tsx
```
1 | import { sendSlackTransactionNotifications } from "@midday/app-store/slack-notifications";
2 | import TransactionsEmail from "@midday/email/emails/transactions";
3 | import { getI18n } from "@midday/email/locales";
4 | import { getInboxEmail } from "@midday/inbox";
5 | import {
6 |   NotificationTypes,
7 |   TriggerEvents,
8 |   triggerBulk,
9 | } from "@midday/notification";
10 | import { createClient } from "@midday/supabase/job";
11 | import { render } from "@react-email/render";
12 | import { logger } from "@trigger.dev/sdk/v3";
13 |
14 | interface User {
15 |   id: string;
16 |   full_name: string;
17 |   avatar_url: string;
18 |   email: string;
19 |   locale: string;
20 | }
21 |
22 | interface Team {
23 |   inbox_id: string;
24 |   name: string;
25 | }
26 |
27 | interface UserData {
28 |   user: User;
29 |   team_id: string;
30 |   team: Team;
31 | }
32 |
33 | interface Transaction {
34 |   id: string;
35 |   date: string;
36 |   amount: number;
37 |   name: string;
38 |   currency: string;
39 |   category: string;
40 |   status: string;
41 | }
42 |
43 | export async function handleTransactionNotifications(
44 |   usersData: UserData[],
45 |   transactions: Transaction[],
46 | ) {
47 |   const notificationEvents = usersData.map(({ user, team_id }) => {
48 |     const { t } = getI18n({ locale: user.locale ?? "en" });
49 |
50 |     return {
51 |       name: TriggerEvents.TransactionsNewInApp,
52 |       payload: {
53 |         type: NotificationTypes.Transactions,
54 |         from: transactions[transactions.length - 1]?.date,
55 |         to: transactions[0]?.date,
56 |         description: t("notifications.transactions", {
57 |           numberOfTransactions: transactions.length,
58 |           // For single transaction
59 |           amount: transactions[0]?.amount,
60 |           name: transactions[0]?.name,
61 |         }),
62 |       },
63 |       user: {
64 |         subscriberId: user.id,
65 |         teamId: team_id,
66 |         email: user.email,
67 |         fullName: user.full_name,
68 |         avatarUrl: user.avatar_url,
69 |       },
70 |     };
71 |   });
72 |
73 |   const validNotificationEvents = notificationEvents.filter(Boolean);
74 |
75 |   try {
76 |     await triggerBulk(validNotificationEvents);
77 |   } catch (error) {
78 |     await logger.error("Transaction notifications", { error });
79 |   }
80 |
81 |   return validNotificationEvents;
82 | }
83 |
84 | export async function handleTransactionEmails(
85 |   usersData: UserData[],
86 |   transactions: Transaction[],
87 | ) {
88 |   const emailPromises = usersData.map(async ({ user, team_id, team }) => {
89 |     const { t } = getI18n({ locale: user.locale ?? "en" });
90 |
91 |     const html = await render(
92 |       <TransactionsEmail
93 |         fullName={user.full_name}
94 |         transactions={transactions}
95 |         locale={user.locale ?? "en"}
96 |         teamName={team.name}
97 |       />,
98 |     );
99 |
100 |     return {
101 |       name: TriggerEvents.TransactionNewEmail,
102 |       payload: {
103 |         subject: t("transactions.subject"),
104 |         html,
105 |       },
106 |       replyTo: getInboxEmail(team.inbox_id),
107 |       user: {
108 |         subscriberId: user.id,
109 |         teamId: team_id,
110 |         email: user.email,
111 |         fullName: user.full_name,
112 |         avatarUrl: user.avatar_url,
113 |       },
114 |     };
115 |   });
116 |
117 |   const validEmailPromises = await Promise.all(emailPromises);
118 |
119 |   try {
120 |     await triggerBulk(validEmailPromises);
121 |     logger.info("Transaction emails sent", {
122 |       count: validEmailPromises.length,
123 |     });
124 |   } catch (error) {
125 |     logger.error("Transaction emails", { error });
126 |   }
127 |
128 |   return validEmailPromises;
129 | }
130 |
131 | export async function handleTransactionSlackNotifications(
132 |   teamId: string,
133 |   transactions: Transaction[],
134 | ) {
135 |   const supabase = createClient();
136 |
137 |   // TODO: Get correct locale for formatting the amount
138 |   const slackTransactions = transactions.map((transaction) => ({
139 |     amount: Intl.NumberFormat("en-US", {
140 |       style: "currency",
141 |       currency: transaction.currency,
142 |     }).format(transaction.amount),
143 |     name: transaction.name,
144 |   }));
145 |
146 |   await sendSlackTransactionNotifications({
147 |     teamId,
148 |     transactions: slackTransactions,
149 |     supabase,
150 |   });
151 | }
```

apps/dashboard/jobs/utils/transform.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import { transformTransaction } from "./transform";
3 |
4 | test("transformTransaction should correctly transform transaction data", () => {
5 |   const mockTransaction = {
6 |     id: "123456",
7 |     name: "Coffee Shop",
8 |     description: "Morning coffee",
9 |     date: "2023-05-15",
10 |     amount: 5.5,
11 |     currency: "USD",
12 |     method: "card",
13 |     category: "meals",
14 |     balance: 100.5,
15 |     status: "posted" as "posted" | "pending",
16 |   };
17 |
18 |   const teamId = "team123";
19 |   const bankAccountId = "account456";
20 |
21 |   const result = transformTransaction({
22 |     transaction: mockTransaction,
23 |     teamId,
24 |     bankAccountId,
25 |   });
26 |
27 |   expect(result).toEqual({
28 |     name: "Coffee Shop",
29 |     description: "Morning coffee",
30 |     date: "2023-05-15",
31 |     amount: 5.5,
32 |     currency: "USD",
33 |     method: "card",
34 |     internal_id: "team123_123456",
35 |     category_slug: "meals",
36 |     bank_account_id: "account456",
37 |     balance: 100.5,
38 |     team_id: "team123",
39 |     status: "posted",
40 |   });
41 | });
42 |
43 | test("transformTransaction should handle null values correctly", () => {
44 |   const mockTransaction = {
45 |     id: "789012",
46 |     name: "Unknown Transaction",
47 |     description: null,
48 |     date: "2023-05-16",
49 |     amount: 10.0,
50 |     currency: "EUR",
51 |     method: null,
52 |     category: null,
53 |     balance: null,
54 |     status: "pending" as "posted" | "pending",
55 |   };
56 |
57 |   const teamId = "team456";
58 |   const bankAccountId = "account789";
59 |
60 |   const result = transformTransaction({
61 |     transaction: mockTransaction,
62 |     teamId,
63 |     bankAccountId,
64 |   });
65 |
66 |   expect(result).toEqual({
67 |     name: "Unknown Transaction",
68 |     description: null,
69 |     date: "2023-05-16",
70 |     amount: 10.0,
71 |     currency: "EUR",
72 |     method: null,
73 |     internal_id: "team456_789012",
74 |     category_slug: null,
75 |     bank_account_id: "account789",
76 |     balance: null,
77 |     team_id: "team456",
78 |     status: "pending",
79 |   });
80 | });
```

apps/dashboard/jobs/utils/transform.ts
```
1 | import type { Transactions } from "@midday-ai/engine/resources/transactions";
2 | import type { Database } from "@midday/supabase/types";
3 |
4 | type TransformTransactionData = {
5 |   transaction: Transactions.Data;
6 |   teamId: string;
7 |   bankAccountId: string;
8 |   notified?: boolean;
9 | };
10 |
11 | type Transaction = {
12 |   name: string;
13 |   internal_id: string;
14 |   category_slug: string | null;
15 |   bank_account_id: string;
16 |   description: string | null;
17 |   balance: number | null;
18 |   currency: string;
19 |   method: string | null;
20 |   amount: number;
21 |   team_id: string;
22 |   date: string;
23 |   status: "posted" | "pending";
24 |   notified?: boolean;
25 | };
26 |
27 | export function transformTransaction({
28 |   transaction,
29 |   teamId,
30 |   bankAccountId,
31 |   notified,
32 | }: TransformTransactionData): Transaction {
33 |   return {
34 |     name: transaction.name,
35 |     description: transaction.description,
36 |     date: transaction.date,
37 |     amount: transaction.amount,
38 |     currency: transaction.currency,
39 |     method: transaction.method,
40 |     internal_id: `${teamId}_${transaction.id}`,
41 |     category_slug: transaction.category,
42 |     bank_account_id: bankAccountId,
43 |     balance: transaction.balance,
44 |     team_id: teamId,
45 |     status: transaction.status,
46 |     // If the transactions are being synced manually, we don't want to notify
47 |     // And using upsert, we don't want to override the notified value
48 |     ...(notified ? { notified } : {}),
49 |   };
50 | }
51 |
52 | export function getClassification(
53 |   type: Database["public"]["Enums"]["account_type"],
54 | ) {
55 |   switch (type) {
56 |     case "credit":
57 |       return "credit";
58 |     default:
59 |       return "depository";
60 |   }
61 | }
```

apps/dashboard/jobs/utils/trigger-batch.ts
```
1 | import type { BatchRunHandle } from "@trigger.dev/sdk/v3";
2 |
3 | const BATCH_SIZE = 100;
4 |
5 | interface BatchItem<T> {
6 |   payload: T;
7 | }
8 |
9 | interface BatchTriggerTask<T> {
10 |   batchTrigger: (
11 |     items: BatchItem<T>[],
12 |   ) => Promise<BatchRunHandle<string, T, void>>;
13 | }
14 |
15 | export async function triggerBatch<T>(data: T[], task: BatchTriggerTask<T>) {
16 |   for (let i = 0; i < data.length; i += BATCH_SIZE) {
17 |     const chunk = data.slice(i, i + BATCH_SIZE);
18 |
19 |     await task.batchTrigger(
20 |       chunk.map((item) => ({
21 |         payload: item,
22 |       })),
23 |     );
24 |   }
25 | }
```

apps/dashboard/jobs/utils/trigger-sequence.ts
```
1 | import type { BatchRunHandle, TaskRunOptions } from "@trigger.dev/sdk/v3";
2 |
3 | interface TriggerTask<T> {
4 |   batchTriggerAndWait: (
5 |     items: { payload: T }[],
6 |     options?: TaskRunOptions & { delayMinutes?: number },
7 |   ) => Promise<BatchRunHandle<string, T, void>>;
8 | }
9 |
10 | export async function triggerSequenceAndWait<T>(
11 |   items: T[],
12 |   task: TriggerTask<T>,
13 |   options?: TaskRunOptions & { delayMinutes?: number },
14 | ) {
15 |   const { delayMinutes = 1, ...restOptions } = options ?? {};
16 |
17 |   const batchItems = items.map((item, i) => ({
18 |     payload: item,
19 |     options: {
20 |       ...restOptions,
21 |       delay: `${i * delayMinutes}min`,
22 |     },
23 |   }));
24 |
25 |   return task.batchTriggerAndWait(batchItems, restOptions);
26 | }
```

apps/dashboard/jobs/utils/update-invocie.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger } from "@trigger.dev/sdk/v3";
3 | import { sendInvoiceNotifications } from "jobs/tasks/invoice/notifications/send-notifications";
4 |
5 | export async function updateInvoiceStatus({
6 |   invoiceId,
7 |   status,
8 | }: {
9 |   invoiceId: string;
10 |   status: "overdue" | "paid";
11 | }): Promise<void> {
12 |   const supabase = createClient();
13 |
14 |   const { data: updatedInvoice } = await supabase
15 |     .from("invoices")
16 |     .update({ status })
17 |     .eq("id", invoiceId)
18 |     .select("id, invoice_number, status, team_id, customer_name")
19 |     .single();
20 |
21 |   if (
22 |     !updatedInvoice?.invoice_number ||
23 |     !updatedInvoice?.team_id ||
24 |     !updatedInvoice?.customer_name
25 |   ) {
26 |     logger.error("Invoice data is missing");
27 |     return;
28 |   }
29 |
30 |   logger.info(`Invoice status changed to ${status}`);
31 |
32 |   await sendInvoiceNotifications.trigger({
33 |     invoiceId,
34 |     invoiceNumber: updatedInvoice.invoice_number,
35 |     status: updatedInvoice.status as "paid" | "overdue",
36 |     teamId: updatedInvoice.team_id,
37 |     customerName: updatedInvoice.customer_name,
38 |   });
39 | }
```

apps/dashboard/public/assets/setup-animation-dark.json
```
[TRUNCATED]
```

apps/dashboard/public/assets/setup-animation.json
```
[TRUNCATED]
```

apps/dashboard/src/actions/accept-invite-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import {
5 |   revalidatePath as revalidatePathFunc,
6 |   revalidateTag,
7 | } from "next/cache";
8 | import { authActionClient } from "./safe-action";
9 | import { acceptInviteSchema } from "./schema";
10 |
11 | export const acceptInviteAction = authActionClient
12 |   .schema(acceptInviteSchema)
13 |   .metadata({
14 |     name: "accept-invite",
15 |     track: {
16 |       event: LogEvents.AcceptInvite.name,
17 |       channel: LogEvents.AcceptInvite.channel,
18 |     },
19 |   })
20 |   .action(
21 |     async ({
22 |       parsedInput: { id, revalidatePath },
23 |       ctx: { user, supabase },
24 |     }) => {
25 |       const { data: inviteData } = await supabase
26 |         .from("user_invites")
27 |         .select("*")
28 |         .eq("id", id)
29 |         .single();
30 |
31 |       if (!inviteData) {
32 |         return;
33 |       }
34 |
35 |       await supabase.from("users_on_team").insert({
36 |         user_id: user.id,
37 |         role: inviteData.role,
38 |         team_id: user.team_id as string,
39 |       });
40 |
41 |       await supabase.from("user_invites").delete().eq("id", id);
42 |
43 |       if (revalidatePath) {
44 |         revalidatePathFunc(revalidatePath);
45 |       }
46 |
47 |       revalidateTag(`teams_${user.id}`);
48 |
49 |       return id;
50 |     },
51 |   );
```

apps/dashboard/src/actions/bulk-update-transactions-action.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 | import { authActionClient } from "./safe-action";
5 | import { bulkUpdateTransactionsSchema } from "./schema";
6 |
7 | export const bulkUpdateTransactionsAction = authActionClient
8 |   .schema(bulkUpdateTransactionsSchema)
9 |   .metadata({
10 |     name: "bulk-update-transactions",
11 |   })
12 |   .action(
13 |     async ({ parsedInput: { type, ...payload }, ctx: { user, supabase } }) => {
14 |       if (type === "tags") {
15 |         const data = await supabase
16 |           .from("transaction_tags")
17 |           .insert(
18 |             payload.data.map(({ id, ...params }) => ({
19 |               transaction_id: id,
20 |               tag_id: params.tag_id,
21 |               team_id: user.team_id!,
22 |             })),
23 |           )
24 |           .select();
25 |
26 |         revalidateTag(`transactions_${user.team_id}`);
27 |
28 |         return data;
29 |       }
30 |
31 |       const updatePromises = payload.data.map(async ({ id, ...params }) => {
32 |         return supabase
33 |           .from("transactions")
34 |           .update(params)
35 |           .eq("id", id)
36 |           .eq("team_id", user.team_id)
37 |           .select();
38 |       });
39 |
40 |       const data = await Promise.all(updatePromises);
41 |
42 |       revalidateTag(`transactions_${user.team_id}`);
43 |       revalidateTag(`spending_${user.team_id}`);
44 |       revalidateTag(`metrics_${user.team_id}`);
45 |       revalidateTag(`current_burn_rate_${user.team_id}`);
46 |       revalidateTag(`burn_rate_${user.team_id}`);
47 |       revalidateTag(`expenses_${user.team_id}`);
48 |
49 |       return data;
50 |     },
51 |   );
```

apps/dashboard/src/actions/change-chart-period-action.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 | import { authActionClient } from "./safe-action";
5 | import { changeChartPeriodSchema } from "./schema";
6 |
7 | export const changeChartPeriodAction = authActionClient
8 |   .schema(changeChartPeriodSchema)
9 |   .metadata({
10 |     name: "change-chart-period",
11 |   })
12 |   .action(async ({ parsedInput: value, ctx: { user } }) => {
13 |     revalidateTag(`chart_${user.team_id}`);
14 |
15 |     return value;
16 |   });
```

apps/dashboard/src/actions/change-chart-type-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { revalidateTag } from "next/cache";
6 | import { cookies } from "next/headers";
7 | import { authActionClient } from "./safe-action";
8 | import { changeChartTypeSchema } from "./schema";
9 |
10 | export const changeChartTypeAction = authActionClient
11 |   .schema(changeChartTypeSchema)
12 |   .metadata({
13 |     name: "change-chart-type",
14 |   })
15 |   .action(async ({ parsedInput: value, ctx: { user } }) => {
16 |     cookies().set({
17 |       name: Cookies.ChartType,
18 |       value,
19 |       expires: addYears(new Date(), 1),
20 |     });
21 |
22 |     revalidateTag(`chart_${user.team_id}`);
23 |
24 |     return value;
25 |   });
```

apps/dashboard/src/actions/change-spending-period-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { revalidateTag } from "next/cache";
6 | import { cookies } from "next/headers";
7 | import { authActionClient } from "./safe-action";
8 | import { changeSpendingPeriodSchema } from "./schema";
9 |
10 | export const changeSpendingPeriodAction = authActionClient
11 |   .schema(changeSpendingPeriodSchema)
12 |   .metadata({
13 |     name: "change-spending-period",
14 |   })
15 |   .action(async ({ parsedInput: params, ctx: { user } }) => {
16 |     cookies().set({
17 |       name: Cookies.SpendingPeriod,
18 |       value: JSON.stringify(params),
19 |       expires: addYears(new Date(), 1),
20 |     });
21 |
22 |     revalidateTag(`spending_${user.team_id}`);
23 |
24 |     return params;
25 |   });
```

apps/dashboard/src/actions/change-team-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { updateUser } from "@midday/supabase/mutations";
5 | import { revalidateTag } from "next/cache";
6 | import { redirect } from "next/navigation";
7 | import { authActionClient } from "./safe-action";
8 | import { changeTeamSchema } from "./schema";
9 |
10 | export const changeTeamAction = authActionClient
11 |   .schema(changeTeamSchema)
12 |   .metadata({
13 |     name: "change-team",
14 |     track: {
15 |       event: LogEvents.ChangeTeam.name,
16 |       channel: LogEvents.ChangeTeam.channel,
17 |     },
18 |   })
19 |   .action(
20 |     async ({ parsedInput: { teamId, redirectTo }, ctx: { supabase } }) => {
21 |       const user = await updateUser(supabase, { team_id: teamId });
22 |
23 |       if (!user?.data) {
24 |         return;
25 |       }
26 |
27 |       revalidateTag(`user_${user.data.id}`);
28 |
29 |       redirect(redirectTo);
30 |     },
31 |   );
```

apps/dashboard/src/actions/change-transactions-period-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { revalidateTag } from "next/cache";
6 | import { cookies } from "next/headers";
7 | import { authActionClient } from "./safe-action";
8 | import { changeTransactionsPeriodSchema } from "./schema";
9 |
10 | export const changeTransactionsPeriodAction = authActionClient
11 |   .schema(changeTransactionsPeriodSchema)
12 |   .metadata({
13 |     name: "change-transactions-period",
14 |   })
15 |   .action(async ({ parsedInput: value, ctx: { user } }) => {
16 |     cookies().set({
17 |       name: Cookies.TransactionsPeriod,
18 |       value,
19 |       expires: addYears(new Date(), 1),
20 |     });
21 |
22 |     revalidateTag(`transactions_${user.team_id}`);
23 |
24 |     return value;
25 |   });
```

apps/dashboard/src/actions/change-user-role-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { updateUserTeamRole } from "@midday/supabase/mutations";
5 | import { revalidatePath as revalidatePathFunc } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { changeUserRoleSchema } from "./schema";
8 |
9 | export const changeUserRoleAction = authActionClient
10 |   .schema(changeUserRoleSchema)
11 |   .metadata({
12 |     name: "change-user-role",
13 |     track: {
14 |       event: LogEvents.UserRoleChange.name,
15 |       channel: LogEvents.UserRoleChange.channel,
16 |     },
17 |   })
18 |   .action(
19 |     async ({
20 |       parsedInput: { userId, teamId, role, revalidatePath },
21 |       ctx: { supabase },
22 |     }) => {
23 |       const { data } = await updateUserTeamRole(supabase, {
24 |         userId,
25 |         teamId,
26 |         role,
27 |       });
28 |
29 |       if (revalidatePath) {
30 |         revalidatePathFunc(revalidatePath);
31 |       }
32 |
33 |       return data;
34 |     },
35 |   );
```

apps/dashboard/src/actions/connect-bank-account-action.ts
```
1 | "use server";
2 |
3 | import { getMostFrequentCurrency } from "@/utils/currency";
4 | import { LogEvents } from "@midday/events/events";
5 | import { getTeamSettings } from "@midday/supabase/cached-queries";
6 | import { createBankConnection } from "@midday/supabase/mutations";
7 | import { initialBankSetup } from "jobs/tasks/bank/setup/initial";
8 | import { revalidateTag } from "next/cache";
9 | import { authActionClient } from "./safe-action";
10 | import { connectBankAccountSchema } from "./schema";
11 |
12 | export const connectBankAccountAction = authActionClient
13 |   .schema(connectBankAccountSchema)
14 |   .metadata({
15 |     name: "connect-bank-account",
16 |     track: {
17 |       event: LogEvents.ConnectBankCompleted.name,
18 |       channel: LogEvents.ConnectBankCompleted.channel,
19 |     },
20 |   })
21 |   .action(
22 |     async ({
23 |       parsedInput: {
24 |         provider,
25 |         accounts,
26 |         accessToken,
27 |         enrollmentId,
28 |         referenceId,
29 |       },
30 |       ctx: { supabase, user },
31 |     }) => {
32 |       const teamId = user.team_id;
33 |
34 |       if (!teamId) {
35 |         throw new Error("Team ID is required");
36 |       }
37 |
38 |       const { data } = await getTeamSettings();
39 |
40 |       const selectedCurrency = getMostFrequentCurrency(accounts);
41 |
42 |       // Update team settings with base currency if not set
43 |       if (!data?.base_currency && selectedCurrency && teamId) {
44 |         await supabase
45 |           .from("teams")
46 |           .update({
47 |             base_currency: selectedCurrency,
48 |           })
49 |           .eq("id", teamId);
50 |       }
51 |
52 |       const { data: bankConnection } = await createBankConnection(supabase, {
53 |         accessToken,
54 |         enrollmentId,
55 |         referenceId,
56 |         teamId,
57 |         userId: user.id,
58 |         accounts,
59 |         provider,
60 |       });
61 |
62 |       const event = await initialBankSetup.trigger({
63 |         teamId,
64 |         connectionId: bankConnection?.id,
65 |       });
66 |
67 |       revalidateTag(`bank_accounts_${teamId}`);
68 |       revalidateTag(`bank_accounts_currencies_${teamId}`);
69 |       revalidateTag(`bank_connections_${teamId}`);
70 |
71 |       return event;
72 |     },
73 |   );
```

apps/dashboard/src/actions/create-attachments-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { createAttachments } from "@midday/supabase/mutations";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { createAttachmentsSchema } from "./schema";
8 |
9 | export const createAttachmentsAction = authActionClient
10 |   .schema(createAttachmentsSchema)
11 |   .metadata({
12 |     name: "create-attachments",
13 |     track: {
14 |       event: LogEvents.CreateAttachment.name,
15 |       channel: LogEvents.CreateAttachment.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: files, ctx: { user, supabase } }) => {
19 |     const data = await createAttachments(supabase, files);
20 |
21 |     revalidateTag(`transactions_${user.team_id}`);
22 |
23 |     return data;
24 |   });
```

apps/dashboard/src/actions/create-bank-account-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { nanoid } from "nanoid";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { createBankAccountSchema } from "./schema";
8 |
9 | export const createBankAccountAction = authActionClient
10 |   .schema(createBankAccountSchema)
11 |   .metadata({
12 |     name: "create-bank-account",
13 |     track: {
14 |       event: LogEvents.BankAccountCreate.name,
15 |       channel: LogEvents.BankAccountCreate.channel,
16 |     },
17 |   })
18 |   .action(
19 |     async ({ parsedInput: { name, currency }, ctx: { user, supabase } }) => {
20 |       const { data, error } = await supabase
21 |         .from("bank_accounts")
22 |         .insert({
23 |           name,
24 |           currency,
25 |           team_id: user.team_id,
26 |           created_by: user.id,
27 |           enabled: true,
28 |           account_id: nanoid(),
29 |           manual: true,
30 |         })
31 |         .select("id, name")
32 |         .single();
33 |
34 |       if (error) {
35 |         throw Error(error.message);
36 |       }
37 |
38 |       revalidateTag(`bank_accounts_${user.team_id}`);
39 |       revalidateTag(`bank_accounts_currencies_${user.team_id}`);
40 |
41 |       return data;
42 |     },
43 |   );
```

apps/dashboard/src/actions/create-categories-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { createCategoriesSchema } from "./schema";
7 |
8 | export const createCategoriesAction = authActionClient
9 |   .schema(createCategoriesSchema)
10 |   .metadata({
11 |     name: "create-categories",
12 |     track: {
13 |       event: LogEvents.CategoryCreate.name,
14 |       channel: LogEvents.CategoryCreate.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: { categories }, ctx: { user, supabase } }) => {
18 |     const teamId = user.team_id;
19 |
20 |     const { data } = await supabase
21 |       .from("transaction_categories")
22 |       .insert(
23 |         categories.map((category) => ({
24 |           ...category,
25 |           team_id: teamId,
26 |         })),
27 |       )
28 |       .select("id, name, color, vat, slug");
29 |
30 |     revalidateTag(`transaction_categories_${teamId}`);
31 |
32 |     return data;
33 |   });
```

apps/dashboard/src/actions/create-customer-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { generateToken } from "@midday/invoice/token";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { createCustomerSchema } from "./schema";
8 |
9 | export const createCustomerAction = authActionClient
10 |   .schema(createCustomerSchema)
11 |   .metadata({
12 |     name: "create-customer",
13 |     track: {
14 |       event: LogEvents.CreateCustomer.name,
15 |       channel: LogEvents.CreateCustomer.channel,
16 |     },
17 |   })
18 |   .action(
19 |     async ({ parsedInput: { tags, ...input }, ctx: { user, supabase } }) => {
20 |       const token = await generateToken(user.id);
21 |
22 |       const { data } = await supabase
23 |         .from("customers")
24 |         .upsert(
25 |           {
26 |             ...input,
27 |             token,
28 |             team_id: user.team_id,
29 |           },
30 |           {
31 |             onConflict: "id",
32 |           },
33 |         )
34 |         .select("id, name")
35 |         .single();
36 |
37 |       if (tags?.length) {
38 |         await supabase.from("customer_tags").insert(
39 |           tags.map((tag) => ({
40 |             tag_id: tag.id,
41 |             customer_id: data?.id,
42 |             team_id: user.team_id!,
43 |           })),
44 |         );
45 |       }
46 |
47 |       revalidateTag(`customers_${user.team_id}`);
48 |
49 |       return data;
50 |     },
51 |   );
```

apps/dashboard/src/actions/create-folder-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { createFolder } from "@midday/supabase/storage";
5 | import { revalidatePath } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { createFolderSchema } from "./schema";
8 |
9 | export const createFolderAction = authActionClient
10 |   .schema(createFolderSchema)
11 |   .metadata({
12 |     name: "create-folder",
13 |     track: {
14 |       event: LogEvents.CreateFolder.name,
15 |       channel: LogEvents.CreateFolder.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: value, ctx: { user, supabase } }) => {
19 |     const data = await createFolder(supabase, {
20 |       bucket: "vault",
21 |       path: [user.team_id, value.path],
22 |       name: value.name,
23 |     });
24 |
25 |     revalidatePath("/vault");
26 |
27 |     return data;
28 |   });
```

apps/dashboard/src/actions/create-tag-action.tsx
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { authActionClient } from "./safe-action";
5 | import { createTagSchema } from "./schema";
6 |
7 | export const createTagAction = authActionClient
8 |   .schema(createTagSchema)
9 |   .metadata({
10 |     name: "create-tag",
11 |     track: {
12 |       event: LogEvents.CreateTag.name,
13 |       channel: LogEvents.CreateTag.channel,
14 |     },
15 |   })
16 |   .action(async ({ parsedInput: { name }, ctx: { user, supabase } }) => {
17 |     const { data } = await supabase
18 |       .from("tags")
19 |       .insert({
20 |         name,
21 |         team_id: user.team_id!,
22 |       })
23 |       .select("id, name")
24 |       .single();
25 |
26 |     return data;
27 |   });
```

apps/dashboard/src/actions/create-team-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { getCurrency } from "@midday/location";
5 | import { createTeam, updateUser } from "@midday/supabase/mutations";
6 | import { revalidateTag } from "next/cache";
7 | import { redirect } from "next/navigation";
8 | import { authActionClient } from "./safe-action";
9 | import { createTeamSchema } from "./schema";
10 |
11 | export const createTeamAction = authActionClient
12 |   .schema(createTeamSchema)
13 |   .metadata({
14 |     name: "create-team",
15 |     track: {
16 |       event: LogEvents.CreateTeam.name,
17 |       channel: LogEvents.CreateTeam.channel,
18 |     },
19 |   })
20 |   .action(async ({ parsedInput: { name, redirectTo }, ctx: { supabase } }) => {
21 |     const currency = getCurrency();
22 |     const team_id = await createTeam(supabase, { name, currency });
23 |     const user = await updateUser(supabase, { team_id });
24 |
25 |     if (!user?.data) {
26 |       return;
27 |     }
28 |
29 |     revalidateTag(`user_${user.data.id}`);
30 |     revalidateTag(`teams_${user.data.id}`);
31 |
32 |     if (redirectTo) {
33 |       redirect(redirectTo);
34 |     }
35 |
36 |     return team_id;
37 |   });
```

apps/dashboard/src/actions/create-tracker-entries-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { UTCDate } from "@date-fns/utc";
5 | import { revalidateTag } from "next/cache";
6 | import { cookies } from "next/headers";
7 | import { z } from "zod";
8 | import { authActionClient } from "./safe-action";
9 |
10 | export const createTrackerEntriesAction = authActionClient
11 |   .schema(
12 |     z.object({
13 |       id: z.string().optional(),
14 |       start: z.string(),
15 |       stop: z.string(),
16 |       dates: z.array(z.string()),
17 |       assigned_id: z.string(),
18 |       project_id: z.string(),
19 |       description: z.string().optional(),
20 |       duration: z.number(),
21 |     }),
22 |   )
23 |   .metadata({
24 |     name: "create-tracker-entries",
25 |   })
26 |   .action(
27 |     async ({ parsedInput: { dates, ...params }, ctx: { supabase, user } }) => {
28 |       cookies().set(Cookies.LastProject, params.project_id);
29 |
30 |       const entries = dates.map((date) => ({
31 |         ...params,
32 |         team_id: user.team_id,
33 |         date: new UTCDate(date).toISOString(),
34 |         start: new UTCDate(params.start).toISOString(),
35 |         stop: new UTCDate(params.stop).toISOString(),
36 |       }));
37 |
38 |       const { data, error } = await supabase
39 |         .from("tracker_entries")
40 |         .upsert(entries, {
41 |           ignoreDuplicates: false,
42 |         })
43 |         .select(
44 |           "*, assigned:assigned_id(id, full_name, avatar_url), project:project_id(id, name, rate, currency)",
45 |         );
46 |
47 |       if (error) {
48 |         throw error;
49 |       }
50 |
51 |       revalidateTag(`tracker_entries_${user.team_id}`);
52 |       revalidateTag(`tracker_projects_${user.team_id}`);
53 |
54 |       return data;
55 |     },
56 |   );
```

apps/dashboard/src/actions/create-transaction-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { createAttachments } from "@midday/supabase/mutations";
5 | import { nanoid } from "nanoid";
6 | import { revalidateTag } from "next/cache";
7 | import { authActionClient } from "./safe-action";
8 | import { createTransactionSchema } from "./schema";
9 |
10 | export const createTransactionAction = authActionClient
11 |   .schema(createTransactionSchema)
12 |   .metadata({
13 |     name: "create-transaction",
14 |     track: {
15 |       event: LogEvents.CreateTransaction.name,
16 |       channel: LogEvents.CreateTransaction.channel,
17 |     },
18 |   })
19 |   .action(
20 |     async ({
21 |       parsedInput: { attachments, ...transaction },
22 |       ctx: { user, supabase },
23 |     }) => {
24 |       const teamId = user.team_id;
25 |
26 |       const { data: accountData } = await supabase
27 |         .from("bank_accounts")
28 |         .select("id, currency")
29 |         .eq("id", transaction.bank_account_id)
30 |         .is("currency", null)
31 |         .single();
32 |
33 |       // If the account currency is not set, set it to the transaction currency
34 |       // Usually this is the case for new accounts
35 |       if (!accountData?.currency) {
36 |         await supabase
37 |           .from("bank_accounts")
38 |           .update({
39 |             currency: transaction.currency,
40 |             base_currency: transaction.currency,
41 |           })
42 |           .eq("id", transaction.bank_account_id);
43 |       }
44 |
45 |       const { data } = await supabase
46 |         .from("transactions")
47 |         .insert({
48 |           ...transaction,
49 |           team_id: teamId,
50 |           method: "other",
51 |           manual: true,
52 |           notified: true,
53 |           internal_id: `${teamId}_${nanoid()}`,
54 |         })
55 |         .select("*")
56 |         .single();
57 |
58 |       if (attachments && data) {
59 |         await createAttachments(
60 |           supabase,
61 |           attachments.map((attachment) => ({
62 |             ...attachment,
63 |             transaction_id: data.id,
64 |           })),
65 |         );
66 |       }
67 |
68 |       revalidateTag(`transactions_${teamId}`);
69 |       revalidateTag(`spending_${teamId}`);
70 |       revalidateTag(`metrics_${teamId}`);
71 |       revalidateTag(`insights_${teamId}`);
72 |
73 |       return data;
74 |     },
75 |   );
```

apps/dashboard/src/actions/create-transaction-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { createTransactionTagSchema } from "./schema";
7 |
8 | export const createTransactionTagAction = authActionClient
9 |   .schema(createTransactionTagSchema)
10 |   .metadata({
11 |     name: "create-transaction-tag",
12 |     track: {
13 |       event: LogEvents.CreateTransactionTag.name,
14 |       channel: LogEvents.CreateTransactionTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({
19 |       parsedInput: { tagId, transactionId },
20 |       ctx: { user, supabase },
21 |     }) => {
22 |       const { data } = await supabase.from("transaction_tags").insert({
23 |         tag_id: tagId,
24 |         transaction_id: transactionId,
25 |         team_id: user.team_id!,
26 |       });
27 |
28 |       revalidateTag(`transactions_${user.team_id}`);
29 |
30 |       return data;
31 |     },
32 |   );
```

apps/dashboard/src/actions/create-transactions-action.ts
```
1 | "use server";
2 |
3 | import { processPromisesBatch } from "@/utils/process";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { createTransactionsSchema } from "./schema";
7 |
8 | const BATCH_LIMIT = 300;
9 |
10 | export const createTransactionsAction = authActionClient
11 |   .schema(createTransactionsSchema)
12 |   .metadata({
13 |     name: "create-transactions",
14 |   })
15 |   .action(
16 |     async ({
17 |       parsedInput: { currency, transactions, accountId },
18 |       ctx: { user, supabase },
19 |     }) => {
20 |       const teamId = user.team_id;
21 |
22 |       // Update account with currency if not set
23 |       await supabase
24 |         .from("bank_accounts")
25 |         .update({
26 |           currency,
27 |         })
28 |         .eq("id", accountId)
29 |         .is("currency", null);
30 |
31 |       // NOTE: We will get all the transactions at once for each account so
32 |       // we need to guard against massive payloads
33 |       await processPromisesBatch(transactions, BATCH_LIMIT, async (batch) => {
34 |         await supabase.from("transactions").upsert(batch, {
35 |           onConflict: "internal_id",
36 |           ignoreDuplicates: true,
37 |         });
38 |       });
39 |
40 |       revalidateTag(`bank_connections_${teamId}`);
41 |       revalidateTag(`transactions_${teamId}`);
42 |       revalidateTag(`spending_${teamId}`);
43 |       revalidateTag(`metrics_${teamId}`);
44 |       revalidateTag(`bank_accounts_${teamId}`);
45 |       revalidateTag(`insights_${teamId}`);
46 |
47 |       return;
48 |     },
49 |   );
```

apps/dashboard/src/actions/decline-invite-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidatePath as revalidatePathFunc } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { declineInviteSchema } from "./schema";
7 |
8 | export const declineInviteAction = authActionClient
9 |   .schema(declineInviteSchema)
10 |   .metadata({
11 |     name: "decline-invite",
12 |     track: {
13 |       event: LogEvents.DeclineInvite.name,
14 |       channel: LogEvents.DeclineInvite.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { id, revalidatePath }, ctx: { supabase } }) => {
19 |       const data = await supabase
20 |         .from("user_invites")
21 |         .delete()
22 |         .eq("id", id)
23 |         .select();
24 |
25 |       if (revalidatePath) {
26 |         revalidatePathFunc(revalidatePath);
27 |       }
28 |
29 |       return data;
30 |     },
31 |   );
```

apps/dashboard/src/actions/delete-attachment-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { deleteAttachment } from "@midday/supabase/mutations";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteAttachmentSchema } from "./schema";
8 |
9 | export const deleteAttachmentAction = authActionClient
10 |   .schema(deleteAttachmentSchema)
11 |   .metadata({
12 |     name: "delete-attachment",
13 |     track: {
14 |       event: LogEvents.DeleteAttachment.name,
15 |       channel: LogEvents.DeleteAttachment.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: files, ctx: { user, supabase } }) => {
19 |     const data = await deleteAttachment(supabase, files);
20 |
21 |     if (!data?.transaction_id) {
22 |       return null;
23 |     }
24 |
25 |     revalidateTag(`transactions_${user.team_id}`);
26 |
27 |     // Find inbox by attachment_id and delete attachment_id
28 |     await supabase
29 |       .from("inbox")
30 |       .update({
31 |         transaction_id: null,
32 |       })
33 |       .eq("transaction_id", data.transaction_id);
34 |
35 |     return data;
36 |   });
```

apps/dashboard/src/actions/delete-bank-account-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { deleteBankAccount } from "@midday/supabase/mutations";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteBankAccountSchema } from "./schema";
8 |
9 | export const deleteBankAccountAction = authActionClient
10 |   .schema(deleteBankAccountSchema)
11 |   .metadata({
12 |     name: "delete-bank-account",
13 |     track: {
14 |       event: LogEvents.DeleteBank.name,
15 |       channel: LogEvents.DeleteBank.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: { id }, ctx: { user, supabase } }) => {
19 |     await deleteBankAccount(supabase, id);
20 |
21 |     revalidateTag(`bank_accounts_${user.team_id}`);
22 |     revalidateTag(`bank_accounts_currencies_${user.team_id}`);
23 |     revalidateTag(`bank_connections_${user.team_id}`);
24 |     revalidateTag(`transactions_${user.team_id}`);
25 |     revalidateTag(`metrics_${user.team_id}`);
26 |     revalidateTag(`current_burn_rate_${user.team_id}`);
27 |     revalidateTag(`burn_rate_${user.team_id}`);
28 |     revalidateTag(`spending_${user.team_id}`);
29 |     revalidateTag(`insights_${user.team_id}`);
30 |     revalidateTag(`expenses_${user.team_id}`);
31 |   });
```

apps/dashboard/src/actions/delete-categories-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import {
5 |   revalidatePath as revalidatePathFunc,
6 |   revalidateTag,
7 | } from "next/cache";
8 | import { authActionClient } from "./safe-action";
9 | import { deleteCategoriesSchema } from "./schema";
10 |
11 | export const deleteCategoriesAction = authActionClient
12 |   .schema(deleteCategoriesSchema)
13 |   .metadata({
14 |     name: "delete-categories",
15 |     track: {
16 |       event: LogEvents.CategoryDelete.name,
17 |       channel: LogEvents.CategoryDelete.channel,
18 |     },
19 |   })
20 |   .action(
21 |     async ({
22 |       parsedInput: { ids, revalidatePath },
23 |       ctx: { user, supabase },
24 |     }) => {
25 |       const response = await supabase
26 |         .from("transaction_categories")
27 |         .delete()
28 |         .in("id", ids)
29 |         .eq("system", false)
30 |         .select();
31 |
32 |       revalidatePathFunc(revalidatePath);
33 |       revalidateTag(`transactions_${user.team_id}`);
34 |       revalidateTag(`spending_${user.team_id}`);
35 |
36 |       return response;
37 |     },
38 |   );
```

apps/dashboard/src/actions/delete-customer-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { z } from "zod";
6 | import { authActionClient } from "./safe-action";
7 |
8 | export const deleteCustomerAction = authActionClient
9 |   .schema(z.object({ id: z.string().uuid() }))
10 |   .metadata({
11 |     name: "delete-customer",
12 |     track: {
13 |       event: LogEvents.DeleteCustomer.name,
14 |       channel: LogEvents.DeleteCustomer.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: input, ctx: { user, supabase } }) => {
18 |     const { data } = await supabase
19 |       .from("customers")
20 |       .delete()
21 |       .eq("id", input.id)
22 |       .select("id");
23 |
24 |     revalidateTag(`customers_${user.team_id}`);
25 |     revalidateTag(`invoices_${user.team_id}`);
26 |
27 |     return data;
28 |   });
```

apps/dashboard/src/actions/delete-file-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { remove } from "@midday/supabase/storage";
5 | import { revalidatePath } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteFileSchema } from "./schema";
8 |
9 | export const deleteFileAction = authActionClient
10 |   .schema(deleteFileSchema)
11 |   .metadata({
12 |     name: "delete-file",
13 |     track: {
14 |       event: LogEvents.DeleteFile.name,
15 |       channel: LogEvents.DeleteFile.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: { path, id }, ctx: { user, supabase } }) => {
19 |     await remove(supabase, {
20 |       bucket: "vault",
21 |       path: [user.team_id, ...path],
22 |     });
23 |
24 |     revalidatePath("/vault");
25 |
26 |     return id;
27 |   });
```

apps/dashboard/src/actions/delete-folder-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { deleteFolder } from "@midday/supabase/storage";
5 | import { revalidatePath } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteFolderSchema } from "./schema";
8 |
9 | export const deleteFolderAction = authActionClient
10 |   .schema(deleteFolderSchema)
11 |   .metadata({
12 |     name: "delete-folder",
13 |     track: {
14 |       event: LogEvents.DeleteFolder.name,
15 |       channel: LogEvents.DeleteFolder.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: { path }, ctx: { user, supabase } }) => {
19 |     await deleteFolder(supabase, {
20 |       bucket: "vault",
21 |       path: [user.team_id, ...path],
22 |     });
23 |
24 |     revalidatePath("/vault");
25 |
26 |     return;
27 |   });
```

apps/dashboard/src/actions/delete-invite-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidatePath as revalidatePathFunc } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { deleteInviteSchema } from "./schema";
7 |
8 | export const deleteInviteAction = authActionClient
9 |   .schema(deleteInviteSchema)
10 |   .metadata({
11 |     name: "delete-invite",
12 |     track: {
13 |       event: LogEvents.DeleteInvite.name,
14 |       channel: LogEvents.DeleteInvite.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { id, revalidatePath }, ctx: { supabase } }) => {
19 |       await supabase.from("user_invites").delete().eq("id", id);
20 |
21 |       if (revalidatePath) {
22 |         revalidatePathFunc(revalidatePath);
23 |       }
24 |
25 |       return id;
26 |     },
27 |   );
```

apps/dashboard/src/actions/delete-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { deleteTagSchema } from "./schema";
7 |
8 | export const deleteTagAction = authActionClient
9 |   .schema(deleteTagSchema)
10 |   .metadata({
11 |     name: "delete-tag",
12 |     track: {
13 |       event: LogEvents.DeleteTag.name,
14 |       channel: LogEvents.DeleteTag.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: { id }, ctx: { supabase, user } }) => {
18 |     const { data } = await supabase
19 |       .from("tags")
20 |       .delete()
21 |       .eq("id", id)
22 |       .select("id, name")
23 |       .single();
24 |
25 |     revalidateTag(`tracker_projects_${user.team_id}`);
26 |     revalidateTag(`transactions_${user.team_id}`);
27 |
28 |     return data;
29 |   });
```

apps/dashboard/src/actions/delete-team-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { deleteTeam } from "jobs/tasks/team/delete";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteTeamSchema } from "./schema";
8 |
9 | export const deleteTeamAction = authActionClient
10 |   .schema(deleteTeamSchema)
11 |   .metadata({
12 |     name: "delete-team",
13 |     track: {
14 |       event: LogEvents.DeleteTeam.name,
15 |       channel: LogEvents.DeleteTeam.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: { teamId }, ctx: { user, supabase } }) => {
19 |     const { data: teamData } = await supabase
20 |       .from("teams")
21 |       .delete()
22 |       .eq("id", teamId)
23 |       .select("id, bank_connections(access_token, provider, reference_id)")
24 |       .single();
25 |
26 |     await deleteTeam.trigger({
27 |       teamId,
28 |       connections: teamData?.bank_connections ?? [],
29 |     });
30 |
31 |     revalidateTag(`user_${user.id}`);
32 |     revalidateTag(`teams_${user.id}`);
33 |
34 |     return teamId;
35 |   });
```

apps/dashboard/src/actions/delete-team-member-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { deleteTeamMember } from "@midday/supabase/mutations";
5 | import { revalidatePath as revalidatePathFunc } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { deleteTeamMemberSchema } from "./schema";
8 |
9 | export const deleteTeamMemberAction = authActionClient
10 |   .schema(deleteTeamMemberSchema)
11 |   .metadata({
12 |     name: "delete-team-member",
13 |     track: {
14 |       event: LogEvents.DeleteTeamMember.name,
15 |       channel: LogEvents.DeleteTeamMember.channel,
16 |     },
17 |   })
18 |   .action(
19 |     async ({
20 |       parsedInput: { revalidatePath, teamId, userId },
21 |       ctx: { supabase },
22 |     }) => {
23 |       const { data } = await deleteTeamMember(supabase, { teamId, userId });
24 |
25 |       if (revalidatePath) {
26 |         revalidatePathFunc(revalidatePath);
27 |       }
28 |
29 |       return data;
30 |     },
31 |   );
```

apps/dashboard/src/actions/delete-tracker-entry.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 | import { z } from "zod";
5 | import { authActionClient } from "./safe-action";
6 |
7 | export const deleteTrackerEntryAction = authActionClient
8 |   .schema(
9 |     z.object({
10 |       id: z.string(),
11 |     }),
12 |   )
13 |   .metadata({
14 |     name: "delete-tracker-entry",
15 |   })
16 |   .action(async ({ parsedInput: { id }, ctx: { supabase, user } }) => {
17 |     const { data, error } = await supabase
18 |       .from("tracker_entries")
19 |       .delete()
20 |       .eq("id", id)
21 |       .select();
22 |
23 |     if (error) {
24 |       throw error;
25 |     }
26 |
27 |     revalidateTag(`tracker_entries_${user.team_id}`);
28 |
29 |     return data;
30 |   });
```

apps/dashboard/src/actions/delete-transaction-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { deleteTransactionTagSchema } from "./schema";
7 |
8 | export const deleteTransactionTagAction = authActionClient
9 |   .schema(deleteTransactionTagSchema)
10 |   .metadata({
11 |     name: "delete-transaction-tag",
12 |     track: {
13 |       event: LogEvents.DeleteTransactionTag.name,
14 |       channel: LogEvents.DeleteTransactionTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({
19 |       parsedInput: { tagId, transactionId },
20 |       ctx: { user, supabase },
21 |     }) => {
22 |       const { data } = await supabase
23 |         .from("transaction_tags")
24 |         .delete()
25 |         .eq("transaction_id", transactionId)
26 |         .eq("tag_id", tagId);
27 |
28 |       revalidateTag(`transactions_${user.team_id}`);
29 |
30 |       return data;
31 |     },
32 |   );
```

apps/dashboard/src/actions/delete-transactions-action.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 | import { authActionClient } from "./safe-action";
5 | import { deleteTransactionSchema } from "./schema";
6 |
7 | export const deleteTransactionsAction = authActionClient
8 |   .schema(deleteTransactionSchema)
9 |   .metadata({
10 |     name: "delete-transactions",
11 |   })
12 |   .action(async ({ parsedInput: { ids }, ctx: { user, supabase } }) => {
13 |     await supabase
14 |       .from("transactions")
15 |       .delete()
16 |       .in("id", ids)
17 |       .is("manual", true);
18 |
19 |     revalidateTag(`transactions_${user.team_id}`);
20 |     revalidateTag(`spending_${user.team_id}`);
21 |     revalidateTag(`metrics_${user.team_id}`);
22 |     revalidateTag(`current_burn_rate_${user.team_id}`);
23 |     revalidateTag(`burn_rate_${user.team_id}`);
24 |     revalidateTag(`expenses_${user.team_id}`);
25 |   });
```

apps/dashboard/src/actions/delete-user-action.ts
```
1 | "use server";
2 |
3 | import { resend } from "@/utils/resend";
4 | import { LogEvents } from "@midday/events/events";
5 | import { setupAnalytics } from "@midday/events/server";
6 | import { getUser } from "@midday/supabase/cached-queries";
7 | import { deleteUser } from "@midday/supabase/mutations";
8 | import { createClient } from "@midday/supabase/server";
9 | import { redirect } from "next/navigation";
10 |
11 | export const deleteUserAction = async () => {
12 |   const supabase = createClient();
13 |   const user = await getUser();
14 |
15 |   const { data: membersData } = await supabase
16 |     .from("users_on_team")
17 |     .select("team_id, team:team_id(id, name, members:users_on_team(id))")
18 |     .eq("user_id", user?.data?.id);
19 |
20 |   const teamIds = membersData
21 |     ?.filter(({ team }) => team?.members.length === 1)
22 |     .map(({ team_id }) => team_id);
23 |
24 |   if (teamIds?.length) {
25 |     // Delete all teams with only one member
26 |     await supabase.from("teams").delete().in("id", teamIds);
27 |   }
28 |
29 |   const userId = await deleteUser(supabase);
30 |
31 |   await resend.contacts.remove({
32 |     email: user.data?.email!,
33 |     audienceId: process.env.RESEND_AUDIENCE_ID!,
34 |   });
35 |
36 |   const analytics = await setupAnalytics({
37 |     userId,
38 |   });
39 |
40 |   analytics.track({
41 |     event: LogEvents.DeleteUser.name,
42 |     user_id: userId,
43 |     channel: LogEvents.DeleteUser.channel,
44 |   });
45 |
46 |   redirect("/");
47 | };
```

apps/dashboard/src/actions/disconnect-app-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidatePath } from "next/cache";
5 | import { z } from "zod";
6 | import { authActionClient } from "./safe-action";
7 |
8 | export const disconnectAppAction = authActionClient
9 |   .schema(
10 |     z.object({
11 |       appId: z.string(),
12 |     }),
13 |   )
14 |   .metadata({
15 |     name: "disconnect-app",
16 |     track: {
17 |       event: LogEvents.DisconnectApp.name,
18 |       channel: LogEvents.DisconnectApp.channel,
19 |     },
20 |   })
21 |   .action(async ({ parsedInput: { appId }, ctx: { supabase, user } }) => {
22 |     const { data } = await supabase
23 |       .from("apps")
24 |       .delete()
25 |       .eq("app_id", appId)
26 |       .eq("team_id", user.team_id)
27 |       .select();
28 |
29 |     revalidatePath("/apps");
30 |
31 |     return data;
32 |   });
```

apps/dashboard/src/actions/export-transactions-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { exportTransactions } from "jobs/tasks/transactions/export";
5 | import { authActionClient } from "./safe-action";
6 | import { exportTransactionsSchema } from "./schema";
7 |
8 | export const exportTransactionsAction = authActionClient
9 |   .schema(exportTransactionsSchema)
10 |   .metadata({
11 |     name: "export-transactions",
12 |     track: {
13 |       event: LogEvents.ExportTransactions.name,
14 |       channel: LogEvents.ExportTransactions.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: transactionIds, ctx: { user } }) => {
18 |     if (!user.team_id || !user.locale) {
19 |       throw new Error("User not found");
20 |     }
21 |
22 |     const event = await exportTransactions.trigger({
23 |       teamId: user.team_id,
24 |       locale: user.locale,
25 |       transactionIds,
26 |     });
27 |
28 |     return event;
29 |   });
```

apps/dashboard/src/actions/hide-connect-flow-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { cookies } from "next/headers";
6 | import { authActionClient } from "./safe-action";
7 |
8 | export const hideConnectFlowAction = authActionClient
9 |   .metadata({
10 |     name: "hide-connect-flow",
11 |   })
12 |   .action(async () => {
13 |     cookies().set({
14 |       name: Cookies.HideConnectFlow,
15 |       value: "true",
16 |       expires: addYears(new Date(), 1),
17 |     });
18 |   });
```

apps/dashboard/src/actions/inbox-upload-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { inboxUpload } from "jobs/tasks/inbox/upload";
5 | import { authActionClient } from "./safe-action";
6 | import { inboxUploadSchema } from "./schema";
7 |
8 | export const inboxUploadAction = authActionClient
9 |   .schema(inboxUploadSchema)
10 |   .metadata({
11 |     name: "inbox-upload",
12 |     track: {
13 |       event: LogEvents.InboxUpload.name,
14 |       channel: LogEvents.InboxUpload.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: uploads, ctx: { user } }) => {
18 |     if (!user.team_id) {
19 |       throw new Error("No team id");
20 |     }
21 |
22 |     const results = await inboxUpload.batchTrigger(
23 |       uploads.map((upload, idx) => ({
24 |         payload: {
25 |           ...upload,
26 |           id: `upload-${idx}`,
27 |           teamId: user.team_id!,
28 |         },
29 |       })),
30 |     );
31 |
32 |     return results;
33 |   });
```

apps/dashboard/src/actions/invalidate-cache-action.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 |
5 | export async function invalidateCacheAction(tags: string[]) {
6 |   return Promise.all(tags.map(async (tag) => revalidateTag(tag)));
7 | }
```

apps/dashboard/src/actions/invite-team-members-action.ts
```
1 | "use server";
2 |
3 | import { resend } from "@/utils/resend";
4 | import InviteEmail from "@midday/email/emails/invite";
5 | import { getI18n } from "@midday/email/locales";
6 | import { LogEvents } from "@midday/events/events";
7 | import { render } from "@react-email/render";
8 | import { nanoid } from "nanoid";
9 | import { revalidatePath as revalidatePathFunc } from "next/cache";
10 | import { headers } from "next/headers";
11 | import { redirect } from "next/navigation";
12 | import { authActionClient } from "./safe-action";
13 | import { inviteTeamMembersSchema } from "./schema";
14 |
15 | export const inviteTeamMembersAction = authActionClient
16 |   .schema(inviteTeamMembersSchema)
17 |   .metadata({
18 |     name: "invite-team-members",
19 |     track: {
20 |       event: LogEvents.InviteTeamMembers.name,
21 |       channel: LogEvents.InviteTeamMembers.channel,
22 |     },
23 |   })
24 |   .action(
25 |     async ({
26 |       parsedInput: { invites, redirectTo, revalidatePath },
27 |       ctx: { user, supabase },
28 |     }) => {
29 |       const { t } = getI18n({ locale: user.locale });
30 |
31 |       const location = headers().get("x-vercel-ip-city") ?? "Unknown";
32 |       const ip = headers().get("x-forwarded-for") ?? "127.0.0.1";
33 |
34 |       const data = invites?.map((invite) => ({
35 |         ...invite,
36 |         team_id: user.team_id,
37 |         invited_by: user.id,
38 |       }));
39 |
40 |       const { data: invtesData } = await supabase
41 |         .from("user_invites")
42 |         .upsert(data, {
43 |           onConflict: "email, team_id",
44 |           ignoreDuplicates: false,
45 |         })
46 |         .select("email, code, user:invited_by(*), team:team_id(*)");
47 |
48 |       const emails = invtesData?.map(async (invites) => ({
49 |         from: "Midday <middaybot@midday.ai>",
50 |         to: [invites.email],
51 |         subject: t("invite.subject", {
52 |           invitedByName: invites.user.full_name,
53 |           teamName: invites.team.name,
54 |         }),
55 |         headers: {
56 |           "X-Entity-Ref-ID": nanoid(),
57 |         },
58 |         html: await render(
59 |           InviteEmail({
60 |             invitedByEmail: invites.user.email,
61 |             invitedByName: invites.user.full_name,
62 |             email: invites.email,
63 |             teamName: invites.team.name,
64 |             inviteCode: invites.code,
65 |             ip,
66 |             location,
67 |             locale: user.locale,
68 |           }),
69 |         ),
70 |       }));
71 |
72 |       const htmlEmails = await Promise.all(emails);
73 |
74 |       await resend.batch.send(htmlEmails);
75 |
76 |       if (revalidatePath) {
77 |         revalidatePathFunc(revalidatePath);
78 |       }
79 |
80 |       if (redirectTo) {
81 |         redirect(redirectTo);
82 |       }
83 |     },
84 |   );
```

apps/dashboard/src/actions/leave-team-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { getTeamMembers } from "@midday/supabase/cached-queries";
5 | import { leaveTeam } from "@midday/supabase/mutations";
6 | import {
7 |   revalidatePath as revalidatePathFunc,
8 |   revalidateTag,
9 | } from "next/cache";
10 | import { redirect } from "next/navigation";
11 | import { authActionClient } from "./safe-action";
12 | import { leaveTeamSchema } from "./schema";
13 |
14 | export const leaveTeamAction = authActionClient
15 |   .schema(leaveTeamSchema)
16 |   .metadata({
17 |     name: "leave-team",
18 |     track: {
19 |       event: LogEvents.LeaveTeam.name,
20 |       channel: LogEvents.LeaveTeam.channel,
21 |     },
22 |   })
23 |   .action(
24 |     async ({
25 |       parsedInput: { teamId, role, redirectTo, revalidatePath },
26 |       ctx: { user, supabase },
27 |     }) => {
28 |       const { data: teamMembersData } = await getTeamMembers();
29 |
30 |       const totalOwners = teamMembersData.filter(
31 |         (member) => member.role === "owner",
32 |       ).length;
33 |
34 |       if (role === "owner" && totalOwners === 1) {
35 |         throw Error("Action not allowed");
36 |       }
37 |
38 |       const { data, error } = await leaveTeam(supabase, {
39 |         teamId,
40 |         userId: user.id,
41 |       });
42 |
43 |       revalidateTag(`user_${user.id}`);
44 |       revalidateTag(`teams_${user.id}`);
45 |
46 |       if (revalidatePath) {
47 |         revalidatePathFunc(revalidatePath);
48 |       }
49 |
50 |       if (redirectTo) {
51 |         redirect(redirectTo);
52 |       }
53 |
54 |       return data;
55 |     },
56 |   );
```

apps/dashboard/src/actions/mfa-verify-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidatePath } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { mfaVerifySchema } from "./schema";
7 |
8 | export const mfaVerifyAction = authActionClient
9 |   .schema(mfaVerifySchema)
10 |   .metadata({
11 |     name: "mfa-verify",
12 |     track: {
13 |       event: LogEvents.MfaVerify.name,
14 |       channel: LogEvents.MfaVerify.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({
19 |       parsedInput: { factorId, challengeId, code },
20 |       ctx: { supabase },
21 |     }) => {
22 |       const { data } = await supabase.auth.mfa.verify({
23 |         factorId,
24 |         challengeId,
25 |         code,
26 |       });
27 |
28 |       revalidatePath("/account/security");
29 |
30 |       return data;
31 |     },
32 |   );
```

apps/dashboard/src/actions/safe-action.ts
```
1 | import { logger } from "@/utils/logger";
2 | import { setupAnalytics } from "@midday/events/server";
3 | import { client as RedisClient } from "@midday/kv";
4 | import { getUser } from "@midday/supabase/cached-queries";
5 | import { createClient } from "@midday/supabase/server";
6 | import * as Sentry from "@sentry/nextjs";
7 | import { Ratelimit } from "@upstash/ratelimit";
8 | import {
9 |   DEFAULT_SERVER_ERROR_MESSAGE,
10 |   createSafeActionClient,
11 | } from "next-safe-action";
12 | import { headers } from "next/headers";
13 | import { z } from "zod";
14 |
15 | const ratelimit = new Ratelimit({
16 |   limiter: Ratelimit.fixedWindow(10, "10s"),
17 |   redis: RedisClient,
18 | });
19 |
20 | export const actionClient = createSafeActionClient({
21 |   handleReturnedServerError(e) {
22 |     if (e instanceof Error) {
23 |       return e.message;
24 |     }
25 |
26 |     return DEFAULT_SERVER_ERROR_MESSAGE;
27 |   },
28 | });
29 |
30 | export const actionClientWithMeta = createSafeActionClient({
31 |   handleReturnedServerError(e) {
32 |     if (e instanceof Error) {
33 |       return e.message;
34 |     }
35 |
36 |     return DEFAULT_SERVER_ERROR_MESSAGE;
37 |   },
38 |   defineMetadataSchema() {
39 |     return z.object({
40 |       name: z.string(),
41 |       track: z
42 |         .object({
43 |           event: z.string(),
44 |           channel: z.string(),
45 |         })
46 |         .optional(),
47 |     });
48 |   },
49 | });
50 |
51 | export const authActionClient = actionClientWithMeta
52 |   .use(async ({ next, clientInput, metadata }) => {
53 |     const result = await next({ ctx: null });
54 |
55 |     if (process.env.NODE_ENV === "development") {
56 |       logger("Input ->", clientInput);
57 |       logger("Result ->", result.data);
58 |       logger("Metadata ->", metadata);
59 |
60 |       return result;
61 |     }
62 |
63 |     return result;
64 |   })
65 |   .use(async ({ next, metadata }) => {
66 |     const ip = headers().get("x-forwarded-for");
67 |
68 |     const { success, remaining } = await ratelimit.limit(
69 |       `${ip}-${metadata.name}`,
70 |     );
71 |
72 |     if (!success) {
73 |       throw new Error("Too many requests");
74 |     }
75 |
76 |     return next({
77 |       ctx: {
78 |         ratelimit: {
79 |           remaining,
80 |         },
81 |       },
82 |     });
83 |   })
84 |   .use(async ({ next, metadata }) => {
85 |     const user = await getUser();
86 |     const supabase = createClient();
87 |
88 |     if (!user?.data) {
89 |       throw new Error("Unauthorized");
90 |     }
91 |
92 |     const analytics = await setupAnalytics({
93 |       userId: user.data.id,
94 |       fullName: user.data.full_name,
95 |     });
96 |
97 |     if (metadata?.track) {
98 |       analytics.track(metadata.track);
99 |     }
100 |
101 |     return Sentry.withServerActionInstrumentation(metadata.name, async () => {
102 |       return next({
103 |         ctx: {
104 |           supabase,
105 |           analytics,
106 |           user: user.data,
107 |         },
108 |       });
109 |     });
110 |   });
```

apps/dashboard/src/actions/schema.ts
```
1 | import { isValid } from "date-fns";
2 | import { z } from "zod";
3 |
4 | export const updateUserSchema = z.object({
5 |   full_name: z.string().min(2).max(32).optional(),
6 |   email: z.string().email().optional(),
7 |   avatar_url: z.string().url().optional(),
8 |   locale: z.string().optional(),
9 |   week_starts_on_monday: z.boolean().optional(),
10 |   timezone: z.string().optional(),
11 |   time_format: z.number().optional(),
12 |   date_format: z.enum(["dd/MM/yyyy", "MM/dd/yyyy", "yyyy-MM-dd"]).optional(),
13 |   revalidatePath: z.string().optional(),
14 | });
15 |
16 | export const createTagSchema = z.object({ name: z.string() });
17 | export const createTransactionTagSchema = z.object({
18 |   tagId: z.string(),
19 |   transactionId: z.string(),
20 | });
21 |
22 | export const deleteTagSchema = z.object({
23 |   id: z.string(),
24 | });
25 |
26 | export const updateTagSchema = z.object({
27 |   id: z.string(),
28 |   name: z.string(),
29 | });
30 |
31 | export const deleteTransactionTagSchema = z.object({
32 |   tagId: z.string(),
33 |   transactionId: z.string(),
34 | });
35 |
36 | export const deleteProjectTagSchema = z.object({
37 |   tagId: z.string(),
38 |   projectId: z.string(),
39 | });
40 |
41 | export const createProjectTagSchema = z.object({
42 |   tagId: z.string(),
43 |   projectId: z.string(),
44 | });
45 |
46 | export type UpdateUserFormValues = z.infer<typeof updateUserSchema>;
47 |
48 | export const trackingConsentSchema = z.boolean();
49 |
50 | export const sendSupportSchema = z.object({
51 |   subject: z.string(),
52 |   priority: z.string(),
53 |   type: z.string(),
54 |   message: z.string(),
55 |   url: z.string().optional(),
56 | });
57 |
58 | export const updateTeamSchema = z.object({
59 |   name: z.string().min(2).max(32).optional(),
60 |   email: z.string().email().optional(),
61 |   inbox_email: z.string().email().optional().nullable(),
62 |   inbox_forwarding: z.boolean().optional().nullable(),
63 |   logo_url: z.string().url().optional(),
64 |   base_currency: z.string().optional(),
65 |   document_classification: z.boolean().optional(),
66 |   revalidatePath: z.string().optional(),
67 | });
68 |
69 | export type UpdateTeamFormValues = z.infer<typeof updateTeamSchema>;
70 |
71 | export const subscribeSchema = z.object({
72 |   email: z.string().email(),
73 | });
74 |
75 | export const deleteBankAccountSchema = z.object({
76 |   id: z.string().uuid(),
77 | });
78 |
79 | export const updateBankAccountSchema = z.object({
80 |   id: z.string().uuid(),
81 |   name: z.string().optional(),
82 |   enabled: z.boolean().optional(),
83 |   balance: z.number().optional(),
84 |   type: z
85 |     .enum(["depository", "credit", "other_asset", "loan", "other_liability"])
86 |     .optional()
87 |     .nullable(),
88 | });
89 |
90 | export type DeleteBankAccountFormValues = z.infer<
91 |   typeof deleteBankAccountSchema
92 | >;
93 |
94 | export const updateSubscriberPreferenceSchema = z.object({
95 |   templateId: z.string(),
96 |   teamId: z.string(),
97 |   revalidatePath: z.string(),
98 |   subscriberId: z.string(),
99 |   type: z.string(),
100 |   enabled: z.boolean(),
101 | });
102 |
103 | export const changeSpendingPeriodSchema = z.object({
104 |   id: z.string(),
105 |   from: z.string().datetime(),
106 |   to: z.string().datetime(),
107 | });
108 |
109 | export const changeChartTypeSchema = z.enum([
110 |   "profit",
111 |   "revenue",
112 |   "expense",
113 |   "burn_rate",
114 | ]);
115 |
116 | export const changeChartPeriodSchema = z.object({
117 |   from: z.string().optional(),
118 |   to: z.string().optional(),
119 | });
120 |
121 | export const changeTransactionsPeriodSchema = z.enum([
122 |   "all",
123 |   "income",
124 |   "expense",
125 | ]);
126 |
127 | export const createAttachmentsSchema = z.array(
128 |   z.object({
129 |     path: z.array(z.string()),
130 |     name: z.string(),
131 |     size: z.number(),
132 |     transaction_id: z.string(),
133 |     type: z.string(),
134 |   }),
135 | );
136 |
137 | export const deleteAttachmentSchema = z.string();
138 |
139 | export const exportTransactionsSchema = z.array(z.string());
140 |
141 | export const deleteFileSchema = z.object({
142 |   id: z.string(),
143 |   path: z.array(z.string()),
144 | });
145 |
146 | export const deleteFolderSchema = z.object({
147 |   path: z.array(z.string()),
148 | });
149 |
150 | export const createFolderSchema = z.object({
151 |   path: z.string(),
152 |   name: z.string(),
153 | });
154 |
155 | export const unenrollMfaSchema = z.object({
156 |   factorId: z.string(),
157 | });
158 |
159 | export const mfaVerifySchema = z.object({
160 |   factorId: z.string(),
161 |   challengeId: z.string(),
162 |   code: z.string(),
163 | });
164 |
165 | export const shareFileSchema = z.object({
[TRUNCATED]
```

apps/dashboard/src/actions/search-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "./safe-action";
4 | import { searchSchema } from "./schema";
5 |
6 | export const searchAction = authActionClient
7 |   .schema(searchSchema)
8 |   .metadata({
9 |     name: "search",
10 |   })
11 |   .action(async ({ parsedInput: params, ctx: { supabase } }) => {
12 |     const { query, limit = 10 } = params;
13 |
14 |     const { data: documents } = await supabase
15 |       .from("inbox")
16 |       .select("*")
17 |       .textSearch("fts", `'${query}':*`)
18 |       .limit(limit);
19 |
20 |     return documents;
21 |   });
```

apps/dashboard/src/actions/send-feedback-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { PlainClient } from "@team-plain/typescript-sdk";
5 | import { authActionClient } from "./safe-action";
6 | import { sendFeedbackSchema } from "./schema";
7 |
8 | const client = new PlainClient({
9 |   apiKey: process.env.PLAIN_API_KEY!,
10 | });
11 |
12 | export const sendFeebackAction = authActionClient
13 |   .schema(sendFeedbackSchema)
14 |   .metadata({
15 |     name: "send-feedback",
16 |     track: {
17 |       event: LogEvents.SendFeedback.name,
18 |       channel: LogEvents.SendFeedback.channel,
19 |     },
20 |   })
21 |   .action(async ({ parsedInput: { feedback }, ctx: { user } }) => {
22 |     const customer = await client.upsertCustomer({
23 |       identifier: {
24 |         emailAddress: user.email,
25 |       },
26 |       onCreate: {
27 |         fullName: user.full_name,
28 |         externalId: user.id,
29 |         email: {
30 |           email: user.email,
31 |           isVerified: true,
32 |         },
33 |       },
34 |       onUpdate: {},
35 |     });
36 |
37 |     const response = await client.createThread({
38 |       title: "Feedback",
39 |       customerIdentifier: {
40 |         customerId: customer.data?.customer.id,
41 |       },
42 |       // Feedback
43 |       labelTypeIds: ["lt_01HV93GFTZAKESXMVY8X371ADG"],
44 |       components: [
45 |         {
46 |           componentText: {
47 |             text: feedback,
48 |           },
49 |         },
50 |       ],
51 |     });
52 |
53 |     return response;
54 |   });
```

apps/dashboard/src/actions/send-support-action.tsx
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { PlainClient, ThreadFieldSchemaType } from "@team-plain/typescript-sdk";
5 | import { authActionClient } from "./safe-action";
6 | import { sendSupportSchema } from "./schema";
7 |
8 | const client = new PlainClient({
9 |   apiKey: process.env.PLAIN_API_KEY!,
10 | });
11 |
12 | const mapToPriorityNumber = (priority: string) => {
13 |   switch (priority) {
14 |     case "low":
15 |       return 0;
16 |     case "normal":
17 |       return 1;
18 |     case "high":
19 |       return 2;
20 |     case "urgent":
21 |       return 3;
22 |     default:
23 |       return 1;
24 |   }
25 | };
26 |
27 | export const sendSupportAction = authActionClient
28 |   .schema(sendSupportSchema)
29 |   .metadata({
30 |     name: "send-support",
31 |     track: {
32 |       event: LogEvents.SupportTicket.name,
33 |       channel: LogEvents.SupportTicket.channel,
34 |     },
35 |   })
36 |   .action(async ({ parsedInput: data, ctx: { user } }) => {
37 |     const customer = await client.upsertCustomer({
38 |       identifier: {
39 |         emailAddress: user.email,
40 |       },
41 |       onCreate: {
42 |         fullName: user.full_name,
43 |         externalId: user.id,
44 |         email: {
45 |           email: user.email,
46 |           isVerified: true,
47 |         },
48 |       },
49 |       onUpdate: {},
50 |     });
51 |
52 |     const response = await client.createThread({
53 |       title: data.subject,
54 |       description: data.message,
55 |       priority: mapToPriorityNumber(data.priority),
56 |       customerIdentifier: {
57 |         customerId: customer.data?.customer.id,
58 |       },
59 |       // Support
60 |       labelTypeIds: ["lt_01HV93FQT6NSC1EN2HHA6BG9WK"],
61 |       components: [
62 |         {
63 |           componentText: {
64 |             text: data.message,
65 |           },
66 |         },
67 |       ],
68 |       threadFields: data.url
69 |         ? [
70 |             {
71 |               type: ThreadFieldSchemaType.String,
72 |               key: "url",
73 |               stringValue: data.url,
74 |             },
75 |           ]
76 |         : undefined,
77 |     });
78 |
79 |     return response;
80 |   });
```

apps/dashboard/src/actions/share-file-action.ts
```
1 | "use server";
2 |
3 | import { dub } from "@/utils/dub";
4 | import { LogEvents } from "@midday/events/events";
5 | import { share } from "@midday/supabase/storage";
6 | import { authActionClient } from "./safe-action";
7 | import { shareFileSchema } from "./schema";
8 |
9 | export const shareFileAction = authActionClient
10 |   .schema(shareFileSchema)
11 |   .metadata({
12 |     name: "share-file",
13 |     track: {
14 |       event: LogEvents.ShareFile.name,
15 |       channel: LogEvents.ShareFile.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: value, ctx: { supabase, user } }) => {
19 |     const response = await share(supabase, {
20 |       bucket: "vault",
21 |       path: `${user.team_id}/${value.filepath}`,
22 |       expireIn: value.expireIn,
23 |       options: {
24 |         download: true,
25 |       },
26 |     });
27 |
28 |     if (!response.data) {
29 |       return null;
30 |     }
31 |
32 |     const link = await dub.links.create({
33 |       url: response?.data?.signedUrl,
34 |     });
35 |
36 |     return link?.shortLink;
37 |   });
```

apps/dashboard/src/actions/sign-out-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { setupAnalytics } from "@midday/events/server";
5 | import { getSession } from "@midday/supabase/cached-queries";
6 | import { createClient } from "@midday/supabase/server";
7 | import { revalidateTag } from "next/cache";
8 | import { redirect } from "next/navigation";
9 |
10 | export async function signOutAction() {
11 |   const supabase = createClient();
12 |   const {
13 |     data: { session },
14 |   } = await getSession();
15 |
16 |   await supabase.auth.signOut({
17 |     scope: "local",
18 |   });
19 |
20 |   const analytics = await setupAnalytics({
21 |     userId: session?.user?.id,
22 |     fullName: session?.user?.user_metadata?.full_name,
23 |   });
24 |
25 |   analytics.track({
26 |     event: LogEvents.SignOut.name,
27 |     channel: LogEvents.SignOut.channel,
28 |   });
29 |
30 |   revalidateTag(`user_${session?.user?.id}`);
31 |
32 |   return redirect("/login");
33 | }
```

apps/dashboard/src/actions/subscribe-action.ts
```
1 | "use server";
2 |
3 | import { resend } from "@/utils/resend";
4 | import { authActionClient } from "./safe-action";
5 | import { subscribeSchema } from "./schema";
6 |
7 | export const subscribeAction = authActionClient
8 |   .schema(subscribeSchema)
9 |   .metadata({
10 |     name: "subscribe",
11 |   })
12 |   .action(async ({ parsedInput: { email } }) => {
13 |     return resend.contacts.create({
14 |       email,
15 |       audienceId: process.env.RESEND_AUDIENCE_ID!,
16 |     });
17 |   });
```

apps/dashboard/src/actions/tracking-consent-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { cookies } from "next/headers";
6 | import { actionClient } from "./safe-action";
7 | import { trackingConsentSchema } from "./schema";
8 |
9 | export const trackingConsentAction = actionClient
10 |   .schema(trackingConsentSchema)
11 |   .action(async ({ parsedInput: value }) => {
12 |     cookies().set({
13 |       name: Cookies.TrackingConsent,
14 |       value: value ? "1" : "0",
15 |       expires: addYears(new Date(), 1),
16 |     });
17 |
18 |     return value;
19 |   });
```

apps/dashboard/src/actions/unenroll-mfa-action.ts
```
1 | "use server";
2 |
3 | import { revalidatePath } from "next/cache";
4 | import { authActionClient } from "./safe-action";
5 | import { unenrollMfaSchema } from "./schema";
6 |
7 | export const unenrollMfaAction = authActionClient
8 |   .schema(unenrollMfaSchema)
9 |   .metadata({
10 |     name: "unenroll-mfa",
11 |   })
12 |   .action(async ({ parsedInput: { factorId }, ctx: { supabase } }) => {
13 |     const { data, error } = await supabase.auth.mfa.unenroll({
14 |       factorId,
15 |       issuer: "app.midday.ai",
16 |     });
17 |
18 |     if (error) {
19 |       throw Error(error.message);
20 |     }
21 |
22 |     revalidatePath("/account/security");
23 |
24 |     return data;
25 |   });
```

apps/dashboard/src/actions/update-app-settings-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidatePath } from "next/cache";
5 | import { z } from "zod";
6 | import { authActionClient } from "./safe-action";
7 |
8 | export const updateAppSettingsAction = authActionClient
9 |   .schema(
10 |     z.object({
11 |       app_id: z.string(),
12 |       option: z.object({
13 |         id: z.string(),
14 |         value: z.unknown(),
15 |       }),
16 |     }),
17 |   )
18 |   .metadata({
19 |     name: "update-app-settings",
20 |     track: {
21 |       event: LogEvents.UpdateAppSettings.name,
22 |       channel: LogEvents.UpdateAppSettings.channel,
23 |     },
24 |   })
25 |   .action(
26 |     async ({ parsedInput: { app_id, option }, ctx: { user, supabase } }) => {
27 |       const { data: existingApp } = await supabase
28 |         .from("apps")
29 |         .select("settings")
30 |         .eq("app_id", app_id)
31 |         .eq("team_id", user.team_id)
32 |         .single();
33 |
34 |       if (!existingApp) {
35 |         throw new Error("App not found");
36 |       }
37 |
38 |       const updatedSettings = existingApp?.settings.map((setting) => {
39 |         if (setting.id === option.id) {
40 |           return { ...setting, value: option.value };
41 |         }
42 |         return setting;
43 |       });
44 |
45 |       const { data, error } = await supabase
46 |         .from("apps")
47 |         .update({ settings: updatedSettings })
48 |         .eq("app_id", app_id)
49 |         .eq("team_id", user.team_id)
50 |         .select()
51 |         .single();
52 |
53 |       if (!data) {
54 |         throw new Error("Failed to update app settings");
55 |       }
56 |
57 |       revalidatePath("/apps");
58 |
59 |       return data;
60 |     },
61 |   );
```

apps/dashboard/src/actions/update-bank-account-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { updateBankAccount } from "@midday/supabase/mutations";
5 | import { revalidateTag } from "next/cache";
6 | import { authActionClient } from "./safe-action";
7 | import { updateBankAccountSchema } from "./schema";
8 |
9 | export const updateBankAccountAction = authActionClient
10 |   .schema(updateBankAccountSchema)
11 |   .metadata({
12 |     name: "update-bank-account",
13 |     track: {
14 |       event: LogEvents.UpdateBank.name,
15 |       channel: LogEvents.UpdateBank.channel,
16 |     },
17 |   })
18 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
19 |     const { data } = await updateBankAccount(supabase, {
20 |       teamId: user.team_id,
21 |       ...params,
22 |     });
23 |
24 |     revalidateTag(`bank_accounts_${user.team_id}`);
25 |     revalidateTag(`bank_accounts_currencies_${user.team_id}`);
26 |     revalidateTag(`bank_connections_${user.team_id}`);
27 |     revalidateTag(`transactions_${user.team_id}`);
28 |
29 |     return data;
30 |   });
```

apps/dashboard/src/actions/update-category-action.ts
```
1 | "use server";
2 |
3 | import { revalidateTag } from "next/cache";
4 | import { authActionClient } from "./safe-action";
5 | import { updateCategorySchema } from "./schema";
6 |
7 | export const updateCategoryAction = authActionClient
8 |   .schema(updateCategorySchema)
9 |   .metadata({
10 |     name: "update-category",
11 |   })
12 |   .action(
13 |     async ({
14 |       parsedInput: { id, name, color, description, vat },
15 |       ctx: { user, supabase },
16 |     }) => {
17 |       await supabase
18 |         .from("transaction_categories")
19 |         .update({ name, color, description, vat })
20 |         .eq("id", id);
21 |
22 |       revalidateTag(`transaction_categories_${user.team_id}`);
23 |       revalidateTag(`transactions_${user.team_id}`);
24 |       revalidateTag(`spending_${user.team_id}`);
25 |     },
26 |   );
```

apps/dashboard/src/actions/update-column-visibility-action.ts
```
1 | "use server";
2 |
3 | import type { VisibilityState } from "@tanstack/react-table";
4 | import { addYears } from "date-fns";
5 | import { cookies } from "next/headers";
6 |
7 | type Props = {
8 |   key: string;
9 |   data: VisibilityState;
10 | };
11 |
12 | export async function updateColumnVisibilityAction({ key, data }: Props) {
13 |   cookies().set(key, JSON.stringify(data), {
14 |     expires: addYears(new Date(), 1),
15 |   });
16 |
17 |   return Promise.resolve(data);
18 | }
```

apps/dashboard/src/actions/update-document-action.ts
```
1 | "use server";
2 |
3 | import { revalidatePath } from "next/cache";
4 | import { z } from "zod";
5 | import { authActionClient } from "./safe-action";
6 |
7 | export const updateDocumentAction = authActionClient
8 |   .schema(
9 |     z.object({
10 |       id: z.string().uuid(),
11 |       tag: z.string().optional(),
12 |     }),
13 |   )
14 |   .metadata({
15 |     name: "update-document",
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { id, ...payload }, ctx: { user, supabase } }) => {
19 |       const { data } = await supabase
20 |         .from("documents")
21 |         .update(payload)
22 |         .eq("id", id)
23 |         .select()
24 |         .single();
25 |
26 |       revalidatePath("/vault");
27 |
28 |       return data;
29 |     },
30 |   );
```

apps/dashboard/src/actions/update-menu-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { addYears } from "date-fns";
5 | import { cookies } from "next/headers";
6 | import { authActionClient } from "./safe-action";
7 | import { updaterMenuSchema } from "./schema";
8 |
9 | export const updateMenuAction = authActionClient
10 |   .schema(updaterMenuSchema)
11 |   .metadata({
12 |     name: "update-menu",
13 |   })
14 |   .action(async ({ parsedInput: value }) => {
15 |     cookies().set({
16 |       name: Cookies.MenuConfig,
17 |       value: JSON.stringify(value),
18 |       expires: addYears(new Date(), 1),
19 |     });
20 |
21 |     return value;
22 |   });
```

apps/dashboard/src/actions/update-similar-transactions-action.ts
```
1 | "use server";
2 |
3 | import { updateSimilarTransactionsCategory } from "@midday/supabase/mutations";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { updateSimilarTransactionsCategorySchema } from "./schema";
7 |
8 | export const updateSimilarTransactionsCategoryAction = authActionClient
9 |   .schema(updateSimilarTransactionsCategorySchema)
10 |   .metadata({
11 |     name: "update-similar-transactions-category",
12 |   })
13 |   .action(async ({ parsedInput: { id }, ctx: { user, supabase } }) => {
14 |     await updateSimilarTransactionsCategory(supabase, {
15 |       team_id: user.team_id,
16 |       id,
17 |     });
18 |
19 |     revalidateTag(`transactions_${user.team_id}`);
20 |     revalidateTag(`spending_${user.team_id}`);
21 |     revalidateTag(`metrics_${user.team_id}`);
22 |     revalidateTag(`current_burn_rate_${user.team_id}`);
23 |     revalidateTag(`burn_rate_${user.team_id}`);
24 |     revalidateTag(`expenses_${user.team_id}`);
25 |   });
```

apps/dashboard/src/actions/update-similar-transactions-recurring.ts
```
1 | "use server";
2 |
3 | import { updateSimilarTransactionsRecurring } from "@midday/supabase/mutations";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { updateSimilarTransactionsRecurringSchema } from "./schema";
7 |
8 | export const updateSimilarTransactionsRecurringAction = authActionClient
9 |   .schema(updateSimilarTransactionsRecurringSchema)
10 |   .metadata({
11 |     name: "update-similar-transactions-recurring",
12 |   })
13 |   .action(async ({ parsedInput: { id }, ctx: { user, supabase } }) => {
14 |     await updateSimilarTransactionsRecurring(supabase, {
15 |       team_id: user.team_id,
16 |       id,
17 |     });
18 |
19 |     revalidateTag(`transactions_${user.team_id}`);
20 |     revalidateTag(`spending_${user.team_id}`);
21 |     revalidateTag(`metrics_${user.team_id}`);
22 |     revalidateTag(`current_burn_rate_${user.team_id}`);
23 |     revalidateTag(`burn_rate_${user.team_id}`);
24 |     revalidateTag(`expenses_${user.team_id}`);
25 |   });
```

apps/dashboard/src/actions/update-subscriber-preference-action.ts
```
1 | "use server";
2 |
3 | import { updateSubscriberPreference } from "@midday/notification";
4 | import { revalidatePath as revalidatePathFunc } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { updateSubscriberPreferenceSchema } from "./schema";
7 |
8 | export const updateSubscriberPreferenceAction = authActionClient
9 |   .schema(updateSubscriberPreferenceSchema)
10 |   .metadata({
11 |     name: "update-subscriber-preference",
12 |   })
13 |   .action(async ({ parsedInput: { revalidatePath, ...data } }) => {
14 |     const preference = await updateSubscriberPreference(data);
15 |
16 |     revalidatePathFunc(revalidatePath);
17 |
18 |     return preference;
19 |   });
```

apps/dashboard/src/actions/update-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { updateTagSchema } from "./schema";
7 |
8 | export const updateTagAction = authActionClient
9 |   .schema(updateTagSchema)
10 |   .metadata({
11 |     name: "update-tag",
12 |     track: {
13 |       event: LogEvents.UpdateTag.name,
14 |       channel: LogEvents.UpdateTag.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: { name, id }, ctx: { supabase, user } }) => {
18 |     const { data } = await supabase
19 |       .from("tags")
20 |       .update({
21 |         name,
22 |       })
23 |       .eq("id", id)
24 |       .select("id, name")
25 |       .single();
26 |
27 |     revalidateTag(`tracker_projects_${user.team_id}`);
28 |
29 |     // TODO: Fix transaction sheet rerendering
30 |     // revalidateTag(`transactions_${user.team_id}`);
31 |
32 |     return data;
33 |   });
```

apps/dashboard/src/actions/update-team-action.ts
```
1 | "use server";
2 |
3 | import { updateTeam } from "@midday/supabase/mutations";
4 | import {
5 |   revalidatePath as revalidatePathFunc,
6 |   revalidateTag,
7 | } from "next/cache";
8 | import { authActionClient } from "./safe-action";
9 | import { updateTeamSchema } from "./schema";
10 |
11 | export const updateTeamAction = authActionClient
12 |   .schema(updateTeamSchema)
13 |   .metadata({
14 |     name: "update-team",
15 |   })
16 |   .action(
17 |     async ({
18 |       parsedInput: { revalidatePath, ...data },
19 |       ctx: { user, supabase },
20 |     }) => {
21 |       const team = await updateTeam(supabase, data);
22 |
23 |       if (revalidatePath) {
24 |         revalidatePathFunc(revalidatePath);
25 |       }
26 |
27 |       revalidateTag(`user_${user.id}`);
28 |
29 |       return team;
30 |     },
31 |   );
```

apps/dashboard/src/actions/update-transaction-action.ts
```
1 | "use server";
2 |
3 | import { updateTransaction } from "@midday/supabase/mutations";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "./safe-action";
6 | import { updateTransactionSchema } from "./schema";
7 |
8 | export const updateTransactionAction = authActionClient
9 |   .schema(updateTransactionSchema)
10 |   .metadata({
11 |     name: "update-transaction",
12 |   })
13 |   .action(
14 |     async ({ parsedInput: { id, ...payload }, ctx: { user, supabase } }) => {
15 |       const { data } = await updateTransaction(supabase, id, payload);
16 |
17 |       revalidateTag(`transactions_${user.team_id}`);
18 |       revalidateTag(`spending_${user.team_id}`);
19 |       revalidateTag(`metrics_${user.team_id}`);
20 |       revalidateTag(`current_burn_rate_${user.team_id}`);
21 |       revalidateTag(`burn_rate_${user.team_id}`);
22 |       revalidateTag(`expenses_${user.team_id}`);
23 |
24 |       return data;
25 |     },
26 |   );
```

apps/dashboard/src/actions/update-user-action.ts
```
1 | "use server";
2 |
3 | import { updateUser } from "@midday/supabase/mutations";
4 | import {
5 |   revalidatePath as nextRevalidatePath,
6 |   revalidateTag,
7 | } from "next/cache";
8 | import { authActionClient } from "./safe-action";
9 | import { updateUserSchema } from "./schema";
10 |
11 | export const updateUserAction = authActionClient
12 |   .schema(updateUserSchema)
13 |   .metadata({
14 |     name: "update-user",
15 |   })
16 |   .action(
17 |     async ({
18 |       parsedInput: { revalidatePath, ...data },
19 |       ctx: { user, supabase },
20 |     }) => {
21 |       await updateUser(supabase, data);
22 |
23 |       if (data.full_name) {
24 |         await supabase.auth.updateUser({
25 |           data: { full_name: data.full_name },
26 |         });
27 |       }
28 |
29 |       if (data.email) {
30 |         await supabase.auth.updateUser({
31 |           data: { email: data.email },
32 |         });
33 |       }
34 |
35 |       revalidateTag(`user_${user.id}`);
36 |
37 |       if (revalidatePath) {
38 |         nextRevalidatePath(revalidatePath);
39 |       }
40 |
41 |       return user;
42 |     },
43 |   );
```

apps/dashboard/src/actions/validate-vat-number-action.ts
```
1 | "use server";
2 |
3 | import { z } from "zod";
4 | import { authActionClient } from "./safe-action";
5 |
6 | const ENDPOINT = "https://api.vatcheckapi.com/v2/check";
7 |
8 | export const validateVatNumberAction = authActionClient
9 |   .schema(
10 |     z.object({
11 |       vat_number: z.string().min(7),
12 |       country_code: z.string(),
13 |     }),
14 |   )
15 |   .metadata({
16 |     name: "validate-vat-number",
17 |   })
18 |   .action(async ({ parsedInput: { vat_number, country_code } }) => {
19 |     const response = await fetch(
20 |       `${ENDPOINT}?vat_number=${vat_number}&country_code=${country_code}&apikey=${process.env.VATCHECKAPI_API_KEY}`,
21 |       {
22 |         method: "GET",
23 |       },
24 |     );
25 |
26 |     const data = await response.json();
27 |
28 |     return data;
29 |   });
```

apps/dashboard/src/actions/verify-otp-action.ts
```
1 | "use server";
2 |
3 | import { Cookies } from "@/utils/constants";
4 | import { createClient } from "@midday/supabase/server";
5 | import { addYears } from "date-fns";
6 | import { cookies } from "next/headers";
7 | import { redirect } from "next/navigation";
8 | import { actionClient } from "./safe-action";
9 | import { verifyOtpSchema } from "./schema";
10 |
11 | export const verifyOtpAction = actionClient
12 |   .schema(verifyOtpSchema)
13 |
14 |   .action(async ({ parsedInput: { email, token } }) => {
15 |     const supabase = createClient();
16 |
17 |     await supabase.auth.verifyOtp({
18 |       email,
19 |       token,
20 |       type: "email",
21 |     });
22 |
23 |     cookies().set(Cookies.PreferredSignInProvider, "otp", {
24 |       expires: addYears(new Date(), 1),
25 |     });
26 |
27 |     redirect("/");
28 |   });
```

apps/dashboard/src/app/global-error.tsx
```
1 | "use client";
2 |
3 | import * as Sentry from "@sentry/nextjs";
4 | import NextError from "next/error";
5 | import { useEffect } from "react";
6 |
7 | export default function GlobalError({
8 |   error,
9 | }: {
10 |   error: Error & { digest?: string };
11 | }) {
12 |   useEffect(() => {
13 |     Sentry.captureException(error);
14 |   }, [error]);
15 |
16 |   return (
17 |     <html lang="en">
18 |       <body>
19 |         <NextError statusCode={0} />
20 |       </body>
21 |     </html>
22 |   );
23 | }
```

apps/dashboard/src/components/add-account-button.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { useQueryState } from "nuqs";
5 |
6 | export function AddAccountButton({ onClick }: { onClick?: () => void }) {
7 |   const [_, setStep] = useQueryState("step");
8 |
9 |   const handleClick = () => {
10 |     setStep("connect");
11 |     onClick?.();
12 |   };
13 |
14 |   return (
15 |     <Button
16 |       data-event="Add account"
17 |       data-icon="🏦"
18 |       data-channel="bank"
19 |       onClick={handleClick}
20 |     >
21 |       Add account
22 |     </Button>
23 |   );
24 | }
```

apps/dashboard/src/components/add-transactions.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import {
5 |   DropdownMenu,
6 |   DropdownMenuContent,
7 |   DropdownMenuItem,
8 |   DropdownMenuTrigger,
9 | } from "@midday/ui/dropdown-menu";
10 | import { Icons } from "@midday/ui/icons";
11 | import { parseAsBoolean, parseAsString, useQueryStates } from "nuqs";
12 |
13 | export function AddTransactions() {
14 |   const [_, setParams] = useQueryStates({
15 |     step: parseAsString,
16 |     hide: parseAsBoolean,
17 |     "create-transaction": parseAsBoolean,
18 |   });
19 |
20 |   return (
21 |     <DropdownMenu>
22 |       <DropdownMenuTrigger asChild>
23 |         <Button variant="outline" size="icon">
24 |           <Icons.Add size={17} />
25 |         </Button>
26 |       </DropdownMenuTrigger>
27 |       <DropdownMenuContent sideOffset={10} align="end">
28 |         <DropdownMenuItem
29 |           onClick={() => setParams({ step: "connect" })}
30 |           className="space-x-2"
31 |         >
32 |           <Icons.Accounts size={18} />
33 |           <span>Connect account</span>
34 |         </DropdownMenuItem>
35 |         <DropdownMenuItem
36 |           onClick={() => setParams({ step: "import", hide: true })}
37 |           className="space-x-2"
38 |         >
39 |           <Icons.Import size={18} />
40 |           <span>Import/backfill</span>
41 |         </DropdownMenuItem>
42 |         <DropdownMenuItem
43 |           onClick={() => setParams({ "create-transaction": true })}
44 |           className="space-x-2"
45 |         >
46 |           <Icons.CreateTransaction size={18} />
47 |           <span>Create transaction</span>
48 |         </DropdownMenuItem>
49 |       </DropdownMenuContent>
50 |     </DropdownMenu>
51 |   );
52 | }
```

apps/dashboard/src/components/amount-range.tsx
```
1 | "use client";
2 |
3 | import { useSliderWithInput } from "@/hooks/use-slider-with-input";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { createClient } from "@midday/supabase/client";
6 | import { Button } from "@midday/ui/button";
7 | import { Input } from "@midday/ui/input";
8 | import { Label } from "@midday/ui/label";
9 | import { Slider } from "@midday/ui/slider";
10 | import { parseAsArrayOf, parseAsInteger, useQueryState } from "nuqs";
11 | import { useEffect, useState } from "react";
12 |
13 | type Item = {
14 |   id: string;
15 |   amount: number;
16 | };
17 |
18 | export function AmountRange() {
19 |   const [items, setItems] = useState<Item[]>([]);
20 |   const tick_count = 40;
21 |   const supabase = createClient();
22 |   const { team_id } = useUserContext((state) => state.data);
23 |
24 |   const minValue =
25 |     items.length > 0 ? Math.min(...items.map((item) => item.amount)) : 0;
26 |   const maxValue =
27 |     items.length > 0 ? Math.max(...items.map((item) => item.amount)) : 0;
28 |
29 |   const [amountRange, setAmountRange] = useQueryState(
30 |     "amount_range",
31 |     parseAsArrayOf(parseAsInteger),
32 |   );
33 |
34 |   const {
35 |     sliderValue,
36 |     inputValues,
37 |     validateAndUpdateValue,
38 |     handleInputChange,
39 |     handleSliderChange,
40 |     setValues,
41 |   } = useSliderWithInput({
42 |     minValue,
43 |     maxValue,
44 |     initialValue: amountRange || [],
45 |   });
46 |
47 |   const amountStep = (maxValue - minValue) / tick_count;
48 |
49 |   const itemCounts = Array(tick_count)
50 |     .fill(0)
51 |     .map((_, tick) => {
52 |       const rangeMin = minValue + tick * amountStep;
53 |       const rangeMax = minValue + (tick + 1) * amountStep;
54 |       return items.filter(
55 |         (item) => item.amount >= rangeMin && item.amount < rangeMax,
56 |       ).length;
57 |     });
58 |
59 |   const maxCount = Math.max(...itemCounts);
60 |
61 |   const handleSliderValueChange = (values: number[]) => {
62 |     handleSliderChange(values);
63 |   };
64 |
65 |   const countItemsInRange = (min: number, max: number) => {
66 |     return items.filter((item) => item.amount >= min && item.amount <= max)
67 |       .length;
68 |   };
69 |
70 |   const isBarInSelectedRange = (
71 |     index: number,
72 |     minValue: number,
73 |     amountStep: number,
74 |     sliderValue: number[],
75 |   ) => {
76 |     const rangeMin = minValue + index * amountStep;
77 |     const rangeMax = minValue + (index + 1) * amountStep;
78 |     return (
79 |       countItemsInRange(sliderValue[0], sliderValue[1]) > 0 &&
80 |       rangeMin <= sliderValue[1] &&
81 |       rangeMax >= sliderValue[0]
82 |     );
83 |   };
84 |
85 |   useEffect(() => {
86 |     async function fetchItems() {
87 |       const { data } = await supabase
88 |         .rpc("get_transactions_amount_range_data", {
89 |           team_id,
90 |         })
91 |         .select("*");
92 |
93 |       setItems(data);
94 |     }
95 |
96 |     if (!items.length) {
97 |       fetchItems();
98 |     }
99 |   }, []);
100 |
101 |   useEffect(() => {
102 |     setValues([minValue, maxValue]);
103 |   }, [minValue, maxValue]);
104 |
105 |   const totalCount = countItemsInRange(
106 |     sliderValue[0] ?? minValue,
107 |     sliderValue[1] ?? maxValue,
108 |   );
109 |
110 |   return (
111 |     <div className="space-y-4">
112 |       <div>
113 |         <div className="flex h-12 w-full items-end px-3" aria-hidden="true">
114 |           {itemCounts.map((count, i) => (
115 |             <div
116 |               key={`histogram-bar-${i.toString()}`}
117 |               className="flex flex-1 justify-center"
118 |               style={{
119 |                 height: `${(count / maxCount) * 100}%`,
120 |               }}
121 |             >
122 |               <span
123 |                 data-selected={isBarInSelectedRange(
124 |                   i,
125 |                   minValue,
126 |                   amountStep,
127 |                   sliderValue,
128 |                 )}
129 |                 className="h-full w-full bg-primary/20"
130 |               />
131 |             </div>
132 |           ))}
133 |         </div>
134 |         <Slider
135 |           value={sliderValue}
136 |           onValueChange={handleSliderValueChange}
137 |           min={minValue}
138 |           max={maxValue}
139 |           aria-label="Amount range"
140 |         />
141 |       </div>
142 |
143 |       <div className="flex items-center justify-between gap-4">
144 |         <div className="space-y-1">
145 |           <Label htmlFor="min-amount" className="text-xs">
146 |             Min amount
147 |           </Label>
148 |
149 |           <Input
150 |             id="min-amount"
151 |             className="w-full font-mono text-xs"
152 |             type="text"
153 |             inputMode="decimal"
154 |             value={inputValues[0]}
155 |             onChange={(e) => handleInputChange(e, 0)}
156 |             onBlur={() => validateAndUpdateValue(inputValues[0], 0)}
157 |             onKeyDown={(e) => {
158 |               if (e.key === "Enter") {
159 |                 validateAndUpdateValue(inputValues[0], 0);
160 |               }
161 |             }}
162 |             aria-label="Enter minimum amount"
163 |           />
164 |         </div>
165 |         <div className="space-y-1">
[TRUNCATED]
```

apps/dashboard/src/components/animated-number.tsx
```
1 | "use client";
2 |
3 | import { useUserContext } from "@/store/user/hook";
4 | import NumberFlow from "@number-flow/react";
5 |
6 | type Props = {
7 |   value: number;
8 |   currency: string;
9 |   minimumFractionDigits?: number;
10 |   maximumFractionDigits?: number;
11 |   locale?: string;
12 | };
13 |
14 | export function AnimatedNumber({
15 |   value,
16 |   currency,
17 |   minimumFractionDigits,
18 |   maximumFractionDigits,
19 |   locale,
20 | }: Props) {
21 |   const user = useUserContext((state) => state.data);
22 |   const localeToUse = locale || user?.locale;
23 |
24 |   return (
25 |     <NumberFlow
26 |       value={value}
27 |       format={{
28 |         style: "currency",
29 |         currency: currency ?? "USD",
30 |         minimumFractionDigits,
31 |         maximumFractionDigits,
32 |       }}
33 |       willChange
34 |       locales={localeToUse}
35 |     />
36 |   );
37 | }
```

apps/dashboard/src/components/app-settings.tsx
```
1 | import { updateAppSettingsAction } from "@/actions/update-app-settings-action";
2 | import { Label } from "@midday/ui/label";
3 | import { Switch } from "@midday/ui/switch";
4 | import { useAction } from "next-safe-action/hooks";
5 |
6 | type AppSettingsItem = {
7 |   id: string;
8 |   label: string;
9 |   description: string;
10 |   type: "switch" | "text" | "select";
11 |   required: boolean;
12 |   value: string | boolean;
13 | };
14 |
15 | function AppSettingsItem({
16 |   setting,
17 |   appId,
18 | }: {
19 |   setting: AppSettingsItem;
20 |   appId: string;
21 | }) {
22 |   const updateAppSettings = useAction(updateAppSettingsAction);
23 |
24 |   switch (setting.type) {
25 |     case "switch":
26 |       return (
27 |         <div className="flex items-center justify-between">
28 |           <div className="pr-4 space-y-1">
29 |             <Label className="text-[#878787]">{setting.label}</Label>
30 |             <p className="text-xs text-[#878787]">{setting.description}</p>
31 |           </div>
32 |           <Switch
33 |             disabled={updateAppSettings.isPending}
34 |             checked={Boolean(setting.value)}
35 |             onCheckedChange={(checked) => {
36 |               updateAppSettings.execute({
37 |                 app_id: appId,
38 |                 option: {
39 |                   id: setting.id,
40 |                   value: Boolean(checked),
41 |                 },
42 |               });
43 |             }}
44 |           />
45 |         </div>
46 |       );
47 |     default:
48 |       return null;
49 |   }
50 | }
51 |
52 | export function AppSettings({
53 |   settings,
54 |   appId,
55 | }: {
56 |   settings: AppSettingsItem[];
57 |   appId: string;
58 | }) {
59 |   return (
60 |     <div>
61 |       {settings.map((setting) => (
62 |         <div key={setting.id}>
63 |           <AppSettingsItem setting={setting} appId={appId} />
64 |         </div>
65 |       ))}
66 |     </div>
67 |   );
68 | }
```

apps/dashboard/src/components/app.tsx
```
1 | import { disconnectAppAction } from "@/actions/disconnect-app-action";
2 | import {
3 |   Accordion,
4 |   AccordionContent,
5 |   AccordionItem,
6 |   AccordionTrigger,
7 | } from "@midday/ui/accordion";
8 | import { Button } from "@midday/ui/button";
9 | import { Card, CardContent, CardHeader, CardTitle } from "@midday/ui/card";
10 | import { ScrollArea } from "@midday/ui/scroll-area";
11 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
12 | import { useAction } from "next-safe-action/hooks";
13 | import Image from "next/image";
14 | import { parseAsBoolean, parseAsString, useQueryStates } from "nuqs";
15 | import { useState } from "react";
16 | import { AppSettings } from "./app-settings";
17 |
18 | export function App({
19 |   id,
20 |   logo: Logo,
21 |   name,
22 |   short_description,
23 |   description,
24 |   settings,
25 |   onInitialize,
26 |   images,
27 |   active,
28 |   installed,
29 |   category,
30 |   userSettings,
31 | }: {
32 |   id: string;
33 |   logo: React.ComponentType;
34 |   name: string;
35 |   short_description: string;
36 |   description: string;
37 |   settings: Record<string, any>;
38 |   onInitialize: () => void;
39 |   images: string[];
40 |   active?: boolean;
41 |   installed?: boolean;
42 |   category: string;
43 |   userSettings: Record<string, any>;
44 | }) {
45 |   const [params, setParams] = useQueryStates({
46 |     app: parseAsString,
47 |     settings: parseAsBoolean,
48 |   });
49 |
50 |   const [isLoading, setLoading] = useState(false);
51 |   const disconnectApp = useAction(disconnectAppAction);
52 |
53 |   const handleDisconnect = () => {
54 |     disconnectApp.execute({ appId: id });
55 |   };
56 |
57 |   const handleOnInitialize = async () => {
58 |     setLoading(true);
59 |     await onInitialize();
60 |     setLoading(false);
61 |   };
62 |
63 |   return (
64 |     <Card key={id} className="w-full flex flex-col">
65 |       <Sheet open={params.app === id} onOpenChange={() => setParams(null)}>
66 |         <div className="pt-6 px-6 h-16 flex items-center justify-between">
67 |           <Logo />
68 |
69 |           {installed && (
70 |             <div className="text-green-600 bg-green-100 text-[10px] dark:bg-green-900 dark:text-green-300 px-3 py-1 rounded-full font-mono">
71 |               Installed
72 |             </div>
73 |           )}
74 |         </div>
75 |
76 |         <CardHeader className="pb-0">
77 |           <div className="flex items-center space-x-2 pb-4">
78 |             <CardTitle className="text-md font-medium leading-none p-0 m-0">
79 |               {name}
80 |             </CardTitle>
81 |             {!active && (
82 |               <span className="text-[#878787] bg-[#F2F1EF] text-[10px] dark:bg-[#1D1D1D] px-3 py-1 rounded-full font-mono">
83 |                 Coming soon
84 |               </span>
85 |             )}
86 |           </div>
87 |         </CardHeader>
88 |         <CardContent className="text-xs text-[#878787] pb-4">
89 |           {short_description}
90 |         </CardContent>
91 |
92 |         <div className="px-6 pb-6 flex gap-2 mt-auto">
93 |           <Button
94 |             variant="outline"
95 |             className="w-full"
96 |             disabled={!active}
97 |             onClick={() => setParams({ app: id })}
98 |           >
99 |             Details
100 |           </Button>
101 |
102 |           {installed ? (
103 |             <Button
104 |               variant="outline"
105 |               className="w-full"
106 |               onClick={handleDisconnect}
107 |             >
108 |               {disconnectApp.status === "executing"
109 |                 ? "Disconnecting..."
110 |                 : "Disconnect"}
111 |             </Button>
112 |           ) : (
113 |             <Button
114 |               variant="outline"
115 |               className="w-full"
116 |               onClick={handleOnInitialize}
117 |               disabled={!onInitialize || !active || isLoading}
118 |             >
119 |               Install
120 |             </Button>
121 |           )}
122 |         </div>
123 |
124 |         <SheetContent>
125 |           <SheetHeader>
126 |             <div className="mb-4">
127 |               <Image
128 |                 src={images[0]}
129 |                 alt={name}
130 |                 width={465}
131 |                 height={290}
132 |                 quality={100}
133 |               />
134 |             </div>
135 |
136 |             <div className="flex items-center justify-between border-b border-border pb-2">
137 |               <div className="flex items-center space-x-2">
138 |                 <Logo />
139 |                 <div>
140 |                   <div className="flex items-center space-x-2">
141 |                     <h3 className="text-lg leading-none">{name}</h3>
142 |                     {installed && (
143 |                       <div className="bg-green-600 text-[9px] dark:bg-green-300 rounded-full size-1" />
144 |                     )}
145 |                   </div>
146 |
147 |                   <span className="text-xs text-[#878787]">
148 |                     {category} • Published by Midday
149 |                   </span>
150 |                 </div>
151 |               </div>
152 |
153 |               <div>
154 |                 {installed ? (
155 |                   <Button
156 |                     variant="outline"
157 |                     className="w-full"
158 |                     onClick={handleDisconnect}
159 |                   >
160 |                     {disconnectApp.status === "executing"
161 |                       ? "Disconnecting..."
162 |                       : "Disconnect"}
163 |                   </Button>
164 |                 ) : (
165 |                   <Button
[TRUNCATED]
```

apps/dashboard/src/components/apple-sign-in.tsx
```
1 | "use client";
2 |
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
7 | import { Loader2 } from "lucide-react";
8 | import { useState } from "react";
9 |
10 | export function AppleSignIn() {
11 |   const [isLoading, setLoading] = useState(false);
12 |   const supabase = createClient();
13 |
14 |   const handleSignIn = async () => {
15 |     setLoading(true);
16 |
17 |     if (isDesktopApp()) {
18 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
19 |
20 |       redirectTo.searchParams.append("provider", "apple");
21 |       redirectTo.searchParams.append("client", "desktop");
22 |
23 |       await supabase.auth.signInWithOAuth({
24 |         provider: "apple",
25 |         options: {
26 |           redirectTo: redirectTo.toString(),
27 |           queryParams: {
28 |             client: "desktop",
29 |           },
30 |         },
31 |       });
32 |     } else {
33 |       await supabase.auth.signInWithOAuth({
34 |         provider: "apple",
35 |         options: {
36 |           redirectTo: `${window.location.origin}/api/auth/callback?provider=apple`,
37 |         },
38 |       });
39 |     }
40 |   };
41 |
42 |   return (
43 |     <Button
44 |       onClick={handleSignIn}
45 |       className="active:scale-[0.98] bg-primary px-6 py-4 text-secondary font-medium flex space-x-2 h-[40px] w-full"
46 |     >
47 |       {isLoading ? (
48 |         <Loader2 className="h-4 w-4 animate-spin" />
49 |       ) : (
50 |         <>
51 |           <Icons.Apple />
52 |           <span>Continue with Apple</span>
53 |         </>
54 |       )}
55 |     </Button>
56 |   );
57 | }
```

apps/dashboard/src/components/apps-header.tsx
```
1 | import { AppsTabs } from "./apps-tabs";
2 | import { SearchField } from "./search-field";
3 |
4 | export function AppsHeader() {
5 |   return (
6 |     <div className="flex space-x-4">
7 |       <AppsTabs />
8 |       <SearchField placeholder="Search apps" shallow />
9 |     </div>
10 |   );
11 | }
```

apps/dashboard/src/components/apps-tabs.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { useQueryState } from "nuqs";
5 |
6 | const tabs = [
7 |   {
8 |     name: "All",
9 |     value: "all",
10 |   },
11 |   {
12 |     name: "Installed",
13 |     value: "installed",
14 |   },
15 | ];
16 |
17 | export function AppsTabs() {
18 |   const [currentTab, setTab] = useQueryState("tab", {
19 |     shallow: false,
20 |     defaultValue: "all",
21 |   });
22 |
23 |   return (
24 |     <div className="flex">
25 |       {tabs.map((tab) => (
26 |         <button
27 |           onClick={() => setTab(tab.value)}
28 |           key={tab.value}
29 |           type="button"
30 |           className={cn(
31 |             "text-sm transition-colors px-4",
32 |             "dark:bg-[#1D1D1D] dark:text-[#878787]",
33 |             "bg-white text-gray-600",
34 |             currentTab === tab.value &&
35 |               "text-primary dark:bg-[#2C2C2C] bg-gray-100",
36 |           )}
37 |         >
38 |           {tab.name}
39 |         </button>
40 |       ))}
41 |     </div>
42 |   );
43 | }
```

apps/dashboard/src/components/apps.server.tsx
```
1 | import { createClient } from "@midday/supabase/server";
2 | import { Apps } from "./apps";
3 |
4 | export async function AppsServer({ user }) {
5 |   const supabase = createClient();
6 |
7 |   const { data } = await supabase
8 |     .from("apps")
9 |     .select("app_id, settings")
10 |     .eq("team_id", user.team_id);
11 |
12 |   return (
13 |     <Apps
14 |       installedApps={data?.map((app) => app.app_id) ?? []}
15 |       user={user}
16 |       settings={data}
17 |     />
18 |   );
19 | }
```

apps/dashboard/src/components/apps.skeleton.tsx
```
1 | import { Card } from "@midday/ui/card";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 |
4 | export function AppsSkeleton() {
5 |   return (
6 |     <div className="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 mx-auto mt-8">
7 |       {Array.from({ length: 8 }).map((_, index) => (
8 |         <Card key={index.toString()} className="w-full flex flex-col">
9 |           <div className="p-6">
10 |             <Skeleton className="h-10 w-10 rounded-full" />
11 |
12 |             <div className="mt-6">
13 |               <Skeleton className="h-5 w-[40%]" />
14 |             </div>
15 |             <div className="space-y-2 py-4 pb-0">
16 |               <Skeleton className="h-4 w-[80%]" />
17 |               <Skeleton className="h-4 w-[70%]" />
18 |               <Skeleton className="h-4 w-[160px]" />
19 |             </div>
20 |             <div className="flex items-center justify-between space-x-2 mt-4">
21 |               <Skeleton className="h-10 w-full" />
22 |               <Skeleton className="h-10 w-full" />
23 |             </div>
24 |           </div>
25 |         </Card>
26 |       ))}
27 |     </div>
28 |   );
29 | }
```

apps/dashboard/src/components/apps.tsx
```
1 | "use client";
2 |
3 | import { apps } from "@midday/app-store";
4 | import { Button } from "@midday/ui/button";
5 | import { useRouter, useSearchParams } from "next/navigation";
6 | import { App } from "./app";
7 |
8 | export type User = {
9 |   id: string;
10 |   team_id: string;
11 | };
12 |
13 | export function Apps({
14 |   user,
15 |   installedApps,
16 |   settings,
17 | }: { user: User; installedApps: string[]; settings: Record<string, any>[] }) {
18 |   const searchParams = useSearchParams();
19 |   const isInstalledPage = searchParams.get("tab") === "installed";
20 |   const search = searchParams.get("q");
21 |   const router = useRouter();
22 |
23 |   const filteredApps = apps
24 |     .filter((app) => !isInstalledPage || installedApps.includes(app.id))
25 |     .filter(
26 |       (app) => !search || app.name.toLowerCase().includes(search.toLowerCase()),
27 |     );
28 |
29 |   return (
30 |     <div className="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 mx-auto mt-8">
31 |       {filteredApps.map((app) => (
32 |         <App
33 |           key={app.id}
34 |           installed={installedApps?.includes(app.id)}
35 |           {...app}
36 |           userSettings={
37 |             settings.find((setting) => setting.app_id === app.id)?.settings ??
38 |             []
39 |           }
40 |           onInitialize={() => app.onInitialize(user)}
41 |         />
42 |       ))}
43 |
44 |       {!search && !filteredApps.length && (
45 |         <div className="col-span-full flex flex-col items-center justify-center h-[calc(100vh-400px)]">
46 |           <h3 className="text-lg font-semibold text-[#1D1D1D] dark:text-[#F2F1EF]">
47 |             No apps installed
48 |           </h3>
49 |           <p className="mt-2 text-sm text-[#878787] text-center max-w-md">
50 |             You haven't installed any apps yet. Go to the 'All Apps' tab to
51 |             browse available apps.
52 |           </p>
53 |         </div>
54 |       )}
55 |
56 |       {search && !filteredApps.length && (
57 |         <div className="col-span-full flex flex-col items-center justify-center h-[calc(100vh-400px)]">
58 |           <h3 className="text-lg font-semibold text-[#1D1D1D] dark:text-[#F2F1EF]">
59 |             No apps found
60 |           </h3>
61 |           <p className="mt-2 text-sm text-[#878787] text-center max-w-md">
62 |             No apps found for your search, let us know if you want to see a
63 |             specific app in the app store.
64 |           </p>
65 |
66 |           <Button
67 |             onClick={() => router.push("/apps")}
68 |             className="mt-4"
69 |             variant="outline"
70 |           >
71 |             Clear search
72 |           </Button>
73 |         </div>
74 |       )}
75 |     </div>
76 |   );
77 | }
```

apps/dashboard/src/components/assign-user.tsx
```
1 | import { useUserContext } from "@/store/user/hook";
2 | import { createClient } from "@midday/supabase/client";
3 | import { getTeamMembersQuery } from "@midday/supabase/queries";
4 | import {
5 |   Select,
6 |   SelectContent,
7 |   SelectItem,
8 |   SelectTrigger,
9 |   SelectValue,
10 | } from "@midday/ui/select";
11 | import { Skeleton } from "@midday/ui/skeleton";
12 | import { useEffect, useState } from "react";
13 | import { AssignedUser } from "./assigned-user";
14 |
15 | type User = {
16 |   id: string;
17 |   avatar_url?: string | null;
18 |   full_name: string | null;
19 | };
20 |
21 | type Props = {
22 |   selectedId?: string;
23 |   isLoading: boolean;
24 |   onSelect: (user?: User) => void;
25 | };
26 |
27 | export function AssignUser({ selectedId, isLoading, onSelect }: Props) {
28 |   const [value, setValue] = useState<string>();
29 |   const supabase = createClient();
30 |   const [users, setUsers] = useState<User[]>([]);
31 |   const { team_id: teamId } = useUserContext((state) => state.data);
32 |
33 |   useEffect(() => {
34 |     setValue(selectedId);
35 |   }, [selectedId]);
36 |
37 |   useEffect(() => {
38 |     async function getUsers() {
39 |       const { data: membersData } = await getTeamMembersQuery(supabase, teamId);
40 |
41 |       setUsers(membersData?.map(({ user }) => user));
42 |     }
43 |
44 |     getUsers();
45 |   }, [supabase]);
46 |
47 |   return (
48 |     <div className="relative">
49 |       {isLoading ? (
50 |         <div className="h-[36px] border">
51 |           <Skeleton className="h-[14px] w-[60%] absolute left-3 top-[39px]" />
52 |         </div>
53 |       ) : (
54 |         <Select
55 |           value={value}
56 |           onValueChange={(id) => onSelect(users.find((user) => user.id === id))}
57 |         >
58 |           <SelectTrigger
59 |             id="assign"
60 |             className="line-clamp-1 truncate"
61 |             onKeyDown={(evt) => evt.preventDefault()}
62 |           >
63 |             <SelectValue placeholder="Select" />
64 |           </SelectTrigger>
65 |
66 |           <SelectContent className="overflow-y-auto max-h-[200px]">
67 |             {users?.map((user) => {
68 |               return (
69 |                 <SelectItem key={user?.id} value={user?.id}>
70 |                   <AssignedUser
71 |                     fullName={user?.full_name}
72 |                     avatarUrl={user?.avatar_url}
73 |                   />
74 |                 </SelectItem>
75 |               );
76 |             })}
77 |           </SelectContent>
78 |         </Select>
79 |       )}
80 |     </div>
81 |   );
82 | }
```

apps/dashboard/src/components/assigned-user.tsx
```
1 | import { Avatar } from "@midday/ui/avatar";
2 | import Image from "next/image";
3 |
4 | type Props = {
5 |   avatarUrl?: string | null;
6 |   fullName?: string | null;
7 | };
8 |
9 | export function AssignedUser({ avatarUrl, fullName }: Props) {
10 |   return (
11 |     <div className="flex space-x-2 items-center">
12 |       {avatarUrl && (
13 |         <Avatar className="h-5 w-5">
14 |           <Image src={avatarUrl} alt={fullName ?? ""} width={20} height={20} />
15 |         </Avatar>
16 |       )}
17 |       <span className="truncate">{fullName?.split(" ").at(0)}</span>
18 |     </div>
19 |   );
20 | }
```

apps/dashboard/src/components/assistant-history.tsx
```
1 | "use client";
2 |
3 | import { assistantSettingsAction } from "@/actions/ai/assistant-settings-action";
4 | import type { AI } from "@/actions/ai/chat";
5 | import { clearHistoryAction } from "@/actions/ai/clear-history-action";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Card,
9 |   CardContent,
10 |   CardDescription,
11 |   CardHeader,
12 |   CardTitle,
13 | } from "@midday/ui/card";
14 | import { Switch } from "@midday/ui/switch";
15 | import { useToast } from "@midday/ui/use-toast";
16 | import { useUIState } from "ai/rsc";
17 | import { useAction, useOptimisticAction } from "next-safe-action/hooks";
18 |
19 | type Props = {
20 |   enabled: boolean;
21 | };
22 |
23 | export function AssistantHistory({ enabled }: Props) {
24 |   const { toast } = useToast();
25 |   const [_, setMessages] = useUIState<typeof AI>();
26 |
27 |   const { execute, status, optimisticState } = useOptimisticAction(
28 |     assistantSettingsAction,
29 |     {
30 |       currentState: enabled,
31 |       updateFn: (_, { enabled }) => Boolean(enabled),
32 |     },
33 |   );
34 |
35 |   const clearHistory = useAction(clearHistoryAction, {
36 |     onSuccess: () => {
37 |       toast({
38 |         duration: 4000,
39 |         title: "History cleared successfully.",
40 |         variant: "success",
41 |       });
42 |     },
43 |   });
44 |
45 |   return (
46 |     <Card>
47 |       <CardHeader>
48 |         <CardTitle>History</CardTitle>
49 |         <CardDescription>
50 |           By default, we save your history for up to 30 days. You can disable
51 |           and clear your history at any time.
52 |         </CardDescription>
53 |       </CardHeader>
54 |
55 |       <CardContent className="space-y-8">
56 |         <div className="flex justify-between items-center border-border border-b-[1px] pb-6">
57 |           <span className="font-medium text-sm">Enabled</span>
58 |           <Switch
59 |             checked={optimisticState}
60 |             disabled={status === "executing"}
61 |             onCheckedChange={(enabled: boolean) => {
62 |               execute({ enabled });
63 |             }}
64 |           />
65 |         </div>
66 |         <div className="flex justify-between items-center mb-4">
67 |           <span className="font-medium text-sm">Clear history</span>
68 |           <Button
69 |             variant="outline"
70 |             onClick={() => {
71 |               clearHistory.execute(undefined);
72 |               setMessages([]);
73 |             }}
74 |             disabled={clearHistory.status === "executing"}
75 |           >
76 |             Clear
77 |           </Button>
78 |         </div>
79 |       </CardContent>
80 |     </Card>
81 |   );
82 | }
```

apps/dashboard/src/components/attachment-item.tsx
```
1 | import { formatSize } from "@/utils/format";
2 | import { Button } from "@midday/ui/button";
3 | import {
4 |   HoverCard,
5 |   HoverCardContent,
6 |   HoverCardTrigger,
7 | } from "@midday/ui/hover-card";
8 | import { Skeleton } from "@midday/ui/skeleton";
9 | import { isSupportedFilePreview } from "@midday/utils";
10 | import { X } from "lucide-react";
11 | import { FilePreview } from "./file-preview";
12 |
13 | type Props = {
14 |   file: any;
15 |   onDelete: () => void;
16 | };
17 |
18 | export function AttachmentItem({ file, onDelete }: Props) {
19 |   const filePreviewSupported = isSupportedFilePreview(file.type);
20 |
21 |   return (
22 |     <div className="flex items-center justify-between">
23 |       <div className="flex space-x-4 items-center">
24 |         <HoverCard openDelay={200}>
25 |           <HoverCardTrigger>
26 |             <div className="border w-[40px] h-[40px] overflow-hidden cursor-pointer">
27 |               {file.isUploading ? (
28 |                 <Skeleton className="w-full h-full" />
29 |               ) : (
30 |                 <FilePreview
31 |                   src={`/api/proxy?filePath=vault/${file?.path?.join("/")}`}
32 |                   name={file.name}
33 |                   type={file.type}
34 |                   preview
35 |                   width={45}
36 |                   height={100}
37 |                   // Wait for the sheet to open before loading the file
38 |                   delay={100}
39 |                 />
40 |               )}
41 |             </div>
42 |           </HoverCardTrigger>
43 |           {filePreviewSupported && (
44 |             <HoverCardContent
45 |               className="w-[273px] h-[358px] p-0 overflow-hidden"
46 |               side="left"
47 |               sideOffset={55}
48 |             >
49 |               <FilePreview
50 |                 src={`/api/proxy?filePath=vault/${file?.path?.join("/")}`}
51 |                 downloadUrl={`/api/download/file?path=${file?.path
52 |                   ?.slice(1)
53 |                   .join("/")}&filename=${file.name}`}
54 |                 name={file.name}
55 |                 type={file.type}
56 |                 width={280}
57 |                 height={365}
58 |               />
59 |             </HoverCardContent>
60 |           )}
61 |         </HoverCard>
62 |
63 |         <div className="flex flex-col space-y-0.5 w-80">
64 |           <span className="truncate">{file.name}</span>
65 |           <span className="text-xs text-[#606060]">
66 |             {file.size && formatSize(file.size)}
67 |           </span>
68 |         </div>
69 |       </div>
70 |
71 |       <Button
72 |         variant="ghost"
73 |         size="icon"
74 |         className="w-auto hover:bg-transparent flex"
75 |         onClick={onDelete}
76 |       >
77 |         <X size={14} />
78 |       </Button>
79 |     </div>
80 |   );
81 | }
```

apps/dashboard/src/components/attachments.tsx
```
1 | "use client";
2 |
3 | import { deleteAttachmentAction } from "@/actions/delete-attachment-action";
4 | import { useUpload } from "@/hooks/use-upload";
5 | import { useUserContext } from "@/store/user/hook";
6 | import { cn } from "@midday/ui/cn";
7 | import { useToast } from "@midday/ui/use-toast";
8 | import { stripSpecialCharacters } from "@midday/utils";
9 | import { useEffect, useState } from "react";
10 | import { useDropzone } from "react-dropzone";
11 | import { AttachmentItem } from "./attachment-item";
12 | import { SelectAttachment } from "./select-attachment";
13 |
14 | type Attachment = {
15 |   id?: string;
16 |   type: string;
17 |   name: string;
18 |   size: number;
19 | };
20 |
21 | type ReturnedAttachment = {
22 |   path: string[];
23 |   name: string;
24 |   size: number;
25 |   type: string;
26 | };
27 |
28 | type Props = {
29 |   prefix: string;
30 |   data?: Attachment[];
31 |   onUpload: (files: ReturnedAttachment[]) => void;
32 | };
33 |
34 | export function Attachments({ prefix, data, onUpload }: Props) {
35 |   const { toast } = useToast();
36 |   const [files, setFiles] = useState<Attachment[]>([]);
37 |   const { uploadFile } = useUpload();
38 |
39 |   const { team_id: teamId } = useUserContext((state) => state.data);
40 |
41 |   const handleOnDelete = async (id: string) => {
42 |     setFiles((files) => files.filter((file) => file?.id !== id));
43 |     await deleteAttachmentAction(id);
44 |   };
45 |
46 |   const onDrop = async (acceptedFiles: Array<Attachment>) => {
47 |     setFiles((prev) => [
48 |       ...prev,
49 |       ...acceptedFiles.map((a) => ({
50 |         name: stripSpecialCharacters(a.name),
51 |         size: a.size,
52 |         type: a.type,
53 |         isUploading: true,
54 |       })),
55 |     ]);
56 |
57 |     const uploadedFiles = await Promise.all(
58 |       acceptedFiles.map(async (acceptedFile) => {
59 |         const filename = stripSpecialCharacters(acceptedFile.name);
60 |
61 |         const { path } = await uploadFile({
62 |           bucket: "vault",
63 |           path: [teamId, "transactions", prefix, filename],
64 |           file: acceptedFile,
65 |         });
66 |
67 |         return {
68 |           path,
69 |           name: filename,
70 |           size: acceptedFile.size,
71 |           type: acceptedFile.type,
72 |         };
73 |       }),
74 |     );
75 |
76 |     onUpload(uploadedFiles);
77 |   };
78 |
79 |   const handleOnSelectFile = (file) => {
80 |     const filename = stripSpecialCharacters(file.name);
81 |
82 |     const item = {
83 |       name: filename,
84 |       size: file.data.size,
85 |       type: file.data.content_type,
86 |       path: file.data.file_path,
87 |     };
88 |
89 |     setFiles((prev) => [item, ...prev]);
90 |     onUpload([item]);
91 |   };
92 |
93 |   useEffect(() => {
94 |     if (data) {
95 |       setFiles(data);
96 |     }
97 |   }, [data]);
98 |
99 |   const { getRootProps, getInputProps, isDragActive } = useDropzone({
100 |     onDrop,
101 |     onDropRejected: ([reject]) => {
102 |       if (reject?.errors.find(({ code }) => code === "file-too-large")) {
103 |         toast({
104 |           duration: 2500,
105 |           variant: "error",
106 |           title: "File size to large.",
107 |         });
108 |       }
109 |
110 |       if (reject?.errors.find(({ code }) => code === "file-invalid-type")) {
111 |         toast({
112 |           duration: 2500,
113 |           variant: "error",
114 |           title: "File type not supported.",
115 |         });
116 |       }
117 |     },
118 |     maxSize: 3000000, // 3MB
119 |     accept: {
120 |       "image/png": [".png"],
121 |       "image/jpeg": [".jpg", ".jpeg"],
122 |       "application/pdf": [".pdf"],
123 |     },
124 |   });
125 |
126 |   return (
127 |     <div>
128 |       <SelectAttachment
129 |         placeholder="Search attachment"
130 |         onSelect={handleOnSelectFile}
131 |       />
132 |       <div
133 |         className={cn(
134 |           "mt-4 w-full h-[120px] border-dotted border-2 border-border text-center flex flex-col justify-center space-y-1 transition-colors text-[#606060]",
135 |           isDragActive && "bg-secondary text-primary",
136 |         )}
137 |         {...getRootProps()}
138 |       >
139 |         <input {...getInputProps()} />
140 |         {isDragActive ? (
141 |           <div>
142 |             <p className="text-xs">Drop your files upload</p>
143 |           </div>
144 |         ) : (
145 |           <div>
146 |             <p className="text-xs">
147 |               Drop your files here, or{" "}
148 |               <span className="underline underline-offset-1">
149 |                 click to browse.
150 |               </span>
151 |             </p>
152 |             <p className="text-xs text-dark-gray">3MB file limit.</p>
153 |           </div>
154 |         )}
155 |       </div>
156 |
157 |       <ul className="mt-4 space-y-4">
158 |         {files.map((file, idx) => (
159 |           <AttachmentItem
160 |             key={`${file.name}-${idx}`}
161 |             id={file.name}
162 |             file={file}
163 |             onDelete={() => handleOnDelete(file?.id)}
164 |           />
165 |         ))}
166 |       </ul>
167 |     </div>
168 |   );
169 | }
```

apps/dashboard/src/components/avatar-upload.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import { useUpload } from "@/hooks/use-upload";
5 | import { Avatar, AvatarFallback, AvatarImage } from "@midday/ui/avatar";
6 | import { Icons } from "@midday/ui/icons";
7 | import { stripSpecialCharacters } from "@midday/utils";
8 | import { Loader2 } from "lucide-react";
9 | import { useAction } from "next-safe-action/hooks";
10 | import { useRef, useState } from "react";
11 | import { forwardRef } from "react";
12 |
13 | type Props = {
14 |   userId: string;
15 |   avatarUrl?: string;
16 |   fullName?: string;
17 |   onUpload?: (url: string) => void;
18 |   size?: number;
19 | };
20 |
21 | export const AvatarUpload = forwardRef<HTMLInputElement, Props>(
22 |   (
23 |     { userId, avatarUrl: initialAvatarUrl, fullName, size = 65, onUpload },
24 |     ref,
25 |   ) => {
26 |     const action = useAction(updateUserAction);
27 |     const [avatar, setAvatar] = useState(initialAvatarUrl);
28 |     const inputRef = useRef<HTMLInputElement>(null);
29 |
30 |     const { isLoading, uploadFile } = useUpload();
31 |
32 |     const handleUpload = async (evt: React.ChangeEvent<HTMLInputElement>) => {
33 |       const { files } = evt.target;
34 |       const selectedFile = files as FileList;
35 |
36 |       const filename = stripSpecialCharacters(selectedFile[0]?.name ?? "");
37 |
38 |       const { url } = await uploadFile({
39 |         bucket: "avatars",
40 |         path: [userId, filename],
41 |         file: selectedFile[0] as File,
42 |       });
43 |
44 |       if (url) {
45 |         action.execute({ avatar_url: url });
46 |         setAvatar(url);
47 |         onUpload?.(url);
48 |       }
49 |     };
50 |
51 |     const fileInputRef = ref || inputRef;
52 |
53 |     return (
54 |       <Avatar
55 |         className="rounded-full flex items-center justify-center bg-accent cursor-pointer border border-border"
56 |         style={{ width: size, height: size }}
57 |         onClick={() => {
58 |           if ("current" in fileInputRef && fileInputRef.current) {
59 |             fileInputRef.current.click();
60 |           }
61 |         }}
62 |       >
63 |         {isLoading ? (
64 |           <Loader2 className="size-4 animate-spin" />
65 |         ) : (
66 |           <>
67 |             <AvatarImage src={avatar} />
68 |             <AvatarFallback>
69 |               <Icons.AccountCircle className="size-5" />
70 |             </AvatarFallback>
71 |           </>
72 |         )}
73 |         <input
74 |           ref={fileInputRef}
75 |           type="file"
76 |           style={{ display: "none" }}
77 |           multiple={false}
78 |           onChange={handleUpload}
79 |         />
80 |       </Avatar>
81 |     );
82 |   },
83 | );
84 |
85 | AvatarUpload.displayName = "AvatarUpload";
```

apps/dashboard/src/components/bank-account-list.tsx
```
1 | import { getTeamBankAccounts } from "@midday/supabase/cached-queries";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { BankConnections } from "./bank-connections";
4 | import { ManualAccounts } from "./manual-accounts";
5 |
6 | export function BankAccountListSkeleton() {
7 |   return (
8 |     <div className="px-6 pb-6 space-y-6 divide-y">
9 |       <div className="flex justify-between items-center">
10 |         <div className="ml-[30px] divide-y">
11 |           <div className="flex justify-between items-center mb-4 pt-4">
12 |             <div className="flex items-center">
13 |               <Skeleton className="flex h-9 w-9 items-center justify-center space-y-0 rounded-full" />
14 |               <div className="ml-4 flex flex-col">
15 |                 <p className="text-sm font-medium leading-none mb-1">
16 |                   <Skeleton className="h-3 w-[200px] rounded-none" />
17 |                 </p>
18 |                 <span className="text-xs font-medium text-[#606060]">
19 |                   <Skeleton className="h-2.5 w-[100px] mt-1 rounded-none" />
20 |                 </span>
21 |               </div>
22 |             </div>
23 |           </div>
24 |           <div className="flex justify-between items-center mb-4 pt-4">
25 |             <div className="flex items-center">
26 |               <Skeleton className="flex h-9 w-9 items-center justify-center space-y-0 rounded-full" />
27 |               <div className="ml-4 flex flex-col">
28 |                 <p className="text-sm font-medium leading-none mb-1">
29 |                   <Skeleton className="h-3 w-[200px] rounded-none" />
30 |                 </p>
31 |                 <span className="text-xs font-medium text-[#606060]">
32 |                   <Skeleton className="h-2.5 w-[100px] mt-1 rounded-none" />
33 |                 </span>
34 |               </div>
35 |             </div>
36 |           </div>
37 |         </div>
38 |       </div>
39 |     </div>
40 |   );
41 | }
42 |
43 | export async function BankAccountList() {
44 |   const { data } = await getTeamBankAccounts();
45 |
46 |   const manualAccounts = data.filter((account) => account.manual);
47 |
48 |   const bankMap = {};
49 |
50 |   for (const item of data) {
51 |     const bankId = item.bank?.id;
52 |
53 |     if (!bankId) {
54 |       continue;
55 |     }
56 |
57 |     if (!bankMap[bankId]) {
58 |       // If the bank is not in the map, add it
59 |       bankMap[bankId] = {
60 |         ...item.bank,
61 |         accounts: [],
62 |       };
63 |     }
64 |
65 |     // Add the account to the bank's accounts array
66 |     bankMap[bankId].accounts.push(item);
67 |   }
68 |
69 |   // Convert the map to an array
70 |   const result = Object.values(bankMap);
71 |
72 |   function sortAccountsByEnabled(accounts) {
73 |     return accounts.sort((a, b) => b.enabled - a.enabled);
74 |   }
75 |
76 |   // Sort the accounts within each bank in the result array
77 |   for (const bank of result) {
78 |     if (Array.isArray(bank.accounts)) {
79 |       bank.accounts = sortAccountsByEnabled(bank.accounts);
80 |     }
81 |   }
82 |
83 |   return (
84 |     <>
85 |       <BankConnections data={result} />
86 |       <ManualAccounts data={manualAccounts} />
87 |     </>
88 |   );
89 | }
```

apps/dashboard/src/components/bank-account.tsx
```
1 | "use client";
2 |
3 | import { deleteBankAccountAction } from "@/actions/delete-bank-account-action";
4 | import { updateBankAccountAction } from "@/actions/update-bank-account-action";
5 | import { useI18n } from "@/locales/client";
6 | import { getInitials } from "@/utils/format";
7 | import {
8 |   AlertDialog,
9 |   AlertDialogAction,
10 |   AlertDialogCancel,
11 |   AlertDialogContent,
12 |   AlertDialogDescription,
13 |   AlertDialogFooter,
14 |   AlertDialogHeader,
15 |   AlertDialogTitle,
16 |   AlertDialogTrigger,
17 | } from "@midday/ui/alert-dialog";
18 | import { Avatar, AvatarFallback } from "@midday/ui/avatar";
19 | import { cn } from "@midday/ui/cn";
20 | import {
21 |   DropdownMenu,
22 |   DropdownMenuContent,
23 |   DropdownMenuItem,
24 |   DropdownMenuSeparator,
25 |   DropdownMenuTrigger,
26 | } from "@midday/ui/dropdown-menu";
27 | import { Icons } from "@midday/ui/icons";
28 | import { Input } from "@midday/ui/input";
29 | import { Label } from "@midday/ui/label";
30 | import { Switch } from "@midday/ui/switch";
31 | import {
32 |   Tooltip,
33 |   TooltipContent,
34 |   TooltipProvider,
35 |   TooltipTrigger,
36 | } from "@midday/ui/tooltip";
37 | import { MoreHorizontal } from "lucide-react";
38 | import { Loader2 } from "lucide-react";
39 | import { useAction } from "next-safe-action/hooks";
40 | import { parseAsBoolean, parseAsString, useQueryStates } from "nuqs";
41 | import { useState } from "react";
42 | import { FormatAmount } from "./format-amount";
43 | import { EditBankAccountModal } from "./modals/edit-bank-account-modal";
44 |
45 | type Props = {
46 |   id: string;
47 |   name: string;
48 |   balance?: number;
49 |   currency: string;
50 |   enabled: boolean;
51 |   manual: boolean;
52 |   type?: string;
53 |   hasError?: boolean;
54 | };
55 |
56 | export function BankAccount({
57 |   id,
58 |   name,
59 |   currency,
60 |   balance,
61 |   enabled,
62 |   manual,
63 |   type,
64 |   hasError,
65 | }: Props) {
66 |   const [value, setValue] = useState("");
67 |   const [_, setParams] = useQueryStates({
68 |     step: parseAsString,
69 |     accountId: parseAsString,
70 |     hide: parseAsBoolean,
71 |     type: parseAsString,
72 |   });
73 |
74 |   const [isOpen, setOpen] = useState(false);
75 |   const t = useI18n();
76 |
77 |   const updateAccount = useAction(updateBankAccountAction);
78 |   const deleteAccount = useAction(deleteBankAccountAction);
79 |
80 |   return (
81 |     <div
82 |       className={cn(
83 |         "flex justify-between items-center mb-4 pt-4",
84 |         !enabled && "opacity-60",
85 |       )}
86 |     >
87 |       <div className="flex items-center space-x-4 w-full mr-8">
88 |         <Avatar className="size-[34px]">
89 |           <AvatarFallback className="text-[11px]">
90 |             {getInitials(name)}
91 |           </AvatarFallback>
92 |         </Avatar>
93 |
94 |         <div className="flex items-center justify-between w-full">
95 |           <div className="flex flex-col">
96 |             <p className="font-medium leading-none mb-1 text-sm">{name}</p>
97 |             {!hasError && (
98 |               <span className="text-xs text-[#878787] font-normal">
99 |                 {type && t(`account_type.${type}`)}
100 |               </span>
101 |             )}
102 |             {hasError && (
103 |               <TooltipProvider delayDuration={70}>
104 |                 <Tooltip>
105 |                   <TooltipTrigger>
106 |                     <div className="flex items-center space-x-1">
107 |                       <Icons.Error size={14} className="text-[#FFD02B]" />
108 |                       <span className="text-xs text-[#FFD02B] font-normal">
109 |                         Connection issue
110 |                       </span>
111 |                     </div>
112 |                   </TooltipTrigger>
113 |                   <TooltipContent
114 |                     className="px-3 py-1.5 text-xs max-w-[400px]"
115 |                     sideOffset={20}
116 |                     side="left"
117 |                   >
118 |                     There is a problem with this account, please reconnect the
119 |                     bank connection.
120 |                   </TooltipContent>
121 |                 </Tooltip>
122 |               </TooltipProvider>
123 |             )}
124 |           </div>
125 |
126 |           {balance && balance > 0 ? (
127 |             <span className="text-[#878787] text-sm">
128 |               <FormatAmount amount={balance} currency={currency} />
129 |             </span>
130 |           ) : null}
131 |         </div>
132 |       </div>
133 |
134 |       <div className="flex items-center space-x-4">
135 |         <AlertDialog>
136 |           <DropdownMenu>
137 |             <DropdownMenuTrigger asChild>
138 |               <MoreHorizontal size={20} />
139 |             </DropdownMenuTrigger>
140 |             <DropdownMenuContent className="w-48">
141 |               <DropdownMenuItem onClick={() => setOpen(true)}>
142 |                 Edit
143 |               </DropdownMenuItem>
144 |               <DropdownMenuSeparator />
145 |               <DropdownMenuItem
146 |                 onClick={() => {
147 |                   setParams({
148 |                     step: "import",
149 |                     accountId: id,
150 |                     type,
151 |                     hide: true,
152 |                   });
153 |                 }}
154 |               >
155 |                 Import
156 |               </DropdownMenuItem>
157 |               <DropdownMenuSeparator />
158 |               <DropdownMenuItem>
159 |                 <AlertDialogTrigger className="w-full text-left">
160 |                   Remove
161 |                 </AlertDialogTrigger>
162 |               </DropdownMenuItem>
163 |             </DropdownMenuContent>
164 |           </DropdownMenu>
165 |
166 |           <AlertDialogContent>
167 |             <AlertDialogHeader>
168 |               <AlertDialogTitle>Delete Account</AlertDialogTitle>
169 |               <AlertDialogDescription>
[TRUNCATED]
```

apps/dashboard/src/components/bank-connect-button.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Loader2 } from "lucide-react";
3 | import { useState } from "react";
4 |
5 | type Props = {
6 |   onClick: () => void;
7 | };
8 |
9 | export function BankConnectButton({ onClick }: Props) {
10 |   const [isLoading, setLoading] = useState(false);
11 |
12 |   const handleOnClick = () => {
13 |     setLoading(true);
14 |     onClick();
15 |
16 |     setTimeout(() => {
17 |       setLoading(false);
18 |     }, 3000);
19 |   };
20 |
21 |   return (
22 |     <Button
23 |       variant="outline"
24 |       data-event="Bank Selected"
25 |       data-icon="🏦"
26 |       data-channel="bank"
27 |       disabled={isLoading}
28 |       onClick={handleOnClick}
29 |     >
30 |       {isLoading ? <Loader2 className="w-4 h-4 animate-spin" /> : "Connect"}
31 |     </Button>
32 |   );
33 | }
```

apps/dashboard/src/components/bank-connections.tsx
```
1 | "use client";
2 |
3 | import { manualSyncTransactionsAction } from "@/actions/transactions/manual-sync-transactions-action";
4 | import { reconnectConnectionAction } from "@/actions/transactions/reconnect-connection-action";
5 | import { useSyncStatus } from "@/hooks/use-sync-status";
6 | import { connectionStatus } from "@/utils/connection-status";
7 | import {
8 |   Accordion,
9 |   AccordionContent,
10 |   AccordionItem,
11 |   AccordionTrigger,
12 | } from "@midday/ui/accordion";
13 | import { Icons } from "@midday/ui/icons";
14 | import {
15 |   Tooltip,
16 |   TooltipContent,
17 |   TooltipProvider,
18 |   TooltipTrigger,
19 | } from "@midday/ui/tooltip";
20 | import { useToast } from "@midday/ui/use-toast";
21 | import { differenceInDays, formatDistanceToNow } from "date-fns";
22 | import { useAction } from "next-safe-action/hooks";
23 | import { useRouter } from "next/navigation";
24 | import { parseAsString, useQueryStates } from "nuqs";
25 | import { useEffect, useState } from "react";
26 | import { BankAccount } from "./bank-account";
27 | import { BankLogo } from "./bank-logo";
28 | import { ReconnectProvider } from "./reconnect-provider";
29 | import { SyncTransactions } from "./sync-transactions";
30 |
31 | interface BankConnectionProps {
32 |   connection: {
33 |     id: string;
34 |     name: string;
35 |     logo_url: string;
36 |     provider: string;
37 |     expires_at?: string;
38 |     enrollment_id: string | null;
39 |     institution_id: string;
40 |     last_accessed?: string;
41 |     access_token: string | null;
42 |     error?: string;
43 |     status: "connected" | "disconnected" | "unknown";
44 |     accounts: Array<{
45 |       id: string;
46 |       name: string;
47 |       enabled: boolean;
48 |       manual: boolean;
49 |       currency: string;
50 |       balance?: number;
51 |       type: string;
52 |       error_retries?: number;
53 |     }>;
54 |   };
55 | }
56 |
57 | function ConnectionState({
58 |   connection,
59 |   isSyncing,
60 | }: { connection: BankConnectionProps["connection"]; isSyncing: boolean }) {
61 |   const { show, expired } = connectionStatus(connection);
62 |
63 |   if (isSyncing) {
64 |     return (
65 |       <div className="text-xs font-normal flex items-center space-x-1">
66 |         <span>Syncing...</span>
67 |       </div>
68 |     );
69 |   }
70 |
71 |   if (connection.status === "disconnected") {
72 |     return (
73 |       <>
74 |         <div className="text-xs font-normal flex items-center space-x-1 text-[#c33839]">
75 |           <Icons.AlertCircle />
76 |           <span>Connection issue</span>
77 |         </div>
78 |
79 |         <TooltipContent
80 |           className="px-3 py-1.5 text-xs max-w-[430px]"
81 |           sideOffset={20}
82 |           side="left"
83 |         >
84 |           Please reconnect to restore the connection to a good state.
85 |         </TooltipContent>
86 |       </>
87 |     );
88 |   }
89 |
90 |   if (show) {
91 |     return (
92 |       <>
93 |         <div className="text-xs font-normal flex items-center space-x-1 text-[#FFD02B]">
94 |           <Icons.AlertCircle />
95 |           <span>Connection expires soon</span>
96 |         </div>
97 |
98 |         {connection.expires_at && (
99 |           <TooltipContent
100 |             className="px-3 py-1.5 text-xs max-w-[430px]"
101 |             sideOffset={20}
102 |             side="left"
103 |           >
104 |             We only have access to your bank for another{" "}
105 |             {differenceInDays(new Date(connection.expires_at), new Date())}{" "}
106 |             days. Please update the connection to keep everything in sync.
107 |           </TooltipContent>
108 |         )}
109 |       </>
110 |     );
111 |   }
112 |
113 |   if (expired) {
114 |     return (
115 |       <div className="text-xs font-normal flex items-center space-x-1 text-[#c33839]">
116 |         <Icons.Error />
117 |         <span>Connection expired</span>
118 |       </div>
119 |     );
120 |   }
121 |
122 |   if (connection.last_accessed) {
123 |     return (
124 |       <div className="text-xs font-normal flex items-center space-x-1">
125 |         <span className="text-xs font-normal">{`Updated ${formatDistanceToNow(
126 |           new Date(connection.last_accessed),
127 |         )} ago`}</span>
128 |       </div>
129 |     );
130 |   }
131 |
132 |   return <div className="text-xs font-normal">Never accessed</div>;
133 | }
134 |
135 | export function BankConnection({ connection }: BankConnectionProps) {
136 |   const [runId, setRunId] = useState<string | undefined>();
137 |   const [accessToken, setAccessToken] = useState<string | undefined>();
138 |   const [isSyncing, setSyncing] = useState(false);
139 |   const { toast, dismiss } = useToast();
140 |   const router = useRouter();
141 |
142 |   const { show } = connectionStatus(connection);
143 |   const { status, setStatus } = useSyncStatus({ runId, accessToken });
144 |
145 |   const [params] = useQueryStates({
146 |     step: parseAsString,
147 |     id: parseAsString,
148 |   });
149 |
150 |   const manualSyncTransactions = useAction(manualSyncTransactionsAction, {
151 |     onExecute: () => setSyncing(true),
152 |     onSuccess: ({ data }) => {
153 |       if (data) {
154 |         setRunId(data.id);
155 |         setAccessToken(data.publicAccessToken);
156 |       }
157 |     },
158 |     onError: () => {
159 |       setSyncing(false);
160 |       setRunId(undefined);
[TRUNCATED]
```

apps/dashboard/src/components/bank-logo.tsx
```
1 | import { Avatar, AvatarImage } from "@midday/ui/avatar";
2 | import Image from "next/image";
3 |
4 | type Props = {
5 |   src: string | null;
6 |   alt: string;
7 |   size?: number;
8 | };
9 |
10 | export function BankLogo({ src, alt, size = 34 }: Props) {
11 |   return (
12 |     <Avatar style={{ width: size, height: size }}>
13 |       {src && (
14 |         <Image
15 |           src={src}
16 |           alt={alt}
17 |           className="text-transparent"
18 |           width={size}
19 |           height={size}
20 |           quality={100}
21 |         />
22 |       )}
23 |       <Image
24 |         src="https://cdn-engine.midday.ai/default.jpg"
25 |         alt={alt}
26 |         className="absolute -z-10"
27 |         width={size}
28 |         height={size}
29 |       />
30 |     </Avatar>
31 |   );
32 | }
```

apps/dashboard/src/components/breadcrumbs.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import {
5 |   Breadcrumb,
6 |   BreadcrumbItem,
7 |   BreadcrumbLink,
8 |   BreadcrumbList,
9 |   BreadcrumbPage,
10 |   BreadcrumbSeparator,
11 | } from "@midday/ui/breadcrumb";
12 | import { cn } from "@midday/ui/cn";
13 | import Link from "next/link";
14 | import { translatedFolderName } from "./tables/vault/data-table-row";
15 |
16 | type Props = {
17 |   folders?: string[];
18 |   hide?: boolean;
19 | };
20 |
21 | export function Breadcrumbs({ folders = [], hide }: Props) {
22 |   const t = useI18n();
23 |
24 |   const allFolders = ["all", ...folders];
25 |
26 |   const links = allFolders?.map((folder, index) => {
27 |     const isLast = folders.length === index;
28 |     const parts = folders.slice(0, index);
29 |     const href =
30 |       folder === "all" ? "/vault" : `/${["vault", ...parts].join("/")}`;
31 |
32 |     if (isLast) {
33 |       return (
34 |         <BreadcrumbItem key={folder}>
35 |           <BreadcrumbPage>{translatedFolderName(t, folder)}</BreadcrumbPage>
36 |         </BreadcrumbItem>
37 |       );
38 |     }
39 |
40 |     return (
41 |       <div key={folder} className="flex items-center gap-2">
42 |         <BreadcrumbItem>
43 |           <BreadcrumbLink asChild>
44 |             <Link href={href}>{translatedFolderName(t, folder)}</Link>
45 |           </BreadcrumbLink>
46 |         </BreadcrumbItem>
47 |         <BreadcrumbSeparator />
48 |       </div>
49 |     );
50 |   });
51 |
52 |   return (
53 |     <Breadcrumb className={cn("animate-fade-in", hide && "opacity-0")}>
54 |       <BreadcrumbList>{links}</BreadcrumbList>
55 |     </Breadcrumb>
56 |   );
57 | }
```

apps/dashboard/src/components/bulk-actions.tsx
```
1 | "use client";
2 |
3 | import { bulkUpdateTransactionsAction } from "@/actions/bulk-update-transactions-action";
4 | import { useTransactionsStore } from "@/store/transactions";
5 | import { Button } from "@midday/ui/button";
6 | import {
7 |   DropdownMenu,
8 |   DropdownMenuCheckboxItem,
9 |   DropdownMenuContent,
10 |   DropdownMenuGroup,
11 |   DropdownMenuPortal,
12 |   DropdownMenuSub,
13 |   DropdownMenuSubContent,
14 |   DropdownMenuSubTrigger,
15 |   DropdownMenuTrigger,
16 | } from "@midday/ui/dropdown-menu";
17 | import { Icons } from "@midday/ui/icons";
18 | import { useToast } from "@midday/ui/use-toast";
19 | import { useAction } from "next-safe-action/hooks";
20 | import { SelectCategory } from "./select-category";
21 | import { SelectUser } from "./select-user";
22 |
23 | type Props = {
24 |   ids: string[];
25 |   tags: { id: string; name: string }[];
26 | };
27 |
28 | export function BulkActions({ ids, tags }: Props) {
29 |   const { toast } = useToast();
30 |
31 |   const { setRowSelection } = useTransactionsStore();
32 |
33 |   const bulkUpdateTransactions = useAction(bulkUpdateTransactionsAction, {
34 |     onExecute: ({ input }) => {
35 |       if (input.type === "status") {
36 |         setRowSelection({});
37 |       }
38 |     },
39 |     onSuccess: ({ data }) => {
40 |       setRowSelection({});
41 |       toast({
42 |         title: `Updated ${data?.length} transactions.`,
43 |         variant: "success",
44 |         duration: 3500,
45 |       });
46 |     },
47 |     onError: () => {
48 |       toast({
49 |         duration: 3500,
50 |         variant: "error",
51 |         title: "Something went wrong please try again.",
52 |       });
53 |     },
54 |   });
55 |
56 |   return (
57 |     <DropdownMenu>
58 |       <DropdownMenuTrigger asChild>
59 |         <Button variant="outline" className="space-x-2">
60 |           <span>Actions</span>
61 |           <Icons.ChevronDown size={16} />
62 |         </Button>
63 |       </DropdownMenuTrigger>
64 |       <DropdownMenuContent align="end" className="w-[180px]" sideOffset={8}>
65 |         <DropdownMenuGroup>
66 |           <DropdownMenuSub>
67 |             <DropdownMenuSubTrigger>
68 |               <Icons.Category className="mr-2 h-4 w-4" />
69 |               <span>Categories</span>
70 |             </DropdownMenuSubTrigger>
71 |             <DropdownMenuPortal>
72 |               <DropdownMenuSubContent
73 |                 sideOffset={14}
74 |                 className="p-0 w-[250px] h-[270px]"
75 |               >
76 |                 <SelectCategory
77 |                   onChange={(selected) => {
78 |                     bulkUpdateTransactions.execute({
79 |                       type: "category",
80 |                       data: ids.map((transaction) => ({
81 |                         id: transaction,
82 |                         category_slug: selected.slug,
83 |                       })),
84 |                     });
85 |                   }}
86 |                   headless
87 |                 />
88 |               </DropdownMenuSubContent>
89 |             </DropdownMenuPortal>
90 |           </DropdownMenuSub>
91 |         </DropdownMenuGroup>
92 |
93 |         <DropdownMenuGroup>
94 |           <DropdownMenuSub>
95 |             <DropdownMenuSubTrigger>
96 |               <Icons.Status className="mr-2 h-4 w-4" />
97 |               <span>Tags</span>
98 |             </DropdownMenuSubTrigger>
99 |             <DropdownMenuPortal>
100 |               <DropdownMenuSubContent
101 |                 sideOffset={14}
102 |                 alignOffset={-4}
103 |                 className="py-2 max-h-[200px] overflow-y-auto max-w-[220px]"
104 |               >
105 |                 {tags?.length > 0 ? (
106 |                   tags?.map((tag) => (
107 |                     <DropdownMenuCheckboxItem
108 |                       key={tag.id}
109 |                       checked={ids.includes(tag.id)}
110 |                       onCheckedChange={() => {
111 |                         bulkUpdateTransactions.execute({
112 |                           type: "tags",
113 |                           data: ids.map((transaction) => ({
114 |                             id: transaction,
115 |                             tag_id: tag.id,
116 |                           })),
117 |                         });
118 |                       }}
119 |                     >
120 |                       {tag.name}
121 |                     </DropdownMenuCheckboxItem>
122 |                   ))
123 |                 ) : (
124 |                   <p className="text-sm text-[#878787] px-2">No tags found</p>
125 |                 )}
126 |               </DropdownMenuSubContent>
127 |             </DropdownMenuPortal>
128 |           </DropdownMenuSub>
129 |         </DropdownMenuGroup>
130 |
131 |         <DropdownMenuGroup>
132 |           <DropdownMenuSub>
133 |             <DropdownMenuSubTrigger>
134 |               <Icons.Visibility className="mr-2 h-4 w-4" />
135 |               <span>Exclude</span>
136 |             </DropdownMenuSubTrigger>
137 |             <DropdownMenuPortal>
138 |               <DropdownMenuSubContent sideOffset={14}>
139 |                 <DropdownMenuCheckboxItem
140 |                   onCheckedChange={() => {
141 |                     bulkUpdateTransactions.execute({
142 |                       type: "status",
143 |                       data: ids.map((transaction) => ({
144 |                         id: transaction,
145 |                         internal: true,
146 |                       })),
147 |                     });
148 |                   }}
149 |                 >
150 |                   Yes
151 |                 </DropdownMenuCheckboxItem>
152 |                 <DropdownMenuCheckboxItem
153 |                   onCheckedChange={() => {
154 |                     bulkUpdateTransactions.execute({
155 |                       type: "status",
156 |                       data: ids.map((transaction) => ({
157 |                         id: transaction,
158 |                         internal: false,
159 |                       })),
160 |                     });
161 |                   }}
162 |                 >
163 |                   No
164 |                 </DropdownMenuCheckboxItem>
165 |               </DropdownMenuSubContent>
166 |             </DropdownMenuPortal>
167 |           </DropdownMenuSub>
168 |         </DropdownMenuGroup>
169 |
170 |         <DropdownMenuGroup>
171 |           <DropdownMenuSub>
172 |             <DropdownMenuSubTrigger>
173 |               <Icons.Files className="mr-2 h-4 w-4" />
174 |               <span>Archive</span>
175 |             </DropdownMenuSubTrigger>
176 |             <DropdownMenuPortal>
177 |               <DropdownMenuSubContent sideOffset={14}>
178 |                 <DropdownMenuCheckboxItem
179 |                   onCheckedChange={() => {
180 |                     bulkUpdateTransactions.execute({
181 |                       type: "status",
182 |                       data: ids.map((transaction) => ({
183 |                         id: transaction,
184 |                         status: "archived",
185 |                       })),
186 |                     });
187 |                   }}
188 |                 >
189 |                   Yes
190 |                 </DropdownMenuCheckboxItem>
191 |                 <DropdownMenuCheckboxItem
192 |                   onCheckedChange={() => {
193 |                     bulkUpdateTransactions.execute({
[TRUNCATED]
```

apps/dashboard/src/components/category.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 |
5 | type CategoryIconProps = {
6 |   color?: string;
7 |   size?: number;
8 |   className?: string;
9 | };
10 |
11 | export function CategoryColor({
12 |   color,
13 |   className,
14 |   size = 12,
15 | }: CategoryIconProps) {
16 |   return (
17 |     <div
18 |       className={className}
19 |       style={{
20 |         backgroundColor: color,
21 |         width: size,
22 |         height: size,
23 |       }}
24 |     />
25 |   );
26 | }
27 |
28 | type Props = {
29 |   name: string;
30 |   className?: string;
31 |   color?: string;
32 | };
33 |
34 | export function Category({ name, color, className }: Props) {
35 |   return (
36 |     <div className={cn("flex space-x-2 items-center", className)}>
37 |       <CategoryColor color={color} />
38 |       {name && <span>{name}</span>}
39 |     </div>
40 |   );
41 | }
```

apps/dashboard/src/components/change-email.tsx
```
1 | "use client";
2 |
3 | import { type UpdateUserFormValues, updateUserSchema } from "@/actions/schema";
4 | import { updateUserAction } from "@/actions/update-user-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Card,
9 |   CardContent,
10 |   CardDescription,
11 |   CardFooter,
12 |   CardHeader,
13 |   CardTitle,
14 | } from "@midday/ui/card";
15 | import {
16 |   Form,
17 |   FormControl,
18 |   FormField,
19 |   FormItem,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import { Loader2 } from "lucide-react";
24 | import { useAction } from "next-safe-action/hooks";
25 | import { useForm } from "react-hook-form";
26 |
27 | type Props = {
28 |   email: string;
29 | };
30 |
31 | export function ChangeEmail({ email }: Props) {
32 |   const action = useAction(updateUserAction);
33 |
34 |   const form = useForm<UpdateUserFormValues>({
35 |     resolver: zodResolver(updateUserSchema),
36 |     defaultValues: {
37 |       email,
38 |     },
39 |   });
40 |
41 |   const onSubmit = form.handleSubmit((data) => {
42 |     action.execute({
43 |       email: data?.email,
44 |       revalidatePath: "/account",
45 |     });
46 |   });
47 |
48 |   return (
49 |     <Form {...form}>
50 |       <form onSubmit={onSubmit}>
51 |         <Card>
52 |           <CardHeader>
53 |             <CardTitle>Email</CardTitle>
54 |             <CardDescription>Change your email address.</CardDescription>
55 |           </CardHeader>
56 |
57 |           <CardContent>
58 |             <FormField
59 |               control={form.control}
60 |               name="email"
61 |               render={({ field }) => (
62 |                 <FormItem>
63 |                   <FormControl>
64 |                     <Input
65 |                       {...field}
66 |                       className="max-w-[300px]"
67 |                       autoComplete="off"
68 |                       autoCapitalize="none"
69 |                       autoCorrect="off"
70 |                       spellCheck="false"
71 |                       type="email"
72 |                     />
73 |                   </FormControl>
74 |                   <FormMessage />
75 |                 </FormItem>
76 |               )}
77 |             />
78 |           </CardContent>
79 |
80 |           <CardFooter className="flex justify-between">
81 |             <div>
82 |               This is your primary email address for notifications and more.
83 |             </div>
84 |             <Button
85 |               type="submit"
86 |               disabled={
87 |                 action.status === "executing" || !form.formState.isDirty
88 |               }
89 |             >
90 |               {action.status === "executing" ? (
91 |                 <Loader2 className="h-4 w-4 animate-spin" />
92 |               ) : (
93 |                 "Save"
94 |               )}
95 |             </Button>
96 |           </CardFooter>
97 |         </Card>
98 |       </form>
99 |     </Form>
100 |   );
101 | }
```

apps/dashboard/src/components/change-language.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import {
5 |   languages,
6 |   useChangeLocale,
7 |   useCurrentLocale,
8 |   useI18n,
9 | } from "@/locales/client";
10 | import {
11 |   Card,
12 |   CardContent,
13 |   CardDescription,
14 |   CardHeader,
15 |   CardTitle,
16 | } from "@midday/ui/card";
17 | import {
18 |   Select,
19 |   SelectContent,
20 |   SelectGroup,
21 |   SelectItem,
22 |   SelectTrigger,
23 |   SelectValue,
24 | } from "@midday/ui/select";
25 | import { useAction } from "next-safe-action/hooks";
26 |
27 | export function ChangeLanguage() {
28 |   const action = useAction(updateUserAction);
29 |   const changeLocale = useChangeLocale();
30 |   const locale = useCurrentLocale();
31 |   const t = useI18n();
32 |
33 |   const handleOnChange = async (locale: string) => {
34 |     await action.execute({ locale });
35 |     changeLocale(locale);
36 |   };
37 |
38 |   return (
39 |     <Card>
40 |       <CardHeader>
41 |         <CardTitle>{t("language.title")}</CardTitle>
42 |         <CardDescription>{t("language.description")}</CardDescription>
43 |       </CardHeader>
44 |
45 |       <CardContent>
46 |         <Select defaultValue={locale} onValueChange={handleOnChange}>
47 |           <SelectTrigger className="w-[180px]">
48 |             <SelectValue placeholder={t("language.placeholder")} />
49 |           </SelectTrigger>
50 |           <SelectContent>
51 |             <SelectGroup>
52 |               {languages.map((language) => (
53 |                 <SelectItem value={language} key={language}>
54 |                   {t(`languages.${language}`)}
55 |                 </SelectItem>
56 |               ))}
57 |             </SelectGroup>
58 |           </SelectContent>
59 |         </Select>
60 |       </CardContent>
61 |     </Card>
62 |   );
63 | }
```

apps/dashboard/src/components/change-theme.tsx
```
1 | import { ThemeSwitch } from "@/components/theme-switch";
2 | import {
3 |   Card,
4 |   CardContent,
5 |   CardDescription,
6 |   CardHeader,
7 |   CardTitle,
8 | } from "@midday/ui/card";
9 |
10 | export function ChangeTheme() {
11 |   return (
12 |     <Card>
13 |       <CardHeader>
14 |         <CardTitle>Appearance</CardTitle>
15 |         <CardDescription>
16 |           Customize how Midday looks on your device.
17 |         </CardDescription>
18 |       </CardHeader>
19 |
20 |       <CardContent>
21 |         <div className="w-[240px]">
22 |           <ThemeSwitch />
23 |         </div>
24 |       </CardContent>
25 |     </Card>
26 |   );
27 | }
```

apps/dashboard/src/components/change-timezone.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   Card,
7 |   CardContent,
8 |   CardDescription,
9 |   CardHeader,
10 |   CardTitle,
11 | } from "@midday/ui/card";
12 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
13 | import { useOptimisticAction } from "next-safe-action/hooks";
14 |
15 | type Props = {
16 |   timezone: string;
17 |   timezones: { tzCode: string; name: string }[];
18 | };
19 |
20 | export function ChangeTimezone({ timezone, timezones }: Props) {
21 |   const t = useI18n();
22 |
23 |   const { execute, optimisticState } = useOptimisticAction(updateUserAction, {
24 |     currentState: { timezone },
25 |     updateFn: (state, newTimezone) => {
26 |       return {
27 |         timezone: newTimezone.timezone ?? state.timezone,
28 |       };
29 |     },
30 |   });
31 |
32 |   const timezoneItems = timezones.map((tz, id) => ({
33 |     id: id.toString(),
34 |     label: tz.name,
35 |     value: tz.tzCode,
36 |   }));
37 |
38 |   return (
39 |     <Card className="flex justify-between items-center">
40 |       <CardHeader>
41 |         <CardTitle>{t("timezone.title")}</CardTitle>
42 |         <CardDescription>{t("timezone.description")}</CardDescription>
43 |       </CardHeader>
44 |
45 |       <CardContent>
46 |         <div className="w-[250px]">
47 |           <ComboboxDropdown
48 |             placeholder={t("timezone.placeholder")}
49 |             selectedItem={timezoneItems.find(
50 |               (item) => item.value === optimisticState.timezone,
51 |             )}
52 |             searchPlaceholder={t("timezone.searchPlaceholder")}
53 |             items={timezoneItems}
54 |             className="text-xs py-1"
55 |             onSelect={(item) => {
56 |               execute({ timezone: item.value });
57 |             }}
58 |           />
59 |         </div>
60 |       </CardContent>
61 |     </Card>
62 |   );
63 | }
```

apps/dashboard/src/components/color-picker.tsx
```
1 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
2 | import { HexColorPicker } from "react-colorful";
3 |
4 | type Props = {
5 |   value: string;
6 |   onSelect: (value: string) => void;
7 | };
8 |
9 | export function ColorPicker({ value, onSelect }: Props) {
10 |   return (
11 |     <Popover>
12 |       <PopoverTrigger asChild>
13 |         <button
14 |           type="button"
15 |           className="size-3 transition-colors rounded-[2px] absolute top-3 left-2"
16 |           style={{
17 |             backgroundColor: value,
18 |           }}
19 |         />
20 |       </PopoverTrigger>
21 |       <PopoverContent className="p-0 w-auto" sideOffset={14}>
22 |         <HexColorPicker
23 |           className="color-picker"
24 |           color={value}
25 |           onChange={(c) => {
26 |             onSelect(c);
27 |           }}
28 |         />
29 |       </PopoverContent>
30 |     </Popover>
31 |   );
32 | }
```

apps/dashboard/src/components/column-visibility.tsx
```
1 | import { useTransactionsStore } from "@/store/transactions";
2 | import { Button } from "@midday/ui/button";
3 | import { Checkbox } from "@midday/ui/checkbox";
4 | import { Icons } from "@midday/ui/icons";
5 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
6 |
7 | export function ColumnVisibility({ disabled }: { disabled?: boolean }) {
8 |   const { columns } = useTransactionsStore();
9 |
10 |   return (
11 |     <Popover>
12 |       <PopoverTrigger asChild>
13 |         <Button variant="outline" size="icon" disabled={disabled}>
14 |           <Icons.Tune size={18} />
15 |         </Button>
16 |       </PopoverTrigger>
17 |
18 |       <PopoverContent className="w-[200px] p-0" align="end" sideOffset={8}>
19 |         <div className="flex flex-col p-4 space-y-2 max-h-[352px] overflow-auto">
20 |           {columns
21 |             .filter(
22 |               (column) =>
23 |                 column.columnDef.enableHiding !== false &&
24 |                 column.id !== "status",
25 |             )
26 |             .map((column) => {
27 |               return (
28 |                 <div key={column.id} className="flex items-center space-x-2">
29 |                   <Checkbox
30 |                     id={column.id}
31 |                     checked={column.getIsVisible()}
32 |                     onCheckedChange={(checked) =>
33 |                       column.toggleVisibility(checked)
34 |                     }
35 |                   />
36 |                   <label
37 |                     htmlFor={column.id}
38 |                     className="text-sm peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
39 |                   >
40 |                     {column.columnDef.header}
41 |                   </label>
42 |                 </div>
43 |               );
44 |             })}
45 |         </div>
46 |       </PopoverContent>
47 |     </Popover>
48 |   );
49 | }
```

apps/dashboard/src/components/connect-bank-provider.tsx
```
1 | import { updateInstitutionUsageAction } from "@/actions/institutions/update-institution-usage";
2 | import { useConnectParams } from "@/hooks/use-connect-params";
3 | import { useAction } from "next-safe-action/hooks";
4 | import { BankConnectButton } from "./bank-connect-button";
5 | import { GoCardLessConnect } from "./gocardless-connect";
6 | import { TellerConnect } from "./teller-connect";
7 |
8 | type Props = {
9 |   id: string;
10 |   provider: string;
11 |   availableHistory: number;
12 |   openPlaid: () => void;
13 | };
14 |
15 | export function ConnectBankProvider({
16 |   id,
17 |   provider,
18 |   openPlaid,
19 |   availableHistory,
20 | }: Props) {
21 |   const { setParams } = useConnectParams();
22 |   const updateInstitutionUsage = useAction(updateInstitutionUsageAction);
23 |
24 |   const updateUsage = () => {
25 |     updateInstitutionUsage.execute({ institutionId: id });
26 |   };
27 |
28 |   switch (provider) {
29 |     case "teller":
30 |       return (
31 |         <TellerConnect
32 |           id={id}
33 |           onSelect={() => {
34 |             // NOTE: Wait for Teller sdk to be configured
35 |             setTimeout(() => {
36 |               setParams({ step: null });
37 |             }, 950);
38 |
39 |             updateUsage();
40 |           }}
41 |         />
42 |       );
43 |     case "gocardless": {
44 |       return (
45 |         <GoCardLessConnect
46 |           id={id}
47 |           availableHistory={availableHistory}
48 |           onSelect={() => {
49 |             updateUsage();
50 |           }}
51 |         />
52 |       );
53 |     }
54 |     case "plaid":
55 |       return (
56 |         <BankConnectButton
57 |           onClick={() => {
58 |             updateUsage();
59 |             openPlaid();
60 |           }}
61 |         />
62 |       );
63 |     default:
64 |       return null;
65 |   }
66 | }
```

apps/dashboard/src/components/connected-accounts.tsx
```
1 | import { AddAccountButton } from "@/components/add-account-button";
2 | import {
3 |   BankAccountList,
4 |   BankAccountListSkeleton,
5 | } from "@/components/bank-account-list";
6 | import {
7 |   Card,
8 |   CardDescription,
9 |   CardFooter,
10 |   CardHeader,
11 |   CardTitle,
12 | } from "@midday/ui/card";
13 | import { Suspense } from "react";
14 |
15 | export function ConnectedAccounts() {
16 |   return (
17 |     <Card>
18 |       <CardHeader>
19 |         <CardTitle>Accounts</CardTitle>
20 |         <CardDescription>
21 |           Manage bank accounts, update or connect new ones.
22 |         </CardDescription>
23 |       </CardHeader>
24 |
25 |       <Suspense fallback={<BankAccountListSkeleton />}>
26 |         <BankAccountList />
27 |       </Suspense>
28 |
29 |       <CardFooter className="flex justify-between">
30 |         <div />
31 |
32 |         <AddAccountButton />
33 |       </CardFooter>
34 |     </Card>
35 |   );
36 | }
```

apps/dashboard/src/components/connection-status.tsx
```
1 | import { getConnectionsStatus } from "@/utils/connection-status";
2 | import { getBankConnectionsByTeamId } from "@midday/supabase/cached-queries";
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import { Icons } from "@midday/ui/icons";
6 | import {
7 |   Tooltip,
8 |   TooltipContent,
9 |   TooltipProvider,
10 |   TooltipTrigger,
11 | } from "@midday/ui/tooltip";
12 | import Link from "next/link";
13 |
14 | export async function ConnectionStatus() {
15 |   const bankConnections = await getBankConnectionsByTeamId();
16 |
17 |   if (!bankConnections?.data?.length) {
18 |     return null;
19 |   }
20 |
21 |   const connectionIssue = bankConnections?.data?.some(
22 |     (bank) => bank.status === "disconnected",
23 |   );
24 |
25 |   if (connectionIssue) {
26 |     return (
27 |       <TooltipProvider delayDuration={70}>
28 |         <Tooltip>
29 |           <TooltipTrigger asChild>
30 |             <Link href="/settings/accounts" prefetch>
31 |               <Button
32 |                 variant="outline"
33 |                 size="icon"
34 |                 className="rounded-full w-8 h-8 items-center hidden md:flex"
35 |               >
36 |                 <Icons.Error size={16} className="text-[#FF3638]" />
37 |               </Button>
38 |             </Link>
39 |           </TooltipTrigger>
40 |
41 |           <TooltipContent
42 |             className="px-3 py-1.5 text-xs max-w-[230px]"
43 |             sideOffset={10}
44 |           >
45 |             There is a connection issue with one of your banks.
46 |           </TooltipContent>
47 |         </Tooltip>
48 |       </TooltipProvider>
49 |     );
50 |   }
51 |
52 |   // NOTE: No connections with expire_at (Only GoCardLess)
53 |   if (bankConnections?.data?.find((bank) => bank.expires_at === null)) {
54 |     return null;
55 |   }
56 |
57 |   const { warning, error, show } = getConnectionsStatus(bankConnections.data);
58 |
59 |   if (!show) {
60 |     return null;
61 |   }
62 |
63 |   return (
64 |     <TooltipProvider delayDuration={70}>
65 |       <Tooltip>
66 |         <TooltipTrigger asChild>
67 |           <Link href="/settings/accounts" prefetch>
68 |             <Button
69 |               variant="outline"
70 |               size="icon"
71 |               className="rounded-full w-8 h-8 items-center hidden md:flex"
72 |             >
73 |               <Icons.Error
74 |                 size={16}
75 |                 className={cn(
76 |                   error && "text-[#FF3638]",
77 |                   warning && "text-[#FFD02B]",
78 |                 )}
79 |               />
80 |             </Button>
81 |           </Link>
82 |         </TooltipTrigger>
83 |
84 |         <TooltipContent
85 |           className="px-3 py-1.5 text-xs max-w-[230px]"
86 |           sideOffset={10}
87 |         >
88 |           The connection is expiring soon, update your connection.
89 |         </TooltipContent>
90 |       </Tooltip>
91 |     </TooltipProvider>
92 |   );
93 | }
```

apps/dashboard/src/components/consent-banner.tsx
```
1 | "use client";
2 |
3 | import { trackingConsentAction } from "@/actions/tracking-consent-action";
4 | import { Button } from "@midday/ui/button";
5 | import { cn } from "@midday/ui/cn";
6 | import { useAction } from "next-safe-action/hooks";
7 | import { useState } from "react";
8 |
9 | export function ConsentBanner() {
10 |   const [isOpen, setOpen] = useState(true);
11 |   const trackingAction = useAction(trackingConsentAction, {
12 |     onExecute: () => setOpen(false),
13 |   });
14 |
15 |   if (!isOpen) {
16 |     return null;
17 |   }
18 |
19 |   return (
20 |     <div
21 |       className={cn(
22 |         "fixed z-50 bottom-2 md:bottom-4 left-2 md:left-4 flex flex-col space-y-4 w-[calc(100vw-16px)] max-w-[420px] border border-border p-4 transition-all bg-background",
23 |         isOpen &&
24 |           "animate-in sm:slide-in-from-bottom-full slide-in-from-bottom-full",
25 |       )}
26 |     >
27 |       <div className="text-sm">
28 |         This site uses tracking technologies. You may opt in or opt out of the
29 |         use of these technologies.
30 |       </div>
31 |       <div className="flex justify-end space-x-2">
32 |         <Button
33 |           className="rounded-full h-8"
34 |           onClick={() => trackingAction.execute(false)}
35 |         >
36 |           Deny
37 |         </Button>
38 |         <Button
39 |           className="rounded-full h-8"
40 |           onClick={() => trackingAction.execute(true)}
41 |         >
42 |           Accept
43 |         </Button>
44 |       </div>
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/copy-input.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 | import { motion } from "framer-motion";
6 | import { useState } from "react";
7 |
8 | type Props = {
9 |   value: string;
10 |   className?: string;
11 | };
12 |
13 | export function CopyInput({ value, className }: Props) {
14 |   const [isCopied, setCopied] = useState(false);
15 |
16 |   const handleClipboard = async () => {
17 |     try {
18 |       setCopied(true);
19 |
20 |       await navigator.clipboard.writeText(value);
21 |
22 |       setTimeout(() => {
23 |         setCopied(false);
24 |       }, 2000);
25 |     } catch {}
26 |   };
27 |
28 |   return (
29 |     <button
30 |       type="button"
31 |       onClick={handleClipboard}
32 |       className={cn(
33 |         "flex items-center relative w-full border py-2 px-4 cursor-pointer",
34 |         className,
35 |       )}
36 |     >
37 |       <div className="pr-8 text-[#878787] text-sm truncate">{value}</div>
38 |
39 |       <motion.div
40 |         className="absolute right-4 top-2.5"
41 |         initial={{ opacity: 1, scale: 1 }}
42 |         animate={{ opacity: isCopied ? 0 : 1, scale: isCopied ? 0 : 1 }}
43 |       >
44 |         <Icons.Copy />
45 |       </motion.div>
46 |
47 |       <motion.div
48 |         className="absolute right-4 top-2.5"
49 |         initial={{ opacity: 0, scale: 0 }}
50 |         animate={{ opacity: isCopied ? 1 : 0, scale: isCopied ? 1 : 0 }}
51 |       >
52 |         <Icons.Check />
53 |       </motion.div>
54 |     </button>
55 |   );
56 | }
```

apps/dashboard/src/components/country-selector.tsx
```
1 | import countries from "@midday/location/country-flags";
2 | import { Button } from "@midday/ui/button";
3 | import { cn } from "@midday/ui/cn";
4 | import {
5 |   Command,
6 |   CommandEmpty,
7 |   CommandGroup,
8 |   CommandInput,
9 |   CommandItem,
10 | } from "@midday/ui/command";
11 | import {
12 |   Popover,
13 |   PopoverContentWithoutPortal,
14 |   PopoverTrigger,
15 | } from "@midday/ui/popover";
16 | import { CaretSortIcon, CheckIcon } from "@radix-ui/react-icons";
17 | import * as React from "react";
18 | import { useEffect } from "react";
19 |
20 | type Props = {
21 |   defaultValue: string;
22 |   onSelect: (countryCode: string, countryName: string) => void;
23 | };
24 |
25 | export function CountrySelector({ defaultValue, onSelect }: Props) {
26 |   const [open, setOpen] = React.useState(false);
27 |   const [value, setValue] = React.useState(defaultValue);
28 |
29 |   useEffect(() => {
30 |     if (value !== defaultValue) {
31 |       setValue(defaultValue);
32 |     }
33 |   }, [defaultValue, value]);
34 |
35 |   const selected = Object.values(countries).find(
36 |     (country) => country.code === value || country.name === value,
37 |   );
38 |
39 |   return (
40 |     <Popover open={open} onOpenChange={setOpen}>
41 |       <PopoverTrigger asChild>
42 |         <Button
43 |           variant="outline"
44 |           aria-expanded={open}
45 |           className="w-full justify-between font-normal truncate bg-accent"
46 |         >
47 |           {value ? selected?.name : "Select country"}
48 |           <CaretSortIcon className="ml-2 h-4 w-4 shrink-0 opacity-50" />
49 |         </Button>
50 |       </PopoverTrigger>
51 |       <PopoverContentWithoutPortal className="w-[225px] p-0">
52 |         <Command>
53 |           <CommandInput placeholder="Search country..." className="h-9 px-2" />
54 |           <CommandEmpty>No country found.</CommandEmpty>
55 |           <CommandGroup className="overflow-y-auto max-h-[230px] pt-2">
56 |             {Object.values(countries).map((country) => (
57 |               <CommandItem
58 |                 key={country.code}
59 |                 value={country.name}
60 |                 onSelect={() => {
61 |                   setValue(country.code);
62 |                   onSelect?.(country.code, country.name);
63 |                   setOpen(false);
64 |                 }}
65 |               >
66 |                 {country.name}
67 |                 <CheckIcon
68 |                   className={cn(
69 |                     "ml-auto h-4 w-4",
70 |                     value === country.code ? "opacity-100" : "opacity-0",
71 |                   )}
72 |                 />
73 |               </CommandItem>
74 |             ))}
75 |           </CommandGroup>
76 |         </Command>
77 |       </PopoverContentWithoutPortal>
78 |     </Popover>
79 |   );
80 | }
```

apps/dashboard/src/components/customer-header.tsx
```
1 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
2 | import { InvoiceStatus } from "./invoice-status";
3 |
4 | type Props = {
5 |   name: string;
6 |   website: string;
7 |   status: "overdue" | "paid" | "unpaid" | "draft" | "canceled";
8 | };
9 |
10 | export default function CustomerHeader({ name, website, status }: Props) {
11 |   return (
12 |     <div className="flex justify-between items-center mb-4">
13 |       <div className="flex items-center space-x-2">
14 |         {name && (
15 |           <Avatar className="size-5 object-contain border border-border">
16 |             {website && (
17 |               <AvatarImageNext
18 |                 src={`https://img.logo.dev/${website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
19 |                 alt={`${name} logo`}
20 |                 width={20}
21 |                 height={20}
22 |                 quality={100}
23 |               />
24 |             )}
25 |             <AvatarFallback className="text-[9px] font-medium">
26 |               {name?.[0]}
27 |             </AvatarFallback>
28 |           </Avatar>
29 |         )}
30 |         <span className="truncate text-sm">{name}</span>
31 |       </div>
32 |
33 |       <InvoiceStatus status={status} />
34 |     </div>
35 |   );
36 | }
```

apps/dashboard/src/components/customers-header.tsx
```
1 | import { OpenCustomerSheet } from "./open-customer-sheet";
2 | import { SearchField } from "./search-field";
3 |
4 | export async function CustomersHeader() {
5 |   return (
6 |     <div className="flex items-center justify-between">
7 |       <SearchField placeholder="Search customers" />
8 |
9 |       <div className="hidden sm:block">
10 |         <OpenCustomerSheet />
11 |       </div>
12 |     </div>
13 |   );
14 | }
```

apps/dashboard/src/components/date-format-settings.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import {
5 |   Card,
6 |   CardContent,
7 |   CardDescription,
8 |   CardHeader,
9 |   CardTitle,
10 | } from "@midday/ui/card";
11 | import {
12 |   Select,
13 |   SelectContent,
14 |   SelectItem,
15 |   SelectTrigger,
16 |   SelectValue,
17 | } from "@midday/ui/select";
18 | import { useAction } from "next-safe-action/hooks";
19 |
20 | type Props = {
21 |   dateFormat: string;
22 | };
23 |
24 | export function DateFormatSettings({ dateFormat }: Props) {
25 |   const action = useAction(updateUserAction);
26 |
27 |   return (
28 |     <Card className="flex justify-between items-center">
29 |       <CardHeader>
30 |         <CardTitle>Date Display Format</CardTitle>
31 |         <CardDescription>
32 |           Select the format used to display dates throughout the app.
33 |         </CardDescription>
34 |       </CardHeader>
35 |
36 |       <CardContent>
37 |         <Select
38 |           defaultValue={dateFormat}
39 |           onValueChange={(value) => {
40 |             action.execute({
41 |               date_format: value as "dd/MM/yyyy" | "MM/dd/yyyy" | "yyyy-MM-dd",
42 |             });
43 |           }}
44 |         >
45 |           <SelectTrigger className="w-[180px]">
46 |             <SelectValue placeholder="Date format" />
47 |           </SelectTrigger>
48 |           <SelectContent>
49 |             <SelectItem value="dd/MM/yyyy">dd/MM/yyyy</SelectItem>
50 |             <SelectItem value="MM/dd/yyyy">MM/dd/yyyy</SelectItem>
51 |             <SelectItem value="yyyy-MM-dd">yyyy-MM-dd</SelectItem>
52 |           </SelectContent>
53 |         </Select>
54 |       </CardContent>
55 |     </Card>
56 |   );
57 | }
```

apps/dashboard/src/components/default-settings.server.tsx
```
1 | import { getTimezone } from "@midday/location";
2 | import { getLocale } from "@midday/location";
3 | import { getDateFormat } from "@midday/location";
4 | import { getUser } from "@midday/supabase/cached-queries";
5 | import { createClient } from "@midday/supabase/server";
6 |
7 | export async function DefaultSettings() {
8 |   const supabase = createClient();
9 |
10 |   const locale = getLocale();
11 |   const timezone = getTimezone();
12 |   const dateFormat = getDateFormat();
13 |
14 |   try {
15 |     const user = await getUser();
16 |
17 |     const { id, date_format } = user?.data ?? {};
18 |
19 |     // Set default date format if not set
20 |     if (!date_format && id) {
21 |       await supabase
22 |         .from("users")
23 |         .update({
24 |           date_format: dateFormat,
25 |           timezone,
26 |           locale,
27 |         })
28 |         .eq("id", id);
29 |     }
30 |   } catch (error) {
31 |     console.error(error);
32 |   }
33 |
34 |   return null;
35 | }
```

apps/dashboard/src/components/delete-account.tsx
```
1 | "use client";
2 |
3 | import { deleteUserAction } from "@/actions/delete-user-action";
4 | import {
5 |   AlertDialog,
6 |   AlertDialogAction,
7 |   AlertDialogCancel,
8 |   AlertDialogContent,
9 |   AlertDialogDescription,
10 |   AlertDialogFooter,
11 |   AlertDialogHeader,
12 |   AlertDialogTitle,
13 |   AlertDialogTrigger,
14 | } from "@midday/ui/alert-dialog";
15 | import { Button } from "@midday/ui/button";
16 | import {
17 |   Card,
18 |   CardDescription,
19 |   CardFooter,
20 |   CardHeader,
21 |   CardTitle,
22 | } from "@midday/ui/card";
23 | import { Input } from "@midday/ui/input";
24 | import { Label } from "@midday/ui/label";
25 | import { Loader2 } from "lucide-react";
26 | import { useState, useTransition } from "react";
27 |
28 | export function DeleteAccount() {
29 |   const [isPending, startTransition] = useTransition();
30 |   const [value, setValue] = useState("");
31 |
32 |   return (
33 |     <Card className="border-destructive">
34 |       <CardHeader>
35 |         <CardTitle>Delete account</CardTitle>
36 |         <CardDescription>
37 |           Permanently remove your Personal Account and all of its contents from
38 |           the Midday platform. This action is not reversible, so please continue
39 |           with caution.
40 |         </CardDescription>
41 |       </CardHeader>
42 |       <CardFooter className="flex justify-between">
43 |         <div />
44 |
45 |         <AlertDialog>
46 |           <AlertDialogTrigger asChild>
47 |             <Button
48 |               variant="destructive"
49 |               className="hover:bg-destructive text-muted"
50 |             >
51 |               Delete
52 |             </Button>
53 |           </AlertDialogTrigger>
54 |           <AlertDialogContent>
55 |             <AlertDialogHeader>
56 |               <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
57 |               <AlertDialogDescription>
58 |                 This action cannot be undone. This will permanently delete your
59 |                 account and remove your data from our servers.
60 |               </AlertDialogDescription>
61 |             </AlertDialogHeader>
62 |
63 |             <div className="flex flex-col gap-2 mt-2">
64 |               <Label htmlFor="confirm-delete">
65 |                 Type <span className="font-medium">DELETE</span> to confirm.
66 |               </Label>
67 |               <Input
68 |                 id="confirm-delete"
69 |                 value={value}
70 |                 onChange={(e) => setValue(e.target.value)}
71 |               />
72 |             </div>
73 |
74 |             <AlertDialogFooter>
75 |               <AlertDialogCancel>Cancel</AlertDialogCancel>
76 |               <AlertDialogAction
77 |                 onClick={() => startTransition(() => deleteUserAction())}
78 |                 disabled={value !== "DELETE"}
79 |               >
80 |                 {isPending ? (
81 |                   <Loader2 className="h-4 w-4 animate-spin" />
82 |                 ) : (
83 |                   "Continue"
84 |                 )}
85 |               </AlertDialogAction>
86 |             </AlertDialogFooter>
87 |           </AlertDialogContent>
88 |         </AlertDialog>
89 |       </CardFooter>
90 |     </Card>
91 |   );
92 | }
```

apps/dashboard/src/components/delete-team.tsx
```
1 | "use client";
2 |
3 | import { deleteTeamAction } from "@/actions/delete-team-action";
4 | import {
5 |   AlertDialog,
6 |   AlertDialogAction,
7 |   AlertDialogCancel,
8 |   AlertDialogContent,
9 |   AlertDialogDescription,
10 |   AlertDialogFooter,
11 |   AlertDialogHeader,
12 |   AlertDialogTitle,
13 |   AlertDialogTrigger,
14 | } from "@midday/ui/alert-dialog";
15 | import { Button } from "@midday/ui/button";
16 | import {
17 |   Card,
18 |   CardDescription,
19 |   CardFooter,
20 |   CardHeader,
21 |   CardTitle,
22 | } from "@midday/ui/card";
23 | import { Input } from "@midday/ui/input";
24 | import { Label } from "@midday/ui/label";
25 | import { Loader2 } from "lucide-react";
26 | import { useAction } from "next-safe-action/hooks";
27 | import { useRouter } from "next/navigation";
28 | import { useState } from "react";
29 |
30 | interface DeleteTeamProps {
31 |   teamId: string;
32 | }
33 |
34 | export function DeleteTeam({ teamId }: DeleteTeamProps) {
35 |   const [value, setValue] = useState("");
36 |
37 |   const router = useRouter();
38 |   const deleteTeam = useAction(deleteTeamAction, {
39 |     onSuccess: () => router.push("/teams"),
40 |   });
41 |
42 |   return (
43 |     <Card className="border-destructive">
44 |       <CardHeader>
45 |         <CardTitle>Delete team</CardTitle>
46 |         <CardDescription>
47 |           Permanently remove your Team and all of its contents from the Midday
48 |           platform. This action is not reversible — please continue with
49 |           caution.
50 |         </CardDescription>
51 |       </CardHeader>
52 |       <CardFooter className="flex justify-between">
53 |         <div />
54 |
55 |         <AlertDialog>
56 |           <AlertDialogTrigger asChild>
57 |             <Button
58 |               variant="destructive"
59 |               className="hover:bg-destructive text-muted"
60 |             >
61 |               Delete
62 |             </Button>
63 |           </AlertDialogTrigger>
64 |           <AlertDialogContent>
65 |             <AlertDialogHeader>
66 |               <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
67 |               <AlertDialogDescription>
68 |                 This action cannot be undone. This will permanently delete your
69 |                 team and remove your data from our servers.
70 |               </AlertDialogDescription>
71 |             </AlertDialogHeader>
72 |
73 |             <div className="flex flex-col gap-2 mt-2">
74 |               <Label htmlFor="confirm-delete">
75 |                 Type <span className="font-medium">DELETE</span> to confirm.
76 |               </Label>
77 |               <Input
78 |                 id="confirm-delete"
79 |                 value={value}
80 |                 onChange={(e) => setValue(e.target.value)}
81 |               />
82 |             </div>
83 |
84 |             <AlertDialogFooter>
85 |               <AlertDialogCancel>Cancel</AlertDialogCancel>
86 |               <AlertDialogAction
87 |                 onClick={() => deleteTeam.execute({ teamId })}
88 |                 disabled={value !== "DELETE"}
89 |               >
90 |                 {deleteTeam.status === "executing" ? (
91 |                   <Loader2 className="h-4 w-4 animate-spin" />
92 |                 ) : (
93 |                   "Confirm"
94 |                 )}
95 |               </AlertDialogAction>
96 |             </AlertDialogFooter>
97 |           </AlertDialogContent>
98 |         </AlertDialog>
99 |       </CardFooter>
100 |     </Card>
101 |   );
102 | }
```

apps/dashboard/src/components/desktop-command-menu-sign-in.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Icons } from "@midday/ui/icons";
5 |
6 | export function DesktopCommandMenuSignIn() {
7 |   return (
8 |     <div className="flex h-full flex-col">
9 |       <Icons.Logo className="absolute top-8 left-8" />
10 |
11 |       <div className="flex items-center w-full justify-center h-full">
12 |         <a href="midday://">
13 |           <Button variant="outline">Login to Midday</Button>
14 |         </a>
15 |       </div>
16 |     </div>
17 |   );
18 | }
```

apps/dashboard/src/components/desktop-sign-in-verify-code.tsx
```
1 | "use client";
2 |
3 | import Image from "next/image";
4 | import appIcon from "public/appicon.png";
5 | import { useEffect, useRef } from "react";
6 |
7 | interface DesktopSignInVerifyCodeProps {
8 |   code: string;
9 | }
10 |
11 | export function DesktopSignInVerifyCode({
12 |   code,
13 | }: DesktopSignInVerifyCodeProps) {
14 |   const hasRunned = useRef(false);
15 |
16 |   useEffect(() => {
17 |     if (code && !hasRunned.current) {
18 |       window.location.replace(`midday://api/auth/callback?code=${code}`);
19 |       hasRunned.current = true;
20 |     }
21 |   }, [code]);
22 |
23 |   return (
24 |     <div>
25 |       <div className="h-screen flex flex-col items-center justify-center text-center text-sm text-[#606060]">
26 |         <Image
27 |           src={appIcon}
28 |           width={80}
29 |           height={80}
30 |           alt="Midday"
31 |           quality={100}
32 |           className="mb-10"
33 |         />
34 |         <p>Signing in...</p>
35 |         <p className="mb-4">
36 |           If Midday dosen't open in a few seconds,{" "}
37 |           <a
38 |             className="underline"
39 |             href={`midday://api/auth/callback?code=${code}`}
40 |           >
41 |             click here
42 |           </a>
43 |           .
44 |         </p>
45 |         <p>You may close this browser tab when done</p>
46 |       </div>
47 |     </div>
48 |   );
49 | }
```

apps/dashboard/src/components/desktop-traffic-light.tsx
```
1 | import { DesktopUpdate } from "@/desktop/components/desktop-update";
2 |
3 | export function DesktopTrafficLight() {
4 |   return (
5 |     <div className="fixed top-[9px] left-[9px] flex space-x-[8px] invisible todesktop:visible z-10">
6 |       <div className="w-[11px] h-[11px] bg-border rounded-full" />
7 |       <div className="w-[11px] h-[11px] bg-border rounded-full" />
8 |       <div className="w-[11px] h-[11px] bg-border rounded-full" />
9 |       <DesktopUpdate />
10 |     </div>
11 |   );
12 | }
```

apps/dashboard/src/components/display-name.tsx
```
1 | "use client";
2 |
3 | import { type UpdateUserFormValues, updateUserSchema } from "@/actions/schema";
4 | import { updateUserAction } from "@/actions/update-user-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Card,
9 |   CardContent,
10 |   CardDescription,
11 |   CardFooter,
12 |   CardHeader,
13 |   CardTitle,
14 | } from "@midday/ui/card";
15 | import {
16 |   Form,
17 |   FormControl,
18 |   FormField,
19 |   FormItem,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import { Loader2 } from "lucide-react";
24 | import { useAction } from "next-safe-action/hooks";
25 | import { useForm } from "react-hook-form";
26 |
27 | type Props = {
28 |   fullName: string;
29 | };
30 |
31 | export function DisplayName({ fullName }: Props) {
32 |   const action = useAction(updateUserAction);
33 |   const form = useForm<UpdateUserFormValues>({
34 |     resolver: zodResolver(updateUserSchema),
35 |     defaultValues: {
36 |       full_name: fullName,
37 |     },
38 |   });
39 |
40 |   const onSubmit = form.handleSubmit((data) => {
41 |     action.execute({
42 |       full_name: data?.full_name,
43 |     });
44 |   });
45 |
46 |   return (
47 |     <Form {...form}>
48 |       <form onSubmit={onSubmit}>
49 |         <Card>
50 |           <CardHeader>
51 |             <CardTitle>Display Name</CardTitle>
52 |             <CardDescription>
53 |               Please enter your full name, or a display name you are comfortable
54 |               with.
55 |             </CardDescription>
56 |           </CardHeader>
57 |
58 |           <CardContent>
59 |             <FormField
60 |               control={form.control}
61 |               name="full_name"
62 |               render={({ field }) => (
63 |                 <FormItem>
64 |                   <FormControl>
65 |                     <Input
66 |                       {...field}
67 |                       className="max-w-[300px]"
68 |                       autoComplete="off"
69 |                       autoCapitalize="none"
70 |                       autoCorrect="off"
71 |                       spellCheck="false"
72 |                       maxLength={32}
73 |                     />
74 |                   </FormControl>
75 |                   <FormMessage />
76 |                 </FormItem>
77 |               )}
78 |             />
79 |           </CardContent>
80 |
81 |           <CardFooter className="flex justify-between">
82 |             <div>Please use 32 characters at maximum.</div>
83 |             <Button type="submit" disabled={action.status === "executing"}>
84 |               {action.status === "executing" ? (
85 |                 <Loader2 className="h-4 w-4 animate-spin" />
86 |               ) : (
87 |                 "Save"
88 |               )}
89 |             </Button>
90 |           </CardFooter>
91 |         </Card>
92 |       </form>
93 |     </Form>
94 |   );
95 | }
```

apps/dashboard/src/components/enroll-mfa.tsx
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { Button } from "@midday/ui/button";
3 | import {
4 |   Collapsible,
5 |   CollapsibleContent,
6 |   CollapsibleTrigger,
7 | } from "@midday/ui/collapsible";
8 | import { InputOTP, InputOTPGroup, InputOTPSlot } from "@midday/ui/input-otp";
9 | import { CaretSortIcon } from "@radix-ui/react-icons";
10 | import Image from "next/image";
11 | import { useRouter } from "next/navigation";
12 | import { useEffect, useState } from "react";
13 | import { CopyInput } from "./copy-input";
14 |
15 | export function EnrollMFA() {
16 |   const supabase = createClient();
17 |   const router = useRouter();
18 |   const [isValidating, setValidating] = useState(false);
19 |   const [factorId, setFactorId] = useState("");
20 |   const [qr, setQR] = useState("");
21 |   const [secret, setSecret] = useState();
22 |   const [error, setError] = useState(false);
23 |   const [isOpen, setIsOpen] = useState(false);
24 |
25 |   const onComplete = async (code: string) => {
26 |     setError(false);
27 |
28 |     if (!isValidating) {
29 |       setValidating(true);
30 |
31 |       const challenge = await supabase.auth.mfa.challenge({ factorId });
32 |
33 |       const verify = await supabase.auth.mfa.verify({
34 |         factorId,
35 |         challengeId: challenge.data.id,
36 |         code,
37 |       });
38 |
39 |       if (verify.data) {
40 |         router.replace("/");
41 |       }
42 |     }
43 |   };
44 |
45 |   useEffect(() => {
46 |     async function enroll() {
47 |       const { data, error } = await supabase.auth.mfa.enroll({
48 |         factorType: "totp",
49 |         issuer: "app.midday.ai",
50 |       });
51 |
52 |       if (error) {
53 |         throw error;
54 |       }
55 |
56 |       setFactorId(data.id);
57 |
58 |       setQR(data.totp.qr_code);
59 |       setSecret(data.totp.secret);
60 |     }
61 |
62 |     enroll();
63 |   }, []);
64 |
65 |   const handleOnCancel = () => {
66 |     supabase.auth.mfa.unenroll({
67 |       factorId,
68 |     });
69 |
70 |     router.push("/");
71 |   };
72 |
73 |   return (
74 |     <>
75 |       <div className="flex items-center justify-center">
76 |         <div className="w-[220px] h-[220px] bg-white rounded-md">
77 |           {qr && (
78 |             <Image src={qr} alt="qr" width={220} height={220} quality={100} />
79 |           )}
80 |         </div>
81 |       </div>
82 |       <div className="my-8">
83 |         <p className="font-medium pb-1 text-2xl text-[#606060]">
84 |           Use an authenticator app to scan the following QR code, and provide
85 |           the code to complete the setup.
86 |         </p>
87 |       </div>
88 |
89 |       <Collapsible
90 |         open={isOpen}
91 |         onOpenChange={setIsOpen}
92 |         className="w-full mb-4"
93 |       >
94 |         <CollapsibleTrigger className="p-0 text-sm w-full">
95 |           <div className="flex items-center justify-between">
96 |             <span className="font-medium">Use setup key</span>
97 |             <CaretSortIcon className="h-4 w-4" />
98 |           </div>
99 |         </CollapsibleTrigger>
100 |         <CollapsibleContent>
101 |           {secret && <CopyInput value={secret} className="w-full" />}
102 |         </CollapsibleContent>
103 |       </Collapsible>
104 |
105 |       <div className="flex w-full">
106 |         <InputOTP
107 |           className={error ? "invalid" : ""}
108 |           maxLength={6}
109 |           autoFocus
110 |           onComplete={onComplete}
111 |           disabled={isValidating}
112 |           render={({ slots }) => (
113 |             <InputOTPGroup>
114 |               {slots.map((slot, index) => (
115 |                 <InputOTPSlot key={index.toString()} {...slot} />
116 |               ))}
117 |             </InputOTPGroup>
118 |           )}
119 |         />
120 |       </div>
121 |
122 |       <div className="flex border-t-[1px] pt-4 mt-6 justify-center mb-6">
123 |         <Button
124 |           onClick={handleOnCancel}
125 |           variant="ghost"
126 |           className="text-medium text-sm hover:bg-transparent"
127 |         >
128 |           Cancel
129 |         </Button>
130 |       </div>
131 |     </>
132 |   );
133 | }
```

apps/dashboard/src/components/error-fallback.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { useRouter } from "next/navigation";
5 |
6 | export function ErrorFallback() {
7 |   const router = useRouter();
8 |
9 |   return (
10 |     <div className="flex flex-col items-center justify-center h-full space-y-4">
11 |       <div>
12 |         <h2 className="text-md">Something went wrong</h2>
13 |       </div>
14 |       <Button onClick={() => router.refresh()} variant="outline">
15 |         Try again
16 |       </Button>
17 |     </div>
18 |   );
19 | }
```

apps/dashboard/src/components/experimental.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 |
3 | type Props = {
4 |   className?: string;
5 | };
6 |
7 | export function Experimental({ className }: Props) {
8 |   return (
9 |     <span
10 |       className={cn(
11 |         "flex items-center py-[3px] px-3 rounded-full border border-primary text-[10px] h-full font-normal",
12 |         className
13 |       )}
14 |     >
15 |       Experimental
16 |     </span>
17 |   );
18 | }
```

apps/dashboard/src/components/export-status.tsx
```
1 | "use client";
2 |
3 | import { shareFileAction } from "@/actions/share-file-action";
4 | import { useExportStatus } from "@/hooks/use-export-status";
5 | import { useExportStore } from "@/store/export";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   DropdownMenu,
9 |   DropdownMenuContent,
10 |   DropdownMenuItem,
11 |   DropdownMenuTrigger,
12 | } from "@midday/ui/dropdown-menu";
13 | import { Icons } from "@midday/ui/icons";
14 | import { useToast } from "@midday/ui/use-toast";
15 | import ms from "ms";
16 | import { useAction } from "next-safe-action/hooks";
17 | import { useEffect, useState } from "react";
18 |
19 | const options = [
20 |   {
21 |     label: "Expire in 1 week",
22 |     expireIn: ms("7d"),
23 |   },
24 |   {
25 |     label: "Expire in 1 month",
26 |     expireIn: ms("30d"),
27 |   },
28 |   {
29 |     label: "Expire in 1 year",
30 |     expireIn: ms("1y"),
31 |   },
32 | ];
33 |
34 | export function ExportStatus() {
35 |   const { toast, dismiss, update } = useToast();
36 |   const [toastId, setToastId] = useState(null);
37 |   const { exportData, setExportData } = useExportStore();
38 |   const { status, progress, result } = useExportStatus(exportData);
39 |
40 |   const shareFile = useAction(shareFileAction, {
41 |     onError: () => {
42 |       toast({
43 |         duration: 2500,
44 |         variant: "error",
45 |         title: "Something went wrong please try again.",
46 |       });
47 |     },
48 |     onSuccess: async ({ data }) => {
49 |       await navigator.clipboard.writeText(data ?? "");
50 |
51 |       toast({
52 |         duration: 2500,
53 |         title: "Copied URL to clipboard.",
54 |         variant: "success",
55 |       });
56 |     },
57 |   });
58 |
59 |   const handleOnDownload = () => {
60 |     dismiss(toastId);
61 |   };
62 |
63 |   const handleOnShare = ({ expireIn, filename }) => {
64 |     shareFile.execute({ expireIn, filepath: `exports/${filename}` });
65 |     dismiss(toastId);
66 |   };
67 |
68 |   useEffect(() => {
69 |     if (status === "FAILED") {
70 |       toast({
71 |         duration: 2500,
72 |         variant: "error",
73 |         title: "Something went wrong please try again.",
74 |       });
75 |
76 |       setToastId(null);
77 |       setExportData(undefined);
78 |     }
79 |   }, [status]);
80 |
81 |   useEffect(() => {
82 |     if (exportData && !toastId) {
83 |       const { id } = toast({
84 |         title: "Exporting transactions.",
85 |         variant: "progress",
86 |         description: "Please do not close browser until completed",
87 |         duration: Number.POSITIVE_INFINITY,
88 |         progress: 0,
89 |       });
90 |
91 |       setToastId(id);
92 |     } else {
93 |       update(toastId, {
94 |         progress,
95 |       });
96 |     }
97 |
98 |     if (status === "COMPLETED" && result) {
99 |       update(toastId, {
100 |         title: "Export completed",
101 |         description: `Your export is ready based on ${result.totalItems} transactions. It's stored in your Vault.`,
102 |         variant: "success",
103 |         footer: (
104 |           <div className="mt-4 flex space-x-4">
105 |             <DropdownMenu>
106 |               <DropdownMenuTrigger asChild>
107 |                 <Button
108 |                   size="sm"
109 |                   variant="secondary"
110 |                   className="border space-x-2"
111 |                 >
112 |                   <span>Share URL</span>
113 |                   <Icons.ChevronDown />
114 |                 </Button>
115 |               </DropdownMenuTrigger>
116 |               <DropdownMenuContent className="z-[100]">
117 |                 {options.map((option, idx) => (
118 |                   <DropdownMenuItem
119 |                     key={idx.toString()}
120 |                     onClick={() =>
121 |                       handleOnShare({
122 |                         expireIn: option.expireIn,
123 |                         filename: result.fileName,
124 |                       })
125 |                     }
126 |                   >
127 |                     {option.label}
128 |                   </DropdownMenuItem>
129 |                 ))}
130 |               </DropdownMenuContent>
131 |             </DropdownMenu>
132 |
133 |             <a
134 |               href={`/api/download/file?path=exports/${result.fileName}&filename=${result.fileName}`}
135 |               download
136 |             >
137 |               <Button size="sm" onClick={handleOnDownload}>
138 |                 Download
139 |               </Button>
140 |             </a>
141 |           </div>
142 |         ),
143 |       });
144 |
145 |       setToastId(null);
146 |       setExportData(undefined);
147 |     }
148 |   }, [toastId, progress, status]);
149 |
150 |   return null;
151 | }
```

apps/dashboard/src/components/feedback-form.tsx
```
1 | "use client";
2 |
3 | import { sendFeebackAction } from "@/actions/send-feedback-action";
4 | import { Button } from "@midday/ui/button";
5 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
6 | import { Textarea } from "@midday/ui/textarea";
7 | import { Loader2 } from "lucide-react";
8 | import { useAction } from "next-safe-action/hooks";
9 | import { useState } from "react";
10 |
11 | export function FeedbackForm() {
12 |   const [value, setValue] = useState("");
13 |
14 |   const action = useAction(sendFeebackAction, {
15 |     onSuccess: () => {
16 |       setValue("");
17 |     },
18 |   });
19 |
20 |   return (
21 |     <Popover>
22 |       <PopoverTrigger asChild className="hidden md:block">
23 |         <Button
24 |           variant="outline"
25 |           className="rounded-full font-normal h-[32px] p-0 px-3 text-xs text-[#878787]"
26 |         >
27 |           Beta feedback
28 |         </Button>
29 |       </PopoverTrigger>
30 |       <PopoverContent
31 |         className="w-[320px] h-[200px]"
32 |         sideOffset={10}
33 |         align="end"
34 |       >
35 |         {action.status === "hasSucceeded" ? (
36 |           <div className="flex items-center justify-center flex-col space-y-1 mt-10 text-center">
37 |             <p className="font-medium text-sm">Thank you for your feedback!</p>
38 |             <p className="text-sm text-[#4C4C4C]">
39 |               We will be back with you as soon as possible
40 |             </p>
41 |           </div>
42 |         ) : (
43 |           <form className="space-y-4">
44 |             <Textarea
45 |               name="feedback"
46 |               value={value}
47 |               required
48 |               autoFocus
49 |               placeholder="Ideas to improve this page or issues you are experiencing."
50 |               className="resize-none h-[120px]"
51 |               onChange={(evt) => setValue(evt.target.value)}
52 |             />
53 |
54 |             <div className="mt-1 flex items-center justify-end">
55 |               <Button
56 |                 type="button"
57 |                 onClick={() => action.execute({ feedback: value })}
58 |                 disabled={value.length === 0 || action.status === "executing"}
59 |               >
60 |                 {action.status === "executing" ? (
61 |                   <Loader2 className="h-4 w-4 animate-spin" />
62 |                 ) : (
63 |                   "Send"
64 |                 )}
65 |               </Button>
66 |             </div>
67 |           </form>
68 |         )}
69 |       </PopoverContent>
70 |     </Popover>
71 |   );
72 | }
```

apps/dashboard/src/components/file-icon.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { Icons } from "@midday/ui/icons";
3 |
4 | type FileIconProps = {
5 |   mimetype: string;
6 |   name: string;
7 |   isFolder: boolean;
8 |   size?: number;
9 |   className?: string;
10 | };
11 |
12 | export function FileIcon({
13 |   mimetype,
14 |   name,
15 |   isFolder,
16 |   size = 16,
17 |   className,
18 | }: FileIconProps) {
19 |   if (name === "exports") {
20 |     return (
21 |       <Icons.DriveFileMove
22 |         size={size}
23 |         className={cn("text-[#878787]", className)}
24 |       />
25 |     );
26 |   }
27 |
28 |   if (name === "inbox") {
29 |     return (
30 |       <Icons.FolderSpecial
31 |         size={size}
32 |         className={cn("text-[#878787]", className)}
33 |       />
34 |     );
35 |   }
36 |
37 |   if (name === "imports") {
38 |     return (
39 |       <Icons.FolderImports
40 |         size={size}
41 |         className={cn("text-[#878787]", className)}
42 |       />
43 |     );
44 |   }
45 |
46 |   if (name === "invoices") {
47 |     return (
48 |       <Icons.SnippetFolder
49 |         size={size}
50 |         className={cn("text-[#878787]", className)}
51 |       />
52 |     );
53 |   }
54 |
55 |   if (name === "transactions") {
56 |     return (
57 |       <Icons.FolderTransactions
58 |         size={size}
59 |         className={cn("text-[#878787]", className)}
60 |       />
61 |     );
62 |   }
63 |
64 |   if (mimetype?.startsWith("image")) {
65 |     return (
66 |       <Icons.BrokenImage
67 |         size={size}
68 |         className={cn("text-[#878787]", className)}
69 |       />
70 |     );
71 |   }
72 |
73 |   if (isFolder) {
74 |     return (
75 |       <Icons.Folder size={size} className={cn("text-[#878787]", className)} />
76 |     );
77 |   }
78 |
79 |   switch (mimetype) {
80 |     case "application/pdf":
81 |       return (
82 |         <Icons.Pdf size={size} className={cn("text-[#878787]", className)} />
83 |       );
84 |     case "application/zip":
85 |       return (
86 |         <Icons.FolderZip
87 |           size={size}
88 |           className={cn("text-[#878787]", className)}
89 |         />
90 |       );
91 |     default:
92 |       return (
93 |         <Icons.Description
94 |           size={size}
95 |           className={cn("text-[#878787]", className)}
96 |         />
97 |       );
98 |   }
99 | }
```

apps/dashboard/src/components/file-preview.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import {
6 |   Dialog,
7 |   DialogContentFrameless,
8 |   DialogTrigger,
9 | } from "@midday/ui/dialog";
10 | import { Icons } from "@midday/ui/icons";
11 | import { Skeleton } from "@midday/ui/skeleton";
12 | import { FileType } from "@midday/utils";
13 | import { AnimatePresence, motion } from "framer-motion";
14 | import dynamic from "next/dynamic";
15 | import { useState } from "react";
16 | import React from "react";
17 |
18 | const Iframe = dynamic(() => import("./iframe").then((mod) => mod.Iframe), {
19 |   ssr: false,
20 | });
21 |
22 | type Props = {
23 |   type: FileType;
24 |   name: string;
25 |   className?: string;
26 |   preview?: boolean;
27 |   src: string;
28 |   downloadUrl?: string;
29 |   width: number;
30 |   height: number;
31 |   disableFullscreen?: boolean;
32 |   onLoaded?: () => void;
33 |   download?: boolean;
34 |   isFullscreen?: boolean;
35 |   delay?: number;
36 | };
37 |
38 | const RenderComponent = ({
39 |   type,
40 |   src,
41 |   className,
42 |   width,
43 |   height,
44 |   preview,
45 |   onLoaded,
46 |   setError,
47 |   delay,
48 | }: {
49 |   type: FileType;
50 |   src: string;
51 |   className?: string;
52 |   width: number;
53 |   height: number;
54 |   preview?: boolean;
55 |   onLoaded: (loaded: boolean) => void;
56 |   setError: (error: boolean) => void;
57 |   delay?: number;
58 | }) => {
59 |   const handleOnLoaded = () => {
60 |     onLoaded(true);
61 |   };
62 |
63 |   if (type?.startsWith("image")) {
64 |     return (
65 |       <div className={cn("flex items-center justify-center", className)}>
66 |         <img
67 |           src={src}
68 |           className="object-contain"
69 |           alt="Preview"
70 |           onError={() => setError(true)}
71 |           onLoad={handleOnLoaded}
72 |         />
73 |       </div>
74 |     );
75 |   }
76 |
77 |   if (type === FileType.Pdf) {
78 |     return (
79 |       <Iframe
80 |         src={src}
81 |         key={src}
82 |         width={width}
83 |         height={height}
84 |         onLoaded={handleOnLoaded}
85 |         setError={setError}
86 |         preview={preview}
87 |         delay={delay}
88 |       />
89 |     );
90 |   }
91 |
92 |   return null;
93 | };
94 |
95 | const DownloadButton = ({ url }: { url: string }) => (
96 |   <a href={url} download>
97 |     <Button
98 |       variant="secondary"
99 |       className="w-[32px] h-[32px] bg-white/80 hover:bg-white dark:bg-black/80 dark:hover:bg-black border"
100 |       size="icon"
101 |     >
102 |       <Icons.FileDownload />
103 |     </Button>
104 |   </a>
105 | );
106 |
107 | const RenderButtons = ({
108 |   preview,
109 |   isLoaded,
110 |   disableFullscreen,
111 |   downloadUrl,
112 | }: {
113 |   preview: boolean;
114 |   isLoaded: boolean;
115 |   disableFullscreen: boolean;
116 |   downloadUrl?: string;
117 | }) => {
118 |   if (preview || !isLoaded) return null;
119 |
120 |   return (
121 |     <div className="absolute bottom-4 left-2 flex space-x-2 z-10">
122 |       {!disableFullscreen && (
123 |         <motion.div
124 |           initial={{ y: 50, opacity: 0 }}
125 |           animate={{ y: 0, opacity: 1 }}
126 |           exit={{ y: -50, opacity: 0 }}
127 |         >
128 |           <DialogTrigger asChild>
129 |             <Button
130 |               variant="secondary"
131 |               className="w-[32px] h-[32px] bg-white/80 hover:bg-white dark:bg-black/80 dark:hover:bg-black border"
132 |               size="icon"
133 |             >
134 |               <Icons.OpenInFull />
135 |             </Button>
136 |           </DialogTrigger>
137 |         </motion.div>
138 |       )}
139 |
140 |       {downloadUrl && (
141 |         <motion.div
142 |           initial={{ y: 50, opacity: 0 }}
143 |           animate={{ y: 0, opacity: 1 }}
144 |           exit={{ y: -50, opacity: 0 }}
145 |           transition={{ delay: 0.04 }}
146 |         >
147 |           <DownloadButton url={downloadUrl} />
148 |         </motion.div>
149 |       )}
150 |     </div>
151 |   );
152 | };
153 |
154 | export function FilePreview({
155 |   src,
156 |   className,
157 |   name,
158 |   type,
159 |   preview,
160 |   downloadUrl,
161 |   width,
162 |   height,
163 |   disableFullscreen,
164 |   download = true,
165 |   isFullscreen,
166 |   delay,
167 |   onLoaded,
168 | }: Props) {
169 |   const [isLoaded, setLoaded] = useState(false);
170 |   const [error, setError] = useState(false);
171 |
172 |   function handleLoaded() {
173 |     setLoaded(true);
174 |     onLoaded?.();
175 |   }
176 |
177 |   return (
178 |     <Dialog>
179 |       <div
180 |         className={cn(className, "relative h-full overflow-hidden")}
181 |         style={preview ? { width: width - 2, height: height - 5 } : undefined}
182 |       >
183 |         {!isLoaded && !error && (
184 |           <div className="w-full h-full flex items-center justify-center pointer-events-none">
185 |             <Skeleton
186 |               style={{ width, height }}
[TRUNCATED]
```

apps/dashboard/src/components/filter-list.tsx
```
1 | import { formatAccountName } from "@/utils/format";
2 | import { Button } from "@midday/ui/button";
3 | import { Icons } from "@midday/ui/icons";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 | import { format } from "date-fns";
6 | import { motion } from "framer-motion";
7 | import { formatDateRange } from "little-date";
8 |
9 | const listVariant = {
10 |   hidden: { y: 10, opacity: 0 },
11 |   show: {
12 |     y: 0,
13 |     opacity: 1,
14 |     transition: {
15 |       duration: 0.05,
16 |       staggerChildren: 0.06,
17 |     },
18 |   },
19 | };
20 |
21 | const itemVariant = {
22 |   hidden: { y: 10, opacity: 0 },
23 |   show: { y: 0, opacity: 1 },
24 | };
25 |
26 | type Props = {
27 |   filters: { [key: string]: string | number | boolean | string[] | number[] };
28 |   loading: boolean;
29 |   onRemove: (key: string) => void;
30 |   categories?: { id: string; name: string; slug: string }[];
31 |   accounts?: { id: string; name: string; currency: string }[];
32 |   members?: { id: string; name: string }[];
33 |   customers?: { id: string; name: string }[];
34 |   statusFilters: { id: string; name: string }[];
35 |   attachmentsFilters: { id: string; name: string }[];
36 |   recurringFilters: { id: string; name: string }[];
37 |   tags?: { id: string; name: string; slug?: string }[];
38 |   amountRange?: [number, number];
39 | };
40 |
41 | export function FilterList({
42 |   filters,
43 |   loading,
44 |   onRemove,
45 |   categories,
46 |   accounts,
47 |   members,
48 |   customers,
49 |   tags,
50 |   statusFilters,
51 |   attachmentsFilters,
52 |   recurringFilters,
53 |   amountRange,
54 | }: Props) {
55 |   const renderFilter = ({ key, value }) => {
56 |     switch (key) {
57 |       case "start": {
58 |         if (key === "start" && value && filters.end) {
59 |           return formatDateRange(new Date(value), new Date(filters.end), {
60 |             includeTime: false,
61 |           });
62 |         }
63 |
64 |         return (
65 |           key === "start" && value && format(new Date(value), "MMM d, yyyy")
66 |         );
67 |       }
68 |
69 |       case "amount_range": {
70 |         return `${amountRange?.[0]} - ${amountRange?.[1]}`;
71 |       }
72 |
73 |       case "attachments": {
74 |         return attachmentsFilters?.find((filter) => filter.id === value)?.name;
75 |       }
76 |
77 |       case "recurring": {
78 |         return value
79 |           ?.map(
80 |             (slug) =>
81 |               recurringFilters?.find((filter) => filter.id === slug)?.name,
82 |           )
83 |           .join(", ");
84 |       }
85 |
86 |       case "statuses": {
87 |         return value
88 |           .map(
89 |             (status) =>
90 |               statusFilters.find((filter) => filter.id === status)?.name,
91 |           )
92 |           .join(", ");
93 |       }
94 |
95 |       case "categories": {
96 |         return value
97 |           .map(
98 |             (slug) =>
99 |               categories?.find((category) => category.slug === slug)?.name,
100 |           )
101 |           .join(", ");
102 |       }
103 |
104 |       case "tags": {
105 |         return value
106 |           .map(
107 |             (id) =>
108 |               tags?.find((tag) => tag?.id === id || tag?.slug === id)?.name,
109 |           )
110 |           .join(", ");
111 |       }
112 |
113 |       case "accounts": {
114 |         return value
115 |           .map((id) => {
116 |             const account = accounts?.find((account) => account.id === id);
117 |             return formatAccountName({
118 |               name: account?.name,
119 |               currency: account?.currency,
120 |             });
121 |           })
122 |           .join(", ");
123 |       }
124 |
125 |       case "customers": {
126 |         return value
127 |           .map((id) => customers?.find((customer) => customer.id === id)?.name)
128 |           .join(", ");
129 |       }
130 |
131 |       case "assignees":
132 |       case "owners": {
133 |         return value
134 |           .map((id) => {
135 |             const member = members?.find((member) => member.id === id);
136 |             return member?.name;
137 |           })
138 |           .join(", ");
139 |       }
140 |
141 |       case "q":
142 |         return value;
143 |
144 |       default:
145 |         return null;
146 |     }
147 |   };
148 |
149 |   const handleOnRemove = (key: string) => {
150 |     if (key === "start" || key === "end") {
151 |       onRemove({ start: null, end: null });
152 |       return;
153 |     }
154 |
155 |     onRemove({ [key]: null });
156 |   };
157 |
158 |   return (
159 |     <motion.ul
160 |       variants={listVariant}
161 |       initial="hidden"
162 |       animate="show"
163 |       className="flex space-x-2"
164 |     >
165 |       {loading && (
166 |         <div className="flex space-x-2">
167 |           <motion.li key="1" variants={itemVariant}>
168 |             <Skeleton className="rounded-full h-8 w-[100px]" />
169 |           </motion.li>
170 |           <motion.li key="2" variants={itemVariant}>
171 |             <Skeleton className="rounded-full h-8 w-[100px]" />
172 |           </motion.li>
173 |         </div>
174 |       )}
175 |
176 |       {!loading &&
177 |         Object.entries(filters)
[TRUNCATED]
```

apps/dashboard/src/components/format-amount.tsx
```
1 | "use client";
2 |
3 | import { useUserContext } from "@/store/user/hook";
4 | import { formatAmount } from "@/utils/format";
5 |
6 | type Props = {
7 |   amount: number;
8 |   currency: string;
9 |   maximumFractionDigits?: number;
10 |   minimumFractionDigits?: number;
11 |   locale?: string;
12 | };
13 |
14 | export function FormatAmount({
15 |   amount,
16 |   currency,
17 |   maximumFractionDigits,
18 |   minimumFractionDigits,
19 |   locale,
20 | }: Props) {
21 |   const { data } = useUserContext((state) => state);
22 |
23 |   return formatAmount({
24 |     locale: locale || data?.locale,
25 |     amount: amount,
26 |     currency: currency,
27 |     maximumFractionDigits,
28 |     minimumFractionDigits,
29 |   });
30 | }
```

apps/dashboard/src/components/github-sign-in.tsx
```
1 | "use client";
2 |
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
7 | import { Loader2 } from "lucide-react";
8 | import { useSearchParams } from "next/navigation";
9 | import { useState } from "react";
10 |
11 | export function GithubSignIn() {
12 |   const [isLoading, setLoading] = useState(false);
13 |   const supabase = createClient();
14 |   const searchParams = useSearchParams();
15 |   const returnTo = searchParams.get("return_to");
16 |
17 |   const handleSignIn = async () => {
18 |     setLoading(true);
19 |
20 |     if (isDesktopApp()) {
21 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
22 |
23 |       redirectTo.searchParams.append("provider", "github");
24 |       redirectTo.searchParams.append("client", "desktop");
25 |
26 |       await supabase.auth.signInWithOAuth({
27 |         provider: "github",
28 |         options: {
29 |           redirectTo: redirectTo.toString(),
30 |           queryParams: {
31 |             client: "desktop",
32 |           },
33 |         },
34 |       });
35 |     } else {
36 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
37 |
38 |       if (returnTo) {
39 |         redirectTo.searchParams.append("return_to", returnTo);
40 |       }
41 |
42 |       redirectTo.searchParams.append("provider", "github");
43 |
44 |       await supabase.auth.signInWithOAuth({
45 |         provider: "github",
46 |         options: {
47 |           redirectTo: redirectTo.toString(),
48 |         },
49 |       });
50 |     }
51 |   };
52 |
53 |   return (
54 |     <Button
55 |       onClick={handleSignIn}
56 |       className="active:scale-[0.98] bg-primary px-6 py-4 text-secondary font-medium flex space-x-2 h-[40px] w-full"
57 |     >
58 |       {isLoading ? (
59 |         <Loader2 className="h-4 w-4 animate-spin" />
60 |       ) : (
61 |         <>
62 |           <Icons.Github />
63 |           <span>Continue with Github</span>
64 |         </>
65 |       )}
66 |     </Button>
67 |   );
68 | }
```

apps/dashboard/src/components/gocardless-connect.tsx
```
1 | import { createGoCardLessLinkAction } from "@/actions/institutions/create-gocardless-link";
2 | import { useToast } from "@midday/ui/use-toast";
3 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
4 | import { useAction } from "next-safe-action/hooks";
5 | import { BankConnectButton } from "./bank-connect-button";
6 |
7 | type Props = {
8 |   id: string;
9 |   availableHistory: number;
10 |   onSelect: () => void;
11 | };
12 |
13 | export function GoCardLessConnect({ onSelect, id, availableHistory }: Props) {
14 |   const { toast } = useToast();
15 |
16 |   const createGoCardLessLink = useAction(createGoCardLessLinkAction, {
17 |     onError: () => {
18 |       toast({
19 |         duration: 3500,
20 |         variant: "error",
21 |         title: "Something went wrong please try again.",
22 |       });
23 |     },
24 |   });
25 |
26 |   const handleOnSelect = () => {
27 |     onSelect();
28 |
29 |     createGoCardLessLink.execute({
30 |       institutionId: id,
31 |       availableHistory: availableHistory,
32 |       redirectBase: isDesktopApp() ? "midday://" : window.location.origin,
33 |     });
34 |   };
35 |
36 |   return <BankConnectButton onClick={handleOnSelect} />;
37 | }
```

apps/dashboard/src/components/google-sign-in.tsx
```
1 | "use client";
2 |
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
7 | import { Loader2 } from "lucide-react";
8 | import { useSearchParams } from "next/navigation";
9 | import { useState } from "react";
10 |
11 | export function GoogleSignIn() {
12 |   const [isLoading, setLoading] = useState(false);
13 |   const supabase = createClient();
14 |   const searchParams = useSearchParams();
15 |   const returnTo = searchParams.get("return_to");
16 |
17 |   const handleSignIn = async () => {
18 |     setLoading(true);
19 |
20 |     if (isDesktopApp()) {
21 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
22 |
23 |       redirectTo.searchParams.append("provider", "google");
24 |       redirectTo.searchParams.append("client", "desktop");
25 |
26 |       await supabase.auth.signInWithOAuth({
27 |         provider: "google",
28 |         options: {
29 |           redirectTo: redirectTo.toString(),
30 |           queryParams: {
31 |             client: "desktop",
32 |           },
33 |         },
34 |       });
35 |     } else {
36 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
37 |
38 |       if (returnTo) {
39 |         redirectTo.searchParams.append("return_to", returnTo);
40 |       }
41 |
42 |       redirectTo.searchParams.append("provider", "google");
43 |
44 |       await supabase.auth.signInWithOAuth({
45 |         provider: "google",
46 |         options: {
47 |           redirectTo: redirectTo.toString(),
48 |         },
49 |       });
50 |     }
51 |   };
52 |
53 |   return (
54 |     <Button
55 |       onClick={handleSignIn}
56 |       className="active:scale-[0.98] bg-primary px-6 py-4 text-secondary font-medium flex space-x-2 h-[40px] w-full"
57 |     >
58 |       {isLoading ? (
59 |         <Loader2 className="h-4 w-4 animate-spin" />
60 |       ) : (
61 |         <>
62 |           <Icons.Google />
63 |           <span>Continue with Google</span>
64 |         </>
65 |       )}
66 |     </Button>
67 |   );
68 | }
```

apps/dashboard/src/components/header.tsx
```
1 | import { AssistantButton } from "@/components/assistant/button";
2 | import { DesktopAssistantButton } from "@/components/assistant/button-desktop";
3 | import { ConnectionStatus } from "@/components/connection-status";
4 | import { NotificationCenter } from "@/components/notification-center";
5 | import { UserMenu } from "@/components/user-menu";
6 | import { BrowserNavigation } from "@/desktop/components/browser-navigation";
7 | import { Skeleton } from "@midday/ui/skeleton";
8 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
9 | import { Suspense } from "react";
10 | import { DesktopTrafficLight } from "./desktop-traffic-light";
11 | import { FeedbackForm } from "./feedback-form";
12 | import { MobileMenu } from "./mobile-menu";
13 |
14 | export function Header() {
15 |   return (
16 |     <header className="-ml-4 -mr-4 md:m-0 z-10 px-4 md:px-0 md:border-b-[1px] flex justify-between pt-4 pb-2 md:pb-4 items-center todesktop:sticky todesktop:top-0 todesktop:bg-background todesktop:border-none sticky md:static top-0 backdrop-filter backdrop-blur-xl md:backdrop-filter md:backdrop-blur-none dark:bg-[#121212] bg-[#fff] bg-opacity-70 ">
17 |       <MobileMenu />
18 |
19 |       {isDesktopApp() && <DesktopTrafficLight />}
20 |       {isDesktopApp() && <BrowserNavigation />}
21 |
22 |       <AssistantButton />
23 |
24 |       <div className="flex space-x-2 ml-auto">
25 |         {isDesktopApp() && <DesktopAssistantButton />}
26 |
27 |         <FeedbackForm />
28 |
29 |         <Suspense>
30 |           <ConnectionStatus />
31 |         </Suspense>
32 |
33 |         <NotificationCenter />
34 |
35 |         <Suspense fallback={<Skeleton className="h-8 w-8 rounded-full" />}>
36 |           <UserMenu />
37 |         </Suspense>
38 |       </div>
39 |     </header>
40 |   );
41 | }
```

apps/dashboard/src/components/hot-keys.tsx
```
1 | "use client";
2 |
3 | import { signOutAction } from "@/actions/sign-out-action";
4 | import { useRouter } from "next/navigation";
5 | import { useHotkeys } from "react-hotkeys-hook";
6 |
7 | export function HotKeys() {
8 |   const router = useRouter();
9 |
10 |   const handleSignOut = async () => {
11 |     signOutAction();
12 |     router.refresh();
13 |   };
14 |
15 |   useHotkeys("ctrl+m", (evt) => {
16 |     evt.preventDefault();
17 |     router.push("/settings/members");
18 |   });
19 |
20 |   useHotkeys("meta+m", (evt) => {
21 |     evt.preventDefault();
22 |     router.push("/settings/members");
23 |   });
24 |
25 |   useHotkeys("ctrl+e", (evt) => {
26 |     evt.preventDefault();
27 |     router.push("/account/teams");
28 |   });
29 |
30 |   useHotkeys("ctrl+a", (evt) => {
31 |     evt.preventDefault();
32 |     router.push("/apps");
33 |   });
34 |
35 |   useHotkeys("ctrl+meta+p", (evt) => {
36 |     evt.preventDefault();
37 |     router.push("/account");
38 |   });
39 |
40 |   useHotkeys("shift+meta+p", (evt) => {
41 |     evt.preventDefault();
42 |     router.push("/account");
43 |   });
44 |
45 |   useHotkeys("ctrl+meta+q", (evt) => {
46 |     evt.preventDefault();
47 |     handleSignOut();
48 |   });
49 |
50 |   useHotkeys("shift+meta+q", (evt) => {
51 |     evt.preventDefault();
52 |     handleSignOut();
53 |   });
54 |
55 |   return null;
56 | }
```

apps/dashboard/src/components/iframe.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { useEffect, useRef, useState } from "react";
4 |
5 | export function Iframe({
6 |   src,
7 |   width,
8 |   height,
9 |   onLoaded,
10 |   setError,
11 |   preview,
12 |   delay = 0,
13 | }: {
14 |   src: string;
15 |   width: number;
16 |   height: number;
17 |   preview: boolean;
18 |   delay?: number;
19 |   onLoaded: (loaded: boolean) => void;
20 |   setError: (error: boolean) => void;
21 | }) {
22 |   const [isLoading, setIsLoading] = useState(true);
23 |   const iframeRef = useRef<HTMLIFrameElement>(null);
24 |   const iframe = iframeRef.current;
25 |
26 |   useEffect(() => {
27 |     if (!iframe) return;
28 |
29 |     const observer = new IntersectionObserver(
30 |       ([entry]) => {
31 |         if (entry?.isIntersecting) {
32 |           iframe.src = iframe.dataset.src as string;
33 |           observer.unobserve(iframe);
34 |         }
35 |       },
36 |       {
37 |         threshold: 0,
38 |       },
39 |     );
40 |
41 |     observer.observe(iframe);
42 |
43 |     return () => {
44 |       observer.disconnect();
45 |     };
46 |   }, [iframe]);
47 |
48 |   useEffect(() => {
49 |     setTimeout(() => {
50 |       onLoaded(true);
51 |     }, delay);
52 |   }, [src]);
53 |
54 |   return (
55 |     <div className="overflow-hidden w-full h-full">
56 |       <iframe
57 |         ref={iframeRef}
58 |         title="Preview"
59 |         data-src={`${src}#toolbar=0&scrollbar=0`}
60 |         width={width}
61 |         height={height}
62 |         allowFullScreen={false}
63 |         loading="lazy"
64 |         className={cn(
65 |           "h-full w-full transition-opacity duration-100",
66 |           isLoading && "opacity-0",
67 |         )}
68 |         style={{
69 |           marginLeft: preview ? 0 : -8,
70 |           marginTop: preview ? 0 : -8,
71 |           width: preview ? width : "calc(100% + 16px)",
72 |           height: preview ? height : "calc(100% + 16px)",
73 |           overflow: "hidden",
74 |         }}
75 |         onLoad={() => {
76 |           setTimeout(() => {
77 |             setIsLoading(false);
78 |           }, 200);
79 |         }}
80 |         onError={() => setError(true)}
81 |       />
82 |
83 |       <Skeleton
84 |         className={cn("w-full h-full absolute", !isLoading && "hidden")}
85 |       />
86 |     </div>
87 |   );
88 | }
```

apps/dashboard/src/components/inbox-details-skeleton.tsx
```
1 | "use client";
2 |
3 | import { Separator } from "@midday/ui/separator";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 |
6 | export function InboxDetailsSkeleton() {
7 |   return (
8 |     <div className="h-[calc(100vh-120px)] overflow-hidden flex-col border w-[1160px] hidden md:flex">
9 |       <div className="flex items-center py-2 h-[52px]">
10 |         <div className="flex items-center gap-2" />
11 |       </div>
12 |
13 |       <Separator />
14 |       <div className="flex flex-1 flex-col">
15 |         <div className="flex items-start p-4">
16 |           <div className="flex items-start gap-4 text-sm">
17 |             <Skeleton className="h-[40px] w-[40px] rounded-full" />
18 |             <div className="grid gap-1 space-y-1">
19 |               <Skeleton className="h-3 w-[100px]" />
20 |               <Skeleton className="h-2 w-[120px]" />
21 |             </div>
22 |           </div>
23 |           <div className="grid gap-1 ml-auto text-right">
24 |             <Skeleton className="h-2 w-[100px] ml-auto" />
25 |             <Skeleton className="h-2 w-[50px] ml-auto" />
26 |           </div>
27 |         </div>
28 |
29 |         <Separator />
30 |       </div>
31 |     </div>
32 |   );
33 | }
```

apps/dashboard/src/components/inbox-details.tsx
```
1 | import { useUserContext } from "@/store/user/hook";
2 | import { formatDate } from "@/utils/format";
3 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
4 | import { Button } from "@midday/ui/button";
5 | import { cn } from "@midday/ui/cn";
6 | import {
7 |   DropdownMenuContent,
8 |   DropdownMenuItem,
9 | } from "@midday/ui/dropdown-menu";
10 | import { DropdownMenu, DropdownMenuTrigger } from "@midday/ui/dropdown-menu";
11 | import { Icons } from "@midday/ui/icons";
12 | import { Separator } from "@midday/ui/separator";
13 | import { Skeleton } from "@midday/ui/skeleton";
14 | import { Tooltip, TooltipContent, TooltipTrigger } from "@midday/ui/tooltip";
15 | import { useToast } from "@midday/ui/use-toast";
16 | import { format } from "date-fns";
17 | import { MoreVertical, Trash2 } from "lucide-react";
18 | import { useEffect, useState } from "react";
19 | import { FilePreview } from "./file-preview";
20 | import { FormatAmount } from "./format-amount";
21 | import { EditInboxModal } from "./modals/edit-inbox-modal";
22 | import { SelectTransaction } from "./select-transaction";
23 |
24 | type InboxItem = {
25 |   id: string;
26 |   status?: string;
27 |   file_path?: string[];
28 |   file_name?: string;
29 |   website?: string;
30 |   display_name?: string;
31 |   amount?: number;
32 |   currency?: string;
33 |   date?: string;
34 |   forwarded_to?: string;
35 |   content_type?: string;
36 |   description?: string;
37 |   transaction?: any;
38 |   locale?: string;
39 | };
40 |
41 | type Props = {
42 |   item: InboxItem;
43 |   onDelete: () => void;
44 |   onSelectTransaction: () => void;
45 |   teamId: string;
46 |   isEmpty?: boolean;
47 |   currencies: string[];
48 | };
49 |
50 | export function InboxDetails({
51 |   item,
52 |   onDelete,
53 |   onSelectTransaction,
54 |   teamId,
55 |   isEmpty,
56 |   currencies,
57 | }: Props) {
58 |   const { toast } = useToast();
59 |   const [isOpen, setOpen] = useState(false);
60 |   const [showFallback, setShowFallback] = useState(false);
61 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
62 |
63 |   const isProcessing = item?.status === "processing" || item?.status === "new";
64 |
65 |   useEffect(() => {
66 |     setShowFallback(false);
67 |   }, [item]);
68 |
69 |   const handleCopyLink = async () => {
70 |     try {
71 |       await navigator.clipboard.writeText(
72 |         `${window.location.origin}/inbox?id=${item.id}`,
73 |       );
74 |
75 |       toast({
76 |         duration: 4000,
77 |         title: "Copied link to clipboard.",
78 |         variant: "success",
79 |       });
80 |     } catch {}
81 |   };
82 |
83 |   if (isEmpty) {
84 |     return <div className="hidden md:block w-[1160px]" />;
85 |   }
86 |
87 |   const fallback = showFallback || (!item?.website && item?.display_name);
88 |
89 |   return (
90 |     <div className="h-[calc(100vh-120px)] overflow-hidden flex-col border w-[1160px] hidden md:flex">
91 |       <div className="flex items-center p-2">
92 |         <div className="flex items-center gap-2">
93 |           <Tooltip>
94 |             <TooltipTrigger asChild>
95 |               <Button
96 |                 variant="ghost"
97 |                 size="icon"
98 |                 disabled={!item}
99 |                 onClick={onDelete}
100 |               >
101 |                 <Trash2 className="h-4 w-4" />
102 |               </Button>
103 |             </TooltipTrigger>
104 |             <TooltipContent className="px-3 py-1.5 text-xs">
105 |               Delete
106 |             </TooltipContent>
107 |           </Tooltip>
108 |         </div>
109 |
110 |         <div className="ml-auto">
111 |           <DropdownMenu>
112 |             <DropdownMenuTrigger asChild>
113 |               <Button variant="ghost" size="icon" disabled={!item}>
114 |                 <MoreVertical className="h-4 w-4" />
115 |                 <span className="sr-only">More</span>
116 |               </Button>
117 |             </DropdownMenuTrigger>
118 |             <DropdownMenuContent align="end">
119 |               <DropdownMenuItem onClick={() => setOpen(true)}>
120 |                 Edit
121 |               </DropdownMenuItem>
122 |               <DropdownMenuItem>
123 |                 <a
124 |                   href={`/api/download/file?path=${item?.file_path
125 |                     ?.slice(1)
126 |                     .join("/")}&filename=${item?.file_name}`}
127 |                   download
128 |                 >
129 |                   Download
130 |                 </a>
131 |               </DropdownMenuItem>
132 |               <DropdownMenuItem onClick={handleCopyLink}>
133 |                 Copy Link
134 |               </DropdownMenuItem>
135 |             </DropdownMenuContent>
136 |           </DropdownMenu>
137 |         </div>
138 |       </div>
139 |       <Separator />
140 |
141 |       {item?.id ? (
142 |         <div className="flex flex-1 flex-col">
143 |           <div className="flex items-start p-4">
144 |             <div className="flex items-start gap-4 text-sm relative">
145 |               {isProcessing ? (
146 |                 <Skeleton className="h-[40px] w-[40px] rounded-full" />
147 |               ) : (
148 |                 <Avatar>
149 |                   {item.website && (
150 |                     <AvatarImageNext
151 |                       alt={item.website}
152 |                       width={40}
153 |                       height={40}
154 |                       className={cn(
155 |                         "rounded-full overflow-hidden",
156 |                         showFallback && "hidden",
157 |                       )}
[TRUNCATED]
```

apps/dashboard/src/components/inbox-empty.tsx
```
1 | import { getInboxEmail } from "@midday/inbox";
2 | import { Icons } from "@midday/ui/icons";
3 | import { CopyInput } from "./copy-input";
4 |
5 | type Props = {
6 |   inboxId: string;
7 | };
8 |
9 | export function InboxEmpty({ inboxId }: Props) {
10 |   return (
11 |     <div className="h-[calc(100vh-150px)] flex items-center justify-center">
12 |       <div className="flex flex-col items-center max-w-[380px] w-full">
13 |         <Icons.InboxEmpty className="mb-4 w-[35px] h-[35px]" />
14 |         <div className="text-center mb-6 space-y-2">
15 |           <h2 className="font-medium text-lg">Magic Inbox</h2>
16 |           <p className="text-[#606060] text-sm">
17 |             Use the email to send receipts to Midday. We will extract and
18 |             reconcile them against your transactions. Additionally, you can also
19 |             upload receipts by simply dragging and dropping them here.
20 |             <br />
21 |           </p>
22 |         </div>
23 |
24 |         <CopyInput value={getInboxEmail(inboxId)} />
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/components/inbox-header.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { TabsList, TabsTrigger } from "@midday/ui/tabs";
3 | import { parseAsString, useQueryStates } from "nuqs";
4 | import { startTransition } from "react";
5 | import { InboxOrdering } from "./inbox-ordering";
6 | import { InboxSearch } from "./inbox-search";
7 | import { InboxSettingsModal } from "./modals/inbox-settings-modal";
8 |
9 | type Props = {
10 |   forwardEmail: string;
11 |   inboxId: string;
12 |   inboxForwarding: boolean;
13 |   handleOnPaginate?: (direction: "down" | "up") => void;
14 |   onChange?: (value: string | null) => void;
15 |   ascending: boolean;
16 | };
17 |
18 | export function InboxHeader({
19 |   forwardEmail,
20 |   inboxForwarding,
21 |   inboxId,
22 |   handleOnPaginate,
23 |   onChange,
24 |   ascending,
25 | }: Props) {
26 |   const [params, setParams] = useQueryStates(
27 |     {
28 |       id: parseAsString,
29 |       q: parseAsString.withDefault(""),
30 |     },
31 |     {
32 |       startTransition,
33 |     },
34 |   );
35 |
36 |   return (
37 |     <div className="flex justify-center items-center space-x-4 mb-4">
38 |       <TabsList>
39 |         <TabsTrigger value="todo">Todo</TabsTrigger>
40 |         <TabsTrigger value="done">Done</TabsTrigger>
41 |       </TabsList>
42 |
43 |       <InboxSearch
44 |         onClear={() => setParams({ id: null, q: null })}
45 |         onArrowDown={() => handleOnPaginate?.("down")}
46 |         value={params.q}
47 |         onChange={(value) => {
48 |           setParams({ id: null, q: value });
49 |           onChange?.(value);
50 |         }}
51 |       />
52 |
53 |       <div className="flex space-x-2">
54 |         <InboxOrdering ascending={ascending} />
55 |         <InboxSettingsModal
56 |           forwardEmail={forwardEmail}
57 |           inboxId={inboxId}
58 |           inboxForwarding={inboxForwarding}
59 |         />
60 |
61 |         <Button
62 |           variant="outline"
63 |           onClick={() => document.getElementById("upload-files")?.click()}
64 |         >
65 |           Upload
66 |         </Button>
67 |       </div>
68 |     </div>
69 |   );
70 | }
```

apps/dashboard/src/components/inbox-item.tsx
```
1 | import { useUserContext } from "@/store/user/hook";
2 | import { formatDate } from "@/utils/format";
3 | import { cn } from "@midday/ui/cn";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 | import { useQueryState } from "nuqs";
6 | import { FormatAmount } from "./format-amount";
7 | import { InboxStatus } from "./inbox-status";
8 |
9 | export function InboxItem({ item }) {
10 |   const [selectedId, setSelectedId] = useQueryState("inboxId");
11 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
12 |
13 |   const isSelected = selectedId === item.id;
14 |   const isProcessing = item.status === "processing" || item.status === "new";
15 |
16 |   return (
17 |     <button
18 |       type="button"
19 |       onClick={() => {
20 |         setSelectedId(item.id);
21 |       }}
22 |       key={item.id}
23 |       className={cn(
24 |         "flex flex-col w-full items-start gap-2 border p-4 text-left text-sm",
25 |         isSelected && "bg-accent border-[#DCDAD2] dark:border-[#2C2C2C]",
26 |       )}
27 |     >
28 |       <div className="flex w-full flex-col gap-1">
29 |         <div className="flex items-center mb-1">
30 |           <div className="flex items-center gap-2">
31 |             <div className="flex items-center space-x-2 select-text">
32 |               <div className="font-semibold">
33 |                 {isProcessing ? (
34 |                   <Skeleton className="h-3 w-[120px] rounded-sm mb-1" />
35 |                 ) : (
36 |                   item.display_name
37 |                 )}
38 |               </div>
39 |             </div>
40 |           </div>
41 |           <div
42 |             className={cn(
43 |               "ml-auto text-xs select-text",
44 |               isSelected ? "text-foreground" : "text-muted-foreground",
45 |             )}
46 |           >
47 |             {isProcessing && <Skeleton className="h-3 w-[50px] rounded-sm" />}
48 |             {!isProcessing && item?.date && formatDate(item.date, dateFormat)}
49 |           </div>
50 |         </div>
51 |
52 |         <div className="flex">
53 |           <div className="text-xs font-medium select-text">
54 |             {isProcessing && <Skeleton className="h-3 w-[50px] rounded-sm" />}
55 |             {!isProcessing && item?.currency && item?.amount && (
56 |               <FormatAmount amount={item.amount} currency={item.currency} />
57 |             )}
58 |           </div>
59 |
60 |           <div className="ml-auto">
61 |             <InboxStatus item={item} />
62 |           </div>
63 |         </div>
64 |       </div>
65 |     </button>
66 |   );
67 | }
```

apps/dashboard/src/components/inbox-list-skeleton.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 |
4 | type InboxSkeletonProps = {
5 |   numberOfItems: number;
6 |   className?: string;
7 | };
8 |
9 | export function InboxListSkeleton({
10 |   numberOfItems,
11 |   className,
12 | }: InboxSkeletonProps) {
13 |   return (
14 |     <div className={cn("flex flex-col gap-4", className)}>
15 |       {[...Array(numberOfItems)].map((_, index) => (
16 |         <div
17 |           className="flex flex-col items-start gap-2 border p-4 text-left text-sm transition-all h-[82px]"
18 |           key={index.toString()}
19 |         >
20 |           <div className="flex w-full flex-col gap-1">
21 |             <div className="flex items-center mb-4">
22 |               <div className="flex items-center gap-2">
23 |                 <div className="font-semibold">
24 |                   <Skeleton className="h-3 w-[140px]" />
25 |                 </div>
26 |               </div>
27 |               <div className="ml-auto text-xs text-muted-foreground">
28 |                 <Skeleton className="h-3 w-[40px]" />
29 |               </div>
30 |             </div>
31 |             <div className="flex">
32 |               <div className="text-xs font-medium">
33 |                 <Skeleton className="h-2 w-[110px]" />
34 |               </div>
35 |               <div className="ml-auto text-xs font-medium">
36 |                 <Skeleton className="h-2 w-[60px]" />
37 |               </div>
38 |             </div>
39 |           </div>
40 |         </div>
41 |       ))}
42 |     </div>
43 |   );
44 | }
```

apps/dashboard/src/components/inbox-list.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Icons } from "@midday/ui/icons";
3 | import { ScrollArea } from "@midday/ui/scroll-area";
4 | import { AnimatePresence, motion } from "framer-motion";
5 | import { InboxItem } from "./inbox-item";
6 |
7 | type InboxListProps = {
8 |   items: {
9 |     id: string;
10 |     status: "done" | "processing" | "new";
11 |     display_name: string;
12 |     created_at: string;
13 |     file_name?: string;
14 |     date?: string;
15 |     currency?: string;
16 |     amount?: number;
17 |   }[];
18 |   hasQuery?: boolean;
19 |   onClear?: () => void;
20 | };
21 |
22 | export function InboxList({ items, hasQuery, onClear }: InboxListProps) {
23 |   if (hasQuery && !items?.length) {
24 |     return (
25 |       <div className="h-screen -mt-[140px] w-full flex items-center justify-center flex-col">
26 |         <div className="flex flex-col items-center">
27 |           <Icons.Transactions2 className="mb-4" />
28 |           <div className="text-center mb-6 space-y-2">
29 |             <h2 className="font-medium text-lg">No results</h2>
30 |             <p className="text-[#606060] text-sm">Try another search term</p>
31 |           </div>
32 |
33 |           <Button variant="outline" onClick={onClear}>
34 |             Clear search
35 |           </Button>
36 |         </div>
37 |       </div>
38 |     );
39 |   }
40 |
41 |   if (!items?.length) {
42 |     return (
43 |       <div className="h-screen -mt-[140px] w-full flex items-center justify-center flex-col">
44 |         <Icons.InboxEmpty size={32} />
45 |         <span className="font-medium mb-2 mt-4">Inbox empty</span>
46 |         <span className="text-sm text-[#878787]">
47 |           You can relax, nothing in here.
48 |         </span>
49 |       </div>
50 |     );
51 |   }
52 |
53 |   // Only run when first item has status=new or deleted
54 |   const initialAnimation = items?.at(0)?.status === "new" && {
55 |     opacity: 0,
56 |     height: 0,
57 |   };
58 |
59 |   const exitAnimation = !hasQuery && {
60 |     opacity: 0,
61 |     height: 0,
62 |   };
63 |
64 |   return (
65 |     <ScrollArea className="h-screen" hideScrollbar>
66 |       <div className="flex flex-col gap-4 pb-[250px]">
67 |         <AnimatePresence initial={false}>
68 |           {items?.map((item) => {
69 |             return (
70 |               <motion.div
71 |                 key={item.id}
72 |                 initial={initialAnimation}
73 |                 animate={{ opacity: 1, height: "auto" }}
74 |                 exit={exitAnimation}
75 |                 transition={{
76 |                   opacity: { duration: 0.2 },
77 |                   height: { type: "spring", bounce: 0.3, duration: 0.5 },
78 |                 }}
79 |                 className="w-full"
80 |               >
81 |                 <InboxItem key={item.id} item={item} />
82 |               </motion.div>
83 |             );
84 |           })}
85 |         </AnimatePresence>
86 |       </div>
87 |     </ScrollArea>
88 |   );
89 | }
```

apps/dashboard/src/components/inbox-ordering.tsx
```
1 | "use client";
2 |
3 | import { inboxOrderAction } from "@/actions/inbox/order";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuCheckboxItem,
8 |   DropdownMenuContent,
9 |   DropdownMenuTrigger,
10 | } from "@midday/ui/dropdown-menu";
11 | import { Icons } from "@midday/ui/icons";
12 | import { useOptimisticAction } from "next-safe-action/hooks";
13 |
14 | type Props = {
15 |   ascending: boolean;
16 | };
17 |
18 | export function InboxOrdering({ ascending }: Props) {
19 |   const { execute: inboxOrder, optimisticState } = useOptimisticAction(
20 |     inboxOrderAction,
21 |     {
22 |       currentState: ascending,
23 |       updateFn: (_, state) => !state,
24 |     },
25 |   );
26 |
27 |   return (
28 |     <DropdownMenu>
29 |       <DropdownMenuTrigger asChild>
30 |         <Button variant="outline" size="icon">
31 |           <Icons.Sort size={16} />
32 |         </Button>
33 |       </DropdownMenuTrigger>
34 |       <DropdownMenuContent>
35 |         <DropdownMenuCheckboxItem
36 |           checked={!optimisticState}
37 |           onCheckedChange={() => inboxOrder(false)}
38 |         >
39 |           Most recent
40 |         </DropdownMenuCheckboxItem>
41 |
42 |         <DropdownMenuCheckboxItem
43 |           checked={optimisticState}
44 |           onCheckedChange={() => inboxOrder(true)}
45 |         >
46 |           Oldest first
47 |         </DropdownMenuCheckboxItem>
48 |       </DropdownMenuContent>
49 |     </DropdownMenu>
50 |   );
51 | }
```

apps/dashboard/src/components/inbox-search.tsx
```
1 | import { Icons } from "@midday/ui/icons";
2 | import { Input } from "@midday/ui/input";
3 | import { useHotkeys } from "react-hotkeys-hook";
4 |
5 | type Props = {
6 |   value: string;
7 |   onChange: (value: string | null) => void;
8 |   onClear?: () => void;
9 |   onArrowDown?: () => void;
10 | };
11 |
12 | export function InboxSearch({ value, onChange, onClear, onArrowDown }: Props) {
13 |   useHotkeys("esc", () => onClear?.(), {
14 |     enableOnFormTags: true,
15 |     enabled: Boolean(value),
16 |   });
17 |
18 |   return (
19 |     <div className="relative w-full">
20 |       <Icons.Search className="w-[18px] h-[18px] absolute left-2 top-[10px] pointer-events-none" />
21 |       <Input
22 |         placeholder="Search inbox"
23 |         onKeyDown={(evt) => {
24 |           if (evt.key === "ArrowDown") {
25 |             // @ts-ignore
26 |             evt.target?.blur();
27 |             evt.preventDefault();
28 |             onArrowDown?.();
29 |           }
30 |         }}
31 |         className="pl-8"
32 |         value={value}
33 |         onChange={(evt) => {
34 |           const value = evt.target.value;
35 |           onChange(value.length ? value : null);
36 |         }}
37 |       />
38 |
39 |       {value && (
40 |         <Icons.Close
41 |           className="w-[18px] h-[18px] top-[9px] absolute right-2"
42 |           onClick={() => onClear?.()}
43 |         />
44 |       )}
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/inbox-settings.tsx
```
1 | import { type UpdateTeamFormValues, updateTeamSchema } from "@/actions/schema";
2 | import { updateTeamAction } from "@/actions/update-team-action";
3 | import { zodResolver } from "@hookform/resolvers/zod";
4 | import { getInboxEmail } from "@midday/inbox";
5 | import { Button } from "@midday/ui/button";
6 | import { Collapsible, CollapsibleContent } from "@midday/ui/collapsible";
7 | import {
8 |   Form,
9 |   FormControl,
10 |   FormDescription,
11 |   FormField,
12 |   FormItem,
13 |   FormLabel,
14 |   FormMessage,
15 | } from "@midday/ui/form";
16 | import { Input } from "@midday/ui/input";
17 | import { Label } from "@midday/ui/label";
18 | import { Switch } from "@midday/ui/switch";
19 | import { Loader2 } from "lucide-react";
20 | import { useAction } from "next-safe-action/hooks";
21 | import { useForm } from "react-hook-form";
22 | import { CopyInput } from "./copy-input";
23 |
24 | type Props = {
25 |   forwardEmail: string;
26 |   inboxId: string;
27 |   inboxForwarding: boolean;
28 |   onSuccess: () => void;
29 | };
30 |
31 | export function InboxSettings({
32 |   forwardEmail,
33 |   inboxForwarding,
34 |   inboxId,
35 |   onSuccess,
36 | }: Props) {
37 |   const action = useAction(updateTeamAction, {
38 |     onSuccess,
39 |   });
40 |
41 |   const form = useForm<UpdateTeamFormValues>({
42 |     resolver: zodResolver(updateTeamSchema),
43 |     defaultValues: {
44 |       inbox_email: forwardEmail,
45 |       inbox_forwarding: inboxForwarding,
46 |     },
47 |   });
48 |
49 |   const onSubmit = form.handleSubmit((data) => {
50 |     action.execute(data);
51 |   });
52 |
53 |   return (
54 |     <div className="flex flex-col space-y-4">
55 |       <div className="flex flex-col space-y-3">
56 |         <Label>Inbox email</Label>
57 |         <CopyInput value={getInboxEmail(inboxId)} />
58 |       </div>
59 |
60 |       <Form {...form}>
61 |         <form onSubmit={onSubmit} className="flex flex-col">
62 |           <Collapsible open={form.watch("inbox_forwarding")}>
63 |             <FormField
64 |               control={form.control}
65 |               name="inbox_forwarding"
66 |               render={({ field }) => (
67 |                 <FormItem className="flex justify-between items-center w-full mb-4">
68 |                   <FormLabel>Forward email</FormLabel>
69 |                   <FormControl>
70 |                     <Switch
71 |                       checked={field.value}
72 |                       onCheckedChange={field.onChange}
73 |                     />
74 |                   </FormControl>
75 |                 </FormItem>
76 |               )}
77 |             />
78 |
79 |             <CollapsibleContent>
80 |               <FormField
81 |                 control={form.control}
82 |                 name="inbox_email"
83 |                 render={({ field }) => (
84 |                   <FormItem>
85 |                     <FormControl>
86 |                       <Input
87 |                         {...field}
88 |                         value={field.value ?? ""}
89 |                         onChange={(evt) =>
90 |                           field.onChange(
91 |                             evt.target.value.length > 0
92 |                               ? evt.target.value
93 |                               : null
94 |                           )
95 |                         }
96 |                         className="w-full"
97 |                         autoComplete="off"
98 |                         autoCapitalize="none"
99 |                         autoCorrect="off"
100 |                         spellCheck="false"
101 |                         type="email"
102 |                         placeholder="hello@example.com"
103 |                       />
104 |                     </FormControl>
105 |                     <FormDescription>
106 |                       We will send a copy of the email to this address.
107 |                     </FormDescription>
108 |                     <FormMessage />
109 |                   </FormItem>
110 |                 )}
111 |               />
112 |             </CollapsibleContent>
113 |           </Collapsible>
114 |
115 |           <div className="w-full mt-8">
116 |             <Button
117 |               type="submit"
118 |               disabled={action.status === "executing"}
119 |               className="w-full"
120 |             >
121 |               {action.status === "executing" ? (
122 |                 <Loader2 className="h-4 w-4 animate-spin" />
123 |               ) : (
124 |                 "Save"
125 |               )}
126 |             </Button>
127 |           </div>
128 |         </form>
129 |       </Form>
130 |     </div>
131 |   );
132 | }
```

apps/dashboard/src/components/inbox-skeleton.tsx
```
1 | "use client";
2 |
3 | import { InboxHeader } from "./inbox-header";
4 | import { InboxStructure } from "./inbox-structure";
5 |
6 | type Props = {
7 |   forwardEmail?: string;
8 |   inboxId?: string;
9 |   ascending: boolean;
10 | };
11 |
12 | export function InboxViewSkeleton({ forwardEmail, inboxId, ascending }: Props) {
13 |   return (
14 |     <InboxStructure
15 |       isLoading
16 |       headerComponent={
17 |         <InboxHeader
18 |           inboxForwarding
19 |           ascending={ascending}
20 |           forwardEmail={forwardEmail ?? ""}
21 |           inboxId={inboxId ?? ""}
22 |         />
23 |       }
24 |     />
25 |   );
26 | }
```

apps/dashboard/src/components/inbox-status.tsx
```
1 | "use client";
2 |
3 | import { Icons } from "@midday/ui/icons";
4 | import {
5 |   Tooltip,
6 |   TooltipContent,
7 |   TooltipProvider,
8 |   TooltipTrigger,
9 | } from "@midday/ui/tooltip";
10 |
11 | export function InboxStatus({ item }) {
12 |   if (item.status === "processing" || item.status === "new") {
13 |     return (
14 |       <div className="flex space-x-1 items-center py-1 px-2 h-[26px]">
15 |         <span className="text-xs">Processing</span>
16 |       </div>
17 |     );
18 |   }
19 |
20 |   if (item?.transaction_id) {
21 |     return (
22 |       <div className="flex space-x-1 items-center py-1 px-2 h-[26px]">
23 |         <Icons.Check />
24 |         <span className="text-xs">Done</span>
25 |       </div>
26 |     );
27 |   }
28 |
29 |   if (item.pending || item.status === "pending") {
30 |     return (
31 |       <TooltipProvider delayDuration={0}>
32 |         <Tooltip>
33 |           <TooltipTrigger asChild>
34 |             <div className="p-1 text-[#878787] bg-[#F2F1EF] text-[11px] dark:bg-[#1D1D1D] px-3 py-1 rounded-full cursor-default font-mono inline-block">
35 |               <span>Pending</span>
36 |             </div>
37 |           </TooltipTrigger>
38 |           <TooltipContent sideOffset={20} className="text-xs">
39 |             <p>
40 |               We will try to match against incoming <br />
41 |               transactions for up to 45 days
42 |             </p>
43 |           </TooltipContent>
44 |         </Tooltip>
45 |       </TooltipProvider>
46 |     );
47 |   }
48 |
49 |   return (
50 |     <TooltipProvider delayDuration={0}>
51 |       <Tooltip>
52 |         <TooltipTrigger asChild>
53 |           <div className="flex space-x-1 items-center">
54 |             <Icons.Error />
55 |             <span>Needs review</span>
56 |           </div>
57 |         </TooltipTrigger>
58 |         <TooltipContent sideOffset={20} className="text-xs">
59 |           <p>
60 |             We could not find a matching transaction
61 |             <br />
62 |             please select the transaction manually
63 |           </p>
64 |         </TooltipContent>
65 |       </Tooltip>
66 |     </TooltipProvider>
67 |   );
68 | }
```

apps/dashboard/src/components/inbox-structure.tsx
```
1 | import { Tabs } from "@midday/ui/tabs";
2 | import { TooltipProvider } from "@midday/ui/tooltip";
3 | import { useQueryState } from "nuqs";
4 | import { InboxDetailsSkeleton } from "./inbox-details-skeleton";
5 | import { InboxListSkeleton } from "./inbox-list-skeleton";
6 |
7 | type Props = {
8 |   isLoading?: boolean;
9 |   headerComponent: React.ReactNode;
10 |   leftComponent?: React.ReactNode;
11 |   rightComponent?: React.ReactNode;
12 |   onChangeTab?: (tab: "done" | "todo") => void;
13 | };
14 |
15 | export function InboxStructure({
16 |   headerComponent,
17 |   leftComponent,
18 |   rightComponent,
19 |   onChangeTab,
20 |   isLoading,
21 | }: Props) {
22 |   const [tab, setTab] = useQueryState("tab", {
23 |     defaultValue: "todo",
24 |   });
25 |
26 |   return (
27 |     <TooltipProvider delayDuration={0}>
28 |       <div className="flex flex-row space-x-8 mt-4">
29 |         <div className="w-full h-[calc(100vh-120px)] relative overflow-hidden">
30 |           <Tabs
31 |             value={tab}
32 |             onValueChange={(value) => {
33 |               setTab(value);
34 |               onChangeTab?.(value);
35 |             }}
36 |           >
37 |             {headerComponent}
38 |             {isLoading ? (
39 |               <InboxListSkeleton numberOfItems={12} />
40 |             ) : (
41 |               leftComponent
42 |             )}
43 |           </Tabs>
44 |         </div>
45 |         {isLoading ? <InboxDetailsSkeleton /> : rightComponent}
46 |       </div>
47 |     </TooltipProvider>
48 |   );
49 | }
```

apps/dashboard/src/components/inbox-upload-zone.tsx
```
1 | "use client";
2 |
3 | import { inboxUploadAction } from "@/actions/inbox-upload-action";
4 | import { resumableUpload } from "@/utils/upload";
5 | import { createClient } from "@midday/supabase/client";
6 | import { cn } from "@midday/ui/cn";
7 | import { useToast } from "@midday/ui/use-toast";
8 | import { useAction } from "next-safe-action/hooks";
9 | import { type ReactNode, useEffect, useRef, useState } from "react";
10 | import { useDropzone } from "react-dropzone";
11 |
12 | type Props = {
13 |   teamId: string;
14 |   children: ReactNode;
15 | };
16 |
17 | export function UploadZone({ children, teamId }: Props) {
18 |   const supabase = createClient();
19 |   const [progress, setProgress] = useState(0);
20 |   const [showProgress, setShowProgress] = useState(false);
21 |   const [toastId, setToastId] = useState(null);
22 |   const uploadProgress = useRef([]);
23 |   const { toast, dismiss, update } = useToast();
24 |
25 |   const inboxUpload = useAction(inboxUploadAction);
26 |
27 |   useEffect(() => {
28 |     if (!toastId && showProgress) {
29 |       const { id } = toast({
30 |         title: `Uploading ${uploadProgress.current.length} files`,
31 |         progress,
32 |         variant: "progress",
33 |         description: "Please do not close browser until completed",
34 |         duration: Number.POSITIVE_INFINITY,
35 |       });
36 |
37 |       setToastId(id);
38 |     } else {
39 |       update(toastId, {
40 |         progress,
41 |         title: `Uploading ${uploadProgress.current.length} files`,
42 |       });
43 |     }
44 |   }, [showProgress, progress, toastId]);
45 |
46 |   const onDrop = async (files) => {
47 |     // NOTE: If onDropRejected
48 |     if (!files.length) {
49 |       return;
50 |     }
51 |
52 |     // Set default progress
53 |     uploadProgress.current = files.map(() => 0);
54 |
55 |     setShowProgress(true);
56 |
57 |     // Add uploaded folder so we can filter background job on this
58 |     const path = [teamId, "inbox"];
59 |
60 |     try {
61 |       const results = await Promise.all(
62 |         files.map(async (file, idx) =>
63 |           resumableUpload(supabase, {
64 |             bucket: "vault",
65 |             path,
66 |             file,
67 |             onProgress: (bytesUploaded, bytesTotal) => {
68 |               uploadProgress.current[idx] = (bytesUploaded / bytesTotal) * 100;
69 |
70 |               const _progress = uploadProgress.current.reduce(
71 |                 (acc, currentValue) => {
72 |                   return acc + currentValue;
73 |                 },
74 |                 0,
75 |               );
76 |
77 |               setProgress(Math.round(_progress / files.length));
78 |             },
79 |           }),
80 |         ),
81 |       );
82 |
83 |       // Trigger the upload jobs
84 |       inboxUpload.execute(
85 |         results.map((result) => ({
86 |           file_path: [...path, result.filename],
87 |           mimetype: result.file.type,
88 |           size: result.file.size,
89 |         })),
90 |       );
91 |
92 |       // Reset once done
93 |       uploadProgress.current = [];
94 |
95 |       setProgress(0);
96 |       toast({
97 |         title: "Upload successful.",
98 |         variant: "success",
99 |         duration: 2000,
100 |       });
101 |
102 |       setShowProgress(false);
103 |       setToastId(null);
104 |       dismiss(toastId);
105 |     } catch {
106 |       toast({
107 |         duration: 2500,
108 |         variant: "error",
109 |         title: "Something went wrong please try again.",
110 |       });
111 |     }
112 |   };
113 |
114 |   const { getRootProps, getInputProps, isDragActive } = useDropzone({
115 |     onDrop,
116 |     onDropRejected: ([reject]) => {
117 |       if (reject?.errors.find(({ code }) => code === "file-too-large")) {
118 |         toast({
119 |           duration: 2500,
120 |           variant: "error",
121 |           title: "File size to large.",
122 |         });
123 |       }
124 |
125 |       if (reject?.errors.find(({ code }) => code === "file-invalid-type")) {
126 |         toast({
127 |           duration: 2500,
128 |           variant: "error",
129 |           title: "File type not supported.",
130 |         });
131 |       }
132 |     },
133 |     maxSize: 3000000, // 3MB
134 |     maxFiles: 10,
135 |     accept: {
136 |       "image/png": [".png"],
137 |       "image/jpeg": [".jpg", ".jpeg"],
138 |       "application/pdf": [".pdf"],
139 |     },
140 |   });
141 |
142 |   return (
143 |     <div
144 |       {...getRootProps({ onClick: (evt) => evt.stopPropagation() })}
145 |       className="relative h-full"
146 |     >
147 |       <div className="absolute top-0 bottom-0 right-0 left-0 z-[51] pointer-events-none">
148 |         <div
149 |           className={cn(
150 |             "bg-background dark:bg-[#1A1A1A] h-full flex items-center justify-center text-center invisible",
151 |             isDragActive && "visible",
152 |           )}
153 |         >
154 |           <input {...getInputProps()} id="upload-files" />
155 |           <p className="text-xs">
156 |             Drop your receipts here. <br />
157 |             Maximum of 10 files at a time.
158 |           </p>
159 |         </div>
160 |       </div>
161 |
162 |       {children}
163 |     </div>
164 |   );
165 | }
```

apps/dashboard/src/components/inbox-view-skeleton.tsx
```
1 | "use client";
2 |
3 | import { InboxHeader } from "./inbox-header";
4 | import { InboxStructure } from "./inbox-structure";
5 |
6 | export function InboxViewSkeleton() {
7 |   return (
8 |     <InboxStructure
9 |       isLoading
10 |       headerComponent={
11 |         <InboxHeader forwardEmail="" inboxId="" ascending inboxForwarding />
12 |       }
13 |     />
14 |   );
15 | }
```

apps/dashboard/src/components/inbox-view.tsx
```
1 | "use client";
2 |
3 | import { updateInboxAction } from "@/actions/inbox/update";
4 | import { searchAction } from "@/actions/search-action";
5 | import { InboxDetails } from "@/components/inbox-details";
6 | import { InboxList } from "@/components/inbox-list";
7 | import { createClient } from "@midday/supabase/client";
8 | import { TabsContent } from "@midday/ui/tabs";
9 | import { ToastAction } from "@midday/ui/toast";
10 | import { useToast } from "@midday/ui/use-toast";
11 | import { useDebounce } from "@uidotdev/usehooks";
12 | import { useOptimisticAction } from "next-safe-action/hooks";
13 | import { useAction } from "next-safe-action/hooks";
14 | import { parseAsString, parseAsStringEnum, useQueryStates } from "nuqs";
15 | import { useEffect, useState } from "react";
16 | import { InboxEmpty } from "./inbox-empty";
17 | import { InboxHeader } from "./inbox-header";
18 | import { InboxStructure } from "./inbox-structure";
19 |
20 | type Props = {
21 |   items: any[];
22 |   forwardEmail: string;
23 |   inboxForwarding: boolean;
24 |   inboxId: string;
25 |   teamId: string;
26 |   ascending: boolean;
27 |   query?: string;
28 |   currencies: string[];
29 |   locale: string;
30 | };
31 |
32 | export const TAB_ITEMS = ["todo", "done"];
33 |
34 | const todoFilter = (item) =>
35 |   !item.transaction_id &&
36 |   item.status !== "deleted" &&
37 |   item.status !== "archived";
38 |
39 | const doneFilter = (item) =>
40 |   item.transaction_id &&
41 |   item.status !== "deleted" &&
42 |   item.status !== "archived";
43 |
44 | export function InboxView({
45 |   items: initialItems,
46 |   forwardEmail,
47 |   inboxForwarding,
48 |   teamId,
49 |   inboxId,
50 |   ascending,
51 |   query,
52 |   currencies,
53 |   locale,
54 | }: Props) {
55 |   const supabase = createClient();
56 |   const { toast } = useToast();
57 |   const [isLoading, setLoading] = useState(Boolean(query));
58 |   const [items, setItems] = useState(initialItems);
59 |
60 |   const [params, setParams] = useQueryStates({
61 |     inboxId: parseAsString.withDefault(
62 |       items.filter(todoFilter)?.at(0)?.id ?? null,
63 |     ),
64 |     q: parseAsString.withDefault(""),
65 |     tab: parseAsStringEnum(TAB_ITEMS).withDefault("todo"),
66 |   });
67 |
68 |   const debouncedSearchTerm = useDebounce(params.q, 300);
69 |
70 |   const search = useAction(searchAction, {
71 |     onSuccess: ({ data }) => {
72 |       setLoading(false);
73 |
74 |       if (data?.length) {
75 |         setParams({ id: data?.at(0)?.id || null });
76 |       }
77 |     },
78 |     onError: () => setLoading(false),
79 |   });
80 |
81 |   useEffect(() => {
82 |     setItems(initialItems);
83 |   }, [ascending]);
84 |
85 |   useEffect(() => {
86 |     const channel = supabase
87 |       .channel("realtime_inbox")
88 |       .on(
89 |         "postgres_changes",
90 |         {
91 |           event: "*",
92 |           schema: "public",
93 |           table: "inbox",
94 |           filter: `team_id=eq.${teamId}`,
95 |         },
96 |         (payload) => {
97 |           switch (payload.eventType) {
98 |             case "INSERT":
99 |               {
100 |                 setItems((prev) => [payload.new, ...prev]);
101 |
102 |                 if (params.inboxId) {
103 |                   setTimeout(() => {
104 |                     setParams({ inboxId: payload.new.id });
105 |                   }, 100);
106 |                 }
107 |               }
108 |               break;
109 |             case "UPDATE":
110 |               {
111 |                 if (payload.new.transaction_id) {
112 |                   toast({
113 |                     title: "Sucessfully matched transaction",
114 |                     description:
115 |                       "We've found a transaction for this attachment.",
116 |                     variant: "success",
117 |                   });
118 |                 }
119 |
120 |                 setItems((prev) => {
121 |                   return prev.map((item) => {
122 |                     if (item.id === payload.new.id) {
123 |                       return { ...item, ...payload.new };
124 |                     }
125 |
126 |                     return item;
127 |                   });
128 |                 });
129 |               }
130 |               break;
131 |             default:
132 |               break;
133 |           }
134 |         },
135 |       )
136 |       .subscribe();
137 |
138 |     return () => {
139 |       supabase.removeChannel(channel);
140 |     };
141 |   }, [teamId]);
142 |
143 |   useEffect(() => {
144 |     if (params.q) {
145 |       setLoading(true);
146 |     }
147 |   }, [params.q]);
148 |
149 |   useEffect(() => {
150 |     if (debouncedSearchTerm) {
151 |       search.execute({
152 |         query: debouncedSearchTerm,
153 |         type: "inbox",
154 |         limit: 100,
155 |       });
156 |     }
157 |   }, [debouncedSearchTerm]);
158 |
159 |   const data = params.q ? search.result?.data || [] : items;
160 |
161 |   const { execute: updateInbox, optimisticState } = useOptimisticAction(
162 |     updateInboxAction,
163 |     {
164 |       currentState: data,
165 |       updateFn: (state, payload) => {
166 |         if (payload.status === "deleted") {
167 |           return state.filter((item) => item.id !== payload.id);
168 |         }
169 |
170 |         return items.map((item) => {
171 |           if (item.id === payload.id) {
172 |             return {
173 |               ...item,
174 |               ...payload,
175 |             };
176 |           }
177 |
178 |           return item;
179 |         });
180 |       },
181 |     },
182 |   );
183 |
184 |   const getCurrentItems = (tab: (typeof TAB_ITEMS)[0]) => {
185 |     if (params.q) {
186 |       return optimisticState;
187 |     }
188 |
[TRUNCATED]
```

apps/dashboard/src/components/inbox.tsx
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { getInboxQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { UploadZone } from "./inbox-upload-zone";
5 | import { InboxView } from "./inbox-view";
6 |
7 | type Props = {
8 |   ascending: boolean;
9 |   query?: string;
10 |   currencies: string[];
11 | };
12 |
13 | export async function Inbox({ ascending, query, currencies }: Props) {
14 |   const supabase = createClient();
15 |   const user = await getUser();
16 |
17 |   const teamId = user?.data?.team_id as string;
18 |
19 |   const inbox = await getInboxQuery(supabase, {
20 |     to: 10000,
21 |     teamId,
22 |     ascending,
23 |   });
24 |
25 |   return (
26 |     <UploadZone teamId={teamId}>
27 |       <InboxView
28 |         items={inbox?.data}
29 |         teamId={teamId}
30 |         inboxId={user?.data?.team?.inbox_id}
31 |         forwardEmail={user?.data?.team?.inbox_email}
32 |         inboxForwarding={user?.data?.team?.inbox_forwarding}
33 |         ascending={ascending}
34 |         query={query}
35 |         currencies={currencies}
36 |       />
37 |     </UploadZone>
38 |   );
39 | }
```

apps/dashboard/src/components/input-color.tsx
```
1 | import { getColorFromName, getRandomColor } from "@/utils/categories";
2 | import { Input } from "@midday/ui/input";
3 | import { useState } from "react";
4 | import { ColorPicker } from "./color-picker";
5 |
6 | type Props = {
7 |   placeholder: string;
8 |   defaultValue?: string;
9 |   defaultColor?: string;
10 |   autoFocus?: booleam;
11 |   onChange: (values: { name: string; color: string }) => void;
12 | };
13 |
14 | export function InputColor({
15 |   placeholder,
16 |   defaultValue,
17 |   onChange,
18 |   defaultColor,
19 |   autoFocus,
20 | }: Props) {
21 |   const [color, setColor] = useState(defaultColor ?? getRandomColor());
22 |   const [value, setValue] = useState(defaultValue);
23 |
24 |   return (
25 |     <div className="relative">
26 |       <ColorPicker
27 |         value={color}
28 |         onSelect={(newColor) => {
29 |           setColor(newColor);
30 |           onChange({
31 |             color: newColor,
32 |             name: value,
33 |           });
34 |         }}
35 |       />
36 |       <Input
37 |         placeholder={placeholder}
38 |         autoComplete="off"
39 |         autoCapitalize="none"
40 |         autoFocus={autoFocus}
41 |         autoCorrect="off"
42 |         spellCheck="false"
43 |         className="pl-7"
44 |         value={value}
45 |         onChange={(evt) => {
46 |           const newName = evt.target.value;
47 |           const newColor = getColorFromName(newName);
48 |
49 |           setColor(newColor);
50 |           setValue(newName);
51 |
52 |           onChange({
53 |             color: newColor,
54 |             name: newName,
55 |           });
56 |         }}
57 |       />
58 |     </div>
59 |   );
60 | }
```

apps/dashboard/src/components/institution-info.tsx
```
1 | import {
2 |   Tooltip,
3 |   TooltipContent,
4 |   TooltipProvider,
5 |   TooltipTrigger,
6 | } from "@midday/ui/tooltip";
7 | import type { ReactNode } from "react";
8 |
9 | type Props = {
10 |   provider: string;
11 |   children: ReactNode;
12 | };
13 |
14 | export function InstitutionInfo({ provider, children }: Props) {
15 |   const getDescription = () => {
16 |     switch (provider) {
17 |       case "gocardless":
18 |         return "With GoCardLess we can connect to more than 2,500 banks in 31 countries across the UK and Europe.";
19 |       case "plaid":
20 |         return `With Plaid we can connect to 12,000+ financial institutions across the US, Canada, UK, and Europe are covered by Plaid's network`;
21 |       case "teller":
22 |         return "With Teller we can connect instantly to more than 5,000 financial institutions in the US.";
23 |       default:
24 |         break;
25 |     }
26 |   };
27 |
28 |   return (
29 |     <TooltipProvider delayDuration={100}>
30 |       <Tooltip>
31 |         <TooltipTrigger asChild>{children}</TooltipTrigger>
32 |         <TooltipContent className="w-[300px] text-xs" side="right">
33 |           {getDescription()}
34 |         </TooltipContent>
35 |       </Tooltip>
36 |     </TooltipProvider>
37 |   );
38 | }
```

apps/dashboard/src/components/invoice-actions.tsx
```
1 | import { deleteInvoiceAction } from "@/actions/invoice/delete-invoice-action";
2 | import { sendReminderAction } from "@/actions/invoice/send-reminder-action";
3 | import { updateInvoiceAction } from "@/actions/invoice/update-invoice-action";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import { UTCDate } from "@date-fns/utc";
6 | import {
7 |   AlertDialog,
8 |   AlertDialogAction,
9 |   AlertDialogCancel,
10 |   AlertDialogContent,
11 |   AlertDialogDescription,
12 |   AlertDialogFooter,
13 |   AlertDialogHeader,
14 |   AlertDialogTitle,
15 |   AlertDialogTrigger,
16 | } from "@midday/ui/alert-dialog";
17 | import { Button } from "@midday/ui/button";
18 | import {
19 |   DropdownMenu,
20 |   DropdownMenuContent,
21 |   DropdownMenuItem,
22 |   DropdownMenuTrigger,
23 | } from "@midday/ui/dropdown-menu";
24 | import { Icons } from "@midday/ui/icons";
25 | import { useAction } from "next-safe-action/hooks";
26 |
27 | type Props = {
28 |   status: string;
29 |   id: string;
30 | };
31 |
32 | export function InvoiceActions({ status, id }: Props) {
33 |   const { setParams } = useInvoiceParams();
34 |   const updateInvoice = useAction(updateInvoiceAction);
35 |   const deleteInvoice = useAction(deleteInvoiceAction);
36 |   const sendReminder = useAction(sendReminderAction);
37 |
38 |   const handleDeleteInvoice = () => {
39 |     deleteInvoice.execute({ id });
40 |     setParams(null);
41 |   };
42 |
43 |   switch (status) {
44 |     case "canceled":
45 |     case "paid":
46 |       return (
47 |         <div className="absolute right-4 mt-7">
48 |           <DropdownMenu>
49 |             <DropdownMenuTrigger asChild>
50 |               <Button
51 |                 size="sm"
52 |                 variant="secondary"
53 |                 className="hover:bg-secondary"
54 |               >
55 |                 <Icons.MoreHoriz className="size-4" />
56 |               </Button>
57 |             </DropdownMenuTrigger>
58 |             <DropdownMenuContent sideOffset={10} align="end">
59 |               <DropdownMenuItem
60 |                 onClick={() =>
61 |                   updateInvoice.execute({
62 |                     id,
63 |                     status: "unpaid",
64 |                     paid_at: null,
65 |                   })
66 |                 }
67 |               >
68 |                 Mark as unpaid
69 |               </DropdownMenuItem>
70 |               <DropdownMenuItem
71 |                 className="text-destructive"
72 |                 onClick={handleDeleteInvoice}
73 |               >
74 |                 Delete
75 |               </DropdownMenuItem>
76 |             </DropdownMenuContent>
77 |           </DropdownMenu>
78 |         </div>
79 |       );
80 |
81 |     case "overdue":
82 |     case "unpaid":
83 |       return (
84 |         <div className="flex space-x-2 mt-8">
85 |           <AlertDialog>
86 |             <AlertDialogTrigger asChild>
87 |               <Button
88 |                 size="sm"
89 |                 variant="secondary"
90 |                 className="flex items-center space-x-2 hover:bg-secondary w-full"
91 |               >
92 |                 <Icons.Notifications className="size-3.5" />
93 |                 <span>Remind</span>
94 |               </Button>
95 |             </AlertDialogTrigger>
96 |             <AlertDialogContent>
97 |               <AlertDialogHeader>
98 |                 <AlertDialogTitle>Send Reminder</AlertDialogTitle>
99 |                 <AlertDialogDescription>
100 |                   Are you sure you want to send a reminder for this invoice?
101 |                 </AlertDialogDescription>
102 |               </AlertDialogHeader>
103 |               <AlertDialogFooter>
104 |                 <AlertDialogCancel>Cancel</AlertDialogCancel>
105 |                 <AlertDialogAction
106 |                   onClick={() => sendReminder.execute({ id })}
107 |                   disabled={sendReminder.isPending}
108 |                 >
109 |                   Send Reminder
110 |                 </AlertDialogAction>
111 |               </AlertDialogFooter>
112 |             </AlertDialogContent>
113 |           </AlertDialog>
114 |
115 |           <Button
116 |             size="sm"
117 |             variant="secondary"
118 |             className="flex items-center space-x-2 hover:bg-secondary w-full"
119 |             onClick={() => setParams({ invoiceId: id, type: "edit" })}
120 |           >
121 |             <Icons.Edit className="size-3.5" />
122 |             <span>Edit</span>
123 |           </Button>
124 |
125 |           <DropdownMenu>
126 |             <DropdownMenuTrigger asChild>
127 |               <Button
128 |                 size="sm"
129 |                 variant="secondary"
130 |                 className="hover:bg-secondary"
131 |               >
132 |                 <Icons.MoreHoriz className="size-4" />
133 |               </Button>
134 |             </DropdownMenuTrigger>
135 |             <DropdownMenuContent sideOffset={10} align="end">
136 |               <DropdownMenuItem
137 |                 onClick={() =>
138 |                   updateInvoice.execute({
139 |                     id,
140 |                     status: "paid",
141 |                     paid_at: new UTCDate().toISOString(),
142 |                   })
143 |                 }
144 |               >
145 |                 Mark as paid
146 |               </DropdownMenuItem>
147 |               <DropdownMenuItem
148 |                 className="text-destructive"
149 |                 onClick={handleDeleteInvoice}
150 |               >
151 |                 Delete
152 |               </DropdownMenuItem>
153 |               <DropdownMenuItem
154 |                 className="text-destructive"
155 |                 onClick={() =>
156 |                   updateInvoice.execute({ id, status: "canceled" })
157 |                 }
158 |               >
159 |                 Cancel
160 |               </DropdownMenuItem>
161 |             </DropdownMenuContent>
162 |           </DropdownMenu>
163 |         </div>
164 |       );
165 |     case "draft":
166 |       return (
167 |         <div className="flex space-x-2 mt-8">
168 |           <Button
169 |             size="sm"
170 |             variant="secondary"
171 |             className="flex items-center space-x-2 hover:bg-secondary w-full"
172 |             onClick={() => setParams({ invoiceId: id, type: "edit" })}
173 |           >
174 |             <Icons.Edit className="size-3.5" />
175 |             <span>Edit</span>
176 |           </Button>
177 |
178 |           <DropdownMenu>
179 |             <DropdownMenuTrigger asChild>
180 |               <Button
181 |                 size="sm"
[TRUNCATED]
```

apps/dashboard/src/components/invoice-comments.tsx
```
1 | "use client";
2 |
3 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
4 | import { cn } from "@midday/ui/cn";
5 | import { Icons } from "@midday/ui/icons";
6 | import { Textarea } from "@midday/ui/textarea";
7 |
8 | const comments = [
9 |   {
10 |     id: "1",
11 |     content:
12 |       "Hi, I've sent the invoice for last month's services. Please let me know if everything looks good.",
13 |     avatarUrl:
14 |       "https://lh3.googleusercontent.com/a/ACg8ocLjCbXytBlvKPhIpNLGvaGkhdbtfumGo4tKpn72QUVT0hu4AVKB=s96-c",
15 |     name: "John Doe",
16 |     createdAt: new Date(),
17 |     owner: "user",
18 |   },
19 |   {
20 |     id: "2",
21 |     content:
22 |       "Thanks for sending the invoice. I noticed a discrepancy in the total amount. Could you verify the charges for the additional services?",
23 |     avatarUrl: null,
24 |     name: "Acme Inc",
25 |     createdAt: new Date(),
26 |     owner: "customer",
27 |   },
28 |   {
29 |     id: "3",
30 |     content:
31 |       "Sure! The additional charge is for the extra support hours we provided on the 10th and 11th. Let me know if you need further details.",
32 |     avatarUrl:
33 |       "https://lh3.googleusercontent.com/a/ACg8ocLjCbXytBlvKPhIpNLGvaGkhdbtfumGo4tKpn72QUVT0hu4AVKB=s96-c",
34 |     name: "John Doe",
35 |     createdAt: new Date(),
36 |     owner: "user",
37 |   },
38 |   {
39 |     id: "4",
40 |     content:
41 |       "Got it! That makes sense now. Everything looks good—I'll process the payment by Friday.",
42 |     avatarUrl: null,
43 |     name: "Acme Inc",
44 |     createdAt: new Date(),
45 |     owner: "customer",
46 |   },
47 |   {
48 |     id: "5",
49 |     content: "Great, thanks for confirming!",
50 |     avatarUrl:
51 |       "https://lh3.googleusercontent.com/a/ACg8ocLjCbXytBlvKPhIpNLGvaGkhdbtfumGo4tKpn72QUVT0hu4AVKB=s96-c",
52 |     name: "John Doe",
53 |     createdAt: new Date(),
54 |     owner: "user",
55 |   },
56 | ];
57 |
58 | export function InvoiceComments() {
59 |   return (
60 |     <div>
61 |       <div className="flex flex-col space-y-8 mt-6">
62 |         {comments.map((comment) => (
63 |           <div
64 |             key={comment.id}
65 |             className={cn("flex", {
66 |               "justify-end": comment.owner === "user",
67 |               "justify-start": comment.owner === "customer",
68 |             })}
69 |           >
70 |             {comment.owner === "customer" && (
71 |               <Avatar className="size-6 mr-2 mt-auto object-contain border border-border">
72 |                 <AvatarImageNext
73 |                   src={comment.avatarUrl}
74 |                   alt={comment.name ?? ""}
75 |                   width={24}
76 |                   height={24}
77 |                 />
78 |                 <AvatarFallback className="text-[10px] font-medium">
79 |                   {comment.name[0]}
80 |                 </AvatarFallback>
81 |               </Avatar>
82 |             )}
83 |             <div
84 |               className={cn("max-w-[70%] py-3 px-6", {
85 |                 "rounded-tl-full rounded-tr-full rounded-bl-full ring-1 ring-inset ring-border text-primary":
86 |                   comment.owner === "user",
87 |                 "bg-secondary rounded-tr-full rounded-tl-full rounded-br-full text-[#878787]":
88 |                   comment.owner === "customer",
89 |               })}
90 |             >
91 |               <p className="text-xs">{comment.content}</p>
92 |             </div>
93 |
94 |             {comment.owner === "user" && (
95 |               <Avatar className="size-6 ml-2 mt-auto object-contain border border-border">
96 |                 <AvatarImageNext
97 |                   src={comment.avatarUrl}
98 |                   alt={comment.name ?? ""}
99 |                   width={24}
100 |                   height={24}
101 |                 />
102 |                 <AvatarFallback className="text-[10px] font-medium">
103 |                   {comment.name[0]}
104 |                 </AvatarFallback>
105 |               </Avatar>
106 |             )}
107 |           </div>
108 |         ))}
109 |       </div>
110 |
111 |       <div className="absolute bottom-0 left-0 w-full">
112 |         <Textarea
113 |           placeholder="Add a comment"
114 |           className="resize-none border-0 border-t border-border pt-3 h-12 min-h-12"
115 |           autoFocus
116 |         />
117 |
118 |         <div className="hidden todesktop:flex md:flex px-3 h-[40px] w-full border-t-[1px] items-center bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#151515]/[99]">
119 |           <div className="scale-50 opacity-50 -ml-2">
120 |             <Icons.LogoSmall />
121 |           </div>
122 |
123 |           <div className="ml-auto flex space-x-4">
124 |             <button
125 |               className="flex space-x-2 items-center text-sm"
126 |               type="button"
127 |             >
128 |               <kbd className="pointer-events-none size-6 select-none border bg-accent px-1.5 font-mono font-medium">
129 |                 <span>↵</span>
130 |               </kbd>
131 |             </button>
132 |           </div>
133 |         </div>
134 |       </div>
135 |     </div>
136 |   );
137 | }
```

apps/dashboard/src/components/invoice-details.tsx
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { getInvoiceQuery } from "@midday/supabase/queries";
3 | import {
4 |   Accordion,
5 |   AccordionContent,
6 |   AccordionItem,
7 |   AccordionTrigger,
8 | } from "@midday/ui/accordion";
9 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
10 | import { Button } from "@midday/ui/button";
11 | import { cn } from "@midday/ui/cn";
12 | import { Icons } from "@midday/ui/icons";
13 | import { Skeleton } from "@midday/ui/skeleton";
14 | import { format } from "date-fns";
15 | import { useEffect, useState } from "react";
16 | import { CopyInput } from "./copy-input";
17 | import { FormatAmount } from "./format-amount";
18 | import { InvoiceActions } from "./invoice-actions";
19 | import { InvoiceNote } from "./invoice-note";
20 | import { InvoiceStatus } from "./invoice-status";
21 | import { OpenURL } from "./open-url";
22 | import type { Invoice } from "./tables/invoices/columns";
23 |
24 | type Props = {
25 |   id: string;
26 |   data?: Invoice;
27 | };
28 |
29 | export function InvoiceDetails({ id, data: initialData }: Props) {
30 |   const supabase = createClient();
31 |   const [data, setData] = useState<Invoice | null>(initialData ?? null);
32 |   const [loading, setLoading] = useState(false);
33 |
34 |   useEffect(() => {
35 |     async function fetchData() {
36 |       try {
37 |         const { data: invoice } = await getInvoiceQuery(supabase, id);
38 |
39 |         setData(invoice);
40 |         setLoading(false);
41 |       } catch {
42 |         setLoading(false);
43 |       }
44 |     }
45 |
46 |     if (!data && id) {
47 |       fetchData();
48 |     }
49 |   }, [data, id]);
50 |
51 |   useEffect(() => {
52 |     setData(initialData);
53 |   }, [initialData]);
54 |
55 |   if (loading) {
56 |     return (
57 |       <div className="space-y-6">
58 |         <div className="flex justify-between items-center">
59 |           <div className="flex space-x-2 mt-1 items-center">
60 |             <Skeleton className="size-5 rounded-full" />
61 |             <Skeleton className="h-4 w-32" />
62 |           </div>
63 |           <Skeleton className="h-6 w-20" />
64 |         </div>
65 |
66 |         <div className="flex justify-between items-center mt-6 mb-3 relative">
67 |           <div className="flex flex-col w-full space-y-1">
68 |             <Skeleton className="h-10 w-40" />
69 |             <Skeleton className="h-3 w-24" />
70 |           </div>
71 |         </div>
72 |
73 |         <Skeleton className="h-10 w-full" />
74 |
75 |         <div className="mt-8 flex flex-col space-y-1">
76 |           <Skeleton className="h-6 w-48" />
77 |           <Skeleton className="h-4 w-36" />
78 |         </div>
79 |
80 |         <div className="mt-6 flex flex-col space-y-4 border-t border-border pt-6">
81 |           {[...Array(4)].map((_, index) => (
82 |             <div
83 |               key={index.toString()}
84 |               className="flex justify-between items-center"
85 |             >
86 |               <Skeleton className="h-4 w-24" />
87 |               <Skeleton className="h-4 w-32" />
88 |             </div>
89 |           ))}
90 |         </div>
91 |
92 |         <div className="mt-6 flex flex-col space-y-2 border-t border-border pt-6">
93 |           <Skeleton className="h-4 w-24" />
94 |           <div className="flex w-full gap-2">
95 |             <Skeleton className="h-10 flex-1" />
96 |             <Skeleton className="h-10 w-10" />
97 |           </div>
98 |         </div>
99 |
100 |         <div className="mt-6">
101 |           <Skeleton className="h-10 w-full" />
102 |         </div>
103 |       </div>
104 |     );
105 |   }
106 |
107 |   if (!data) {
108 |     return null;
109 |   }
110 |
111 |   const {
112 |     customer,
113 |     amount,
114 |     currency,
115 |     status,
116 |     vat,
117 |     tax,
118 |     paid_at,
119 |     due_date,
120 |     issue_date,
121 |     invoice_number,
122 |     template,
123 |     token,
124 |     internal_note,
125 |     updated_at,
126 |   } = data;
127 |
128 |   return (
129 |     <div>
130 |       <div className="flex justify-between items-center">
131 |         <div className="flex space-x-2 mt-1 items-center">
132 |           <Avatar className="size-5">
133 |             {customer?.website && (
134 |               <AvatarImageNext
135 |                 src={`https://img.logo.dev/${customer?.website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
136 |                 alt={`${customer?.name} logo`}
137 |                 width={20}
138 |                 height={20}
139 |                 quality={100}
140 |               />
141 |             )}
142 |             <AvatarFallback className="text-[9px] font-medium">
143 |               {customer?.name?.[0]}
144 |             </AvatarFallback>
145 |           </Avatar>
146 |
147 |           <span className="text-sm line-clamp-1">{customer?.name}</span>
148 |         </div>
149 |         <InvoiceStatus status={status} />
[TRUNCATED]
```

apps/dashboard/src/components/invoice-header.tsx
```
1 | import { InvoiceSearchFilter } from "@/components/invoice-search-filter";
2 | import { getCustomers } from "@midday/supabase/cached-queries";
3 | import { OpenInvoiceSheet } from "./open-invoice-sheet";
4 |
5 | export async function InvoiceHeader() {
6 |   const customers = await getCustomers();
7 |
8 |   return (
9 |     <div className="flex items-center justify-between">
10 |       <InvoiceSearchFilter customers={customers?.data ?? []} />
11 |
12 |       <div className="hidden sm:block">
13 |         <OpenInvoiceSheet />
14 |       </div>
15 |     </div>
16 |   );
17 | }
```

apps/dashboard/src/components/invoice-note.tsx
```
1 | import { updateInvoiceAction } from "@/actions/invoice/update-invoice-action";
2 | import { Textarea } from "@midday/ui/textarea";
3 | import { useAction } from "next-safe-action/hooks";
4 | import { useState } from "react";
5 |
6 | type Props = {
7 |   id: string;
8 |   defaultValue?: string | null;
9 | };
10 |
11 | export function InvoiceNote({ id, defaultValue }: Props) {
12 |   const [value, setValue] = useState(defaultValue);
13 |   const updateInvoice = useAction(updateInvoiceAction);
14 |
15 |   return (
16 |     <Textarea
17 |       defaultValue={defaultValue ?? ""}
18 |       id="note"
19 |       placeholder="Note"
20 |       className="min-h-[100px] resize-none"
21 |       onBlur={() => {
22 |         if (value !== defaultValue) {
23 |           updateInvoice.execute({
24 |             id,
25 |             internal_note: value && value.length > 0 ? value : null,
26 |           });
27 |         }
28 |       }}
29 |       onChange={(evt) => setValue(evt.target.value)}
30 |     />
31 |   );
32 | }
```

apps/dashboard/src/components/invoice-payment-score.tsx
```
1 | import { getI18n } from "@/locales/server";
2 | import { getPaymentStatus } from "@midday/supabase/cached-queries";
3 | import { Card, CardContent, CardHeader, CardTitle } from "@midday/ui/card";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 | import { PaymentScoreVisualizer } from "./payment-score-visualizer";
6 |
7 | export function InvoicePaymentScoreSkeleton() {
8 |   return (
9 |     <Card>
10 |       <CardHeader className="pb-2 flex flex-row justify-between">
11 |         <CardTitle>
12 |           <Skeleton className="h-8 w-32" />
13 |         </CardTitle>
14 |       </CardHeader>
15 |
16 |       <CardContent>
17 |         <div className="flex flex-col gap-2">
18 |           <Skeleton className="h-5 w-24" />
19 |           <Skeleton className="h-4 w-full" />
20 |         </div>
21 |       </CardContent>
22 |     </Card>
23 |   );
24 | }
25 |
26 | export async function InvoicePaymentScore() {
27 |   const t = await getI18n();
28 |   const {
29 |     data: { payment_status, score },
30 |   } = await getPaymentStatus();
31 |
32 |   return (
33 |     <Card>
34 |       <CardHeader className="pb-2 flex flex-col xl:flex-row justify-between">
35 |         <CardTitle className="font-mono font-medium text-2xl">
36 |           {t(`payment_status.${payment_status}`)}
37 |         </CardTitle>
38 |
39 |         <PaymentScoreVisualizer score={score} paymentStatus={payment_status} />
40 |       </CardHeader>
41 |
42 |       <CardContent className="sm:hidden xl:flex">
43 |         <div className="flex flex-col gap-2">
44 |           <div>Payment score</div>
45 |           <div className="text-sm text-muted-foreground">
46 |             {t(`payment_status_description.${payment_status}`)}
47 |           </div>
48 |         </div>
49 |       </CardContent>
50 |     </Card>
51 |   );
52 | }
```

apps/dashboard/src/components/invoice-search-filter.tsx
```
1 | "use client";
2 |
3 | import { generateInvoiceFilters } from "@/actions/ai/filters/generate-invoice-filters";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import { useI18n } from "@/locales/client";
6 | import { Calendar } from "@midday/ui/calendar";
7 | import { cn } from "@midday/ui/cn";
8 | import {
9 |   DropdownMenu,
10 |   DropdownMenuCheckboxItem,
11 |   DropdownMenuContent,
12 |   DropdownMenuGroup,
13 |   DropdownMenuItem,
14 |   DropdownMenuPortal,
15 |   DropdownMenuSub,
16 |   DropdownMenuSubContent,
17 |   DropdownMenuSubTrigger,
18 |   DropdownMenuTrigger,
19 | } from "@midday/ui/dropdown-menu";
20 | import { Icons } from "@midday/ui/icons";
21 | import { Input } from "@midday/ui/input";
22 | import { readStreamableValue } from "ai/rsc";
23 | import { formatISO } from "date-fns";
24 | import { useRef, useState } from "react";
25 | import { useHotkeys } from "react-hotkeys-hook";
26 | import { FilterList } from "./filter-list";
27 |
28 | const allowedStatuses = ["draft", "overdue", "paid", "unpaid", "canceled"];
29 |
30 | type Props = {
31 |   customers?: {
32 |     id: string | null;
33 |     name: string | null;
34 |   }[];
35 | };
36 |
37 | export function InvoiceSearchFilter({ customers: customersData }: Props) {
38 |   const [prompt, setPrompt] = useState("");
39 |   const inputRef = useRef<HTMLInputElement>(null);
40 |   const [streaming, setStreaming] = useState(false);
41 |   const [isOpen, setIsOpen] = useState(false);
42 |   const { setParams, statuses, start, end, q, customers } = useInvoiceParams({
43 |     shallow: false,
44 |   });
45 |
46 |   const t = useI18n();
47 |
48 |   const statusFilters = allowedStatuses.map((status) => ({
49 |     id: status,
50 |     name: t(`invoice_status.${status}`),
51 |   }));
52 |
53 |   useHotkeys(
54 |     "esc",
55 |     () => {
56 |       setPrompt("");
57 |       setParams(null);
58 |       setIsOpen(false);
59 |     },
60 |     {
61 |       enableOnFormTags: true,
62 |       enabled: Boolean(prompt),
63 |     },
64 |   );
65 |
66 |   useHotkeys("meta+s", (evt) => {
67 |     evt.preventDefault();
68 |     inputRef.current?.focus();
69 |   });
70 |
71 |   useHotkeys("meta+f", (evt) => {
72 |     evt.preventDefault();
73 |     setIsOpen((prev) => !prev);
74 |   });
75 |
76 |   const handleSearch = (evt: React.ChangeEvent<HTMLInputElement>) => {
77 |     const value = evt.target.value;
78 |
79 |     if (value) {
80 |       setPrompt(value);
81 |     } else {
82 |       setParams(null);
83 |       setPrompt("");
84 |     }
85 |   };
86 |
87 |   const handleSubmit = async () => {
88 |     setStreaming(true);
89 |
90 |     const { object } = await generateInvoiceFilters(
91 |       prompt,
92 |       `Invoice payment statuses: ${statusFilters.map((filter) => filter.name).join(", ")}
93 |        Customers: ${customersData?.map((customer) => customer.name).join(", ")}
94 |       `,
95 |     );
96 |
97 |     let finalObject = {};
98 |
99 |     for await (const partialObject of readStreamableValue(object)) {
100 |       if (partialObject) {
101 |         finalObject = {
102 |           ...finalObject,
103 |           statuses: Array.isArray(partialObject?.statuses)
104 |             ? partialObject?.statuses
105 |             : partialObject?.statuses
106 |               ? [partialObject.statuses]
107 |               : null,
108 |           customers:
109 |             partialObject?.customers?.map(
110 |               (name: string) =>
111 |                 customersData?.find((customer) => customer.name === name)?.id,
112 |             ) ?? null,
113 |           q: partialObject?.name ?? null,
114 |           start: partialObject?.start ?? null,
115 |           end: partialObject?.end ?? null,
116 |         };
117 |       }
118 |     }
119 |
120 |     setParams({
121 |       q: null,
122 |       ...finalObject,
123 |     });
124 |
125 |     setStreaming(false);
126 |   };
127 |
128 |   const filters = {
129 |     q,
130 |     end,
131 |     start,
132 |     statuses,
133 |     customers,
134 |   };
135 |
136 |   const hasValidFilters = Object.values(filters).some(
137 |     (value) => value !== null,
138 |   );
139 |
140 |   return (
141 |     <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>
142 |       <div className="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0 items-start sm:items-center w-full">
143 |         <form
144 |           className="relative w-full sm:w-auto"
145 |           onSubmit={(e) => {
146 |             e.preventDefault();
147 |             handleSubmit();
148 |           }}
149 |         >
150 |           <Icons.Search className="absolute pointer-events-none left-3 top-[11px]" />
151 |           <Input
152 |             ref={inputRef}
153 |             placeholder="Search or filter"
154 |             className="pl-9 w-full sm:w-[350px] pr-8"
155 |             value={prompt}
156 |             onChange={handleSearch}
157 |             autoComplete="off"
158 |             autoCapitalize="none"
159 |             autoCorrect="off"
160 |             spellCheck="false"
161 |           />
162 |
163 |           <DropdownMenuTrigger asChild>
164 |             <button
165 |               onClick={() => setIsOpen((prev) => !prev)}
166 |               type="button"
167 |               className={cn(
168 |                 "absolute z-10 right-3 top-[10px] opacity-50 transition-opacity duration-300 hover:opacity-100",
169 |                 hasValidFilters && "opacity-100",
170 |                 isOpen && "opacity-100",
171 |               )}
172 |             >
173 |               <Icons.Filter />
174 |             </button>
175 |           </DropdownMenuTrigger>
[TRUNCATED]
```

apps/dashboard/src/components/invoice-status.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { cn } from "@midday/ui/cn";
5 | import { Skeleton } from "@midday/ui/skeleton";
6 |
7 | export function InvoiceStatus({
8 |   status,
9 |   isLoading,
10 |   className,
11 | }: {
12 |   status: "draft" | "overdue" | "paid" | "unpaid" | "canceled";
13 |   isLoading?: boolean;
14 |   className?: string;
15 | }) {
16 |   const t = useI18n();
17 |
18 |   if (isLoading) {
19 |     return <Skeleton className="w-24 h-6 rounded-full" />;
20 |   }
21 |
22 |   return (
23 |     <div
24 |       className={cn(
25 |         "px-2 py-0.5 rounded-full cursor-default font-mono inline-flex max-w-full text-[11px]",
26 |         (status === "draft" || status === "canceled") &&
27 |           "text-[#878787] bg-[#F2F1EF] text-[10px] dark:text-[#878787] dark:bg-[#1D1D1D]",
28 |         status === "overdue" &&
29 |           "bg-[#FFD02B]/10 text-[#FFD02B] dark:bg-[#FFD02B]/10 dark:text-[#FFD02B]",
30 |         status === "paid" &&
31 |           "text-[#00C969] bg-[#DDF1E4] dark:text-[#00C969] dark:bg-[#00C969]/10",
32 |         status === "unpaid" &&
33 |           "text-[#1D1D1D] bg-[#878787]/10 dark:text-[#F5F5F3] dark:bg-[#F5F5F3]/10",
34 |         className,
35 |       )}
36 |     >
37 |       <span className="line-clamp-1 truncate inline-block">
38 |         {t(`invoice_status.${status}`)}
39 |       </span>
40 |     </div>
41 |   );
42 | }
```

apps/dashboard/src/components/invoice-successful.tsx
```
1 | import { formatEditorContent } from "@midday/invoice/format-to-html";
2 | import { Button } from "@midday/ui/button";
3 | import { Icons } from "@midday/ui/icons";
4 | import { format } from "date-fns";
5 | import { motion } from "framer-motion";
6 | import { CopyInput } from "./copy-input";
7 | import { FormatAmount } from "./format-amount";
8 | import type { Invoice } from "./tables/invoices/columns";
9 |
10 | type Props = {
11 |   invoice: Invoice;
12 | };
13 |
14 | function CustomerDetails({ content }: { content: JSON }) {
15 |   return (
16 |     <div className="font-mono text-[#878787]">
17 |       {formatEditorContent(content)}
18 |     </div>
19 |   );
20 | }
21 |
22 | export function InvoiceSuccessful({ invoice }: Props) {
23 |   return (
24 |     <div className="bg-[#F2F2F2] dark:bg-background p-6 relative">
25 |       <motion.div
26 |         initial={{ opacity: 0 }}
27 |         animate={{ opacity: 1 }}
28 |         transition={{ duration: 0.3 }}
29 |         className="flex items-center justify-between mb-6"
30 |       >
31 |         <div className="flex space-x-1 items-center">
32 |           <div className="flex items-center">
33 |             <span className="text-[11px] text-[#878787] font-mono">
34 |               {invoice.template.invoice_no_label}
35 |             </span>
36 |             <span className="text-[11px] text-[#878787] font-mono">:</span>
37 |           </div>
38 |
39 |           <span className="font-mono text-[11px]">
40 |             {invoice.invoice_number}
41 |           </span>
42 |         </div>
43 |
44 |         <div className="flex space-x-1 items-center">
45 |           <div className="flex items-center">
46 |             <span className="text-[11px] text-[#878787] font-mono">
47 |               {invoice.template.due_date_label}
48 |             </span>
49 |             <span className="text-[11px] text-[#878787] font-mono">:</span>
50 |           </div>
51 |
52 |           <span className="font-mono text-[11px]">
53 |             {format(new Date(invoice.due_date), invoice.template.date_format)}
54 |           </span>
55 |         </div>
56 |       </motion.div>
57 |
58 |       <motion.div
59 |         initial={{ opacity: 0 }}
60 |         animate={{ opacity: 1 }}
61 |         transition={{ delay: 0.2, duration: 0.3 }}
62 |       >
63 |         <span className="text-[11px] font-mono">
64 |           {invoice.template.customer_label}
65 |         </span>
66 |         <CustomerDetails content={invoice.customer_details} />
67 |       </motion.div>
68 |
69 |       <motion.div
70 |         initial={{ opacity: 0 }}
71 |         animate={{ opacity: 1 }}
72 |         transition={{ delay: 0.4, duration: 0.3 }}
73 |         className="flex items-center justify-between mt-10 border-b border-border border-dashed pb-4"
74 |       >
75 |         <span className="text-[11px] text-[#878787] font-mono">
76 |           {invoice.template.total_summary_label}
77 |         </span>
78 |
79 |         <span className="font-mono text-xl">
80 |           <FormatAmount amount={invoice.amount} currency={invoice.currency} />
81 |         </span>
82 |       </motion.div>
83 |
84 |       <motion.div
85 |         initial={{ opacity: 0 }}
86 |         animate={{ opacity: 1 }}
87 |         transition={{ delay: 0.4, duration: 0.3 }}
88 |         className="flex flex-col space-y-6 mt-10 mb-6"
89 |       >
90 |         <h2>Details</h2>
91 |
92 |         {invoice.sent_to && (
93 |           <div className="flex flex-col space-y-1">
94 |             <span className="text-[11px] text-[#878787] font-mono">
95 |               Invoice sent to
96 |             </span>
97 |             <span className="text-sm">{invoice.sent_to}</span>
98 |           </div>
99 |         )}
100 |
101 |         <div>
102 |           <span className="text-[11px] text-[#878787] font-mono">
103 |             Share link
104 |           </span>
105 |           <div className="flex w-full gap-2 mt-1">
106 |             <div className="flex-1 min-w-0">
107 |               <CopyInput
108 |                 value={`${window.location.origin}/i/${invoice.token}`}
109 |               />
110 |             </div>
111 |
112 |             <a
113 |               href={`/api/download/invoice?id=${invoice.id}&size=${invoice.template.size}`}
114 |               download
115 |             >
116 |               <Button
117 |                 variant="secondary"
118 |                 className="size-[40px] hover:bg-secondary shrink-0"
119 |               >
120 |                 <div>
121 |                   <Icons.Download className="size-4" />
122 |                 </div>
123 |               </Button>
124 |             </a>
125 |           </div>
126 |         </div>
127 |       </motion.div>
128 |
129 |       <motion.div
130 |         initial={{ opacity: 0 }}
131 |         animate={{ opacity: 1 }}
132 |         transition={{ delay: 0.4, duration: 0.3 }}
133 |         className="flex flex-wrap gap-3 absolute -bottom-[15px] left-0 right-0 w-full justify-center"
134 |       >
135 |         {Array.from({ length: 10 }).map((_, index) => (
136 |           <div
137 |             key={index.toString()}
[TRUNCATED]
```

apps/dashboard/src/components/invoice-summary.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { Card, CardContent, CardHeader, CardTitle } from "@midday/ui/card";
5 | import { cn } from "@midday/ui/cn";
6 | import { Skeleton } from "@midday/ui/skeleton";
7 | import { useState } from "react";
8 | import { AnimatedNumber } from "./animated-number";
9 |
10 | type Props = {
11 |   data: any[];
12 |   totalInvoiceCount: number;
13 |   defaultCurrency: string;
14 |   title: string;
15 |   locale: string;
16 | };
17 |
18 | export function InvoiceSummarySkeleton() {
19 |   return (
20 |     <Card>
21 |       <CardHeader className="pb-2">
22 |         <CardTitle>
23 |           <Skeleton className="h-8 w-32" />
24 |         </CardTitle>
25 |       </CardHeader>
26 |
27 |       <CardContent>
28 |         <div className="flex flex-col gap-2">
29 |           <Skeleton className="h-5 w-16" />
30 |           <Skeleton className="h-4 w-24" />
31 |         </div>
32 |       </CardContent>
33 |     </Card>
34 |   );
35 | }
36 |
37 | export function InvoiceSummary({
38 |   data,
39 |   totalInvoiceCount,
40 |   defaultCurrency,
41 |   title,
42 | }: Props) {
43 |   const t = useI18n();
44 |   const [activeIndex, setActiveIndex] = useState(0);
45 |
46 |   const dataWithDefaultCurrency = data.length
47 |     ? data
48 |     : [{ currency: defaultCurrency, total_amount: 0 }];
49 |
50 |   const item = dataWithDefaultCurrency[activeIndex];
51 |
52 |   return (
53 |     <Card>
54 |       <CardHeader className="pb-2 relative">
55 |         <CardTitle className="font-mono font-medium text-2xl">
56 |           <AnimatedNumber
57 |             key={item.currency}
58 |             value={item.total_amount}
59 |             currency={item.currency}
60 |             maximumFractionDigits={0}
61 |             minimumFractionDigits={0}
62 |           />
63 |
64 |           {dataWithDefaultCurrency.length > 1 && (
65 |             <div className="flex space-x-2 top-[63px] absolute">
66 |               {dataWithDefaultCurrency.map((item, idx) => (
67 |                 <button
68 |                   type="button"
69 |                   key={item.currency}
70 |                   onMouseEnter={() => setActiveIndex(idx)}
71 |                   onClick={() => setActiveIndex(idx)}
72 |                   className={cn(
73 |                     "w-[10px] h-[3px] bg-[#1D1D1D] dark:bg-[#D9D9D9] opacity-30 transition-all",
74 |                     idx === activeIndex && "opacity-100",
75 |                   )}
76 |                 />
77 |               ))}
78 |             </div>
79 |           )}
80 |         </CardTitle>
81 |       </CardHeader>
82 |
83 |       <CardContent>
84 |         <div className="flex flex-col gap-2">
85 |           <div>{title}</div>
86 |           <div className="text-sm text-muted-foreground">
87 |             {t("invoice_count", {
88 |               count: totalInvoiceCount ?? 0,
89 |             })}
90 |           </div>
91 |         </div>
92 |       </CardContent>
93 |     </Card>
94 |   );
95 | }
```

apps/dashboard/src/components/invoice-toolbar.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   Tooltip,
7 |   TooltipContent,
8 |   TooltipProvider,
9 |   TooltipTrigger,
10 | } from "@midday/ui/tooltip";
11 | import { motion } from "framer-motion";
12 | import {
13 |   MdChatBubbleOutline,
14 |   MdContentCopy,
15 |   MdOutlineFileDownload,
16 | } from "react-icons/md";
17 | import { InvoiceViewers } from "./invoice-viewers";
18 |
19 | export type Customer = {
20 |   name: string;
21 |   website?: string;
22 | };
23 |
24 | type Props = {
25 |   id: string;
26 |   size: "letter" | "a4";
27 |   customer: Customer;
28 |   viewedAt?: string;
29 | };
30 |
31 | export default function InvoiceToolbar({
32 |   id,
33 |   size,
34 |   customer,
35 |   viewedAt,
36 | }: Props) {
37 |   const { setParams } = useInvoiceParams();
38 |
39 |   const handleCopyLink = () => {
40 |     const url = window.location.href;
41 |     navigator.clipboard.writeText(url);
42 |   };
43 |
44 |   return (
45 |     <motion.div
46 |       className="fixed inset-x-0 -bottom-1 flex justify-center"
47 |       initial={{ opacity: 0, filter: "blur(8px)", y: 0 }}
48 |       animate={{ opacity: 1, filter: "blur(0px)", y: -24 }}
49 |       transition={{ type: "spring", stiffness: 300, damping: 25 }}
50 |     >
51 |       <div className="backdrop-filter backdrop-blur-lg dark:bg-[#1A1A1A]/80 bg-[#F6F6F3]/80 rounded-full pl-2 pr-4 py-3 h-10 flex items-center justify-center border-[0.5px] border-border">
52 |         <TooltipProvider delayDuration={0}>
53 |           <Tooltip>
54 |             <TooltipTrigger asChild>
55 |               <a href={`/api/download/invoice?id=${id}&size=${size}`} download>
56 |                 <Button
57 |                   variant="ghost"
58 |                   size="icon"
59 |                   className="rounded-full size-8"
60 |                 >
61 |                   <MdOutlineFileDownload className="size-[18px]" />
62 |                 </Button>
63 |               </a>
64 |             </TooltipTrigger>
65 |             <TooltipContent
66 |               sideOffset={15}
67 |               className="text-[10px] px-2 py-1 rounded-sm font-medium"
68 |             >
69 |               <p>Download</p>
70 |             </TooltipContent>
71 |           </Tooltip>
72 |         </TooltipProvider>
73 |
74 |         <TooltipProvider delayDuration={0}>
75 |           <Tooltip>
76 |             <TooltipTrigger asChild>
77 |               <Button
78 |                 variant="ghost"
79 |                 size="icon"
80 |                 className="rounded-full size-8"
81 |                 onClick={handleCopyLink}
82 |               >
83 |                 <MdContentCopy />
84 |               </Button>
85 |             </TooltipTrigger>
86 |             <TooltipContent
87 |               sideOffset={15}
88 |               className="text-[10px] px-2 py-1 rounded-sm font-medium"
89 |             >
90 |               <p>Copy link</p>
91 |             </TooltipContent>
92 |           </Tooltip>
93 |         </TooltipProvider>
94 |
95 |         {/* <TooltipProvider delayDuration={0}>
96 |           <Tooltip>
97 |             <TooltipTrigger asChild>
98 |               <Button
99 |                 variant="ghost"
100 |                 size="icon"
101 |                 className="rounded-full size-8 relative"
102 |                 onClick={() => setParams({ type: "comments", invoiceId: id })}
103 |               >
104 |                 <div className="rounded-full size-1 absolute bg-[#FFD02B] right-[3px] top-[3px] ring-2 ring-background">
105 |                   <div className="absolute inset-0 rounded-full bg-[#FFD02B] animate-[ping_1s_ease-in-out_5]" />
106 |                   <div className="absolute inset-0 rounded-full bg-[#FFD02B] animate-[pulse_1s_ease-in-out_5] opacity-75" />
107 |                   <div className="absolute inset-0 rounded-full bg-[#FFD02B] animate-[pulse_1s_ease-in-out_5] opacity-50" />
108 |                 </div>
109 |                 <MdChatBubbleOutline />
110 |               </Button>
111 |             </TooltipTrigger>
112 |             <TooltipContent
113 |               sideOffset={15}
114 |               className="text-[10px] px-2 py-1 rounded-sm font-medium"
115 |             >
116 |               <p>Comment</p>
117 |             </TooltipContent>
118 |           </Tooltip>
119 |         </TooltipProvider> */}
120 |
121 |         <InvoiceViewers customer={customer} viewedAt={viewedAt} />
122 |       </div>
123 |     </motion.div>
124 |   );
125 | }
```

apps/dashboard/src/components/invoice-viewers.tsx
```
1 | "use client";
2 |
3 | import { formatRelativeTime } from "@/utils/format";
4 | import { createClient } from "@midday/supabase/client";
5 | import { AnimatedSizeContainer } from "@midday/ui/animated-size-container";
6 | import {
7 |   Avatar,
8 |   AvatarFallback,
9 |   AvatarImage,
10 |   AvatarImageNext,
11 | } from "@midday/ui/avatar";
12 | import { Separator } from "@midday/ui/separator";
13 | import {
14 |   Tooltip,
15 |   TooltipContent,
16 |   TooltipProvider,
17 |   TooltipTrigger,
18 | } from "@midday/ui/tooltip";
19 | import { motion } from "framer-motion";
20 | import { useEffect, useState } from "react";
21 | import type { Customer } from "./invoice-toolbar";
22 |
23 | interface User {
24 |   id: string;
25 |   avatar_url: string | null;
26 |   full_name: string | null;
27 | }
28 |
29 | type Props = {
30 |   customer: Customer;
31 |   viewedAt: string;
32 | };
33 |
34 | export function InvoiceViewers({ customer, viewedAt }: Props) {
35 |   const [currentUser, setCurrentUser] = useState<User | null>(null);
36 |   const supabase = createClient();
37 |
38 |   useEffect(() => {
39 |     async function fetchCurrentUser() {
40 |       const {
41 |         data: { user },
42 |       } = await supabase.auth.getUser();
43 |       if (user) {
44 |         setCurrentUser({
45 |           id: user.id,
46 |           avatar_url: user.user_metadata.avatar_url,
47 |           full_name: user.user_metadata.full_name,
48 |         });
49 |       }
50 |     }
51 |
52 |     fetchCurrentUser();
53 |   }, []);
54 |
55 |   if (!currentUser) {
56 |     return null;
57 |   }
58 |
59 |   return (
60 |     <AnimatedSizeContainer width>
61 |       <motion.div
62 |         className="flex items-center"
63 |         initial={{ width: 0, opacity: 0 }}
64 |         animate={{ width: "auto", opacity: 1 }}
65 |         transition={{ duration: 0.3, ease: "easeInOut", delay: 0.5 }}
66 |       >
67 |         <Separator orientation="vertical" className="mr-3 ml-2 h-4" />
68 |
69 |         {currentUser && (
70 |           <div className="mr-2">
71 |             <TooltipProvider delayDuration={0}>
72 |               <Tooltip>
73 |                 <TooltipTrigger asChild>
74 |                   <Avatar className="size-5 object-contain border border-border">
75 |                     <AvatarImageNext
76 |                       src={currentUser.avatar_url}
77 |                       alt={currentUser.full_name ?? ""}
78 |                       width={20}
79 |                       height={20}
80 |                     />
81 |                     <AvatarFallback className="text-[9px] font-medium">
82 |                       {currentUser.full_name?.[0]}
83 |                     </AvatarFallback>
84 |                   </Avatar>
85 |                 </TooltipTrigger>
86 |                 <TooltipContent
87 |                   sideOffset={20}
88 |                   className="text-[10px] px-2 py-1 rounded-sm font-medium"
89 |                 >
90 |                   <p>just now</p>
91 |                 </TooltipContent>
92 |               </Tooltip>
93 |             </TooltipProvider>
94 |           </div>
95 |         )}
96 |
97 |         {customer?.name && (
98 |           <TooltipProvider delayDuration={0}>
99 |             <Tooltip>
100 |               <TooltipTrigger asChild>
101 |                 <Avatar className="size-5 object-contain border border-border">
102 |                   {customer?.website && (
103 |                     <AvatarImageNext
104 |                       src={`https://img.logo.dev/${customer.website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
105 |                       alt={`${customer.name} logo`}
106 |                       width={20}
107 |                       height={20}
108 |                       quality={100}
109 |                     />
110 |                   )}
111 |                   <AvatarFallback className="text-[9px] font-medium">
112 |                     {customer.name?.[0]}
113 |                   </AvatarFallback>
114 |                 </Avatar>
115 |               </TooltipTrigger>
116 |
117 |               <TooltipContent
118 |                 sideOffset={20}
119 |                 className="text-[10px] px-2 py-1 rounded-sm font-medium"
120 |               >
121 |                 {viewedAt
122 |                   ? formatRelativeTime(new Date(viewedAt))
123 |                   : "Not viewed"}
124 |               </TooltipContent>
125 |             </Tooltip>
126 |           </TooltipProvider>
127 |         )}
128 |       </motion.div>
129 |     </AnimatedSizeContainer>
130 |   );
131 | }
```

apps/dashboard/src/components/invoices-open.tsx
```
1 | import { getInvoiceSummary } from "@midday/supabase/cached-queries";
2 | import Link from "next/link";
3 | import { InvoiceSummary } from "./invoice-summary";
4 |
5 | type Props = {
6 |   defaultCurrency: string;
7 | };
8 |
9 | export async function InvoicesOpen({ defaultCurrency }: Props) {
10 |   const { data } = await getInvoiceSummary();
11 |   const totalInvoiceCount = data?.reduce(
12 |     (acc, curr) => acc + (curr.invoice_count ?? 0),
13 |     0,
14 |   );
15 |
16 |   return (
17 |     <Link
18 |       href="/invoices?statuses=draft,overdue,unpaid"
19 |       className="hidden sm:block"
20 |     >
21 |       <InvoiceSummary
22 |         data={data}
23 |         totalInvoiceCount={totalInvoiceCount}
24 |         defaultCurrency={defaultCurrency}
25 |         title="Open"
26 |       />
27 |     </Link>
28 |   );
29 | }
```

apps/dashboard/src/components/invoices-overdue.tsx
```
1 | import { getInvoiceSummary } from "@midday/supabase/cached-queries";
2 | import Link from "next/link";
3 | import { InvoiceSummary } from "./invoice-summary";
4 |
5 | type Props = {
6 |   defaultCurrency: string;
7 | };
8 |
9 | export async function InvoicesOverdue({ defaultCurrency }: Props) {
10 |   const { data } = await getInvoiceSummary({ status: "overdue" });
11 |
12 |   const totalInvoiceCount = data?.at(0)?.invoice_count;
13 |
14 |   return (
15 |     <Link href="/invoices?statuses=overdue" className="hidden sm:block">
16 |       <InvoiceSummary
17 |         data={data}
18 |         totalInvoiceCount={totalInvoiceCount}
19 |         defaultCurrency={defaultCurrency}
20 |         title="Overdue"
21 |       />
22 |     </Link>
23 |   );
24 | }
```

apps/dashboard/src/components/invoices-paid.tsx
```
1 | import { getInvoiceSummary } from "@midday/supabase/cached-queries";
2 | import Link from "next/link";
3 | import { InvoiceSummary } from "./invoice-summary";
4 |
5 | type Props = {
6 |   defaultCurrency: string;
7 | };
8 |
9 | export async function InvoicesPaid({ defaultCurrency }: Props) {
10 |   const { data } = await getInvoiceSummary({ status: "paid" });
11 |
12 |   const totalInvoiceCount = data?.at(0)?.invoice_count;
13 |
14 |   return (
15 |     <Link href="/invoices?statuses=paid" className="hidden sm:block">
16 |       <InvoiceSummary
17 |         data={data}
18 |         totalInvoiceCount={totalInvoiceCount}
19 |         defaultCurrency={defaultCurrency}
20 |         title="Paid"
21 |       />
22 |     </Link>
23 |   );
24 | }
```

apps/dashboard/src/components/loading-transactions-event.tsx
```
1 | import { useInitialConnectionStatus } from "@/hooks/use-initial-connection-status";
2 | import { Button } from "@midday/ui/button";
3 | import { cn } from "@midday/ui/cn";
4 | import { useTheme } from "next-themes";
5 | import dynamic from "next/dynamic";
6 | import { useEffect, useState } from "react";
7 |
8 | const Lottie = dynamic(() => import("lottie-react"), {
9 |   ssr: false,
10 | });
11 |
12 | type Props = {
13 |   accessToken?: string;
14 |   runId?: string;
15 |   setRunId: (runId?: string) => void;
16 |   onClose: () => void;
17 |   setActiveTab: (value: "support" | "loading" | "select-accounts") => void;
18 | };
19 |
20 | export function LoadingTransactionsEvent({
21 |   accessToken,
22 |   runId,
23 |   setRunId,
24 |   onClose,
25 |   setActiveTab,
26 | }: Props) {
27 |   const [step, setStep] = useState(1);
28 |   const { resolvedTheme } = useTheme();
29 |
30 |   const { status } = useInitialConnectionStatus({
31 |     runId,
32 |     accessToken,
33 |   });
34 |
35 |   useEffect(() => {
36 |     if (status === "SYNCING") {
37 |       setStep(2);
38 |     }
39 |
40 |     if (status === "COMPLETED") {
41 |       setStep(3);
42 |
43 |       setTimeout(() => {
44 |         setRunId(undefined);
45 |         setStep(4);
46 |       }, 1000);
47 |     }
48 |   }, [status]);
49 |
50 |   return (
51 |     <div className="w-full">
52 |       <Lottie
53 |         className="mb-6"
54 |         animationData={
55 |           resolvedTheme === "dark"
56 |             ? require("public/assets/setup-animation.json")
57 |             : require("public/assets/setup-animation-dark.json")
58 |         }
59 |         loop={true}
60 |         style={{ width: 50, height: 50 }}
61 |         rendererSettings={{
62 |           preserveAspectRatio: "xMidYMid slice",
63 |         }}
64 |       />
65 |       <h2 className="text-lg font-semibold leading-none tracking-tight mb-2">
66 |         Setting up account
67 |       </h2>
68 |
69 |       <p className="text-sm text-[#878787] mb-8">
70 |         Depending on the bank it can take up to 1 hour to fetch all
71 |         transactions, feel free to close this window and we will notify you when
72 |         it is done.
73 |       </p>
74 |
75 |       <ul className="text-md text-[#878787] space-y-4 transition-all">
76 |         <li
77 |           className={cn(
78 |             "opacity-50 dark:opacity-20",
79 |             step > 0 && "!opacity-100",
80 |           )}
81 |         >
82 |           Connecting bank
83 |           {step === 1 && <span className="loading-ellipsis" />}
84 |         </li>
85 |         <li
86 |           className={cn(
87 |             "opacity-50 dark:opacity-20",
88 |             step > 1 && "!opacity-100",
89 |           )}
90 |         >
91 |           Getting transactions
92 |           {step === 2 && <span className="loading-ellipsis" />}
93 |         </li>
94 |         <li
95 |           className={cn(
96 |             "opacity-50 dark:opacity-20",
97 |             step > 2 && "!opacity-100",
98 |           )}
99 |         >
100 |           Completed
101 |           {step === 3 && <span className="loading-ellipsis" />}
102 |         </li>
103 |       </ul>
104 |
105 |       <div className="w-full mt-12">
106 |         <Button className="w-full" onClick={onClose}>
107 |           Close
108 |         </Button>
109 |
110 |         <div className="flex justify-center mt-4">
111 |           <button
112 |             type="button"
113 |             className="text-xs text-[#878787]"
114 |             onClick={() => setActiveTab("support")}
115 |           >
116 |             Need support
117 |           </button>
118 |         </div>
119 |       </div>
120 |     </div>
121 |   );
122 | }
```

apps/dashboard/src/components/locale-settings.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import { useI18n } from "@/locales/client";
5 | import { countries } from "@midday/location/countries-intl";
6 | import {
7 |   Card,
8 |   CardContent,
9 |   CardDescription,
10 |   CardHeader,
11 |   CardTitle,
12 | } from "@midday/ui/card";
13 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
14 | import { useOptimisticAction } from "next-safe-action/hooks";
15 |
16 | type Props = {
17 |   locale: string;
18 | };
19 |
20 | export function LocaleSettings({ locale }: Props) {
21 |   const t = useI18n();
22 |
23 |   const { execute, optimisticState } = useOptimisticAction(updateUserAction, {
24 |     currentState: { locale },
25 |     updateFn: (state, newLocale) => {
26 |       return {
27 |         locale: newLocale.locale ?? state.locale,
28 |       };
29 |     },
30 |   });
31 |
32 |   const localeItems = Object.values(countries).map((c, index) => ({
33 |     id: index.toString(),
34 |     label: `${c.name} (${c.default_locale})`,
35 |     value: c.default_locale,
36 |   }));
37 |
38 |   return (
39 |     <Card className="flex justify-between items-center">
40 |       <CardHeader>
41 |         <CardTitle>{t("locale.title")}</CardTitle>
42 |         <CardDescription>{t("locale.description")}</CardDescription>
43 |       </CardHeader>
44 |
45 |       <CardContent>
46 |         <div className="w-[250px]">
47 |           <ComboboxDropdown
48 |             placeholder={t("locale.placeholder")}
49 |             selectedItem={localeItems.find(
50 |               (item) => item.value === optimisticState.locale,
51 |             )}
52 |             searchPlaceholder={t("locale.searchPlaceholder")}
53 |             items={localeItems}
54 |             className="text-xs py-1"
55 |             onSelect={(item) => {
56 |               execute({ locale: item.value });
57 |             }}
58 |           />
59 |         </div>
60 |       </CardContent>
61 |     </Card>
62 |   );
63 | }
```

apps/dashboard/src/components/main-menu.tsx
```
1 | "use client";
2 |
3 | import { updateMenuAction } from "@/actions/update-menu-action";
4 | import { useMenuStore } from "@/store/menu";
5 | import { Button } from "@midday/ui/button";
6 | import { cn } from "@midday/ui/cn";
7 | import { Icons } from "@midday/ui/icons";
8 | import {
9 |   Tooltip,
10 |   TooltipContent,
11 |   TooltipProvider,
12 |   TooltipTrigger,
13 | } from "@midday/ui/tooltip";
14 | import { useClickAway } from "@uidotdev/usehooks";
15 | import { Reorder, motion, useMotionValue } from "framer-motion";
16 | import { useAction } from "next-safe-action/hooks";
17 | import Link from "next/link";
18 | import { usePathname } from "next/navigation";
19 | import { useState } from "react";
20 | import { useLongPress } from "use-long-press";
21 |
22 | const icons = {
23 |   "/": () => <Icons.Overview size={22} />,
24 |   "/transactions": () => <Icons.Transactions size={22} />,
25 |   "/invoices": () => <Icons.Invoice size={22} />,
26 |   "/tracker": () => <Icons.Tracker size={22} />,
27 |   "/customers": () => <Icons.Customers size={22} />,
28 |   "/vault": () => <Icons.Vault size={22} />,
29 |   "/settings": () => <Icons.Settings size={22} />,
30 |   "/apps": () => <Icons.Apps size={22} />,
31 |   "/inbox": () => <Icons.Inbox2 size={22} />,
32 | };
33 |
34 | const defaultItems = [
35 |   {
36 |     path: "/",
37 |     name: "Overview",
38 |   },
39 |   {
40 |     path: "/inbox",
41 |     name: "Inbox",
42 |   },
43 |   {
44 |     path: "/transactions",
45 |     name: "Transactions",
46 |   },
47 |   {
48 |     path: "/invoices",
49 |     name: "Invoices",
50 |   },
51 |   {
52 |     path: "/tracker",
53 |     name: "Tracker",
54 |   },
55 |   {
56 |     path: "/customers",
57 |     name: "Customers",
58 |   },
59 |   {
60 |     path: "/vault",
61 |     name: "Vault",
62 |   },
63 |   {
64 |     path: "/apps",
65 |     name: "Apps",
66 |   },
67 |   {
68 |     path: "/settings",
69 |     name: "Settings",
70 |   },
71 | ];
72 |
73 | interface ItemProps {
74 |   item: { path: string; name: string };
75 |   isActive: boolean;
76 |   isCustomizing: boolean;
77 |   onRemove: (path: string) => void;
78 |   disableRemove: boolean;
79 |   onDragEnd: () => void;
80 |   onSelect?: () => void;
81 | }
82 |
83 | const Item = ({
84 |   item,
85 |   isActive,
86 |   isCustomizing,
87 |   onRemove,
88 |   disableRemove,
89 |   onDragEnd,
90 |   onSelect,
91 | }: ItemProps) => {
92 |   const y = useMotionValue(0);
93 |   const Icon = icons[item.path];
94 |
95 |   return (
96 |     <TooltipProvider delayDuration={70}>
97 |       <Link
98 |         prefetch
99 |         href={item.path}
100 |         onClick={(evt) => {
101 |           if (isCustomizing) {
102 |             evt.preventDefault();
103 |           }
104 |
105 |           onSelect?.();
106 |         }}
107 |         onMouseDown={(evt) => {
108 |           if (isCustomizing) {
109 |             evt.preventDefault();
110 |           }
111 |         }}
112 |       >
113 |         <Tooltip>
114 |           <TooltipTrigger className="w-full">
115 |             <Reorder.Item
116 |               onDragEnd={onDragEnd}
117 |               key={item.path}
118 |               value={item}
119 |               id={item.path}
120 |               style={{ y }}
121 |               layoutRoot
122 |               className={cn(
123 |                 "relative border border-transparent md:w-[45px] h-[45px] flex items-center md:justify-center",
124 |                 "hover:bg-accent hover:border-[#DCDAD2] hover:dark:border-[#2C2C2C]",
125 |                 isActive &&
126 |                   "bg-[#F2F1EF] dark:bg-secondary border-[#DCDAD2] dark:border-[#2C2C2C]",
127 |                 isCustomizing &&
128 |                   "bg-background border-[#DCDAD2] dark:border-[#2C2C2C]",
129 |               )}
130 |             >
131 |               <motion.div
132 |                 className="relative"
133 |                 initial={{ opacity: 1 }}
134 |                 animate={{ opacity: 1 }}
135 |                 exit={{ opacity: 0 }}
136 |               >
137 |                 {!disableRemove && isCustomizing && (
138 |                   <Button
139 |                     onClick={() => onRemove(item.path)}
140 |                     variant="ghost"
141 |                     size="icon"
142 |                     className="absolute -left-4 -top-4 w-4 h-4 p-0 rounded-full bg-border hover:bg-border hover:scale-150 z-10 transition-all"
143 |                   >
144 |                     <Icons.Remove className="w-3 h-3" />
145 |                   </Button>
146 |                 )}
147 |
148 |                 <div
149 |                   className={cn(
150 |                     "flex space-x-3 p-0 items-center pl-2 md:pl-0",
151 |                     isCustomizing &&
152 |                       "animate-[jiggle_0.3s_ease-in-out_infinite] transform-gpu pointer-events-none",
153 |                   )}
154 |                 >
155 |                   <Icon />
156 |                   <span className="flex md:hidden">{item.name}</span>
157 |                 </div>
158 |               </motion.div>
159 |             </Reorder.Item>
160 |           </TooltipTrigger>
161 |           <TooltipContent
162 |             side="left"
163 |             className="px-3 py-1.5 text-xs hidden md:flex"
164 |             sideOffset={10}
165 |           >
166 |             {item.name}
167 |           </TooltipContent>
168 |         </Tooltip>
169 |       </Link>
170 |     </TooltipProvider>
171 |   );
172 | };
173 |
174 | const listVariant = {
175 |   hidden: { opacity: 0 },
[TRUNCATED]
```

apps/dashboard/src/components/manual-accounts.tsx
```
1 | import { BankAccount } from "./bank-account";
2 |
3 | export function ManualAccounts({ data }) {
4 |   return (
5 |     <div className="px-6 pb-6 space-y-6 divide-y">
6 |       {data.map((account) => (
7 |         <BankAccount
8 |           key={account.id}
9 |           id={account.id}
10 |           name={account.name}
11 |           manual={account.manual}
12 |           currency={account.currency}
13 |           type={account.type}
14 |           enabled
15 |           balance={account.balance}
16 |         />
17 |       ))}
18 |     </div>
19 |   );
20 | }
```

apps/dashboard/src/components/markdown.tsx
```
1 | import { type FC, memo } from "react";
2 | import ReactMarkdown, { type Options } from "react-markdown";
3 |
4 | export const MemoizedReactMarkdown: FC<Options> = memo(
5 |   ReactMarkdown,
6 |   (prevProps, nextProps) =>
7 |     prevProps.children === nextProps.children &&
8 |     prevProps.className === nextProps.className
9 | );
```

apps/dashboard/src/components/mfa-list.tsx
```
1 | import { getI18n } from "@/locales/server";
2 | import { createClient } from "@midday/supabase/server";
3 | import { Skeleton } from "@midday/ui/skeleton";
4 | import { format } from "date-fns";
5 | import { RemoveMFAButton } from "./remove-mfa-button";
6 |
7 | export function MFAListSkeleton() {
8 |   return (
9 |     <div className="flex justify-between items-center h-[36px]">
10 |       <Skeleton className="h-4 w-[200px]" />
11 |     </div>
12 |   );
13 | }
14 |
15 | export async function MFAList() {
16 |   const supabase = createClient();
17 |
18 |   const { data } = await supabase.auth.mfa.listFactors();
19 |   const t = await getI18n();
20 |
21 |   return data?.all
22 |     ?.sort((a) => (a.status === "verified" ? -1 : 1))
23 |     .map((factor) => {
24 |       return (
25 |         <div
26 |           key={factor.id}
27 |           className="flex justify-between items-center space-y-4"
28 |         >
29 |           <div>
30 |             <p className="text-sm">
31 |               Added on {format(new Date(factor.created_at), "pppp")}
32 |             </p>
33 |
34 |             <p className="text-xs text-[#606060] mt-0.5">
35 |               {t(`mfa_status.${factor.status}`)}
36 |             </p>
37 |           </div>
38 |
39 |           <RemoveMFAButton factorId={factor.id} />
40 |         </div>
41 |       );
42 |     });
43 | }
```

apps/dashboard/src/components/mfa-settings-list.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import {
3 |   Card,
4 |   CardContent,
5 |   CardDescription,
6 |   CardFooter,
7 |   CardHeader,
8 |   CardTitle,
9 | } from "@midday/ui/card";
10 | import Link from "next/link";
11 | import { UnenrollMFA } from "./unenroll-mfa";
12 |
13 | export function MfaSettingsList() {
14 |   return (
15 |     <Card>
16 |       <CardHeader>
17 |         <CardTitle>Multi-factor authentication</CardTitle>
18 |         <CardDescription>
19 |           Add an additional layer of security to your account by requiring more
20 |           than just a password to sign in.
21 |         </CardDescription>
22 |       </CardHeader>
23 |
24 |       <CardContent>
25 |         <UnenrollMFA />
26 |       </CardContent>
27 |
28 |       <CardFooter className="flex justify-between">
29 |         <div />
30 |         <Link href="?add=device">
31 |           <Button>Add new device</Button>
32 |         </Link>
33 |       </CardFooter>
34 |     </Card>
35 |   );
36 | }
```

apps/dashboard/src/components/mobile-menu.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Icons } from "@midday/ui/icons";
5 | import { Sheet, SheetContent, SheetTrigger } from "@midday/ui/sheet";
6 | import { useState } from "react";
7 | import { MainMenu } from "./main-menu";
8 |
9 | export function MobileMenu() {
10 |   const [isOpen, setOpen] = useState(false);
11 |
12 |   return (
13 |     <Sheet open={isOpen} onOpenChange={setOpen}>
14 |       <div>
15 |         <Button
16 |           variant="outline"
17 |           size="icon"
18 |           onClick={() => setOpen(true)}
19 |           className="rounded-full w-8 h-8 items-center relative flex md:hidden"
20 |         >
21 |           <Icons.Menu size={16} />
22 |         </Button>
23 |       </div>
24 |       <SheetContent side="left" className="border-none rounded-none -ml-2">
25 |         <div className="ml-2 mb-8">
26 |           <Icons.Logo />
27 |         </div>
28 |
29 |         <MainMenu onSelect={() => setOpen(false)} />
30 |       </SheetContent>
31 |     </Sheet>
32 |   );
33 | }
```

apps/dashboard/src/components/note.tsx
```
1 | import type { UpdateTransactionValues } from "@/actions/schema";
2 | import { Textarea } from "@midday/ui/textarea";
3 | import { useState } from "react";
4 |
5 | type Props = {
6 |   id: string;
7 |   defaultValue: string;
8 |   updateTransaction: (values: UpdateTransactionValues) => void;
9 | };
10 |
11 | export function Note({ id, defaultValue, updateTransaction }: Props) {
12 |   const [value, setValue] = useState(defaultValue);
13 |
14 |   return (
15 |     <Textarea
16 |       defaultValue={defaultValue}
17 |       required
18 |       autoFocus
19 |       placeholder="Note"
20 |       className="min-h-[100px] resize-none"
21 |       onBlur={() => {
22 |         if (value !== defaultValue) {
23 |           updateTransaction({
24 |             id,
25 |             note: value?.length > 0 ? value : null,
26 |           });
27 |         }
28 |       }}
29 |       onChange={(evt) => setValue(evt.target.value)}
30 |     />
31 |   );
32 | }
```

apps/dashboard/src/components/notification-center.tsx
```
1 | "use client";
2 |
3 | import { useNotifications } from "@/hooks/use-notifications";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
7 | import { ScrollArea } from "@midday/ui/scroll-area";
8 | import { Tabs, TabsContent, TabsList, TabsTrigger } from "@midday/ui/tabs";
9 | import { formatDistanceToNow } from "date-fns";
10 | import Link from "next/link";
11 | import { useEffect, useState } from "react";
12 |
13 | function EmptyState({ description }) {
14 |   return (
15 |     <div className="h-[460px] flex items-center justify-center flex-col space-y-4">
16 |       <div className="w-12 h-12 rounded-full bg-accent flex items-center justify-center">
17 |         <Icons.Inbox size={18} />
18 |       </div>
19 |       <p className="text-[#606060] text-sm">{description}</p>
20 |     </div>
21 |   );
22 | }
23 |
24 | function NotificationItem({
25 |   id,
26 |   setOpen,
27 |   description,
28 |   createdAt,
29 |   recordId,
30 |   from,
31 |   to,
32 |   markMessageAsRead,
33 |   type,
34 | }) {
35 |   switch (type) {
36 |     case "transactions":
37 |       return (
38 |         <div className="flex items-between justify-between space-x-4 px-3 py-3 hover:bg-secondary">
39 |           <Link
40 |             className="flex items-between justify-between space-x-4"
41 |             onClick={() => setOpen(false)}
42 |             href={`/transactions?start=${from}&end=${to}`}
43 |           >
44 |             <div>
45 |               <div className="h-9 w-9 flex items-center justify-center space-y-0 border rounded-full">
46 |                 <Icons.Transactions />
47 |               </div>
48 |             </div>
49 |             <div>
50 |               <p className="text-sm">{description}</p>
51 |               <span className="text-xs text-[#606060]">
52 |                 {formatDistanceToNow(new Date(createdAt))} ago
53 |               </span>
54 |             </div>
55 |           </Link>
56 |           {markMessageAsRead && (
57 |             <div>
58 |               <Button
59 |                 size="icon"
60 |                 variant="secondary"
61 |                 className="rounded-full bg-transparent hover:bg-[#1A1A1A]"
62 |                 onClick={() => markMessageAsRead(id)}
63 |               >
64 |                 <Icons.Inventory2 />
65 |               </Button>
66 |             </div>
67 |           )}
68 |         </div>
69 |       );
70 |
71 |     case "inbox":
72 |       return (
73 |         <div className="flex items-between justify-between space-x-4 px-3 py-3 hover:bg-secondary">
74 |           <Link
75 |             className="flex items-between justify-between space-x-4 "
76 |             onClick={() => setOpen(false)}
77 |             href={`/inbox?id=${recordId}`}
78 |           >
79 |             <div>
80 |               <div className="h-9 w-9 flex items-center justify-center space-y-0 border rounded-full">
81 |                 <Icons.Email />
82 |               </div>
83 |             </div>
84 |             <div>
85 |               <p className="text-sm">{description}</p>
86 |               <span className="text-xs text-[#606060]">
87 |                 {formatDistanceToNow(new Date(createdAt))} ago
88 |               </span>
89 |             </div>
90 |           </Link>
91 |           {markMessageAsRead && (
92 |             <div>
93 |               <Button
94 |                 size="icon"
95 |                 variant="secondary"
96 |                 className="rounded-full bg-transparent hover:bg-[#1A1A1A]"
97 |                 onClick={() => markMessageAsRead(id)}
98 |               >
99 |                 <Icons.Inventory2 />
100 |               </Button>
101 |             </div>
102 |           )}
103 |         </div>
104 |       );
105 |
106 |     case "match":
107 |       return (
108 |         <div className="flex items-between justify-between space-x-4 px-3 py-3 hover:bg-secondary">
109 |           <Link
110 |             className="flex items-between justify-between space-x-4 "
111 |             onClick={() => setOpen(false)}
112 |             href={`/transactions?id=${recordId}`}
113 |           >
114 |             <div>
115 |               <div className="h-9 w-9 flex items-center justify-center space-y-0 border rounded-full">
116 |                 <Icons.Match />
117 |               </div>
118 |             </div>
119 |             <div>
120 |               <p className="text-sm">{description}</p>
121 |               <span className="text-xs text-[#606060]">
122 |                 {formatDistanceToNow(new Date(createdAt))} ago
123 |               </span>
124 |             </div>
125 |           </Link>
126 |           {markMessageAsRead && (
127 |             <div>
128 |               <Button
129 |                 size="icon"
130 |                 variant="secondary"
131 |                 className="rounded-full bg-transparent hover:bg-[#1A1A1A]"
132 |                 onClick={() => markMessageAsRead(id)}
133 |               >
134 |                 <Icons.Inventory2 />
135 |               </Button>
136 |             </div>
137 |           )}
138 |         </div>
139 |       );
140 |
141 |     case "invoice":
142 |       return (
143 |         <div className="flex items-between justify-between space-x-4 px-3 py-3 hover:bg-secondary">
144 |           <Link
145 |             className="flex items-between justify-between space-x-4 "
[TRUNCATED]
```

apps/dashboard/src/components/notification-setting.tsx
```
1 | "use client";
2 |
3 | import { updateSubscriberPreferenceAction } from "@/actions/update-subscriber-preference-action";
4 | import { useI18n } from "@/locales/client";
5 | import { Label } from "@midday/ui/label";
6 | import { Switch } from "@midday/ui/switch";
7 | import { useOptimisticAction } from "next-safe-action/hooks";
8 |
9 | type Props = {
10 |   id: string;
11 |   name: string;
12 |   enabled: boolean;
13 |   subscriberId: string;
14 |   teamId: string;
15 |   type: string;
16 | };
17 |
18 | export function NotificationSetting({
19 |   id,
20 |   name,
21 |   enabled,
22 |   subscriberId,
23 |   teamId,
24 |   type,
25 | }: Props) {
26 |   const t = useI18n();
27 |   const { execute, optimisticState } = useOptimisticAction(
28 |     updateSubscriberPreferenceAction,
29 |     {
30 |       currentState: { enabled },
31 |       updateFn: (state) => {
32 |         return {
33 |           ...state,
34 |           enabled: !state.enabled,
35 |         };
36 |       },
37 |     },
38 |   );
39 |
40 |   const onChange = () => {
41 |     execute({
42 |       templateId: id,
43 |       type,
44 |       revalidatePath: "/settings/notifications",
45 |       subscriberId,
46 |       teamId,
47 |       enabled: !enabled,
48 |     });
49 |   };
50 |
51 |   return (
52 |     <div className="flex flex-row items-center justify-between border-b-[1px] pb-4 mb-4">
53 |       <div className="space-y-0.5">
54 |         <Label htmlFor={id}>{name}</Label>
55 |         <p className="text-sm text-[#606060]">
56 |           {/* Replace all spaces with a dot to match the translation key */}
57 |           {t(`notifications.${name.toLowerCase().replaceAll(" ", ".")}`)}
58 |         </p>
59 |       </div>
60 |       <Switch
61 |         id={id}
62 |         checked={optimisticState.enabled}
63 |         onCheckedChange={onChange}
64 |       />
65 |     </div>
66 |   );
67 | }
```

apps/dashboard/src/components/notification-settings.tsx
```
1 | import { getSubscriberPreferences } from "@midday/notification";
2 | import { getUser } from "@midday/supabase/cached-queries";
3 | import { Skeleton } from "@midday/ui/skeleton";
4 | import { NotificationSetting } from "./notification-setting";
5 |
6 | export function NotificationSettingsSkeleton() {
7 |   return [...Array(2)].map((_, index) => (
8 |     <Skeleton key={index.toString()} className="h-4 w-[25%] mb-3" />
9 |   ));
10 | }
11 |
12 | export async function NotificationSettings() {
13 |   const { data: userData } = await getUser();
14 |   const { data: subscriberPreferences } = await getSubscriberPreferences({
15 |     subscriberId: userData.id,
16 |     teamId: userData.team_id,
17 |   });
18 |
19 |   const inAppSettings = subscriberPreferences
20 |     ?.filter((setting) =>
21 |       Object.keys(setting.preference.channels).includes("in_app"),
22 |     )
23 |     .map((setting) => {
24 |       return (
25 |         <NotificationSetting
26 |           key={setting.template._id}
27 |           id={setting.template._id}
28 |           name={setting.template.name}
29 |           enabled={setting.preference.channels?.in_app}
30 |           subscriberId={userData.id}
31 |           teamId={userData.team_id}
32 |           type="in_app"
33 |         />
34 |       );
35 |     });
36 |
37 |   const emailSettings = subscriberPreferences
38 |     ?.filter((setting) =>
39 |       Object.keys(setting.preference.channels).includes("email"),
40 |     )
41 |     .map((setting) => {
42 |       return (
43 |         <NotificationSetting
44 |           key={setting.template._id}
45 |           id={setting.template._id}
46 |           name={setting.template.name}
47 |           enabled={setting.preference.channels?.email}
48 |           subscriberId={userData.id}
49 |           teamId={userData.team_id}
50 |           type="email"
51 |         />
52 |       );
53 |     });
54 |
55 |   return (
56 |     <div className="flex space-y-4 flex-col">
57 |       <div>
58 |         <h2 className="mb-2">In-App Notifications</h2>
59 |         {inAppSettings}
60 |       </div>
61 |
62 |       <div>
63 |         <h2 className="mb-2">Email Notifications</h2>
64 |         {emailSettings}
65 |       </div>
66 |     </div>
67 |   );
68 | }
```

apps/dashboard/src/components/notifications-settings-list.tsx
```
1 | import {
2 |   Card,
3 |   CardContent,
4 |   CardDescription,
5 |   CardHeader,
6 |   CardTitle,
7 | } from "@midday/ui/card";
8 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
9 | import { Suspense } from "react";
10 | import { ErrorFallback } from "./error-fallback";
11 | import {
12 |   NotificationSettings,
13 |   NotificationSettingsSkeleton,
14 | } from "./notification-settings";
15 |
16 | export async function NotificationsSettingsList() {
17 |   return (
18 |     <Card>
19 |       <CardHeader>
20 |         <CardTitle>Notifications</CardTitle>
21 |         <CardDescription>
22 |           Manage your personal notification settings for this team.
23 |         </CardDescription>
24 |       </CardHeader>
25 |
26 |       <CardContent>
27 |         <ErrorBoundary errorComponent={ErrorFallback}>
28 |           <Suspense fallback={<NotificationSettingsSkeleton />}>
29 |             <NotificationSettings />
30 |           </Suspense>
31 |         </ErrorBoundary>
32 |       </CardContent>
33 |     </Card>
34 |   );
35 | }
```

apps/dashboard/src/components/open-customer-sheet.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import { Button } from "@midday/ui/button";
6 | import { Icons } from "@midday/ui/icons";
7 |
8 | export function OpenCustomerSheet() {
9 |   const { setParams } = useCustomerParams();
10 |
11 |   return (
12 |     <div>
13 |       <Button
14 |         variant="outline"
15 |         size="icon"
16 |         onClick={() => setParams({ createCustomer: true })}
17 |       >
18 |         <Icons.Add />
19 |       </Button>
20 |     </div>
21 |   );
22 | }
```

apps/dashboard/src/components/open-invoice-sheet.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 |
7 | export function OpenInvoiceSheet() {
8 |   const { setParams } = useInvoiceParams();
9 |
10 |   return (
11 |     <div>
12 |       <Button
13 |         variant="outline"
14 |         size="icon"
15 |         onClick={() => setParams({ type: "create" })}
16 |       >
17 |         <Icons.Add />
18 |       </Button>
19 |     </div>
20 |   );
21 | }
```

apps/dashboard/src/components/open-tracker-sheet.tsx
```
1 | "use client";
2 |
3 | import { useTrackerParams } from "@/hooks/use-tracker-params";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 |
7 | export function OpenTrackerSheet() {
8 |   const { setParams } = useTrackerParams();
9 |
10 |   return (
11 |     <div>
12 |       <Button
13 |         variant="outline"
14 |         size="icon"
15 |         onClick={() => setParams({ create: true })}
16 |       >
17 |         <Icons.Add />
18 |       </Button>
19 |     </div>
20 |   );
21 | }
```

apps/dashboard/src/components/open-url.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { platform } from "@todesktop/client-core";
5 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
6 |
7 | export function OpenURL({
8 |   href,
9 |   children,
10 |   className,
11 | }: { href: string; children: React.ReactNode; className?: string }) {
12 |   const handleOnClick = () => {
13 |     if (isDesktopApp()) {
14 |       platform.os.openURL(href);
15 |     } else {
16 |       window.open(href, "_blank");
17 |     }
18 |   };
19 |
20 |   return (
21 |     <span onClick={handleOnClick} className={cn("cursor-pointer", className)}>
22 |       {children}
23 |     </span>
24 |   );
25 | }
```

apps/dashboard/src/components/otp-sign-in.tsx
```
1 | "use client";
2 |
3 | import { verifyOtpAction } from "@/actions/verify-otp-action";
4 | import { zodResolver } from "@hookform/resolvers/zod";
5 | import { createClient } from "@midday/supabase/client";
6 | import { Button } from "@midday/ui/button";
7 | import { cn } from "@midday/ui/cn";
8 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
9 | import { Input } from "@midday/ui/input";
10 | import { InputOTP, InputOTPGroup, InputOTPSlot } from "@midday/ui/input-otp";
11 | import { Loader2 } from "lucide-react";
12 | import { useAction } from "next-safe-action/hooks";
13 | import { useState } from "react";
14 | import { useForm } from "react-hook-form";
15 | import { z } from "zod";
16 |
17 | const formSchema = z.object({
18 |   email: z.string().email(),
19 | });
20 |
21 | type Props = {
22 |   className?: string;
23 | };
24 |
25 | export function OTPSignIn({ className }: Props) {
26 |   const verifyOtp = useAction(verifyOtpAction);
27 |   const [isLoading, setLoading] = useState(false);
28 |   const [isSent, setSent] = useState(false);
29 |   const [email, setEmail] = useState<string>();
30 |   const supabase = createClient();
31 |
32 |   const form = useForm<z.infer<typeof formSchema>>({
33 |     resolver: zodResolver(formSchema),
34 |     defaultValues: {
35 |       email: "",
36 |     },
37 |   });
38 |
39 |   async function onSubmit({ email }: z.infer<typeof formSchema>) {
40 |     setLoading(true);
41 |
42 |     setEmail(email);
43 |
44 |     await supabase.auth.signInWithOtp({ email });
45 |
46 |     setSent(true);
47 |     setLoading(false);
48 |   }
49 |
50 |   async function onComplete(token: string) {
51 |     if (!email) return;
52 |
53 |     verifyOtp.execute({
54 |       token,
55 |       email,
56 |     });
57 |   }
58 |
59 |   if (isSent) {
60 |     return (
61 |       <div className={cn("flex flex-col space-y-4 items-center", className)}>
62 |         <InputOTP
63 |           maxLength={6}
64 |           autoFocus
65 |           onComplete={onComplete}
66 |           disabled={verifyOtp.status === "executing"}
67 |           render={({ slots }) => (
68 |             <InputOTPGroup>
69 |               {slots.map((slot, index) => (
70 |                 <InputOTPSlot
71 |                   key={index.toString()}
72 |                   {...slot}
73 |                   className="w-[62px] h-[62px]"
74 |                 />
75 |               ))}
76 |             </InputOTPGroup>
77 |           )}
78 |         />
79 |
80 |         <div className="flex space-x-2">
81 |           <span className="text-sm text-[#878787]">
82 |             Didn't receive the email?
83 |           </span>
84 |           <button
85 |             onClick={() => setSent(false)}
86 |             type="button"
87 |             className="text-sm text-primary underline font-medium"
88 |           >
89 |             Resend code
90 |           </button>
91 |         </div>
92 |       </div>
93 |     );
94 |   }
95 |
96 |   return (
97 |     <Form {...form}>
98 |       <form onSubmit={form.handleSubmit(onSubmit)}>
99 |         <div className={cn("flex flex-col space-y-4", className)}>
100 |           <FormField
101 |             control={form.control}
102 |             name="email"
103 |             render={({ field }) => (
104 |               <FormItem>
105 |                 <FormControl>
106 |                   <Input
107 |                     placeholder="Enter email address"
108 |                     {...field}
109 |                     autoCapitalize="false"
110 |                     autoCorrect="false"
111 |                     spellCheck="false"
112 |                   />
113 |                 </FormControl>
114 |               </FormItem>
115 |             )}
116 |           />
117 |
118 |           <Button
119 |             type="submit"
120 |             className="active:scale-[0.98] bg-primary px-6 py-4 text-secondary font-medium flex space-x-2 h-[40px] w-full"
121 |           >
122 |             {isLoading ? (
123 |               <Loader2 className="h-4 w-4 animate-spin" />
124 |             ) : (
125 |               <span>Continue</span>
126 |             )}
127 |           </Button>
128 |         </div>
129 |       </form>
130 |     </Form>
131 |   );
132 | }
```

apps/dashboard/src/components/payment-score-visualizer.tsx
```
1 | "use client";
2 |
3 | import { motion } from "framer-motion";
4 |
5 | interface PaymentScoreVisualizerProps {
6 |   score: number;
7 |   paymentStatus: "good" | "average" | "bad" | "none";
8 | }
9 |
10 | export function PaymentScoreVisualizer({
11 |   score,
12 |   paymentStatus,
13 | }: PaymentScoreVisualizerProps) {
14 |   return (
15 |     <div className="flex items-end gap-[6px]">
16 |       {[...Array(10)].map((_, index) => {
17 |         let color: string;
18 |
19 |         switch (paymentStatus) {
20 |           case "good":
21 |             color = "bg-green-500";
22 |             break;
23 |           case "average":
24 |             color = "bg-primary";
25 |             break;
26 |           case "bad":
27 |             color = "bg-red-500";
28 |             break;
29 |           default:
30 |             color = "bg-primary";
31 |         }
32 |         return (
33 |           <div className="relative" key={index.toString()}>
34 |             <motion.div
35 |               className={`w-1 ${color} relative z-10`}
36 |               initial={{
37 |                 scaleY: 0,
38 |                 height: index >= 8 ? "31px" : "27px",
39 |                 y: index >= 8 ? -4 : 0,
40 |               }}
41 |               animate={{
42 |                 scaleY: 1,
43 |                 height: "27px",
44 |                 y: 0,
45 |                 opacity: index < score ? 1 : 0.3,
46 |               }}
47 |               transition={{
48 |                 duration: 0.15,
49 |                 delay: index * 0.02,
50 |                 scaleY: { duration: 0.15, delay: index * 0.02 },
51 |                 height: { duration: 0.1, delay: 0.15 + index * 0.02 },
52 |                 y: { duration: 0.1, delay: 0.15 + index * 0.02 },
53 |                 opacity: { duration: 0.1, delay: 0.15 + index * 0.02 },
54 |               }}
55 |               style={{ originY: 1 }}
56 |             />
57 |           </div>
58 |         );
59 |       })}
60 |     </div>
61 |   );
62 | }
```

apps/dashboard/src/components/project-members.tsx
```
1 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
2 |
3 | interface Member {
4 |   id: string;
5 |   avatar_url?: string;
6 |   full_name?: string;
7 | }
8 |
9 | interface ProjectMembersProps {
10 |   members: Member[];
11 | }
12 |
13 | export function ProjectMembers({ members }: ProjectMembersProps) {
14 |   return (
15 |     <div className="flex space-x-2">
16 |       {members?.map((member) => (
17 |         <div key={member.id} className="relative">
18 |           <Avatar className="rounded-full w-5 h-5">
19 |             <AvatarImageNext
20 |               src={member?.avatar_url}
21 |               alt={member?.full_name ?? ""}
22 |               width={20}
23 |               height={20}
24 |             />
25 |             <AvatarFallback>
26 |               <span className="text-xs">
27 |                 {member?.full_name?.charAt(0)?.toUpperCase()}
28 |               </span>
29 |             </AvatarFallback>
30 |           </Avatar>
31 |         </div>
32 |       ))}
33 |     </div>
34 |   );
35 | }
```

apps/dashboard/src/components/reconnect-provider.tsx
```
1 | import { createPlaidLinkTokenAction } from "@/actions/institutions/create-plaid-link";
2 | import { reconnectGoCardLessLinkAction } from "@/actions/institutions/reconnect-gocardless-link";
3 | import { Button } from "@midday/ui/button";
4 | import { Icons } from "@midday/ui/icons";
5 | import {
6 |   Tooltip,
7 |   TooltipContent,
8 |   TooltipProvider,
9 |   TooltipTrigger,
10 | } from "@midday/ui/tooltip";
11 | import { useToast } from "@midday/ui/use-toast";
12 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
13 | import { useScript } from "@uidotdev/usehooks";
14 | import { Loader2 } from "lucide-react";
15 | import { useAction } from "next-safe-action/hooks";
16 | import { useTheme } from "next-themes";
17 | import { useEffect, useState } from "react";
18 | import { usePlaidLink } from "react-plaid-link";
19 |
20 | type Props = {
21 |   id: string;
22 |   provider: string;
23 |   enrollmentId: string | null;
24 |   institutionId: string;
25 |   accessToken: string | null;
26 |   onManualSync: () => void;
27 |   variant?: "button" | "icon";
28 | };
29 |
30 | export function ReconnectProvider({
31 |   id,
32 |   provider,
33 |   enrollmentId,
34 |   institutionId,
35 |   accessToken,
36 |   onManualSync,
37 |   variant,
38 | }: Props) {
39 |   const { toast } = useToast();
40 |   const { theme } = useTheme();
41 |   const [plaidToken, setPlaidToken] = useState<string | undefined>();
42 |   const [isLoading, setIsLoading] = useState(false);
43 |
44 |   const reconnectGoCardLessLink = useAction(reconnectGoCardLessLinkAction, {
45 |     onExecute: () => {
46 |       setIsLoading(true);
47 |     },
48 |     onError: () => {
49 |       setIsLoading(false);
50 |
51 |       toast({
52 |         duration: 2500,
53 |         variant: "error",
54 |         title: "Something went wrong please try again.",
55 |       });
56 |     },
57 |     onSuccess: () => {
58 |       setIsLoading(false);
59 |     },
60 |   });
61 |
62 |   useScript("https://cdn.teller.io/connect/connect.js", {
63 |     removeOnUnmount: false,
64 |   });
65 |
66 |   const { open: openPlaid } = usePlaidLink({
67 |     token: plaidToken,
68 |     publicKey: "",
69 |     env: process.env.NEXT_PUBLIC_PLAID_ENVIRONMENT!,
70 |     clientName: "Midday",
71 |     product: ["transactions"],
72 |     onSuccess: () => {
73 |       setPlaidToken(undefined);
74 |       onManualSync();
75 |     },
76 |     onExit: () => {
77 |       setPlaidToken(undefined);
78 |     },
79 |   });
80 |
81 |   const openTeller = () => {
82 |     const teller = window.TellerConnect.setup({
83 |       applicationId: process.env.NEXT_PUBLIC_TELLER_APPLICATION_ID!,
84 |       environment: process.env.NEXT_PUBLIC_TELLER_ENVIRONMENT,
85 |       enrollmentId,
86 |       appearance: theme,
87 |       onSuccess: () => {
88 |         onManualSync();
89 |       },
90 |       onFailure: () => {},
91 |     });
92 |
93 |     if (teller) {
94 |       teller.open();
95 |     }
96 |   };
97 |
98 |   useEffect(() => {
99 |     if (plaidToken) {
100 |       openPlaid();
101 |     }
102 |   }, [plaidToken, openPlaid]);
103 |
104 |   const handleOnClick = async () => {
105 |     switch (provider) {
106 |       case "plaid": {
107 |         const token = await createPlaidLinkTokenAction(
108 |           accessToken ?? undefined,
109 |         );
110 |
111 |         if (token) {
112 |           setPlaidToken(token);
113 |         }
114 |
115 |         return;
116 |       }
117 |       case "gocardless": {
118 |         return reconnectGoCardLessLink.execute({
119 |           id,
120 |           institutionId,
121 |           availableHistory: 60,
122 |           redirectTo: `${window.location.origin}/api/gocardless/reconnect`,
123 |           isDesktop: isDesktopApp(),
124 |         });
125 |       }
126 |       case "teller":
127 |         return openTeller();
128 |       default:
129 |         return;
130 |     }
131 |   };
132 |
133 |   if (variant === "button") {
134 |     return (
135 |       <Button variant="outline" onClick={handleOnClick} disabled={isLoading}>
136 |         {isLoading ? (
137 |           <Loader2 className="size-3.5 animate-spin" />
138 |         ) : (
139 |           "Reconnect"
140 |         )}
141 |       </Button>
142 |     );
143 |   }
144 |
145 |   return (
146 |     <TooltipProvider delayDuration={70}>
147 |       <Tooltip>
148 |         <TooltipTrigger asChild>
149 |           <Button
150 |             variant="outline"
151 |             size="icon"
152 |             className="rounded-full w-7 h-7 flex items-center"
153 |             onClick={handleOnClick}
154 |             disabled={isLoading}
155 |           >
156 |             {isLoading ? (
157 |               <Loader2 className="size-3.5 animate-spin" />
158 |             ) : (
159 |               <Icons.Reconnect size={16} />
160 |             )}
161 |           </Button>
162 |         </TooltipTrigger>
163 |
164 |         <TooltipContent className="px-3 py-1.5 text-xs" sideOffset={10}>
165 |           Reconnect
166 |         </TooltipContent>
167 |       </Tooltip>
168 |     </TooltipProvider>
169 |   );
170 | }
```

apps/dashboard/src/components/remove-mfa-button.tsx
```
1 | "use client";
2 |
3 | import { unenrollMfaAction } from "@/actions/unenroll-mfa-action";
4 | import { Button } from "@midday/ui/button";
5 | import { useToast } from "@midday/ui/use-toast";
6 | import { useAction } from "next-safe-action/hooks";
7 |
8 | type Props = {
9 |   factorId: string;
10 | };
11 |
12 | export function RemoveMFAButton({ factorId }: Props) {
13 |   const { toast } = useToast();
14 |
15 |   const unenroll = useAction(unenrollMfaAction, {
16 |     onError: () => {
17 |       toast({
18 |         duration: 3500,
19 |         variant: "error",
20 |         title: "Something went wrong please try again.",
21 |       });
22 |     },
23 |   });
24 |
25 |   return (
26 |     <Button variant="outline" onClick={() => unenroll.execute({ factorId })}>
27 |       Remove
28 |     </Button>
29 |   );
30 | }
```

apps/dashboard/src/components/search-address-input.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import {
5 |   CommandEmpty,
6 |   CommandGroup,
7 |   CommandInput,
8 |   CommandItem,
9 |   CommandList,
10 |   Command as CommandPrimitive,
11 | } from "@midday/ui/command";
12 | import { useJsApiLoader } from "@react-google-maps/api";
13 | import { useClickAway } from "@uidotdev/usehooks";
14 | import { Check } from "lucide-react";
15 | import { useCallback, useEffect, useRef, useState } from "react";
16 | import usePlacesAutoComplete, { getDetails } from "use-places-autocomplete";
17 |
18 | type Libraries = Parameters<typeof useJsApiLoader>[0]["libraries"];
19 | const libraries: Libraries = ["places"];
20 |
21 | type Props = {
22 |   id?: string;
23 |   defaultValue?: string;
24 |   onSelect: (addressDetails: AddressDetails) => void;
25 |   placeholder?: string;
26 |   disabled?: boolean;
27 |   emptyMessage?: string;
28 | };
29 |
30 | export type AddressDetails = {
31 |   address_line_1: string;
32 |   city: string;
33 |   state: string;
34 |   zip: string;
35 |   country: string;
36 |   country_code: string;
37 | };
38 |
39 | type Option = {
40 |   value: string;
41 |   label: string;
42 | };
43 |
44 | const getAddressDetailsByAddressId = async (
45 |   addressId: string,
46 | ): Promise<AddressDetails> => {
47 |   const details = (await getDetails({
48 |     placeId: addressId,
49 |     fields: ["address_component"],
50 |   })) as google.maps.places.PlaceResult;
51 |
52 |   const comps = details.address_components;
53 |
54 |   const streetNumber =
55 |     comps?.find((c) => c.types.includes("street_number"))?.long_name ?? "";
56 |   const streetAddress =
57 |     comps?.find((c) => c.types.includes("route"))?.long_name ?? "";
58 |   const city =
59 |     comps?.find((c) => c.types.includes("postal_town"))?.long_name ||
60 |     comps?.find((c) => c.types.includes("locality"))?.long_name ||
61 |     comps?.find((c) => c.types.includes("sublocality_level_1"))?.long_name ||
62 |     "";
63 |   const state =
64 |     comps?.find((c) => c.types.includes("administrative_area_level_1"))
65 |       ?.short_name || "";
66 |   const zip =
67 |     comps?.find((c) => c.types.includes("postal_code"))?.long_name || "";
68 |   const country =
69 |     comps?.find((c) => c.types.includes("country"))?.long_name || "";
70 |   const countryCode =
71 |     comps?.find((c) => c.types.includes("country"))?.short_name || "";
72 |
73 |   return {
74 |     address_line_1: `${streetNumber} ${streetAddress}`.trim(),
75 |     city,
76 |     state,
77 |     zip,
78 |     country,
79 |     country_code: countryCode,
80 |   };
81 | };
82 |
83 | export function SearchAddressInput({
84 |   onSelect,
85 |   placeholder,
86 |   defaultValue,
87 |   disabled = false,
88 |   emptyMessage = "No results found.",
89 | }: Props) {
90 |   const inputRef = useRef<HTMLInputElement>(null);
91 |
92 |   const [isOpen, setOpen] = useState(false);
93 |   const [selected, setSelected] = useState<Option | null>(null);
94 |   const [inputValue, setInputValue] = useState<string>(defaultValue || "");
95 |
96 |   const { isLoaded } = useJsApiLoader({
97 |     googleMapsApiKey: process.env.NEXT_PUBLIC_GOOGLE_API_KEY as string,
98 |     libraries,
99 |   });
100 |
101 |   const {
102 |     ready,
103 |     suggestions: { status, data },
104 |     setValue,
105 |   } = usePlacesAutoComplete({
106 |     initOnMount: isLoaded,
107 |     debounce: 300,
108 |     requestOptions: {
109 |       language: "en",
110 |     },
111 |   });
112 |
113 |   useEffect(() => {
114 |     if (defaultValue) {
115 |       setValue(defaultValue, false);
116 |       setInputValue(defaultValue);
117 |     }
118 |   }, [defaultValue, setValue]);
119 |
120 |   const options: Option[] = data.map((item) => ({
121 |     value: item.place_id,
122 |     label: item.description,
123 |   }));
124 |
125 |   const handleKeyDown = useCallback(
126 |     (event: React.KeyboardEvent<HTMLDivElement>) => {
127 |       const input = inputRef.current;
128 |
129 |       if (!input) {
130 |         return;
131 |       }
132 |
133 |       if (!isOpen) {
134 |         setOpen(true);
135 |       }
136 |
137 |       if (event.key === "Enter" && input.value !== "") {
138 |         const optionToSelect = options.find(
139 |           (option) => option.label === input.value,
140 |         );
141 |         if (optionToSelect) {
142 |           setSelected(optionToSelect);
143 |           handleSelect(optionToSelect);
144 |         }
145 |       }
146 |
147 |       if (event.key === "Escape") {
148 |         input.blur();
149 |       }
150 |     },
151 |     [isOpen, options],
152 |   );
153 |
154 |   const handleBlur = useCallback(() => {
155 |     setInputValue(selected?.label || "");
156 |   }, [selected]);
157 |
158 |   const handleSelectOption = useCallback(
159 |     (selectedOption: Option) => {
160 |       setInputValue(selectedOption.label);
161 |       setSelected(selectedOption);
162 |       handleSelect(selectedOption);
163 |       setOpen(false);
164 |
165 |       setTimeout(() => {
166 |         inputRef?.current?.blur();
167 |       }, 0);
168 |     },
169 |     [onSelect],
170 |   );
171 |
172 |   const handleSelect = async (address: Option) => {
173 |     setValue(address.label, false);
[TRUNCATED]
```

apps/dashboard/src/components/search-customer.tsx
```
1 | "use client";
2 |
3 | import type { Customer } from "@/components/invoice/customer-details";
4 | import { useCustomerParams } from "@/hooks/use-customer-params";
5 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
6 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
7 | import { useEffect } from "react";
8 |
9 | type Props = {
10 |   data: Customer[];
11 |   onSelect: (id: string) => void;
12 |   selectedId?: string;
13 | };
14 |
15 | export function SearchCustomer({ data, onSelect, selectedId }: Props) {
16 |   const { setParams: setCustomerParams } = useCustomerParams();
17 |   const { selectedCustomerId } = useInvoiceParams();
18 |
19 |   const formattedData = data?.map((customer) => ({
20 |     id: customer.id,
21 |     label: customer.name,
22 |   }));
23 |
24 |   const selectedItem = selectedId
25 |     ? formattedData.find((item) => item.id === selectedId)
26 |     : undefined;
27 |
28 |   useEffect(() => {
29 |     if (selectedCustomerId) {
30 |       onSelect(selectedCustomerId);
31 |     }
32 |   }, [selectedCustomerId]);
33 |
34 |   return (
35 |     <ComboboxDropdown
36 |       placeholder="Select customer"
37 |       searchPlaceholder="Search customer"
38 |       className="text-xs"
39 |       items={formattedData}
40 |       onSelect={({ id }) => onSelect(id)}
41 |       selectedItem={selectedItem}
42 |       onCreate={(value) => {
43 |         setCustomerParams({ createCustomer: true, name: value });
44 |       }}
45 |       renderListItem={(item) => {
46 |         return (
47 |           <div className="flex items-center justify-between w-full group">
48 |             <span>{item.item.label}</span>
49 |             <button
50 |               type="button"
51 |               onClick={() => setCustomerParams({ customerId: item.item.id })}
52 |               className="text-xs opacity-0 group-hover:opacity-50 hover:opacity-100"
53 |             >
54 |               Edit
55 |             </button>
56 |           </div>
57 |         );
58 |       }}
59 |       renderOnCreate={(value) => {
60 |         return (
61 |           <div className="flex items-center space-x-2">
62 |             <button
63 |               type="button"
64 |               onClick={() =>
65 |                 setCustomerParams({ createCustomer: true, name: value })
66 |               }
67 |             >{`Create "${value}"`}</button>
68 |           </div>
69 |         );
70 |       }}
71 |     />
72 |   );
73 | }
```

apps/dashboard/src/components/search-field.tsx
```
1 | "use client";
2 |
3 | import { Icons } from "@midday/ui/icons";
4 | import { Input } from "@midday/ui/input";
5 | import { useQueryState } from "nuqs";
6 | import { useHotkeys } from "react-hotkeys-hook";
7 |
8 | type Props = {
9 |   placeholder: string;
10 |   shallow?: boolean;
11 | };
12 |
13 | export function SearchField({ placeholder, shallow = false }: Props) {
14 |   const [search, setSearch] = useQueryState("q", {
15 |     shallow,
16 |   });
17 |
18 |   useHotkeys("esc", () => setSearch(null), {
19 |     enableOnFormTags: true,
20 |   });
21 |
22 |   const handleSearch = (evt: React.ChangeEvent<HTMLInputElement>) => {
23 |     const value = evt.target.value;
24 |
25 |     if (value) {
26 |       setSearch(value);
27 |     } else {
28 |       setSearch(null);
29 |     }
30 |   };
31 |
32 |   return (
33 |     <div className="w-full md:max-w-[380px] relative">
34 |       <Icons.Search className="absolute pointer-events-none left-3 top-[11px]" />
35 |       <Input
36 |         placeholder={placeholder}
37 |         className="pl-9 w-full"
38 |         value={search ?? ""}
39 |         onChange={handleSearch}
40 |         autoComplete="off"
41 |         autoCapitalize="none"
42 |         autoCorrect="off"
43 |         spellCheck="false"
44 |       />
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/secondary-menu.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import Link from "next/link";
5 | import { usePathname } from "next/navigation";
6 |
7 | export function SecondaryMenu({ items }) {
8 |   const pathname = usePathname();
9 |
10 |   return (
11 |     <nav className="py-4">
12 |       <ul className="flex space-x-6 text-sm overflow-auto scrollbar-hide">
13 |         {items.map((item) => (
14 |           <Link
15 |             prefetch
16 |             key={item.path}
17 |             href={item.path}
18 |             className={cn(
19 |               "text-[#606060]",
20 |               pathname === item.path &&
21 |                 "text-primary font-medium underline underline-offset-8"
22 |             )}
23 |           >
24 |             <span>{item.label}</span>
25 |           </Link>
26 |         ))}
27 |       </ul>
28 |     </nav>
29 |   );
30 | }
```

apps/dashboard/src/components/select-account.tsx
```
1 | import { createBankAccountAction } from "@/actions/create-bank-account-action";
2 | import { useUserContext } from "@/store/user/hook";
3 | import { formatAccountName } from "@/utils/format";
4 | import { createClient } from "@midday/supabase/client";
5 | import { getTeamBankAccountsQuery } from "@midday/supabase/queries";
6 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useEffect, useState } from "react";
9 | import { TransactionBankAccount } from "./transaction-bank-account";
10 |
11 | type Props = {
12 |   placeholder: string;
13 |   className?: string;
14 |   value?: string;
15 |   onChange: (value: {
16 |     id: string;
17 |     label: string;
18 |     logo?: string;
19 |     currency?: string;
20 |     type?: string;
21 |   }) => void;
22 | };
23 |
24 | export function SelectAccount({ placeholder, onChange, value }: Props) {
25 |   const [data, setData] = useState([]);
26 |   const supabase = createClient();
27 |
28 |   const { team_id: teamId } = useUserContext((state) => state.data);
29 |
30 |   const createBankAccount = useAction(createBankAccountAction, {
31 |     onSuccess: async ({ data: result }) => {
32 |       if (result) {
33 |         onChange(result);
34 |         setData((prev) => [{ id: result.id, label: result.name }, ...prev]);
35 |       }
36 |     },
37 |   });
38 |
39 |   useEffect(() => {
40 |     async function fetchData() {
41 |       const repsonse = await getTeamBankAccountsQuery(supabase, {
42 |         teamId,
43 |       });
44 |
45 |       setData(
46 |         repsonse.data?.map((account) => ({
47 |           id: account.id,
48 |           label: account.name,
49 |           logo: account?.logo_url,
50 |           currency: account.currency,
51 |           type: account.type,
52 |         })),
53 |       );
54 |     }
55 |
56 |     if (!data.length) {
57 |       fetchData();
58 |     }
59 |   }, []);
60 |
61 |   const selectedValue = data.find((d) => d?.id === value);
62 |
63 |   return (
64 |     <ComboboxDropdown
65 |       disabled={createBankAccount.status === "executing"}
66 |       placeholder={placeholder}
67 |       searchPlaceholder="Select or create account"
68 |       items={data}
69 |       selectedItem={selectedValue}
70 |       onSelect={(item) => {
71 |         onChange(item);
72 |       }}
73 |       onCreate={(name) => createBankAccount.execute({ name })}
74 |       renderSelectedItem={(selectedItem) => {
75 |         return (
76 |           <TransactionBankAccount
77 |             name={formatAccountName({
78 |               name: selectedItem.label,
79 |               currency: selectedItem.currency,
80 |             })}
81 |             logoUrl={selectedItem.logo}
82 |           />
83 |         );
84 |       }}
85 |       renderOnCreate={(value) => {
86 |         return (
87 |           <div className="flex items-center space-x-2">
88 |             <span>{`Create "${value}"`}</span>
89 |           </div>
90 |         );
91 |       }}
92 |       renderListItem={({ item }) => {
93 |         return (
94 |           <TransactionBankAccount
95 |             name={formatAccountName({
96 |               name: item.label,
97 |               currency: item.currency,
98 |             })}
99 |             logoUrl={item.logo}
100 |           />
101 |         );
102 |       }}
103 |     />
104 |   );
105 | }
```

apps/dashboard/src/components/select-attachment.tsx
```
1 | import { searchAction } from "@/actions/search-action";
2 | import { Combobox } from "@midday/ui/combobox";
3 | import {
4 |   HoverCard,
5 |   HoverCardContent,
6 |   HoverCardTrigger,
7 | } from "@midday/ui/hover-card";
8 | import { isSupportedFilePreview } from "@midday/utils";
9 | import { useDebounce } from "@uidotdev/usehooks";
10 | import { format } from "date-fns";
11 | import { useAction } from "next-safe-action/hooks";
12 | import { useEffect, useState } from "react";
13 | import { FilePreview } from "./file-preview";
14 | import { FormatAmount } from "./format-amount";
15 |
16 | type Props = {
17 |   placeholder: string;
18 |   onSelect: (file: any) => void;
19 | };
20 |
21 | export function SelectAttachment({ placeholder, onSelect }: Props) {
22 |   const [items, setItems] = useState([]);
23 |   const [isLoading, setLoading] = useState(false);
24 |   const [query, setQuery] = useState("");
25 |
26 |   const debouncedSearchTerm = useDebounce(query, 300);
27 |
28 |   const search = useAction(searchAction, {
29 |     onSuccess: ({ data }) => {
30 |       setItems(data);
31 |       setLoading(false);
32 |     },
33 |     onError: () => setLoading(false),
34 |   });
35 |
36 |   useEffect(() => {
37 |     if (debouncedSearchTerm) {
38 |       search.execute({ query: debouncedSearchTerm, type: "inbox" });
39 |     } else {
40 |       setLoading(false);
41 |     }
42 |   }, [debouncedSearchTerm]);
43 |
44 |   const options = items?.map((item) => ({
45 |     id: item.id,
46 |     name: item.display_name,
47 |     data: item,
48 |     component: () => {
49 |       const filePreviewSupported = isSupportedFilePreview(item.content_type);
50 |
51 |       return (
52 |         <HoverCard openDelay={200}>
53 |           <HoverCardTrigger className="w-full">
54 |             <div className="dark:text-white flex w-full">
55 |               <div className="w-[50%] line-clamp-1 text-ellipsis overflow-hidden pr-8">
56 |                 {item.display_name}
57 |               </div>
58 |               <div className="w-[70px]">
59 |                 {item.date ? format(new Date(item.date), "d MMM") : "-"}
60 |               </div>
61 |               <div className="flex-1 text-right">
62 |                 {item.amount && item.currency && (
63 |                   <FormatAmount amount={item.amount} currency={item.currency} />
64 |                 )}
65 |               </div>
66 |             </div>
67 |           </HoverCardTrigger>
68 |
69 |           {filePreviewSupported && (
70 |             <HoverCardContent
71 |               className="w-[273px] h-[358px] p-0 overflow-hidden"
72 |               side="left"
73 |               sideOffset={55}
74 |             >
75 |               <FilePreview
76 |                 src={`/api/proxy?filePath=vault/${item?.file_path?.join("/")}`}
77 |                 name={item.name}
78 |                 type={item.content_type}
79 |                 width={280}
80 |                 height={365}
81 |                 disableFullscreen
82 |               />
83 |             </HoverCardContent>
84 |           )}
85 |         </HoverCard>
86 |       );
87 |     },
88 |   }));
89 |
90 |   return (
91 |     <Combobox
92 |       className="border border-border p-2 pl-10"
93 |       placeholder={placeholder}
94 |       onValueChange={(query) => {
95 |         setLoading(true);
96 |         setQuery(query);
97 |       }}
98 |       onSelect={onSelect}
99 |       options={isLoading ? [] : options}
100 |       isLoading={isLoading}
101 |       classNameList="mt-2"
102 |     />
103 |   );
104 | }
```

apps/dashboard/src/components/select-category.tsx
```
1 | import { createCategoriesAction } from "@/actions/create-categories-action";
2 | import { useUserContext } from "@/store/user/hook";
3 | import { getColorFromName } from "@/utils/categories";
4 | import { createClient } from "@midday/supabase/client";
5 | import { getCategoriesQuery } from "@midday/supabase/queries";
6 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
7 | import { Spinner } from "@midday/ui/spinner";
8 | import { useAction } from "next-safe-action/hooks";
9 | import { useEffect, useState } from "react";
10 | import { CategoryColor } from "./category";
11 |
12 | type Selected = {
13 |   id: string;
14 |   name: string;
15 |   color: string;
16 |   slug: string;
17 | };
18 |
19 | type Props = {
20 |   selected?: Selected;
21 |   onChange: (selected: Selected) => void;
22 |   headless?: boolean;
23 |   hideLoading?: boolean;
24 |   uncategorized?: boolean;
25 | };
26 |
27 | function transformCategory(category) {
28 |   return {
29 |     id: category.id,
30 |     label: category.name,
31 |     color: category.color,
32 |     slug: category.slug,
33 |   };
34 | }
35 |
36 | export function SelectCategory({
37 |   selected,
38 |   onChange,
39 |   headless,
40 |   hideLoading,
41 |   uncategorized,
42 | }: Props) {
43 |   const [data, setData] = useState([]);
44 |   const [isLoading, setIsLoading] = useState(true);
45 |   const supabase = createClient();
46 |
47 |   const { team_id: teamId } = useUserContext((state) => state.data);
48 |
49 |   useEffect(() => {
50 |     async function fetchData() {
51 |       const response = await getCategoriesQuery(supabase, {
52 |         teamId,
53 |         limit: 1000,
54 |       });
55 |
56 |       if (response.data) {
57 |         setData([
58 |           ...response.data.map(transformCategory),
59 |           ...(uncategorized
60 |             ? [
61 |                 {
62 |                   id: "uncategorized",
63 |                   label: "Uncategorized",
64 |                   color: "#606060",
65 |                   slug: "uncategorized",
66 |                 },
67 |               ]
68 |             : []),
69 |         ]);
70 |       }
71 |
72 |       setIsLoading(false);
73 |     }
74 |
75 |     if (!data.length) {
76 |       fetchData();
77 |     }
78 |   }, [data]);
79 |
80 |   const createCategories = useAction(createCategoriesAction, {
81 |     onSuccess: ({ data }) => {
82 |       const category = data?.at(0);
83 |
84 |       if (category) {
85 |         setData((prev) => [transformCategory(category), ...prev]);
86 |         onChange(category);
87 |       }
88 |     },
89 |   });
90 |
91 |   const selectedValue = selected ? transformCategory(selected) : undefined;
92 |
93 |   if (!selected && isLoading && !hideLoading) {
94 |     return (
95 |       <div className="w-full h-full flex items-center justify-center">
96 |         <Spinner />
97 |       </div>
98 |     );
99 |   }
100 |
101 |   return (
102 |     <ComboboxDropdown
103 |       headless={headless}
104 |       disabled={createCategories.status === "executing"}
105 |       placeholder="Select category"
106 |       searchPlaceholder="Search category"
107 |       items={data}
108 |       selectedItem={selectedValue}
109 |       onSelect={(item) => {
110 |         onChange({
111 |           id: item.id,
112 |           name: item.label,
113 |           color: item.color,
114 |           slug: item.slug,
115 |         });
116 |       }}
117 |       {...(!headless && {
118 |         onCreate: (value) => {
119 |           createCategories.execute({
120 |             categories: [
121 |               {
122 |                 name: value,
123 |                 color: getColorFromName(value),
124 |               },
125 |             ],
126 |           });
127 |         },
128 |       })}
129 |       renderSelectedItem={(selectedItem) => (
130 |         <div className="flex items-center space-x-2">
131 |           <CategoryColor color={selectedItem.color} />
132 |           <span className="text-left truncate max-w-[90%]">
133 |             {selectedItem.label}
134 |           </span>
135 |         </div>
136 |       )}
137 |       renderOnCreate={(value) => {
138 |         if (!headless) {
139 |           return (
140 |             <div className="flex items-center space-x-2">
141 |               <CategoryColor color={getColorFromName(value)} />
142 |               <span>{`Create "${value}"`}</span>
143 |             </div>
144 |           );
145 |         }
146 |       }}
147 |       renderListItem={({ item }) => {
148 |         return (
149 |           <div className="flex items-center space-x-2">
150 |             <CategoryColor color={item.color} />
151 |             <span className="line-clamp-1">{item.label}</span>
152 |           </div>
153 |         );
154 |       }}
155 |     />
156 |   );
157 | }
```

apps/dashboard/src/components/select-currency.tsx
```
1 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
2 |
3 | type Props = {
4 |   value?: string;
5 |   headless?: boolean;
6 |   className?: string;
7 |   currencies: string[];
8 |   onChange: (value: string) => void;
9 | };
10 |
11 | export function SelectCurrency({
12 |   currencies,
13 |   value,
14 |   onChange,
15 |   headless,
16 |   className,
17 | }: Props) {
18 |   const data = currencies.map((currency) => ({
19 |     id: currency.toLowerCase(),
20 |     value: currency.toUpperCase(),
21 |     label: currency,
22 |   }));
23 |
24 |   return (
25 |     <ComboboxDropdown
26 |       headless={headless}
27 |       placeholder="Select currency"
28 |       selectedItem={data.find((item) => item.id === value?.toLowerCase())}
29 |       searchPlaceholder="Search currencies"
30 |       items={data}
31 |       className={className}
32 |       onSelect={(item) => {
33 |         onChange(item.value);
34 |       }}
35 |     />
36 |   );
37 | }
```

apps/dashboard/src/components/select-customer.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import { Button } from "@midday/ui/button";
6 | import {
7 |   Command,
8 |   CommandEmpty,
9 |   CommandGroup,
10 |   CommandInput,
11 |   CommandItem,
12 |   CommandList,
13 | } from "@midday/ui/command";
14 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
15 | import React from "react";
16 |
17 | type Props = {
18 |   data: {
19 |     id: string;
20 |     name: string;
21 |   }[];
22 | };
23 |
24 | export function SelectCustomer({ data }: Props) {
25 |   const { setParams: setCustomerParams } = useCustomerParams();
26 |   const { setParams: setInvoiceParams } = useInvoiceParams();
27 |   const [open, setOpen] = React.useState(false);
28 |   const [value, setValue] = React.useState("");
29 |
30 |   const formatData = data.map((item) => ({
31 |     value: item.name,
32 |     label: item.name,
33 |     id: item.id,
34 |   }));
35 |
36 |   const handleSelect = (id: string) => {
37 |     if (id === "create-customer") {
38 |       setCustomerParams({ createCustomer: true, name: value });
39 |     } else {
40 |       setInvoiceParams({ selectedCustomerId: id });
41 |     }
42 |
43 |     setOpen(false);
44 |   };
45 |
46 |   if (!data.length) {
47 |     return (
48 |       <Button
49 |         type="button"
50 |         variant="ghost"
51 |         onClick={() => setCustomerParams({ createCustomer: true })}
52 |         className="font-mono text-[#434343] p-0 text-[11px] h-auto hover:bg-transparent"
53 |       >
54 |         Select customer
55 |       </Button>
56 |     );
57 |   }
58 |
59 |   return (
60 |     <Popover open={open} onOpenChange={setOpen} modal>
61 |       <PopoverTrigger asChild>
62 |         <Button
63 |           type="button"
64 |           variant="ghost"
65 |           aria-expanded={open}
66 |           className="font-mono text-[#434343] p-0 text-[11px] h-auto hover:bg-transparent"
67 |         >
68 |           Select customer
69 |         </Button>
70 |       </PopoverTrigger>
71 |
72 |       <PopoverContent
73 |         className="w-[200px] p-0"
74 |         side="bottom"
75 |         sideOffset={10}
76 |         align="start"
77 |       >
78 |         <Command>
79 |           <CommandInput
80 |             value={value}
81 |             onValueChange={setValue}
82 |             placeholder="Search customer..."
83 |             className="p-2 text-xs"
84 |           />
85 |           <CommandList className="max-h-[180px] overflow-auto">
86 |             <CommandEmpty className="text-xs border-t-[1px] border-border p-2">
87 |               <button
88 |                 type="button"
89 |                 onClick={() =>
90 |                   setCustomerParams({ createCustomer: true, name: value })
91 |                 }
92 |               >
93 |                 Create customer
94 |               </button>
95 |             </CommandEmpty>
96 |             <CommandGroup>
97 |               {formatData.map((item) => (
98 |                 <CommandItem
99 |                   key={item.value}
100 |                   value={item.value}
101 |                   onSelect={() => handleSelect(item.id)}
102 |                   className="group text-xs"
103 |                 >
104 |                   {item.label}
105 |                   <button
106 |                     type="button"
107 |                     onClick={(e) => {
108 |                       e.stopPropagation();
109 |                       setCustomerParams({ customerId: item.id });
110 |                     }}
111 |                     className="ml-auto text-xs opacity-0 group-hover:opacity-50 hover:opacity-100"
112 |                   >
113 |                     Edit
114 |                   </button>
115 |                 </CommandItem>
116 |               ))}
117 |               <CommandItem
118 |                 value="create-customer"
119 |                 onSelect={handleSelect}
120 |                 className="text-xs border-t-[1px] border-border pt-2 mt-2"
121 |               >
122 |                 Create customer
123 |               </CommandItem>
124 |             </CommandGroup>
125 |           </CommandList>
126 |         </Command>
127 |       </PopoverContent>
128 |     </Popover>
129 |   );
130 | }
```

apps/dashboard/src/components/select-tag.tsx
```
1 | import { useI18n } from "@/locales/client";
2 | import { ComboboxDropdown } from "@midday/ui/combobox-dropdown";
3 | import { TAGS } from "./tables/vault/contants";
4 |
5 | export function SelectTag({
6 |   headless,
7 |   onChange,
8 |   selectedId,
9 | }: {
10 |   headless?: boolean;
11 |   onChange: (selected: { id: string; label: string; slug: string }) => void;
12 |   selectedId?: string;
13 | }) {
14 |   const t = useI18n();
15 |
16 |   const data = TAGS.map((tag) => ({
17 |     id: tag,
18 |     label: t(`tags.${tag}`),
19 |     slug: tag,
20 |   }));
21 |
22 |   return (
23 |     <ComboboxDropdown
24 |       headless={headless}
25 |       placeholder="Select tags"
26 |       selectedItem={data.find((tag) => tag.id === selectedId)}
27 |       searchPlaceholder="Search tags"
28 |       items={data}
29 |       onSelect={(item) => {
30 |         onChange(item);
31 |       }}
32 |     />
33 |   );
34 | }
```

apps/dashboard/src/components/select-tags.tsx
```
1 | import { createTagAction } from "@/actions/create-tag-action";
2 | import { deleteTagAction } from "@/actions/delete-tag-action";
3 | import { updateTagAction } from "@/actions/update-tag-action";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { createClient } from "@midday/supabase/client";
6 | import { getTagsQuery } from "@midday/supabase/queries";
7 | import {
8 |   Dialog,
9 |   DialogContent,
10 |   DialogDescription,
11 |   DialogFooter,
12 |   DialogHeader,
13 |   DialogTitle,
14 | } from "@midday/ui/dialog";
15 | import { Input } from "@midday/ui/input";
16 | import { Label } from "@midday/ui/label";
17 | import MultipleSelector, { type Option } from "@midday/ui/multiple-selector";
18 | import { SubmitButton } from "@midday/ui/submit-button";
19 | import { useAction } from "next-safe-action/hooks";
20 | import React, { useEffect, useState } from "react";
21 |
22 | type Props = {
23 |   tags?: Option[];
24 |   onSelect?: (tag: Option) => void;
25 |   onRemove?: (tag: Option & { id: string }) => void;
26 |   onChange?: (tags: Option[]) => void;
27 |   onCreate?: (tag: Option) => void;
28 | };
29 |
30 | export function SelectTags({
31 |   tags,
32 |   onSelect,
33 |   onRemove,
34 |   onChange,
35 |   onCreate,
36 | }: Props) {
37 |   const supabase = createClient();
38 |   const [isOpen, setIsOpen] = useState(false);
39 |   const [data, setData] = useState<Option[]>(tags ?? []);
40 |   const [selected, setSelected] = useState<Option[]>(tags ?? []);
41 |   const [editingTag, setEditingTag] = useState<Option | null>(null);
42 |
43 |   const { team_id: teamId } = useUserContext((state) => state.data);
44 |
45 |   const deleteTag = useAction(deleteTagAction, {
46 |     onSuccess: () => {
47 |       setIsOpen(false);
48 |       setEditingTag(null);
49 |     },
50 |   });
51 |
52 |   const createTag = useAction(createTagAction, {
53 |     onSuccess: ({ data }) => {
54 |       if (data) {
55 |         const newTag: Option = {
56 |           label: data.name,
57 |           value: data.name,
58 |           id: data.id,
59 |         };
60 |         onSelect?.(newTag);
61 |         onCreate?.(newTag);
62 |       }
63 |     },
64 |   });
65 |
66 |   const updateTag = useAction(updateTagAction, {
67 |     onSuccess: () => {
68 |       setIsOpen(false);
69 |       setEditingTag(null);
70 |     },
71 |   });
72 |
73 |   useEffect(() => {
74 |     async function fetchData() {
75 |       const { data } = await getTagsQuery(supabase, teamId);
76 |
77 |       if (data?.length) {
78 |         setData(
79 |           data.map((tag) => ({
80 |             label: tag.name,
81 |             value: tag.name,
82 |             id: tag.id,
83 |           })),
84 |         );
85 |       }
86 |     }
87 |
88 |     fetchData();
89 |   }, [teamId]);
90 |
91 |   const handleDelete = () => {
92 |     deleteTag.execute({ id: editingTag?.id });
93 |     setSelected(selected.filter((tag) => tag.id !== editingTag?.id));
94 |     setData(data.filter((tag) => tag.id !== editingTag?.id));
95 |   };
96 |
97 |   const handleUpdate = () => {
98 |     updateTag.execute({ id: editingTag?.id, name: editingTag?.value });
99 |
100 |     setData(
101 |       data.map((tag) =>
102 |         tag.id === editingTag?.id
103 |           ? { ...tag, label: editingTag.value, value: editingTag.value }
104 |           : tag,
105 |       ),
106 |     );
107 |   };
108 |
109 |   return (
110 |     <Dialog open={isOpen} onOpenChange={setIsOpen}>
111 |       <div className="w-full">
112 |         <MultipleSelector
113 |           options={data}
114 |           value={selected}
115 |           placeholder="Select tags"
116 |           creatable
117 |           emptyIndicator={<p className="text-sm">No results found.</p>}
118 |           renderOption={(option) => (
119 |             <div className="flex items-center justify-between w-full group">
120 |               <span>{option.label}</span>
121 |
122 |               <button
123 |                 type="button"
124 |                 className="text-xs group-hover:opacity-50 opacity-0"
125 |                 onClick={(event) => {
126 |                   event.stopPropagation();
127 |                   setEditingTag(option);
128 |                   setIsOpen(true);
129 |                 }}
130 |               >
131 |                 Edit
132 |               </button>
133 |             </div>
134 |           )}
135 |           onCreate={(option) => {
136 |             createTag.execute({ name: option.value });
137 |           }}
138 |           onChange={(options) => {
139 |             setSelected(options);
140 |             onChange?.(options);
141 |
142 |             const newTag = options.find(
143 |               (tag) => !selected.find((opt) => opt.value === tag.value),
144 |             );
145 |
146 |             if (newTag) {
147 |               onSelect?.(newTag);
148 |               return;
149 |             }
150 |
151 |             if (options.length < selected.length) {
152 |               const removedTag = selected.find(
153 |                 (tag) => !options.find((opt) => opt.value === tag.value),
154 |               ) as Option & { id: string };
155 |
156 |               if (removedTag) {
157 |                 onRemove?.(removedTag);
158 |                 setSelected(options);
159 |               }
160 |             }
161 |           }}
162 |         />
163 |       </div>
164 |
165 |       <DialogContent className="max-w-[455px]">
166 |         <div className="p-4">
167 |           <DialogHeader>
168 |             <DialogTitle>Edit Tag</DialogTitle>
169 |             <DialogDescription>
[TRUNCATED]
```

apps/dashboard/src/components/select-transaction.tsx
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { getTransactionsQuery } from "@midday/supabase/queries";
3 | import { Combobox } from "@midday/ui/combobox";
4 | import { format } from "date-fns";
5 | import { useState } from "react";
6 | import { FormatAmount } from "./format-amount";
7 |
8 | type Item = {
9 |   id: string;
10 |   name: string;
11 |   amount: number;
12 |   currency: string;
13 |   date: string;
14 | };
15 |
16 | type Props = {
17 |   placeholder: string;
18 |   onSelect: (item: { id: string; transaction_id?: string | null }) => void;
19 |   inboxId: string;
20 |   teamId: string;
21 |   selectedTransaction?: Item;
22 | };
23 |
24 | export function SelectTransaction({
25 |   placeholder,
26 |   onSelect,
27 |   inboxId,
28 |   teamId,
29 |   selectedTransaction,
30 | }: Props) {
31 |   const supabase = createClient();
32 |   const [items, setItems] = useState<Item[]>([]);
33 |   const [isLoading, setLoading] = useState(false);
34 |
35 |   const handleChange = async (value: string) => {
36 |     if (value.length > 0) {
37 |       setLoading(true);
38 |
39 |       try {
40 |         const { data } = await getTransactionsQuery(supabase, {
41 |           teamId,
42 |           to: 25,
43 |           from: 0,
44 |           searchQuery: value,
45 |         });
46 |
47 |         setLoading(false);
48 |
49 |         if (data) {
50 |           setItems(data);
51 |         }
52 |       } catch {
53 |         setLoading(false);
54 |       }
55 |     }
56 |   };
57 |
58 |   const options = items.map((item) => ({
59 |     id: item.id,
60 |     name: item.name,
61 |     component: () => (
62 |       <div className="dark:text-white flex w-full">
63 |         <div className="w-[50%] line-clamp-1 text-ellipsis overflow-hidden pr-8">
64 |           {item.name}
65 |         </div>
66 |         <div className="w-[70px]">{format(new Date(item.date), "d MMM")}</div>
67 |         <div className="flex-1 text-right">
68 |           <FormatAmount amount={item.amount} currency={item.currency} />
69 |         </div>
70 |       </div>
71 |     ),
72 |   }));
73 |
74 |   const selectedValue = selectedTransaction
75 |     ? {
76 |         id: selectedTransaction.id,
77 |         name: selectedTransaction.name,
78 |       }
79 |     : undefined;
80 |
81 |   return (
82 |     <Combobox
83 |       placeholder={placeholder}
84 |       className="w-full border-0 bg-transparent px-12"
85 |       classNameList="bottom-[60px]"
86 |       onValueChange={handleChange}
87 |       onSelect={(option) =>
88 |         onSelect({
89 |           id: inboxId,
90 |           transaction_id: option?.id,
91 |         })
92 |       }
93 |       onRemove={() => {
94 |         onSelect({
95 |           id: inboxId,
96 |           transaction_id: null,
97 |         });
98 |       }}
99 |       value={selectedValue}
100 |       options={options}
101 |       isLoading={isLoading}
102 |     />
103 |   );
104 | }
```

apps/dashboard/src/components/select-user.tsx
```
1 | "use client";
2 |
3 | import { useUserContext } from "@/store/user/hook";
4 | import { createClient } from "@midday/supabase/client";
5 | import { getTeamMembersQuery } from "@midday/supabase/queries";
6 | import { Spinner } from "@midday/ui/spinner";
7 | import { useEffect, useState } from "react";
8 | import { AssignedUser } from "./assigned-user";
9 |
10 | type User = {
11 |   id: string;
12 |   avatar_url?: string | null;
13 |   full_name: string | null;
14 | };
15 |
16 | type Props = {
17 |   selectedId?: string;
18 |   onSelect: (selected: User) => void;
19 | };
20 |
21 | export function SelectUser({ selectedId, onSelect }: Props) {
22 |   const [value, setValue] = useState<string>();
23 |   const [isLoading, setIsLoading] = useState<boolean>(true);
24 |   const supabase = createClient();
25 |   const [users, setUsers] = useState<User[]>([]);
26 |
27 |   const { team_id: teamId } = useUserContext((state) => state.data);
28 |
29 |   useEffect(() => {
30 |     setValue(selectedId);
31 |   }, [selectedId]);
32 |
33 |   useEffect(() => {
34 |     async function getUsers() {
35 |       const { data: membersData } = await getTeamMembersQuery(supabase, teamId);
36 |
37 |       setUsers(membersData?.map(({ user }) => user));
38 |       setIsLoading(false);
39 |     }
40 |
41 |     setIsLoading(true);
42 |     getUsers();
43 |   }, [supabase]);
44 |
45 |   if (!selectedId && isLoading) {
46 |     return (
47 |       <div className="w-full h-full flex items-center justify-center">
48 |         <Spinner />
49 |       </div>
50 |     );
51 |   }
52 |
53 |   return users.map((user) => {
54 |     return (
55 |       <button
56 |         type="button"
57 |         key={user.id}
58 |         className="flex items-center text-sm cursor-default"
59 |         onClick={() => onSelect(user)}
60 |       >
61 |         <AssignedUser avatarUrl={user.avatar_url} fullName={user.full_name} />
62 |       </button>
63 |     );
64 |   });
65 | }
```

apps/dashboard/src/components/setup-form.tsx
```
1 | "use client";
2 |
3 | import { updateUserSchema } from "@/actions/schema";
4 | import { updateUserAction } from "@/actions/update-user-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Form,
9 |   FormControl,
10 |   FormDescription,
11 |   FormField,
12 |   FormItem,
13 |   FormLabel,
14 |   FormMessage,
15 | } from "@midday/ui/form";
16 | import { Input } from "@midday/ui/input";
17 | import { useToast } from "@midday/ui/use-toast";
18 | import { Loader2 } from "lucide-react";
19 | import { useAction } from "next-safe-action/hooks";
20 | import { useRouter } from "next/navigation";
21 | import { useRef } from "react";
22 | import { useForm } from "react-hook-form";
23 | import type { z } from "zod";
24 | import { AvatarUpload } from "./avatar-upload";
25 |
26 | type Props = {
27 |   userId: string;
28 |   avatarUrl?: string;
29 |   fullName?: string;
30 | };
31 |
32 | export function SetupForm({ userId, avatarUrl, fullName }: Props) {
33 |   const { toast } = useToast();
34 |   const router = useRouter();
35 |   const uploadRef = useRef<HTMLInputElement>(null);
36 |
37 |   const updateUser = useAction(updateUserAction, {
38 |     onError: () => {
39 |       toast({
40 |         duration: 3500,
41 |         variant: "error",
42 |         title: "Something went wrong please try again.",
43 |       });
44 |     },
45 |     onSuccess: () => {
46 |       router.replace("/");
47 |     },
48 |   });
49 |
50 |   const form = useForm<z.infer<typeof updateUserSchema>>({
51 |     resolver: zodResolver(updateUserSchema),
52 |     defaultValues: {
53 |       full_name: fullName ?? "",
54 |     },
55 |   });
56 |
57 |   const isSubmitting =
58 |     updateUser.status !== "idle" && updateUser.status !== "hasErrored";
59 |
60 |   return (
61 |     <Form {...form}>
62 |       <form
63 |         onSubmit={form.handleSubmit(updateUser.execute)}
64 |         className="space-y-8"
65 |       >
66 |         <div className="flex justify-between items-end gap-4">
67 |           <AvatarUpload
68 |             userId={userId}
69 |             avatarUrl={avatarUrl}
70 |             fullName={fullName}
71 |             size={80}
72 |             ref={uploadRef}
73 |           />
74 |           <Button
75 |             variant="outline"
76 |             type="button"
77 |             onClick={() => uploadRef.current?.click()}
78 |           >
79 |             Upload
80 |           </Button>
81 |         </div>
82 |
83 |         <FormField
84 |           control={form.control}
85 |           name="full_name"
86 |           render={({ field }) => (
87 |             <FormItem>
88 |               <FormLabel>Full name</FormLabel>
89 |               <FormControl>
90 |                 <Input placeholder="John Doe" {...field} />
91 |               </FormControl>
92 |               <FormDescription>
93 |                 This is your first and last name.
94 |               </FormDescription>
95 |               <FormMessage />
96 |             </FormItem>
97 |           )}
98 |         />
99 |
100 |         <Button type="submit" className="w-full" disabled={isSubmitting}>
101 |           {isSubmitting ? (
102 |             <Loader2 className="h-4 w-4 animate-spin" />
103 |           ) : (
104 |             <span>Save</span>
105 |           )}
106 |         </Button>
107 |       </form>
108 |     </Form>
109 |   );
110 | }
```

apps/dashboard/src/components/setup-mfa.tsx
```
1 | "use client";
2 |
3 | import { EnrollMFA } from "@/components/enroll-mfa";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import Link from "next/link";
7 | import { useState } from "react";
8 |
9 | function MfaStart({ setEnroll }) {
10 |   return (
11 |     <>
12 |       <div className="flex w-full flex-col relative">
13 |         <div className="pb-4 bg-gradient-to-r from-primary dark:via-primary dark:to-[#848484] to-[#000] inline-block text-transparent bg-clip-text">
14 |           <h1 className="font-medium pb-1 text-3xl">
15 |             Multi-factor <br />
16 |             authentication
17 |           </h1>
18 |         </div>
19 |
20 |         <p className="font-medium pb-1 text-2xl text-[#606060]">
21 |           Add an additional layer of security to your account.
22 |         </p>
23 |
24 |         <div className="pointer-events-auto mt-6 flex flex-col mb-4">
25 |           <Button className="w-full" onClick={() => setEnroll(true)}>
26 |             Generate QR
27 |           </Button>
28 |         </div>
29 |       </div>
30 |
31 |       <div className="flex border-t-[1px] pt-4 mt-4 justify-center mb-6">
32 |         <Link href="/" className="text-medium text-sm" prefetch>
33 |           Skip
34 |         </Link>
35 |       </div>
36 |
37 |       <p className="text-xs text-[#878787]">
38 |         Generate one-time passwords via authenticator apps like 1Password,
39 |         Authy, etc. as a second factor to verify your identity during sign-in.
40 |       </p>
41 |     </>
42 |   );
43 | }
44 |
45 | export function SetupMfa() {
46 |   const [enroll, setEnroll] = useState(false);
47 |
48 |   let content = <MfaStart setEnroll={setEnroll} />;
49 |
50 |   if (enroll) {
51 |     content = <EnrollMFA />;
52 |   }
53 |
54 |   return (
55 |     <div>
56 |       <div className="absolute left-5 top-4 md:left-10 md:top-10">
57 |         <Link href="https://midday.ai">
58 |           <Icons.Logo />
59 |         </Link>
60 |       </div>
61 |
62 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
63 |         <div className="relative z-20 m-auto flex w-full max-w-[380px] flex-col">
64 |           {content}
65 |         </div>
66 |       </div>
67 |     </div>
68 |   );
69 | }
```

apps/dashboard/src/components/share-report.tsx
```
1 | "use client";
2 |
3 | import { createReportAction } from "@/actions/report/create-report-action";
4 | import { zodResolver } from "@hookform/resolvers/zod";
5 | import { Button } from "@midday/ui/button";
6 | import { Calendar } from "@midday/ui/calendar";
7 | import {
8 |   DialogContent,
9 |   DialogDescription,
10 |   DialogFooter,
11 |   DialogHeader,
12 |   DialogTitle,
13 | } from "@midday/ui/dialog";
14 | import {
15 |   Form,
16 |   FormControl,
17 |   FormDescription,
18 |   FormField,
19 |   FormItem,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
23 | import { useToast } from "@midday/ui/use-toast";
24 | import { format } from "date-fns";
25 | import { Loader2 } from "lucide-react";
26 | import { CalendarIcon } from "lucide-react";
27 | import { useAction } from "next-safe-action/hooks";
28 | import Link from "next/link";
29 | import { useSearchParams } from "next/navigation";
30 | import { useForm } from "react-hook-form";
31 | import { z } from "zod";
32 | import { CopyInput } from "./copy-input";
33 |
34 | const formSchema = z.object({
35 |   expireAt: z.date().optional(),
36 | });
37 |
38 | type Props = {
39 |   defaultValue: {
40 |     from: string;
41 |     to: string;
42 |   };
43 |   type: "profit" | "revenue";
44 |   setOpen: (open: boolean) => void;
45 | };
46 |
47 | export function ShareReport({ defaultValue, type, setOpen }: Props) {
48 |   const { toast, dismiss } = useToast();
49 |
50 |   const searchParams = useSearchParams();
51 |   const from = searchParams?.get("from") ?? defaultValue.from;
52 |   const to = searchParams?.get("to") ?? defaultValue.to;
53 |
54 |   const form = useForm<z.infer<typeof formSchema>>({
55 |     resolver: zodResolver(formSchema),
56 |   });
57 |
58 |   function onSubmit(data: z.infer<typeof formSchema>) {
59 |     createReport.execute({
60 |       baseUrl: window.location.origin,
61 |       from,
62 |       to,
63 |       type,
64 |       expiresAt: data.expireAt && new Date(data.expireAt).toISOString(),
65 |     });
66 |   }
67 |
68 |   const createReport = useAction(createReportAction, {
69 |     onError: () => {
70 |       toast({
71 |         duration: 2500,
72 |         variant: "error",
73 |         title: "Something went wrong please try again.",
74 |       });
75 |     },
76 |     onSuccess: ({ data }) => {
77 |       setOpen(false);
78 |
79 |       const { id } = toast({
80 |         title: "Report published",
81 |         description: "Your report is ready to share.",
82 |         variant: "success",
83 |         footer: (
84 |           <div className="mt-4 space-x-2 flex w-full">
85 |             <CopyInput
86 |               value={data.short_link}
87 |               className="border-[#2C2C2C] w-full"
88 |             />
89 |
90 |             <Link href={data.short_link} onClick={() => dismiss(id)}>
91 |               <Button>View</Button>
92 |             </Link>
93 |           </div>
94 |         ),
95 |       });
96 |     },
97 |   });
98 |
99 |   return (
100 |     <DialogContent className="sm:max-w-[425px]">
101 |       <Form {...form}>
102 |         <form onSubmit={form.handleSubmit(onSubmit)} className="p-4 space-y-8">
103 |           <DialogHeader>
104 |             <DialogTitle>Share report</DialogTitle>
105 |             <DialogDescription>
106 |               Share a report from the period.
107 |             </DialogDescription>
108 |           </DialogHeader>
109 |
110 |           <FormField
111 |             control={form.control}
112 |             name="expireAt"
113 |             render={({ field }) => (
114 |               <FormItem className="flex flex-col">
115 |                 <Popover>
116 |                   <PopoverTrigger asChild>
117 |                     <FormControl>
118 |                       <Button variant="outline">
119 |                         {field.value ? (
120 |                           format(field.value, "PPP")
121 |                         ) : (
122 |                           <span>Expire at</span>
123 |                         )}
124 |                         <CalendarIcon className="ml-auto h-4 w-4 opacity-50" />
125 |                       </Button>
126 |                     </FormControl>
127 |                   </PopoverTrigger>
128 |                   <PopoverContent className="w-auto p-0" align="start">
129 |                     <Calendar
130 |                       mode="single"
131 |                       selected={field.value}
132 |                       onSelect={field.onChange}
133 |                       initialFocus
134 |                       disabled={(date) => date < new Date()}
135 |                     />
136 |                   </PopoverContent>
137 |                 </Popover>
138 |                 <FormDescription>
139 |                   A date when the report link will expire.
140 |                 </FormDescription>
141 |                 <FormMessage />
142 |               </FormItem>
143 |             )}
144 |           />
145 |
146 |           <DialogFooter>
147 |             <Button
148 |               type="submit"
149 |               disabled={createReport.status === "executing"}
150 |               className="w-full"
151 |             >
152 |               {createReport.status === "executing" ? (
153 |                 <Loader2 className="h-4 w-4 animate-spin" />
154 |               ) : (
155 |                 "Publish"
156 |               )}
157 |             </Button>
158 |           </DialogFooter>
159 |         </form>
160 |       </Form>
161 |     </DialogContent>
162 |   );
163 | }
```

apps/dashboard/src/components/sidebar.tsx
```
1 | import { Cookies } from "@/utils/constants";
2 | import { Icons } from "@midday/ui/icons";
3 | import { cookies } from "next/headers";
4 | import Link from "next/link";
5 | import { Suspense } from "react";
6 | import { MainMenu } from "./main-menu";
7 | import { TeamMenu } from "./team-menu";
8 |
9 | export function Sidebar() {
10 |   const initialItems = cookies().has(Cookies.MenuConfig)
11 |     ? JSON.parse(cookies().get(Cookies.MenuConfig)?.value)
12 |     : null;
13 |
14 |   return (
15 |     <aside className="h-screen flex-shrink-0 flex-col justify-between fixed top-0 ml-4 pb-4 items-center hidden md:flex">
16 |       <div className="flex flex-col items-center justify-center">
17 |         <div className="mt-6 todesktop:mt-[35px]">
18 |           <Link href="/">
19 |             <Icons.LogoSmall />
20 |           </Link>
21 |         </div>
22 |         <MainMenu initialItems={initialItems} />
23 |       </div>
24 |
25 |       <Suspense>
26 |         <TeamMenu />
27 |       </Suspense>
28 |     </aside>
29 |   );
30 | }
```

apps/dashboard/src/components/sign-out-button.tsx
```
1 | "use client";
2 |
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function SignOutButton() {
7 |   const supabase = createClient();
8 |
9 |   return (
10 |     <Button
11 |       variant="outline"
12 |       className="w-full"
13 |       onClick={() => supabase.auth.signOut()}
14 |     >
15 |       Sign out
16 |     </Button>
17 |   );
18 | }
```

apps/dashboard/src/components/sign-out.tsx
```
1 | "use client";
2 |
3 | import { signOutAction } from "@/actions/sign-out-action";
4 | import { DropdownMenuItem } from "@midday/ui/dropdown-menu";
5 | import { useState } from "react";
6 |
7 | export function SignOut() {
8 |   const [isLoading, setLoading] = useState(false);
9 |
10 |   const handleSignOut = async () => {
11 |     setLoading(true);
12 |     signOutAction();
13 |   };
14 |
15 |   return (
16 |     <DropdownMenuItem onClick={handleSignOut}>
17 |       {isLoading ? "Loading..." : "Sign out"}
18 |     </DropdownMenuItem>
19 |   );
20 | }
```

apps/dashboard/src/components/slack-sign-in.tsx
```
1 | "use client";
2 |
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
7 | import { Loader2 } from "lucide-react";
8 | import { useState } from "react";
9 |
10 | export function SlackSignIn() {
11 |   const [isLoading, setLoading] = useState(false);
12 |   const supabase = createClient();
13 |
14 |   const handleSignIn = async () => {
15 |     setLoading(true);
16 |
17 |     if (isDesktopApp()) {
18 |       const redirectTo = new URL("/api/auth/callback", window.location.origin);
19 |
20 |       redirectTo.searchParams.append("provider", "slack");
21 |       redirectTo.searchParams.append("client", "desktop");
22 |
23 |       await supabase.auth.signInWithOAuth({
24 |         provider: "slack",
25 |         options: {
26 |           redirectTo: redirectTo.toString(),
27 |           queryParams: {
28 |             client: "desktop",
29 |           },
30 |         },
31 |       });
32 |     } else {
33 |       await supabase.auth.signInWithOAuth({
34 |         provider: "slack",
35 |         options: {
36 |           redirectTo: `${window.location.origin}/api/auth/callback?provider=slack`,
37 |         },
38 |       });
39 |     }
40 |   };
41 |
42 |   return (
43 |     <Button
44 |       onClick={handleSignIn}
45 |       className="active:scale-[0.98] bg-primary px-6 py-4 text-secondary font-medium flex space-x-2 h-[40px] w-full"
46 |     >
47 |       {isLoading ? (
48 |         <Loader2 className="h-4 w-4 animate-spin" />
49 |       ) : (
50 |         <>
51 |           <Icons.Slack />
52 |           <span>Continue with Slack</span>
53 |         </>
54 |       )}
55 |     </Button>
56 |   );
57 | }
```

apps/dashboard/src/components/support-form.tsx
```
1 | "use client";
2 |
3 | import { sendSupportSchema } from "@/actions/schema";
4 | import { sendSupportAction } from "@/actions/send-support-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Form,
9 |   FormControl,
10 |   FormField,
11 |   FormItem,
12 |   FormLabel,
13 |   FormMessage,
14 | } from "@midday/ui/form";
15 | import { Input } from "@midday/ui/input";
16 | import {
17 |   Select,
18 |   SelectContent,
19 |   SelectItem,
20 |   SelectTrigger,
21 |   SelectValue,
22 | } from "@midday/ui/select";
23 | import { Textarea } from "@midday/ui/textarea";
24 | import { useToast } from "@midday/ui/use-toast";
25 | import { Loader2 } from "lucide-react";
26 | import { useAction } from "next-safe-action/hooks";
27 | import { useForm } from "react-hook-form";
28 | import type { z } from "zod";
29 |
30 | export function SupportForm() {
31 |   const { toast } = useToast();
32 |   const form = useForm<z.infer<typeof sendSupportSchema>>({
33 |     resolver: zodResolver(sendSupportSchema),
34 |     defaultValues: {
35 |       subject: undefined,
36 |       type: undefined,
37 |       priority: undefined,
38 |       message: undefined,
39 |     },
40 |   });
41 |
42 |   const sendSupport = useAction(sendSupportAction, {
43 |     onSuccess: () => {
44 |       toast({
45 |         duration: 2500,
46 |         title: "Support ticket sent.",
47 |         variant: "success",
48 |       });
49 |
50 |       form.reset();
51 |     },
52 |     onError: () => {
53 |       toast({
54 |         duration: 3500,
55 |         variant: "error",
56 |         title: "Something went wrong please try again.",
57 |       });
58 |     },
59 |   });
60 |
61 |   return (
62 |     <Form {...form}>
63 |       <form
64 |         onSubmit={form.handleSubmit(sendSupport.execute)}
65 |         className="space-y-8"
66 |       >
67 |         <FormField
68 |           control={form.control}
69 |           name="subject"
70 |           render={({ field }) => (
71 |             <FormItem>
72 |               <FormLabel>Subject</FormLabel>
73 |               <FormControl>
74 |                 <Input
75 |                   placeholder="Summary of the problem you have"
76 |                   {...field}
77 |                 />
78 |               </FormControl>
79 |               <FormMessage />
80 |             </FormItem>
81 |           )}
82 |         />
83 |
84 |         <div className="flex space-x-4">
85 |           <FormField
86 |             control={form.control}
87 |             name="type"
88 |             render={({ field }) => (
89 |               <FormItem className="w-full">
90 |                 <FormLabel>Product</FormLabel>
91 |                 <Select
92 |                   onValueChange={field.onChange}
93 |                   defaultValue={field.value}
94 |                 >
95 |                   <FormControl>
96 |                     <SelectTrigger>
97 |                       <SelectValue placeholder="Select Product" />
98 |                     </SelectTrigger>
99 |                   </FormControl>
100 |                   <SelectContent>
101 |                     <SelectItem value="Transactions">Transactions</SelectItem>
102 |                     <SelectItem value="Vault">Vault</SelectItem>
103 |                     <SelectItem value="Inbox">Inbox</SelectItem>
104 |                     <SelectItem value="Invoicing">Invoicing</SelectItem>
105 |                     <SelectItem value="Tracker">Tracker</SelectItem>
106 |                     <SelectItem value="AI">AI</SelectItem>
107 |                     <SelectItem value="General">General</SelectItem>
108 |                   </SelectContent>
109 |                 </Select>
110 |                 <FormMessage />
111 |               </FormItem>
112 |             )}
113 |           />
114 |           <FormField
115 |             control={form.control}
116 |             name="priority"
117 |             render={({ field }) => (
118 |               <FormItem className="w-full">
119 |                 <FormLabel>Severity</FormLabel>
120 |                 <Select
121 |                   onValueChange={field.onChange}
122 |                   defaultValue={field.value}
123 |                 >
124 |                   <FormControl>
125 |                     <SelectTrigger>
126 |                       <SelectValue placeholder="Select severity" />
127 |                     </SelectTrigger>
128 |                   </FormControl>
129 |                   <SelectContent>
130 |                     <SelectItem value="low">Low</SelectItem>
131 |                     <SelectItem value="normal">Normal</SelectItem>
132 |                     <SelectItem value="high">High</SelectItem>
133 |                     <SelectItem value="urgent">Urgent</SelectItem>
134 |                   </SelectContent>
135 |                 </Select>
136 |                 <FormMessage />
137 |               </FormItem>
138 |             )}
139 |           />
140 |         </div>
141 |
142 |         <FormField
143 |           control={form.control}
144 |           name="message"
145 |           render={({ field }) => (
146 |             <FormItem>
147 |               <FormLabel>Message</FormLabel>
148 |               <FormControl>
149 |                 <Textarea
150 |                   placeholder="Describe the issue you're facing, along with any relevant information. Please be as detailed and specific as possible."
151 |                   className="resize-none min-h-[150px]"
152 |                   {...field}
153 |                 />
154 |               </FormControl>
155 |
156 |               <FormMessage />
157 |             </FormItem>
158 |           )}
159 |         />
160 |
161 |         <Button
162 |           type="submit"
163 |           disabled={
164 |             sendSupport.status === "executing" || !form.formState.isValid
165 |           }
166 |         >
167 |           {sendSupport.status === "executing" ? (
168 |             <Loader2 className="h-4 w-4 animate-spin" />
169 |           ) : (
170 |             "Submit"
171 |           )}
172 |         </Button>
173 |       </form>
174 |     </Form>
175 |   );
176 | }
```

apps/dashboard/src/components/sync-transactions.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Icons } from "@midday/ui/icons";
3 | import {
4 |   Tooltip,
5 |   TooltipContent,
6 |   TooltipProvider,
7 |   TooltipTrigger,
8 | } from "@midday/ui/tooltip";
9 |
10 | type Props = {
11 |   disabled: boolean;
12 |   onClick: () => void;
13 | };
14 |
15 | export function SyncTransactions({ onClick, disabled }: Props) {
16 |   return (
17 |     <TooltipProvider delayDuration={70}>
18 |       <Tooltip>
19 |         <TooltipTrigger asChild>
20 |           <Button
21 |             variant="outline"
22 |             size="icon"
23 |             className="rounded-full w-7 h-7 flex items-center"
24 |             disabled={disabled}
25 |             onClick={onClick}
26 |           >
27 |             <Icons.Refresh size={16} />
28 |           </Button>
29 |         </TooltipTrigger>
30 |
31 |         <TooltipContent className="px-3 py-1.5 text-xs" sideOffset={10}>
32 |           Synchronize
33 |         </TooltipContent>
34 |       </Tooltip>
35 |     </TooltipProvider>
36 |   );
37 | }
```

apps/dashboard/src/components/system-banner.tsx
```
1 | export function SystemBanner() {
2 |   return (
3 |     <div className="p-1 fixed left-0 right-0 top-0 bg-[#FFD02B] z-50 text-center flex items-center justify-center text-black text-sm font-medium">
4 |       <span>
5 |         We are currently investigating a technical issue, follow{" "}
6 |         <a href="https://status.midday.ai" className="underline">
7 |           status.midday.ai
8 |         </a>{" "}
9 |         for updates.
10 |       </span>
11 |     </div>
12 |   );
13 | }
```

apps/dashboard/src/components/team-avatar.tsx
```
1 | "use client";
2 |
3 | import { updateTeamAction } from "@/actions/update-team-action";
4 | import { useUpload } from "@/hooks/use-upload";
5 | import { Avatar, AvatarFallback, AvatarImage } from "@midday/ui/avatar";
6 | import {
7 |   Card,
8 |   CardDescription,
9 |   CardFooter,
10 |   CardHeader,
11 |   CardTitle,
12 | } from "@midday/ui/card";
13 | import { stripSpecialCharacters } from "@midday/utils";
14 | import { Loader2 } from "lucide-react";
15 | import { useAction } from "next-safe-action/hooks";
16 | import { useRef } from "react";
17 |
18 | export function TeamAvatar({ teamId, logoUrl, name }) {
19 |   const action = useAction(updateTeamAction);
20 |   const inputRef = useRef<HTMLInputElement>(null);
21 |   const { isLoading, uploadFile } = useUpload();
22 |
23 |   const handleUpload = async (evt: React.ChangeEvent<HTMLInputElement>) => {
24 |     const { files } = evt.target;
25 |     const selectedFile = files as FileList;
26 |
27 |     const filename = stripSpecialCharacters(selectedFile[0]?.name);
28 |
29 |     const { url } = await uploadFile({
30 |       bucket: "avatars",
31 |       path: [teamId, filename],
32 |       file: selectedFile[0] as File,
33 |     });
34 |
35 |     if (url) {
36 |       action.execute({ logo_url: url, revalidatePath: "/settings" });
37 |     }
38 |   };
39 |
40 |   return (
41 |     <Card>
42 |       <div className="flex justify-between items-center pr-6">
43 |         <CardHeader>
44 |           <CardTitle>Team Avatar</CardTitle>
45 |           <CardDescription>
46 |             This is your team's avatar. Click on the avatar to upload a custom
47 |             one from your files.
48 |           </CardDescription>
49 |         </CardHeader>
50 |
51 |         <Avatar
52 |           className="rounded-full w-16 h-16 flex items-center justify-center bg-accent cursor-pointer"
53 |           onClick={() => inputRef?.current?.click()}
54 |         >
55 |           {isLoading ? (
56 |             <Loader2 className="h-4 w-4 animate-spin" />
57 |           ) : (
58 |             <>
59 |               <AvatarImage
60 |                 src={logoUrl}
61 |                 alt={name}
62 |                 width={64}
63 |                 height={64}
64 |                 quality={100}
65 |               />
66 |               <AvatarFallback>
67 |                 <span className="text-md">{name?.charAt(0)}</span>
68 |               </AvatarFallback>
69 |             </>
70 |           )}
71 |
72 |           <input
73 |             ref={inputRef}
74 |             type="file"
75 |             style={{ display: "none" }}
76 |             multiple={false}
77 |             onChange={handleUpload}
78 |           />
79 |         </Avatar>
80 |       </div>
81 |       <CardFooter>An avatar is optional but strongly recommended.</CardFooter>
82 |     </Card>
83 |   );
84 | }
```

apps/dashboard/src/components/team-dropdown.tsx
```
1 | "use client";
2 |
3 | import { changeTeamAction } from "@/actions/change-team-action";
4 | import { CreateTeamModal } from "@/components/modals/create-team-modal";
5 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
6 | import { Button } from "@midday/ui/button";
7 | import { Dialog } from "@midday/ui/dialog";
8 | import { Icons } from "@midday/ui/icons";
9 | import { useClickAway } from "@uidotdev/usehooks";
10 | import { motion } from "framer-motion";
11 | import { useAction } from "next-safe-action/hooks";
12 | import { useState } from "react";
13 |
14 | type Team = {
15 |   team: {
16 |     id: string;
17 |     name: string;
18 |     logo_url: string;
19 |   };
20 | };
21 |
22 | type Props = {
23 |   selectedTeamId: string;
24 |   teams: Team[];
25 | };
26 |
27 | export function TeamDropdown({ selectedTeamId: initialId, teams }: Props) {
28 |   const [selectedId, setSelectedId] = useState(initialId);
29 |   const [isActive, setActive] = useState(false);
30 |   const [isOpen, onOpenChange] = useState(false);
31 |   const changeTeam = useAction(changeTeamAction);
32 |
33 |   const sortedTeams = teams.sort((a, b) => {
34 |     if (a.team.id === selectedId) return -1;
35 |     if (b.team.id === selectedId) return 1;
36 |
37 |     return a.team.id.localeCompare(b.team.id);
38 |   });
39 |
40 |   const ref = useClickAway(() => {
41 |     setActive(false);
42 |   });
43 |
44 |   const toggleActive = () => setActive((prev) => !prev);
45 |
46 |   return (
47 |     <Dialog open={isOpen} onOpenChange={onOpenChange}>
48 |       <motion.div ref={ref} layout className="w-[32px] h-[32px] relative">
49 |         {[...sortedTeams, { team: { id: "add" } }].map(({ team }, index) => (
50 |           <motion.div
51 |             key={team.id}
52 |             className="w-[32px] h-[32px] left-0 overflow-hidden absolute"
53 |             style={{ zIndex: -index }}
54 |             initial={{
55 |               scale: `${100 - index * 16}%`,
56 |               y: index * 5,
57 |             }}
58 |             {...(isActive && {
59 |               animate: {
60 |                 y: -(32 + 10) * index,
61 |                 scale: "100%",
62 |               },
63 |             })}
64 |           >
65 |             {team.id === "add" ? (
66 |               <>
67 |                 <Button
68 |                   className="w-[32px] h-[32px]"
69 |                   size="icon"
70 |                   variant="outline"
71 |                   onClick={() => {
72 |                     onOpenChange(true);
73 |                     setActive(false);
74 |                   }}
75 |                 >
76 |                   <Icons.Add />
77 |                 </Button>
78 |
79 |                 <CreateTeamModal onOpenChange={onOpenChange} />
80 |               </>
81 |             ) : (
82 |               <Avatar
83 |                 className="w-[32px] h-[32px] rounded-none border border-[#DCDAD2] dark:border-[#2C2C2C] cursor-pointer"
84 |                 onClick={() => {
85 |                   if (index === 0) {
86 |                     toggleActive();
87 |                   } else {
88 |                     setSelectedId(team.id);
89 |                     setActive(false);
90 |                     changeTeam.execute({ teamId: team.id, redirectTo: "/" });
91 |                   }
92 |                 }}
93 |               >
94 |                 <AvatarImageNext
95 |                   src={team?.logo_url}
96 |                   alt={team?.name ?? ""}
97 |                   width={20}
98 |                   height={20}
99 |                   quality={100}
100 |                 />
101 |                 <AvatarFallback className="rounded-none w-[32px] h-[32px]">
102 |                   <span className="text-xs">
103 |                     {team?.name?.charAt(0)?.toUpperCase()}
104 |                     {team?.name?.charAt(1)?.toUpperCase()}
105 |                   </span>
106 |                 </AvatarFallback>
107 |               </Avatar>
108 |             )}
109 |           </motion.div>
110 |         ))}
111 |       </motion.div>
112 |     </Dialog>
113 |   );
114 | }
```

apps/dashboard/src/components/team-members.tsx
```
1 | import { PendingInvitesTable } from "@/components/tables/pending-invites";
2 | import { Tabs, TabsContent, TabsList, TabsTrigger } from "@midday/ui/tabs";
3 | import { Suspense } from "react";
4 | import { MembersTable } from "./tables/members";
5 | import { PendingInvitesSkeleton } from "./tables/pending-invites/table";
6 |
7 | export function TeamMembers() {
8 |   return (
9 |     <Tabs defaultValue="members">
10 |       <TabsList className="bg-transparent border-b-[1px] w-full justify-start rounded-none mb-1 p-0 h-auto pb-4">
11 |         <TabsTrigger value="members" className="p-0 m-0 mr-4">
12 |           Team Members
13 |         </TabsTrigger>
14 |         <TabsTrigger value="pending" className="p-0 m-0">
15 |           Pending Invitations
16 |         </TabsTrigger>
17 |       </TabsList>
18 |
19 |       <TabsContent value="members">
20 |         <Suspense fallback={<PendingInvitesSkeleton />}>
21 |           <MembersTable />
22 |         </Suspense>
23 |       </TabsContent>
24 |
25 |       <TabsContent value="pending">
26 |         <Suspense fallback={<PendingInvitesSkeleton />}>
27 |           <PendingInvitesTable />
28 |         </Suspense>
29 |       </TabsContent>
30 |     </Tabs>
31 |   );
32 | }
```

apps/dashboard/src/components/team-menu.tsx
```
1 | import { TeamDropdown } from "@/components/team-dropdown";
2 | import { getTeams, getUser } from "@midday/supabase/cached-queries";
3 |
4 | export async function TeamMenu() {
5 |   const user = await getUser();
6 |   const teams = await getTeams();
7 |
8 |   return (
9 |     <TeamDropdown
10 |       selectedTeamId={user?.data?.team?.id}
11 |       teams={teams?.data}
12 |       key={user?.data?.team?.id}
13 |     />
14 |   );
15 | }
```

apps/dashboard/src/components/team-name.tsx
```
1 | "use client";
2 |
3 | import { UpdateTeamFormValues, updateTeamSchema } from "@/actions/schema";
4 | import { updateTeamAction } from "@/actions/update-team-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Card,
9 |   CardContent,
10 |   CardDescription,
11 |   CardFooter,
12 |   CardHeader,
13 |   CardTitle,
14 | } from "@midday/ui/card";
15 | import {
16 |   Form,
17 |   FormControl,
18 |   FormField,
19 |   FormItem,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import { Loader2 } from "lucide-react";
24 | import { useAction } from "next-safe-action/hooks";
25 | import { useForm } from "react-hook-form";
26 |
27 | export function TeamName({ name }) {
28 |   const action = useAction(updateTeamAction);
29 |   const form = useForm<UpdateTeamFormValues>({
30 |     resolver: zodResolver(updateTeamSchema),
31 |     defaultValues: {
32 |       name,
33 |       revalidatePath: "/settings",
34 |     },
35 |   });
36 |
37 |   const onSubmit = form.handleSubmit((data) => {
38 |     action.execute(data);
39 |   });
40 |
41 |   return (
42 |     <Form {...form}>
43 |       <form onSubmit={onSubmit}>
44 |         <Card>
45 |           <CardHeader>
46 |             <CardTitle>Team Name</CardTitle>
47 |             <CardDescription>
48 |               This is your team's visible name within Midday. For example, the
49 |               name of your company or department.
50 |             </CardDescription>
51 |           </CardHeader>
52 |
53 |           <CardContent>
54 |             <FormField
55 |               control={form.control}
56 |               name="name"
57 |               render={({ field }) => (
58 |                 <FormItem>
59 |                   <FormControl>
60 |                     <Input
61 |                       {...field}
62 |                       className="max-w-[300px]"
63 |                       autoComplete="off"
64 |                       autoCapitalize="none"
65 |                       autoCorrect="off"
66 |                       spellCheck="false"
67 |                       maxLength="32"
68 |                     />
69 |                   </FormControl>
70 |                   <FormMessage />
71 |                 </FormItem>
72 |               )}
73 |             />
74 |           </CardContent>
75 |
76 |           <CardFooter className="flex justify-between">
77 |             <div>Please use 32 characters at maximum.</div>
78 |             <Button type="submit" disabled={action.status === "executing"}>
79 |               {action.status === "executing" ? (
80 |                 <Loader2 className="h-4 w-4 animate-spin" />
81 |               ) : (
82 |                 "Save"
83 |               )}
84 |             </Button>
85 |           </CardFooter>
86 |         </Card>
87 |       </form>
88 |     </Form>
89 |   );
90 | }
```

apps/dashboard/src/components/teller-connect.tsx
```
1 | import { useConnectParams } from "@/hooks/use-connect-params";
2 | import { track } from "@midday/events/client";
3 | import { LogEvents } from "@midday/events/events";
4 | import { useTheme } from "next-themes";
5 | import { useEffect, useState } from "react";
6 | import { BankConnectButton } from "./bank-connect-button";
7 |
8 | type Props = {
9 |   id: string;
10 |   onSelect: (id: string) => void;
11 | };
12 |
13 | export function TellerConnect({ id, onSelect }: Props) {
14 |   const [institution, setInstitution] = useState<string | undefined>();
15 |   const { setParams } = useConnectParams();
16 |   const { theme } = useTheme();
17 |
18 |   useEffect(() => {
19 |     if (institution) {
20 |       const teller = window.TellerConnect.setup({
21 |         applicationId: process.env.NEXT_PUBLIC_TELLER_APPLICATION_ID!,
22 |         environment: process.env.NEXT_PUBLIC_TELLER_ENVIRONMENT,
23 |         institution,
24 |         appearance: theme,
25 |         onSuccess: (authorization) => {
26 |           setParams({
27 |             step: "account",
28 |             provider: "teller",
29 |             token: authorization.accessToken,
30 |             enrollment_id: authorization.enrollment.id,
31 |           });
32 |
33 |           track({
34 |             event: LogEvents.ConnectBankAuthorized.name,
35 |             channel: LogEvents.ConnectBankAuthorized.channel,
36 |             provider: "teller",
37 |           });
38 |         },
39 |         onExit: () => {
40 |           setParams({ step: "connect" });
41 |           track({
42 |             event: LogEvents.ConnectBankCanceled.name,
43 |             channel: LogEvents.ConnectBankCanceled.channel,
44 |             provider: "teller",
45 |           });
46 |
47 |           setParams({ step: "connect" });
48 |         },
49 |         onFailure: () => {
50 |           setParams({ step: "connect" });
51 |         },
52 |       });
53 |
54 |       // NOTE: Because we are configure Teller with institution we need to
55 |       // Regenerate the SDK, and that gives us a white background, let's wait until it's fully loaded
56 |       setTimeout(() => {
57 |         teller.open();
58 |       }, 1000);
59 |     }
60 |   }, [institution]);
61 |
62 |   return (
63 |     <BankConnectButton
64 |       onClick={() => {
65 |         onSelect(id);
66 |         setInstitution(id);
67 |       }}
68 |     />
69 |   );
70 | }
```

apps/dashboard/src/components/theme-provider.tsx
```
1 | "use client";
2 |
3 | import { ThemeProvider as NextThemesProvider } from "next-themes";
4 | import * as React from "react";
5 | type ThemeProviderProps = Parameters<typeof NextThemesProvider>[0];
6 |
7 | export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
8 |   return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
9 | }
```

apps/dashboard/src/components/theme-switch.tsx
```
1 | "use client";
2 |
3 | import { Monitor, Moon, Sun } from "lucide-react";
4 | import { useTheme } from "next-themes";
5 |
6 | import {
7 |   Select,
8 |   SelectContent,
9 |   SelectGroup,
10 |   SelectItem,
11 |   SelectTrigger,
12 |   SelectValue,
13 | } from "@midday/ui/select";
14 |
15 | type Theme = "dark" | "system" | "light";
16 |
17 | type Props = {
18 |   currentTheme?: Theme;
19 | };
20 |
21 | const ThemeIcon = ({ currentTheme }: Props) => {
22 |   switch (currentTheme) {
23 |     case "dark":
24 |       return <Moon size={12} />;
25 |     case "system":
26 |       return <Monitor size={12} />;
27 |     default:
28 |       return <Sun size={12} />;
29 |   }
30 | };
31 |
32 | export const ThemeSwitch = () => {
33 |   const { theme, setTheme, themes } = useTheme();
34 |
35 |   return (
36 |     <div className="flex items-center relative">
37 |       <Select
38 |         defaultValue={theme}
39 |         onValueChange={(value: Theme) => setTheme(value)}
40 |       >
41 |         <SelectTrigger className="w-full pl-6 pr-3 py-1.5 bg-transparent outline-none capitalize h-[32px] text-xs">
42 |           <SelectValue placeholder="Select theme" />
43 |         </SelectTrigger>
44 |         <SelectContent>
45 |           <SelectGroup>
46 |             {themes.map((theme) => (
47 |               <SelectItem key={theme} value={theme} className="capitalize">
48 |                 {theme}
49 |               </SelectItem>
50 |             ))}
51 |           </SelectGroup>
52 |         </SelectContent>
53 |       </Select>
54 |
55 |       <div className="absolute left-2 pointer-events-none">
56 |         <ThemeIcon currentTheme={theme as Theme} />
57 |       </div>
58 |     </div>
59 |   );
60 | };
```

apps/dashboard/src/components/time-format-settings.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import {
5 |   Card,
6 |   CardContent,
7 |   CardDescription,
8 |   CardHeader,
9 |   CardTitle,
10 | } from "@midday/ui/card";
11 | import {
12 |   Select,
13 |   SelectContent,
14 |   SelectItem,
15 |   SelectTrigger,
16 |   SelectValue,
17 | } from "@midday/ui/select";
18 | import { useAction } from "next-safe-action/hooks";
19 |
20 | type Props = {
21 |   timeFormat: string;
22 | };
23 |
24 | export function TimeFormatSettings({ timeFormat }: Props) {
25 |   const action = useAction(updateUserAction);
26 |
27 |   return (
28 |     <Card className="flex justify-between items-center">
29 |       <CardHeader>
30 |         <CardTitle>Time Display Format</CardTitle>
31 |         <CardDescription>
32 |           Choose between 12-hour or 24-hour clock format for displaying time.
33 |         </CardDescription>
34 |       </CardHeader>
35 |
36 |       <CardContent>
37 |         <Select
38 |           defaultValue={timeFormat.toString()}
39 |           onValueChange={(value) => {
40 |             action.execute({ time_format: +value });
41 |           }}
42 |         >
43 |           <SelectTrigger className="w-[180px]">
44 |             <SelectValue placeholder="Time format" />
45 |           </SelectTrigger>
46 |           <SelectContent>
47 |             <SelectItem value="12">12 hours (AM/PM)</SelectItem>
48 |             <SelectItem value="24">24 hours</SelectItem>
49 |           </SelectContent>
50 |         </Select>
51 |       </CardContent>
52 |     </Card>
53 |   );
54 | }
```

apps/dashboard/src/components/tracker-calendar.tsx
```
1 | "use client";
2 |
3 | import { useTrackerParams } from "@/hooks/use-tracker-params";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { formatAmount, secondsToHoursAndMinutes } from "@/utils/format";
6 | import { TZDate } from "@date-fns/tz";
7 | import { cn } from "@midday/ui/cn";
8 | import { Icons } from "@midday/ui/icons";
9 | import {
10 |   Tooltip,
11 |   TooltipContent,
12 |   TooltipProvider,
13 |   TooltipTrigger,
14 | } from "@midday/ui/tooltip";
15 | import NumberFlow from "@number-flow/react";
16 | import { useClickAway } from "@uidotdev/usehooks";
17 | import {
18 |   addMonths,
19 |   eachDayOfInterval,
20 |   endOfMonth,
21 |   endOfWeek,
22 |   format,
23 |   formatISO,
24 |   isToday,
25 |   startOfMonth,
26 |   startOfWeek,
27 |   subMonths,
28 | } from "date-fns";
29 | import { useCallback, useState } from "react";
30 | import { useHotkeys } from "react-hotkeys-hook";
31 | import { TrackerEvents } from "./tracker-events";
32 | import { TrackerMonthSelect } from "./tracker-month-select";
33 |
34 | type Props = {
35 |   weekStartsOnMonday?: boolean;
36 |   timeFormat: number;
37 | };
38 |
39 | export function TrackerCalendar({
40 |   weekStartsOnMonday = false,
41 |   timeFormat,
42 |   data,
43 |   meta,
44 | }: Props) {
45 |   const {
46 |     date: currentDate,
47 |     range,
48 |     setParams,
49 |     selectedDate,
50 |   } = useTrackerParams();
51 |   const [localRange, setLocalRange] = useState<[string, string | null]>([
52 |     "",
53 |     null,
54 |   ]);
55 |   const [isDragging, setIsDragging] = useState(false);
56 |
57 |   const { calendarDays, firstWeek } = useCalendarDates(
58 |     new TZDate(currentDate, "UTC"),
59 |     weekStartsOnMonday,
60 |   );
61 |
62 |   useHotkeys(
63 |     "arrowLeft",
64 |     () => handleMonthChange(-1, new TZDate(currentDate, "UTC"), setParams),
65 |     {
66 |       enabled: !selectedDate,
67 |     },
68 |   );
69 |
70 |   useHotkeys(
71 |     "arrowRight",
72 |     () => handleMonthChange(1, new TZDate(currentDate, "UTC"), setParams),
73 |     {
74 |       enabled: !selectedDate,
75 |     },
76 |   );
77 |
78 |   const ref = useClickAway<HTMLDivElement>(() => {
79 |     if (range?.length === 1) setParams({ range: null });
80 |   });
81 |
82 |   const handleMouseDown = (date: TZDate) => {
83 |     setIsDragging(true);
84 |     setLocalRange([formatISO(date, { representation: "date" }), null]);
85 |   };
86 |
87 |   const handleMouseEnter = (date: TZDate) => {
88 |     if (isDragging) {
89 |       setLocalRange((prev) => [
90 |         prev[0],
91 |         formatISO(date, { representation: "date" }),
92 |       ]);
93 |     }
94 |   };
95 |
96 |   const handleMouseUp = () => {
97 |     setIsDragging(false);
98 |     if (localRange[0] && localRange[1]) {
99 |       let start = new TZDate(localRange[0], "UTC");
100 |       let end = new TZDate(localRange[1], "UTC");
101 |       if (start > end) [start, end] = [end, start];
102 |
103 |       setParams({ range: [localRange[0], localRange[1]] });
104 |     } else if (localRange[0]) {
105 |       setParams({ selectedDate: localRange[0] });
106 |     }
107 |     setLocalRange(["", null]);
108 |   };
109 |
110 |   return (
111 |     <div ref={ref}>
112 |       <div className="mt-8">
113 |         <CalendarHeader
114 |           meta={meta}
115 |           data={data}
116 |           timeFormat={timeFormat}
117 |           weekStartsOnMonday={weekStartsOnMonday}
118 |         />
119 |         <CalendarGrid
120 |           firstWeek={firstWeek}
121 |           calendarDays={calendarDays}
122 |           currentDate={new TZDate(currentDate, "UTC")}
123 |           selectedDate={selectedDate}
124 |           data={data}
125 |           range={range}
126 |           localRange={localRange}
127 |           isDragging={isDragging}
128 |           weekStartsOnMonday={weekStartsOnMonday}
129 |           handleMouseDown={handleMouseDown}
130 |           handleMouseEnter={handleMouseEnter}
131 |           handleMouseUp={handleMouseUp}
132 |         />
133 |       </div>
134 |     </div>
135 |   );
136 | }
137 |
138 | function useCalendarDates(currentDate: TZDate, weekStartsOnMonday: boolean) {
139 |   const monthStart = startOfMonth(currentDate);
140 |   const monthEnd = endOfMonth(currentDate);
141 |   const calendarStart = startOfWeek(monthStart, {
142 |     weekStartsOn: weekStartsOnMonday ? 1 : 0,
143 |   });
144 |   const calendarEnd = endOfWeek(monthEnd, {
145 |     weekStartsOn: weekStartsOnMonday ? 1 : 0,
146 |   });
147 |   const calendarDays = eachDayOfInterval({
148 |     start: calendarStart,
149 |     end: calendarEnd,
150 |   }).map((date) => new TZDate(date, "UTC"));
151 |   const firstWeek = eachDayOfInterval({
152 |     start: calendarStart,
153 |     end: endOfWeek(calendarStart, { weekStartsOn: weekStartsOnMonday ? 1 : 0 }),
154 |   }).map((date) => new TZDate(date, "UTC"));
155 |
156 |   return {
157 |     monthStart,
158 |     monthEnd,
159 |     calendarStart,
160 |     calendarEnd,
161 |     calendarDays,
162 |     firstWeek,
163 |   };
164 | }
165 |
166 | function handleMonthChange(
167 |   direction: number,
168 |   currentDate: TZDate,
169 |   setParams: (params: any) => void,
170 | ) {
171 |   const newDate =
172 |     direction > 0 ? addMonths(currentDate, 1) : subMonths(currentDate, 1);
173 |   setParams({
174 |     date: formatISO(newDate, { representation: "date" }),
175 |   });
176 | }
177 |
178 | type CalendarHeaderProps = {
179 |   meta: { totalDuration?: number };
180 |   data: Record<string, TrackerEvent[]>;
181 | };
182 |
183 | function CalendarHeader({ meta, data }: CalendarHeaderProps) {
184 |   const { locale } = useUserContext((state) => state.data);
185 |
[TRUNCATED]
```

apps/dashboard/src/components/tracker-day-select.tsx
```
1 | import { useTrackerParams } from "@/hooks/use-tracker-params";
2 | import { formatDateRange } from "@/utils/format";
3 | import { getTrackerDates } from "@/utils/tracker";
4 | import { TZDate } from "@date-fns/tz";
5 | import { Button } from "@midday/ui/button";
6 | import { cn } from "@midday/ui/cn";
7 | import { Icons } from "@midday/ui/icons";
8 | import { addDays, formatISO, subDays } from "date-fns";
9 | import { useHotkeys } from "react-hotkeys-hook";
10 |
11 | type Props = {
12 |   className?: string;
13 | };
14 |
15 | export function TrackerDaySelect({ className }: Props) {
16 |   const { setParams, range, selectedDate } = useTrackerParams();
17 |   const currentDate = getTrackerDates(range, selectedDate);
18 |
19 |   const selectPrevDay = () => {
20 |     if (currentDate[0]) {
21 |       const prevDay = new TZDate(subDays(currentDate[0], 1), "UTC");
22 |       setParams({
23 |         selectedDate: formatISO(prevDay, { representation: "date" }),
24 |         range: null,
25 |       });
26 |     }
27 |   };
28 |
29 |   const selectNextDay = () => {
30 |     if (currentDate[0]) {
31 |       const nextDay = new TZDate(addDays(currentDate[0], 1), "UTC");
32 |       setParams({
33 |         selectedDate: formatISO(nextDay, { representation: "date" }),
34 |         range: null,
35 |       });
36 |     }
37 |   };
38 |
39 |   useHotkeys("arrowLeft", selectPrevDay);
40 |   useHotkeys("arrowRight", selectNextDay);
41 |
42 |   return (
43 |     <div className={cn("flex items-center border h-9", className)}>
44 |       <Button
45 |         variant="ghost"
46 |         size="icon"
47 |         className="p-0 w-6 h-6 hover:bg-transparent mr-4 ml-2"
48 |         onClick={selectPrevDay}
49 |       >
50 |         <Icons.ChevronLeft className="w-6 h-6" />
51 |       </Button>
52 |       <span className="w-full text-center">
53 |         {formatDateRange(
54 |           range
55 |             ? [
56 |                 new TZDate(currentDate[0].getTime(), "UTC"),
57 |                 new TZDate(
58 |                   currentDate[1]?.getTime() ?? currentDate[0].getTime(),
59 |                   "UTC",
60 |                 ),
61 |               ]
62 |             : [new TZDate(currentDate[0].getTime(), "UTC")],
63 |         )}
64 |       </span>
65 |       <Button
66 |         variant="ghost"
67 |         size="icon"
68 |         className="p-0 w-6 h-6 hover:bg-transparent ml-4 mr-2"
69 |         onClick={selectNextDay}
70 |       >
71 |         <Icons.ChevronRight className="w-6 h-6" />
72 |       </Button>
73 |     </div>
74 |   );
75 | }
```

apps/dashboard/src/components/tracker-entries-list.tsx
```
1 | import { secondsToHoursAndMinutes } from "@/utils/format";
2 | import { format } from "date-fns";
3 | import { CreateRecordForm } from "./forms/create-record-form";
4 | import { RecordSkeleton, UpdateRecordForm } from "./forms/update-record-form";
5 |
6 | export function TrackerEntriesList({
7 |   data,
8 |   date,
9 |   user,
10 |   isLoading,
11 |   onCreate,
12 |   onDelete,
13 |   projectId,
14 | }) {
15 |   const currentDate = date ? new Date(date) : new Date();
16 |   const totalDuration = data?.reduce(
17 |     (duration, item) => item.duration + duration,
18 |     0
19 |   );
20 |
21 |   return (
22 |     <div>
23 |       <div className="flex justify-between border-b-[1px] mt-12 mb-4 pb-2">
24 |         <span>{format(currentDate, "LLL d")}</span>
25 |         <span>{secondsToHoursAndMinutes(totalDuration)}</span>
26 |       </div>
27 |
28 |       {isLoading && <RecordSkeleton />}
29 |
30 |       {data?.map((record) => (
31 |         <UpdateRecordForm
32 |           id={record.id}
33 |           key={record.id}
34 |           assigned={record.assigned}
35 |           description={record.description}
36 |           duration={record.duration}
37 |           onDelete={onDelete}
38 |         />
39 |       ))}
40 |
41 |       <CreateRecordForm
42 |         userId={user.id}
43 |         onCreate={onCreate}
44 |         projectId={projectId}
45 |       />
46 |     </div>
47 |   );
48 | }
```

apps/dashboard/src/components/tracker-events.tsx
```
1 | "use client";
2 |
3 | import { secondsToHoursAndMinutes } from "@/utils/format";
4 | import { cn } from "@midday/ui/cn";
5 |
6 | export function TrackerEvents({
7 |   data,
8 |   isToday,
9 | }: { data: TrackerEvent[]; isToday: boolean }) {
10 |   return (
11 |     <div className="flex flex-col space-y-2 font-sans w-full">
12 |       {data && data.length > 0 && (
13 |         <div
14 |           className={cn(
15 |             "text-xs bg-[#F0F0F0] dark:bg-[#1D1D1D] text-[#606060] dark:text-[#878787] p-1 w-full text-left line-clamp-1 min-h-[23px]",
16 |             isToday && "!bg-background",
17 |           )}
18 |           key={data[0].id}
19 |         >
20 |           {data[0].project.name} ({secondsToHoursAndMinutes(data[0].duration)})
21 |         </div>
22 |       )}
23 |       {data && data.length > 1 && (
24 |         <div className="text-xs text-primary p-1 w-full text-left">
25 |           +{data.length - 1} more
26 |         </div>
27 |       )}
28 |     </div>
29 |   );
30 | }
```

apps/dashboard/src/components/tracker-export-csv.tsx
```
1 | import { secondsToHoursAndMinutes } from "@/utils/format";
2 | import { UTCDate } from "@date-fns/utc";
3 | import { createClient } from "@midday/supabase/client";
4 | import { Button } from "@midday/ui/button";
5 | import { Calendar } from "@midday/ui/calendar";
6 | import {
7 |   DropdownMenuGroup,
8 |   DropdownMenuPortal,
9 |   DropdownMenuSub,
10 |   DropdownMenuSubContent,
11 |   DropdownMenuSubTrigger,
12 | } from "@midday/ui/dropdown-menu";
13 | import {
14 |   Select,
15 |   SelectContent,
16 |   SelectItem,
17 |   SelectTrigger,
18 |   SelectValue,
19 | } from "@midday/ui/select";
20 | import { endOfMonth, format, startOfMonth, subMonths } from "date-fns";
21 | import Papa from "papaparse";
22 | import React, { useState } from "react";
23 | import type { DateRange } from "react-day-picker";
24 |
25 | type Props = {
26 |   name: string;
27 |   projectId: string;
28 |   teamId: string;
29 |   userId: string;
30 | };
31 |
32 | export function TrackerExportCSV({ name, teamId, projectId, userId }: Props) {
33 |   const [includeTeam, setIncludeTeam] = useState(false);
34 |   const [date, setDate] = useState<DateRange | undefined>({
35 |     from: startOfMonth(new Date()),
36 |     to: endOfMonth(new Date()),
37 |   });
38 |
39 |   const supabase = createClient();
40 |
41 |   async function downloadCSV() {
42 |     const query = supabase
43 |       .from("tracker_entries")
44 |       .select(
45 |         "date, description, duration, assigned:assigned_id(id, full_name), project:project_id(id, name)",
46 |       )
47 |       .eq("team_id", teamId)
48 |       .gte("date", date?.from?.toISOString())
49 |       .lte("date", date?.to?.toISOString())
50 |       .eq("project_id", projectId)
51 |       .order("date");
52 |
53 |     if (!includeTeam) {
54 |       query.eq("assigned_id", userId);
55 |     }
56 |
57 |     const { data } = await query;
58 |
59 |     const formattedData = data?.map((item) => {
60 |       const formattedItem: Record<string, string | null> = {
61 |         Date: format(new Date(item.date), "P"),
62 |         Description: item.description,
63 |         Time: secondsToHoursAndMinutes(item.duration ?? 0),
64 |       };
65 |
66 |       if (includeTeam) {
67 |         formattedItem.Assigned = item.assigned?.full_name ?? null;
68 |       }
69 |
70 |       const { Date: date, Assigned, Description, Time } = formattedItem;
71 |
72 |       return includeTeam
73 |         ? { Date: date, Assigned, Description, Time }
74 |         : { Date: date, Description, Time };
75 |     });
76 |
77 |     const totalTimeInSeconds =
78 |       data?.reduce((sum, item) => sum + (item?.duration ?? 0), 0) ?? 0;
79 |
80 |     const dataWithFooter = [
81 |       ...(formattedData ?? []),
82 |       {
83 |         Date: "Total Time",
84 |         Assigned: null,
85 |         Description: null,
86 |         Time: secondsToHoursAndMinutes(totalTimeInSeconds),
87 |       },
88 |     ];
89 |
90 |     const csv = Papa.unparse(dataWithFooter);
91 |     const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
92 |     const link = document.createElement("a");
93 |     const url = URL.createObjectURL(blob);
94 |     link.href = url;
95 |
96 |     link.setAttribute("download", `${name}.csv`);
97 |
98 |     document.body.appendChild(link);
99 |     link.click();
100 |
101 |     document.body.removeChild(link);
102 |   }
103 |
104 |   return (
105 |     <DropdownMenuGroup>
106 |       <DropdownMenuSub>
107 |         <DropdownMenuSubTrigger>Export</DropdownMenuSubTrigger>
108 |         <DropdownMenuPortal>
109 |           <DropdownMenuSubContent>
110 |             <div className="pt-2 px-4">
111 |               <Select
112 |                 defaultValue="this-month"
113 |                 onValueChange={(value) => {
114 |                   const now = new UTCDate();
115 |                   if (value === "this-month") {
116 |                     const firstDayThisMonth = startOfMonth(now);
117 |                     const lastDayThisMonth = endOfMonth(now);
118 |                     setDate({
119 |                       from: firstDayThisMonth,
120 |                       to: lastDayThisMonth,
121 |                     });
122 |                   } else if (value === "last-month") {
123 |                     const firstDayLastMonth = startOfMonth(subMonths(now, 1));
124 |                     const lastDayLastMonth = endOfMonth(subMonths(now, 1));
125 |                     setDate({
126 |                       from: firstDayLastMonth,
127 |                       to: lastDayLastMonth,
128 |                     });
129 |                   }
130 |                 }}
131 |               >
132 |                 <SelectTrigger>
133 |                   <SelectValue placeholder="Select period" />
134 |                 </SelectTrigger>
135 |                 <SelectContent>
136 |                   <SelectItem value="this-month">This month</SelectItem>
137 |                   <SelectItem value="last-month">Last month</SelectItem>
138 |                 </SelectContent>
139 |               </Select>
140 |             </div>
141 |
142 |             <Calendar
143 |               mode="range"
144 |               selected={date}
145 |               onSelect={setDate}
146 |               disabled={(date) => date > new Date()}
147 |               defaultMonth={date?.from}
148 |             />
149 |
150 |             <div className="p-4 space-y-4">
151 |               <Button onClick={downloadCSV} className="w-full" disabled={!date}>
152 |                 Export
153 |               </Button>
154 |             </div>
155 |           </DropdownMenuSubContent>
156 |         </DropdownMenuPortal>
157 |       </DropdownMenuSub>
158 |     </DropdownMenuGroup>
159 |   );
160 | }
```

apps/dashboard/src/components/tracker-month-select.tsx
```
1 | import { useTrackerParams } from "@/hooks/use-tracker-params";
2 | import { TZDate } from "@date-fns/tz";
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import { Icons } from "@midday/ui/icons";
6 | import { addMonths, format, formatISO, startOfMonth } from "date-fns";
7 |
8 | type Props = {
9 |   className?: string;
10 |   dateFormat?: string;
11 | };
12 |
13 | export function TrackerMonthSelect({ className, dateFormat = "MMM" }: Props) {
14 |   const { date, setParams } = useTrackerParams();
15 |   const currentDate = date
16 |     ? new TZDate(date, "UTC")
17 |     : new TZDate(new Date(), "UTC");
18 |
19 |   const selectPrevMonth = () => {
20 |     setParams(
21 |       {
22 |         date: formatISO(startOfMonth(addMonths(currentDate, -1)), {
23 |           representation: "date",
24 |         }),
25 |       },
26 |       { shallow: false },
27 |     );
28 |   };
29 |
30 |   const selectNextMonth = () => {
31 |     setParams(
32 |       {
33 |         date: formatISO(startOfMonth(addMonths(currentDate, 1)), {
34 |           representation: "date",
35 |         }),
36 |       },
37 |       { shallow: false },
38 |     );
39 |   };
40 |
41 |   return (
42 |     <div className={cn("flex items-center border h-9", className)}>
43 |       <Button
44 |         variant="ghost"
45 |         size="icon"
46 |         className="p-0 w-6 h-6 hover:bg-transparent mr-4 ml-2"
47 |         onClick={selectPrevMonth}
48 |       >
49 |         <Icons.ChevronLeft className="w-6 h-6" />
50 |       </Button>
51 |       <span className="w-full text-center">
52 |         {format(currentDate, dateFormat)}
53 |       </span>
54 |       <Button
55 |         variant="ghost"
56 |         size="icon"
57 |         className="p-0 w-6 h-6 hover:bg-transparent ml-4 mr-2"
58 |         onClick={selectNextMonth}
59 |       >
60 |         <Icons.ChevronRight className="w-6 h-6" />
61 |       </Button>
62 |     </div>
63 |   );
64 | }
```

apps/dashboard/src/components/tracker-pagination.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Icons } from "@midday/ui/icons";
5 | import {
6 |   addMonths,
7 |   format,
8 |   formatISO,
9 |   startOfMonth,
10 |   subMonths,
11 | } from "date-fns";
12 |
13 | export function TrackerPagination({ numberOfMonths, onChange, startDate }) {
14 |   const selectPrevPeriod = () => {
15 |     onChange(
16 |       formatISO(startOfMonth(subMonths(startDate, numberOfMonths)), {
17 |         representation: "date",
18 |       })
19 |     );
20 |   };
21 |
22 |   const selectNextPeriod = () => {
23 |     onChange(
24 |       formatISO(startOfMonth(addMonths(startDate, numberOfMonths)), {
25 |         representation: "date",
26 |       })
27 |     );
28 |   };
29 |
30 |   return (
31 |     <div className="flex items-center border h-9">
32 |       <Button
33 |         variant="ghost"
34 |         size="icon"
35 |         className="p-0 w-6 h-6 hover:bg-transparent mr-4 ml-2"
36 |         onClick={selectPrevPeriod}
37 |       >
38 |         <Icons.ChevronLeft className="w-6 h-6" />
39 |       </Button>
40 |       <span className="w-full text-center">
41 |         {format(subMonths(startDate, numberOfMonths), "MMM")} -{" "}
42 |         {format(startDate, "MMM")}
43 |       </span>
44 |       <Button
45 |         variant="ghost"
46 |         size="icon"
47 |         className="p-0 w-6 h-6 hover:bg-transparent ml-4 mr-2"
48 |         onClick={selectNextPeriod}
49 |       >
50 |         <Icons.ChevronRight className="w-6 h-6" />
51 |       </Button>
52 |     </div>
53 |   );
54 | }
```

apps/dashboard/src/components/tracker-schedule.tsx
```
1 | "use client";
2 |
3 | import { createTrackerEntriesAction } from "@/actions/create-tracker-entries-action";
4 | import { deleteTrackerEntryAction } from "@/actions/delete-tracker-entry";
5 | import { useTrackerParams } from "@/hooks/use-tracker-params";
6 | import { secondsToHoursAndMinutes } from "@/utils/format";
7 | import {
8 |   NEW_EVENT_ID,
9 |   createNewEvent,
10 |   formatHour,
11 |   getDates,
12 |   getSlotFromDate,
13 |   getTimeFromDate,
14 |   transformTrackerData,
15 |   updateEventTime,
16 | } from "@/utils/tracker";
17 | import { createClient } from "@midday/supabase/client";
18 | import { getTrackerRecordsByDateQuery } from "@midday/supabase/queries";
19 | import { cn } from "@midday/ui/cn";
20 | import {
21 |   ContextMenu,
22 |   ContextMenuContent,
23 |   ContextMenuItem,
24 |   ContextMenuShortcut,
25 |   ContextMenuTrigger,
26 | } from "@midday/ui/context-menu";
27 | import { ScrollArea } from "@midday/ui/scroll-area";
28 | import {
29 |   addMinutes,
30 |   addSeconds,
31 |   differenceInSeconds,
32 |   endOfDay,
33 |   format,
34 |   parseISO,
35 |   setHours,
36 |   setMinutes,
37 |   startOfDay,
38 | } from "date-fns";
39 | import { useAction } from "next-safe-action/hooks";
40 | import React, { useEffect, useRef, useState } from "react";
41 | import { useHotkeys } from "react-hotkeys-hook";
42 | import { TrackerRecordForm } from "./forms/tracker-record-form";
43 | import { TrackerDaySelect } from "./tracker-day-select";
44 |
45 | interface TrackerRecord {
46 |   id: string;
47 |   start: Date;
48 |   end: Date;
49 |   project: {
50 |     id: string;
51 |     name: string;
52 |   };
53 |   description?: string;
54 | }
55 |
56 | const ROW_HEIGHT = 36;
57 | const SLOT_HEIGHT = 9;
58 |
59 | type Props = {
60 |   teamId: string;
61 |   userId: string;
62 |   timeFormat: number;
63 |   projectId?: string;
64 | };
65 |
66 | export function TrackerSchedule({
67 |   teamId,
68 |   userId,
69 |   timeFormat,
70 |   projectId,
71 | }: Props) {
72 |   const supabase = createClient();
73 |
74 |   const scrollRef = useRef<HTMLDivElement>(null);
75 |   const { selectedDate, range } = useTrackerParams();
76 |   const [selectedEvent, setSelectedEvent] = useState<TrackerRecord | null>(
77 |     null,
78 |   );
79 |   const hours = Array.from({ length: 24 }, (_, i) => i);
80 |   const [data, setData] = useState<TrackerRecord[]>([]);
81 |   const [isDragging, setIsDragging] = useState(false);
82 |   const [dragStartSlot, setDragStartSlot] = useState<number | null>(null);
83 |   const [totalDuration, setTotalDuration] = useState(0);
84 |   const [resizingEvent, setResizingEvent] = useState<TrackerRecord | null>(
85 |     null,
86 |   );
87 |   const [resizeStartY, setResizeStartY] = useState(0);
88 |   const [resizeType, setResizeType] = useState<"top" | "bottom" | null>(null);
89 |   const [movingEvent, setMovingEvent] = useState<TrackerRecord | null>(null);
90 |   const [moveStartY, setMoveStartY] = useState(0);
91 |   const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);
92 |   const [selectedProjectId, setSelectedProjectId] = useState<string | null>(
93 |     projectId ?? null,
94 |   );
95 |
96 |   const createTrackerEntries = useAction(createTrackerEntriesAction, {
97 |     onSuccess: (result) => {
98 |       if (!result.data) return;
99 |
100 |       setData((prevData) => {
101 |         const processedData = result?.data.map((event) =>
102 |           transformTrackerData(event, selectedDate),
103 |         );
104 |         return [
105 |           ...prevData.filter((event) => event.id !== NEW_EVENT_ID),
106 |           ...processedData,
107 |         ];
108 |       });
109 |
110 |       setTotalDuration((prevTotalDuration) => {
111 |         const newEventsDuration = result.data.reduce((total, event) => {
112 |           const start = event.start
113 |             ? new Date(event.start)
114 |             : new Date(`${event.date || selectedDate}T09:00:00`);
115 |           const end = event.stop
116 |             ? new Date(event.stop)
117 |             : addSeconds(start, event.duration || 0);
118 |           return total + differenceInSeconds(end, start);
119 |         }, 0);
120 |
121 |         return prevTotalDuration + newEventsDuration;
122 |       });
123 |
124 |       const lastEvent = result.data.at(-1);
125 |       setSelectedEvent(
126 |         lastEvent ? transformTrackerData(lastEvent, selectedDate) : null,
127 |       );
128 |     },
129 |   });
130 |
131 |   const deleteTrackerEntry = useAction(deleteTrackerEntryAction);
132 |
133 |   const sortedRange = range?.sort((a, b) => a.localeCompare(b));
134 |
135 |   useEffect(() => {
136 |     const fetchData = async () => {
137 |       const trackerData = await getTrackerRecordsByDateQuery(supabase, {
138 |         teamId,
139 |         userId,
140 |         date: selectedDate,
141 |       });
142 |
143 |       if (trackerData?.data) {
144 |         const processedData = trackerData.data.map((event: any) =>
145 |           transformTrackerData(event, selectedDate),
146 |         );
147 |
148 |         setData(processedData);
149 |         setTotalDuration(trackerData.meta?.totalDuration || 0);
150 |       } else {
151 |         setData([]);
152 |         setTotalDuration(0);
153 |       }
154 |     };
155 |
156 |     if (selectedDate) {
157 |       fetchData();
158 |     }
159 |   }, [selectedDate, teamId]);
160 |
161 |   useEffect(() => {
162 |     if (scrollRef.current) {
163 |       const currentHour = new Date().getHours();
164 |       if (currentHour >= 12) {
165 |         scrollRef.current.scrollTo({
166 |           top: scrollRef.current.scrollHeight,
167 |         });
168 |       } else {
169 |         scrollRef.current.scrollTo({
[TRUNCATED]
```

apps/dashboard/src/components/tracker-search-filter.tsx
```
1 | "use client";
2 |
3 | import { generateTrackerFilters } from "@/actions/ai/filters/generate-tracker-filters";
4 | import { Calendar } from "@midday/ui/calendar";
5 | import { cn } from "@midday/ui/cn";
6 | import {
7 |   DropdownMenu,
8 |   DropdownMenuCheckboxItem,
9 |   DropdownMenuContent,
10 |   DropdownMenuGroup,
11 |   DropdownMenuItem,
12 |   DropdownMenuPortal,
13 |   DropdownMenuSub,
14 |   DropdownMenuSubContent,
15 |   DropdownMenuSubTrigger,
16 |   DropdownMenuTrigger,
17 | } from "@midday/ui/dropdown-menu";
18 | import { Icons } from "@midday/ui/icons";
19 | import { Input } from "@midday/ui/input";
20 | import { readStreamableValue } from "ai/rsc";
21 | import { formatISO } from "date-fns";
22 | import {
23 |   parseAsArrayOf,
24 |   parseAsString,
25 |   parseAsStringLiteral,
26 |   useQueryStates,
27 | } from "nuqs";
28 | import { useRef, useState } from "react";
29 | import { useHotkeys } from "react-hotkeys-hook";
30 | import { FilterList } from "./filter-list";
31 |
32 | type Props = {
33 |   members?: {
34 |     id: string;
35 |     name: string;
36 |   }[];
37 |   customers?: {
38 |     id: string | null;
39 |     name: string | null;
40 |   }[];
41 | };
42 |
43 | const defaultSearch = {
44 |   q: null,
45 |   start: null,
46 |   end: null,
47 |   assignees: null,
48 |   statuses: null,
49 | };
50 |
51 | const statusFilters = [
52 |   { id: "in_progress", name: "In Progress" },
53 |   { id: "completed", name: "Completed" },
54 | ];
55 |
56 | export function TrackerSearchFilter({
57 |   members,
58 |   customers: customersData,
59 | }: Props) {
60 |   const [prompt, setPrompt] = useState("");
61 |   const inputRef = useRef<HTMLInputElement>(null);
62 |   const [streaming, setStreaming] = useState(false);
63 |   const [isOpen, setIsOpen] = useState(false);
64 |
65 |   const [filters, setFilters] = useQueryStates(
66 |     {
67 |       q: parseAsString,
68 |       start: parseAsString,
69 |       end: parseAsString,
70 |       statuses: parseAsArrayOf(
71 |         parseAsStringLiteral(["in_progress", "completed"]),
72 |       ),
73 |       customers: parseAsArrayOf(parseAsString),
74 |     },
75 |     {
76 |       shallow: false,
77 |     },
78 |   );
79 |
80 |   useHotkeys(
81 |     "esc",
82 |     () => {
83 |       setPrompt("");
84 |       setFilters(defaultSearch);
85 |       setIsOpen(false);
86 |     },
87 |     {
88 |       enableOnFormTags: true,
89 |     },
90 |   );
91 |
92 |   useHotkeys("meta+s", (evt) => {
93 |     evt.preventDefault();
94 |     inputRef.current?.focus();
95 |   });
96 |
97 |   useHotkeys("meta+f", (evt) => {
98 |     evt.preventDefault();
99 |     setIsOpen((prev) => !prev);
100 |   });
101 |
102 |   const handleSearch = (evt: React.ChangeEvent<HTMLInputElement>) => {
103 |     const value = evt.target.value;
104 |
105 |     if (value) {
106 |       setPrompt(value);
107 |     } else {
108 |       setFilters(defaultSearch);
109 |       setPrompt("");
110 |     }
111 |   };
112 |
113 |   const handleSubmit = async () => {
114 |     // If the user is typing a query with multiple words, we want to stream the results
115 |     if (prompt.split(" ").length > 1) {
116 |       setStreaming(true);
117 |
118 |       const { object } = await generateTrackerFilters(
119 |         prompt,
120 |         `Customers: ${customersData?.map((customer) => customer.name).join(", ")}`,
121 |       );
122 |
123 |       let finalObject = {};
124 |
125 |       for await (const partialObject of readStreamableValue(object)) {
126 |         if (partialObject) {
127 |           finalObject = {
128 |             ...finalObject,
129 |             ...partialObject,
130 |             statuses: partialObject?.status ? [partialObject.status] : null,
131 |             start: partialObject?.start ?? null,
132 |             end: partialObject?.end ?? null,
133 |             q: partialObject?.name ?? null,
134 |             customers:
135 |               partialObject?.customers?.map(
136 |                 (name: string) =>
137 |                   customersData?.find((customer) => customer.name === name)?.id,
138 |               ) ?? null,
139 |           };
140 |         }
141 |       }
142 |
143 |       setFilters({
144 |         q: null,
145 |         ...finalObject,
146 |       });
147 |
148 |       setStreaming(false);
149 |     } else {
150 |       setFilters({ q: prompt.length > 0 ? prompt : null });
151 |     }
152 |   };
153 |
154 |   const hasValidFilters =
155 |     Object.entries(filters).filter(
156 |       ([key, value]) => value !== null && key !== "q",
157 |     ).length > 0;
158 |
159 |   return (
160 |     <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>
161 |       <div className="flex space-x-4 items-center">
162 |         <FilterList
163 |           filters={filters}
164 |           loading={streaming}
165 |           onRemove={setFilters}
166 |           members={members}
167 |           customers={customersData}
168 |           statusFilters={statusFilters}
169 |         />
170 |
171 |         <form
172 |           className="relative"
173 |           onSubmit={(e) => {
174 |             e.preventDefault();
175 |             handleSubmit();
176 |           }}
177 |         >
178 |           <Icons.Search className="absolute pointer-events-none left-3 top-[11px]" />
179 |           <Input
180 |             ref={inputRef}
181 |             placeholder="Search or type filter"
182 |             className="pl-9 w-full md:w-[350px] pr-8"
183 |             value={prompt}
184 |             onChange={handleSearch}
185 |             autoComplete="off"
186 |             autoCapitalize="none"
187 |             autoCorrect="off"
188 |             spellCheck="false"
189 |           />
190 |
[TRUNCATED]
```

apps/dashboard/src/components/tracker-select-project.tsx
```
1 | "use client";
2 |
3 | import { createProjectAction } from "@/actions/project/create-project-action";
4 | import { createClient } from "@midday/supabase/client";
5 | import { getTrackerProjectsQuery } from "@midday/supabase/queries";
6 | import { Combobox } from "@midday/ui/combobox";
7 | import { useToast } from "@midday/ui/use-toast";
8 | import { useAction } from "next-safe-action/hooks";
9 | import { useEffect, useState } from "react";
10 |
11 | type Props = {
12 |   teamId: string;
13 |   selectedId?: string;
14 |   onSelect: (selected: Option) => void;
15 |   onCreate: (project: { id: string; name: string }) => void;
16 | };
17 |
18 | type Option = {
19 |   id: string;
20 |   name: string;
21 | };
22 |
23 | export function TrackerSelectProject({
24 |   teamId,
25 |   selectedId,
26 |   onSelect,
27 |   onCreate,
28 | }: Props) {
29 |   const { toast } = useToast();
30 |   const supabase = createClient();
31 |   const [data, setData] = useState([]);
32 |   const [isLoading, setLoading] = useState(false);
33 |   const [value, setValue] = useState<Option | undefined>();
34 |
35 |   useEffect(() => {
36 |     const foundProject = data?.find((project) => project?.id === selectedId);
37 |
38 |     if (foundProject) {
39 |       setValue({ id: foundProject.id, name: foundProject.name });
40 |     }
41 |   }, [selectedId]);
42 |
43 |   const handleSelect = (selected: Option) => {
44 |     setValue(selected);
45 |     onSelect(selected);
46 |   };
47 |
48 |   const createProject = useAction(createProjectAction, {
49 |     onSuccess: ({ data: project }) => {
50 |       onCreate?.(project);
51 |       handleSelect(project);
52 |     },
53 |     onError: () => {
54 |       toast({
55 |         duration: 3500,
56 |         variant: "error",
57 |         title: "Something went wrong please try again.",
58 |       });
59 |     },
60 |   });
61 |
62 |   const fetchProjects = async () => {
63 |     setLoading(true);
64 |
65 |     const { data: projectsData } = await getTrackerProjectsQuery(supabase, {
66 |       teamId,
67 |       sort: ["status", "asc"],
68 |     });
69 |
70 |     setLoading(false);
71 |     setData(projectsData);
72 |
73 |     const foundProject = projectsData.find(
74 |       (project) => project?.id === selectedId,
75 |     );
76 |
77 |     if (foundProject) {
78 |       setValue({
79 |         id: foundProject.id,
80 |         name: foundProject.customer?.name
81 |           ? `${foundProject.name} · ${foundProject.customer.name}`
82 |           : foundProject.name,
83 |       });
84 |     }
85 |   };
86 |
87 |   useEffect(() => {
88 |     fetchProjects();
89 |   }, []);
90 |
91 |   return (
92 |     <Combobox
93 |       key={value?.id}
94 |       placeholder="Search or create project"
95 |       classNameList="-top-[4px] border-t-0 rounded-none rounded-b-md"
96 |       className="w-full bg-transparent px-12 border py-3"
97 |       onSelect={handleSelect}
98 |       options={data}
99 |       value={value}
100 |       isLoading={isLoading}
101 |       onCreate={(name) => createProject.execute({ name })}
102 |     />
103 |   );
104 | }
```

apps/dashboard/src/components/tracker-status.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { cn } from "@midday/ui/cn";
5 |
6 | export function TrackerStatus({ status }) {
7 |   const t = useI18n();
8 |
9 |   return (
10 |     <div className="flex items-center space-x-4">
11 |       <div
12 |         className={cn(
13 |           "w-[6px] h-[6px] rounded-full bg-[#FFD02B]",
14 |           status === "completed" && "bg-primary"
15 |         )}
16 |       />
17 |       <span>{t(`tracker_status.${status}`)}</span>
18 |     </div>
19 |   );
20 | }
```

apps/dashboard/src/components/transaction-bank-account.tsx
```
1 | import { BankLogo } from "@/components/bank-logo";
2 | import { cn } from "@midday/ui/cn";
3 |
4 | type Props = {
5 |   logoUrl?: string;
6 |   name?: string;
7 |   size?: number;
8 |   className?: string;
9 | };
10 |
11 | export function TransactionBankAccount({
12 |   logoUrl,
13 |   name,
14 |   size = 20,
15 |   className,
16 | }: Props) {
17 |   return (
18 |     <div className="flex space-x-2 mt-1 items-center">
19 |       {logoUrl && (
20 |         <div className="rounded-full overflow-hidden">
21 |           <BankLogo size={size} src={logoUrl} alt={name ?? ""} />
22 |         </div>
23 |       )}
24 |       <span className={cn("text-sm line-clamp-1", className)}>{name}</span>
25 |     </div>
26 |   );
27 | }
```

apps/dashboard/src/components/transaction-details.tsx
```
1 | import { createAttachmentsAction } from "@/actions/create-attachments-action";
2 | import { createTransactionTagAction } from "@/actions/create-transaction-tag-action";
3 | import { deleteTransactionTagAction } from "@/actions/delete-transaction-tag-action";
4 | import type { UpdateTransactionValues } from "@/actions/schema";
5 | import { updateSimilarTransactionsCategoryAction } from "@/actions/update-similar-transactions-action";
6 | import { updateSimilarTransactionsRecurringAction } from "@/actions/update-similar-transactions-recurring";
7 | import { useUserContext } from "@/store/user/hook";
8 | import { createClient } from "@midday/supabase/client";
9 | import { getTransactionQuery } from "@midday/supabase/queries";
10 | import { getSimilarTransactions } from "@midday/supabase/queries";
11 | import {
12 |   Accordion,
13 |   AccordionContent,
14 |   AccordionItem,
15 |   AccordionTrigger,
16 | } from "@midday/ui/accordion";
17 | import { cn } from "@midday/ui/cn";
18 | import { Label } from "@midday/ui/label";
19 | import {
20 |   Select,
21 |   SelectContent,
22 |   SelectGroup,
23 |   SelectItem,
24 |   SelectTrigger,
25 |   SelectValue,
26 | } from "@midday/ui/select";
27 | import { Skeleton } from "@midday/ui/skeleton";
28 | import { Switch } from "@midday/ui/switch";
29 | import { ToastAction } from "@midday/ui/toast";
30 | import { useToast } from "@midday/ui/use-toast";
31 | import { format } from "date-fns";
32 | import { useAction } from "next-safe-action/hooks";
33 | import { useQueryState } from "nuqs";
34 | import { useEffect, useState } from "react";
35 | import { useHotkeys } from "react-hotkeys-hook";
36 | import { AssignUser } from "./assign-user";
37 | import { Attachments } from "./attachments";
38 | import { FormatAmount } from "./format-amount";
39 | import { Note } from "./note";
40 | import { SelectCategory } from "./select-category";
41 | import { SelectTags } from "./select-tags";
42 | import { TransactionBankAccount } from "./transaction-bank-account";
43 |
44 | type Props = {
45 |   data: any;
46 |   ids?: string[];
47 |   updateTransaction: (
48 |     values: UpdateTransactionValues,
49 |     optimisticData: any,
50 |   ) => void;
51 | };
52 |
53 | export function TransactionDetails({
54 |   data: initialData,
55 |   ids,
56 |   updateTransaction,
57 | }: Props) {
58 |   const [data, setData] = useState(initialData);
59 |   const [transactionId, setTransactionId] = useQueryState("id");
60 |   const { toast } = useToast();
61 |   const supabase = createClient();
62 |   const [isLoading, setLoading] = useState(true);
63 |   const updateSimilarTransactionsCategory = useAction(
64 |     updateSimilarTransactionsCategoryAction,
65 |   );
66 |   const updateSimilarTransactionsRecurring = useAction(
67 |     updateSimilarTransactionsRecurringAction,
68 |   );
69 |   const createAttachments = useAction(createAttachmentsAction);
70 |   const createTransactionTag = useAction(createTransactionTagAction);
71 |   const deleteTransactionTag = useAction(deleteTransactionTagAction);
72 |
73 |   const { team_id: teamId } = useUserContext((state) => state.data);
74 |
75 |   useHotkeys("esc", () => setTransactionId(null));
76 |
77 |   const enabled = Boolean(ids?.length);
78 |
79 |   useHotkeys(
80 |     "ArrowUp, ArrowDown",
81 |     ({ key }) => {
82 |       if (key === "ArrowUp") {
83 |         const currentIndex = ids?.indexOf(data?.id) ?? 0;
84 |         const prevId = ids[currentIndex - 1];
85 |
86 |         if (prevId) {
87 |           setTransactionId(prevId);
88 |         }
89 |       }
90 |
91 |       if (key === "ArrowDown") {
92 |         const currentIndex = ids?.indexOf(data?.id) ?? 0;
93 |         const nextId = ids[currentIndex + 1];
94 |
95 |         if (nextId) {
96 |           setTransactionId(nextId);
97 |         }
98 |       }
99 |     },
100 |     { enabled },
101 |   );
102 |
103 |   useEffect(() => {
104 |     if (initialData) {
105 |       setData(initialData);
106 |       setLoading(false);
107 |     }
108 |   }, [initialData]);
109 |
110 |   useEffect(() => {
111 |     async function fetchData() {
112 |       try {
113 |         const transaction = await getTransactionQuery(supabase, data?.id);
114 |         setData(transaction);
115 |         setLoading(false);
116 |       } catch {
117 |         setLoading(false);
118 |       }
119 |     }
120 |
121 |     if (!data) {
122 |       fetchData();
123 |     }
124 |   }, [data]);
125 |
126 |   const handleOnChangeCategory = async (category: {
127 |     id: string;
128 |     name: string;
129 |     slug: string;
130 |     color: string;
131 |   }) => {
132 |     updateTransaction(
133 |       { id: data?.id, category_slug: category.slug },
134 |       { category },
135 |     );
136 |
137 |     const transactions = await getSimilarTransactions(supabase, {
138 |       name: data?.name,
139 |       teamId: teamId,
140 |     });
141 |
142 |     if (transactions?.data && transactions.data.length > 1) {
143 |       toast({
144 |         duration: 6000,
145 |         variant: "ai",
146 |         title: "Midday AI",
147 |         description: `Do you want to mark ${transactions?.data?.length} similar transactions from ${data?.name} as ${category.name} too?`,
148 |         footer: (
149 |           <div className="flex space-x-2 mt-4">
150 |             <ToastAction altText="Cancel" className="pl-5 pr-5">
151 |               Cancel
152 |             </ToastAction>
153 |             <ToastAction
154 |               altText="Yes"
155 |               onClick={() => {
156 |                 updateSimilarTransactionsCategory.execute({ id: data?.id });
157 |               }}
158 |               className="pl-5 pr-5 bg-primary text-primary-foreground hover:bg-primary/90"
159 |             >
160 |               Yes
161 |             </ToastAction>
162 |           </div>
163 |         ),
164 |       });
165 |     }
166 |   };
[TRUNCATED]
```

apps/dashboard/src/components/transaction-method.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 |
5 | export function TransactionMethod({ method }) {
6 |   const t = useI18n();
7 |
8 |   return t(`transaction_methods.${method}`);
9 | }
```

apps/dashboard/src/components/transaction-status.tsx
```
1 | import { Icons } from "@midday/ui/icons";
2 | import {
3 |   Tooltip,
4 |   TooltipContent,
5 |   TooltipProvider,
6 |   TooltipTrigger,
7 | } from "@midday/ui/tooltip";
8 |
9 | type Props = {
10 |   fullfilled: boolean;
11 | };
12 |
13 | export function TransactionStatus({ fullfilled }: Props) {
14 |   if (fullfilled) {
15 |     return (
16 |       <div className="flex justify-end">
17 |         <Icons.Check />
18 |       </div>
19 |     );
20 |   }
21 |
22 |   return (
23 |     <div className="flex justify-end">
24 |       <TooltipProvider delayDuration={50}>
25 |         <Tooltip>
26 |           <TooltipTrigger>
27 |             <Icons.AlertCircle />
28 |           </TooltipTrigger>
29 |           <TooltipContent
30 |             className="px-3 py-1.5 text-xs"
31 |             side="left"
32 |             sideOffset={10}
33 |           >
34 |             Missing receipt
35 |           </TooltipContent>
36 |         </Tooltip>
37 |       </TooltipProvider>
38 |     </div>
39 |   );
40 | }
```

apps/dashboard/src/components/transactions-actions.tsx
```
1 | "use client";
2 |
3 | import { deleteTransactionsAction } from "@/actions/delete-transactions-action";
4 | import { AddTransactions } from "@/components/add-transactions";
5 | import { BulkActions } from "@/components/bulk-actions";
6 | import { ColumnVisibility } from "@/components/column-visibility";
7 | import { useTransactionsStore } from "@/store/transactions";
8 | import {
9 |   AlertDialog,
10 |   AlertDialogAction,
11 |   AlertDialogCancel,
12 |   AlertDialogContent,
13 |   AlertDialogDescription,
14 |   AlertDialogFooter,
15 |   AlertDialogHeader,
16 |   AlertDialogTitle,
17 |   AlertDialogTrigger,
18 | } from "@midday/ui/alert-dialog";
19 | import { Button } from "@midday/ui/button";
20 | import { Icons } from "@midday/ui/icons";
21 | import { useToast } from "@midday/ui/use-toast";
22 | import { Loader2 } from "lucide-react";
23 | import { useAction } from "next-safe-action/hooks";
24 |
25 | type Props = {
26 |   isEmpty: boolean;
27 |   tags: { id: string; name: string }[];
28 | };
29 |
30 | export function TransactionsActions({ isEmpty, tags }: Props) {
31 |   const { toast } = useToast();
32 |   const { setRowSelection, canDelete, rowSelection } = useTransactionsStore();
33 |
34 |   const transactionIds = Object.keys(rowSelection);
35 |
36 |   const deleteTransactions = useAction(deleteTransactionsAction, {
37 |     onSuccess: () => {
38 |       setRowSelection({});
39 |     },
40 |     onError: () => {
41 |       toast({
42 |         duration: 3500,
43 |         variant: "error",
44 |         title: "Something went wrong please try again.",
45 |       });
46 |     },
47 |   });
48 |
49 |   if (transactionIds?.length) {
50 |     return (
51 |       <AlertDialog>
52 |         <div className="ml-auto">
53 |           <div className="flex items-center">
54 |             <span className="text-sm text-[#606060] w-full">Bulk edit</span>
55 |             <div className="h-8 w-[1px] bg-border ml-4 mr-4" />
56 |
57 |             <div className="flex space-x-2">
58 |               <BulkActions ids={transactionIds} tags={tags} />
59 |
60 |               <div>
61 |                 {canDelete && (
62 |                   <AlertDialogTrigger asChild>
63 |                     <Button
64 |                       size="icon"
65 |                       variant="destructive"
66 |                       className="bg-transparent border border-destructive hover:bg-transparent"
67 |                     >
68 |                       <Icons.Delete className="text-destructive" size={18} />
69 |                     </Button>
70 |                   </AlertDialogTrigger>
71 |                 )}
72 |               </div>
73 |             </div>
74 |           </div>
75 |         </div>
76 |
77 |         <AlertDialogContent>
78 |           <AlertDialogHeader>
79 |             <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
80 |             <AlertDialogDescription>
81 |               This action cannot be undone. This will permanently delete your
82 |               transactions.
83 |             </AlertDialogDescription>
84 |           </AlertDialogHeader>
85 |           <AlertDialogFooter>
86 |             <AlertDialogCancel>Cancel</AlertDialogCancel>
87 |             <AlertDialogAction
88 |               onClick={() => {
89 |                 deleteTransactions.execute({ ids: transactionIds });
90 |               }}
91 |             >
92 |               {deleteTransactions.status === "executing" ? (
93 |                 <Loader2 className="h-4 w-4 animate-spin" />
94 |               ) : (
95 |                 "Confirm"
96 |               )}
97 |             </AlertDialogAction>
98 |           </AlertDialogFooter>
99 |         </AlertDialogContent>
100 |       </AlertDialog>
101 |     );
102 |   }
103 |
104 |   return (
105 |     <div className="space-x-2 hidden md:flex">
106 |       <ColumnVisibility disabled={isEmpty} />
107 |       <AddTransactions />
108 |     </div>
109 |   );
110 | }
```

apps/dashboard/src/components/transactions-search-filter.tsx
```
1 | "use client";
2 |
3 | import { generateTransactionsFilters } from "@/actions/ai/filters/generate-transactions-filters";
4 | import { formatAccountName } from "@/utils/format";
5 | import { Calendar } from "@midday/ui/calendar";
6 | import { cn } from "@midday/ui/cn";
7 | import {
8 |   DropdownMenu,
9 |   DropdownMenuCheckboxItem,
10 |   DropdownMenuContent,
11 |   DropdownMenuGroup,
12 |   DropdownMenuPortal,
13 |   DropdownMenuSub,
14 |   DropdownMenuSubContent,
15 |   DropdownMenuSubTrigger,
16 |   DropdownMenuTrigger,
17 | } from "@midday/ui/dropdown-menu";
18 | import { Icons } from "@midday/ui/icons";
19 | import { Input } from "@midday/ui/input";
20 | import { readStreamableValue } from "ai/rsc";
21 | import { formatISO } from "date-fns";
22 | import {
23 |   parseAsArrayOf,
24 |   parseAsInteger,
25 |   parseAsString,
26 |   parseAsStringLiteral,
27 |   useQueryStates,
28 | } from "nuqs";
29 | import { useRef, useState } from "react";
30 | import { useHotkeys } from "react-hotkeys-hook";
31 | import { AmountRange } from "./amount-range";
32 | import { FilterList } from "./filter-list";
33 | import { SelectCategory } from "./select-category";
34 |
35 | type Props = {
36 |   placeholder: string;
37 |   categories?: {
38 |     id: string;
39 |     slug: string;
40 |     name: string;
41 |   }[];
42 |   accounts?: {
43 |     id: string;
44 |     name: string;
45 |     currency: string;
46 |   }[];
47 |   members?: {
48 |     id: string;
49 |     name: string;
50 |   }[];
51 |   tags?: {
52 |     id: string;
53 |     name: string;
54 |   }[];
55 | };
56 |
57 | const defaultSearch = {
58 |   q: null,
59 |   attachments: null,
60 |   start: null,
61 |   end: null,
62 |   categories: null,
63 |   accounts: null,
64 |   assignees: null,
65 |   statuses: null,
66 |   recurring: null,
67 | };
68 |
69 | const statusFilters = [
70 |   { id: "completed", name: "Completed" },
71 |   { id: "uncompleted", name: "Uncompleted" },
72 |   { id: "archived", name: "Archived" },
73 |   { id: "excluded", name: "Excluded" },
74 | ];
75 |
76 | const attachmentsFilters = [
77 |   { id: "include", name: "Has attachments" },
78 |   { id: "exclude", name: "No attachments" },
79 | ];
80 |
81 | const recurringFilters = [
82 |   { id: "all", name: "All recurring" },
83 |   { id: "weekly", name: "Weekly recurring" },
84 |   { id: "monthly", name: "Monthly recurring" },
85 |   { id: "annually", name: "Annually recurring" },
86 | ];
87 |
88 | const PLACEHOLDERS = [
89 |   "Software and taxes last month",
90 |   "Income last year",
91 |   "Software last Q4",
92 |   "From Google without receipt",
93 |   "Search or filter",
94 |   "Without receipts this month",
95 | ];
96 |
97 | const placeholder =
98 |   PLACEHOLDERS[Math.floor(Math.random() * PLACEHOLDERS.length)];
99 |
100 | export function TransactionsSearchFilter({
101 |   categories,
102 |   accounts,
103 |   members,
104 |   tags,
105 | }: Props) {
106 |   const [prompt, setPrompt] = useState("");
107 |   const inputRef = useRef<HTMLInputElement>(null);
108 |   const [streaming, setStreaming] = useState(false);
109 |   const [isOpen, setIsOpen] = useState(false);
110 |
111 |   const [filters, setFilters] = useQueryStates(
112 |     {
113 |       q: parseAsString,
114 |       attachments: parseAsStringLiteral(["exclude", "include"] as const),
115 |       start: parseAsString,
116 |       end: parseAsString,
117 |       categories: parseAsArrayOf(parseAsString),
118 |       tags: parseAsArrayOf(parseAsString),
119 |       accounts: parseAsArrayOf(parseAsString),
120 |       assignees: parseAsArrayOf(parseAsString),
121 |       amount_range: parseAsArrayOf(parseAsInteger),
122 |       recurring: parseAsArrayOf(
123 |         parseAsStringLiteral(["all", "weekly", "monthly", "annually"] as const),
124 |       ),
125 |       statuses: parseAsArrayOf(
126 |         parseAsStringLiteral([
127 |           "completed",
128 |           "uncompleted",
129 |           "archived",
130 |           "excluded",
131 |         ] as const),
132 |       ),
133 |     },
134 |     {
135 |       shallow: false,
136 |       history: "push",
137 |     },
138 |   );
139 |
140 |   useHotkeys(
141 |     "esc",
142 |     () => {
143 |       setPrompt("");
144 |       setFilters(defaultSearch);
145 |       setIsOpen(false);
146 |     },
147 |     {
148 |       enableOnFormTags: true,
149 |       enabled: Boolean(prompt),
150 |     },
151 |   );
152 |
153 |   useHotkeys("meta+s", (evt) => {
154 |     evt.preventDefault();
155 |     inputRef.current?.focus();
156 |   });
157 |
158 |   useHotkeys("meta+f", (evt) => {
159 |     evt.preventDefault();
160 |     setIsOpen((prev) => !prev);
161 |   });
162 |
163 |   const handleSearch = (evt: React.ChangeEvent<HTMLInputElement>) => {
164 |     const value = evt.target.value;
165 |
166 |     if (value) {
167 |       setPrompt(value);
168 |     } else {
169 |       setFilters(defaultSearch);
170 |       setPrompt("");
171 |     }
172 |   };
173 |
174 |   const handleSubmit = async () => {
175 |     // If the user is typing a query with multiple words, we want to stream the results
176 |     if (prompt.split(" ").length > 1) {
177 |       setStreaming(true);
178 |
179 |       const { object } = await generateTransactionsFilters(
180 |         prompt,
181 |         `
182 |           Categories: ${categories?.map((category) => category.name).join(", ")}
183 |           Tags: ${tags?.map((tag) => tag.name).join(", ")}
184 |         `,
185 |       );
186 |
187 |       let finalObject = {};
188 |
189 |       for await (const partialObject of readStreamableValue(object)) {
[TRUNCATED]
```

apps/dashboard/src/components/unenroll-mfa.tsx
```
1 | import { Suspense } from "react";
2 | import { MFAList, MFAListSkeleton } from "./mfa-list";
3 |
4 | export function UnenrollMFA() {
5 |   return (
6 |     <Suspense fallback={<MFAListSkeleton />}>
7 |       <MFAList />
8 |     </Suspense>
9 |   );
10 | }
```

apps/dashboard/src/components/user-avatar.tsx
```
1 | "use client";
2 |
3 | import {
4 |   Card,
5 |   CardDescription,
6 |   CardFooter,
7 |   CardHeader,
8 |   CardTitle,
9 | } from "@midday/ui/card";
10 | import { AvatarUpload } from "./avatar-upload";
11 |
12 | type Props = {
13 |   userId: string;
14 |   avatarUrl: string;
15 |   fullName: string;
16 | };
17 |
18 | export function UserAvatar({ userId, avatarUrl, fullName }: Props) {
19 |   return (
20 |     <Card>
21 |       <div className="flex justify-between items-center pr-6">
22 |         <CardHeader>
23 |           <CardTitle>Avatar</CardTitle>
24 |           <CardDescription>
25 |             This is your avatar. Click on the avatar to upload a custom one from
26 |             your files.
27 |           </CardDescription>
28 |         </CardHeader>
29 |
30 |         <AvatarUpload
31 |           userId={userId}
32 |           avatarUrl={avatarUrl}
33 |           fullName={fullName}
34 |         />
35 |       </div>
36 |       <CardFooter>An avatar is optional but strongly recommended.</CardFooter>
37 |     </Card>
38 |   );
39 | }
```

apps/dashboard/src/components/user-menu.tsx
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
3 | import {
4 |   DropdownMenu,
5 |   DropdownMenuContent,
6 |   DropdownMenuGroup,
7 |   DropdownMenuItem,
8 |   DropdownMenuLabel,
9 |   DropdownMenuSeparator,
10 |   DropdownMenuShortcut,
11 |   DropdownMenuTrigger,
12 | } from "@midday/ui/dropdown-menu";
13 | import Link from "next/link";
14 | import { SignOut } from "./sign-out";
15 | import { ThemeSwitch } from "./theme-switch";
16 |
17 | export async function UserMenu({ onlySignOut }) {
18 |   const { data: userData } = await getUser();
19 |
20 |   return (
21 |     <DropdownMenu>
22 |       <DropdownMenuTrigger asChild>
23 |         <Avatar className="rounded-full w-8 h-8 cursor-pointer">
24 |           {userData?.avatar_url && (
25 |             <AvatarImageNext
26 |               src={userData?.avatar_url}
27 |               alt={userData?.full_name}
28 |               width={32}
29 |               height={32}
30 |               quality={100}
31 |             />
32 |           )}
33 |           <AvatarFallback>
34 |             <span className="text-xs">
35 |               {userData?.full_name?.charAt(0)?.toUpperCase()}
36 |             </span>
37 |           </AvatarFallback>
38 |         </Avatar>
39 |       </DropdownMenuTrigger>
40 |       <DropdownMenuContent className="w-[240px]" sideOffset={10} align="end">
41 |         {!onlySignOut && (
42 |           <>
43 |             <DropdownMenuLabel>
44 |               <div className="flex justify-between items-center">
45 |                 <div className="flex flex-col">
46 |                   <span className="truncate line-clamp-1 max-w-[155px] block">
47 |                     {userData?.full_name}
48 |                   </span>
49 |                   <span className="truncate text-xs text-[#606060] font-normal">
50 |                     {userData.email}
51 |                   </span>
52 |                 </div>
53 |                 <div className="border py-0.5 px-3 rounded-full text-[11px] font-normal">
54 |                   Beta
55 |                 </div>
56 |               </div>
57 |             </DropdownMenuLabel>
58 |
59 |             <DropdownMenuSeparator />
60 |
61 |             <DropdownMenuGroup>
62 |               <Link prefetch href="/account">
63 |                 <DropdownMenuItem>
64 |                   Account
65 |                   <DropdownMenuShortcut>⇧⌘P</DropdownMenuShortcut>
66 |                 </DropdownMenuItem>
67 |               </Link>
68 |
69 |               <Link prefetch href="/account/support">
70 |                 <DropdownMenuItem>Support</DropdownMenuItem>
71 |               </Link>
72 |
73 |               <Link prefetch href="/account/teams">
74 |                 <DropdownMenuItem>
75 |                   Teams
76 |                   <DropdownMenuShortcut>⌘E</DropdownMenuShortcut>
77 |                 </DropdownMenuItem>
78 |               </Link>
79 |             </DropdownMenuGroup>
80 |
81 |             <DropdownMenuSeparator />
82 |             <div className="flex flex-row justify-between items-center p-2">
83 |               <p className="text-sm">Theme</p>
84 |               <ThemeSwitch />
85 |             </div>
86 |             <DropdownMenuSeparator />
87 |           </>
88 |         )}
89 |
90 |         <SignOut />
91 |       </DropdownMenuContent>
92 |     </DropdownMenu>
93 |   );
94 | }
```

apps/dashboard/src/components/vat-assistant.tsx
```
1 | import { getVatRateAction } from "@/actions/ai/get-vat-rate";
2 | import { Experimental } from "@/components/experimental";
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import { Icons } from "@midday/ui/icons";
6 | import {
7 |   Tooltip,
8 |   TooltipContent,
9 |   TooltipProvider,
10 |   TooltipTrigger,
11 | } from "@midday/ui/tooltip";
12 | import { useAction } from "next-safe-action/hooks";
13 | import { useEffect, useState } from "react";
14 |
15 | type Props = {
16 |   name?: string;
17 |   value?: string | null;
18 |   onSelect: (value: number) => void;
19 |   isFocused: boolean;
20 | };
21 |
22 | export function VatAssistant({ name, onSelect, isFocused, value }: Props) {
23 |   const [result, setResult] = useState<
24 |     { vat: number; country: string } | undefined
25 |   >();
26 |   const [isLoading, setLoading] = useState(false);
27 |
28 |   const getVatRate = useAction(getVatRateAction, {
29 |     onSuccess: ({ data }) => {
30 |       setLoading(false);
31 |
32 |       if (data) {
33 |         setResult(data);
34 |       }
35 |     },
36 |     onError: () => {
37 |       setLoading(false);
38 |     },
39 |   });
40 |
41 |   const handleOnSelect = () => {
42 |     if (result?.vat) {
43 |       onSelect(result.vat);
44 |     }
45 |   };
46 |
47 |   useEffect(() => {
48 |     if (isFocused && name && name.length > 2 && !value) {
49 |       setLoading(true);
50 |       getVatRate.execute({ name });
51 |     }
52 |   }, [isFocused, name]);
53 |
54 |   return (
55 |     <TooltipProvider delayDuration={0}>
56 |       <Tooltip>
57 |         <TooltipTrigger asChild>
58 |           <div className="absolute right-2 top-3">
59 |             <Icons.AIOutline
60 |               className={cn(
61 |                 "pointer-events-none opacity-50 transition-colors",
62 |                 result?.vat && "opacity-100",
63 |                 isLoading && "animate-pulse opacity-100",
64 |               )}
65 |             />
66 |           </div>
67 |         </TooltipTrigger>
68 |         {result?.vat && (
69 |           <TooltipContent
70 |             sideOffset={20}
71 |             className="flex flex-col max-w-[310px] space-y-2"
72 |           >
73 |             <div className="flex space-x-2 items-center">
74 |               <span>VAT Assistant</span>
75 |               <Experimental className="px-2 py-0 border-border" />
76 |             </div>
77 |             <span className="text-xs text-[#878787]">
78 |               {`The VAT rate for ${name} in ${result.country} is generally ${result.vat}%. Please remember to confirm this with your local Tax office.`}
79 |             </span>
80 |
81 |             <div className="flex justify-end mt-3 pt-3">
82 |               <Button
83 |                 size="sm"
84 |                 className="h-auto py-1"
85 |                 onClick={handleOnSelect}
86 |               >
87 |                 Apply
88 |               </Button>
89 |             </div>
90 |           </TooltipContent>
91 |         )}
92 |       </Tooltip>
93 |     </TooltipProvider>
94 |   );
95 | }
```

apps/dashboard/src/components/vat-input.tsx
```
1 | import { Input } from "@midday/ui/input";
2 | import { type ChangeEventHandler, useState } from "react";
3 | import { VatAssistant } from "./vat-assistant";
4 |
5 | type Props = {
6 |   name: string;
7 |   onChange: (value: ChangeEventHandler<HTMLInputElement>) => void;
8 |   onSelect: (vat: number) => void;
9 |   value?: string | null;
10 | };
11 |
12 | export function VatInput({
13 |   name,
14 |   onChange,
15 |   onSelect,
16 |   value: defaultValue,
17 | }: Props) {
18 |   const [isFocused, setFocused] = useState(false);
19 |   const [value, setValue] = useState(defaultValue);
20 |
21 |   const handleOnSelect = (vat: number) => {
22 |     setValue(vat.toString());
23 |     onSelect(vat);
24 |   };
25 |
26 |   return (
27 |     <div className="relative">
28 |       <Input
29 |         key={value}
30 |         onChange={onChange}
31 |         autoFocus={false}
32 |         placeholder="VAT"
33 |         className="remove-arrow"
34 |         type="number"
35 |         min={0}
36 |         max={100}
37 |         step={0.1}
38 |         onFocus={() => setFocused(true)}
39 |         onBlur={() => setFocused(false)}
40 |         defaultValue={value ?? ""}
41 |       />
42 |
43 |       <VatAssistant
44 |         name={name}
45 |         value={value}
46 |         onSelect={handleOnSelect}
47 |         isFocused={isFocused}
48 |       />
49 |     </div>
50 |   );
51 | }
```

apps/dashboard/src/components/vat-number-input.tsx
```
1 | "use client";
2 |
3 | import { validateVatNumberAction } from "@/actions/validate-vat-number-action";
4 | import { Icons } from "@midday/ui/icons";
5 | import { Input } from "@midday/ui/input";
6 | import {
7 |   Tooltip,
8 |   TooltipContent,
9 |   TooltipProvider,
10 |   TooltipTrigger,
11 | } from "@midday/ui/tooltip";
12 | import { useDebounce } from "@uidotdev/usehooks";
13 | import { Loader2 } from "lucide-react";
14 | import { useAction } from "next-safe-action/hooks";
15 | import { useEffect, useState } from "react";
16 |
17 | type Props = {
18 |   value: string;
19 |   onChange: (value: string) => void;
20 |   countryCode?: string;
21 | };
22 |
23 | export function VatNumberInput({
24 |   value,
25 |   onChange,
26 |   countryCode,
27 |   ...props
28 | }: Props) {
29 |   const [vatNumber, setVatNumber] = useState(value || "");
30 |   const [companyName, setCompanyName] = useState("");
31 |   const [isValid, setIsValid] = useState<boolean | undefined>(undefined);
32 |
33 |   const validateVatNumber = useAction(validateVatNumberAction, {
34 |     onSuccess: ({ data }) => {
35 |       if (data) {
36 |         setIsValid(data.format_valid);
37 |         setCompanyName(data?.registration_info?.name || "");
38 |       }
39 |     },
40 |   });
41 |
42 |   const debouncedVatNumber = useDebounce(vatNumber, 300);
43 |
44 |   useEffect(() => {
45 |     if (
46 |       debouncedVatNumber.length > 7 &&
47 |       countryCode &&
48 |       value !== debouncedVatNumber
49 |     ) {
50 |       validateVatNumber.execute({
51 |         vat_number: debouncedVatNumber,
52 |         country_code: countryCode,
53 |       });
54 |     }
55 |   }, [debouncedVatNumber, countryCode]);
56 |
57 |   const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
58 |     const newValue = e.target.value;
59 |
60 |     setVatNumber(newValue);
61 |     onChange?.(newValue);
62 |     setIsValid(undefined);
63 |   };
64 |
65 |   return (
66 |     <div className="relative">
67 |       <Input
68 |         placeholder="Enter VAT number"
69 |         value={vatNumber}
70 |         onChange={handleChange}
71 |         disabled={!countryCode}
72 |         autoComplete="off"
73 |         {...props}
74 |       />
75 |
76 |       {validateVatNumber.isExecuting && (
77 |         <Loader2 className="size-4 animate-spin absolute right-2 top-2.5" />
78 |       )}
79 |
80 |       {isValid === true && (
81 |         <TooltipProvider delayDuration={0}>
82 |           <Tooltip>
83 |             <TooltipTrigger asChild className=" absolute right-2 top-2.5">
84 |               <button type="button">
85 |                 <Icons.Check className="size-4 text-green-500" />
86 |               </button>
87 |             </TooltipTrigger>
88 |             {companyName && (
89 |               <TooltipContent
90 |                 className="px-3 py-1 text-xs text-[#878787]"
91 |                 side="left"
92 |                 sideOffset={5}
93 |               >
94 |                 <p className="capitalize">{companyName.toLowerCase()}</p>
95 |               </TooltipContent>
96 |             )}
97 |           </Tooltip>
98 |         </TooltipProvider>
99 |       )}
100 |
101 |       {!validateVatNumber.isExecuting && isValid === false && (
102 |         <TooltipProvider delayDuration={0}>
103 |           <Tooltip>
104 |             <TooltipTrigger asChild className=" absolute right-2 top-2.5">
105 |               <button type="button">
106 |                 <Icons.AlertCircle className="size-4 text-yellow-500" />
107 |               </button>
108 |             </TooltipTrigger>
109 |             <TooltipContent
110 |               className="px-3 py-1 text-xs text-[#878787]"
111 |               side="left"
112 |               sideOffset={5}
113 |             >
114 |               Invalid VAT number
115 |             </TooltipContent>
116 |           </Tooltip>
117 |         </TooltipProvider>
118 |       )}
119 |     </div>
120 |   );
121 | }
```

apps/dashboard/src/components/vault-activity.loading.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 |
3 | export function Loading() {
4 |   return (
5 |     <div className="my-6">
6 |       <span className="text-sm font-medium">Recent activity</span>
7 |       <div className="flex space-x-20 mt-6 overflow-auto w-full md:w-[calc(100vw-130px)] scrollbar-hide h-[130px]">
8 |         {...Array.from({ length: 25 }).map((_, i) => (
9 |           <div className="w-[80px]" key={i.toString()}>
10 |             <div className="text-center flex flex-col items-center ml-1">
11 |               <Skeleton className="w-[65px] h-[77px] mb-[14px]" />
12 |
13 |               <Skeleton className="w-[50px] h-[15px] mb-[8px]" />
14 |               <Skeleton className="w-[20px] h-[15px]" />
15 |             </div>
16 |           </div>
17 |         ))}
18 |       </div>
19 |     </div>
20 |   );
21 | }
```

apps/dashboard/src/components/vault-activity.tsx
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { getVaultActivityQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { Icons } from "@midday/ui/icons";
5 | import Link from "next/link";
6 | import { VaultPreview } from "./vault-preview";
7 |
8 | // TODO: Translate
9 | const defaultFolders = [
10 |   { id: "inbox", name: "Inbox" },
11 |   { id: "exports", name: "Exports" },
12 |   { id: "imports", name: "Imports" },
13 |   { id: "transactions", name: "Transactions" },
14 |   { id: "invoices", name: "Invoices" },
15 | ];
16 |
17 | export async function VaultActivity() {
18 |   const supabase = createClient();
19 |   const { data: userData } = await getUser();
20 |
21 |   const { data: storageData } = await getVaultActivityQuery(
22 |     supabase,
23 |     userData?.team_id,
24 |   );
25 |
26 |   const files = storageData
27 |     ?.filter((file) => file.path_tokens.pop() !== ".emptyFolderPlaceholder")
28 |     .map((file) => {
29 |       const filename = file.name.split("/").at(-1);
30 |
31 |       return {
32 |         id: file.id,
33 |         name: file.name,
34 |         path: [...file.path_tokens, filename],
35 |         size: file.metadata?.size ?? 0,
36 |         mimetype: file.metadata?.mimetype,
37 |         createdAt: file.created_at,
38 |       };
39 |     });
40 |
41 |   return (
42 |     <div className="my-6">
43 |       <span className="text-sm font-medium">Recent activity</span>
44 |
45 |       <div className="flex space-x-20 mt-6 overflow-auto w-full md:w-[calc(100vw-130px)] scrollbar-hide h-[130px]">
46 |         {files?.map((file) => {
47 |           return (
48 |             <div className="w-[80px]" key={file.id}>
49 |               <VaultPreview file={file} />
50 |             </div>
51 |           );
52 |         })}
53 |
54 |         {defaultFolders.map((folder) => {
55 |           return (
56 |             <div className="w-[80px]" key={folder.id}>
57 |               <Link href={`/vault/${folder.id}`} prefetch>
58 |                 <div className="text-center flex flex-col items-center">
59 |                   <Icons.Folder
60 |                     size={65}
61 |                     className="text-[#878787] dark:text-[#2C2C2C] mb-0"
62 |                   />
63 |                   <span className="text-sm truncate w-[70px]">
64 |                     {folder.name}
65 |                   </span>
66 |                 </div>
67 |               </Link>
68 |             </div>
69 |           );
70 |         })}
71 |       </div>
72 |     </div>
73 |   );
74 | }
```

apps/dashboard/src/components/vault-preview.tsx
```
1 | "use client";
2 |
3 | import { FilePreview } from "@/components/file-preview";
4 | import { formatSize } from "@/utils/format";
5 | import {
6 |   HoverCard,
7 |   HoverCardContent,
8 |   HoverCardTrigger,
9 | } from "@midday/ui/hover-card";
10 | import { type FileType, isSupportedFilePreview } from "@midday/utils";
11 | import { FileIcon } from "./file-icon";
12 |
13 | type Props = {
14 |   preview?: boolean;
15 |   height?: number;
16 |   width?: number;
17 |   file: {
18 |     id: string;
19 |     path: string[];
20 |     mimetype: FileType;
21 |     size?: number;
22 |   };
23 | };
24 |
25 | export function VaultPreview({
26 |   file,
27 |   preview = true,
28 |   width = 45,
29 |   height = 57,
30 | }: Props) {
31 |   const filename = file.path?.at(-1);
32 |   const [, ...rest] = file.path;
33 |   // Without team_id
34 |   const downloadPath = rest.join("/");
35 |
36 |   if (isSupportedFilePreview(file.mimetype)) {
37 |     return (
38 |       <HoverCard openDelay={200}>
39 |         <HoverCardTrigger
40 |           className="text-center flex flex-col items-center"
41 |           key={file.id}
42 |         >
43 |           <div
44 |             className="bg-[#F2F1EF] dark:bg-secondary flex items-center justify-center p-2 overflow-hidden mb-2"
45 |             style={{ width: width + 20, height: height + 20 }}
46 |           >
47 |             <FilePreview
48 |               src={`/api/proxy?filePath=vault/${file?.path?.join("/")}`}
49 |               name={filename ?? ""}
50 |               type={file.mimetype}
51 |               preview
52 |               width={width}
53 |               height={height}
54 |             />
55 |           </div>
56 |
57 |           <span className="text-sm truncate w-[70px]">{filename}</span>
58 |           {file.size && (
59 |             <span className="text-sm mt-1 text-[#878787]">
60 |               {formatSize(file.size)}
61 |             </span>
62 |           )}
63 |         </HoverCardTrigger>
64 |         {preview && (
65 |           <HoverCardContent
66 |             className="w-[273px] h-[358px] p-0 overflow-hidden"
67 |             sideOffset={-40}
68 |           >
69 |             <FilePreview
70 |               src={`/api/proxy?filePath=vault/${file?.path?.join("/")}`}
71 |               downloadUrl={`/api/download/file?path=${downloadPath}&filename=${filename}`}
72 |               name={filename ?? ""}
73 |               type={file.mimetype}
74 |               width={280}
75 |               height={365}
76 |             />
77 |           </HoverCardContent>
78 |         )}
79 |       </HoverCard>
80 |     );
81 |   }
82 |
83 |   return (
84 |     <div className="text-center flex flex-col items-center" key={file.id}>
85 |       <FileIcon
86 |         isFolder={false}
87 |         mimetype={file.mimetype}
88 |         name={filename ?? ""}
89 |         size={65}
90 |         className="dark:text-[#2C2C2C] mb-0"
91 |       />
92 |       <span className="text-sm truncate w-[70px]">{filename}</span>
93 |       <span className="text-sm mt-1 text-[#878787]">
94 |         {file.size && formatSize(file.size)}
95 |       </span>
96 |     </div>
97 |   );
98 | }
```

apps/dashboard/src/components/vault-search-filter.tsx
```
1 | "use client";
2 |
3 | import { generateVaultFilters } from "@/actions/ai/filters/generate-vault-filters";
4 | import { useI18n } from "@/locales/client";
5 | import { Calendar } from "@midday/ui/calendar";
6 | import { cn } from "@midday/ui/cn";
7 | import {
8 |   DropdownMenu,
9 |   DropdownMenuCheckboxItem,
10 |   DropdownMenuContent,
11 |   DropdownMenuGroup,
12 |   DropdownMenuPortal,
13 |   DropdownMenuSub,
14 |   DropdownMenuSubContent,
15 |   DropdownMenuSubTrigger,
16 |   DropdownMenuTrigger,
17 | } from "@midday/ui/dropdown-menu";
18 | import { Icons } from "@midday/ui/icons";
19 | import { Input } from "@midday/ui/input";
20 | import { readStreamableValue } from "ai/rsc";
21 | import { formatISO } from "date-fns";
22 | import { parseAsArrayOf, parseAsString, useQueryStates } from "nuqs";
23 | import { useRef, useState } from "react";
24 | import { useHotkeys } from "react-hotkeys-hook";
25 | import { FilterList } from "./filter-list";
26 | import { SelectTag } from "./select-tag";
27 | import { TAGS } from "./tables/vault/contants";
28 |
29 | const defaultSearch = {
30 |   q: null,
31 |   start: null,
32 |   end: null,
33 |   owners: null,
34 |   tags: null,
35 | };
36 |
37 | export function VaultSearchFilter({ members }: { members: any[] }) {
38 |   const [prompt, setPrompt] = useState("");
39 |   const inputRef = useRef<HTMLInputElement>(null);
40 |   const [streaming, setStreaming] = useState(false);
41 |   const [isOpen, setIsOpen] = useState(false);
42 |
43 |   const t = useI18n();
44 |
45 |   const [filters, setFilters] = useQueryStates(
46 |     {
47 |       q: parseAsString,
48 |       start: parseAsString,
49 |       end: parseAsString,
50 |       owners: parseAsArrayOf(parseAsString),
51 |       tags: parseAsArrayOf(parseAsString),
52 |     },
53 |     {
54 |       shallow: false,
55 |     },
56 |   );
57 |
58 |   const tags = TAGS.map((tag) => ({
59 |     id: tag,
60 |     name: t(`tags.${tag}`),
61 |     slug: tag,
62 |   }));
63 |
64 |   useHotkeys(
65 |     "esc",
66 |     () => {
67 |       setPrompt("");
68 |       setFilters(defaultSearch);
69 |       setIsOpen(false);
70 |     },
71 |     {
72 |       enableOnFormTags: true,
73 |       enabled: Boolean(prompt),
74 |     },
75 |   );
76 |
77 |   useHotkeys("meta+s", (evt) => {
78 |     evt.preventDefault();
79 |     inputRef.current?.focus();
80 |   });
81 |
82 |   useHotkeys("meta+f", (evt) => {
83 |     evt.preventDefault();
84 |     setIsOpen((prev) => !prev);
85 |   });
86 |
87 |   const handleSearch = (evt: React.ChangeEvent<HTMLInputElement>) => {
88 |     const value = evt.target.value;
89 |
90 |     if (value) {
91 |       setPrompt(value);
92 |     } else {
93 |       setFilters(defaultSearch);
94 |       setPrompt("");
95 |     }
96 |   };
97 |
98 |   const handleSubmit = async () => {
99 |     setStreaming(true);
100 |
101 |     const { object } = await generateVaultFilters(
102 |       prompt,
103 |       `
104 |         Users: ${members.map((member) => member.name).join(", ")},
105 |         Tags: ${tags.map((tag) => tag.name).join(", ")},
106 |         `,
107 |     );
108 |
109 |     let finalObject = {};
110 |
111 |     for await (const partialObject of readStreamableValue(object)) {
112 |       if (partialObject) {
113 |         finalObject = {
114 |           ...finalObject,
115 |           ...partialObject,
116 |           owners:
117 |             partialObject?.owners?.map(
118 |               (name: string) =>
119 |                 members?.find((member) => member.name === name)?.id,
120 |             ) ?? null,
121 |           tags:
122 |             partialObject?.tags?.map(
123 |               (name: string) => tags?.find((tag) => tag.name === name)?.id,
124 |             ) ?? null,
125 |           q: partialObject?.name ?? null,
126 |         };
127 |       }
128 |     }
129 |
130 |     setFilters({
131 |       q: null,
132 |       ...finalObject,
133 |     });
134 |
135 |     setStreaming(false);
136 |   };
137 |
138 |   const hasValidFilters =
139 |     Object.entries(filters).filter(
140 |       ([key, value]) => value !== null && key !== "q",
141 |     ).length > 0;
142 |
143 |   return (
144 |     <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>
145 |       <div className="flex space-x-4 items-center">
146 |         <FilterList
147 |           filters={filters}
148 |           loading={streaming}
149 |           onRemove={setFilters}
150 |           members={members}
151 |           tags={tags}
152 |         />
153 |
154 |         <form
155 |           className="relative"
156 |           onSubmit={(e) => {
157 |             e.preventDefault();
158 |             handleSubmit();
159 |           }}
160 |         >
161 |           <Icons.Search className="absolute pointer-events-none left-3 top-[11px]" />
162 |           <Input
163 |             ref={inputRef}
164 |             placeholder="Search for..."
165 |             className="pl-9 w-full md:w-[350px] pr-8"
166 |             value={prompt}
167 |             onChange={handleSearch}
168 |             autoComplete="off"
169 |             autoCapitalize="none"
170 |             autoCorrect="off"
171 |             spellCheck="false"
172 |           />
173 |
174 |           <DropdownMenuTrigger asChild>
175 |             <button
176 |               onClick={() => setIsOpen((prev) => !prev)}
177 |               type="button"
178 |               className={cn(
179 |                 "absolute z-10 right-3 top-[10px] opacity-50 transition-opacity duration-300 hover:opacity-100",
180 |                 hasValidFilters && "opacity-100",
181 |                 isOpen && "opacity-100",
182 |               )}
[TRUNCATED]
```

apps/dashboard/src/components/vault-settings.tsx
```
1 | import { type UpdateTeamFormValues, updateTeamSchema } from "@/actions/schema";
2 | import { updateTeamAction } from "@/actions/update-team-action";
3 | import { zodResolver } from "@hookform/resolvers/zod";
4 | import {
5 |   Form,
6 |   FormControl,
7 |   FormDescription,
8 |   FormField,
9 |   FormItem,
10 |   FormLabel,
11 | } from "@midday/ui/form";
12 | import { SubmitButton } from "@midday/ui/submit-button";
13 | import { Switch } from "@midday/ui/switch";
14 | import { useAction } from "next-safe-action/hooks";
15 | import { useForm } from "react-hook-form";
16 |
17 | type Props = {
18 |   documentClassification: boolean;
19 |   onSuccess: () => void;
20 | };
21 |
22 | export function VaultSettings({ documentClassification, onSuccess }: Props) {
23 |   const action = useAction(updateTeamAction, {
24 |     onSuccess,
25 |   });
26 |
27 |   const form = useForm<UpdateTeamFormValues>({
28 |     resolver: zodResolver(updateTeamSchema),
29 |     defaultValues: {
30 |       document_classification: documentClassification,
31 |     },
32 |   });
33 |
34 |   const onSubmit = form.handleSubmit((data) => {
35 |     action.execute({ ...data, revalidatePath: "/vault" });
36 |   });
37 |
38 |   return (
39 |     <div className="flex flex-col space-y-4">
40 |       <Form {...form}>
41 |         <form onSubmit={onSubmit} className="flex flex-col">
42 |           <FormField
43 |             control={form.control}
44 |             name="document_classification"
45 |             render={({ field }) => (
46 |               <FormItem>
47 |                 <div className="flex justify-between items-center w-full">
48 |                   <FormLabel>Document classification</FormLabel>
49 |                   <FormControl>
50 |                     <Switch
51 |                       checked={field.value}
52 |                       onCheckedChange={field.onChange}
53 |                     />
54 |                   </FormControl>
55 |                 </div>
56 |                 <FormDescription>
57 |                   We use AI to classify your documents, enabling this will
58 |                   automatically classify your documents into categories such as
59 |                   contracts, invoices, etc.
60 |                 </FormDescription>
61 |               </FormItem>
62 |             )}
63 |           />
64 |
65 |           <SubmitButton
66 |             isSubmitting={action.status === "executing"}
67 |             className="w-full mt-8"
68 |           >
69 |             Save
70 |           </SubmitButton>
71 |         </form>
72 |       </Form>
73 |     </div>
74 |   );
75 | }
```

apps/dashboard/src/components/verify-mfa.tsx
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { InputOTP, InputOTPGroup, InputOTPSlot } from "@midday/ui/input-otp";
3 | import { useRouter } from "next/navigation";
4 | import { useState } from "react";
5 |
6 | export function VerifyMfa() {
7 |   const [isValidating, setValidating] = useState(false);
8 |   const [error, setError] = useState(false);
9 |   const supabase = createClient();
10 |   const router = useRouter();
11 |
12 |   const onComplete = async (code: string) => {
13 |     setError(false);
14 |
15 |     if (!isValidating) {
16 |       setValidating(true);
17 |
18 |       const factors = await supabase.auth.mfa.listFactors();
19 |
20 |       if (factors.error) {
21 |         setValidating(false);
22 |         setError(true);
23 |       }
24 |
25 |       if (!factors.data) {
26 |         setValidating(false);
27 |         setError(true);
28 |         return;
29 |       }
30 |
31 |       const totpFactor = factors.data.totp[0];
32 |
33 |       if (!totpFactor) {
34 |         setValidating(false);
35 |         setError(true);
36 |         return;
37 |       }
38 |
39 |       const factorId = totpFactor.id;
40 |
41 |       const challenge = await supabase.auth.mfa.challenge({ factorId });
42 |
43 |       if (challenge.error) {
44 |         setValidating(false);
45 |         setError(true);
46 |         return;
47 |       }
48 |
49 |       const challengeId = challenge.data.id;
50 |
51 |       const verify = await supabase.auth.mfa.verify({
52 |         factorId,
53 |         challengeId,
54 |         code,
55 |       });
56 |
57 |       if (verify.error) {
58 |         setValidating(false);
59 |         setError(true);
60 |         return;
61 |       }
62 |
63 |       router.replace("/");
64 |     }
65 |   };
66 |
67 |   return (
68 |     <>
69 |       <div className="pb-4 bg-gradient-to-r from-primary dark:via-primary dark:to-[#848484] to-[#000] inline-block text-transparent bg-clip-text">
70 |         <h1 className="font-medium pb-1 text-3xl">Verify your identity.</h1>
71 |       </div>
72 |
73 |       <div className="mb-8">
74 |         <p className="font-medium pb-1 text-2xl text-[#606060]">
75 |           Please enter the code from your authenticator app.
76 |         </p>
77 |       </div>
78 |
79 |       <div className="flex w-full mb-6">
80 |         <InputOTP
81 |           onComplete={onComplete}
82 |           maxLength={6}
83 |           autoFocus
84 |           className={error ? "invalid" : undefined}
85 |           disabled={isValidating}
86 |           render={({ slots }) => (
87 |             <InputOTPGroup>
88 |               {slots.map((slot, index) => (
89 |                 <InputOTPSlot key={index.toString()} {...slot} />
90 |               ))}
91 |             </InputOTPGroup>
92 |           )}
93 |         />
94 |       </div>
95 |
96 |       <p className="text-xs text-[#878787]">
97 |         Open your authenticator apps like 1Password, Authy, etc. to verify your
98 |         identity.
99 |       </p>
100 |     </>
101 |   );
102 | }
```

apps/dashboard/src/components/week-settings.tsx
```
1 | "use client";
2 |
3 | import { updateUserAction } from "@/actions/update-user-action";
4 | import {
5 |   Card,
6 |   CardContent,
7 |   CardDescription,
8 |   CardHeader,
9 |   CardTitle,
10 | } from "@midday/ui/card";
11 | import { Switch } from "@midday/ui/switch";
12 | import { useAction } from "next-safe-action/hooks";
13 |
14 | type Props = {
15 |   weekStartsOnMonday: boolean;
16 | };
17 |
18 | export function WeekSettings({ weekStartsOnMonday }: Props) {
19 |   const action = useAction(updateUserAction);
20 |
21 |   return (
22 |     <Card className="flex justify-between items-center">
23 |       <CardHeader>
24 |         <CardTitle>Start Week on Monday</CardTitle>
25 |         <CardDescription>
26 |           Set the first day of the week in calendar views.
27 |         </CardDescription>
28 |       </CardHeader>
29 |
30 |       <CardContent>
31 |         <Switch
32 |           checked={weekStartsOnMonday}
33 |           disabled={action.status === "executing"}
34 |           onCheckedChange={(week_starts_on_monday: boolean) => {
35 |             action.execute({ week_starts_on_monday });
36 |           }}
37 |         />
38 |       </CardContent>
39 |     </Card>
40 |   );
41 | }
```

apps/dashboard/src/components/widgets-navigation.tsx
```
1 | "use client";
2 |
3 | import { useCarousel } from "@midday/ui/carousel";
4 | import { parseAsString, useQueryStates } from "nuqs";
5 | import { useHotkeys } from "react-hotkeys-hook";
6 |
7 | export function WidgetsNavigation() {
8 |   const { scrollPrev, scrollNext } = useCarousel();
9 |   const [params] = useQueryStates({
10 |     selectedDate: parseAsString,
11 |   });
12 |
13 |   const disabled = params.selectedDate;
14 |
15 |   useHotkeys("left", scrollPrev, {
16 |     enabled: !disabled,
17 |   });
18 |
19 |   useHotkeys("right", scrollNext, {
20 |     enabled: !disabled,
21 |   });
22 |
23 |   return null;
24 | }
```

apps/dashboard/src/components/widgets.tsx
```
1 | import {
2 |   Carousel,
3 |   CarouselContent,
4 |   CarouselItem,
5 |   CarouselNext,
6 |   CarouselPrevious,
7 | } from "@midday/ui/carousel";
8 | import * as React from "react";
9 | import { Spending } from "./charts/spending";
10 | import { Transactions } from "./charts/transactions";
11 | import { WidgetsNavigation } from "./widgets-navigation";
12 | import { AccountBalance } from "./widgets/account-balance";
13 | import { Inbox } from "./widgets/inbox";
14 | import { Insights } from "./widgets/insights";
15 | import { Invoice } from "./widgets/invoice";
16 | import { Tracker } from "./widgets/tracker";
17 | import { Vault } from "./widgets/vault";
18 |
19 | type Props = {
20 |   disabled: boolean;
21 |   initialPeriod: Date | string;
22 |   searchParams: { [key: string]: string | string[] | undefined };
23 | };
24 |
25 | export function Widgets({ disabled, initialPeriod, searchParams }: Props) {
26 |   const items = [
27 |     <Insights key="insights" />,
28 |     <Spending
29 |       disabled={disabled}
30 |       initialPeriod={initialPeriod}
31 |       key="spending"
32 |       currency={searchParams?.currency}
33 |     />,
34 |     <Tracker key="tracker" date={searchParams?.date} hideDaysIndicators />,
35 |     <Transactions key="transactions" disabled={disabled} />,
36 |     <Invoice key="invoice" />,
37 |     <Inbox key="inbox" disabled={disabled} />,
38 |     <AccountBalance key="account-balance" />,
39 |     <Vault key="vault" />,
40 |   ];
41 |
42 |   return (
43 |     <Carousel
44 |       className="flex flex-col"
45 |       opts={{
46 |         align: "start",
47 |         watchDrag: false,
48 |       }}
49 |     >
50 |       <WidgetsNavigation />
51 |       <div className="ml-auto hidden md:flex">
52 |         <CarouselPrevious className="static p-0 border-none hover:bg-transparent" />
53 |         <CarouselNext className="static p-0 border-none hover:bg-transparent" />
54 |       </div>
55 |
56 |       <CarouselContent className="-ml-[20px] 2xl:-ml-[40px] flex-col md:flex-row space-y-6 md:space-y-0">
57 |         {items.map((item, idx) => {
58 |           return (
59 |             <CarouselItem
60 |               className="lg:basis-1/2 xl:basis-1/3 3xl:basis-1/4 pl-[20px] 2xl:pl-[40px]"
61 |               key={idx.toString()}
62 |             >
63 |               {item}
64 |             </CarouselItem>
65 |           );
66 |         })}
67 |       </CarouselContent>
68 |     </Carousel>
69 |   );
70 | }
```

apps/dashboard/src/desktop/main.ts
```
1 | import { createClient } from "@midday/supabase/client";
2 | import {
3 |   globalShortcut,
4 |   nativeWindow,
5 |   object,
6 |   platform,
7 | } from "@todesktop/client-core";
8 |
9 | const windows = {
10 |   command: "XEVrd9yvoaSgNhFr6GqYX",
11 | };
12 |
13 | async function main() {
14 |   // Menu items
15 |   await object.on("open-x", () => {
16 |     platform.os.openURL("https://x.com/middayai");
17 |   });
18 |
19 |   await object.on("open-discord", () => {
20 |     platform.os.openURL("https://discord.gg/ZmqcvWKH");
21 |   });
22 |
23 |   await object.on("open-github", () => {
24 |     platform.os.openURL("https://github.com/midday-ai/midday");
25 |   });
26 |
27 |   // Command menu
28 |   await object.on("open-command-menu", async () => {
29 |     const winRef = await object.retrieve({ id: windows.command });
30 |     await nativeWindow.show({ ref: winRef });
31 |   });
32 |
33 |   // Auth state for command menu
34 |   nativeWindow.on("focus", async () => {
35 |     const winRef = await object.retrieve({ id: windows.command });
36 |     const isCommandWindow = await nativeWindow.isVisible({ ref: winRef });
37 |
38 |     if (isCommandWindow) {
39 |       globalShortcut.register("Escape", async () => {
40 |         await nativeWindow.hide({ ref: winRef });
41 |       });
42 |     } else {
43 |       globalShortcut.unregister("Escape");
44 |     }
45 |
46 |     if (winRef?.id === windows.command && isCommandWindow) {
47 |       if (window.location.pathname !== "/desktop/command") {
48 |         // TODO: Fix redirect from middleware if command
49 |         window.location.pathname = "/desktop/command";
50 |       } else {
51 |         const supabase = createClient();
52 |
53 |         const {
54 |           data: { session },
55 |         } = await supabase.auth.getSession();
56 |
57 |         if (!session) {
58 |           window.location.pathname = "/";
59 |         }
60 |       }
61 |     }
62 |   });
63 | }
64 |
65 | main();
```

apps/dashboard/src/hooks/use-connect-params.ts
```
1 | import { parseAsString, parseAsStringLiteral, useQueryStates } from "nuqs";
2 |
3 | export function useConnectParams(initialCountryCode?: string) {
4 |   const [params, setParams] = useQueryStates({
5 |     step: parseAsStringLiteral(["connect", "account"]),
6 |     countryCode: parseAsString.withDefault(initialCountryCode ?? ""),
7 |     provider: parseAsStringLiteral(["teller", "plaid", "gocardless"]),
8 |     token: parseAsString,
9 |     enrollment_id: parseAsString,
10 |     institution_id: parseAsString,
11 |     q: parseAsString.withDefault("").withOptions({ clearOnDefault: true }),
12 |     error: parseAsString,
13 |     ref: parseAsString,
14 |     details: parseAsString,
15 |   });
16 |
17 |   return {
18 |     ...params,
19 |     setParams,
20 |   };
21 | }
```

apps/dashboard/src/hooks/use-customer-params.ts
```
1 | import {
2 |   parseAsArrayOf,
3 |   parseAsBoolean,
4 |   parseAsString,
5 |   useQueryStates,
6 | } from "nuqs";
7 |
8 | export function useCustomerParams(options?: { shallow: boolean }) {
9 |   const [params, setParams] = useQueryStates(
10 |     {
11 |       customerId: parseAsString,
12 |       createCustomer: parseAsBoolean,
13 |       sort: parseAsArrayOf(parseAsString),
14 |       name: parseAsString,
15 |       q: parseAsString,
16 |     },
17 |     options,
18 |   );
19 |
20 |   return {
21 |     ...params,
22 |     setParams,
23 |   };
24 | }
```

apps/dashboard/src/hooks/use-enter-submit.tsx
```
1 | import { type RefObject, useRef } from "react";
2 |
3 | export function useEnterSubmit(): {
4 |   formRef: RefObject<HTMLFormElement>;
5 |   onKeyDown: (event: React.KeyboardEvent<HTMLTextAreaElement>) => void;
6 | } {
7 |   const formRef = useRef<HTMLFormElement>(null);
8 |
9 |   const handleKeyDown = (
10 |     event: React.KeyboardEvent<HTMLTextAreaElement>,
11 |   ): void => {
12 |     if (
13 |       event.key === "Enter" &&
14 |       !event.shiftKey &&
15 |       !event.nativeEvent.isComposing
16 |     ) {
17 |       formRef.current?.requestSubmit();
18 |       event.preventDefault();
19 |     }
20 |   };
21 |
22 |   return { formRef, onKeyDown: handleKeyDown };
23 | }
```

apps/dashboard/src/hooks/use-export-status.ts
```
1 | import { useRealtimeRun } from "@trigger.dev/react-hooks";
2 | import { useEffect, useState } from "react";
3 |
4 | type UseExportStatusProps = {
5 |   runId?: string;
6 |   accessToken?: string;
7 | };
8 |
9 | export function useExportStatus({
10 |   runId: initialRunId,
11 |   accessToken: initialAccessToken,
12 | }: UseExportStatusProps = {}) {
13 |   const [accessToken, setAccessToken] = useState<string | undefined>(
14 |     initialAccessToken,
15 |   );
16 |   const [runId, setRunId] = useState<string | undefined>(initialRunId);
17 |   const [status, setStatus] = useState<
18 |     "FAILED" | "IN_PROGRESS" | "COMPLETED" | null
19 |   >(null);
20 |
21 |   const [_, setProgress] = useState<number>(0);
22 |
23 |   const [result, setResult] = useState<any>(null);
24 |
25 |   const { run, error } = useRealtimeRun(runId, {
26 |     enabled: !!runId && !!accessToken,
27 |     accessToken,
28 |   });
29 |
30 |   useEffect(() => {
31 |     if (initialRunId && initialAccessToken) {
32 |       setAccessToken(initialAccessToken);
33 |       setRunId(initialRunId);
34 |       setStatus("IN_PROGRESS");
35 |     }
36 |   }, [initialRunId, initialAccessToken]);
37 |
38 |   useEffect(() => {
39 |     if (error || run?.status === "FAILED") {
40 |       setStatus("FAILED");
41 |       setProgress(0);
42 |     }
43 |
44 |     if (run?.status === "COMPLETED") {
45 |       setStatus("COMPLETED");
46 |       setProgress(100);
47 |     }
48 |   }, [error, run]);
49 |
50 |   useEffect(() => {
51 |     if (run?.output) {
52 |       setResult(run.output);
53 |     }
54 |   }, [run]);
55 |
56 |   return {
57 |     status,
58 |     setStatus,
59 |     progress: run?.metadata?.progress ?? 0,
60 |     result,
61 |   };
62 | }
```

apps/dashboard/src/hooks/use-initial-connection-status.ts
```
1 | import { useRealtimeRun } from "@trigger.dev/react-hooks";
2 | import { useEffect, useState } from "react";
3 |
4 | type UseInitialConnectionStatusProps = {
5 |   runId?: string;
6 |   accessToken?: string;
7 | };
8 |
9 | export function useInitialConnectionStatus({
10 |   runId: initialRunId,
11 |   accessToken: initialAccessToken,
12 | }: UseInitialConnectionStatusProps) {
13 |   const [accessToken, setAccessToken] = useState<string | undefined>(
14 |     initialAccessToken,
15 |   );
16 |   const [runId, setRunId] = useState<string | undefined>(initialRunId);
17 |   const [status, setStatus] = useState<
18 |     "FAILED" | "SYNCING" | "COMPLETED" | null
19 |   >(null);
20 |
21 |   const { run, error } = useRealtimeRun(runId, {
22 |     enabled: !!runId && !!accessToken,
23 |     accessToken,
24 |   });
25 |
26 |   useEffect(() => {
27 |     if (initialRunId && initialAccessToken) {
28 |       setAccessToken(initialAccessToken);
29 |       setRunId(initialRunId);
30 |       setStatus("SYNCING");
31 |     }
32 |   }, [initialRunId, initialAccessToken]);
33 |
34 |   useEffect(() => {
35 |     if (error || run?.status === "FAILED") {
36 |       setStatus("FAILED");
37 |     }
38 |
39 |     if (run?.status === "COMPLETED") {
40 |       setStatus("COMPLETED");
41 |     }
42 |   }, [error, run]);
43 |
44 |   return {
45 |     status,
46 |     setStatus,
47 |   };
48 | }
```

apps/dashboard/src/hooks/use-invoice-params.ts
```
1 | import {
2 |   parseAsArrayOf,
3 |   parseAsJson,
4 |   parseAsString,
5 |   parseAsStringEnum,
6 |   useQueryStates,
7 | } from "nuqs";
8 |
9 | import { z } from "zod";
10 |
11 | const lineItemSchema = z.object({
12 |   name: z.string(),
13 |   price: z.number(),
14 |   quantity: z.number(),
15 | });
16 |
17 | export function useInvoiceParams(options?: { shallow: boolean }) {
18 |   const [params, setParams] = useQueryStates(
19 |     {
20 |       invoiceId: parseAsString,
21 |       sort: parseAsArrayOf(parseAsString),
22 |       q: parseAsString,
23 |       statuses: parseAsArrayOf(parseAsString),
24 |       customers: parseAsArrayOf(parseAsString),
25 |       start: parseAsString,
26 |       end: parseAsString,
27 |       selectedCustomerId: parseAsString,
28 |       type: parseAsStringEnum(["edit", "create", "details", "comments"]),
29 |       lineItems: parseAsJson<z.infer<typeof lineItemSchema>>(),
30 |       currency: parseAsString,
31 |     },
32 |     options,
33 |   );
34 |
35 |   return {
36 |     ...params,
37 |     setParams,
38 |   };
39 | }
```

apps/dashboard/src/hooks/use-notifications.ts
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { getUserQuery } from "@midday/supabase/queries";
3 | import { HeadlessService } from "@novu/headless";
4 | import { useCallback, useEffect, useRef, useState } from "react";
5 |
6 | export function useNotifications() {
7 |   const supabase = createClient();
8 |   const [isLoading, setLoading] = useState(true);
9 |   const [notifications, setNotifications] = useState([]);
10 |   const [subscriberId, setSubscriberId] = useState();
11 |   const headlessServiceRef = useRef<HeadlessService>();
12 |
13 |   const markAllMessagesAsRead = () => {
14 |     const headlessService = headlessServiceRef.current;
15 |
16 |     if (headlessService) {
17 |       setNotifications((prevNotifications) =>
18 |         prevNotifications.map((notification) => {
19 |           return {
20 |             ...notification,
21 |             read: true,
22 |           };
23 |         }),
24 |       );
25 |
26 |       headlessService.markAllMessagesAsRead({
27 |         listener: () => {},
28 |         onError: () => {},
29 |       });
30 |     }
31 |   };
32 |
33 |   const markMessageAsRead = (messageId: string) => {
34 |     const headlessService = headlessServiceRef.current;
35 |
36 |     if (headlessService) {
37 |       setNotifications((prevNotifications) =>
38 |         prevNotifications.map((notification) => {
39 |           if (notification.id === messageId) {
40 |             return {
41 |               ...notification,
42 |               read: true,
43 |             };
44 |           }
45 |
46 |           return notification;
47 |         }),
48 |       );
49 |
50 |       headlessService.markNotificationsAsRead({
51 |         messageId: [messageId],
52 |         listener: (result) => {},
53 |         onError: (error) => {},
54 |       });
55 |     }
56 |   };
57 |
58 |   const fetchNotifications = useCallback(() => {
59 |     const headlessService = headlessServiceRef.current;
60 |
61 |     if (headlessService) {
62 |       headlessService.fetchNotifications({
63 |         listener: ({}) => {},
64 |         onSuccess: (response) => {
65 |           setLoading(false);
66 |           setNotifications(response.data);
67 |         },
68 |       });
69 |     }
70 |   }, []);
71 |
72 |   const markAllMessagesAsSeen = () => {
73 |     const headlessService = headlessServiceRef.current;
74 |
75 |     if (headlessService) {
76 |       setNotifications((prevNotifications) =>
77 |         prevNotifications.map((notification) => ({
78 |           ...notification,
79 |           seen: true,
80 |         })),
81 |       );
82 |       headlessService.markAllMessagesAsSeen({
83 |         listener: () => {},
84 |         onError: () => {},
85 |       });
86 |     }
87 |   };
88 |
89 |   useEffect(() => {
90 |     async function fetchUser() {
91 |       const {
92 |         data: { session },
93 |       } = await supabase.auth.getSession();
94 |
95 |       const { data: userData } = await getUserQuery(
96 |         supabase,
97 |         session?.user?.id,
98 |       );
99 |
100 |       if (userData) {
101 |         setSubscriberId(`${userData.team_id}_${userData.id}`);
102 |       }
103 |     }
104 |
105 |     fetchUser();
106 |   }, [supabase]);
107 |
108 |   useEffect(() => {
109 |     const headlessService = headlessServiceRef.current;
110 |
111 |     if (headlessService) {
112 |       headlessService.listenNotificationReceive({
113 |         listener: () => {
114 |           fetchNotifications();
115 |         },
116 |       });
117 |     }
118 |   }, [headlessServiceRef.current]);
119 |
120 |   useEffect(() => {
121 |     if (subscriberId && !headlessServiceRef.current) {
122 |       const headlessService = new HeadlessService({
123 |         applicationIdentifier:
124 |           process.env.NEXT_PUBLIC_NOVU_APPLICATION_IDENTIFIER!,
125 |         subscriberId,
126 |       });
127 |
128 |       headlessService.initializeSession({
129 |         listener: () => {},
130 |         onSuccess: () => {
131 |           headlessServiceRef.current = headlessService;
132 |           fetchNotifications();
133 |         },
134 |         onError: () => {},
135 |       });
136 |     }
137 |   }, [fetchNotifications, subscriberId]);
138 |
139 |   return {
140 |     isLoading,
141 |     markAllMessagesAsRead,
142 |     markMessageAsRead,
143 |     markAllMessagesAsSeen,
144 |     hasUnseenNotifications: notifications.some(
145 |       (notification) => !notification.seen,
146 |     ),
147 |     notifications,
148 |   };
149 | }
```

apps/dashboard/src/hooks/use-scroll-anchor.ts
```
1 | import { useCallback, useEffect, useRef, useState } from "react";
2 |
3 | export const useScrollAnchor = () => {
4 |   const messagesRef = useRef<HTMLDivElement>(null);
5 |   const scrollRef = useRef<HTMLDivElement>(null);
6 |   const visibilityRef = useRef<HTMLDivElement>(null);
7 |
8 |   const [isAtBottom, setIsAtBottom] = useState(true);
9 |   const [isVisible, setIsVisible] = useState(false);
10 |
11 |   const scrollToBottom = useCallback(() => {
12 |     if (messagesRef.current) {
13 |       messagesRef.current.scrollIntoView({
14 |         block: "end",
15 |         behavior: "smooth",
16 |       });
17 |     }
18 |   }, []);
19 |
20 |   useEffect(() => {
21 |     if (messagesRef.current) {
22 |       if (isAtBottom && !isVisible) {
23 |         messagesRef.current.scrollIntoView({
24 |           block: "end",
25 |         });
26 |       }
27 |     }
28 |   }, [isAtBottom, isVisible]);
29 |
30 |   useEffect(() => {
31 |     const { current } = scrollRef;
32 |
33 |     if (current) {
34 |       const handleScroll = (event: Event) => {
35 |         const target = event.target as HTMLDivElement;
36 |         const offset = 25;
37 |         const isAtBottom =
38 |           target.scrollTop + target.clientHeight >=
39 |           target.scrollHeight - offset;
40 |
41 |         setIsAtBottom(isAtBottom);
42 |       };
43 |
44 |       current.addEventListener("scroll", handleScroll, {
45 |         passive: true,
46 |       });
47 |
48 |       return () => {
49 |         current.removeEventListener("scroll", handleScroll);
50 |       };
51 |     }
52 |   }, []);
53 |
54 |   useEffect(() => {
55 |     if (visibilityRef.current) {
56 |       const observer = new IntersectionObserver((entries) => {
57 |         entries.forEach((entry) => {
58 |           if (entry.isIntersecting) {
59 |             setIsVisible(true);
60 |           } else {
61 |             setIsVisible(false);
62 |           }
63 |         });
64 |       });
65 |
66 |       observer.observe(visibilityRef.current);
67 |
68 |       return () => {
69 |         observer.disconnect();
70 |       };
71 |     }
72 |   });
73 |
74 |   return {
75 |     messagesRef,
76 |     scrollRef,
77 |     visibilityRef,
78 |     scrollToBottom,
79 |     isAtBottom,
80 |     isVisible,
81 |   };
82 | };
```

apps/dashboard/src/hooks/use-slider-with-input.ts
```
1 | import { useCallback, useState } from "react";
2 |
3 | type UseSliderWithInputProps = {
4 |   minValue?: number;
5 |   maxValue?: number;
6 |   initialValue?: number[];
7 |   defaultValue?: number[];
8 | };
9 |
10 | export function useSliderWithInput({
11 |   minValue = 0,
12 |   maxValue = 100,
13 |   initialValue = [minValue],
14 |   defaultValue = [minValue],
15 | }: UseSliderWithInputProps) {
16 |   const [sliderValue, setSliderValue] = useState(initialValue);
17 |   const [inputValues, setInputValues] = useState(
18 |     initialValue.map((v) => v.toString()),
19 |   );
20 |
21 |   const setValues = useCallback((values: number[]) => {
22 |     setSliderValue(values);
23 |     setInputValues(values.map((v) => v.toString()));
24 |   }, []);
25 |
26 |   const validateAndUpdateValue = useCallback(
27 |     (rawValue: string, index: number) => {
28 |       if (rawValue === "" || rawValue === "-") {
29 |         const newInputValues = [...inputValues];
30 |         newInputValues[index] = "0";
31 |         setInputValues(newInputValues);
32 |
33 |         const newSliderValues = [...sliderValue];
34 |         newSliderValues[index] = 0;
35 |         setSliderValue(newSliderValues);
36 |         return;
37 |       }
38 |
39 |       const numValue = Number.parseFloat(rawValue);
40 |
41 |       if (Number.isNaN(numValue)) {
42 |         const newInputValues = [...inputValues];
43 |         newInputValues[index] = sliderValue[index].toString();
44 |         setInputValues(newInputValues);
45 |         return;
46 |       }
47 |
48 |       let clampedValue = Math.min(maxValue, Math.max(minValue, numValue));
49 |
50 |       if (sliderValue.length > 1) {
51 |         if (index === 0) {
52 |           clampedValue = Math.min(clampedValue, sliderValue[1]);
53 |         } else {
54 |           clampedValue = Math.max(clampedValue, sliderValue[0]);
55 |         }
56 |       }
57 |
58 |       const newSliderValues = [...sliderValue];
59 |       newSliderValues[index] = clampedValue;
60 |       setSliderValue(newSliderValues);
61 |
62 |       const newInputValues = [...inputValues];
63 |       newInputValues[index] = clampedValue.toString();
64 |       setInputValues(newInputValues);
65 |     },
66 |     [sliderValue, inputValues, minValue, maxValue],
67 |   );
68 |
69 |   const handleInputChange = useCallback(
70 |     (e: React.ChangeEvent<HTMLInputElement>, index: number) => {
71 |       const newValue = e.target.value;
72 |       if (newValue === "" || /^-?\d*\.?\d*$/.test(newValue)) {
73 |         const newInputValues = [...inputValues];
74 |         newInputValues[index] = newValue;
75 |         setInputValues(newInputValues);
76 |       }
77 |     },
78 |     [inputValues],
79 |   );
80 |
81 |   const handleSliderChange = useCallback((newValue: number[]) => {
82 |     setSliderValue(newValue);
83 |     setInputValues(newValue.map((v) => v.toString()));
84 |   }, []);
85 |
86 |   const resetToDefault = useCallback(() => {
87 |     setSliderValue(defaultValue);
88 |     setInputValues(defaultValue.map((v) => v.toString()));
89 |   }, [defaultValue]);
90 |
91 |   return {
92 |     sliderValue,
93 |     inputValues,
94 |     validateAndUpdateValue,
95 |     handleInputChange,
96 |     handleSliderChange,
97 |     resetToDefault,
98 |     setValues,
99 |   };
100 | }
```

apps/dashboard/src/hooks/use-streamable-text.tsx
```
1 | import { type StreamableValue, readStreamableValue } from "ai/rsc";
2 | import { useEffect, useState } from "react";
3 |
4 | export const useStreamableText = (
5 |   content: string | StreamableValue<string>
6 | ) => {
7 |   const [rawContent, setRawContent] = useState(
8 |     typeof content === "string" ? content : ""
9 |   );
10 |
11 |   useEffect(() => {
12 |     (async () => {
13 |       if (typeof content === "object") {
14 |         let value = "";
15 |         for await (const delta of readStreamableValue(content)) {
16 |           if (typeof delta === "string") {
17 |             setRawContent((value = value + delta));
18 |           }
19 |         }
20 |       }
21 |     })();
22 |   }, [content]);
23 |
24 |   return rawContent;
25 | };
```

apps/dashboard/src/hooks/use-sync-status.ts
```
1 | import { useRealtimeRun } from "@trigger.dev/react-hooks";
2 | import { useEffect, useState } from "react";
3 |
4 | type UseSyncStatusProps = {
5 |   runId?: string;
6 |   accessToken?: string;
7 | };
8 |
9 | export function useSyncStatus({
10 |   runId: initialRunId,
11 |   accessToken: initialAccessToken,
12 | }: UseSyncStatusProps) {
13 |   const [accessToken, setAccessToken] = useState<string | undefined>(
14 |     initialAccessToken,
15 |   );
16 |   const [runId, setRunId] = useState<string | undefined>(initialRunId);
17 |   const [status, setStatus] = useState<
18 |     "FAILED" | "SYNCING" | "COMPLETED" | null
19 |   >(null);
20 |   const { run, error } = useRealtimeRun(runId, {
21 |     enabled: !!runId && !!accessToken,
22 |     accessToken,
23 |   });
24 |
25 |   useEffect(() => {
26 |     if (initialRunId && initialAccessToken) {
27 |       setAccessToken(initialAccessToken);
28 |       setRunId(initialRunId);
29 |       setStatus("SYNCING");
30 |     }
31 |   }, [initialRunId, initialAccessToken]);
32 |
33 |   useEffect(() => {
34 |     if (error || run?.status === "FAILED") {
35 |       setStatus("FAILED");
36 |     }
37 |
38 |     if (run?.status === "COMPLETED") {
39 |       setStatus("COMPLETED");
40 |     }
41 |   }, [error, run]);
42 |
43 |   return {
44 |     status,
45 |     setStatus,
46 |   };
47 | }
```

apps/dashboard/src/hooks/use-tracker-params.ts
```
1 | import { formatISO } from "date-fns";
2 | import {
3 |   parseAsArrayOf,
4 |   parseAsBoolean,
5 |   parseAsString,
6 |   parseAsStringLiteral,
7 |   useQueryStates,
8 | } from "nuqs";
9 |
10 | export function useTrackerParams(initialDate?: string) {
11 |   const [params, setParams] = useQueryStates({
12 |     date: parseAsString.withDefault(
13 |       initialDate ?? formatISO(new Date(), { representation: "date" }),
14 |     ),
15 |     create: parseAsBoolean,
16 |     projectId: parseAsString,
17 |     update: parseAsBoolean,
18 |     selectedDate: parseAsString,
19 |     range: parseAsArrayOf(parseAsString),
20 |     statuses: parseAsArrayOf(
21 |       parseAsStringLiteral(["completed", "in_progress"]),
22 |     ),
23 |     start: parseAsString,
24 |     end: parseAsString,
25 |   });
26 |
27 |   return {
28 |     ...params,
29 |     setParams,
30 |   };
31 | }
```

apps/dashboard/src/hooks/use-upload.ts
```
1 | import { createClient } from "@midday/supabase/client";
2 | import { upload } from "@midday/supabase/storage";
3 | import type { SupabaseClient } from "@supabase/supabase-js";
4 | import { useState } from "react";
5 |
6 | interface UploadParams {
7 |   file: File;
8 |   path: string[];
9 |   bucket: string;
10 | }
11 |
12 | interface UploadResult {
13 |   url: string;
14 |   path: string[];
15 | }
16 |
17 | export function useUpload() {
18 |   const supabase: SupabaseClient = createClient();
19 |   const [isLoading, setLoading] = useState<boolean>(false);
20 |
21 |   const uploadFile = async ({
22 |     file,
23 |     path,
24 |     bucket,
25 |   }: UploadParams): Promise<UploadResult> => {
26 |     setLoading(true);
27 |
28 |     try {
29 |       const url = await upload(supabase, {
30 |         path,
31 |         file,
32 |         bucket,
33 |       });
34 |
35 |       return {
36 |         url,
37 |         path,
38 |       };
39 |     } finally {
40 |       setLoading(false);
41 |     }
42 |   };
43 |
44 |   return {
45 |     uploadFile,
46 |     isLoading,
47 |   };
48 | }
```

apps/dashboard/src/locales/client.ts
```
1 | "use client";
2 |
3 | import { createI18nClient } from "next-international/client";
4 |
5 | // NOTE: Also update middleware.ts to support locale
6 | export const languages = ["en"];
7 |
8 | export const {
9 |   useScopedI18n,
10 |   I18nProviderClient,
11 |   useCurrentLocale,
12 |   useChangeLocale,
13 |   useI18n,
14 | } = createI18nClient({
15 |   en: () => import("./en"),
16 |   // sv: () => import("./sv"),
17 | });
```

apps/dashboard/src/locales/en.ts
```
1 | export default {
2 |   transaction_methods: {
3 |     card_purchase: "Card Purchase",
4 |     payment: "Payment",
5 |     card_atm: "Card ATM",
6 |     transfer: "Transfer",
7 |     other: "Other",
8 |     ach: "Ach",
9 |     deposit: "Deposit",
10 |     wire: "Wire",
11 |     fee: "Fee",
12 |     interest: "Interest",
13 |   },
14 |   language: {
15 |     title: "Languages",
16 |     description: "Change the language used in the user interface.",
17 |     placeholder: "Select language",
18 |   },
19 |   locale: {
20 |     title: "Locale",
21 |     searchPlaceholder: "Search locale",
22 |     description:
23 |       "Sets the region and language preferences for currency, dates, and other locale-specific formats.",
24 |     placeholder: "Select locale",
25 |   },
26 |   languages: {
27 |     en: "English",
28 |     sv: "Swedish",
29 |   },
30 |   timezone: {
31 |     title: "Time Zone",
32 |     searchPlaceholder: "Search timezone",
33 |     description:
34 |       "Defines the default time zone used for displaying times in the app.",
35 |     placeholder: "Select timezone",
36 |   },
37 |   spending_period: {
38 |     last_30d: "Last 30 days",
39 |     this_month: "This month",
40 |     last_month: "Last month",
41 |     this_year: "This year",
42 |     last_year: "Last year",
43 |   },
44 |   transactions_period: {
45 |     all: "All",
46 |     income: "Income",
47 |     expense: "Expense",
48 |   },
49 |   transaction_frequency: {
50 |     weekly: "Weekly recurring",
51 |     monthly: "Monthly recurring",
52 |     annually: "Annually recurring",
53 |   },
54 |   inbox_filter: {
55 |     all: "All",
56 |     todo: "Todo",
57 |     done: "Done",
58 |   },
59 |   chart_type: {
60 |     profit: "Profit",
61 |     revenue: "Revenue",
62 |     expense: "Expenses",
63 |     burn_rate: "Burn rate",
64 |   },
65 |   folders: {
66 |     all: "All",
67 |     exports: "Exports",
68 |     inbox: "Inbox",
69 |     imports: "Imports",
70 |     transactions: "Transactions",
71 |     invoices: "Invoices",
72 |   },
73 |   mfa_status: {
74 |     verified: "Verified",
75 |     unverified: "Unverified",
76 |   },
77 |   roles: {
78 |     owner: "Owner",
79 |     member: "Member",
80 |   },
81 |   tracker_status: {
82 |     in_progress: "In progress",
83 |     completed: "Completed",
84 |   },
85 |   notifications: {
86 |     inbox: "Receive notifications about new items in your inbox.",
87 |     match: "Receive notifications about matches.",
88 |     transaction: "Receive notifications about a new transaction.",
89 |     transactions: "Receive notifications about new transactions.",
90 |     "invoice.paid": "Receive notifications about paid invoices.",
91 |     "invoice.overdue": "Receive notifications about overdue invoices.",
92 |     "inbox.match": "Receive notifications about new matches in your inbox.",
93 |   },
94 |   widgets: {
95 |     insights: "Assistant",
96 |     inbox: "Inbox",
97 |     spending: "Spending",
98 |     transactions: "Transactions",
99 |     tracker: "Tracker",
100 |   },
101 |   bottom_bar: {
102 |     "transactions#one": "1 Transaction",
103 |     "transactions#other": "{count} Transactions",
104 |     multi_currency: "Multi currency",
105 |     description: "Includes transactions from all pages of results",
106 |   },
107 |   account_type: {
108 |     depository: "Depository",
109 |     credit: "Credit",
110 |     other_asset: "Other Asset",
111 |     loan: "Loan",
112 |     other_liability: "Other Liability",
113 |   },
114 |   tags: {
115 |     bylaws: "Bylaws",
116 |     shareholder_agreements: "Shareholder Agreements",
117 |     board_meeting: "Board Meeting",
118 |     corporate_policies: "Corporate Policies",
119 |     annual_reports: "Annual Reports",
120 |     budget_reports: "Budget Reports",
121 |     audit_reports: "Audit Reports",
122 |     tax_returns: "Tax Returns",
123 |     invoices_and_receipts: "Invoices & Receipts",
124 |     employee_handbook: "Employee Handbook",
125 |     payroll_records: "Payroll Records",
126 |     performance_reviews: "Performance Reviews",
127 |     employee_training_materials: "Employee Training Materials",
128 |     benefits_documentation: "Benefits Documentation",
129 |     termination_letters: "Termination Letters",
130 |     patents: "Patents",
131 |     trademarks: "Trademarks",
132 |     copyrights: "Copyrights",
133 |     client_contracts: "Client Contracts",
134 |     financial_records: "Financial Records",
135 |     compliance_reports: "Compliance Reports",
136 |     regulatory_filings: "Regulatory Filings",
137 |     advertising_copy: "Advertising Copy",
138 |     press_releases: "Press Releases",
139 |     branding_guidelines: "Branding Guidelines",
140 |     market_research_reports: "Market Research Reports",
141 |     campaign_performance_reports: "Campaign Performance Reports",
142 |     customer_surveys: "Customer Surveys",
143 |     quality_control_reports: "Quality Control Reports",
144 |     inventory_reports: "Inventory Reports",
145 |     maintenance_logs: "Maintenance Logs",
146 |     production_schedules: "Production Schedules",
147 |     vendor_agreements: "Vendor Agreements",
148 |     supplier_agreements: "Supplier Agreements",
149 |     sales_contracts: "Sales Contracts",
150 |     sales_reports: "Sales Reports",
151 |     client_proposals: "Client Proposals",
152 |     customer_order_forms: "Customer Order Forms",
153 |     sales_presentations: "Sales Presentations",
154 |     data_security_plans: "Data Security Plans",
155 |     system_architecture_diagrams: "System Architecture Diagrams",
156 |     incident_response_plans: "Incident Response Plans",
157 |     user_manuals: "User Manuals",
158 |     software_licenses: "Software Licenses",
159 |     data_backup_logs: "Data Backup Logs",
160 |     project_plans: "Project Plans",
161 |     task_lists: "Task Lists",
162 |     risk_management_plans: "Risk Management Plans",
[TRUNCATED]
```

apps/dashboard/src/locales/server.ts
```
1 | import { createI18nServer } from "next-international/server";
2 |
3 | export const { getI18n, getScopedI18n, getStaticParams } = createI18nServer({
4 |   en: () => import("./en"),
5 |   // sv: () => import("./sv"),
6 | });
```

apps/dashboard/src/locales/sv.ts
```
1 | export default {
2 |   transaction_methods: {
3 |     card_purchase: "Kortbetalning",
4 |     payment: "Betalning",
5 |     card_atm: "Kort bankomat",
6 |     transfer: "Överföring",
7 |     other: "Annan",
8 |     ach: "Ach",
9 |     deposit: "Deposition",
10 |     wire: "Wire",
11 |     fee: "Avgift",
12 |     interest: "Ränta",
13 |   },
14 |   language: {
15 |     title: "Språk",
16 |     description: "Ändra språket som används i användargränssnittet.",
17 |     placeholder: "Välj språk",
18 |   },
19 |   languages: {
20 |     en: "Engelska",
21 |     sv: "Svenska",
22 |   },
23 |   timezone: {
24 |     title: "Tidzon",
25 |     description: "Aktuell tidzoninställning.",
26 |     placeholder: "Välj tidzon",
27 |   },
28 |   inbox_filter: {
29 |     all: "Alla",
30 |     todo: "Att göra",
31 |     done: "Slutförda",
32 |   },
33 |   spending_period: {
34 |     last_30d: "Senaste 30 dagarna",
35 |     this_month: "Den här månaden",
36 |     last_month: "Förra månaden",
37 |     this_year: "Det här året",
38 |     last_year: "Förra året",
39 |   },
40 |   transactions_period: {
41 |     all: "All",
42 |     income: "Inkomst",
43 |     outcome: "Utgifter",
44 |   },
45 |   chart_type: {
46 |     profit: "Vinst",
47 |     revenue: "Omsättning",
48 |     burn_rate: "Brännhastighet",
49 |   },
50 |   folders: {
51 |     all: "Alla",
52 |     exports: "Exporteringar",
53 |     inbox: "Inkorg",
54 |     imports: "Importer",
55 |     transactions: "Transaktioner",
56 |     invoices: "Fakturor",
57 |   },
58 |   mfa_status: {
59 |     verified: "Verifierad",
60 |     unverified: "Overifierad",
61 |   },
62 |   roles: {
63 |     owner: "Ägare",
64 |     member: "Medlem",
65 |   },
66 |   tracker_status: {
67 |     in_progress: "Pågående",
68 |     completed: "Färdig",
69 |   },
70 |   account_balance: {
71 |     total_balance: "Total saldo",
72 |   },
73 | } as const;
```

apps/dashboard/src/store/assistant.ts
```
1 | import { create } from "zustand";
2 |
3 | interface AssistantState {
4 |   isOpen: boolean;
5 |   message?: string;
6 |   setOpen: (message?: string) => void;
7 | }
8 |
9 | export const useAssistantStore = create<AssistantState>()((set) => ({
10 |   isOpen: false,
11 |   message: undefined,
12 |   setOpen: (message) => set((state) => ({ isOpen: !state.isOpen, message })),
13 | }));
```

apps/dashboard/src/store/export.ts
```
1 | import { create } from "zustand";
2 |
3 | interface ExportState {
4 |   exportData?: {
5 |     runId?: string;
6 |     accessToken?: string;
7 |   };
8 |   setExportData: (exportData?: {
9 |     runId?: string;
10 |     accessToken?: string;
11 |   }) => void;
12 | }
13 |
14 | export const useExportStore = create<ExportState>()((set) => ({
15 |   exportData: undefined,
16 |   setExportData: (exportData) => set({ exportData }),
17 | }));
```

apps/dashboard/src/store/menu.ts
```
1 | import { create } from "zustand";
2 |
3 | interface MenuState {
4 |   isCustomizing: boolean;
5 |   setCustomizing: (isCustomizing: boolean) => void;
6 |   toggleCustomizing: () => void;
7 | }
8 |
9 | export const useMenuStore = create<MenuState>()((set) => ({
10 |   isCustomizing: false,
11 |   setCustomizing: (isCustomizing) => set({ isCustomizing }),
12 |   toggleCustomizing: () =>
13 |     set((state) => ({ isCustomizing: !state.isCustomizing })),
14 | }));
```

apps/dashboard/src/store/transactions.ts
```
1 | import type { RowSelectionState, Updater } from "@tanstack/react-table";
2 | import { create } from "zustand";
3 |
4 | interface TransactionsState {
5 |   canDelete?: boolean;
6 |   columns: string[];
7 |   setColumns: (columns?: string[]) => void;
8 |   setCanDelete: (canDelete?: boolean) => void;
9 |   setRowSelection: (updater: Updater<RowSelectionState>) => void;
10 |   rowSelection: Record<string, boolean>;
11 | }
12 |
13 | export const useTransactionsStore = create<TransactionsState>()((set) => ({
14 |   columns: [],
15 |   canDelete: false,
16 |   rowSelection: {},
17 |   setCanDelete: (canDelete) => set({ canDelete }),
18 |   setColumns: (columns) => set({ columns }),
19 |   setRowSelection: (updater: Updater<RowSelectionState>) =>
20 |     set((state) => {
21 |       return {
22 |         rowSelection:
23 |           typeof updater === "function" ? updater(state.rowSelection) : updater,
24 |       };
25 |     }),
26 | }));
```

apps/dashboard/src/styles/globals.css
```
1 | html,
2 | body {
3 |   height: 100%;
4 | }
5 |
6 | *:focus {
7 |   outline: none;
8 | }
9 |
10 | .skeleton-box {
11 |   background-color: hsl(var(--border));
12 |   color: hsl(var(--border)) !important;
13 |   user-select: none !important;
14 |   cursor: default !important;
15 |   animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
16 |   border-color: transparent !important;
17 | }
18 |
19 | .skeleton-circle {
20 |   background-color: hsl(var(--border));
21 |   border-radius: 1000px !important;
22 |   color: hsl(var(--border)) !important;
23 |   user-select: none !important;
24 |   cursor: default !important;
25 |   animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
26 |   border-color: transparent !important;
27 | }
28 |
29 | .skeleton-circle > *,
30 | .skeleton-box > *,
31 | .skeleton-line > * {
32 |   opacity: 0 !important;
33 | }
34 |
35 | .pin-field-container {
36 |   display: grid;
37 |   grid-auto-columns: max-content;
38 |   grid-auto-flow: column;
39 |   justify-content: center;
40 |   margin: 4rem 0;
41 | }
42 |
43 | .pin-field {
44 |   border: 1px solid hsl(var(--border));
45 |   background-color: hsl(var(--accent));
46 |   border-right: none;
47 |   font-size: 2rem;
48 |   height: 4rem;
49 |   outline: none;
50 |   text-align: center;
51 |   transition-duration: 250ms;
52 |   transition-property: color, border, box-shadow, transform;
53 |   width: 4rem;
54 | }
55 |
56 | .pin-field:last-of-type {
57 |   border-radius: 0 0.5rem 0.5rem 0;
58 |   border-right: 1px solid hsl(var(--border));
59 | }
60 |
61 | .pin-field:focus {
62 |   box-shadow: "0 0 0.25rem rgba(white, 0.5)";
63 |   opacity: 0.9;
64 |   outline: none;
65 | }
66 |
67 | .invalid {
68 |   animation: shake 0.2s ease-in-out 0s 2;
69 | }
70 |
71 | .pin-field:first-of-type {
72 |   border-radius: 0.5rem 0 0 0.5rem;
73 | }
74 |
75 | .pin-field[disabled] {
76 |   cursor: not-allowed;
77 |   opacity: 0.5;
78 | }
79 |
80 | @keyframes shake {
81 |   0% {
82 |     transform: translateX(0rem);
83 |   }
84 |   25% {
85 |     transform: translateX(0.5rem);
86 |   }
87 |   75% {
88 |     transform: translateX(-0.5rem);
89 |   }
90 |   100% {
91 |     transform: translateX(0rem);
92 |   }
93 | }
94 |
95 | /* Desktop App */
96 | html.todesktop {
97 |   user-select: none;
98 |   -webkit-user-select: none;
99 | }
100 |
101 | html.todesktop,
102 | html.todesktop div {
103 |   cursor: default !important;
104 | }
105 |
106 | html.todesktop,
107 | html.todesktop.div {
108 |   cursor: default !important;
109 | }
110 |
111 | html.todesktop a {
112 |   cursor: pointer !important;
113 | }
114 |
115 | .update-available {
116 |   background: #68a7ff;
117 |   width: 12px;
118 |   height: 12px;
119 |   border-radius: 50%;
120 |   position: relative;
121 | }
122 |
123 | .update-available svg {
124 |   position: absolute;
125 |   width: 12px;
126 |   height: 12px;
127 |   top: 0;
128 |   left: 0;
129 | }
130 |
131 | .update-available svg path.svg-update {
132 |   opacity: 1;
133 |   transform: scale(1);
134 | }
135 |
136 | .update-available svg circle.svg-progress {
137 |   stroke-dashoffset: 16px;
138 |   stroke-dasharray: 16px;
139 |   transform: rotate(270deg);
140 |   transform-origin: center;
141 | }
142 |
143 | .update-available.progress svg path.svg-update,
144 | .update-available.update-downloaded svg path.svg-update {
145 |   opacity: 0;
146 |   transform: scale(0.5);
147 | }
148 |
149 | .update-available.progress svg circle.svg-progress {
150 |   stroke-dashoffset: 0px;
151 |   transform: rotate(270deg);
152 |   transition: all 4s linear;
153 | }
154 |
155 | .update-available svg path.svg-refresh {
156 |   opacity: 0;
157 |   transform: scale(0.2) rotate(-135deg);
158 |   transition: all .3s ease;
159 |   transform-origin: center;
160 | }
161 |
162 | .update-available.update-downloaded svg path.svg-refresh {
163 |   opacity: 1;
164 |   transform: scale(1) rotate(0);
165 | }
166 |
167 | @keyframes anim-update {
168 |   0% {
169 |     transform: scale(0);
170 |     opacity: 1;
171 |   }
172 |   100% {
173 |     transform: scale(4);
174 |     opacity: 0;
175 |   }
176 | }
177 |
178 | /* Desktop Command menu */
179 | html.light.todesktop-panel {
180 |   background-color: rgba(255, 255, 255, 0.5);
181 | }
182 |
183 | html.dark.todesktop-panel {
184 |   background-color: rgba(000, 000, 000, 0.3);
185 | }
186 |
187 | html.todesktop-panel body {
[TRUNCATED]
```

apps/dashboard/src/utils/categories.ts
```
1 | export const colors = [
2 |   "#FF6900", // Orange
3 |   "#FCB900", // Yellow
4 |   "#00D084", // Emerald
5 |   "#8ED1FC", // Sky Blue
6 |   "#0693E3", // Blue
7 |   "#ABB8C3", // Gray
8 |   "#EB144C", // Red
9 |   "#F78DA7", // Pink
10 |   "#9900EF", // Purple
11 |   "#0079BF", // Dark Blue
12 |   "#B6BBBF", // Light Gray
13 |   "#FF5A5F", // Coral
14 |   "#F7C59F", // Peach
15 |   "#8492A6", // Slate
16 |   "#4D5055", // Charcoal
17 |   "#AF5A50", // Terracotta
18 |   "#F9D6E7", // Pale Pink
19 |   "#B5EAEA", // Pale Cyan
20 |   "#B388EB", // Lavender
21 |   "#B04632", // Rust
22 |   "#FF78CB", // Pink
23 |   "#4E5A65", // Gray
24 |   "#01FF70", // Lime
25 |   "#85144b", // Pink
26 |   "#F012BE", // Purple
27 |   "#7FDBFF", // Sky Blue
28 |   "#3D9970", // Olive
29 |   "#AAAAAA", // Silver
30 |   "#111111", // Black
31 |   "#0074D9", // Blue
32 |   "#39CCCC", // Teal
33 |   "#001f3f", // Navy
34 |   "#FF9F1C", // Orange
35 |   "#5E6A71", // Ash
36 |   "#75D701", // Neon Green
37 |   "#B6C8A9", // Lichen
38 |   "#00A9FE", // Electric Blue
39 |   "#EAE8E1", // Bone
40 |   "#CD346C", // Raspberry
41 |   "#FF6FA4", // Pink Sherbet
42 |   "#D667FB", // Purple Mountain Majesty
43 |   "#0080FF", // Azure
44 |   "#656D78", // Dim Gray
45 |   "#F8842C", // Tangerine
46 |   "#FF8CFF", // Carnation Pink
47 |   "#647F6A", // Feldgrau
48 |   "#5E574E", // Field Drab
49 |   "#EF5466", // KU Crimson
50 |   "#B0E0E6", // Powder Blue
51 |   "#EB5E7C", // Rose Pink
52 |   "#8A2BE2", // Blue Violet
53 |   "#6B7C85", // Slate Gray
54 |   "#8C92AC", // Lavender Blue
55 |   "#6C587A", // Eminence
56 |   "#52A1FF", // Azureish White
57 |   "#32CD32", // Lime Green
58 |   "#E04F9F", // Orchid Pink
59 |   "#915C83", // Lilac Bush
60 |   "#4C6B88", // Air Force Blue
61 |   "#587376", // Cadet Blue
62 |   "#C46210", // Buff
63 |   "#65B0D0", // Columbia Blue
64 |   "#2F4F4F", // Dark Slate Gray
65 |   "#528B8B", // Dark Cyan
66 |   "#8B4513", // Saddle Brown
67 |   "#4682B4", // Steel Blue
68 |   "#CD853F", // Peru
69 |   "#FFA07A", // Light Salmon
70 |   "#CD5C5C", // Indian Red
71 |   "#483D8B", // Dark Slate Blue
72 |   "#696969", // Dim Gray
73 | ];
74 |
75 | export function customHash(value: string) {
76 |   let hash = 0;
77 |
78 |   for (let i = 0; i < value.length; i++) {
79 |     hash = (hash << 5) + value.charCodeAt(i);
80 |     hash = hash & hash;
81 |   }
82 |
83 |   return Math.abs(hash);
84 | }
85 |
86 | export function getColor(value: string, arrayLength: number) {
87 |   const hashValue = customHash(value);
88 |   const index = hashValue % arrayLength;
89 |   return index;
90 | }
91 |
92 | export function getColorFromName(value: string) {
93 |   const index = getColor(value, colors.length);
94 |
95 |   return colors[index];
96 | }
97 |
98 | export function getRandomColor() {
99 |   const randomIndex = Math.floor(Math.random() * colors.length);
100 |   return colors[randomIndex];
101 | }
```

apps/dashboard/src/utils/connection-status.ts
```
1 | import { differenceInDays } from "date-fns";
2 |
3 | const DISPLAY_DAYS = 30;
4 | const WARNING_DAYS = 14;
5 | const ERROR_DAYS = 7;
6 |
7 | type Connection = {
8 |   expires_at?: string | null;
9 | };
10 |
11 | export function getConnectionsStatus(connections: Connection[] | null) {
12 |   const warning = connections?.some(
13 |     (connection) =>
14 |       connection.expires_at &&
15 |       differenceInDays(new Date(connection.expires_at), new Date()) <=
16 |         WARNING_DAYS,
17 |   );
18 |
19 |   const error = connections?.some(
20 |     (connection) =>
21 |       connection.expires_at &&
22 |       differenceInDays(new Date(connection.expires_at), new Date()) <=
23 |         ERROR_DAYS,
24 |   );
25 |
26 |   const expired = connections?.some(
27 |     (connection) =>
28 |       connection.expires_at &&
29 |       differenceInDays(new Date(connection.expires_at), new Date()) <= 0,
30 |   );
31 |
32 |   const show = connections?.some(
33 |     (connection) =>
34 |       connection.expires_at &&
35 |       differenceInDays(new Date(connection.expires_at), new Date()) <=
36 |         DISPLAY_DAYS,
37 |   );
38 |
39 |   return {
40 |     warning,
41 |     expired,
42 |     error,
43 |     show,
44 |   };
45 | }
46 |
47 | export function connectionStatus(connection: Connection) {
48 |   const warning =
49 |     connection.expires_at &&
50 |     differenceInDays(new Date(connection.expires_at), new Date()) <=
51 |       WARNING_DAYS;
52 |
53 |   const error =
54 |     connection.expires_at &&
55 |     differenceInDays(new Date(connection.expires_at), new Date()) <= ERROR_DAYS;
56 |
57 |   const expired =
58 |     connection.expires_at &&
59 |     differenceInDays(new Date(connection.expires_at), new Date()) <= 0;
60 |
61 |   const show =
62 |     connection.expires_at &&
63 |     differenceInDays(new Date(connection.expires_at), new Date()) <=
64 |       DISPLAY_DAYS;
65 |
66 |   return {
67 |     warning,
68 |     error,
69 |     expired,
70 |     show,
71 |   };
72 | }
```

apps/dashboard/src/utils/constants.ts
```
1 | export const Cookies = {
2 |   PreferredSignInProvider: "preferred-signin-provider",
3 |   SpendingPeriod: "spending-period",
4 |   ChartType: "chart-type",
5 |   TransactionsPeriod: "transactions-period",
6 |   TransactionsColumns: "transactions-columns",
7 |   MfaSetupVisited: "mfa-setup-visited",
8 |   MenuConfig: "menu-config-v2",
9 |   InboxFilter: "inbox-filter-v2",
10 |   TrackingConsent: "tracking-consent",
11 |   InboxOrder: "inbox-order",
12 |   HideConnectFlow: "hide-connect-flow",
13 |   LastProject: "last-project",
14 | };
```

apps/dashboard/src/utils/currency.test.ts
```
1 | import { describe, expect, test } from "bun:test";
2 | import { getMostFrequentCurrency } from "./currency";
3 |
4 | describe("Get most frequent currency", () => {
5 |   const accounts = [
6 |     { currency: "USD" },
7 |     { currency: "USD" },
8 |     { currency: "EUR" },
9 |   ];
10 |
11 |   test("should return the most frequent currency", () => {
12 |     expect(getMostFrequentCurrency(accounts)).toBe("USD");
13 |   });
14 |
15 |   test("should return the first currency if all are equally frequent", () => {
16 |     expect(getMostFrequentCurrency(accounts)).toBe("USD");
17 |   });
18 |
19 |   test("should return the null if there are no accounts", () => {
20 |     const accounts: { currency: string }[] = [];
21 |     expect(getMostFrequentCurrency(accounts)).toBe(null);
22 |   });
23 | });
```

apps/dashboard/src/utils/currency.ts
```
1 | export function getMostFrequentCurrency(
2 |   accounts: { currency: string }[],
3 | ): string | null {
4 |   if (accounts.length === 0) {
5 |     return null;
6 |   }
7 |
8 |   const currencyFrequency = accounts.reduce((acc, account) => {
9 |     acc.set(account.currency, (acc.get(account.currency) || 0) + 1);
10 |     return acc;
11 |   }, new Map<string, number>());
12 |
13 |   if (currencyFrequency.size === 1) {
14 |     return currencyFrequency.keys().next().value;
15 |   }
16 |
17 |   const mostFrequent = [...currencyFrequency.entries()].reduce((a, b) =>
18 |     a[1] > b[1] ? a : b[1] === a[1] ? (a[0] < b[0] ? a : b) : b,
19 |   );
20 |
21 |   return mostFrequent[0];
22 | }
```

apps/dashboard/src/utils/dub.ts
```
1 | import { Dub } from "dub";
2 |
3 | export const dub = new Dub();
```

apps/dashboard/src/utils/format.ts
```
1 | import type { TZDate } from "@date-fns/tz";
2 | import {
3 |   differenceInDays,
4 |   differenceInMonths,
5 |   format,
6 |   isSameYear,
7 |   startOfDay,
8 | } from "date-fns";
9 |
10 | export function formatSize(bytes: number): string {
11 |   const units = ["byte", "kilobyte", "megabyte", "gigabyte", "terabyte"];
12 |
13 |   const unitIndex = Math.max(
14 |     0,
15 |     Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1),
16 |   );
17 |
18 |   return Intl.NumberFormat("en-US", {
19 |     style: "unit",
20 |     unit: units[unitIndex],
21 |   }).format(+Math.round(bytes / 1024 ** unitIndex));
22 | }
23 |
24 | type FormatAmountParams = {
25 |   currency: string;
26 |   amount: number;
27 |   locale?: string;
28 |   maximumFractionDigits?: number;
29 |   minimumFractionDigits?: number;
30 | };
31 |
32 | export function formatAmount({
33 |   currency,
34 |   amount,
35 |   locale = "en-US",
36 |   minimumFractionDigits,
37 |   maximumFractionDigits,
38 | }: FormatAmountParams) {
39 |   if (!currency) {
40 |     return;
41 |   }
42 |
43 |   return Intl.NumberFormat(locale, {
44 |     style: "currency",
45 |     currency,
46 |     minimumFractionDigits,
47 |     maximumFractionDigits,
48 |   }).format(amount);
49 | }
50 |
51 | export function secondsToHoursAndMinutes(seconds: number) {
52 |   const hours = Math.floor(seconds / 3600);
53 |   const minutes = Math.floor((seconds % 3600) / 60);
54 |
55 |   if (hours && minutes) {
56 |     return `${hours}:${minutes.toString().padStart(2, "0")}h`;
57 |   }
58 |
59 |   if (hours) {
60 |     return `${hours}h`;
61 |   }
62 |
63 |   if (minutes) {
64 |     return `${minutes}m`;
65 |   }
66 |
67 |   return "0h";
68 | }
69 |
70 | type BurnRateData = {
71 |   value: number;
72 |   date: string;
73 | };
74 |
75 | export function calculateAvgBurnRate(data: BurnRateData[] | null) {
76 |   if (!data) {
77 |     return 0;
78 |   }
79 |
80 |   return data?.reduce((acc, curr) => acc + curr.value, 0) / data?.length;
81 | }
82 |
83 | export function formatDate(date: string, dateFormat?: string) {
84 |   if (isSameYear(new Date(), new Date(date))) {
85 |     return format(new Date(date), "MMM d");
86 |   }
87 |
88 |   return format(new Date(date), dateFormat ?? "P");
89 | }
90 |
91 | export function getInitials(value: string) {
92 |   const formatted = value.toUpperCase().replace(/[\s.-]/g, "");
93 |
94 |   if (formatted.split(" ").length > 1) {
95 |     return `${formatted.charAt(0)}${formatted.charAt(1)}`;
96 |   }
97 |
98 |   if (value.length > 1) {
99 |     return formatted.charAt(0) + formatted.charAt(1);
100 |   }
101 |
102 |   return formatted.charAt(0);
103 | }
104 |
105 | export function formatAccountName({
106 |   name,
107 |   currency,
108 | }: { name?: string; currency?: string }) {
109 |   if (currency) {
110 |     return `${name} (${currency})`;
111 |   }
112 |
113 |   return name;
114 | }
115 |
116 | export function formatDateRange(dates: TZDate[]): string {
117 |   if (!dates.length) return "";
118 |
119 |   const formatFullDate = (date: TZDate) => format(date, "MMM d");
120 |   const formatDay = (date: TZDate) => format(date, "d");
121 |
122 |   if (dates.length === 1 || dates[0].getTime() === dates[1]?.getTime()) {
123 |     return formatFullDate(dates[0]);
124 |   }
125 |
126 |   const startDate = dates[0];
127 |   const endDate = dates[1];
128 |
129 |   if (!startDate || !endDate) return "";
130 |
131 |   if (startDate.getMonth() === endDate.getMonth()) {
132 |     // Same month
133 |     return `${format(startDate, "MMM")} ${formatDay(startDate)} - ${formatDay(endDate)}`;
134 |   }
135 |   // Different months
136 |   return `${formatFullDate(startDate)} - ${formatFullDate(endDate)}`;
137 | }
138 |
139 | export function getDueDateStatus(dueDate: string): string {
140 |   const now = new Date();
141 |   const due = new Date(dueDate);
142 |
143 |   // Set both dates to the start of their respective days
144 |   const nowDay = startOfDay(now);
145 |   const dueDay = startOfDay(due);
146 |
147 |   const diffDays = differenceInDays(dueDay, nowDay);
148 |   const diffMonths = differenceInMonths(dueDay, nowDay);
149 |
150 |   if (diffDays === 0) return "Today";
151 |   if (diffDays === 1) return "Tomorrow";
152 |   if (diffDays === -1) return "Yesterday";
153 |
154 |   if (diffDays > 0) {
155 |     if (diffMonths < 1) return `in ${diffDays} days`;
156 |     return `in ${diffMonths} month${diffMonths === 1 ? "" : "s"}`;
157 |   }
158 |
159 |   if (diffMonths < 1)
160 |     return `${Math.abs(diffDays)} day${Math.abs(diffDays) === 1 ? "" : "s"} ago`;
161 |   return `${diffMonths} month${diffMonths === 1 ? "" : "s"} ago`;
162 | }
163 |
164 | export function formatRelativeTime(date: Date): string {
165 |   const now = new Date();
[TRUNCATED]
```

apps/dashboard/src/utils/logger.ts
```
1 | export const logger = (message: string, params?: unknown) => {
2 |   console.log(message, params);
3 | };
```

apps/dashboard/src/utils/process.ts
```
1 | export async function processPromisesBatch(items: any, limit: number, fn) {
2 |   const batches = [];
3 |   let result: any = [];
4 |
5 |   // Split the items into batches
6 |   for (let i = 0; i < items?.length; i += limit) {
7 |     batches.push(items.slice(i, i + limit));
8 |   }
9 |
10 |   // Process batches serially
11 |   for (const batch of batches) {
12 |     const processedBatch = await fn(batch);
13 |     result = result.concat(processedBatch);
14 |   }
15 |
16 |   return result;
17 | }
```

apps/dashboard/src/utils/resend.ts
```
1 | import { Resend } from "resend";
2 |
3 | export const resend = new Resend(process.env.RESEND_API_KEY!);
```

apps/dashboard/src/utils/teller.ts
```
1 | import crypto from "node:crypto";
2 |
3 | // https://teller.io/docs/api/webhooks#verifying-messages
4 | export const validateTellerSignature = (params: {
5 |   signatureHeader: string | null;
6 |   text: string;
7 | }): boolean => {
8 |   if (!params.signatureHeader) {
9 |     return false;
10 |   }
11 |
12 |   const { timestamp, signatures } = parseTellerSignatureHeader(
13 |     params.signatureHeader,
14 |   );
15 |
16 |   const threeMinutesAgo = Math.floor(Date.now() / 1000) - 3 * 60;
17 |
18 |   if (Number.parseInt(timestamp) < threeMinutesAgo) {
19 |     return false;
20 |   }
21 |
22 |   // Ensure the text is used as a raw string
23 |   const signedMessage = `${timestamp}.${params.text}`;
24 |   const calculatedSignature = crypto
25 |     .createHmac("sha256", process.env.TELLER_SIGNING_SECRET!)
26 |     .update(signedMessage)
27 |     .digest("hex");
28 |
29 |   // Compare calculated signature with provided signatures
30 |   return signatures.includes(calculatedSignature);
31 | };
32 |
33 | export const parseTellerSignatureHeader = (
34 |   header: string,
35 | ): { timestamp: string; signatures: string[] } => {
36 |   const parts = header.split(",");
37 |   const timestampPart = parts.find((p) => p.startsWith("t="));
38 |   const signatureParts = parts.filter((p) => p.startsWith("v1="));
39 |
40 |   if (!timestampPart) {
41 |     throw new Error("No timestamp in Teller-Signature header");
42 |   }
43 |
44 |   const timestamp = timestampPart.split("=")[1];
45 |   const signatures = signatureParts
46 |     .map((p) => p.split("=")[1])
47 |     .filter((sig): sig is string => sig !== undefined);
48 |
49 |   if (!timestamp || signatures.some((sig) => !sig)) {
50 |     throw new Error("Invalid Teller-Signature header format");
51 |   }
52 |
53 |   return { timestamp, signatures };
54 | };
```

apps/dashboard/src/utils/tracker.ts
```
1 | import {
2 |   addMinutes,
3 |   addSeconds,
4 |   eachDayOfInterval,
5 |   format,
6 |   parseISO,
7 |   setHours,
8 |   setMinutes,
9 | } from "date-fns";
10 |
11 | export const NEW_EVENT_ID = "new-event";
12 |
13 | export function sortDates(dates: string[]) {
14 |   return dates.sort((a, b) => new Date(a).getTime() - new Date(b).getTime());
15 | }
16 |
17 | export function getTrackerDates(
18 |   range: string[] | null,
19 |   selectedDate: string | null,
20 | ): Date[] {
21 |   if (range) {
22 |     return sortDates(range).map((dateString) => new Date(dateString));
23 |   }
24 |
25 |   if (selectedDate) {
26 |     return [new Date(selectedDate)];
27 |   }
28 |
29 |   return [new Date()];
30 | }
31 |
32 | export const formatHour = (hour: number, timeFormat: number) => {
33 |   const date = new Date();
34 |   date.setHours(hour, 0, 0, 0);
35 |   return format(date, timeFormat === 12 ? "hh:mm a" : "HH:mm");
36 | };
37 |
38 | export const getTimeFromDate = (date: Date) => {
39 |   return format(date, "HH:mm");
40 | };
41 |
42 | export const getSlotFromDate = (date: Date) => {
43 |   return date.getHours() * 4 + Math.floor(date.getMinutes() / 15);
44 | };
45 |
46 | export const createNewEvent = (
47 |   slot: number,
48 |   selectedProjectId: string | null,
49 | ): TrackerRecord => {
50 |   const startDate = setMinutes(
51 |     setHours(new Date(), Math.floor(slot / 4)),
52 |     (slot % 4) * 15,
53 |   );
54 |   const endDate = addMinutes(startDate, 15);
55 |   return {
56 |     id: NEW_EVENT_ID,
57 |     start: startDate,
58 |     end: endDate,
59 |     project: { id: selectedProjectId ?? "", name: "" },
60 |   };
61 | };
62 |
63 | export const updateEventTime = (
64 |   event: TrackerRecord,
65 |   start: Date,
66 |   end: Date,
67 | ): TrackerRecord => {
68 |   return { ...event, start, end };
69 | };
70 |
71 | export const getDates = (
72 |   selectedDate: string | null,
73 |   sortedRange: string[] | null,
74 | ): string[] => {
75 |   if (selectedDate) return [selectedDate];
76 |   if (sortedRange && sortedRange.length === 2) {
77 |     const [start, end] = sortedRange;
78 |     if (start && end) {
79 |       return eachDayOfInterval({
80 |         start: parseISO(start),
81 |         end: parseISO(end),
82 |       }).map((date) => format(date, "yyyy-MM-dd"));
83 |     }
84 |   }
85 |   return [];
86 | };
87 |
88 | export const transformTrackerData = (
89 |   event: any,
90 |   selectedDate: string | null,
91 | ): TrackerRecord => {
92 |   const start = event.start
93 |     ? parseISO(event.start)
94 |     : parseISO(`${event.date || selectedDate}T09:00:00`);
95 |   const end = event.end
96 |     ? parseISO(event.end)
97 |     : addSeconds(start, event.duration || 0);
98 |
99 |   return {
100 |     ...event,
101 |     id: event.id,
102 |     start,
103 |     end,
104 |     project: {
105 |       id: event.project_id,
106 |       name: event.project?.name || "",
107 |       customer: event.project?.customer,
108 |     },
109 |     description: event.description,
110 |   };
111 | };
```

apps/dashboard/src/utils/upload.ts
```
1 | import { stripSpecialCharacters } from "@midday/utils";
2 | import type { SupabaseClient } from "@supabase/supabase-js";
3 | import * as tus from "tus-js-client";
4 |
5 | type ResumableUploadParmas = {
6 |   file: File;
7 |   path: string[];
8 |   bucket: string;
9 |   onProgress?: (bytesUploaded: number, bytesTotal: number) => void;
10 | };
11 |
12 | export async function resumableUpload(
13 |   client: SupabaseClient,
14 |   { file, path, bucket, onProgress }: ResumableUploadParmas,
15 | ) {
16 |   const {
17 |     data: { session },
18 |   } = await client.auth.getSession();
19 |
20 |   const filename = stripSpecialCharacters(file.name);
21 |
22 |   const fullPath = decodeURIComponent([...path, filename].join("/"));
23 |
24 |   return new Promise((resolve, reject) => {
25 |     const upload = new tus.Upload(file, {
26 |       endpoint: `https://${process.env.NEXT_PUBLIC_SUPABASE_ID}.supabase.co/storage/v1/upload/resumable`,
27 |       retryDelays: [0, 3000, 5000, 10000],
28 |       headers: {
29 |         authorization: `Bearer ${session?.access_token}`,
30 |         // optionally set upsert to true to overwrite existing files
31 |         "x-upsert": "true",
32 |       },
33 |       uploadDataDuringCreation: true,
34 |       // Important if you want to allow re-uploading the same file https://github.com/tus/tus-js-client/blob/main/docs/api.md#removefingerprintonsuccess
35 |       removeFingerprintOnSuccess: true,
36 |       metadata: {
37 |         bucketName: bucket,
38 |         objectName: fullPath,
39 |         contentType: file.type,
40 |         cacheControl: "3600",
41 |       },
42 |       // NOTE: it must be set to 6MB (for now) do not change it
43 |       chunkSize: 6 * 1024 * 1024,
44 |       onError: (error) => {
45 |         reject(error);
46 |       },
47 |       onProgress,
48 |       onSuccess: () => {
49 |         resolve({
50 |           ...upload,
51 |           filename,
52 |         });
53 |       },
54 |     });
55 |
56 |     // Check if there are any previous uploads to continue.
57 |     return upload.findPreviousUploads().then((previousUploads) => {
58 |       // Found previous uploads so we select the first one.
59 |       if (previousUploads.length) {
60 |         upload.resumeFromPreviousUpload(previousUploads[0]);
61 |       }
62 |
63 |       upload.start();
64 |     });
65 |   });
66 | }
```

apps/docs/api-reference/engine/introduction.mdx
```
1 | ---
2 | title: "Introduction"
3 | "og:title": "Midday Engine API Reference - Introduction"
4 | description: "Fundamental concepts of Midday Engine API."
5 | icon: webhook
6 | ---
7 |
8 | <Frame>
9 |   <img src="/images/engine.png" alt="Midday Engine" width="800" height="420" />
10 | </Frame>
11 |
12 | <Info>
13 |   Midday Engine is currently in beta. If you have any questions or feedback,
14 |   please reach out to us at
15 |   [support@midday.ai](mailto:support@midday.ai?subject=Engine%20API%20API)
16 | </Info>
17 |
18 | ## Base URL
19 |
20 | Midday Engine API is built on REST principles and is served over HTTPS. To ensure data privacy, unencrypted HTTP is not supported.
21 |
22 | The Base URL for all API endpoints is:
23 |
24 | ```bash Terminal
25 | https://engine-api.midday.ai
26 | ```
27 |
28 | ## Authentication
29 |
30 | Authentication to Midday Engine API is performed via the Authorization header with a Bearer token. To authenticate, you need to include the Authorization header with the word `Bearer` followed by your token in your API requests like so:
31 |
32 | ```bash Terminal
33 | Authorization: Bearer <Your-Token>
34 | ```
```

apps/engine/src/client/index.ts
```
1 | import { hc } from "hono/client";
2 | import type { AppType } from "..";
3 |
4 | export const client = hc<AppType>(
5 |   `${process.env.NEXT_PUBLIC_ENGINE_API_URL}/`,
6 |   {
7 |     headers: {
8 |       Authorization: `Bearer ${process.env.MIDDAY_ENGINE_API_KEY}`,
9 |     },
10 |   },
11 | );
```

apps/engine/src/common/bindings.ts
```
1 | export type Bindings = {
2 |   KV: KVNamespace;
3 |   ENRICH_KV: KVNamespace;
4 |   STORAGE: R2Bucket;
5 |   TELLER_CERT: Fetcher;
6 |   AI: Ai;
7 |   API_SECRET_KEY: string;
8 |   GOCARDLESS_SECRET_ID: string;
9 |   GOCARDLESS_SECRET_KEY: string;
10 |   PLAID_CLIENT_ID: string;
11 |   PLAID_ENVIRONMENT: string;
12 |   PLAID_SECRET: string;
13 |   TYPESENSE_API_KEY: string;
14 |   TYPESENSE_ENDPOINT_AU: string;
15 |   TYPESENSE_ENDPOINT_EU: string;
16 |   TYPESENSE_ENDPOINT_US: string;
17 |   TYPESENSE_ENDPOINT: string;
18 |   UPSTASH_REDIS_REST_TOKEN: string;
19 |   UPSTASH_REDIS_REST_URL: string;
20 | };
```

apps/engine/src/common/schema.ts
```
1 | import { z } from "@hono/zod-openapi";
2 |
3 | export const ErrorSchema = z.object({
4 |   code: z.string().openapi({
5 |     example: "disconnected",
6 |   }),
7 |   message: z.string().openapi({
8 |     example:
9 |       "The login details of this item have changed (credentials, MFA, or required user action) and a user login is required to update this information.",
10 |   }),
11 |   requestId: z.string().openapi({
12 |     example: "123e4567-e89b-12d3-a456-426655440000",
13 |   }),
14 | });
15 |
16 | export const GeneralErrorSchema = z.object({
17 |   code: z.string().openapi({
18 |     example: "internal_server_error",
19 |   }),
20 |   message: z.string().openapi({
21 |     example: "Internal server error",
22 |   }),
23 |   requestId: z.string().openapi({
24 |     example: "123e4567-e89b-12d3-a456-426655440000",
25 |   }),
26 | });
27 |
28 | export const Providers = z.enum(["teller", "plaid", "gocardless"]);
29 |
30 | export const HeadersSchema = z.object({
31 |   authorization: z.string().openapi({
32 |     example: "Bearer SECRET",
33 |   }),
34 | });
```

apps/engine/src/providers/index.ts
```
1 | import { logger } from "@/utils/logger";
2 | import { GoCardLessProvider } from "./gocardless/gocardless-provider";
3 | import { PlaidProvider } from "./plaid/plaid-provider";
4 | import { TellerProvider } from "./teller/teller-provider";
5 | import type {
6 |   DeleteAccountsRequest,
7 |   DeleteConnectionRequest,
8 |   GetAccountBalanceRequest,
9 |   GetAccountsRequest,
10 |   GetConnectionStatusRequest,
11 |   GetHealthCheckResponse,
12 |   GetInstitutionsRequest,
13 |   GetTransactionsRequest,
14 |   ProviderParams,
15 | } from "./types";
16 |
17 | export class Provider {
18 |   #name?: string;
19 |
20 |   #provider: PlaidProvider | TellerProvider | GoCardLessProvider | null = null;
21 |
22 |   constructor(params?: ProviderParams) {
23 |     this.#name = params?.provider;
24 |
25 |     switch (params?.provider) {
26 |       case "gocardless":
27 |         this.#provider = new GoCardLessProvider(params);
28 |         break;
29 |       case "teller":
30 |         this.#provider = new TellerProvider(params);
31 |         break;
32 |       case "plaid":
33 |         this.#provider = new PlaidProvider(params);
34 |         break;
35 |       default:
36 |     }
37 |   }
38 |
39 |   async getHealthCheck(
40 |     params: Omit<ProviderParams, "provider">,
41 |   ): Promise<GetHealthCheckResponse> {
42 |     const teller = new TellerProvider(params);
43 |     const plaid = new PlaidProvider(params);
44 |     const gocardless = new GoCardLessProvider(params);
45 |
46 |     try {
47 |       const [isPlaidHealthy, isGocardlessHealthy, isTellerHealthy] =
48 |         await Promise.all([
49 |           plaid.getHealthCheck(),
50 |           gocardless.getHealthCheck(),
51 |           teller.getHealthCheck(),
52 |         ]);
53 |
54 |       return {
55 |         plaid: {
56 |           healthy: isPlaidHealthy,
57 |         },
58 |         gocardless: {
59 |           healthy: isGocardlessHealthy,
60 |         },
61 |         teller: {
62 |           healthy: isTellerHealthy,
63 |         },
64 |       };
65 |     } catch {
66 |       throw Error("Something went wrong");
67 |     }
68 |   }
69 |
70 |   async getTransactions(params: GetTransactionsRequest) {
71 |     logger(
72 |       "getTransactions:",
73 |       `provider: ${this.#name} id: ${params.accountId}`,
74 |     );
75 |
76 |     const data = await this.#provider?.getTransactions(params);
77 |
78 |     if (data) {
79 |       return data;
80 |     }
81 |
82 |     return [];
83 |   }
84 |
85 |   async getAccounts(params: GetAccountsRequest) {
86 |     logger("getAccounts:", `provider: ${this.#name}`);
87 |
88 |     const data = await this.#provider?.getAccounts(params);
89 |
90 |     if (data) {
91 |       return data;
92 |     }
93 |
94 |     return [];
95 |   }
96 |
97 |   async getAccountBalance(params: GetAccountBalanceRequest) {
98 |     logger(
99 |       "getAccountBalance:",
100 |       `provider: ${this.#name} id: ${params.accountId}`,
101 |     );
102 |
103 |     const data = await this.#provider?.getAccountBalance(params);
104 |
105 |     if (data) {
106 |       return data;
107 |     }
108 |
109 |     return null;
110 |   }
111 |
112 |   async getInstitutions(params: GetInstitutionsRequest) {
113 |     logger("getInstitutions:", `provider: ${this.#name}`);
114 |
115 |     const data = await this.#provider?.getInstitutions(params);
116 |
117 |     if (data) {
118 |       return data;
119 |     }
120 |
121 |     return [];
122 |   }
123 |
124 |   async deleteAccounts(params: DeleteAccountsRequest) {
125 |     logger("delete:", `provider: ${this.#name}`);
126 |
127 |     return this.#provider?.deleteAccounts(params);
128 |   }
129 |
130 |   async getConnectionStatus(params: GetConnectionStatusRequest) {
131 |     logger("getConnectionStatus:", `provider: ${this.#name}`);
132 |
133 |     const data = await this.#provider?.getConnectionStatus(params);
134 |
135 |     if (data) {
136 |       return data;
137 |     }
138 |
139 |     return { status: "connected" };
140 |   }
141 |
142 |   async deleteConnection(params: DeleteConnectionRequest) {
143 |     logger("deleteConnection:", `provider: ${this.#name}`);
144 |
145 |     return this.#provider?.deleteConnection(params);
146 |   }
147 | }
```

apps/engine/src/providers/interface.ts
```
1 | import type {
2 |   DeleteAccountsRequest,
3 |   DeleteConnectionRequest,
4 |   GetAccountBalanceRequest,
5 |   GetAccountBalanceResponse,
6 |   GetAccountsRequest,
7 |   GetAccountsResponse,
8 |   GetConnectionStatusRequest,
9 |   GetConnectionStatusResponse,
10 |   GetInstitutionsRequest,
11 |   GetInstitutionsResponse,
12 |   GetTransactionsRequest,
13 |   GetTransactionsResponse,
14 | } from "./types";
15 |
16 | export interface Provider {
17 |   getTransactions: (
18 |     params: GetTransactionsRequest,
19 |   ) => Promise<GetTransactionsResponse>;
20 |   getAccounts: (params: GetAccountsRequest) => Promise<GetAccountsResponse>;
21 |   getAccountBalance: (
22 |     params: GetAccountBalanceRequest,
23 |   ) => Promise<GetAccountBalanceResponse>;
24 |   getInstitutions: (
25 |     params: GetInstitutionsRequest,
26 |   ) => Promise<GetInstitutionsResponse>;
27 |   getHealthCheck: () => Promise<boolean>;
28 |   deleteAccounts: (params: DeleteAccountsRequest) => void;
29 |   getConnectionStatus: (
30 |     params: GetConnectionStatusRequest,
31 |   ) => Promise<GetConnectionStatusResponse>;
32 |   deleteConnection: (params: DeleteConnectionRequest) => void;
33 | }
```

apps/engine/src/providers/types.ts
```
1 | import type { AccountType } from "@/utils/account";
2 |
3 | export type Providers = "teller" | "plaid" | "gocardless";
4 |
5 | export type ProviderParams = {
6 |   provider: Providers;
7 |   kv: KVNamespace;
8 |   fetcher?: Fetcher | null; // Teller
9 |   envs: {
10 |     GOCARDLESS_SECRET_KEY: string;
11 |     GOCARDLESS_SECRET_ID: string;
12 |     PLAID_CLIENT_ID: string;
13 |     PLAID_SECRET: string;
14 |     PLAID_ENVIRONMENT: string;
15 |   };
16 | };
17 |
18 | export type Transaction = {
19 |   id: string;
20 |   amount: number;
21 |   currency: string;
22 |   date: string;
23 |   status: "posted" | "pending";
24 |   balance: number | null;
25 |   category: string | null;
26 |   method: string;
27 |   name: string;
28 |   description: string | null;
29 |   currency_rate: number | null;
30 |   currency_source: string | null;
31 | };
32 |
33 | export type Institution = {
34 |   id: string;
35 |   name: string;
36 |   logo: string | null;
37 |   provider: Providers;
38 | };
39 |
40 | export type Account = {
41 |   id: string;
42 |   name: string;
43 |   currency: string;
44 |   type: AccountType;
45 |   institution: Institution;
46 |   balance: Balance;
47 |   enrollment_id: string | null; // Teller
48 |   resource_id: string | null; // GoCardLess
49 | };
50 |
51 | export type ConnectionStatus = {
52 |   status: "connected" | "disconnected";
53 | };
54 |
55 | export type Balance = {
56 |   amount: number;
57 |   currency: string;
58 | };
59 |
60 | export type GetTransactionsRequest = {
61 |   accountId: string;
62 |   latest?: boolean;
63 |   accessToken?: string; // Teller & Plaid
64 |   accountType: AccountType;
65 | };
66 |
67 | export type GetAccountsRequest = {
68 |   id?: string; // GoCardLess
69 |   accessToken?: string; // Teller & Plaid
70 |   institutionId?: string; // Plaid
71 | };
72 |
73 | export type GetAccountBalanceRequest = {
74 |   accountId: string;
75 |   accessToken?: string; // Teller & Plaid
76 | };
77 |
78 | export type GetAccountBalanceResponse = {
79 |   currency: string;
80 |   amount: number;
81 | };
82 |
83 | export type DeleteAccountsRequest = {
84 |   accountId?: string; // GoCardLess
85 |   accessToken?: string; // Teller & Plaid
86 | };
87 |
88 | export type GetConnectionStatusRequest = {
89 |   id?: string;
90 |   accessToken?: string; // Teller & Plaid
91 | };
92 |
93 | export type GetTransactionsResponse = Transaction[];
94 |
95 | export type GetAccountsResponse = Account[];
96 |
97 | export type GetInstitutionsResponse = {
98 |   id: string;
99 |   name: string;
100 |   logo: string | null;
101 |   provider: Providers;
102 | }[];
103 |
104 | export type GetInstitutionsRequest = {
105 |   countryCode?: string;
106 | };
107 |
108 | export type HealthCheckResponse = {
109 |   healthy: boolean;
110 | };
111 |
112 | export type GetHealthCheckResponse = {
113 |   teller: HealthCheckResponse;
114 |   gocardless: HealthCheckResponse;
115 |   plaid: HealthCheckResponse;
116 | };
117 |
118 | export type GetConnectionStatusResponse = ConnectionStatus;
119 |
120 | export type DeleteConnectionRequest = {
121 |   id: string; // GoCardLess
122 |   accessToken?: string; // Teller & Plaid
123 | };
```

apps/engine/src/utils/account.test.ts
```
1 | import { describe, expect, it } from "bun:test";
2 | import { type AccountType, getType } from "./account";
3 |
4 | describe("getType function", () => {
5 |   it("should return 'depository' for 'depository' input", () => {
6 |     expect(getType("depository")).toBe("depository");
7 |   });
8 |
9 |   it("should return 'credit' for 'credit' input", () => {
10 |     expect(getType("credit")).toBe("credit");
11 |   });
12 |
13 |   it("should return 'other_asset' for any other input", () => {
14 |     expect(getType("loan")).toBe("other_asset");
15 |     expect(getType("investment")).toBe("other_asset");
16 |     expect(getType("unknown")).toBe("other_asset");
17 |   });
18 |
19 |   it("should return AccountType", () => {
20 |     const result: AccountType = getType("depository");
21 |     expect(result).toBe("depository");
22 |   });
23 | });
```

apps/engine/src/utils/account.ts
```
1 | export type AccountType =
2 |   | "depository"
3 |   | "credit"
4 |   | "other_asset"
5 |   | "loan"
6 |   | "other_liability";
7 |
8 | export function getType(type: string): AccountType {
9 |   switch (type) {
10 |     case "depository":
11 |       return "depository";
12 |     case "credit":
13 |       return "credit";
14 |     default:
15 |       return "other_asset";
16 |   }
17 | }
```

apps/engine/src/utils/countries.ts
```
1 | export const GOCARDLESS_COUNTRIES = [
2 |   "AT",
3 |   "BE",
4 |   "BG",
5 |   "HR",
6 |   "CY",
7 |   "CZ",
8 |   "DK",
9 |   "EE",
10 |   "FI",
11 |   "FR",
12 |   "DE",
13 |   "GR",
14 |   "HU",
15 |   "IS",
16 |   "IE",
17 |   "IT",
18 |   "LV",
19 |   "LI",
20 |   "LT",
21 |   "LU",
22 |   "MT",
23 |   "NL",
24 |   "NO",
25 |   "PL",
26 |   "PT",
27 |   "RO",
28 |   "SK",
29 |   "SI",
30 |   "ES",
31 |   "SE",
32 |   "GB",
33 | ];
34 |
35 | export const PLAID_COUNTRIES = ["US", "CA"];
36 |
37 | export const TELLER_COUNTRIES = ["US"];
38 |
39 | const combinedCountries = [
40 |   ...new Set([
41 |     ...GOCARDLESS_COUNTRIES,
42 |     ...PLAID_COUNTRIES,
43 |     ...TELLER_COUNTRIES,
44 |   ]),
45 | ] as const;
46 |
47 | export const ALL_COUNTRIES: readonly string[] = combinedCountries;
```

apps/engine/src/utils/enrich.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { type EnrichBody, OutputSchema } from "@/routes/enrich/schema";
3 | import {
4 |   type LanguageModelV1,
5 |   type Experimental_LanguageModelV1Middleware as LanguageModelV1Middleware,
6 |   generateObject,
7 |   experimental_wrapLanguageModel as wrapLanguageModel,
8 | } from "ai";
9 | import type { Context } from "hono";
10 | import { createWorkersAI } from "workers-ai-provider";
11 | import { prompt } from "./prompt";
12 |
13 | function generateCacheKey(description: string): string {
14 |   return description.toLowerCase().replace(/\s+/g, "_");
15 | }
16 |
17 | export function createCacheMiddleware(
18 |   c: Context<{ Bindings: Bindings }>,
19 |   description: string,
20 | ): LanguageModelV1Middleware {
21 |   return {
22 |     wrapGenerate: async ({ doGenerate }) => {
23 |       const cacheKey = generateCacheKey(description);
24 |
25 |       const cached = (await c.env.ENRICH_KV.get(cacheKey, {
26 |         type: "json",
27 |       })) as Awaited<ReturnType<LanguageModelV1["doGenerate"]>> | null;
28 |
29 |       if (cached !== null) {
30 |         return {
31 |           ...cached,
32 |           response: {
33 |             ...cached.response,
34 |             timestamp: cached?.response?.timestamp
35 |               ? new Date(cached?.response?.timestamp)
36 |               : undefined,
37 |           },
38 |         };
39 |       }
40 |
41 |       const result = await doGenerate();
42 |
43 |       await c.env.ENRICH_KV.put(cacheKey, JSON.stringify(result));
44 |
45 |       return {
46 |         ...result,
47 |         response: {
48 |           ...result.response,
49 |           source: "model",
50 |         },
51 |       };
52 |     },
53 |   };
54 | }
55 |
56 | export async function enrichTransactionWithLLM(
57 |   c: Context<{ Bindings: Bindings }>,
58 |   data: EnrichBody["data"][number],
59 | ) {
60 |   const model = createWorkersAI({ binding: c.env.AI });
61 |
62 |   const wrappedLanguageModel = wrapLanguageModel({
63 |     // @ts-ignore (Not available in the SDK)
64 |     model: model("@cf/meta/llama-3.3-70b-instruct-fp8-fast"),
65 |     middleware: createCacheMiddleware(c, data.description),
66 |   });
67 |
68 |   const result = await generateObject({
69 |     mode: "json",
70 |     model: wrappedLanguageModel,
71 |     temperature: 0,
72 |     maxTokens: 2048,
73 |     prompt: `
74 |             ${prompt}
75 |
76 |             Transaction:
77 |             ${JSON.stringify(data)}
78 |         `,
79 |     schema: OutputSchema,
80 |   });
81 |
82 |   return result.object;
83 | }
```

apps/engine/src/utils/error.ts
```
1 | import { logger } from "./logger";
2 |
3 | export class ProviderError extends Error {
4 |   code: string;
5 |
6 |   constructor({ message, code }: { message: string; code: string }) {
7 |     super(message);
8 |     this.code = this.setCode(code);
9 |   }
10 |
11 |   setCode(code: string) {
12 |     // Teller
13 |     if (this.message === "The requested account is closed") {
14 |       return "disconnected";
15 |     }
16 |
17 |     // GoCardLess
18 |     if (this.message.startsWith("EUA was valid for")) {
19 |       return "disconnected";
20 |     }
21 |
22 |     switch (code) {
23 |       // Teller
24 |       case "enrollment.disconnected":
25 |       case "enrollment.disconnected.user_action.mfa_required":
26 |       case "enrollment.disconnected.account_locked":
27 |       case "enrollment.disconnected.credentials_invalid":
28 |       case "enrollment.disconnected.enrollment_inactive":
29 |       case "enrollment.disconnected.user_action.contact_information_required":
30 |       case "enrollment.disconnected.user_action.insufficient_permissions":
31 |       case "enrollment.disconnected.user_action.captcha_required":
32 |       case "enrollment.disconnected.user_action.web_login_required":
33 |
34 |       // Plaid
35 |       case "ITEM_LOGIN_REQUIRED":
36 |       case "ITEM_LOCKED":
37 |       case "ITEM_CONCURRENTLY_DELETED":
38 |       case "ACCESS_NOT_GRANTED":
39 |
40 |       // GoCardLess
41 |       case "AccessExpiredError":
42 |       case "AccountInactiveError":
43 |       case "Account suspended":
44 |         logger("disconnected", this.message);
45 |
46 |         return "disconnected";
47 |       default:
48 |         logger("unknown", this.message);
49 |
50 |         return "unknown";
51 |     }
52 |   }
53 | }
54 |
55 | export function createErrorResponse(error: unknown, requestId: string) {
56 |   console.error(error);
57 |
58 |   if (error instanceof ProviderError) {
59 |     return {
60 |       requestId,
61 |       message: error.message,
62 |       code: error.code,
63 |     };
64 |   }
65 |
66 |   return {
67 |     requestId,
68 |     message: String(error),
69 |     code: "unknown",
70 |   };
71 | }
```

apps/engine/src/utils/logger.ts
```
1 | export const logger = (message: string, ...rest: string[]) => {
2 |   console.log(message, ...rest);
3 | };
```

apps/engine/src/utils/logo.ts
```
1 | export function getLogoURL(id: string, ext?: string) {
2 |   return `https://cdn-engine.midday.ai/${id}.${ext || "jpg"}`;
3 | }
4 |
5 | export function getFileExtension(url: string) {
6 |   return url.split(".").pop();
7 | }
```

apps/engine/src/utils/paginate.ts
```
1 | export async function paginate<TData>({
2 |   fetchData,
3 |   pageSize,
4 |   delay,
5 | }: {
6 |   fetchData: (offset: number, count: number) => Promise<TData[]>;
7 |   pageSize: number;
8 |   delay?: { onDelay: (message: string) => void; milliseconds: number };
9 | }): Promise<TData[]> {
10 |   const result: TData[] = [];
11 |   let offset = 0;
12 |   let data: TData[] = [];
13 |
14 |   do {
15 |     data = await fetchData(offset, pageSize);
16 |
17 |     result.push(...data);
18 |
19 |     offset += pageSize;
20 |
21 |     if (delay && data.length >= pageSize) {
22 |       delay.onDelay(`Waiting ${delay.milliseconds / 1000} seconds`);
23 |       await new Promise((resolve) => setTimeout(resolve, delay.milliseconds));
24 |     }
25 |   } while (data.length >= pageSize);
26 |
27 |   return result;
28 | }
```

apps/engine/src/utils/prompt.ts
```
1 | export const prompt = `
2 | You are a financial transaction categorization specialist. Your task is to analyze transaction descriptions and assign them to the most appropriate category from the following list. Consider the context, merchant type, transaction patterns, and the transaction currency to understand the country context when making your decision.
3 | Categories:
4 | - travel: For transportation, accommodation, and travel-related expenses
5 | - office_supplies: For stationery, printing materials, and general office consumables
6 | - meals: For food, dining, and restaurant expenses
7 | - software: For digital tools, subscriptions, and software licenses
8 | - rent: For property rental and lease payments
9 | - equipment: For hardware, machinery, and durable business assets
10 | - internet_and_telephone: For connectivity and communication services
11 | - facilities_expenses: For utilities, maintenance, and building-related costs
12 | - activity: For events, entertainment, and business activities
13 | - taxes: For government levies and tax payments
14 | - fees: For service charges, professional fees, and administrative costs
15 |
16 | Analyze the following transaction and categorize it appropriately. Use the currency to help identify the country context - for example, SEK indicates Sweden, USD indicates United States, etc.
17 | Always return the JSON object, no other text or comments.
18 | `;
```

apps/engine/src/utils/rates.ts
```
1 | import { uniqueCurrencies } from "@midday/location/currencies";
2 |
3 | const ENDPOINT =
4 |   "https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1";
5 |
6 | async function getCurrency(currency: string) {
7 |   const response = await fetch(`${ENDPOINT}/currencies/${currency}.json`);
8 |
9 |   return response.json();
10 | }
11 |
12 | function transformKeysToUppercase(obj: Record<string, number>) {
13 |   const entries = Object.entries(obj);
14 |
15 |   // Transform each entry's key to uppercase
16 |   const upperCaseEntries = entries
17 |     .map(([key, value]) => {
18 |       return [key.toUpperCase(), value];
19 |     })
20 |     .filter(([key]) => uniqueCurrencies.includes(key as string));
21 |
22 |   // Convert the transformed entries back into an object
23 |   const transformedObject = Object.fromEntries(upperCaseEntries);
24 |
25 |   return transformedObject;
26 | }
27 |
28 | export async function getRates() {
29 |   const rates = await Promise.allSettled(
30 |     uniqueCurrencies.map((currency) => getCurrency(currency.toLowerCase())),
31 |   );
32 |
33 |   return rates
34 |     .filter(
35 |       (rate): rate is PromiseFulfilledResult<Record<string, unknown>> =>
36 |         rate.status === "fulfilled",
37 |     )
38 |     .map((rate) => rate.value)
39 |     .map((value) => {
40 |       const date = Object.values(value).at(0);
41 |       const currency = Object.keys(value).at(1);
42 |
43 |       if (!currency) {
44 |         return null;
45 |       }
46 |
47 |       const currencyData = value[currency];
48 |       if (typeof currencyData !== "object" || currencyData === null) {
49 |         return null;
50 |       }
51 |
52 |       return {
53 |         source: currency.toUpperCase(),
54 |         date,
55 |         rates: transformKeysToUppercase(currencyData as Record<string, number>),
56 |       };
57 |     })
58 |     .filter((item) => item !== null);
59 | }
```

apps/engine/src/utils/retry.ts
```
1 | export async function withRetry<TResult>(
2 |   fn: (attempt: number) => TResult | Promise<TResult>,
3 |   {
4 |     maxRetries = 1,
5 |     onError,
6 |     delay,
7 |   }: {
8 |     maxRetries?: number;
9 |     onError?(error: unknown, attempt: number): boolean | undefined;
10 |     delay?: number;
11 |   } = {},
12 | ) {
13 |   let retries = 0;
14 |   let lastError: unknown;
15 |
16 |   while (retries <= maxRetries) {
17 |     if (delay && retries > 0) {
18 |       await new Promise((resolve) => setTimeout(resolve, delay));
19 |     }
20 |
21 |     try {
22 |       const res = await fn(retries);
23 |       return res;
24 |     } catch (err) {
25 |       lastError = err;
26 |
27 |       if (onError) {
28 |         const shouldRetry = onError(err, retries);
29 |         if (!shouldRetry) {
30 |           break;
31 |         }
32 |       }
33 |
34 |       retries++;
35 |     }
36 |   }
37 |
38 |   throw lastError;
39 | }
```

apps/engine/src/utils/search.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import Typesense from "typesense";
3 |
4 | export function SearchClient(envs: Bindings) {
5 |   return new Typesense.Client({
6 |     nearestNode: {
7 |       host: envs.TYPESENSE_ENDPOINT!,
8 |       port: 443,
9 |       protocol: "https",
10 |     },
11 |     nodes: [
12 |       { host: envs.TYPESENSE_ENDPOINT_US!, port: 443, protocol: "https" },
13 |       { host: envs.TYPESENSE_ENDPOINT_EU!, port: 443, protocol: "https" },
14 |       { host: envs.TYPESENSE_ENDPOINT_AU!, port: 443, protocol: "https" },
15 |     ],
16 |     apiKey: envs.TYPESENSE_API_KEY,
17 |     connectionTimeoutSeconds: 2,
18 |   });
19 | }
20 |
21 | export async function getHealthCheck(envs: Bindings) {
22 |   const typesense = SearchClient(envs);
23 |   const searchResponse = await typesense.health.retrieve();
24 |
25 |   return {
26 |     healthy:
27 |       typeof searchResponse === "string" && JSON.parse(searchResponse).ok,
28 |   };
29 | }
```

apps/website/public/.well-known/security.txt
```
1 | Contact: security@midday.ai
2 | Preferred-Languages: en
3 | Canonical: https://midday.ai/.well-known/security.txt
4 | Policy: https://github.com/midday-ai/midday/blob/main/SECURITY.md
```

apps/website/src/actions/feature-request-action.ts
```
1 | "use server";
2 |
3 | import { PlainClient } from "@team-plain/typescript-sdk";
4 | import { actionClient } from "./safe-action";
5 | import { featureRequestSchema } from "./schema";
6 |
7 | const client = new PlainClient({
8 |   apiKey: process.env.PLAIN_API_KEY!,
9 | });
10 |
11 | export const featureRequestAction = actionClient
12 |   .schema(featureRequestSchema)
13 |   .action(async ({ parsedInput: data }) => {
14 |     const response = await client.createThread({
15 |       title: data.title,
16 |       customerIdentifier: {
17 |         emailAddress: data.email,
18 |       },
19 |       //   Feature request
20 |       labelTypeIds: ["lt_01HV93E5SDCFVH8T9AGKKC99EM"],
21 |       components: [
22 |         {
23 |           componentText: {
24 |             text: data.description,
25 |           },
26 |         },
27 |         {
28 |           componentText: {
29 |             text: data.category,
30 |           },
31 |         },
32 |       ],
33 |     });
34 |
35 |     return response;
36 |   });
```

apps/website/src/actions/fetch-status.ts
```
1 | "use server";
2 |
3 | import { getStatus } from "@openstatus/react";
4 |
5 | export async function fetchStatus() {
6 |   const res = await getStatus("midday");
7 |
8 |   const { status } = res;
9 |
10 |   return status;
11 | }
```

apps/website/src/actions/safe-action.ts
```
1 | import {
2 |   DEFAULT_SERVER_ERROR_MESSAGE,
3 |   createSafeActionClient,
4 | } from "next-safe-action";
5 |
6 | export const actionClient = createSafeActionClient({
7 |   handleReturnedServerError(e) {
8 |     if (e instanceof Error) {
9 |       return e.message;
10 |     }
11 |
12 |     return DEFAULT_SERVER_ERROR_MESSAGE;
13 |   },
14 | });
```

apps/website/src/actions/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const featureRequestSchema = z.object({
4 |   email: z.string().email(),
5 |   title: z.string().min(2, {
6 |     message: "Title must be at least 2 characters.",
7 |   }),
8 |   description: z.string().min(2, {
9 |     message: "Description must be at least 2 characters.",
10 |   }),
11 |   category: z.string(),
12 | });
13 |
14 | export const sendSupportSchema = z.object({
15 |   email: z.string().email(),
16 |   fullName: z.string(),
17 |   subject: z.string(),
18 |   priority: z.string(),
19 |   type: z.string(),
20 |   message: z.string(),
21 | });
```

apps/website/src/actions/send-support-action.ts
```
1 | "use server";
2 |
3 | import { PlainClient } from "@team-plain/typescript-sdk";
4 | import { actionClient } from "./safe-action";
5 | import { sendSupportSchema } from "./schema";
6 |
7 | const client = new PlainClient({
8 |   apiKey: process.env.PLAIN_API_KEY!,
9 | });
10 |
11 | const mapToPriorityNumber = (priority: string) => {
12 |   switch (priority) {
13 |     case "low":
14 |       return 0;
15 |     case "normal":
16 |       return 1;
17 |     case "high":
18 |       return 2;
19 |     case "urgent":
20 |       return 3;
21 |     default:
22 |       return 1;
23 |   }
24 | };
25 |
26 | export const sendSupportAction = actionClient
27 |   .schema(sendSupportSchema)
28 |   .action(async ({ parsedInput: data }) => {
29 |     const customer = await client.upsertCustomer({
30 |       identifier: {
31 |         emailAddress: data.email,
32 |       },
33 |       onCreate: {
34 |         fullName: data.fullName,
35 |         email: {
36 |           email: data.email,
37 |           isVerified: true,
38 |         },
39 |       },
40 |       onUpdate: {},
41 |     });
42 |
43 |     const response = await client.createThread({
44 |       title: data.subject,
45 |       description: data.message,
46 |       priority: mapToPriorityNumber(data.priority),
47 |       customerIdentifier: {
48 |         customerId: customer.data?.customer.id,
49 |       },
50 |       // Support
51 |       labelTypeIds: ["lt_01HV93FQT6NSC1EN2HHA6BG9WK"],
52 |       components: [
53 |         {
54 |           componentText: {
55 |             text: data.message,
56 |           },
57 |         },
58 |       ],
59 |     });
60 |
61 |     return response;
62 |   });
```

apps/website/src/actions/subscribe-action.ts
```
1 | "use server";
2 |
3 | import { resend } from "@/utils/resend";
4 |
5 | export async function subscribeAction(formData: FormData) {
6 |   const email = formData.get("email") as string;
7 |
8 |   return resend.contacts.create({
9 |     email,
10 |     audienceId: process.env.RESEND_AUDIENCE_ID!,
11 |   });
12 | }
```

apps/website/src/actions/vote-action.ts
```
1 | "use server";
2 |
3 | import { client } from "@midday/kv";
4 | import { revalidatePath } from "next/cache";
5 | import { headers } from "next/headers";
6 | import { z } from "zod";
7 | import { actionClient } from "./safe-action";
8 |
9 | export const voteAction = actionClient
10 |   .schema(
11 |     z.object({
12 |       id: z.string(),
13 |     }),
14 |   )
15 |   .action(async ({ parsedInput: { id } }) => {
16 |     const clientIP = (await headers()).get("x-forwarded-for");
17 |
18 |     const hasVoted = await client.sadd(`apps:${id}:ip:${clientIP}`, true);
19 |
20 |     if (!hasVoted) {
21 |       throw new Error("You have already voted");
22 |     }
23 |
24 |     await client.incr(`apps:${id}`);
25 |
26 |     revalidatePath("/feature-request");
27 |   });
```

apps/website/src/app/layout.tsx
```
1 | import { DevMessage } from "@/components/dev-message";
2 | import { Footer } from "@/components/footer";
3 | import { FooterCTA } from "@/components/footer-cta";
4 | import { Header } from "@/components/header";
5 | import "@/styles/globals.css";
6 | import { cn } from "@midday/ui/cn";
7 | import "@midday/ui/globals.css";
8 | import { ThemeProvider } from "@/components/theme-provider";
9 | import { Provider as Analytics } from "@midday/events/client";
10 | import { GeistMono } from "geist/font/mono";
11 | import { GeistSans } from "geist/font/sans";
12 | import type { Metadata } from "next";
13 | import type { ReactElement } from "react";
14 | import { baseUrl } from "./sitemap";
15 |
16 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
17 |
18 | export const metadata: Metadata = {
19 |   metadataBase: new URL(baseUrl),
20 |   title: {
21 |     default: "Midday | Run your business smarter",
22 |     template: "%s | Midday",
23 |   },
24 |   description:
25 |     "Midday provides you with greater insight into your business and automates the boring tasks, allowing you to focus on what you love to do instead.",
26 |   openGraph: {
27 |     title: "Midday | Run your business smarter",
28 |     description:
29 |       "Midday provides you with greater insight into your business and automates the boring tasks, allowing you to focus on what you love to do instead.",
30 |     url: baseUrl,
31 |     siteName:
32 |       "Midday provides you with greater insight into your business and automates the boring tasks, allowing you to focus on what you love to do instead.",
33 |     locale: "en_US",
34 |     type: "website",
35 |     images: [
36 |       {
37 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
38 |         width: 800,
39 |         height: 600,
40 |       },
41 |       {
42 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
43 |         width: 1800,
44 |         height: 1600,
45 |       },
46 |     ],
47 |   },
48 |   twitter: {
49 |     title: "Midday | Run your business smarter",
50 |     description:
51 |       "Midday provides you with greater insight into your business and automates the boring tasks, allowing you to focus on what you love to do instead.",
52 |     images: [
53 |       {
54 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
55 |         width: 800,
56 |         height: 600,
57 |       },
58 |       {
59 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
60 |         width: 1800,
61 |         height: 1600,
62 |       },
63 |     ],
64 |   },
65 |   robots: {
66 |     index: true,
67 |     follow: true,
68 |     googleBot: {
69 |       index: true,
70 |       follow: true,
71 |       "max-video-preview": -1,
72 |       "max-image-preview": "large",
73 |       "max-snippet": -1,
74 |     },
75 |   },
76 | };
77 |
78 | export const viewport = {
79 |   themeColor: [
80 |     { media: "(prefers-color-scheme: light)" },
81 |     { media: "(prefers-color-scheme: dark)" },
82 |   ],
83 | };
84 |
85 | export default function Layout({ children }: { children: ReactElement }) {
86 |   return (
87 |     <html lang="en" suppressHydrationWarning>
88 |       <body
89 |         className={cn(
90 |           `${GeistSans.variable} ${GeistMono.variable}`,
91 |           "bg-[#fbfbfb] dark:bg-[#0C0C0C] overflow-x-hidden antialiased",
92 |         )}
93 |       >
94 |         <ThemeProvider
95 |           attribute="class"
96 |           defaultTheme="system"
97 |           enableSystem
98 |           disableTransitionOnChange
99 |         >
100 |           <Header />
101 |           <main className="container mx-auto px-4 overflow-hidden md:overflow-visible">
102 |             {children}
103 |           </main>
104 |           <FooterCTA />
105 |           <Footer />
106 |           <Analytics />
107 |           <DevMessage />
108 |         </ThemeProvider>
109 |       </body>
110 |     </html>
111 |   );
112 | }
```

apps/website/src/app/not-found.tsx
```
1 | import { NotFoundTerminal } from "@/components/not-found-terminal";
2 |
3 | export default function NotFound() {
4 |   return (
5 |     <div className="fixed bg-[#0C0C0C] top-0 right-0 bottom-0 left-0 z-30">
6 |       <h1 className="font-mono md:text-[300px] text-[140px] font-medium text-center mt-20">
7 |         404
8 |       </h1>
9 |
10 |       <NotFoundTerminal />
11 |     </div>
12 |   );
13 | }
```

apps/website/src/app/page.tsx
```
1 | import { StartPage } from "@/components/startpage";
2 |
3 | export const revalidate = 1800;
4 |
5 | export default function Page() {
6 |   return <StartPage />;
7 | }
```

apps/website/src/app/robots.ts
```
1 | import { baseUrl } from "./sitemap";
2 |
3 | export default function robots() {
4 |   return {
5 |     rules: [
6 |       {
7 |         userAgent: "*",
8 |       },
9 |     ],
10 |     sitemap: `${baseUrl}/sitemap.xml`,
11 |     host: `${baseUrl}`,
12 |   };
13 | }
```

apps/website/src/app/sitemap.ts
```
1 | import { getBlogPosts } from "@/lib/blog";
2 | import type { MetadataRoute } from "next";
3 |
4 | export const baseUrl = "https://midday.ai";
5 |
6 | export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
7 |   const blogs = getBlogPosts().map((post) => ({
8 |     url: `${baseUrl}/blog/${post.slug}`,
9 |     lastModified: post.metadata.publishedAt,
10 |   }));
11 |
12 |   const routes = ["", "/updates"].map((route) => ({
13 |     url: `${baseUrl}${route}`,
14 |     lastModified: new Date().toISOString().split("T")[0],
15 |   }));
16 |
17 |   return [...routes, ...blogs];
18 | }
```

apps/website/src/components/3d-card.tsx
```
1 | // Thank you: https://ui.aceternity.com/components/3d-card-effect
2 |
3 | "use client";
4 |
5 | import { cn } from "@midday/ui/cn";
6 |
7 | import React, {
8 |   createContext,
9 |   useState,
10 |   useContext,
11 |   useRef,
12 |   useEffect,
13 | } from "react";
14 |
15 | const MouseEnterContext = createContext<
16 |   [boolean, React.Dispatch<React.SetStateAction<boolean>>] | undefined
17 | >(undefined);
18 |
19 | export const CardContainer = ({
20 |   children,
21 |   className,
22 |   containerClassName,
23 | }: {
24 |   children?: React.ReactNode;
25 |   className?: string;
26 |   containerClassName?: string;
27 | }) => {
28 |   const containerRef = useRef<HTMLDivElement>(null);
29 |   const [isMouseEntered, setIsMouseEntered] = useState(false);
30 |
31 |   const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {
32 |     if (!containerRef.current) return;
33 |     const { left, top, width, height } =
34 |       containerRef.current.getBoundingClientRect();
35 |     const x = (e.clientX - left - width / 2) / 25;
36 |     const y = (e.clientY - top - height / 2) / 25;
37 |     containerRef.current.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
38 |   };
39 |
40 |   const handleMouseEnter = (e: React.MouseEvent<HTMLDivElement>) => {
41 |     setIsMouseEntered(true);
42 |     if (!containerRef.current) return;
43 |   };
44 |
45 |   const handleMouseLeave = (e: React.MouseEvent<HTMLDivElement>) => {
46 |     if (!containerRef.current) return;
47 |     setIsMouseEntered(false);
48 |     containerRef.current.style.transform = `rotateY(0deg) rotateX(0deg)`;
49 |   };
50 |   return (
51 |     <MouseEnterContext.Provider value={[isMouseEntered, setIsMouseEntered]}>
52 |       <div
53 |         className={cn(
54 |           "py-20 flex items-center justify-center",
55 |           containerClassName
56 |         )}
57 |         style={{
58 |           perspective: "1000px",
59 |         }}
60 |       >
61 |         <div
62 |           ref={containerRef}
63 |           onMouseEnter={handleMouseEnter}
64 |           onMouseMove={handleMouseMove}
65 |           onMouseLeave={handleMouseLeave}
66 |           className={cn(
67 |             "flex items-center justify-center relative transition-all duration-200 ease-linear",
68 |             className
69 |           )}
70 |           style={{
71 |             transformStyle: "preserve-3d",
72 |           }}
73 |         >
74 |           {children}
75 |         </div>
76 |       </div>
77 |     </MouseEnterContext.Provider>
78 |   );
79 | };
80 |
81 | export const CardBody = ({
82 |   children,
83 |   className,
84 | }: {
85 |   children: React.ReactNode;
86 |   className?: string;
87 | }) => {
88 |   return (
89 |     <div
90 |       className={cn(
91 |         "h-96 w-96 [transform-style:preserve-3d]  [&>*]:[transform-style:preserve-3d]",
92 |         className
93 |       )}
94 |     >
95 |       {children}
96 |     </div>
97 |   );
98 | };
99 |
100 | export const CardItem = ({
101 |   as: Tag = "div",
102 |   children,
103 |   className,
104 |   translateX = 0,
105 |   translateY = 0,
106 |   translateZ = 0,
107 |   rotateX = 0,
108 |   rotateY = 0,
109 |   rotateZ = 0,
110 |   ...rest
111 | }: {
112 |   as?: React.ElementType;
113 |   children: React.ReactNode;
114 |   className?: string;
115 |   translateX?: number | string;
116 |   translateY?: number | string;
117 |   translateZ?: number | string;
118 |   rotateX?: number | string;
119 |   rotateY?: number | string;
120 |   rotateZ?: number | string;
121 |   [key: string]: any;
122 | }) => {
123 |   const ref = useRef<HTMLDivElement>(null);
124 |   const [isMouseEntered] = useMouseEnter();
125 |
126 |   useEffect(() => {
127 |     handleAnimations();
128 |   }, [isMouseEntered]);
129 |
130 |   const handleAnimations = () => {
131 |     if (!ref.current) return;
132 |     if (isMouseEntered) {
133 |       ref.current.style.transform = `translateX(${translateX}px) translateY(${translateY}px) translateZ(${translateZ}px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;
134 |     } else {
135 |       ref.current.style.transform = `translateX(0px) translateY(0px) translateZ(0px) rotateX(0deg) rotateY(0deg) rotateZ(0deg)`;
136 |     }
137 |   };
138 |
139 |   return (
140 |     <Tag
141 |       ref={ref}
142 |       className={cn("w-fit transition duration-200 ease-linear", className)}
143 |       {...rest}
144 |     >
145 |       {children}
146 |     </Tag>
147 |   );
148 | };
149 |
150 | // Create a hook to use the context
151 | export const useMouseEnter = () => {
152 |   const context = useContext(MouseEnterContext);
153 |   if (context === undefined) {
154 |     throw new Error("useMouseEnter must be used within a MouseEnterProvider");
155 |   }
156 |   return context;
157 | };
```

apps/website/src/components/app-details.tsx
```
1 | import { Vote } from "@/components/vote";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { Suspense } from "react";
4 |
5 | export function AppDetails({ id, name, description, logo, active }) {
6 |   return (
7 |     <section
8 |       key={id}
9 |       className="flex md:space-x-12 md:flex-row md:items-center mt-10 pt-10 first:pt-0 flex-col"
10 |     >
11 |       <div className="md:w-[300px] w-full md:h-[200px] h-[230px] flex items-center justify-center bg-gradient-to-b dark:from-[#1A1A1A] dark:to-[#171717] from-[#F5F5F5] to-[#EFEFEF]">
12 |         {logo}
13 |       </div>
14 |       <div className="md:flex-1 my-6 md:my-0">
15 |         <div className="flex md:items-center mb-4 space-x-2">
16 |           <h2 className="font-medium">{name}</h2>
17 |           {active && (
18 |             <button
19 |               disabled
20 |               type="button"
21 |               className="relative rounded-lg overflow-hidden p-[1px]"
22 |               style={{
23 |                 background:
24 |                   "linear-gradient(-45deg, rgba(235,248,255,.18) 0%, #848f9c 50%, rgba(235,248,255,.18) 100%)",
25 |               }}
26 |             >
27 |               <span className="flex items-center gap-4 py-1 px-2 rounded-[7px] bg-background text-xs h-full font-normal">
28 |                 Under development
29 |               </span>
30 |             </button>
31 |           )}
32 |         </div>
33 |         <p className="text-sm text-[#606060]">{description}</p>
34 |       </div>
35 |
36 |       <Suspense fallback={<Skeleton className="p-6 flex-col w-14 h-16 " />}>
37 |         <Vote id={id} />
38 |       </Suspense>
39 |     </section>
40 |   );
41 | }
```

apps/website/src/components/article-in-view.tsx
```
1 | "use client";
2 |
3 | import { usePathname } from "next/navigation";
4 | import { useEffect } from "react";
5 | import { useInView } from "react-intersection-observer";
6 |
7 | type Props = {
8 |   firstPost: boolean;
9 |   slug: string;
10 | };
11 |
12 | export function ArticleInView({ slug, firstPost }: Props) {
13 |   const { ref, inView } = useInView();
14 |
15 |   const pathname = usePathname();
16 |   const fullSlug = `/updates/${slug}`;
17 |
18 |   useEffect(() => {
19 |     if (inView && pathname !== fullSlug) {
20 |       window.history.pushState({ urlPath: fullSlug }, "", fullSlug);
21 |     }
22 |   }, [inView, fullSlug, firstPost]);
23 |
24 |   return <div ref={ref} />;
25 | }
```

apps/website/src/components/article.tsx
```
1 | import { ArticleInView } from "@/components/article-in-view";
2 | import { CustomMDX } from "@/components/mdx";
3 | import { PostStatus } from "@/components/post-status";
4 | import Image from "next/image";
5 | import Link from "next/link";
6 |
7 | type Props = {
8 |   firstPost: boolean;
9 |   data: {
10 |     slug: string;
11 |     metadata: {
12 |       tag: string;
13 |       title: string;
14 |       image?: string;
15 |     };
16 |     content: string;
17 |   };
18 | };
19 |
20 | export function Article({ data, firstPost }: Props) {
21 |   return (
22 |     <article key={data.slug} className="pt-28 mb-20 -mt-28" id={data.slug}>
23 |       <ArticleInView slug={data.slug} firstPost={firstPost} />
24 |
25 |       <PostStatus status={data.metadata.tag} />
26 |       <Link className="mb-6 block" href={`/updates/${data.slug}`}>
27 |         <h2 className="font-medium text-2xl mb-6">{data.metadata.title}</h2>
28 |       </Link>
29 |
30 |       <div className="updates">
31 |         {data.metadata.image && (
32 |           <Image
33 |             src={data.metadata.image}
34 |             alt={data.metadata.title}
35 |             width={680}
36 |             height={442}
37 |             className="mb-12"
38 |           />
39 |         )}
40 |
41 |         <CustomMDX source={data.content} />
42 |       </div>
43 |     </article>
44 |   );
45 | }
```

apps/website/src/components/brand-canvas.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import {
5 |   Select,
6 |   SelectContent,
7 |   SelectGroup,
8 |   SelectItem,
9 |   SelectTrigger,
10 |   SelectValue,
11 | } from "@midday/ui/select";
12 | import Image from "next/image";
13 | import { useRef, useState } from "react";
14 | import { useDraggable } from "react-use-draggable-scroll";
15 |
16 | const assets = [
17 |   <Image
18 |     key="1"
19 |     src={require("public/branding/1.png")}
20 |     width={600}
21 |     alt="keyboard"
22 |   />,
23 |   <Image
24 |     key="2"
25 |     src={require("public/branding/2.png")}
26 |     width={600}
27 |     alt="founders"
28 |   />,
29 |   <Image
30 |     key="3"
31 |     src={require("public/branding/3.png")}
32 |     width={600}
33 |     alt="screens"
34 |   />,
35 |   <Image
36 |     key="1"
37 |     src={require("public/branding/11.png")}
38 |     width={600}
39 |     alt="screens"
40 |   />,
41 |   <Image
42 |     key="4"
43 |     src={require("public/branding/4.png")}
44 |     width={600}
45 |     alt="screens"
46 |   />,
47 |   <Image
48 |     key="5"
49 |     src={require("public/branding/5.png")}
50 |     width={600}
51 |     alt="screens"
52 |   />,
53 |   <Image
54 |     key="7"
55 |     src={require("public/branding/7.png")}
56 |     width={600}
57 |     alt="screens"
58 |   />,
59 |   <Image
60 |     key="8"
61 |     src={require("public/branding/8.png")}
62 |     width={600}
63 |     alt="screens"
64 |   />,
65 |   <Image
66 |     key="9"
67 |     src={require("public/branding/9.png")}
68 |     width={600}
69 |     alt="screens"
70 |   />,
71 |   <Image
72 |     key="10"
73 |     src={require("public/branding/10.png")}
74 |     width={600}
75 |     alt="screens"
76 |   />,
77 |   <Image
78 |     key="1"
79 |     src={require("public/branding/1.png")}
80 |     width={600}
81 |     alt="keyboard"
82 |   />,
83 |   <Image
84 |     key="2"
85 |     src={require("public/branding/2.png")}
86 |     width={600}
87 |     alt="founders"
88 |   />,
89 |   <Image
90 |     key="3"
91 |     src={require("public/branding/3.png")}
92 |     width={600}
93 |     alt="screens"
94 |   />,
95 | ];
96 |
97 | const repeated = [...assets, ...assets, ...assets, ...assets, ...assets];
98 |
99 | export function BrandCanvas() {
100 |   const [value, setValue] = useState("https://cdn.midday.ai/all.zip");
101 |   const ref = useRef(undefined);
102 |   const { events } = useDraggable(ref);
103 |
104 |   return (
105 |     <div className="sm:h-screen sm:w-screen overflow-hidden">
106 |       <div
107 |         className="fixed bg-background z-10 top-0 left-0 right-0 overflow-scroll scrollbar-hide cursor-grabbing"
108 |         {...events}
109 |         ref={ref}
110 |       >
111 |         <div className="w-[4900px] flex h-screen">
112 |           <div className="grid grid-cols-8 gap-4 items-center">
113 |             {repeated.map((asset, index) => (
114 |               <div className="h-auto max-w-full" key={index.toString()}>
115 |                 {asset}
116 |               </div>
117 |             ))}
118 |           </div>
119 |         </div>
120 |       </div>
121 |
122 |       <div className="fixed bottom-10 z-20 w-full flex justify-center items-center -ml-[80px]">
123 |         <div className="h-[48px] w-[200px] rounded-full border border-border backdrop-filter backdrop-blur-xl dark:bg-[#121212] bg-white bg-opacity-70 text-center flex items-center p-1 pl-2 justify-between space-x-4">
124 |           <Select onValueChange={setValue} value={value}>
125 |             <SelectTrigger className="w-[180px] border-0 space-x-2">
126 |               <SelectValue placeholder="All" className="border-0" />
127 |             </SelectTrigger>
128 |             <SelectContent>
129 |               <SelectGroup>
130 |                 <SelectItem value="https://cdn.midday.ai/all.zip">
131 |                   All
132 |                 </SelectItem>
133 |                 <SelectItem value="https://cdn.midday.ai/videos.zip">
134 |                   Videos
135 |                 </SelectItem>
136 |                 <SelectItem value="https://cdn.midday.ai/founders.zip">
137 |                   Founders
138 |                 </SelectItem>
139 |                 <SelectItem value="https://cdn.midday.ai/screens.zip">
140 |                   Screens
141 |                 </SelectItem>
142 |               </SelectGroup>
143 |             </SelectContent>
144 |           </Select>
145 |
146 |           <Button className="rounded-full">
147 |             <a href={value} download title="Download">
148 |               Download
149 |             </a>
150 |           </Button>
151 |         </div>
152 |       </div>
153 |     </div>
154 |   );
155 | }
```

apps/website/src/components/card-stack.tsx
```
1 | "use client";
2 |
3 | import { useMediaQuery } from "@midday/ui/hooks";
4 | import {
5 |   Tooltip,
6 |   TooltipContent,
7 |   TooltipProvider,
8 |   TooltipTrigger,
9 | } from "@midday/ui/tooltip";
10 | import { motion } from "framer-motion";
11 | import { useEffect, useState } from "react";
12 |
13 | let interval: any;
14 |
15 | type Card = {
16 |   id: number;
17 |   content: React.ReactNode;
18 |   name: string;
19 | };
20 |
21 | export const CardStack = ({
22 |   items,
23 |   offset,
24 |   scaleFactor,
25 | }: {
26 |   items: Card[];
27 |   offset?: number;
28 |   scaleFactor?: number;
29 | }) => {
30 |   const isDesktop = useMediaQuery("(min-width: 768px)");
31 |   const CARD_OFFSET = isDesktop ? 10 : 5;
32 |   const SCALE_FACTOR = scaleFactor || 0.06;
33 |   const [cards, setCards] = useState<Card[]>([items.at(0)]);
34 |
35 |   useEffect(() => {
36 |     startFlipping();
37 |     setCards(items);
38 |
39 |     return () => clearInterval(interval);
40 |   }, []);
41 |
42 |   const startFlipping = () => {
43 |     interval = setInterval(() => {
44 |       setCards((prevCards: Card[]) => {
45 |         const newArray = [...prevCards]; // create a copy of the array
46 |         newArray.unshift(newArray.pop()!); // move the last element to the front
47 |         return newArray;
48 |       });
49 |     }, 5000);
50 |   };
51 |
52 |   const onChangeCardByIndex = (index) => {
53 |     const item = cards.at(index);
54 |     setCards([item, ...cards.slice(0, index), ...cards.slice(index + 1)]);
55 |   };
56 |
57 |   const onChangeCard = (item) => {
58 |     const index = cards.findIndex((card) => card.id === item.id);
59 |     setCards([item, ...cards.slice(0, index), ...cards.slice(index + 1)]);
60 |   };
61 |
62 |   // TODO: Get screen width
63 |   return (
64 |     <div
65 |       className="relative h-[220px] md:h-[670px] w-[331px] md:w-[1031px] z-10"
66 |       onMouseEnter={() => clearInterval(interval)}
67 |     >
68 |       {cards.map((card, index) => {
69 |         return (
70 |           <motion.div
71 |             key={card.id}
72 |             className="absolute h-[220px] md:h-[670px] w-[331px] md:w-[1031px] flex flex-col justify-between"
73 |             style={{
74 |               transformOrigin: "top center",
75 |               display: index > 2 ? "none" : "block",
76 |             }}
77 |             whileHover={{
78 |               top: index > 0 && index > 0 && index * -CARD_OFFSET - 30,
79 |               transition: { duration: 0.3 },
80 |             }}
81 |             animate={{
82 |               top: index * -CARD_OFFSET,
83 |               scale: 1 - index * SCALE_FACTOR, // decrease scale for cards that are behind
84 |               zIndex: cards.length - index, //  decrease z-index for the cards that are behind
85 |             }}
86 |             onMouseEnter={() => clearInterval(interval)}
87 |           >
88 |             <TooltipProvider delayDuration={0}>
89 |               <Tooltip>
90 |                 <TooltipTrigger asChild>
91 |                   <button
92 |                     type="button"
93 |                     className="w-[35px] h-[20px] z-20 absolute top-[75px] left-[8px]"
94 |                     onClick={() => onChangeCard(cards.find((c) => c.id === 1))}
95 |                   >
96 |                     <span className="sr-only">Overview</span>
97 |                   </button>
98 |                 </TooltipTrigger>
99 |                 <TooltipContent
100 |                   side="right"
101 |                   className="py-1 px-3 rounded-sm"
102 |                   sideOffset={8}
103 |                 >
104 |                   <p className="text-xs">Overview</p>
105 |                 </TooltipContent>
106 |               </Tooltip>
107 |
108 |               <Tooltip>
109 |                 <TooltipTrigger asChild>
110 |                   <button
111 |                     type="button"
112 |                     className="w-[35px] h-[20px] z-20 absolute top-[105px] left-[8px]"
113 |                     onClick={() => onChangeCard(cards.find((c) => c.id === 5))}
114 |                   >
115 |                     <span className="sr-only">Transactions</span>
116 |                   </button>
117 |                 </TooltipTrigger>
118 |                 <TooltipContent
119 |                   side="right"
120 |                   className="py-1 px-3 rounded-sm"
121 |                   sideOffset={8}
122 |                 >
123 |                   <p className="text-xs">Transactions</p>
124 |                 </TooltipContent>
125 |               </Tooltip>
126 |
127 |               <Tooltip>
128 |                 <TooltipTrigger asChild>
129 |                   <button
130 |                     type="button"
131 |                     className="w-[35px] h-[20px] z-20 absolute top-[135px] left-[8px]"
132 |                     onClick={() => onChangeCard(cards.find((c) => c.id === 3))}
133 |                   >
134 |                     <span className="sr-only">Inbox</span>
135 |                   </button>
136 |                 </TooltipTrigger>
137 |                 <TooltipContent
138 |                   side="right"
139 |                   className="py-1 px-3 rounded-sm"
140 |                   sideOffset={8}
141 |                 >
142 |                   <p className="text-xs">Inbox</p>
143 |                 </TooltipContent>
144 |               </Tooltip>
145 |
146 |               <Tooltip>
147 |                 <TooltipTrigger asChild>
148 |                   <button
149 |                     type="button"
150 |                     className="w-[35px] h-[20px] z-20 absolute top-[170px] left-[8px]"
151 |                     onClick={() => onChangeCard(cards.find((c) => c.id === 2))}
152 |                   >
[TRUNCATED]
```

apps/website/src/components/copy-input.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 | import { motion } from "framer-motion";
6 | import { useState } from "react";
7 |
8 | type Props = {
9 |   value: string;
10 |   className?: string;
11 | };
12 |
13 | export function CopyInput({ value, className }: Props) {
14 |   const [isCopied, setCopied] = useState(false);
15 |
16 |   const handleClipboard = async () => {
17 |     try {
18 |       setCopied(true);
19 |
20 |       await navigator.clipboard.writeText(value);
21 |
22 |       setTimeout(() => {
23 |         setCopied(false);
24 |       }, 2000);
25 |     } catch {}
26 |   };
27 |
28 |   return (
29 |     <div
30 |       className={cn(
31 |         "flex items-center relative w-full border border-border py-2 px-4",
32 |         className,
33 |       )}
34 |     >
35 |       <div className="pr-7 text-[#878787] text-sm">{value}</div>
36 |       <button type="button" onClick={handleClipboard} className="block">
37 |         <motion.div
38 |           className="absolute right-4 top-2.5"
39 |           initial={{ opacity: 1, scale: 1 }}
40 |           animate={{ opacity: isCopied ? 0 : 1, scale: isCopied ? 0 : 1 }}
41 |         >
42 |           <Icons.Copy />
43 |         </motion.div>
44 |
45 |         <motion.div
46 |           className="absolute right-4 top-2.5"
47 |           initial={{ opacity: 0, scale: 0 }}
48 |           animate={{ opacity: isCopied ? 1 : 0, scale: isCopied ? 1 : 0 }}
49 |         >
50 |           <Icons.Check />
51 |         </motion.div>
52 |       </button>
53 |     </div>
54 |   );
55 | }
```

apps/website/src/components/cta-button.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Icons } from "@midday/ui/icons";
3 | import Link from "next/link";
4 |
5 | export function CtaButton({ children }: { children: React.ReactNode }) {
6 |   return (
7 |     <Link href="https://app.midday.ai">
8 |       <Button
9 |         className="mt-12 h-11 space-x-2 items-center py-2"
10 |         variant="outline"
11 |       >
12 |         <span>{children}</span>
13 |         <Icons.ArrowOutward />
14 |       </Button>
15 |     </Link>
16 |   );
17 | }
```

apps/website/src/components/cta-link.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 | import Link from "next/link";
6 |
7 | export function CtaLink({
8 |   text,
9 |   className,
10 | }: {
11 |   text: string;
12 |   className?: string;
13 | }) {
14 |   return (
15 |     <Link
16 |       href="https://app.midday.ai"
17 |       className={cn(
18 |         "font-medium text-sm flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 hidden xl:flex",
19 |         className,
20 |       )}
21 |     >
22 |       <span>{text}</span>
23 |       <Icons.ArrowOutward />
24 |     </Link>
25 |   );
26 | }
```

apps/website/src/components/dev-message.tsx
```
1 | "use client";
2 |
3 | import { useEffect, useRef } from "react";
4 |
5 | export function DevMessage() {
6 |   const ref = useRef(undefined);
7 |
8 |   useEffect(() => {
9 |     if (!ref.current) {
10 |       console.log(`
11 |       -------------------------------------------------
12 |         ███╗   ███╗██╗██████╗ ██████╗  █████╗ ██╗   ██╗
13 |       ████╗ ████║██║██╔══██╗██╔══██╗██╔══██╗╚██╗ ██╔╝
14 |       ██╔████╔██║██║██║  ██║██║  ██║███████║ ╚████╔╝
15 |       ██║╚██╔╝██║██║██║  ██║██║  ██║██╔══██║  ╚██╔╝
16 |       ██║ ╚═╝ ██║██║██████╔╝██████╔╝██║  ██║   ██║
17 |       ╚═╝     ╚═╝╚═╝╚═════╝ ╚═════╝ ╚═╝  ╚═╝   ╚═╝
18 |       -------------------------------------------------
19 |     We are open source: https://git.new/midday
20 |     Join the community: https://go.midday.ai/anPiuRx
21 |
22 |     `);
23 |       ref.current = true;
24 |     }
25 |   }, []);
26 |
27 |   return null;
28 | }
```

apps/website/src/components/dynamic-image.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import type { ImageProps } from "next/image";
5 | import Image from "next/image";
6 |
7 | interface DynamicImageProps extends Omit<ImageProps, "src" | "className"> {
8 |   lightSrc: ImageProps["src"];
9 |   darkSrc: ImageProps["src"];
10 |   className?: string;
11 | }
12 |
13 | export function DynamicImage({
14 |   lightSrc,
15 |   darkSrc,
16 |   alt,
17 |   className,
18 |   ...props
19 | }: DynamicImageProps) {
20 |   return (
21 |     <>
22 |       <Image
23 |         src={lightSrc}
24 |         alt={alt}
25 |         className={cn("dark:hidden", className)}
26 |         {...props}
27 |       />
28 |       <Image
29 |         src={darkSrc}
30 |         alt={alt}
31 |         className={cn("hidden dark:block", className)}
32 |         {...props}
33 |       />
34 |     </>
35 |   );
36 | }
```

apps/website/src/components/error-fallback.tsx
```
1 | "use client";
2 |
3 | export function ErrorFallback() {
4 |   return null;
5 | }
```

apps/website/src/components/export-toast.tsx
```
1 | "use client";
2 |
3 | import { Progress } from "@midday/ui/progress";
4 | import { Loader2 } from "lucide-react";
5 | import { useEffect, useState } from "react";
6 | import { useInView } from "react-intersection-observer";
7 |
8 | export function ExportToast() {
9 |   const [progress, setProgress] = useState(0);
10 |   const { ref, inView } = useInView({
11 |     triggerOnce: true,
12 |   });
13 |
14 |   useEffect(() => {
15 |     if (!inView) return;
16 |
17 |     const timer = setInterval(() => {
18 |       setProgress((oldProgress) => {
19 |         if (oldProgress === 100) {
20 |           clearInterval(timer);
21 |           return 100;
22 |         }
23 |         return Math.min(oldProgress + 25, 100);
24 |       });
25 |     }, 300);
26 |
27 |     return () => {
28 |       clearInterval(timer);
29 |     };
30 |   }, [inView]);
31 |
32 |   return (
33 |     <div
34 |       ref={ref}
35 |       className="w-full darK:bg-[#121212] flex flex-col border border-border p-4 space-y-3"
36 |     >
37 |       <div className="flex items-center space-x-2">
38 |         <Loader2 className="animate-spin size-5" />
39 |         <span className="text-sm font-medium">Exporting transactions</span>
40 |       </div>
41 |
42 |       <Progress value={progress} className="w-full h-0.5" />
43 |
44 |       <span className="text-xs text-[#878787]">
45 |         Please do not close browser until completed
46 |       </span>
47 |     </div>
48 |   );
49 | }
```

apps/website/src/components/feature-request-modal.tsx
```
1 | "use client";
2 |
3 | import { featureRequestAction } from "@/actions/feature-request-action";
4 | import { featureRequestSchema } from "@/actions/schema";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   DialogContent,
9 |   DialogFooter,
10 |   DialogHeader,
11 |   DialogTitle,
12 |   DialogTrigger,
13 | } from "@midday/ui/dialog";
14 | import {
15 |   Form,
16 |   FormControl,
17 |   FormField,
18 |   FormItem,
19 |   FormLabel,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import {
24 |   Select,
25 |   SelectContent,
26 |   SelectItem,
27 |   SelectTrigger,
28 |   SelectValue,
29 | } from "@midday/ui/select";
30 | import { Textarea } from "@midday/ui/textarea";
31 | import { Loader2 } from "lucide-react";
32 | import { useAction } from "next-safe-action/hooks";
33 | import { useState } from "react";
34 | import { useForm } from "react-hook-form";
35 | import type { z } from "zod";
36 |
37 | const categories = ["Feature", "Integration", "API"];
38 |
39 | export function FeatureRequestModal() {
40 |   const [isSubmitted, setSubmitted] = useState(false);
41 |
42 |   const featureRequest = useAction(featureRequestAction, {
43 |     onSuccess: () => {
44 |       setSubmitted(true);
45 |     },
46 |   });
47 |
48 |   const form = useForm<z.infer<typeof featureRequestSchema>>({
49 |     resolver: zodResolver(featureRequestSchema),
50 |     defaultValues: {
51 |       email: "",
52 |       title: "",
53 |       description: "",
54 |       category: "",
55 |     },
56 |   });
57 |
58 |   return (
59 |     <DialogContent className="sm:max-w-[500px]">
60 |       <div className="p-4">
61 |         {isSubmitted ? (
62 |           <div className="text-center p-8 pb-12">
63 |             <h2 className="font-semibold text-lg mb-4">Thank you</h2>
64 |
65 |             <p className="text-sm">
66 |               We'll inform you when your feature request is <br />
67 |               ready for voting.
68 |             </p>
69 |           </div>
70 |         ) : (
71 |           <Form {...form}>
72 |             <DialogHeader>
73 |               <DialogTitle>Request</DialogTitle>
74 |             </DialogHeader>
75 |
76 |             <form
77 |               onSubmit={form.handleSubmit(featureRequest.execute)}
78 |               className="space-y-4 mt-4"
79 |             >
80 |               <FormField
81 |                 control={form.control}
82 |                 name="email"
83 |                 render={({ field }) => (
84 |                   <FormItem className="w-full">
85 |                     <FormLabel>Email</FormLabel>
86 |                     <FormControl>
87 |                       <Input placeholder="Email" {...field} type="email" />
88 |                     </FormControl>
89 |
90 |                     <FormMessage />
91 |                   </FormItem>
92 |                 )}
93 |               />
94 |
95 |               <div className="flex space-x-4">
96 |                 <FormField
97 |                   control={form.control}
98 |                   name="title"
99 |                   render={({ field }) => (
100 |                     <FormItem className="w-full">
101 |                       <FormLabel>Title</FormLabel>
102 |                       <FormControl>
103 |                         <Input placeholder="Title" {...field} />
104 |                       </FormControl>
105 |
106 |                       <FormMessage />
107 |                     </FormItem>
108 |                   )}
109 |                 />
110 |
111 |                 <FormField
112 |                   control={form.control}
113 |                   name="category"
114 |                   render={({ field }) => (
115 |                     <FormItem className="w-full">
116 |                       <FormLabel>Category</FormLabel>
117 |                       <Select
118 |                         onValueChange={field.onChange}
119 |                         defaultValue={field.value}
120 |                       >
121 |                         <FormControl>
122 |                           <SelectTrigger>
123 |                             <SelectValue placeholder="Category" />
124 |                           </SelectTrigger>
125 |                         </FormControl>
126 |                         <SelectContent>
127 |                           {categories.map((category) => {
128 |                             return (
129 |                               <SelectItem value={category} key={category}>
130 |                                 {category}
131 |                               </SelectItem>
132 |                             );
133 |                           })}
134 |                         </SelectContent>
135 |                       </Select>
136 |
137 |                       <FormMessage />
138 |                     </FormItem>
139 |                   )}
140 |                 />
141 |               </div>
142 |
143 |               <FormField
144 |                 control={form.control}
145 |                 name="description"
146 |                 render={({ field }) => (
147 |                   <FormItem>
148 |                     <FormLabel>Description</FormLabel>
149 |                     <FormControl>
150 |                       <Textarea
151 |                         placeholder="Description"
152 |                         className="resize-none"
153 |                         {...field}
154 |                       />
155 |                     </FormControl>
156 |
157 |                     <FormMessage />
158 |                   </FormItem>
159 |                 )}
160 |               />
161 |
162 |               <DialogFooter className="md:flex md:space-x-4 pt-4">
163 |                 <DialogTrigger asChild>
164 |                   <Button
165 |                     type="button"
166 |                     variant="outline"
167 |                     className="mt-2 md:mt-0"
168 |                   >
169 |                     Cancel
170 |                   </Button>
171 |                 </DialogTrigger>
172 |                 <Button
173 |                   type="submit"
174 |                   disabled={featureRequest.status === "executing"}
175 |                 >
176 |                   {featureRequest.status === "executing" ? (
177 |                     <Loader2 className="h-4 w-4 animate-spin" />
178 |                   ) : (
179 |                     "Submit"
180 |                   )}
181 |                 </Button>
182 |               </DialogFooter>
183 |             </form>
184 |           </Form>
185 |         )}
186 |       </div>
187 |     </DialogContent>
188 |   );
189 | }
```

apps/website/src/components/following-pointer.tsx
```
1 | "use client";
2 |
3 | // Thank you: https://ui.aceternity.com/components/following-pointer
4 |
5 | import React, { useEffect, useState } from "react";
6 |
7 | import { cn } from "@midday/ui/cn";
8 | import { AnimatePresence, motion, useMotionValue } from "framer-motion";
9 |
10 | export const FollowerPointerCard = ({
11 |   children,
12 |   className,
13 |   title,
14 | }: {
15 |   children: React.ReactNode;
16 |   className?: string;
17 |   title?: string | React.ReactNode;
18 | }) => {
19 |   const x = useMotionValue(0);
20 |   const y = useMotionValue(0);
21 |   const ref = React.useRef<HTMLDivElement>(null);
22 |   const [rect, setRect] = useState<DOMRect | null>(null);
23 |   const [isInside, setIsInside] = useState<boolean>(false); // Add this line
24 |
25 |   useEffect(() => {
26 |     if (ref.current) {
27 |       setRect(ref.current.getBoundingClientRect());
28 |     }
29 |   }, []);
30 |
31 |   const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {
32 |     if (rect) {
33 |       const scrollX = window.scrollX;
34 |       const scrollY = window.scrollY;
35 |       x.set(e.clientX - rect.left + scrollX);
36 |       y.set(e.clientY - rect.top + scrollY);
37 |     }
38 |   };
39 |
40 |   const handleMouseLeave = () => {
41 |     setIsInside(false);
42 |   };
43 |
44 |   const handleMouseEnter = () => {
45 |     setIsInside(true);
46 |   };
47 |
48 |   return (
49 |     <div
50 |       onMouseLeave={handleMouseLeave}
51 |       onMouseEnter={handleMouseEnter}
52 |       onMouseMove={handleMouseMove}
53 |       style={{
54 |         cursor: "none",
55 |       }}
56 |       ref={ref}
57 |       className={cn("relative", className)}
58 |     >
59 |       <AnimatePresence mode="wait">
60 |         <FollowPointer x={x} y={y} title={title} />
61 |       </AnimatePresence>
62 |       {children}
63 |     </div>
64 |   );
65 | };
66 |
67 | export const FollowPointer = ({
68 |   x,
69 |   y,
70 |   title,
71 | }: {
72 |   x: any;
73 |   y: any;
74 |   title?: string | React.ReactNode;
75 | }) => {
76 |   return (
77 |     <motion.div
78 |       className="h-4 w-4 rounded-full absolute z-50"
79 |       style={{
80 |         top: y,
81 |         left: x,
82 |         pointerEvents: "none",
83 |       }}
84 |       initial={{
85 |         scale: 1,
86 |         opacity: 1,
87 |       }}
88 |       animate={{
89 |         scale: 1,
90 |         opacity: 1,
91 |       }}
92 |       exit={{
93 |         scale: 0,
94 |         opacity: 0,
95 |       }}
96 |     >
97 |       <svg
98 |         stroke="currentColor"
99 |         fill="currentColor"
100 |         strokeWidth="1"
101 |         viewBox="0 0 16 16"
102 |         className="h-6 w-6 text-sky-500 transform -rotate-[70deg] -translate-x-[12px] -translate-y-[10px] stroke-sky-600"
103 |         height="1em"
104 |         width="1em"
105 |         xmlns="http://www.w3.org/2000/svg"
106 |       >
107 |         <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z" />
108 |       </svg>
109 |       <motion.div
110 |         style={{
111 |           backgroundColor: "black",
112 |         }}
113 |         initial={{
114 |           scale: 0.5,
115 |           opacity: 0,
116 |         }}
117 |         animate={{
118 |           scale: 1,
119 |           opacity: 1,
120 |         }}
121 |         exit={{
122 |           scale: 0.5,
123 |           opacity: 0,
124 |         }}
125 |         className={
126 |           "px-2 py-2 bg-neutral-200 text-white whitespace-nowrap min-w-max text-xs rounded-full"
127 |         }
128 |       >
129 |         {title}
130 |       </motion.div>
131 |     </motion.div>
132 |   );
133 | };
```

apps/website/src/components/footer-cta.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import Link from "next/link";
5 | import { usePathname } from "next/navigation";
6 |
7 | export function FooterCTA() {
8 |   const pathname = usePathname();
9 |
10 |   if (pathname.includes("pitch")) {
11 |     return null;
12 |   }
13 |
14 |   return (
15 |     <div className="border border-border md:container text-center px-10 py-14 mx-4 md:mx-auto md:px-24 md:py-20 mb-32 mt-24 flex items-center flex-col bg-[#F2F1EF] dark:bg-[#121212]">
16 |       <span className="text-6xl	md:text-8xl font-medium text-primary dark:text-white">
17 |         Stress free by midday.
18 |       </span>
19 |       <p className="text-[#878787] mt-6">
20 |         Invoicing, Time tracking, File reconciliation, Storage, Financial
21 |         Overview & your own <br /> Assistant.
22 |       </p>
23 |
24 |       <div className="mt-10 md:mb-8">
25 |         <div className="flex items-center space-x-4">
26 |           <Link
27 |             href="https://cal.com/pontus-midday/15min"
28 |             target="_blank"
29 |             rel="noopener noreferrer"
30 |           >
31 |             <Button
32 |               variant="outline"
33 |               className="border border-primary h-12 px-6 dark:border-white border-black text-primary hidden md:block"
34 |             >
35 |               Talk to founders
36 |             </Button>
37 |           </Link>
38 |
39 |           <a href="https://app.midday.ai">
40 |             <Button className="h-12 px-5 bg-black text-white dark:bg-white dark:text-black hover:bg-black/80 dark:hover:bg-white/80">
41 |               Try it for free
42 |             </Button>
43 |           </a>
44 |         </div>
45 |       </div>
46 |     </div>
47 |   );
48 | }
```

apps/website/src/components/footer.tsx
```
1 | import { LogoLarge } from "@/components/logo-large";
2 | import { SubscribeInput } from "@/components/subscribe-input";
3 | import Link from "next/link";
4 | import { GithubStars } from "./github-stars";
5 | import { SocialLinks } from "./social-links";
6 | import { StatusWidget } from "./status-widget";
7 |
8 | export function Footer() {
9 |   return (
10 |     <footer className="border-t-[1px] border-border px-4 md:px-6 pt-10 md:pt-16 bg-[#fff] dark:bg-[#0C0C0C] overflow-hidden md:max-h-[820px]">
11 |       <div className="container">
12 |         <div className="flex justify-between items-center border-border border-b-[1px] pb-10 md:pb-16 mb-12">
13 |           <Link href="/" className="scale-50 -ml-[52px] md:ml-0 md:scale-100">
14 |             <LogoLarge />
15 |             <span className="sr-only">Midday</span>
16 |           </Link>
17 |
18 |           <span className="font-normal md:text-2xl text-right">
19 |             Run your business smarter.
20 |           </span>
21 |         </div>
22 |
23 |         <div className="flex flex-col md:flex-row w-full">
24 |           <div className="flex flex-col space-y-8 md:space-y-0 md:flex-row md:w-6/12 justify-between leading-8">
25 |             <div>
26 |               <span className="font-medium">Features</span>
27 |               <ul>
28 |                 <li className="transition-colors text-[#878787]">
29 |                   <Link href="/overview">Overview</Link>
30 |                 </li>
31 |                 <li className="transition-colors text-[#878787]">
32 |                   <Link href="/inbox">Inbox</Link>
33 |                 </li>
34 |                 <li className="transition-colors text-[#878787]">
35 |                   <Link href="/vault">Vault</Link>
36 |                 </li>
37 |                 <li className="transition-colors text-[#878787]">
38 |                   <Link href="/tracker">Tracker</Link>
39 |                 </li>
40 |                 <li className="transition-colors text-[#878787]">
41 |                   <Link href="/invoice">Invoice</Link>
42 |                 </li>
43 |                 <li className="transition-colors text-[#878787]">
44 |                   <Link href="/pricing">Pricing</Link>
45 |                 </li>
46 |                 <li className="transition-colors text-[#878787]">
47 |                   <Link href="/engine">Engine</Link>
48 |                 </li>
49 |                 <li className="transition-colors text-[#878787]">
50 |                   <Link href="/download">Download</Link>
51 |                 </li>
52 |               </ul>
53 |             </div>
54 |
55 |             <div>
56 |               <span>Resources</span>
57 |               <ul>
58 |                 <li className="transition-colors text-[#878787]">
59 |                   <Link href="https://git.new/midday">Github</Link>
60 |                 </li>
61 |                 <li className="transition-colors text-[#878787]">
62 |                   <Link href="/support">Support</Link>
63 |                 </li>
64 |                 <li className="transition-colors text-[#878787]">
65 |                   <Link href="/policy">Privacy policy</Link>
66 |                 </li>
67 |                 <li className="transition-colors text-[#878787]">
68 |                   <Link href="/terms">Terms and Conditions</Link>
69 |                 </li>
70 |                 <li className="transition-colors text-[#878787]">
71 |                   <Link href="/branding">Branding</Link>
72 |                 </li>
73 |                 <li className="transition-colors text-[#878787]">
74 |                   <Link href="/feature-request">Feature Request</Link>
75 |                 </li>
76 |               </ul>
77 |             </div>
78 |
79 |             <div>
80 |               <span>Company</span>
81 |               <ul>
82 |                 <li className="transition-colors text-[#878787]">
83 |                   <Link href="/story">Story</Link>
84 |                 </li>
85 |                 <li className="transition-colors text-[#878787]">
86 |                   <Link href="/updates">Updates</Link>
87 |                 </li>
88 |                 <li className="transition-colors text-[#878787]">
89 |                   <Link href="/open-startup">Open startup</Link>
90 |                 </li>
91 |                 <li className="transition-colors text-[#878787]">
92 |                   <Link href="/oss-friends">OSS friends</Link>
93 |                 </li>
94 |               </ul>
95 |             </div>
96 |           </div>
97 |
98 |           <div className="md:w-6/12 flex mt-8 md:mt-0 md:justify-end">
99 |             <div className="flex md:items-end flex-col">
100 |               <div className="flex items-start md:items-center flex-col md:flex-row space-y-6 md:space-y-0 mb-8">
101 |                 <GithubStars />
102 |                 <SocialLinks />
103 |               </div>
104 |
105 |               <div className="mb-8">
106 |                 <SubscribeInput />
107 |               </div>
108 |               <div className="md:mr-0 mt-auto mr-auto">
109 |                 <StatusWidget />
110 |               </div>
111 |             </div>
112 |           </div>
113 |         </div>
114 |       </div>
115 |
116 |       <h5 className="dark:text-[#161616] text-[#F4F4F3] text-[500px] leading-none text-center pointer-events-none">
117 |         midday
118 |       </h5>
119 |     </footer>
120 |   );
121 | }
```

apps/website/src/components/github-stars.tsx
```
1 | import { fetchGithubStars } from "@/lib/fetch-github-stars";
2 |
3 | export async function GithubStars() {
4 |   const data = await fetchGithubStars();
5 |
6 |   return (
7 |     <a
8 |       href="https://git.new/midday"
9 |       className="border border-border flex justify-center h-8 leading-[30px] text-[#878787] mr-6 md:mr-0"
10 |       target="_blank"
11 |       rel="noreferrer"
12 |     >
13 |       <div className="dark:bg-[#1D1D1D] pl-2 pr-3 text-[14px] flex items-center space-x-2 border-r-[1px] border-border">
14 |         <svg
15 |           xmlns="http://www.w3.org/2000/svg"
16 |           width={18}
17 |           height={15}
18 |           fill="none"
19 |         >
20 |           <path
21 |             className="fill-[#878787]"
22 |             d="M6.375 11.683 9 10.186l2.625 1.517-.688-2.837 2.313-1.891-3.042-.257L9 4.038l-1.208 2.66-3.042.257 2.313 1.91-.688 2.818Zm-2.52 3.29 1.353-5.536L.667 5.714l6-.493L9 0l2.333 5.221 6 .493-4.541 3.723 1.354 5.537L9 12.037l-5.146 2.935Z"
23 |           />
24 |         </svg>
25 |         <span className="font-medium">Star</span>
26 |       </div>
27 |       <div className="px-4 text-[14px]">
28 |         {data &&
29 |           Intl.NumberFormat("en", {
30 |             notation: "compact",
31 |             minimumFractionDigits: 0,
32 |             maximumFractionDigits: 1,
33 |           }).format(data.stargazers_count ?? 0)}
34 |       </div>
35 |     </a>
36 |   );
37 | }
```

apps/website/src/components/header.tsx
```
1 | "use client";
2 |
3 | import {
4 |   Accordion,
5 |   AccordionContent,
6 |   AccordionItem,
7 |   AccordionTrigger,
8 | } from "@midday/ui/accordion";
9 | import { cn } from "@midday/ui/cn";
10 | import {
11 |   ContextMenu,
12 |   ContextMenuContent,
13 |   ContextMenuItem,
14 |   ContextMenuTrigger,
15 | } from "@midday/ui/context-menu";
16 | import { Icons } from "@midday/ui/icons";
17 | import { motion } from "framer-motion";
18 | import Link from "next/link";
19 | import { usePathname } from "next/navigation";
20 | import menuAssistantLight from "public/menu-assistant-light.jpg";
21 | import menuAssistantDark from "public/menu-assistant.jpg";
22 | import menuEngineLight from "public/menu-engine-light.png";
23 | import menuEngineDark from "public/menu-engine.png";
24 | import { useEffect, useState } from "react";
25 | import { FaDiscord, FaGithub } from "react-icons/fa";
26 | import {
27 |   MdOutlineDashboardCustomize,
28 |   MdOutlineDescription,
29 |   MdOutlineIntegrationInstructions,
30 |   MdOutlineMemory,
31 | } from "react-icons/md";
32 | import { DynamicImage } from "./dynamic-image";
33 | import { LogoIcon } from "./logo-icon";
34 |
35 | const listVariant = {
36 |   show: {
37 |     opacity: 1,
38 |     transition: {
39 |       staggerChildren: 0.03,
40 |     },
41 |   },
42 |   hidden: {
43 |     opacity: 0,
44 |   },
45 | };
46 |
47 | const itemVariant = {
48 |   hidden: { opacity: 0 },
49 |   show: { opacity: 1 },
50 | };
51 |
52 | export function Header() {
53 |   const pathname = usePathname();
54 |   const [isOpen, setOpen] = useState(false);
55 |   const [showBlur, setShowBlur] = useState(false);
56 |   const [hidden, setHidden] = useState(false);
57 |   const lastPath = `/${pathname.split("/").pop()}`;
58 |
59 |   useEffect(() => {
60 |     const setPixelRatio = () => {
61 |       const pixelRatio = window.devicePixelRatio || 1;
62 |       document.documentElement.style.setProperty(
63 |         "--pixel-ratio",
64 |         `${1 / pixelRatio}`,
65 |       );
66 |     };
67 |
68 |     setPixelRatio();
69 |     window.addEventListener("resize", setPixelRatio);
70 |
71 |     return () => window.removeEventListener("resize", setPixelRatio);
72 |   }, []);
73 |
74 |   const handleToggleMenu = () => {
75 |     setOpen((prev) => {
76 |       document.body.style.overflow = prev ? "" : "hidden";
77 |       return !prev;
78 |     });
79 |   };
80 |
81 |   const handleOnClick = () => {
82 |     setShowBlur(false);
83 |     setHidden(true);
84 |
85 |     setTimeout(() => {
86 |       setHidden(false);
87 |     }, 100);
88 |   };
89 |
90 |   const links = [
91 |     {
92 |       title: "Features",
93 |       cover: (
94 |         <Link href="/#assistant" onClick={handleOnClick}>
95 |           <DynamicImage
96 |             alt="Assistant"
97 |             darkSrc={menuAssistantDark}
98 |             lightSrc={menuAssistantLight}
99 |           />
100 |         </Link>
101 |       ),
102 |       children: [
103 |         {
104 |           path: "/overview",
105 |           title: "Overview",
106 |           icon: <Icons.Overview size={20} />,
107 |         },
108 |         {
109 |           path: "/inbox",
110 |           title: "Inbox",
111 |           icon: <Icons.Inbox2 size={20} />,
112 |         },
113 |         {
114 |           path: "/vault",
115 |           title: "Vault",
116 |           icon: <Icons.Files size={20} />,
117 |         },
118 |         {
119 |           path: "/tracker",
120 |           title: "Tracker",
121 |           icon: <Icons.Tracker size={20} />,
122 |         },
123 |         {
124 |           path: "/invoice",
125 |           title: "Invoice",
126 |           icon: <Icons.Invoice size={20} />,
127 |         },
128 |       ],
129 |     },
130 |     {
131 |       title: "Pricing",
132 |       path: "/pricing",
133 |     },
134 |     {
135 |       title: "Updates",
136 |       path: "/updates",
137 |     },
138 |     {
139 |       title: "Story",
140 |       path: "/story",
141 |     },
142 |     {
143 |       title: "Download",
144 |       path: "/download",
145 |     },
146 |     {
147 |       title: "Developers",
148 |       cover: (
149 |         <Link href="/engine" onClick={handleOnClick}>
150 |           <DynamicImage
151 |             alt="Engine"
152 |             darkSrc={menuEngineDark}
153 |             lightSrc={menuEngineLight}
154 |           />
155 |         </Link>
156 |       ),
157 |       children: [
158 |         {
159 |           path: "https://git.new/midday",
160 |           title: "Open Source",
161 |           icon: <FaGithub size={19} />,
162 |         },
163 |         {
164 |           path: "https://docs.midday.ai",
165 |           title: "Documentation",
166 |           icon: <MdOutlineDescription size={20} />,
167 |         },
168 |         {
169 |           path: "/engine",
170 |           title: "Engine",
171 |           icon: <MdOutlineMemory size={20} />,
172 |         },
173 |         {
174 |           title: "Join the community",
175 |           path: "https://go.midday.ai/anPiuRx",
176 |           icon: <FaDiscord size={19} />,
177 |         },
178 |         {
179 |           title: "Apps & Integrations",
180 |           path: "https://docs.midday.ai/integrations",
181 |           icon: <MdOutlineIntegrationInstructions size={20} />,
182 |         },
183 |         {
184 |           path: "/components",
185 |           title: "Components",
186 |           icon: <MdOutlineDashboardCustomize size={20} />,
187 |         },
188 |       ],
189 |     },
190 |   ];
191 |
192 |   if (pathname.includes("pitch")) {
193 |     return null;
194 |   }
195 |
196 |   return (
[TRUNCATED]
```

apps/website/src/components/hero-image.tsx
```
1 | "use client";
2 |
3 | import { motion } from "framer-motion";
4 | import heroImageLight from "public/hero-light.png";
5 | import heroImageDark from "public/hero.png";
6 | import { useState } from "react";
7 | import { DynamicImage } from "./dynamic-image";
8 |
9 | export function HeroImage() {
10 |   const [isLoaded, setIsLoaded] = useState(false);
11 |
12 |   return (
13 |     <div className="scale-100 sm:scale-100 md:scale-[0.9] lg:scale-[0.7] xl:scale-100 mt-10 md:mt-0 lg:absolute -right-[420px] -top-[100px] 2xl:scale-[1.35] 2xl:-top-[20px] z-10">
14 |       <motion.div
15 |         initial={{ opacity: 0, y: 20 }}
16 |         animate={{ opacity: isLoaded ? 1 : 0, y: isLoaded ? 0 : 20 }}
17 |         transition={{ duration: 0.3, ease: "easeOut" }}
18 |       >
19 |         <div className="[transform:perspective(4101px)_rotateX(51deg)_rotateY(-13deg)_rotateZ(40deg)]">
20 |           <DynamicImage
21 |             lightSrc={heroImageLight}
22 |             darkSrc={heroImageDark}
23 |             alt="Dashboard interface showing financial data and charts"
24 |             width={1141}
25 |             height={641}
26 |             quality={80}
27 |             priority
28 |             onLoad={() => setIsLoaded(true)}
29 |             className="border border-border dark:[box-shadow:0px_80px_60px_0px_rgba(0,0,0,0.35),0px_35px_28px_0px_rgba(0,0,0,0.25),0px_18px_15px_0px_rgba(0,0,0,0.20),0px_10px_8px_0px_rgba(0,0,0,0.17),0px_5px_4px_0px_rgba(0,0,0,0.14),0px_2px_2px_0px_rgba(0,0,0,0.10)] [box-shadow:0px_82px_105px_0px_#E3E2DF7A,0px_29.93px_38.33px_0px_#E3E2DF54,0px_14.53px_18.61px_0px_#E3E2DF44,0px_7.12px_9.12px_0px_#E3E2DF36,0px_2.82px_3.61px_0px_#E3E2DF26]"
30 |           />
31 |         </div>
32 |       </motion.div>
33 |     </div>
34 |   );
35 | }
```

apps/website/src/components/hero.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import Link from "next/link";
3 | import { HeroImage } from "./hero-image";
4 | import { Metrics } from "./metrics";
5 | import { WordAnimation } from "./word-animation";
6 |
7 | export function Hero() {
8 |   return (
9 |     <section className="mt-[60px] lg:mt-[180px] min-h-[530px] relative lg:h-[calc(100vh-300px)]">
10 |       <div className="flex flex-col">
11 |         <Link href="/updates/october-product-updates">
12 |           <Button
13 |             variant="outline"
14 |             className="rounded-full border-border flex space-x-2 items-center"
15 |           >
16 |             <span className="font-mono text-xs">October Product Updates</span>
17 |             <svg
18 |               xmlns="http://www.w3.org/2000/svg"
19 |               width={12}
20 |               height={12}
21 |               fill="none"
22 |             >
23 |               <path
24 |                 fill="currentColor"
25 |                 d="M8.783 6.667H.667V5.333h8.116L5.05 1.6 6 .667 11.333 6 6 11.333l-.95-.933 3.733-3.733Z"
26 |               />
27 |             </svg>
28 |           </Button>
29 |         </Link>
30 |
31 |         <h2 className="mt-6 md:mt-10 max-w-[580px] text-[#878787] leading-tight text-[24px] md:text-[36px] font-medium">
32 |           Invoicing, Time tracking, File reconciliation, Storage, Financial
33 |           Overview & your own Assistant made for <WordAnimation />
34 |         </h2>
35 |
36 |         <div className="mt-8 md:mt-10">
37 |           <div className="flex items-center space-x-4">
38 |             <Link
39 |               href="https://cal.com/pontus-midday/15min"
40 |               target="_blank"
41 |               rel="noopener noreferrer"
42 |             >
43 |               <Button
44 |                 variant="outline"
45 |                 className="border-transparent h-11 px-6 dark:bg-[#1D1D1D] bg-[#F2F1EF]"
46 |               >
47 |                 Talk to founders
48 |               </Button>
49 |             </Link>
50 |
51 |             <a href="https://app.midday.ai">
52 |               <Button className="h-11 px-5">Try it for free</Button>
53 |             </a>
54 |           </div>
55 |         </div>
56 |
57 |         <p className="text-xs text-[#707070] mt-4 font-mono">
58 |           Claim $49/mo deal, free during beta.
59 |         </p>
60 |       </div>
61 |
62 |       <HeroImage />
63 |       <Metrics />
64 |     </section>
65 |   );
66 | }
```

apps/website/src/components/infinite-moving-cards.tsx
```
1 | // Thank you: https://ui.aceternity.com/components/infinite-moving-cards
2 |
3 | "use client";
4 |
5 | import { cn } from "@midday/ui/cn";
6 | import Image from "next/image";
7 | import React, { useEffect, useState } from "react";
8 |
9 | export const InfiniteMovingCards = ({
10 |   items,
11 |   direction = "left",
12 |   speed = "fast",
13 |   pauseOnHover = true,
14 |   className,
15 | }: {
16 |   items: {
17 |     quote: string;
18 |     name: string;
19 |     title: string;
20 |   }[];
21 |   direction?: "left" | "right";
22 |   speed?: "fast" | "normal" | "slow";
23 |   pauseOnHover?: boolean;
24 |   className?: string;
25 | }) => {
26 |   const containerRef = React.useRef<HTMLDivElement>(null);
27 |   const scrollerRef = React.useRef<HTMLUListElement>(null);
28 |
29 |   useEffect(() => {
30 |     addAnimation();
31 |   }, []);
32 |   const [start, setStart] = useState(false);
33 |   function addAnimation() {
34 |     if (containerRef.current && scrollerRef.current) {
35 |       const scrollerContent = Array.from(scrollerRef.current.children);
36 |
37 |       scrollerContent.forEach((item) => {
38 |         const duplicatedItem = item.cloneNode(true);
39 |         if (scrollerRef.current) {
40 |           scrollerRef.current.appendChild(duplicatedItem);
41 |         }
42 |       });
43 |
44 |       getDirection();
45 |       getSpeed();
46 |       setStart(true);
47 |     }
48 |   }
49 |   const getDirection = () => {
50 |     if (containerRef.current) {
51 |       if (direction === "left") {
52 |         containerRef.current.style.setProperty(
53 |           "--animation-direction",
54 |           "forwards",
55 |         );
56 |       } else {
57 |         containerRef.current.style.setProperty(
58 |           "--animation-direction",
59 |           "reverse",
60 |         );
61 |       }
62 |     }
63 |   };
64 |   const getSpeed = () => {
65 |     if (containerRef.current) {
66 |       if (speed === "fast") {
67 |         containerRef.current.style.setProperty("--animation-duration", "20s");
68 |       } else if (speed === "normal") {
69 |         containerRef.current.style.setProperty("--animation-duration", "40s");
70 |       } else {
71 |         containerRef.current.style.setProperty("--animation-duration", "80s");
72 |       }
73 |     }
74 |   };
75 |
76 |   return (
77 |     <div
78 |       ref={containerRef}
79 |       className={cn(
80 |         "scroller relative z-20 overflow-hidden -ml-4 md:-ml-[1200px] w-screen md:w-[calc(100vw+1400px)]",
81 |         className,
82 |       )}
83 |     >
84 |       <ul
85 |         ref={scrollerRef}
86 |         className={cn(
87 |           "flex min-w-full shrink-0 gap-8 py-4 w-max flex-nowrap items-start",
88 |           start && "animate-scroll",
89 |           pauseOnHover && "hover:[animation-play-state:paused]",
90 |         )}
91 |       >
92 |         {items.map((item, idx) => (
93 |           <li
94 |             className="w-[310px] max-w-full relative flex-shrink-0 border border-border dark:bg-[#121212] px-8 py-6 md:w-[310px]"
95 |             key={item.name}
96 |           >
97 |             <blockquote>
98 |               <div
99 |                 aria-hidden="true"
100 |                 className="user-select-none -z-1 pointer-events-none absolute -left-0.5 -top-0.5 h-[calc(100%_+_4px)] w-[calc(100%_+_4px)]"
101 |               />
102 |
103 |               <div className="flex space-x-2 items-center mb-6">
104 |                 <Image
105 |                   src={item.avatarUrl}
106 |                   width={48}
107 |                   height={48}
108 |                   alt="Tweet"
109 |                   className="rounded-full overflow-hidden"
110 |                 />
111 |                 <div className="flex flex-col">
112 |                   <div className="flex items-center space-x-2">
113 |                     <span className="truncate max-w-36">{item.name}</span>
114 |                     {item.verified && (
115 |                       <svg
116 |                         width={2500}
117 |                         height={2500}
118 |                         className="h-4 w-4"
119 |                         viewBox="0 0 512 512"
120 |                       >
121 |                         <path
122 |                           fill="#1da1f2"
[TRUNCATED]
```

apps/website/src/components/keyboard.tsx
```
1 | "use client";
2 |
3 | import { Assistant } from "@/components/assistant";
4 | import { motion } from "framer-motion";
5 | import keyboardLight from "public/keyboard-light.png";
6 | import keyboardDark from "public/keyboard.png";
7 | import { DynamicImage } from "./dynamic-image";
8 |
9 | export function Keyboard() {
10 |   return (
11 |     <div className="relative mb-[100px] text-left">
12 |       <motion.div
13 |         className="absolute -right-[175px] -top-[130px] md:-top-[90px] lg:-top-9 xl:-top-4 md:-right-[200px] z-20 bg-gradient-to-l md:from-[#fbfbfb] dark:bg-gradient-to-l dark:md:from-[#0C0C0C]"
14 |         initial={{ opacity: 0, scale: 0.85 }}
15 |         animate={{ opacity: 1, scale: 1 }}
16 |         transition={{ delay: 0.2 }}
17 |       >
18 |         <div className="scale-[0.40] md:scale-[0.55] lg:scale-[0.7] xl:scale-[0.84] shadow-2xl">
19 |           <Assistant />
20 |         </div>
21 |       </motion.div>
22 |
23 |       <div className="h-full w-[500px] duration-200 ease-out transition-all absolute left-[1px] right-[1px] top-[1px] z-[15] bottom-[1px] bg-background/80" />
24 |
25 |       <DynamicImage
26 |         darkSrc={keyboardDark}
27 |         lightSrc={keyboardLight}
28 |         alt="Download Midday"
29 |         width={1092}
30 |         height={448}
31 |         className="z-10 relative"
32 |         quality={90}
33 |         priority
34 |       />
35 |     </div>
36 |   );
37 | }
```

apps/website/src/components/logo-icon.tsx
```
1 | export function LogoIcon() {
2 |   return (
3 |     <>
4 |       <svg
5 |         xmlns="http://www.w3.org/2000/svg"
6 |         width={102}
7 |         height={30}
8 |         fill="none"
9 |         className="md:hidden"
10 |       >
11 |         <path
12 |           fill="currentColor"
13 |           fillRule="evenodd"
14 |           d="M14.347 0a14.931 14.931 0 0 0-6.282 1.68l6.282 10.88V0Zm0 17.443L8.067 28.32a14.933 14.933 0 0 0 6.28 1.68V17.443ZM15.652 30V17.432l6.285 10.887A14.932 14.932 0 0 1 15.652 30Zm0-17.43V0c2.26.097 4.392.693 6.287 1.682l-6.287 10.889ZM2.336 23.068l10.884-6.284-6.284 10.884a15.093 15.093 0 0 1-4.6-4.6Zm25.33-16.132-10.88 6.282 6.282-10.88a15.094 15.094 0 0 1 4.598 4.598ZM2.335 6.934a15.094 15.094 0 0 1 4.6-4.6l6.284 10.884L2.335 6.934Zm-.654 1.13A14.931 14.931 0 0 0 0 14.35h12.568L1.681 8.064Zm0 13.873a14.932 14.932 0 0 1-1.68-6.282h12.562L1.682 21.938Zm15.754-7.587H30a14.93 14.93 0 0 0-1.68-6.285L17.435 14.35Zm10.884 7.586-10.878-6.28H30a14.932 14.932 0 0 1-1.68 6.28Zm-11.533-5.151 6.281 10.88a15.092 15.092 0 0 0 4.598-4.599l-10.88-6.281Z"
15 |           clipRule="evenodd"
16 |         />
17 |         <path
18 |           fill="currentColor"
19 |           d="M92.34 11.912h1.637l2.995 8.223 2.884-8.223h1.619l-4 11.107c-.372 1.06-1.08 1.544-2.196 1.544h-1.172v-1.358h1.024c.502 0 .8-.186.986-.707l.353-.912h-.52l-3.61-9.674ZM82.744 14.814c.39-1.916 1.916-3.126 4.018-3.126 2.549 0 3.963 1.489 3.963 4.13v3.964c0 .446.186.632.614.632h.39v1.358h-.65c-1.005 0-1.88-.335-1.861-1.544-.428.93-1.544 1.767-3.107 1.767-1.954 0-3.535-1.041-3.535-2.79 0-2.028 1.544-2.55 3.702-2.977l2.921-.558c-.018-1.712-.818-2.53-2.437-2.53-1.265 0-2.102.65-2.4 1.804l-1.618-.13Zm1.432 4.39c0 .8.689 1.452 2.14 1.433 1.637 0 2.92-1.153 2.92-3.442v-.167l-2.362.41c-1.47.26-2.698.371-2.698 1.767ZM80.129 8.563v13.21h-1.377l-.056-1.452c-.558 1.042-1.618 1.675-3.144 1.675-2.847 0-4.168-2.419-4.168-5.154s1.321-5.153 4.168-5.153c1.451 0 2.493.558 3.051 1.562V8.563h1.526Zm-7.145 8.28c0 1.915.819 3.701 2.884 3.701 2.028 0 2.865-1.823 2.865-3.702 0-1.953-.837-3.758-2.865-3.758-2.065 0-2.884 1.786-2.884 3.758ZM68.936 8.563v13.21H67.56l-.056-1.452c-.558 1.042-1.619 1.675-3.144 1.675-2.847 0-4.168-2.419-4.168-5.154s1.321-5.153 4.168-5.153c1.45 0 2.493.558 3.05 1.562V8.563h1.526Zm-7.144 8.28c0 1.915.819 3.701 2.884 3.701 2.028 0 2.865-1.823 2.865-3.702 0-1.953-.837-3.758-2.865-3.758-2.065 0-2.884 1.786-2.884 3.758ZM56.212 11.912h1.525v9.86h-1.525v-9.86Zm-.037-1.544V8.6h1.6v1.768h-1.6ZM40.224 11.912h1.395l.056 1.674c.446-1.21 1.47-1.898 2.846-1.898 1.414 0 2.438.763 2.865 2.084.428-1.34 1.47-2.084 3.014-2.084 1.973 0 3.126 1.377 3.126 3.74v6.344H52v-5.897c0-1.805-.707-2.828-1.916-2.828-1.544 0-2.437 1.041-2.437 2.846v5.88H46.12v-5.899c0-1.767-.725-2.827-1.916-2.827-1.526 0-2.456 1.079-2.456 2.827v5.898h-1.525v-9.86Z"
20 |         />
21 |       </svg>
22 |
23 |       <svg
24 |         xmlns="http://www.w3.org/2000/svg"
25 |         width={30}
26 |         height={30}
27 |         fill="none"
28 |         className="hidden md:block"
29 |       >
30 |         <path
31 |           fill="currentColor"
[TRUNCATED]
```

apps/website/src/components/logo-large.tsx
```
1 | export function LogoLarge() {
2 |   return (
3 |     <svg xmlns="http://www.w3.org/2000/svg" width={215} height={60} fill="none">
4 |       <path
5 |         fill="currentColor"
6 |         fillRule="evenodd"
7 |         d="M33.228 3.495A26.094 26.094 0 0 0 22.25 6.431l10.978 19.015V3.496Zm0 30.48L22.252 52.987a26.092 26.092 0 0 0 10.976 2.935V33.975Zm2.282 21.947V33.96l10.983 19.024a26.094 26.094 0 0 1-10.983 2.938Zm0-30.462V3.495a26.093 26.093 0 0 1 10.984 2.94L35.51 25.46ZM12.237 43.808l19.02-10.98-10.98 19.017a26.377 26.377 0 0 1-8.04-8.037Zm44.268-28.192L37.49 26.593 48.469 7.577a26.377 26.377 0 0 1 8.036 8.039Zm-44.27-.003a26.377 26.377 0 0 1 8.04-8.04l10.982 19.022-19.022-10.982Zm-1.142 1.975a26.094 26.094 0 0 0-2.938 10.984H30.12L11.093 17.588Zm.001 24.245a26.094 26.094 0 0 1-2.938-10.979H30.11l-19.017 10.98Zm27.532-13.26h21.957a26.095 26.095 0 0 0-2.936-10.983L38.626 28.572Zm19.02 13.258L38.632 30.854h21.95a26.09 26.09 0 0 1-2.938 10.977ZM37.49 32.828 48.467 51.84a26.379 26.379 0 0 0 8.036-8.036L37.49 32.83Z"
8 |         clipRule="evenodd"
9 |       />
10 |       <path
11 |         fill="currentColor"
12 |         d="M183.658 21.274h3.281l6.002 16.478 5.779-16.478h3.243l-8.015 22.257c-.746 2.125-2.162 3.094-4.399 3.094H187.2v-2.721h2.05c1.007 0 1.604-.373 1.976-1.417l.709-1.827h-1.044l-7.233-19.386Zm-19.229 5.816c.782-3.84 3.84-6.264 8.052-6.264 5.108 0 7.941 2.983 7.941 8.277v7.94c0 .895.373 1.268 1.231 1.268h.783v2.722h-1.305c-2.014 0-3.766-.671-3.728-3.095-.858 1.864-3.095 3.542-6.227 3.542-3.914 0-7.083-2.088-7.083-5.592 0-4.064 3.094-5.108 7.419-5.965l5.853-1.119c-.037-3.43-1.64-5.07-4.884-5.07-2.535 0-4.212 1.305-4.809 3.616l-3.243-.26Zm2.87 8.798c0 1.603 1.38 2.908 4.288 2.87 3.28 0 5.853-2.31 5.853-6.897v-.335l-4.735.82c-2.945.522-5.406.746-5.406 3.542Zm-8.111-21.325v26.47h-2.759l-.112-2.908c-1.118 2.088-3.243 3.355-6.3 3.355-5.704 0-8.351-4.846-8.351-10.327 0-5.48 2.647-10.327 8.351-10.327 2.908 0 4.996 1.119 6.114 3.132v-9.395h3.057Zm-14.316 16.59c0 3.84 1.64 7.42 5.779 7.42 4.063 0 5.741-3.654 5.741-7.42 0-3.914-1.678-7.53-5.741-7.53-4.139 0-5.779 3.578-5.779 7.53Zm-8.111-16.59v26.47h-2.759l-.112-2.908c-1.118 2.088-3.243 3.355-6.3 3.355-5.704 0-8.351-4.846-8.351-10.327 0-5.48 2.647-10.327 8.351-10.327 2.908 0 4.995 1.119 6.114 3.132v-9.395h3.057Zm-14.316 16.59c0 3.84 1.64 7.42 5.778 7.42 4.064 0 5.742-3.654 5.742-7.42 0-3.914-1.678-7.53-5.742-7.53-4.138 0-5.778 3.578-5.778 7.53Zm-11.183-9.879h3.057v19.759h-3.057v-19.76Zm-.074-3.095v-3.541h3.206v3.541h-3.206Zm-31.965 3.095h2.796l.112 3.355c.895-2.423 2.945-3.803 5.704-3.803 2.834 0 4.884 1.529 5.742 4.176.857-2.685 2.945-4.176 6.04-4.176 3.951 0 6.263 2.759 6.263 7.494v12.713h-3.057V29.214c0-3.616-1.417-5.666-3.84-5.666-3.095 0-4.884 2.088-4.884 5.704v11.78H91.04V29.216c0-3.542-1.453-5.667-3.84-5.667-3.056 0-4.92 2.162-4.92 5.667v11.818h-3.058v-19.76Z"
13 |       />
14 |     </svg>
15 |   );
16 | }
```

apps/website/src/components/mdx.tsx
```
1 | import { MDXRemote } from "next-mdx-remote/rsc";
2 | import Image from "next/image";
3 | import Link from "next/link";
4 | import React from "react";
5 | import { highlight } from "sugar-high";
6 |
7 | interface TableProps {
8 |   data: {
9 |     headers: string[];
10 |     rows: string[][];
11 |   };
12 | }
13 |
14 | function Table({ data }: TableProps) {
15 |   const headers = data.headers.map((header, index) => (
16 |     <th key={header}>{header}</th>
17 |   ));
18 |
19 |   const rows = data.rows.map((row, rowIndex) => (
20 |     <tr key={row.join("-")}>
21 |       {row.map((cell, cellIndex) => (
22 |         <td key={`${cell}-${cellIndex}`}>{cell}</td>
23 |       ))}
24 |     </tr>
25 |   ));
26 |
27 |   return (
28 |     <table>
29 |       <thead>
30 |         <tr>{headers}</tr>
31 |       </thead>
32 |       <tbody>{rows}</tbody>
33 |     </table>
34 |   );
35 | }
36 |
37 | interface CustomLinkProps
38 |   extends React.AnchorHTMLAttributes<HTMLAnchorElement> {
39 |   href: string;
40 | }
41 |
42 | function CustomLink({ href, ...props }: CustomLinkProps) {
43 |   if (href.startsWith("/")) {
44 |     return (
45 |       <Link href={href} {...props}>
46 |         {props.children}
47 |       </Link>
48 |     );
49 |   }
50 |
51 |   if (href.startsWith("#")) {
52 |     return <a href={href} {...props} />;
53 |   }
54 |
55 |   return <a href={href} target="_blank" rel="noopener noreferrer" {...props} />;
56 | }
57 |
58 | interface RoundedImageProps extends React.ComponentProps<typeof Image> {
59 |   alt: string;
60 | }
61 |
62 | function RoundedImage(props: RoundedImageProps) {
63 |   return <Image {...props} />;
64 | }
65 |
66 | interface CodeProps {
67 |   children: string;
68 | }
69 |
70 | function Code({ children, ...props }: CodeProps) {
71 |   const codeHTML = highlight(children);
72 |   return <code dangerouslySetInnerHTML={{ __html: codeHTML }} {...props} />;
73 | }
74 |
75 | function slugify(str: string): string {
76 |   return str
77 |     .toString()
78 |     .toLowerCase()
79 |     .trim()
80 |     .replace(/\s+/g, "-")
81 |     .replace(/&/g, "-and-")
82 |     .replace(/[^\w\-]+/g, "")
83 |     .replace(/\-\-+/g, "-");
84 | }
85 |
86 | function createHeading(level: number) {
87 |   const Heading = ({ children }: { children: React.ReactNode }) => {
88 |     const slug = slugify(children as string);
89 |
90 |     return React.createElement(
91 |       `h${level}`,
92 |       { id: slug },
93 |       [
94 |         React.createElement("a", {
95 |           href: `#${slug}`,
96 |           key: `link-${slug}`,
97 |           className: "anchor",
98 |         }),
99 |       ],
100 |       children,
101 |     );
102 |   };
103 |
104 |   Heading.displayName = `Heading${level}`;
105 |
106 |   return Heading;
107 | }
108 |
109 | interface IframeProps extends React.IframeHTMLAttributes<HTMLIFrameElement> {
110 |   src: string;
111 | }
112 |
113 | function Iframe({ src, ...props }: IframeProps) {
114 |   return <iframe src={src} {...props} />;
115 | }
116 |
117 | const components = {
118 |   h1: createHeading(1),
119 |   h2: createHeading(2),
120 |   h3: createHeading(3),
121 |   h4: createHeading(4),
122 |   h5: createHeading(5),
123 |   h6: createHeading(6),
124 |   Image: RoundedImage,
125 |   a: CustomLink,
126 |   code: Code,
127 |   Table,
128 |   iframe: Iframe,
129 | };
130 |
131 | interface CustomMDXProps {
132 |   components?: Record<string, React.ComponentType<unknown>>;
133 | }
134 |
135 | export function CustomMDX(props: CustomMDXProps) {
136 |   return (
137 |     <MDXRemote
138 |       {...props}
139 |       components={{ ...components, ...(props.components || {}) }}
140 |     />
141 |   );
142 | }
```

apps/website/src/components/metrics.tsx
```
1 | import Link from "next/link";
2 |
3 | export function Metrics() {
4 |   return (
5 |     <div className="grid grid-cols-2 md:flex md:flex-nowrap gap-8 lg:absolute bottom-0 left-0 md:divide-x mt-20 lg:mt-0">
6 |       <Link href="/open-startup">
7 |         <div className="flex flex-col md:pr-8 text-center">
8 |           <h4 className="text-[#878787] text-sm mb-4">Businesses</h4>
9 |           <span className="text-2xl font-mono text-stroke">12,200+</span>
10 |         </div>
11 |       </Link>
12 |       <Link href="/open-startup">
13 |         <div className="flex flex-col md:px-8 text-center">
14 |           <h4 className="text-[#878787] text-sm mb-4">Bank accounts</h4>
15 |           <span className="text-2xl font-mono text-stroke">5,000+</span>
16 |         </div>
17 |       </Link>
18 |       <Link href="/open-startup">
19 |         <div className="flex flex-col md:px-8 text-center">
20 |           <h4 className="text-[#878787] text-sm mb-4">Transactions</h4>
21 |           <span className="text-2xl font-mono text-stroke">1.1M</span>
22 |         </div>
23 |       </Link>
24 |       <Link href="/open-startup">
25 |         <div className="flex flex-col md:px-8 text-center">
26 |           <h4 className="text-[#878787] text-sm mb-4">Transaction value</h4>
27 |           <span className="text-2xl font-mono text-stroke">$812M</span>
28 |         </div>
29 |       </Link>
30 |     </div>
31 |   );
32 | }
```

apps/website/src/components/not-found-statuses.tsx
```
1 | "use client";
2 |
3 | import { useEffect, useRef, useState } from "react";
4 |
5 | const data = [
6 |   {
7 |     name: "<Status Code>",
8 |     description: "404 Not Found",
9 |   },
10 |   {
11 |     name: "<Referrer Policy>",
12 |     description: "strict-origin-when-cross-origin",
13 |   },
14 |   {
15 |     name: "<Cache-Control>",
16 |     description: "no-store, must-revalidate",
17 |   },
18 |   {
19 |     name: "<Connection>",
20 |     description: "keep-alive",
21 |   },
22 |   {
23 |     name: "<Content-Type>",
24 |     description: "text/html; charset=utf-8",
25 |   },
26 |   {
27 |     name: "<Date>",
28 |     description: new Date().toTimeString(),
29 |   },
30 |   {
31 |     name: "<X-Powered-By>",
32 |     description: "Next.js",
33 |   },
34 |   {
35 |     name: "<Project-Name>",
36 |     description: "Midday",
37 |   },
38 | ];
39 |
40 | export function NotFoundStatuses() {
41 |   const [statuses, setStatuses] = useState();
42 |   const ref = useRef(false);
43 |   const scrollRef = useRef(undefined);
44 |
45 |   useEffect(() => {
46 |     setStatuses([
47 |       {
48 |         name: "<Request URL>",
49 |         description: location.origin,
50 |       },
51 |     ]);
52 |   }, []);
53 |
54 |   useEffect(() => {
55 |     let index = 1;
56 |
57 |     function addItems() {
58 |       const destinationArray = [];
59 |
60 |       if (index < data.length - 1) {
61 |         destinationArray.push(data[index]);
62 |
63 |         setStatuses((prev) => [...prev, data[index]]);
64 |         index++;
65 |
66 |         scrollRef.current?.scrollTo({
67 |           top: 10000000,
68 |           behavior: "smooth",
69 |           block: "end",
70 |         });
71 |
72 |         setTimeout(addItems, 500);
73 |       }
74 |     }
75 |
76 |     if (!ref.current) {
77 |       addItems();
78 |
79 |       ref.current = true;
80 |     }
81 |   }, []);
82 |
83 |   return (
84 |     <ul
85 |       className="overflow-auto p-4 flex flex-col space-y-4 h-[290px] font-mono text-xs"
86 |       ref={scrollRef}
87 |     >
88 |       {statuses?.map((status) => {
89 |         return (
90 |           <li className="flex flex-col" key={status.name}>
91 |             <span className="text-[#707070] mb-1">{status.name}</span>
92 |             <span>{status.description}</span>
93 |           </li>
94 |         );
95 |       })}
96 |     </ul>
97 |   );
98 | }
```

apps/website/src/components/not-found-terminal.tsx
```
1 | import { NotFoundStatuses } from "./not-found-statuses";
2 | import { StatusWidget } from "./status-widget";
3 |
4 | export function NotFoundTerminal() {
5 |   return (
6 |     <div className="h-[350px] w-full bg-background fixed left-0 right-0 bottom-0">
7 |       <div className="border-t-[1px] border-b-[1px] border-border w-full h-14 px-4 flex items-center">
8 |         <span className="loading-ellipsis">Data failed...</span>
9 |
10 |         <div className="flex space-x-2 ml-auto">
11 |           <StatusWidget />
12 |         </div>
13 |       </div>
14 |
15 |       <NotFoundStatuses />
16 |     </div>
17 |   );
18 | }
```

apps/website/src/components/post-author.tsx
```
1 | import Image from "next/image";
2 | import { PostCopyURL } from "./post-copy-url";
3 |
4 | const getAuthor = (id: string) =>
5 |   ({
6 |     pontus: {
7 |       name: "Pontus",
8 |       src: "https://pbs.twimg.com/profile_images/1755611130368770048/JwLEqyeo_400x400.jpg",
9 |       tagline: "Engineering",
10 |     },
11 |   })[id];
12 |
13 | type Props = {
14 |   author: string;
15 | };
16 |
17 | export function PostAuthor({ author }: Props) {
18 |   const authorData = getAuthor(author);
19 |
20 |   if (!authorData) return null;
21 |
22 |   return (
23 |     <div className="flex items-center pt-4 border-t-[1px] border-border w-full">
24 |       <div className="flex items-center space-x-2">
25 |         <Image
26 |           src={authorData.src}
27 |           width={24}
28 |           height={24}
29 |           alt={authorData.name}
30 |           className="rounded-full overflow-hidden"
31 |           quality={90}
32 |         />
33 |         <span className="font-medium text-xs">{authorData.name}</span>
34 |         <span className="text-xs text-[#878787]">{authorData.tagline}</span>
35 |       </div>
36 |       <div className="ml-auto">
37 |         <PostCopyURL slug={author} />
38 |       </div>
39 |     </div>
40 |   );
41 | }
```

apps/website/src/components/post-copy-url.tsx
```
1 | "use client";
2 |
3 | import { Icons } from "@midday/ui/icons";
4 | import { motion } from "framer-motion";
5 | import { useState } from "react";
6 |
7 | export function PostCopyURL() {
8 |   const [isCopied, setCopied] = useState(false);
9 |
10 |   const handleClipboard = async () => {
11 |     try {
12 |       setCopied(true);
13 |
14 |       await navigator.clipboard.writeText(window.location.href);
15 |
16 |       setTimeout(() => {
17 |         setCopied(false);
18 |       }, 2000);
19 |     } catch {}
20 |   };
21 |
22 |   return (
23 |     <button
24 |       type="button"
25 |       onClick={handleClipboard}
26 |       className="relative flex space-x-2 items-center"
27 |     >
28 |       <motion.div
29 |         className="absolute -left-4 top-0.3"
30 |         initial={{ opacity: 1, scale: 1 }}
31 |         animate={{ opacity: isCopied ? 0 : 1, scale: isCopied ? 0 : 1 }}
32 |       >
33 |         <Icons.Copy />
34 |       </motion.div>
35 |
36 |       <motion.div
37 |         className="absolute -left-[24px] top-0.3"
38 |         initial={{ opacity: 0, scale: 0 }}
39 |         animate={{ opacity: isCopied ? 1 : 0, scale: isCopied ? 1 : 0 }}
40 |       >
41 |         <Icons.Check />
42 |       </motion.div>
43 |
44 |       <span className="text-xs">Copy link</span>
45 |     </button>
46 |   );
47 | }
```

apps/website/src/components/post-status.tsx
```
1 | export function PostStatus({ status }) {
2 |   return (
3 |     <div className="border rounded-full font-mono px-3 py-1.5 inline-block text-[11px] mb-4 text-[#878787]">
4 |       {status}
5 |     </div>
6 |   );
7 | }
```

apps/website/src/components/section-five.tsx
```
1 | "use client";
2 |
3 | import { motion } from "framer-motion";
4 | import vaultLight from "public/vault-light.png";
5 | import vaultDark from "public/vault.png";
6 | import { CtaLink } from "./cta-link";
7 | import { DynamicImage } from "./dynamic-image";
8 | import { ExportToast } from "./export-toast";
9 |
10 | export function SectionFive() {
11 |   return (
12 |     <section className="flex justify-between space-y-12 lg:space-y-0 lg:space-x-8 flex-col lg:flex-row overflow-hidden mb-12">
13 |       <div className="border border-border lg:basis-2/3 dark:bg-[#121212] p-10 flex lg:space-x-8 lg:flex-row flex-col-reverse lg:items-start group">
14 |         <DynamicImage
15 |           lightSrc={vaultLight}
16 |           darkSrc={vaultDark}
17 |           quality={90}
18 |           alt="Vault"
19 |           className="mt-8 lg:mt-0 basis-1/2 object-contain max-w-[70%] sm:max-w-[50%] md:max-w-[35%]"
20 |         />
21 |
22 |         <div className="flex flex-col basis-1/2 relative h-full">
23 |           <h4 className="font-medium text-xl md:text-2xl mb-4">Vault</h4>
24 |
25 |           <p className="text-[#878787] mb-4 text-sm">
26 |             Store your files securely in Midday.
27 |           </p>
28 |
29 |           <p className="text-[#878787] text-sm">
30 |             There’s no need to scramble for things across different drives. Keep
31 |             all of your files, such as contracts and agreements safe in one
32 |             place.
33 |           </p>
34 |
35 |           <div className="flex flex-col space-y-2 h-full">
36 |             <div className="flex space-x-2 items-center mt-8 text-sm">
37 |               <svg
38 |                 xmlns="http://www.w3.org/2000/svg"
39 |                 width={18}
40 |                 height={13}
41 |                 fill="none"
42 |               >
43 |                 <path
44 |                   fill="currentColor"
45 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
46 |                 />
47 |               </svg>
48 |               <span className="text-primary">
49 |                 Automatic classification of documents for easy search & find
50 |               </span>
51 |             </div>
52 |             <div className="flex space-x-2 items-center text-sm">
53 |               <svg
54 |                 xmlns="http://www.w3.org/2000/svg"
55 |                 width={18}
56 |                 height={13}
57 |                 fill="none"
58 |               >
59 |                 <path
60 |                   fill="currentColor"
61 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
62 |                 />
63 |               </svg>
64 |               <span className="text-primary">Smart search</span>
65 |             </div>
66 |
67 |             <div className="absolute bottom-0 left-0">
68 |               <CtaLink text="Centralize Your Files now" />
69 |             </div>
70 |           </div>
71 |         </div>
72 |       </div>
73 |
74 |       <div className="border border-border basis-1/3 dark:bg-[#121212] p-10 flex flex-col group">
75 |         <h4 className="font-medium text-xl md:text-2xl mb-4">
76 |           Seamless export
77 |         </h4>
78 |         <p className="text-[#878787] text-sm mb-8">
79 |           Take the hassle out of preparing exports for your accountant. Just
80 |           select any time period or transaction you want and hit export. We
81 |           package everything up neatly in a CSV file (accountants loves these)
82 |           clearly pointing to the right attachment.
83 |         </p>
84 |
85 |         <motion.div
86 |           initial={{ opacity: 0, y: 20 }}
87 |           whileInView={{ opacity: 1, y: 0 }}
88 |           viewport={{ once: true }}
89 |           transition={{ duration: 0.5 }}
90 |           className="mt-auto"
91 |         >
92 |           <ExportToast />
93 |         </motion.div>
94 |
95 |         <div className="mt-8 hidden md:flex">
96 |           <CtaLink text="Streamline your workflow" />
97 |         </div>
98 |       </div>
99 |     </section>
100 |   );
101 | }
```

apps/website/src/components/section-four.tsx
```
1 | "use client";
2 |
3 | import { motion } from "framer-motion";
4 | import inboxActionsLight from "public/inbox-actions-light.png";
5 | import inboxActionsDark from "public/inbox-actions.png";
6 | import inboxSuggestedLight from "public/inbox-suggested-light.png";
7 | import inboxSuggestedDark from "public/inbox-suggested.png";
8 | import invoiceCommentsLight from "public/invoice-comments-light.png";
9 | import invoiceCommentsDark from "public/invoice-comments.png";
10 | import invoiceToolbarLight from "public/invoice-toolbar-light.png";
11 | import invoiceToolbarDark from "public/invoice-toolbar.png";
12 | import invoicingLight from "public/invoicing-light.png";
13 | import invoicingDark from "public/invoicing.png";
14 | import { CtaLink } from "./cta-link";
15 | import { DynamicImage } from "./dynamic-image";
16 |
17 | export function SectionFour() {
18 |   return (
19 |     <section className="flex justify-between space-y-12 lg:space-y-0 lg:space-x-8 flex-col lg:flex-row overflow-hidden mb-12 relative">
20 |       <div className="border border-border md:basis-2/3 dark:bg-[#121212] p-10 flex justify-between md:space-x-8 md:flex-row flex-col group">
21 |         <div className="flex flex-col md:basis-1/2">
22 |           <h4 className="font-medium text-xl md:text-2xl mb-4">Invoicing</h4>
23 |
24 |           <p className="text-[#878787] md:mb-4 text-sm">
25 |             Create and send invoices to your customers, monitor your sent
26 |             balance, track overdue payments and send reminders.
27 |           </p>
28 |
29 |           <div className="flex flex-col space-y-2">
30 |             <div className="flex space-x-2 items-center mt-8 text-sm">
31 |               <svg
32 |                 xmlns="http://www.w3.org/2000/svg"
33 |                 width={18}
34 |                 height={13}
35 |                 fill="none"
36 |               >
37 |                 <path
38 |                   fill="currentColor"
39 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
40 |                 />
41 |               </svg>
42 |               <span className="text-primary">Create Customers</span>
43 |             </div>
44 |             <div className="flex space-x-2 items-center text-sm">
45 |               <svg
46 |                 xmlns="http://www.w3.org/2000/svg"
47 |                 width={18}
48 |                 height={13}
49 |                 fill="none"
50 |               >
51 |                 <path
52 |                   fill="currentColor"
53 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
54 |                 />
55 |               </svg>
56 |               <span className="text-primary">Add Vat & Sales tax</span>
57 |             </div>
58 |
59 |             <div className="flex space-x-2 items-center text-sm">
60 |               <svg
61 |                 xmlns="http://www.w3.org/2000/svg"
62 |                 width={18}
63 |                 height={13}
64 |                 fill="none"
65 |               >
66 |                 <path
67 |                   fill="currentColor"
68 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
69 |                 />
70 |               </svg>
71 |               <span className="text-primary">Add discount</span>
72 |             </div>
73 |
74 |             <div className="flex space-x-2 items-center text-sm">
75 |               <svg
76 |                 xmlns="http://www.w3.org/2000/svg"
77 |                 width={18}
78 |                 height={13}
79 |                 fill="none"
80 |               >
81 |                 <path
82 |                   fill="currentColor"
83 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
84 |                 />
85 |               </svg>
86 |               <span className="text-primary">Add Logo</span>
87 |             </div>
88 |
89 |             <div className="flex space-x-2 items-center text-sm">
90 |               <svg
91 |                 xmlns="http://www.w3.org/2000/svg"
92 |                 width={18}
93 |                 height={13}
94 |                 fill="none"
95 |               >
96 |                 <path
97 |                   fill="currentColor"
98 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
99 |                 />
100 |               </svg>
101 |               <span className="text-primary">Send web invoices</span>
102 |             </div>
103 |
104 |             <div className="flex space-x-2 items-center text-sm">
105 |               <svg
106 |                 xmlns="http://www.w3.org/2000/svg"
107 |                 width={18}
108 |                 height={13}
109 |                 fill="none"
110 |               >
111 |                 <path
112 |                   fill="currentColor"
113 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
114 |                 />
115 |               </svg>
[TRUNCATED]
```

apps/website/src/components/section-one.tsx
```
1 | export function SectionOne() {
2 |   return (
3 |     <section className="mt-24 md:mt-[200px] mb-12">
4 |       <h3 className="text-4xl md:text-8xl font-medium">Everything you need</h3>
5 |       <p className="mt-4 md:mt-8 text-[#878787]">
6 |         From automated receipt-to-transaction mapping to conversing with your
7 |         financials and consolidating all your files
8 |       </p>
9 |     </section>
10 |   );
11 | }
```

apps/website/src/components/section-seven.tsx
```
1 | import { TextGenerateEffect } from "@/components/text-generate-effect";
2 |
3 | export function SectionSeven() {
4 |   return (
5 |     <TextGenerateEffect
6 |       className="md:pt-28 pb-12 md:pb-32 text-4xl	md:text-6xl max-w-[1370px] container md:leading-[85px] mb-12"
7 |       words="Put the boring parts of running a business on autopilot. Midday helps you to streamline your month-end procedures, reduce manual work and easily package everything up for your accountant."
8 |     />
9 |   );
10 | }
```

apps/website/src/components/section-six.tsx
```
1 | import bgLight from "public/assistant-bg-light.png";
2 | import bg from "public/assistant-bg.png";
3 | import { Assistant } from "./assistant";
4 | import { DynamicImage } from "./dynamic-image";
5 | import { Tray } from "./tray";
6 |
7 | export function SectionSix() {
8 |   return (
9 |     <section
10 |       className="mt-[300px] mb-[250px] md:mt-24 md:mb-12 relative"
11 |       id="assistant"
12 |     >
13 |       <Tray />
14 |       <div className="absolute w-full h-full flex items-center justify-center flex-col top-8 xl:top-0">
15 |         <h4 className="text-4xl mb-4 font-medium md:text-white">Assistant</h4>
16 |         <p className="max-w-[790px] px-4 text-center text-sm md:text-white dark:text-[#878787] mb-12 md:mb-0">
17 |           Ask Midday anything and get tailored insights into your financial
18 |           situation. Understand your biggest outgoings and incomings to get a
19 |           better grasp on your financials to help you cut costs, find
20 |           opportunities and build a longer runway.
21 |         </p>
22 |
23 |         <div className="mt-6 hidden xl:block">
24 |           <svg
25 |             xmlns="http://www.w3.org/2000/svg"
26 |             width={139}
27 |             height={19}
28 |             fill="none"
29 |           >
30 |             <path
31 |               fill="white"
[TRUNCATED]
```

apps/website/src/components/section-stories.tsx
```
1 | "use client";
2 |
3 | import { Avatar } from "@midday/ui/avatar";
4 | import { AvatarImageNext } from "@midday/ui/avatar";
5 | import { Button } from "@midday/ui/button";
6 | import {
7 |   Dialog,
8 |   DialogContent,
9 |   DialogHeader,
10 |   DialogTitle,
11 |   DialogTrigger,
12 | } from "@midday/ui/dialog";
13 | import { Icons } from "@midday/ui/icons";
14 | import dynamic from "next/dynamic";
15 | import { useRef, useState } from "react";
16 | import { type Story, StoryCard } from "./story-card";
17 |
18 | const ReactHlsPlayer = dynamic(() => import("react-hls-player"), {
19 |   ssr: false,
20 | });
21 |
22 | const stories = [
23 |   {
24 |     id: 1,
25 |     title: "“We are now saving 1-2 man-days each month.”",
26 |     description:
27 |       "Due to improved invoice reconciliation, we are now saving 1-2 man-days each month, and we have a better understanding of our finances thanks to dashboards.",
28 |     name: "Paweł Michalski ",
29 |     company: "VC leaders",
30 |     country: "Poland",
31 |     src: "/stories/pawel.jpeg",
32 |     content: [
33 |       {
34 |         type: "heading",
35 |         content:
36 |           "VCLeaders is an educational platform for venture capitalists that helps them build better VC firms.  ",
37 |       },
38 |       {
39 |         type: "question",
40 |         content:
41 |           "What specific challenges were you facing in managing your business operations before using Midday?",
42 |       },
43 |       {
44 |         type: "paragraph",
45 |         content:
46 |           "We are a small, remote-first team. Each month, we face challenges when reconciling our invoices. We often struggle to track down missing invoices and ensure all payments are accounted for correctly. This manual process takes more than a full day of someone's time and can take even longer if we overlook anything. Not to mention, we didn’t have any time to categorize and analyze our spending properly.",
47 |       },
48 |       {
49 |         type: "question",
50 |         content:
51 |           "How has Midday impacted your workflow or productivity since you started using it? Can you share specific examples or metrics?",
52 |       },
53 |       {
54 |         type: "paragraph",
55 |         content:
56 |           "Due to improved invoice reconciliation, we are now saving 1-2 man-days each month, and we have a better understanding of our finances thanks to dashboards.",
57 |       },
58 |       {
59 |         type: "question",
60 |         content:
61 |           "What features or aspects of Midday AI do you find most valuable, and why?",
62 |       },
63 |       {
64 |         type: "paragraph",
65 |         content:
66 |           "This tool provides me with a clear overview of my finances, including accounts payable. The user interface is also clean, and the user experience is fantastic. Now, I can easily track all the invoices I receive and issue each month.",
67 |       },
68 |     ],
69 |   },
70 |   {
71 |     id: 2,
72 |     title:
73 |       "“Without Midday I would’ve sold my company and lost loads of money”",
74 |     name: "Guy Solan",
75 |     company: "Thetis Medical",
76 |     country: "United Kingdom",
77 |     src: "/stories/guy.jpeg",
78 |     video:
79 |       "https://customer-oh6t55xltlgrfayh.cloudflarestream.com/5b86803383964d52ee6834fd289f4f4e/manifest/video.m3u8",
80 |     content: [
81 |       {
82 |         type: "paragraph",
83 |         content:
84 |           "”Without Midday I would’ve sold my company and lost loads of money. I never had the time to learn Quickbooks or Xero so had no idea what the company cash was doing without ringing up my accountant.”",
85 |       },
86 |     ],
87 |   },
88 |   {
89 |     id: 3,
90 |     title: "“It has completely transformed how I manage my day-to-day tasks”",
91 |     description:
92 |       "From generating invoices to tracking projects and having all the information centralized in one place, the change has been remarkable.",
93 |     name: "Facu Montanaro",
94 |     company: "Kundo Studio",
95 |     country: "Argentina",
96 |     src: "/stories/facu.jpeg",
97 |     content: [
98 |       {
99 |         type: "heading",
100 |         content:
101 |           "At Kundo, I work alongside a talented team to empower clients in achieving successful fundraising, launching impactful products, and driving growth through design and meaningful experiences.",
102 |       },
103 |       {
104 |         type: "paragraph",
105 |         content:
106 |           "I’m Facu Montanaro, a freelance visual designer from Argentina, focused on crafting beautiful websites and interfaces. I collaborate with startups, founders, and companies to help them thrive.",
107 |       },
108 |       {
109 |         type: "question",
110 |         content:
111 |           "What specific challenges were you facing in managing your business operations before using Midday?",
112 |       },
113 |       {
114 |         type: "paragraph",
115 |         content:
[TRUNCATED]
```

apps/website/src/components/section-three.tsx
```
1 | "use client";
2 |
3 | import { CtaLink } from "@/components/cta-link";
4 | import { motion } from "framer-motion";
5 | import breakdownLight from "public/breakdown-light.png";
6 | import breakdownDark from "public/breakdown.png";
7 | import timeFormatLight from "public/time-format-light.png";
8 | import timeFormatDark from "public/time-format.png";
9 | import timetrackerLight from "public/time-tracker-light.png";
10 | import timetrackerDark from "public/time-tracker.png";
11 | import { DynamicImage } from "./dynamic-image";
12 |
13 | export function SectionThree() {
14 |   return (
15 |     <section className="relative mb-12 group">
16 |       <div className="border border-border container dark:bg-[#121212] p-8 md:p-10 md:pb-0 overflow-hidden">
17 |         <div className="flex flex-col md:space-x-12 md:flex-row">
18 |           <div className="xl:mt-6 md:max-w-[40%] md:mr-8 md:mb-8">
19 |             <h3 className="font-medium text-xl md:text-2xl mb-4">
20 |               Time track your projects
21 |             </h3>
22 |
23 |             <p className="text-[#878787] md:mb-4 text-sm">
24 |               Track your time, monitor project durations, set rates and create{" "}
25 |               <br />
26 |               invoices from your recorded hours.
27 |             </p>
28 |
29 |             <div className="flex flex-col space-y-2">
30 |               <div className="flex space-x-2 items-center mt-8 text-sm">
31 |                 <svg
32 |                   xmlns="http://www.w3.org/2000/svg"
33 |                   width={18}
34 |                   height={13}
35 |                   fill="none"
36 |                 >
37 |                   <path
38 |                     fill="currentColor"
39 |                     d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
40 |                   />
41 |                 </svg>
42 |                 <span className="text-primary">
43 |                   Get a monthly overview of tracked hours
44 |                 </span>
45 |               </div>
46 |               <div className="flex space-x-2 items-center text-sm">
47 |                 <svg
48 |                   xmlns="http://www.w3.org/2000/svg"
49 |                   width={18}
50 |                   height={13}
51 |                   fill="none"
52 |                 >
53 |                   <path
54 |                     fill="currentColor"
55 |                     d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
56 |                   />
57 |                 </svg>
58 |                 <span className="text-primary">
59 |                   Set billable rate & time estimates
60 |                 </span>
61 |               </div>
62 |
63 |               <div className="flex space-x-2 items-center text-sm">
64 |                 <svg
65 |                   xmlns="http://www.w3.org/2000/svg"
66 |                   width={18}
67 |                   height={13}
68 |                   fill="none"
69 |                 >
70 |                   <path
71 |                     fill="currentColor"
72 |                     d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
73 |                   />
74 |                 </svg>
75 |                 <span className="text-primary">
76 |                   See billable amount & monthly breakdown
77 |                 </span>
78 |               </div>
79 |
80 |               <div className="flex space-x-2 items-center text-sm">
81 |                 <svg
82 |                   xmlns="http://www.w3.org/2000/svg"
83 |                   width={18}
84 |                   height={13}
85 |                   fill="none"
86 |                 >
87 |                   <path
88 |                     fill="currentColor"
89 |                     d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
90 |                   />
91 |                 </svg>
92 |                 <span className="text-primary">
93 |                   Create invoice based on recorded time
94 |                 </span>
95 |               </div>
96 |
97 |               <div className="flex space-x-2 items-center text-sm">
98 |                 <svg
99 |                   xmlns="http://www.w3.org/2000/svg"
100 |                   width={18}
101 |                   height={13}
102 |                   fill="none"
103 |                 >
104 |                   <path
105 |                     fill="currentColor"
106 |                     d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
107 |                   />
108 |                 </svg>
109 |                 <span className="text-primary">Export as CSV</span>
110 |               </div>
111 |             </div>
112 |
113 |             <div className="absolute bottom-6">
114 |               <CtaLink text="Start tracking time now" />
115 |             </div>
116 |           </div>
117 |
118 |           <div className="relative mt-8 md:mt-0">
119 |             <motion.div
120 |               initial={{ opacity: 0, y: 20 }}
121 |               whileInView={{ opacity: 1, y: 0 }}
122 |               transition={{ duration: 0.3, delay: 0.7 }}
123 |               viewport={{ once: true }}
[TRUNCATED]
```

apps/website/src/components/section-two.tsx
```
1 | import computerLight from "public/computer-light.png";
2 | import computerDark from "public/computer.png";
3 | import { CtaLink } from "./cta-link";
4 | import { DynamicImage } from "./dynamic-image";
5 |
6 | export function SectionTwo() {
7 |   return (
8 |     <section className="border border-border container dark:bg-[#121212] lg:pb-0 overflow-hidden mb-12 group">
9 |       <div className="flex flex-col lg:space-x-12 lg:flex-row">
10 |         <DynamicImage
11 |           lightSrc={computerLight}
12 |           darkSrc={computerDark}
13 |           height={446}
14 |           width={836}
15 |           className="-mb-[1px] object-contain lg:w-1/2"
16 |           alt="Overview"
17 |           quality={90}
18 |         />
19 |
20 |         <div className="xl:mt-6 lg:max-w-[40%] md:ml-8 md:mb-8 flex flex-col justify-center p-8 md:pl-0 relative">
21 |           <h3 className="font-medium text-xl md:text-2xl mb-4">
22 |             Financial overview
23 |           </h3>
24 |
25 |           <p className="text-[#878787] mb-8 lg:mb-4 text-sm">
26 |             Bring your own bank. We connect to over 20 000+ banks in 33
27 |             countries across US, Canada, UK and Europe. Keep tabs on your
28 |             expenses and income, and gain a clearer picture of your business's
29 |             financial track record and current situation.
30 |           </p>
31 |
32 |           <div className="flex flex-col space-y-2">
33 |             <div className="flex space-x-2 items-center ">
34 |               <svg
35 |                 xmlns="http://www.w3.org/2000/svg"
36 |                 width={18}
37 |                 height={13}
38 |                 fill="none"
39 |               >
40 |                 <path
41 |                   fill="currentColor"
42 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
43 |                 />
44 |               </svg>
45 |               <span className="text-primary text-sm">Revenue</span>
46 |             </div>
47 |
48 |             <div className="flex space-x-2 items-center">
49 |               <svg
50 |                 xmlns="http://www.w3.org/2000/svg"
51 |                 width={18}
52 |                 height={13}
53 |                 fill="none"
54 |               >
55 |                 <path
56 |                   fill="currentColor"
57 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
58 |                 />
59 |               </svg>
60 |               <span className="text-primary text-sm">Profit & Loss</span>
61 |             </div>
62 |
63 |             <div className="flex space-x-2 items-center">
64 |               <svg
65 |                 xmlns="http://www.w3.org/2000/svg"
66 |                 width={18}
67 |                 height={13}
68 |                 fill="none"
69 |               >
70 |                 <path
71 |                   fill="currentColor"
72 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
73 |                 />
74 |               </svg>
75 |               <span className="text-primary text-sm">Burnrate</span>
76 |             </div>
77 |
78 |             <div className="flex space-x-2 items-center">
79 |               <svg
80 |                 xmlns="http://www.w3.org/2000/svg"
81 |                 width={18}
82 |                 height={13}
83 |                 fill="none"
84 |               >
85 |                 <path
86 |                   fill="currentColor"
87 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
88 |                 />
89 |               </svg>
90 |               <span className="text-primary text-sm">Expenses</span>
91 |             </div>
92 |
93 |             <div className="flex space-x-2 items-center">
94 |               <svg
95 |                 xmlns="http://www.w3.org/2000/svg"
96 |                 width={18}
97 |                 height={13}
98 |                 fill="none"
99 |               >
100 |                 <path
101 |                   fill="currentColor"
102 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
103 |                 />
104 |               </svg>
105 |               <span className="text-primary text-sm">
106 |                 Unified currency overview across all your accounts
107 |               </span>
108 |             </div>
109 |
110 |             <div className="flex space-x-2 items-center">
111 |               <svg
112 |                 xmlns="http://www.w3.org/2000/svg"
113 |                 width={18}
114 |                 height={13}
115 |                 fill="none"
116 |               >
117 |                 <path
118 |                   fill="currentColor"
119 |                   d="M6.55 13 .85 7.3l1.425-1.425L6.55 10.15 15.725.975 17.15 2.4 6.55 13Z"
120 |                 />
121 |               </svg>
122 |               <span className="text-primary text-sm">Shareable reports</span>
123 |             </div>
[TRUNCATED]
```

apps/website/src/components/section-video.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Icons } from "@midday/ui/icons";
5 | import { motion } from "framer-motion";
6 | import dynamic from "next/dynamic";
7 | import { useRef, useState } from "react";
8 |
9 | const ReactHlsPlayer = dynamic(() => import("react-hls-player"), {
10 |   ssr: false,
11 | });
12 |
13 | export function SectionVideo() {
14 |   const playerRef = useRef(undefined);
15 |   const [isPlaying, setPlaying] = useState(false);
16 |   const [isMuted, setMuted] = useState(true);
17 |
18 |   const togglePlay = () => {
19 |     if (isPlaying) {
20 |       playerRef.current?.pause();
21 |     } else {
22 |       playerRef.current?.play();
23 |     }
24 |
25 |     setPlaying((prev) => !prev);
26 |   };
27 |
28 |   const toggleMute = () => {
29 |     setMuted((prev) => !prev);
30 |   };
31 |
32 |   return (
33 |     <motion.div
34 |       className="flex flex-col justify-center container pb-20"
35 |       onViewportLeave={() => {
36 |         playerRef.current?.pause();
37 |         setPlaying(false);
38 |       }}
39 |     >
40 |       <div className="relative">
41 |         {isPlaying && (
42 |           <div className="absolute md:top-12 md:right-12 top-4 right-4 space-x-4 items-center justify-center z-30 transition-all">
43 |             <Button
44 |               size="icon"
45 |               className="rounded-full size-10 md:size-14 transition ease-in-out hover:scale-110 hover:bg-white bg-white"
46 |               onClick={toggleMute}
47 |             >
48 |               {isMuted ? (
49 |                 <Icons.Mute size={24} className="text-black" />
50 |               ) : (
51 |                 <Icons.UnMute size={24} className="text-black" />
52 |               )}
53 |             </Button>
54 |           </div>
55 |         )}
56 |
57 |         {!isPlaying && (
58 |           <div className="absolute md:top-12 md:right-12 top-4 right-4 space-x-4 items-center justify-center z-30 transition-all">
59 |             <Button
60 |               size="icon"
61 |               className="rounded-full size-10 md:size-14 transition ease-in-out hover:scale-110 hover:bg-white bg-white"
62 |               onClick={togglePlay}
63 |             >
64 |               <Icons.Play size={24} className="text-black" />
65 |             </Button>
66 |           </div>
67 |         )}
68 |
69 |         <ReactHlsPlayer
70 |           onEnded={() => playerRef.current?.load()}
71 |           onClick={togglePlay}
72 |           src="https://customer-oh6t55xltlgrfayh.cloudflarestream.com/306702a5d5efbba0e9bcdd7cb17e9c5a/manifest/video.m3u8"
73 |           autoPlay={false}
74 |           poster="https://cdn.midday.ai/poster.webp"
75 |           playerRef={playerRef}
76 |           className="w-full"
77 |           muted={isMuted}
78 |         />
79 |       </div>
80 |     </motion.div>
81 |   );
82 | }
```

apps/website/src/components/social-links.tsx
```
1 | import { FaGithub } from "react-icons/fa";
2 | import { FaLinkedinIn, FaProductHunt, FaYoutube } from "react-icons/fa";
3 | import { FaXTwitter } from "react-icons/fa6";
4 | import { FaDiscord } from "react-icons/fa6";
5 |
6 | export function SocialLinks() {
7 |   return (
8 |     <ul className="flex space-x-4 items-center md:ml-5">
9 |       <li>
10 |         <a target="_blank" rel="noreferrer" href="https://go.midday.ai/lS72Toq">
11 |           <span className="sr-only">Twitter</span>
12 |           <FaXTwitter size={22} className="fill-[#878787]" />
13 |         </a>
14 |       </li>
15 |       <li>
16 |         <a target="_blank" rel="noreferrer" href="https://go.midday.ai/7rhA3rz">
17 |           <span className="sr-only">Producthunt</span>
18 |           <FaProductHunt size={22} className="fill-[#878787]" />
19 |         </a>
20 |       </li>
21 |       <li>
22 |         <a target="_blank" rel="noreferrer" href="https://go.midday.ai/anPiuRx">
23 |           <span className="sr-only">Discord</span>
24 |           <FaDiscord size={24} className="fill-[#878787]" />
25 |         </a>
26 |       </li>
27 |       <li>
28 |         <a target="_blank" rel="noreferrer" href="https://git.new/midday">
29 |           <span className="sr-only">Github</span>
30 |           <FaGithub size={22} className="fill-[#878787]" />
31 |         </a>
32 |       </li>
33 |       <li>
34 |         <a target="_blank" rel="noreferrer" href="https://go.midday.ai/Ct3xybK">
35 |           <span className="sr-only">LinkedIn</span>
36 |           <FaLinkedinIn size={22} className="fill-[#878787]" />
37 |         </a>
38 |       </li>
39 |       <li>
40 |         <a target="_blank" rel="noreferrer" href="https://go.midday.ai/0yq8rfn">
41 |           <span className="sr-only">Youtube</span>
42 |           <FaYoutube size={22} className="fill-[#878787]" />
43 |         </a>
44 |       </li>
45 |     </ul>
46 |   );
47 | }
```

apps/website/src/components/startpage.tsx
```
1 | import { Hero } from "@/components/hero";
2 | import { SectionFive } from "@/components/section-five";
3 | import { SectionFour } from "@/components/section-four";
4 | import { SectionOne } from "@/components/section-one";
5 | import { SectionSeven } from "@/components/section-seven";
6 | import { SectionSix } from "@/components/section-six";
7 | import { SectionThree } from "@/components/section-three";
8 | import { SectionTwo } from "@/components/section-two";
9 | import { Testimonials } from "@/components/testimonials";
10 | import SectionStories from "./section-stories";
11 | import { SectionVideo } from "./section-video";
12 |
13 | export function StartPage() {
14 |   return (
15 |     <>
16 |       <Hero />
17 |       <SectionStories />
18 |       <SectionOne />
19 |       <SectionTwo />
20 |       <SectionThree />
21 |       <SectionFour />
22 |       <SectionFive />
23 |       <SectionSix />
24 |       <SectionSeven />
25 |       <SectionVideo />
26 |       <Testimonials />
27 |     </>
28 |   );
29 | }
```

apps/website/src/components/status-widget.tsx
```
1 | "use client";
2 |
3 | import { fetchStatus } from "@/actions/fetch-status";
4 | import { cn } from "@midday/ui/cn";
5 | import { useEffect, useState } from "react";
6 |
7 | export function StatusWidget() {
8 |   const [status, setStatus] = useState("operational");
9 |
10 |   useEffect(() => {
11 |     async function fetchData() {
12 |       try {
13 |         const response = await fetchStatus();
14 |
15 |         if (response) {
16 |           setStatus(response);
17 |         }
18 |       } catch {}
19 |     }
20 |
21 |     fetchData();
22 |   }, []);
23 |
24 |   const getStatusLevel = (level) => {
25 |     return {
26 |       operational: {
27 |         label: "Operational",
28 |         color: "bg-green-500",
29 |         color2: "bg-green-400",
30 |       },
31 |       degraded_performance: {
32 |         label: "Degraded Performance",
33 |         color: "bg-yellow-500",
34 |         color2: "bg-yellow-400",
35 |       },
36 |       partial_outage: {
37 |         label: "Partial Outage",
38 |         color: "bg-yellow-500",
39 |         color2: "bg-yellow-400",
40 |       },
41 |       major_outage: {
42 |         label: "Major Outage",
43 |         color: "bg-red-500",
44 |         color2: "bg-red-400",
45 |       },
46 |       unknown: {
47 |         label: "Unknown",
48 |         color: "bg-gray-500",
49 |         color2: "bg-gray-400",
50 |       },
51 |       incident: {
52 |         label: "Incident",
53 |         color: "bg-yellow-500",
54 |         color2: "bg-yellow-400",
55 |       },
56 |       under_maintenance: {
57 |         label: "Under Maintenance",
58 |         color: "bg-gray-500",
59 |         color2: "bg-gray-400",
60 |       },
61 |     }[level];
62 |   };
63 |
64 |   const level = getStatusLevel(status);
65 |
66 |   if (!level) {
67 |     return null;
68 |   }
69 |
70 |   return (
71 |     <a
72 |       className="flex justify-between space-x-2 items-center w-full border border-border rounded-full px-3 py-1.5"
73 |       href="https://midday.openstatus.dev"
74 |       target="_blank"
75 |       rel="noreferrer"
76 |     >
77 |       <div>
78 |         <p className="text-xs font-mono">{level.label}</p>
79 |       </div>
80 |
81 |       <span className="relative ml-auto flex h-1.5 w-1.5">
82 |         <span
83 |           className={cn(
84 |             "animate-ping absolute inline-flex h-full w-full rounded-full opacity-75",
85 |             level.color2
86 |           )}
87 |         />
88 |         <span
89 |           className={cn(
90 |             "relative inline-flex rounded-full h-1.5 w-1.5",
91 |             level.color
92 |           )}
93 |         />
94 |       </span>
95 |     </a>
96 |   );
97 | }
```

apps/website/src/components/story-card.tsx
```
1 | "use client";
2 |
3 | import { Avatar, AvatarImageNext } from "@midday/ui/avatar";
4 | import { Icons } from "@midday/ui/icons";
5 |
6 | export type Story = {
7 |   id: number;
8 |   title: string;
9 |   description: string;
10 |   name: string;
11 |   company: string;
12 |   country: string;
13 |   src: string;
14 |   video?: string;
15 | };
16 |
17 | export function StoryCard({
18 |   title,
19 |   description,
20 |   name,
21 |   company,
22 |   country,
23 |   src,
24 |   video,
25 | }: Story) {
26 |   return (
27 |     <div className="w-[300px] cursor-pointer">
28 |       <div className="p-6 bg-background border border-border">
29 |         {video && (
30 |           <div className="flex items-center justify-center size-8 bg-primary rounded-full mb-2">
31 |             <Icons.Play size={16} className="text-background" />
32 |           </div>
33 |         )}
34 |         <h3 className="text-lg font-medium mb-2">{title}</h3>
35 |         <p className="text-sm text-[#878787]">{description}</p>
36 |
37 |         <div className="mt-4">
38 |           <div className="flex items-center gap-2 mb-1">
39 |             <Avatar className="size-4">
40 |               <AvatarImageNext src={src} alt={name} width={16} height={16} />
41 |             </Avatar>
42 |             <p className="text-sm">{name}</p>
43 |           </div>
44 |
45 |           <div className="flex items-center gap-2 text-[#878787]">
46 |             <p className="text-sm text-[#878787]">{company}</p> •
47 |             <p className="text-sm text-[#878787]">{country}</p>
48 |           </div>
49 |         </div>
50 |       </div>
51 |     </div>
52 |   );
53 | }
```

apps/website/src/components/subscribe-input.tsx
```
1 | "use client";
2 |
3 | import { subscribeAction } from "@/actions/subscribe-action";
4 | import { Loader2 } from "lucide-react";
5 | import { useState } from "react";
6 | import { useFormStatus } from "react-dom";
7 |
8 | function SubmitButton() {
9 |   const { pending } = useFormStatus();
10 |
11 |   if (pending) {
12 |     return (
13 |       <div className="absolute top-1 right-0">
14 |         <Loader2 className="absolute w-4 h-4 mr-3 text-base animate-spin top-2.5 right-2" />
15 |       </div>
16 |     );
17 |   }
18 |
19 |   return (
20 |     <button
21 |       type="submit"
22 |       className="absolute right-2 h-7 bg-primary top-2 px-4 font-medium text-sm z-10 text-primary-foreground"
23 |     >
24 |       Subscribe
25 |     </button>
26 |   );
27 | }
28 |
29 | export function SubscribeInput() {
30 |   const [isSubmitted, setSubmitted] = useState(false);
31 |
32 |   return (
33 |     <div>
34 |       <div className="flex justify-center">
35 |         {isSubmitted ? (
36 |           <div className="border border-[#2C2C2C] font-sm text-primary h-11 w-[330px] flex items-center py-1 px-3 justify-between">
37 |             <p>Subscribed</p>
38 |
39 |             <svg
40 |               width="17"
41 |               height="17"
42 |               fill="none"
43 |               xmlns="http://www.w3.org/2000/svg"
44 |             >
45 |               <title>Check</title>
46 |               <path
47 |                 d="m14.546 4.724-8 8-3.667-3.667.94-.94 2.727 2.72 7.06-7.053.94.94Z"
48 |                 fill="#fff"
49 |               />
50 |             </svg>
51 |           </div>
52 |         ) : (
53 |           <form
54 |             action={async (formData) => {
55 |               setSubmitted(true);
56 |               await subscribeAction(formData);
57 |
58 |               setTimeout(() => {
59 |                 setSubmitted(false);
60 |               }, 5000);
61 |             }}
62 |           >
63 |             <fieldset className="relative">
64 |               <input
65 |                 placeholder="Enter your email"
66 |                 type="email"
67 |                 name="email"
68 |                 id="email"
69 |                 autoComplete="email"
70 |                 aria-label="Email address"
71 |                 required
72 |                 className="bg-transparent font-sm text-primary outline-none py-1 px-3 w-[360px] placeholder-[#606060] h-11 border border-border"
73 |               />
74 |               <SubmitButton />
75 |             </fieldset>
76 |           </form>
77 |         )}
78 |       </div>
79 |     </div>
80 |   );
81 | }
```

apps/website/src/components/support-form.tsx
```
1 | "use client";
2 |
3 | import { sendSupportSchema } from "@/actions/schema";
4 | import { sendSupportAction } from "@/actions/send-support-action";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Form,
9 |   FormControl,
10 |   FormField,
11 |   FormItem,
12 |   FormLabel,
13 |   FormMessage,
14 | } from "@midday/ui/form";
15 | import { Input } from "@midday/ui/input";
16 | import {
17 |   Select,
18 |   SelectContent,
19 |   SelectItem,
20 |   SelectTrigger,
21 |   SelectValue,
22 | } from "@midday/ui/select";
23 | import { Textarea } from "@midday/ui/textarea";
24 | import { useToast } from "@midday/ui/use-toast";
25 | import { Loader2 } from "lucide-react";
26 | import { useAction } from "next-safe-action/hooks";
27 | import { useForm } from "react-hook-form";
28 | import type { z } from "zod";
29 |
30 | export function SupportForm() {
31 |   const { toast } = useToast();
32 |
33 |   const form = useForm<z.infer<typeof sendSupportSchema>>({
34 |     resolver: zodResolver(sendSupportSchema),
35 |     defaultValues: {
36 |       email: "",
37 |       fullName: "",
38 |       subject: "",
39 |       type: "",
40 |       priority: "",
41 |       message: "",
42 |     },
43 |   });
44 |
45 |   const sendSupport = useAction(sendSupportAction, {
46 |     onSuccess: () => {
47 |       toast({
48 |         duration: 2500,
49 |         title: "Support ticket sent.",
50 |         variant: "success",
51 |       });
52 |
53 |       form.reset();
54 |     },
55 |     onError: () => {
56 |       toast({
57 |         duration: 3500,
58 |         variant: "error",
59 |         title: "Something went wrong pleaase try again.",
60 |       });
61 |     },
62 |   });
63 |
64 |   return (
65 |     <Form {...form}>
66 |       <form
67 |         onSubmit={form.handleSubmit(sendSupport.execute)}
68 |         className="space-y-8"
69 |       >
70 |         <div className="flex space-x-4">
71 |           <FormField
72 |             control={form.control}
73 |             name="email"
74 |             render={({ field }) => (
75 |               <FormItem className="w-full">
76 |                 <FormLabel>Email</FormLabel>
77 |                 <FormControl>
78 |                   <Input placeholder="Email" type="email" {...field} />
79 |                 </FormControl>
80 |                 <FormMessage />
81 |               </FormItem>
82 |             )}
83 |           />
84 |
85 |           <FormField
86 |             control={form.control}
87 |             name="fullName"
88 |             render={({ field }) => (
89 |               <FormItem className="w-full">
90 |                 <FormLabel>Full Name</FormLabel>
91 |                 <FormControl>
92 |                   <Input placeholder="John Doe" {...field} />
93 |                 </FormControl>
94 |                 <FormMessage />
95 |               </FormItem>
96 |             )}
97 |           />
98 |         </div>
99 |
100 |         <FormField
101 |           control={form.control}
102 |           name="subject"
103 |           render={({ field }) => (
104 |             <FormItem>
105 |               <FormLabel>Subject</FormLabel>
106 |               <FormControl>
107 |                 <Input
108 |                   placeholder="Summary of the problem you have"
109 |                   {...field}
110 |                 />
111 |               </FormControl>
112 |               <FormMessage />
113 |             </FormItem>
114 |           )}
115 |         />
116 |
117 |         <div className="flex space-x-4">
118 |           <FormField
119 |             control={form.control}
120 |             name="type"
121 |             render={({ field }) => (
122 |               <FormItem className="w-full">
123 |                 <FormLabel>Product</FormLabel>
124 |                 <Select
125 |                   onValueChange={field.onChange}
126 |                   defaultValue={field.value}
127 |                 >
128 |                   <FormControl>
129 |                     <SelectTrigger>
130 |                       <SelectValue placeholder="Select Product" />
131 |                     </SelectTrigger>
132 |                   </FormControl>
133 |                   <SelectContent>
134 |                     <SelectItem value="Transactions">Transactions</SelectItem>
135 |                     <SelectItem value="Vault">Vault</SelectItem>
136 |                     <SelectItem value="Inbox">Inbox</SelectItem>
137 |                     <SelectItem value="Invoicing">Invoicing</SelectItem>
138 |                     <SelectItem value="Tracker">Tracker</SelectItem>
139 |                     <SelectItem value="AI">AI</SelectItem>
140 |                     <SelectItem value="General">General</SelectItem>
141 |                   </SelectContent>
142 |                 </Select>
143 |                 <FormMessage />
144 |               </FormItem>
145 |             )}
146 |           />
147 |           <FormField
148 |             control={form.control}
149 |             name="priority"
150 |             render={({ field }) => (
151 |               <FormItem className="w-full">
152 |                 <FormLabel>Severity</FormLabel>
153 |                 <Select
154 |                   onValueChange={field.onChange}
155 |                   defaultValue={field.value}
156 |                 >
157 |                   <FormControl>
158 |                     <SelectTrigger>
159 |                       <SelectValue placeholder="Select severity" />
160 |                     </SelectTrigger>
161 |                   </FormControl>
162 |                   <SelectContent>
163 |                     <SelectItem value="low">Low</SelectItem>
164 |                     <SelectItem value="normal">Normal</SelectItem>
165 |                     <SelectItem value="high">High</SelectItem>
166 |                     <SelectItem value="urgent">Urgent</SelectItem>
167 |                   </SelectContent>
168 |                 </Select>
169 |                 <FormMessage />
170 |               </FormItem>
171 |             )}
172 |           />
173 |         </div>
174 |
175 |         <FormField
176 |           control={form.control}
177 |           name="message"
178 |           render={({ field }) => (
179 |             <FormItem>
180 |               <FormLabel>Message</FormLabel>
181 |               <FormControl>
182 |                 <Textarea
183 |                   placeholder="Describe the issue you're facing, along with any relevant information. Please be as detailed and specific as possible."
184 |                   className="resize-none min-h-[150px]"
[TRUNCATED]
```

apps/website/src/components/testimonials.tsx
```
1 | import { InfiniteMovingCards } from "@/components/infinite-moving-cards";
2 |
3 | const testimonials = [
4 |   {
5 |     name: "Lucas Grey",
6 |     avatarUrl:
7 |       "https://pbs.twimg.com/profile_images/1843079229073981440/pQqZJX5G_400x400.jpg",
8 |     handle: "@ImLucasGrey",
9 |     verified: true,
10 |     quote: "This is so ingenious and good!",
11 |   },
12 |   {
13 |     name: "Patrick Tobler",
14 |     avatarUrl:
15 |       "https://pbs.twimg.com/profile_images/1821352126406127616/We8itUSn_400x400.jpg",
16 |     handle: "@Padierfind",
17 |     verified: true,
18 |     quote: "I love this",
19 |   },
20 |   {
21 |     name: "Ben Tossell",
22 |     avatarUrl:
23 |       "https://pbs.twimg.com/profile_images/1595060668897677314/pHMUc1Zb_400x400.jpg",
24 |     handle: "@bentossell",
25 |     verified: true,
26 |     quote:
27 |       "well, an actually enjoyable way to organise my whole in and out of my business, plus highlighted a bunch of things I need to cancel",
28 |   },
29 |   {
30 |     name: "Christian Alares",
31 |     avatarUrl:
32 |       "https://pbs.twimg.com/profile_images/1194368464946974728/1D2biimN_400x400.jpg",
33 |     handle: "@c_alares",
34 |     verified: true,
35 |     quote: "Omg, this is so cool!",
36 |   },
37 |   {
38 |     name: "Zeno Rocha",
39 |     avatarUrl:
40 |       "https://pbs.twimg.com/profile_images/1792735373887696896/Nys5Q2b3_400x400.jpg",
41 |     handle: "@zenorocha",
42 |     verified: true,
43 |     quote: "this is absolutely amazing",
44 |   },
45 |   {
46 |     name: "Bailey Simrell",
47 |     avatarUrl:
48 |       "https://pbs.twimg.com/profile_images/1488962358609330178/tdTC7o6M_400x400.jpg",
49 |     handle: "@baileysimrell",
50 |     verified: true,
51 |     quote: "Awesome man, looks amazing 🔥",
52 |   },
53 |   {
54 |     name: "Darshan Gajara",
55 |     handle: "@WeirdoWizard",
56 |     verified: false,
57 |     quote: "No sweat! Your smooth integration with banking data blew me away.",
58 |     avatarUrl:
59 |       "https://pbs.twimg.com/profile_images/1117472858836434944/FbWce7CZ_400x400.jpg",
60 |   },
61 |   {
62 |     name: "Cal.com",
63 |     avatarUrl:
64 |       "https://pbs.twimg.com/profile_images/1839412200760610816/Lce29ADc_400x400.jpg",
65 |     handle: "@calcom",
66 |     verified: true,
67 |     quote: "We love @middayai 🖤",
68 |   },
69 |   {
70 |     name: "Guillermo Rauch",
71 |     avatarUrl:
72 |       "https://pbs.twimg.com/profile_images/1783856060249595904/8TfcCN0r_400x400.jpg",
73 |     handle: "@rauchg",
74 |     verified: true,
75 |     quote:
76 |       "nice to see @middayai generative ui features built on @vercel AI sdk midday is becoming one of the best OSS @nextjs real-world apps",
77 |   },
78 |   {
79 |     name: "Kyle @ KyTech",
80 |     avatarUrl:
81 |       "https://pbs.twimg.com/profile_images/1586538348964978689/nkpJWZxG_400x400.png",
82 |     handle: "@KyTechInc",
83 |     verified: true,
84 |     quote: "so ready! 🙌",
85 |   },
86 |   {
87 |     name: "Steven Tey",
88 |     avatarUrl:
89 |       "https://pbs.twimg.com/profile_images/1506792347840888834/dS-r50Je_400x400.jpg",
90 |     handle: "@steventey",
91 |     verified: true,
92 |     quote: `Just found my new favorite open-source project → http://midday.ai
93 |
94 |     It's a modern layer on top of Quickbooks/Xero that lets you automate the tedious accounting aspects of your business and focus on what matters – your product.
95 |
96 |     Built by the 🐐s
97 |     @pontusab
98 |      +
99 |     @viktorhofte
100 |      👏`,
101 |   },
102 |   {
103 |     name: "Gokul",
104 |     avatarUrl:
105 |       "https://pbs.twimg.com/profile_images/1805103400549318656/EEQpiO7e_400x400.jpg",
106 |     handle: "@KyTechInc",
107 |     verified: true,
108 |     quote: "🖤 Awesome work. just love it.",
109 |   },
110 |   {
111 |     name: "Peer Richelsen — oss/acc",
112 |     avatarUrl:
113 |       "https://pbs.twimg.com/profile_images/1816814706000080897/uSIidPHz_400x400.png",
114 |     handle: "@peer_rich",
115 |     verified: true,
116 |     quote:
117 |       "the best thing i couldve done as a founder is build something that helps other founders. so proud 🖤 @middayai",
118 |   },
119 | ];
120 |
121 | export function Testimonials() {
122 |   return (
123 |     <div className="relative pb-22">
124 |       <h3 className="text-4xl mb-8 font-medium">What people say</h3>
125 |       <InfiniteMovingCards items={testimonials} direction="left" speed="slow" />
126 |     </div>
127 |   );
128 | }
```

apps/website/src/components/text-generate-effect.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { motion, stagger, useAnimate } from "framer-motion";
5 |
6 | export const TextGenerateEffect = ({
7 |   words,
8 |   className,
9 | }: {
10 |   words: string;
11 |   className?: string;
12 | }) => {
13 |   const [scope, animate] = useAnimate();
14 |   const wordsArray = words.split(" ");
15 |
16 |   const renderWords = () => {
17 |     return (
18 |       <motion.div ref={scope}>
19 |         {wordsArray.map((word, idx) => {
20 |           return (
21 |             <motion.span
22 |               key={word + idx.toString()}
23 |               className="text-primary opacity-0"
24 |             >
25 |               {word}{" "}
26 |             </motion.span>
27 |           );
28 |         })}
29 |       </motion.div>
30 |     );
31 |   };
32 |
33 |   return (
34 |     <motion.div
35 |       onViewportEnter={() => {
36 |         animate(
37 |           "span",
38 |           {
39 |             opacity: 1,
40 |           },
41 |           {
42 |             duration: 1,
43 |             delay: stagger(0.13),
44 |           },
45 |         );
46 |       }}
47 |       className={cn("text-center font-medium", className)}
48 |     >
49 |       {renderWords()}
50 |     </motion.div>
51 |   );
52 | };
```

apps/website/src/components/theme-provider.tsx
```
1 | "use client";
2 |
3 | import { ThemeProvider as NextThemesProvider } from "next-themes";
4 | import * as React from "react";
5 |
6 | type ThemeProviderProps = Parameters<typeof NextThemesProvider>[0];
7 |
8 | export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
9 |   return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
10 | }
```

apps/website/src/components/ticker.tsx
```
1 | import type { Database } from "@midday/supabase/types";
2 | import { createServerClient } from "@supabase/ssr";
3 | import Link from "next/link";
4 |
5 | const currency = "USD";
6 |
7 | export async function Ticker() {
8 |   const client = createServerClient<Database>(
9 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
10 |     process.env.SUPABASE_SERVICE_KEY!,
11 |     {
12 |       cookies: {
13 |         get() {
14 |           return null;
15 |         },
16 |         set() {
17 |           return null;
18 |         },
19 |         remove() {
20 |           return null;
21 |         },
22 |       },
23 |     },
24 |   );
25 |
26 |   const [
27 |     { data: totalSum },
28 |     { count: businessCount },
29 |     { count: transactionCount },
30 |   ] = await Promise.all([
31 |     client.rpc("calculate_total_sum", {
32 |       target_currency: currency,
33 |     }),
34 |     client.from("teams").select("id", { count: "exact", head: true }).limit(1),
35 |     client
36 |       .from("transactions")
37 |       .select("id", { count: "exact", head: true })
38 |       .limit(1),
39 |   ]);
40 |
41 |   return (
42 |     <div className="text-center flex flex-col mt-[120px] md:mt-[280px] mb-[120px] md:mb-[250px] space-y-4 md:space-y-10">
43 |       <span className="font-medium font-mono text-center text-[40px] md:text-[80px] lg:text-[100px] xl:text-[130px] 2xl:text-[160px] md:mb-2 text-stroke leading-none">
44 |         {Intl.NumberFormat("en-US", {
45 |           style: "currency",
46 |           currency: currency,
47 |           maximumFractionDigits: 0,
48 |         }).format(totalSum ?? 0)}
49 |       </span>
50 |       <span className="text-[#878787]">
51 |         Through our system{" "}
52 |         <Link href="/open-startup" className="underline">
53 |           {Intl.NumberFormat("en-US", {
54 |             maximumFractionDigits: 0,
55 |           }).format(transactionCount ?? 0)}
56 |         </Link>{" "}
57 |         transactions across{" "}
58 |         <Link href="/open-startup" className="underline">
59 |           {Intl.NumberFormat("en-US", {
60 |             maximumFractionDigits: 0,
61 |           }).format(businessCount ?? 0)}
62 |         </Link>{" "}
63 |         businesses.
64 |       </span>
65 |     </div>
66 |   );
67 | }
```

apps/website/src/components/tray.tsx
```
1 | "use client";
2 |
3 | import { format } from "date-fns";
4 | import { useEffect, useState } from "react";
5 |
6 | export function Tray() {
7 |   const [date, setDate] = useState<string | undefined>();
8 |
9 |   useEffect(() => {
10 |     const interval = setInterval(() => {
11 |       setDate(new Date().toISOString());
12 |     }, 60000);
13 |
14 |     return () => clearInterval(interval);
15 |   }, []);
16 |
17 |   return (
18 |     <div className="flex items-center space-x-3 absolute top-2 right-4 md:right-6 md:top-4 scale-75 md:scale-100">
19 |       <svg
20 |         className="relative -top-0.5"
21 |         xmlns="http://www.w3.org/2000/svg"
22 |         width={14}
23 |         height={13}
24 |         fill="none"
25 |       >
26 |         <path
27 |           fill="#F5F5F3"
28 |           fillRule="evenodd"
29 |           d="M6.368 0a6.47 6.47 0 0 0-2.723.728l2.723 4.715V0Zm0 7.558-2.722 4.714A6.47 6.47 0 0 0 6.368 13V7.558ZM6.934 13V7.555l2.723 4.716A6.47 6.47 0 0 1 6.934 13Zm0-7.554V0c.98.042 1.903.3 2.723.729L6.934 5.446Zm-5.771 4.55 4.716-2.722-2.723 4.715a6.54 6.54 0 0 1-1.993-1.993Zm10.976-6.99L7.424 5.728l2.723-4.716a6.54 6.54 0 0 1 1.992 1.994ZM1.162 3.005a6.54 6.54 0 0 1 1.994-1.994L5.879 5.73 1.162 3.005Zm-.283.49A6.47 6.47 0 0 0 .15 6.218h5.445L.88 3.495Zm0 6.012A6.47 6.47 0 0 1 .15 6.784h5.446L.879 9.507Zm6.828-3.289h5.443a6.47 6.47 0 0 0-.727-2.723L7.707 6.218Zm4.715 3.288L7.707 6.784h5.443a6.47 6.47 0 0 1-.728 2.722ZM7.425 7.274l2.721 4.714a6.54 6.54 0 0 0 1.993-1.992L7.425 7.274Z"
30 |           clipRule="evenodd"
31 |         />
32 |       </svg>
33 |
34 |       <svg
35 |         xmlns="http://www.w3.org/2000/svg"
36 |         width={20}
37 |         height={21}
38 |         fill="none"
39 |       >
40 |         <g filter="url(#a)">
41 |           <path
42 |             fill="#fff"
43 |             fillOpacity={0.9}
44 |             fillRule="evenodd"
45 |             d="M14.15 7.625c0 1.11-.361 2.136-.973 2.965l2.504 2.505a.75.75 0 0 1-.977 1.133l-.084-.073-2.504-2.504a5 5 0 1 1 2.035-4.026Zm-5 4a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"
46 |             clipRule="evenodd"
47 |           />
48 |         </g>
49 |         <defs>
50 |           <filter
51 |             id="a"
52 |             width={19.75}
53 |             height={19.75}
54 |             x={0.15}
55 |             y={0.625}
56 |             colorInterpolationFilters="sRGB"
57 |             filterUnits="userSpaceOnUse"
58 |           >
59 |             <feFlood floodOpacity={0} result="BackgroundImageFix" />
60 |             <feColorMatrix
61 |               in="SourceAlpha"
62 |               result="hardAlpha"
63 |               values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
64 |             />
65 |             <feOffset dy={2} />
66 |             <feGaussianBlur stdDeviation={2} />
67 |             <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.22 0" />
68 |             <feBlend
69 |               in2="BackgroundImageFix"
70 |               result="effect1_dropShadow_2085_4748"
71 |             />
72 |             <feBlend
73 |               in="SourceGraphic"
74 |               in2="effect1_dropShadow_2085_4748"
75 |               result="shape"
76 |             />
77 |           </filter>
78 |         </defs>
79 |       </svg>
80 |       <svg
81 |         xmlns="http://www.w3.org/2000/svg"
82 |         width={25}
83 |         height={19}
84 |         fill="none"
85 |       >
86 |         <g filter="url(#a)">
87 |           <path
88 |             fill="#fff"
89 |             fillOpacity={0.9}
90 |             fillRule="evenodd"
91 |             d="M12.75 2a9.982 9.982 0 0 1 7.85 3.804L19.12 7.16A7.987 7.987 0 0 0 12.75 4c-2.6 0-4.909 1.24-6.37 3.16L4.9 5.804A9.982 9.982 0 0 1 12.75 2Zm4.888 6.52A5.992 5.992 0 0 0 12.75 6c-2.016 0-3.8.994-4.888 2.52l1.492 1.366A3.997 3.997 0 0 1 12.75 8c1.434 0 2.69.754 3.397 1.886l1.491-1.367Zm-3.019 2.767a2 2 0 0 0-3.738 0L12.751 13l1.868-1.713Z"
92 |             clipRule="evenodd"
93 |           />
[TRUNCATED]
```

apps/website/src/components/updates-toolbar.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import {
6 |   Dialog,
7 |   DialogContent,
8 |   DialogHeader,
9 |   DialogTitle,
10 |   DialogTrigger,
11 | } from "@midday/ui/dialog";
12 | import { Icons } from "@midday/ui/icons";
13 | import {
14 |   Tooltip,
15 |   TooltipContent,
16 |   TooltipProvider,
17 |   TooltipTrigger,
18 | } from "@midday/ui/tooltip";
19 | import { usePathname } from "next/navigation";
20 | import { useHotkeys } from "react-hotkeys-hook";
21 | import { FaXTwitter } from "react-icons/fa6";
22 | import { CopyInput } from "./copy-input";
23 |
24 | const popupCenter = ({ url, title, w, h }) => {
25 |   const dualScreenLeft =
26 |     window.screenLeft !== undefined ? window.screenLeft : window.screenX;
27 |   const dualScreenTop =
28 |     window.screenTop !== undefined ? window.screenTop : window.screenY;
29 |
30 |   const width = window.innerWidth
31 |     ? window.innerWidth
32 |     : document.documentElement.clientWidth
33 |       ? document.documentElement.clientWidth
34 |       : screen.width;
35 |   const height = window.innerHeight
36 |     ? window.innerHeight
37 |     : document.documentElement.clientHeight
38 |       ? document.documentElement.clientHeight
39 |       : screen.height;
40 |
41 |   const systemZoom = width / window.screen.availWidth;
42 |   const left = (width - w) / 2 / systemZoom + dualScreenLeft;
43 |   const top = (height - h) / 2 / systemZoom + dualScreenTop;
44 |   const newWindow = window.open(
45 |     url,
46 |     title,
47 |     `
48 |       scrollbars=yes,
49 |       width=${w / systemZoom},
50 |       height=${h / systemZoom},
51 |       top=${top},
52 |       left=${left}
53 |       `,
54 |   );
55 |
56 |   return newWindow;
57 | };
58 |
59 | export function UpdatesToolbar({ posts }) {
60 |   const pathname = usePathname();
61 |   const currentIndex = posts.findIndex((a) => pathname.endsWith(a.slug)) ?? 0;
62 |
63 |   const currentPost = posts[currentIndex];
64 |
65 |   const handlePrev = () => {
66 |     if (currentIndex > 0) {
67 |       const nextPost = posts[currentIndex - 1];
68 |
69 |       const element = document.getElementById(nextPost?.slug);
70 |       element?.scrollIntoView({
71 |         behavior: "smooth",
72 |       });
73 |     }
74 |   };
75 |
76 |   const handleNext = () => {
77 |     if (currentIndex !== posts.length - 1) {
78 |       const nextPost = posts[currentIndex + 1];
79 |
80 |       const element = document.getElementById(nextPost?.slug);
81 |
82 |       element?.scrollIntoView({
83 |         behavior: "smooth",
84 |       });
85 |     }
86 |   };
87 |
88 |   useHotkeys("arrowRight", () => handleNext(), [handleNext]);
89 |   useHotkeys("arrowLeft", () => handlePrev(), [handlePrev]);
90 |
91 |   const handleOnShare = () => {
92 |     const popup = popupCenter({
93 |       url: `https://twitter.com/intent/tweet?text=${currentPost.title} https://midday.ai/updates/${currentPost.slug}`,
94 |       title: currentPost.title,
95 |       w: 800,
96 |       h: 400,
97 |     });
98 |
99 |     popup?.focus();
100 |   };
101 |
102 |   return (
103 |     <Dialog>
104 |       <div className="fixed right-6 bottom-0 top-0 flex-col items-center justify-center hidden md:flex">
105 |         <TooltipProvider delayDuration={20}>
106 |           <div className="flex flex-col items-center backdrop-filter backdrop-blur-lg dark:bg-[#1A1A1A]/80 p-2 border dark:border-[#2C2C2C] bg-white space-y-4 rounded-full">
107 |             <Tooltip>
108 |               <TooltipTrigger>
109 |                 <DialogTrigger asChild>
110 |                   <Icons.Share size={18} className="text-[#606060] -mt-[1px]" />
111 |                 </DialogTrigger>
112 |               </TooltipTrigger>
113 |               <TooltipContent
114 |                 className="py-1 px-3 rounded-sm"
115 |                 sideOffset={25}
116 |                 side="right"
117 |               >
118 |                 <span className="text-xs">Share</span>
119 |               </TooltipContent>
120 |             </Tooltip>
121 |
122 |             <div className="flex flex-col items-center border-t-[1px] border-border space-y-2 pt-2">
123 |               <Tooltip>
124 |                 <TooltipTrigger asChild>
125 |                   <button
126 |                     type="button"
127 |                     className={cn(currentIndex === 0 && "opacity-50")}
128 |                     onClick={handlePrev}
129 |                   >
130 |                     <Icons.ChevronUp className="h-6 w-6" />
131 |                   </button>
132 |                 </TooltipTrigger>
133 |                 <TooltipContent
134 |                   className="py-1 px-3 rounded-sm"
135 |                   sideOffset={25}
136 |                   side="right"
137 |                 >
138 |                   <span className="text-xs">Previous post</span>
139 |                 </TooltipContent>
140 |               </Tooltip>
141 |               <Tooltip>
142 |                 <TooltipTrigger asChild>
143 |                   <button
144 |                     type="button"
145 |                     className={cn(
146 |                       currentIndex === posts.length - 1 && "opacity-50",
147 |                     )}
148 |                     onClick={handleNext}
149 |                   >
150 |                     <Icons.ChevronDown className="h-6 w-6" />
151 |                   </button>
152 |                 </TooltipTrigger>
153 |                 <TooltipContent
154 |                   className="py-1 px-3 rounded-sm"
155 |                   sideOffset={25}
156 |                   side="right"
157 |                 >
158 |                   <span className="text-xs">Next post</span>
[TRUNCATED]
```

apps/website/src/components/vote-button.tsx
```
1 | "use client";
2 |
3 | import { voteAction } from "@/actions/vote-action";
4 | import { Button } from "@midday/ui/button";
5 | import { ChevronUp } from "lucide-react";
6 | import { useOptimisticAction } from "next-safe-action/hooks";
7 |
8 | type Props = {
9 |   id: string;
10 |   count: number;
11 | };
12 |
13 | export function VoteButton({ count, id }: Props) {
14 |   const { execute, optimisticState } = useOptimisticAction(voteAction, {
15 |     currentState: count,
16 |     updateFn: () => {
17 |       return +count + 1;
18 |     },
19 |   });
20 |
21 |   return (
22 |     <Button
23 |       variant="outline"
24 |       className="p-6 flex-col w-14 h-16"
25 |       onClick={() => execute({ id })}
26 |     >
27 |       <div className="flex space-x-2 items-center flex-col">
28 |         <ChevronUp size={16} />
29 |         {optimisticState}
30 |       </div>
31 |     </Button>
32 |   );
33 | }
```

apps/website/src/components/vote.tsx
```
1 | import { VoteButton } from "@/components/vote-button";
2 | import { client } from "@midday/kv";
3 |
4 | type Props = {
5 |   id: string;
6 | };
7 |
8 | export async function Vote({ id }: Props) {
9 |   const count = await client.mget(`apps:${id}`);
10 |
11 |   return <VoteButton count={count.at(0)} id={id} />;
12 | }
```

apps/website/src/components/word-animation.tsx
```
1 | "use client";
2 |
3 | import { AnimatePresence, motion } from "framer-motion";
4 | import { useEffect, useState } from "react";
5 |
6 | const words = [
7 |   "Freelancers",
8 |   "Agencies",
9 |   "Consultants",
10 |   "Startups",
11 |   "Entrepreneurs",
12 |   "Founders",
13 | ];
14 |
15 | function useWordCycle(words: string[], interval: number) {
16 |   const [index, setIndex] = useState(0);
17 |   const [isInitial, setIsInitial] = useState(true);
18 |
19 |   useEffect(() => {
20 |     if (isInitial) {
21 |       setIndex(Math.floor(Math.random() * words.length));
22 |       setIsInitial(false);
23 |       return;
24 |     }
25 |
26 |     const timer = setInterval(() => {
27 |       setIndex((current) => (current + 1) % words.length);
28 |     }, interval);
29 |     return () => clearInterval(timer);
30 |   }, [words, interval, isInitial]);
31 |
32 |   return words[index];
33 | }
34 |
35 | export function WordAnimation() {
36 |   const word = useWordCycle(words, 2100);
37 |
38 |   return (
39 |     <AnimatePresence mode="wait">
40 |       <motion.div key={word} className="text-primary inline-block">
41 |         {word?.split("").map((char, index) => (
42 |           <motion.span
43 |             key={`${word}-${char}-${index.toString()}`}
44 |             initial={{ y: 10, opacity: 0 }}
45 |             animate={{ y: 0, opacity: 1 }}
46 |             exit={{ y: -10, opacity: 0 }}
47 |             transition={{
48 |               duration: 0.15,
49 |               delay: index * 0.015,
50 |               ease: "easeOut",
51 |             }}
52 |             style={{ display: "inline-block", whiteSpace: "pre" }}
53 |           >
54 |             {char}
55 |           </motion.span>
56 |         ))}
57 |       </motion.div>
58 |     </AnimatePresence>
59 |   );
60 | }
```

apps/website/src/lib/blog.ts
```
1 | import fs from "node:fs";
2 | import path from "node:path";
3 |
4 | type Metadata = {
5 |   title: string;
6 |   publishedAt: string;
7 |   summary: string;
8 |   image?: string;
9 |   tag: string;
10 | };
11 |
12 | function parseFrontmatter(fileContent: string) {
13 |   const frontmatterRegex = /---\s*([\s\S]*?)\s*---/;
14 |   const match = frontmatterRegex.exec(fileContent);
15 |   const frontMatterBlock = match?.[1];
16 |   const content = fileContent.replace(frontmatterRegex, "").trim();
17 |   const frontMatterLines = frontMatterBlock?.trim().split("\n") || [];
18 |   const metadata: Partial<Metadata> = {};
19 |
20 |   for (const line of frontMatterLines) {
21 |     const [key, ...valueArr] = line.split(": ");
22 |     if (key) {
23 |       let value = valueArr.join(": ").trim();
24 |       value = value.replace(/^['"](.*)['"]$/, "$1"); // Remove quotes
25 |       metadata[key.trim() as keyof Metadata] = value;
26 |     }
27 |   }
28 |
29 |   return { metadata: metadata as Metadata, content };
30 | }
31 |
32 | function getMDXFiles(dir: string) {
33 |   return fs.readdirSync(dir).filter((file) => path.extname(file) === ".mdx");
34 | }
35 |
36 | function readMDXFile(filePath: string) {
37 |   const rawContent = fs.readFileSync(filePath, "utf-8");
38 |   return parseFrontmatter(rawContent);
39 | }
40 |
41 | function getMDXData(dir: string) {
42 |   const mdxFiles = getMDXFiles(dir);
43 |   return mdxFiles.map((file) => {
44 |     const { metadata, content } = readMDXFile(path.join(dir, file));
45 |     const slug = path.basename(file, path.extname(file));
46 |
47 |     return {
48 |       metadata,
49 |       slug,
50 |       content,
51 |     };
52 |   });
53 | }
54 |
55 | export function getBlogPosts() {
56 |   return getMDXData(path.join(process.cwd(), "src", "app", "updates", "posts"));
57 | }
```

apps/website/src/lib/fetch-github-stars.ts
```
1 | "use server";
2 |
3 | export async function fetchGithubStars() {
4 |   const response = await fetch(
5 |     "https://api.github.com/repos/midday-ai/midday",
6 |     {
7 |       next: {
8 |         revalidate: 3600,
9 |       },
10 |     },
11 |   );
12 |
13 |   return response.json();
14 | }
```

apps/website/src/lib/fetch-github.ts
```
1 | "use server";
2 |
3 | async function getAllStargazers({ owner, name }) {
4 |   let endCursor = undefined;
5 |   let hasNextPage = true;
6 |   let added = [];
7 |
8 |   while (hasNextPage) {
9 |     const request = await fetch("https://api.github.com/graphql", {
10 |       method: "POST",
11 |       headers: {
12 |         "Content-Type": "application/json",
13 |         Authorization: `bearer ${process.env.GITHUB_TOKEN}`,
14 |       },
15 |       body: JSON.stringify({
16 |         variables: { after: endCursor, owner, name },
17 |         query: `query Repository($owner: String!, $name: String!, $after: String) {
18 |             repository(owner: $owner, name: $name) {
19 |               stargazers (first: 100, after: $after) {
20 |                 pageInfo {
21 |                   endCursor
22 |                   hasNextPage
23 |                 }
24 |                 edges {
25 |                  starredAt
26 |                 }
27 |               }
28 |             }
29 |           }`,
30 |       }),
31 |     });
32 |
33 |     const { data } = await request.json();
34 |
35 |     added = added.concat(data.repository.stargazers.edges);
36 |     hasNextPage = data.repository.stargazers.pageInfo.hasNextPage;
37 |     endCursor = data.repository.stargazers.pageInfo.endCursor;
38 |   }
39 |
40 |   return added;
41 | }
42 |
43 | async function githubRequest({ owner, name }) {
44 |   const request = await fetch("https://api.github.com/graphql", {
45 |     method: "POST",
46 |     headers: {
47 |       "Content-Type": "application/json",
48 |       Authorization: `bearer ${process.env.GITHUB_TOKEN}`,
49 |     },
50 |     body: JSON.stringify({
51 |       variables: { owner, name },
52 |       query: `query Repository($owner: String!, $name: String!) {
53 |             repository(owner: $owner, name: $name) {
54 |               forks {
55 |                 totalCount
56 |               }
57 |               watchers {
58 |                 totalCount
59 |               }
60 |               stargazers {
61 |                 totalCount
62 |               }
63 |                commits:object(expression: "main") {
64 |                 ... on Commit {
65 |                   history {
66 |                     totalCount
67 |                   }
68 |                 }
69 |               }
70 |             }
71 |           }`,
72 |     }),
73 |   });
74 |
75 |   return request.json();
76 | }
77 |
78 | export async function getGithubStats() {
79 |   const stargazers = await getAllStargazers({
80 |     owner: "midday-ai",
81 |     name: "midday",
82 |   });
83 |
84 |   const {
85 |     data: { repository },
86 |   } = await githubRequest({
87 |     owner: "midday-ai",
88 |     name: "midday",
89 |   });
90 |
91 |   const starsPerDate = stargazers.reduce((acc, curr) => {
92 |     const date = curr.starredAt.substring(0, 10);
93 |
94 |     if (acc[date]) {
95 |       acc[date]++;
96 |     } else {
97 |       acc[date] = 1;
98 |     }
99 |     return acc;
100 |   }, {});
101 |
102 |   const stats = Object.keys(starsPerDate).map((key) => {
103 |     return {
104 |       date: new Date(key),
105 |       value: starsPerDate[key],
106 |     };
107 |   });
108 |
109 |   return {
110 |     stats,
111 |     repository,
112 |   };
113 | }
```

apps/website/src/lib/fetch-stats.ts
```
1 | "use server";
2 |
3 | import type { Database } from "@midday/supabase/types";
4 | import { createServerClient } from "@supabase/ssr";
5 |
6 | export async function fetchStats() {
7 |   const supabase = createServerClient<Database>(
8 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
9 |     process.env.SUPABASE_SERVICE_KEY!,
10 |     {
11 |       cookies: {
12 |         get() {
13 |           return null;
14 |         },
15 |         set() {
16 |           return null;
17 |         },
18 |         remove() {
19 |           return null;
20 |         },
21 |       },
22 |     },
23 |   );
24 |
25 |   const supabaseStorage = createServerClient<Database>(
26 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
27 |     process.env.SUPABASE_SERVICE_KEY!,
28 |     {
29 |       cookies: {
30 |         get() {
31 |           return null;
32 |         },
33 |         set() {
34 |           return null;
35 |         },
36 |         remove() {
37 |           return null;
38 |         },
39 |       },
40 |       db: { schema: "storage" },
41 |     },
42 |   );
43 |
44 |   const [
45 |     { count: users },
46 |     { count: transactions },
47 |     { count: bankAccounts },
48 |     { count: trackerEntries },
49 |     { count: inboxItems },
50 |     { count: bankConnections },
51 |     { count: trackerProjects },
52 |     { count: reports },
53 |     { count: vaultObjects },
54 |     { count: transactionEnrichments },
55 |     { count: invoices },
56 |     { count: invoiceCustomers },
57 |   ] = await Promise.all([
58 |     supabase
59 |       .from("teams")
60 |       .select("id", { count: "exact", head: true })
61 |       .limit(1),
62 |     supabase
63 |       .from("transactions")
64 |       .select("id", { count: "exact", head: true })
65 |       .limit(1),
66 |     supabase
67 |       .from("bank_accounts")
68 |       .select("id", { count: "exact", head: true })
69 |       .limit(1),
70 |     supabase
71 |       .from("tracker_entries")
72 |       .select("id", { count: "exact", head: true })
73 |       .limit(1),
74 |     supabase
75 |       .from("inbox")
76 |       .select("id", { count: "exact", head: true })
77 |       .limit(1),
78 |     supabase
79 |       .from("bank_connections")
80 |       .select("id", { count: "exact", head: true })
81 |       .limit(1),
82 |     supabase
83 |       .from("tracker_projects")
84 |       .select("id", { count: "exact", head: true })
85 |       .limit(1),
86 |     supabase
87 |       .from("reports")
88 |       .select("id", { count: "exact", head: true })
89 |       .limit(1),
90 |     supabaseStorage
91 |       .from("objects")
92 |       .select("id", { count: "exact", head: true })
93 |       .limit(1),
94 |     supabase
95 |       .from("transaction_enrichments")
96 |       .select("id", { count: "exact", head: true })
97 |       .limit(1),
98 |     supabase
99 |       .from("invoices")
100 |       .select("id", { count: "exact", head: true })
101 |       .limit(1),
102 |     supabase
103 |       .from("customers")
104 |       .select("id", { count: "exact", head: true })
105 |       .limit(1),
106 |   ]);
107 |
108 |   return {
109 |     users,
110 |     transactions,
111 |     bankAccounts,
112 |     trackerEntries,
113 |     inboxItems,
114 |     bankConnections,
115 |     trackerProjects,
116 |     reports,
117 |     vaultObjects,
118 |     transactionEnrichments,
119 |     invoices,
120 |     invoiceCustomers,
121 |   };
122 | }
```

apps/website/src/styles/globals.css
```
1 | @tailwind base;
2 | @tailwind components;
3 | @tailwind utilities;
4 |
5 | :root {
6 |     --sh-class: #FFFFFF;
7 |     --sh-identifier: #FFFFFF;
8 |     --sh-sign: #8996a3;
9 |     --sh-string: #A7A7A7;
10 |     --sh-keyword: #A7A7A7;
11 |     --sh-comment: #a19595;
12 |     --sh-jsxliterals: #FFFFFF;
13 |     --sh-property: #A7A7A7;
14 |     --sh-entity: #A7A7A7;
15 | }
16 |
17 | .updates p {
18 |     min-height: 1.87em;
19 |     margin-top: 1px;
20 |     margin-bottom: 1px;
21 |     padding: 3px 2px;
22 | }
23 |
24 | .updates h2 {
25 |     font-size: 26px;
26 |     margin-top: .8em;
27 |     margin-bottom: 10px;
28 |     font-weight: 500;
29 | }
30 |
31 | .updates h4 {
32 |     display: block;
33 |     font-weight: 600;
34 |     color: white;
35 |     margin-top: 15px;
36 | }
37 |
38 | .updates h3 {
39 |     font-size: 1.25em;
40 |     margin-top: .8em;
41 |     margin-bottom: 1px;
42 |     font-weight: 500;
43 | }
44 |
45 | .updates p,
46 | .updates li {
47 |     color: #707070;
48 | }
49 |
50 | .updates ul li {
51 |     margin-top: 1px;
52 |     margin-bottom: 1px;
53 |     padding-left: 12px;
54 |     padding-top: 3px;
55 |     padding-bottom: 2px;
56 | }
57 |
58 | .updates ul {
59 |     list-style-type: disc;
60 |     list-style-position: inside;
61 | }
62 |
63 | .updates p code span {
64 |     font-family: var(--font-geist-mono);
65 |     color: #eb5757 !important;
66 |     font-size: 85%;
67 |     font-weight: 600;
68 | }
69 |
70 | .updates p code {
71 |     border-radius: 4px;
72 |     background: hsla(44, 6%, 50%, .15);
73 |     padding: 0 .4em 3px .4em;
74 |     line-height: normal;
75 |
76 | }
77 |
78 | .updates a {
79 |     text-decoration: underline;
80 | }
81 |
82 | .updates blockquote p {
83 |     margin: 7px 2px;
84 |     padding-left: 14px;
85 |     padding-right: 14px;
86 |     border-left: 3px solid;
87 |     color: hsl(var(--foreground));
88 | }
89 |
90 | .updates b,
91 | .updates strong {
92 |     font-weight: 500;
93 | }
94 |
95 | pre::-webkit-scrollbar {
96 |     display: none;
97 | }
98 |
99 | pre {
100 |     -ms-overflow-style: none; /* IE and Edge */
101 |     scrollbar-width: none; /* Firefox */
102 |     padding: 20px;
103 |     border: 1px solid;
104 |     border-color: hsl(var(--border));
105 |     border-radius: 10px;
106 |     margin: 20px 0 !important;
107 |     background-color: #0C0C0C;
108 |     overflow: auto;
109 | }
110 |
111 | pre code {
112 |     font-size: 13px;
113 |     font-weight: 500 !important;
114 | }
115 |
116 | .dark .dotted-bg {
117 |     background-image: radial-gradient(circle at 1px 1px, #232323 1px, transparent 0);
118 |     background-size: 8px 8px;
119 | }
120 |
121 | .light .dotted-bg {
122 |     background-image: radial-gradient(circle at 1px 1px, #e7e7e7 1px, transparent 0);
123 |     background-size: 8px 8px;
124 | }
125 |
126 | .text-stroke {
127 |     color: white;
128 |     text-shadow: -1px 1px 0 black,
129 |     1px 1px 0 black,
130 |     1px -1px 0 black,
131 |     -1px -1px 0 black;
132 | }
133 |
134 |
135 | .dark .text-stroke {
136 |     color: black;
137 |     text-shadow: -1px 1px 0 white,
138 |     1px 1px 0 white,
139 |     1px -1px 0 white,
140 |     -1px -1px 0 white;
141 | }
142 |
143 | .dark .text-dotted {
144 |     background-image: radial-gradient(circle at 0.4px 0.2px, #fff 1px, transparent 0);
145 |     background-size: 5px 5px;
146 |     background-clip: text;
147 |    -webkit-text-fill-color: transparent;
148 | }
149 |
150 | .text-dotted {
151 |     background-image: radial-gradient(circle at 0.4px 0.2px, #000 1px, transparent 0);
152 |     background-size: 5px 5px;
153 |     background-clip: text;
154 |    -webkit-text-fill-color: transparent;
155 | }
156 |
157 | ::selection {
158 |     background: #00cc9937;
159 |     color: #007763fd
160 | }
161 |
162 | img::selection {
163 |     background: transparent;
164 |  }
```

apps/website/src/utils/resend.ts
```
1 | import { Resend } from "resend";
2 |
3 | export const resend = new Resend(process.env.RESEND_API_KEY!);
```

packages/app-store/src/cal/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Cal.com",
5 |   id: "cal",
6 |   active: false,
7 |   logo: Logo,
8 |   short_description:
9 |     "Integrating with Cal.com automatically synchronizes your tracked hours with your calendar, allowing you to easily monitor your progress on your projects.",
10 |   description:
11 |     "Integrating with Xero streamlines your financial processes by seamlessly syncing transactions and attachments directly into your bookkeeping software. This integration ensures that your financial data is neatly organized, eliminating the hassle of manual data entry and reducing the likelihood of errors. With transactions and attachments automatically sorted within your accounting system, you and your accountant can efficiently reconcile accounts and close your books in a timelier manner. This not only saves valuable time but also enhances the accuracy and reliability of your financial records, providing you with a clearer picture of your business's financial health.",
12 |   images: [],
13 |   onInitialize: () => {},
14 |   settings: {},
15 |   config: {},
16 | };
```

packages/app-store/src/db/index.ts
```
1 | import { createClient } from "@midday/supabase/server";
2 |
3 | export async function createApp(params: any) {
4 |   const client = createClient({ admin: true });
5 |
6 |   const { data, error } = await client
7 |     .from("apps")
8 |     .upsert(params)
9 |     .select()
10 |     .single();
11 |
12 |   if (error) {
13 |     throw new Error(error.message);
14 |   }
15 |
16 |   return data;
17 | }
```

packages/app-store/src/fortnox/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Fortnox",
5 |   id: "fortnox",
6 |   active: false,
7 |   logo: Logo,
8 |   short_description:
9 |     "By seamlessly integrating with Fortnox, you gain the ability to effortlessly synchronize every transaction and attachment, ensuring meticulous organization within your bookkeeping software. ",
10 |   description: null,
11 |   images: [],
12 |   onInitialize: () => {},
13 |   settings: {},
14 |   config: {},
15 | };
```

packages/app-store/src/quick-books/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "QuickBooks",
5 |   id: "quick-books",
6 |   active: false,
7 |   logo: Logo,
8 |   short_description:
9 |     "Integrating with QuickBooks enables you to synchronize transactions and attachments, neatly organizing them in your bookkeeping software. This streamlines the process for you or your accountant to close your books faster.",
10 |   description: null,
11 |   images: [],
12 |   onInitialize: () => {},
13 |   settings: {},
14 |   config: {},
15 | };
```

packages/app-store/src/raycast/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Raycast",
5 |   id: "raycast",
6 |   category: "Time Tracking",
7 |   active: false,
8 |   logo: Logo,
9 |   short_description:
10 |     "Track time directly in Raycast. You can start a timer, add time to an existing project or create a new project directly from Raycast.",
11 |   description: null,
12 |   images: [],
13 | };
```

packages/app-store/src/slack/config.ts
```
1 | import image from "./assets/image.png";
2 | import { Logo } from "./assets/logo";
3 | import { onInitialize } from "./initialize";
4 |
5 | export default {
6 |   name: "Slack",
7 |   id: "slack",
8 |   category: "Assistant",
9 |   active: true,
10 |   logo: Logo,
11 |   short_description:
12 |     "Integrating with Slack enables you to use Midday Assistant right from your Slack workspace, you will also get notifications when you have new transactions and more.",
13 |   description:
14 |     "Integrating Midday with Slack brings powerful financial management capabilities directly into your team's communication hub. With this integration, you can seamlessly interact with Midday Assistant without leaving your Slack workspace, enabling quick access to financial insights and actions. \n\nYou'll receive timely notifications about new transactions, ensuring you're always up-to-date with your financial activities. Moreover, this integration streamlines your workflow by allowing you to upload attachments for transactions directly from Slack. \n\nWhether it's receipts, invoices, or any other relevant documents, you can easily attach them to your transactions without switching between multiple applications. This feature not only saves time but also ensures that all your financial documentation is properly organized and linked to the correct transactions, enhancing your overall bookkeeping efficiency.",
15 |   images: [image],
16 |   onInitialize,
17 |   settings: [
18 |     {
19 |       id: "transactions",
20 |       label: "Transactions",
21 |       description:
22 |         "Get notified when a new transaction is added. This will notify you in the channel you have selected.",
23 |       type: "switch",
24 |       required: false,
25 |       value: true,
26 |     },
27 |   ],
28 | };
```

packages/app-store/src/slack/index.ts
```
1 | export { default as config } from "./config";
2 | export { verifySlackRequest } from "@slack/bolt";
3 | export * from "./lib";
```

packages/app-store/src/slack/initialize.ts
```
1 | export const onInitialize = async () => {
2 |   const response = await fetch("/api/apps/slack/install-url").then((res) =>
3 |     res.json(),
4 |   );
5 |
6 |   const { url } = response;
7 |
8 |   const width = 600;
9 |   const height = 800;
10 |   const left = window.screenX + (window.outerWidth - width) / 2;
11 |   const top = window.screenY + (window.outerHeight - height) / 2.5;
12 |
13 |   const popup = window.open(
14 |     url,
15 |     "",
16 |     `toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${width}, height=${height}, top=${top}, left=${left}`,
17 |   );
18 |
19 |   // The popup might have been blocked, so we redirect the user to the URL instead
20 |   if (!popup) {
21 |     window.location.href = url;
22 |     return;
23 |   }
24 |
25 |   const listener = (e: MessageEvent) => {
26 |     if (e.data === "app_oauth_completed") {
27 |       window.location.reload();
28 |       window.removeEventListener("message", listener);
29 |       popup.close();
30 |     }
31 |   };
32 |
33 |   window.addEventListener("message", listener);
34 | };
```

packages/app-store/src/visma/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Visma",
5 |   id: "visma",
6 |   active: false,
7 |   logo: Logo,
8 |   short_description:
9 |     "Integrating with Visma allows you to synchronize transactions and attachments, neatly organizing them within your bookkeeping software. This streamlines the process for you or your accountant to close your books faster.",
10 |   description: null,
11 |   images: [],
12 |   onInitialize: () => {},
13 |   settings: {},
14 |   config: {},
15 | };
```

packages/app-store/src/xero/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Xero",
5 |   id: "xero",
6 |   active: false,
7 |   logo: Logo,
8 |   short_description:
9 |     "Integrating with Xero allows you to synchronize transactions and attachments neatly organized in your bookkeeping software, making it easier for you or your accountant to close your books faster.",
10 |   description: null,
11 |   images: [],
12 |   onInitialize: () => {},
13 |   settings: {},
14 |   config: {},
15 | };
```

packages/app-store/src/zapier/config.ts
```
1 | import { Logo } from "./assets/logo";
2 |
3 | export default {
4 |   name: "Zapier",
5 |   id: "zapier",
6 |   category: "Automation",
7 |   active: false,
8 |   logo: Logo,
9 |   short_description:
10 |     "Zapier lets you connect Midday to other apps and automate powerful workflows.",
11 |   description: null,
12 |   images: [],
13 |   onInitialize: () => {},
14 | };
```

packages/documents/src/provider/azure.ts
```
1 | import DocumentIntelligence from "@azure-rest/ai-document-intelligence";
2 |
3 | export const client = DocumentIntelligence(
4 |   process.env.AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT!,
5 |   {
6 |     key: process.env.AZURE_DOCUMENT_INTELLIGENCE_KEY!,
7 |   },
8 | );
```

packages/invoice/src/editor/index.tsx
```
1 | export function Editor() {
2 |   return null;
3 | }
```

packages/invoice/src/templates/types.ts
```
1 | export type Template = {
2 |   logo_url?: string;
3 |   from_label: string;
4 |   customer_label: string;
5 |   invoice_no_label: string;
6 |   issue_date_label: string;
7 |   due_date_label: string;
8 |   date_format: string;
9 |   payment_label: string;
10 |   note_label: string;
11 |   description_label: string;
12 |   quantity_label: string;
13 |   price_label: string;
14 |   total_label: string;
15 |   total_summary_label: string;
16 |   tax_label: string;
17 |   vat_label: string;
18 |   locale: string;
19 |   timezone: string;
20 |   include_decimals: boolean;
21 |   include_units: boolean;
22 |   include_qr: boolean;
23 |   include_vat: boolean;
24 |   title: string;
25 |   subtotal_label: string;
26 |   subtotal: number;
27 | };
28 |
29 | export type LineItem = {
30 |   name: string;
31 |   quantity: number;
32 |   price: number;
33 |   unit?: string;
34 |   invoice_number?: string;
35 |   issue_date?: string;
36 |   due_date?: string;
37 | };
38 |
39 | export type TemplateProps = {
40 |   title: string;
41 |   invoice_number: string;
42 |   discount?: number;
43 |   issue_date: string;
44 |   due_date: string;
45 |   template: Template;
46 |   line_items: LineItem[];
47 |   customer_details?: JSON;
48 |   payment_details?: JSON;
49 |   from_details?: JSON;
50 |   note_details?: JSON;
51 |   currency: string;
52 |   amount: number;
53 |   customer_name?: string;
54 |   vat?: number;
55 |   tax?: number;
56 |   width: number;
57 |   height: number;
58 |   token: string;
59 |   size: "letter" | "a4";
60 |   top_block?: JSON;
61 |   bottom_block?: JSON;
62 |   subtotal?: number;
63 | };
64 |
65 | export interface EditorDoc {
66 |   type: "doc";
67 |   content: EditorNode[];
68 | }
69 |
70 | export interface EditorNode {
71 |   type: string;
72 |   content?: InlineContent[];
73 | }
74 |
75 | interface InlineContent {
76 |   type: string;
77 |   text?: string;
78 |   marks?: Mark[];
79 | }
80 |
81 | export interface Mark {
82 |   type: string;
83 |   attrs?: {
84 |     href?: string;
85 |   };
86 | }
87 |
88 | export interface TextStyle {
89 |   fontSize: number;
90 |   fontWeight?: number;
91 |   fontStyle?: "normal" | "italic" | "oblique";
92 |   color?: string;
93 |   textDecoration?: string;
94 | }
```

packages/invoice/src/utils/calculate.test.ts
```
1 | import { describe, expect, it } from "bun:test";
2 | import { calculateLineItemTotal, calculateTotal } from "./calculate";
3 |
4 | describe("calculateTotal", () => {
5 |   const sampleLineItems = [
6 |     { price: 100, quantity: 2 },
7 |     { price: 50, quantity: 1 },
8 |   ];
9 |
10 |   it("should calculate subtotal correctly", () => {
11 |     const result = calculateTotal({ lineItems: sampleLineItems });
12 |     expect(result.subTotal).toBe(250); // (100 * 2) + (50 * 1)
13 |   });
14 |
15 |   it("should calculate VAT correctly when included", () => {
16 |     const result = calculateTotal({
17 |       lineItems: sampleLineItems,
18 |       includeVAT: true,
19 |       vatRate: 10,
20 |     });
21 |     expect(result.vat).toBe(25); // 250 * 0.1
22 |   });
23 |
24 |   it("should not include VAT when disabled", () => {
25 |     const result = calculateTotal({
26 |       lineItems: sampleLineItems,
27 |       includeVAT: false,
28 |       vatRate: 10,
29 |     });
30 |     expect(result.vat).toBe(0);
31 |   });
32 |
33 |   it("should apply discount correctly", () => {
34 |     const result = calculateTotal({
35 |       lineItems: sampleLineItems,
36 |       discount: 20,
37 |       includeVAT: true,
38 |       vatRate: 10,
39 |     });
40 |     expect(result.total).toBe(255); // (250 + 25 - 20)
41 |   });
42 |
43 |   it("should calculate tax correctly when included", () => {
44 |     const result = calculateTotal({
45 |       lineItems: sampleLineItems,
46 |       taxRate: 15,
47 |       includeTax: true,
48 |       includeVAT: true,
49 |       vatRate: 10,
50 |     });
51 |     expect(result.tax).toBe(41.25); // (250 + 25) * 0.15
52 |   });
53 |
54 |   it("should handle empty line items", () => {
55 |     const result = calculateTotal({ lineItems: [] });
56 |     expect(result.subTotal).toBe(0);
57 |     expect(result.total).toBe(0);
58 |     expect(result.vat).toBe(0);
59 |     expect(result.tax).toBe(0);
60 |   });
61 | });
62 |
63 | describe("calculateLineItemTotal", () => {
64 |   it("should calculate total price correctly", () => {
65 |     const result = calculateLineItemTotal({
66 |       price: 100,
67 |       quantity: 2,
68 |     });
69 |     expect(result).toBe(200);
70 |   });
71 |
72 |   it("should handle zero values", () => {
73 |     const result = calculateLineItemTotal({});
74 |     expect(result).toBe(0);
75 |   });
76 |
77 |   it("should handle undefined values", () => {
78 |     const result = calculateLineItemTotal({
79 |       price: undefined,
80 |       quantity: undefined,
81 |     });
82 |     expect(result).toBe(0);
83 |   });
84 | });
```

packages/invoice/src/utils/calculate.ts
```
1 | export function calculateTotal({
2 |   lineItems,
3 |   taxRate = 0,
4 |   vatRate = 0,
5 |   discount = 0,
6 |   includeVAT = true,
7 |   includeTax = true,
8 | }: {
9 |   lineItems: Array<{ price?: number; quantity?: number }>;
10 |   taxRate?: number;
11 |   vatRate?: number;
12 |   discount?: number;
13 |   includeVAT?: boolean;
14 |   includeTax?: boolean;
15 | }) {
16 |   // Calculate Subtotal: Sum of all Base Prices for line items
17 |   const subTotal = lineItems.reduce((acc, item) => {
18 |     return acc + (item.price ?? 0) * (item.quantity ?? 0);
19 |   }, 0);
20 |
21 |   // Calculate VAT (Total): Calculate VAT on the Subtotal
22 |   const totalVAT = includeVAT ? (subTotal * vatRate) / 100 : 0;
23 |
24 |   // Calculate Total: Subtotal + VAT - Discount
25 |   const total = subTotal + (includeVAT ? totalVAT : 0) - discount;
26 |
27 |   // Calculate tax (if included)
28 |   const tax = includeTax ? (total * taxRate) / 100 : 0;
29 |
30 |   return {
31 |     subTotal,
32 |     total: total + tax,
33 |     vat: totalVAT,
34 |     tax,
35 |   };
36 | }
37 |
38 | export function calculateLineItemTotal({
39 |   price = 0,
40 |   quantity = 0,
41 | }: {
42 |   price?: number;
43 |   quantity?: number;
44 | }) {
45 |   // Calculate and return total price
46 |   return price * quantity;
47 | }
```

packages/invoice/src/utils/content.ts
```
1 | export function isValidJSON(str: string | null | undefined): boolean {
2 |   if (!str) return false;
3 |   try {
4 |     JSON.parse(str);
5 |     return true;
6 |   } catch {
7 |     return false;
8 |   }
9 | }
```

packages/invoice/src/utils/default.ts
```
1 | import { getCountryCode, getLocale, getTimezone } from "@midday/location";
2 | import { currencies } from "@midday/location/currencies";
3 | import { getUser } from "@midday/supabase/cached-queries";
4 |
5 | export type Settings = {
6 |   currency: string;
7 |   size: string;
8 |   include_tax: boolean;
9 |   include_vat: boolean;
10 |   include_discount: boolean;
11 |   include_decimals: boolean;
12 |   include_units: boolean;
13 |   include_qr: boolean;
14 |   timezone: string;
15 |   locale: string;
16 | };
17 |
18 | export async function getDefaultSettings(): Promise<Settings> {
19 |   const countryCode = getCountryCode();
20 |
21 |   const { data: userData } = await getUser();
22 |
23 |   const currency =
24 |     userData?.team?.base_currency ??
25 |     currencies[countryCode as keyof typeof currencies] ??
26 |     "USD";
27 |
28 |   const timezone = userData?.timezone ?? getTimezone();
29 |   const locale = userData?.locale ?? getLocale();
30 |
31 |   // Default to letter size for US/CA, A4 for rest of world
32 |   const size = ["US", "CA"].includes(countryCode) ? "letter" : "a4";
33 |
34 |   // Default to include sales tax for countries where it's common
35 |   const include_tax = ["US", "CA", "AU", "NZ", "SG", "MY", "IN"].includes(
36 |     countryCode,
37 |   );
38 |
39 |   return {
40 |     currency: currency.toUpperCase(),
41 |     size,
42 |     include_tax,
43 |     include_vat: !include_tax,
44 |     include_discount: false,
45 |     include_decimals: false,
46 |     include_units: false,
47 |     include_qr: true,
48 |     timezone,
49 |     locale,
50 |   };
51 | }
```

packages/invoice/src/utils/logo.ts
```
1 | export async function isValidLogoUrl(url: string): Promise<boolean> {
2 |   if (!url) return false;
3 |
4 |   try {
5 |     const response = await fetch(url);
6 |
7 |     return response.ok;
8 |   } catch {
9 |     return false;
10 |   }
11 | }
```

packages/invoice/src/utils/number.test.ts
```
1 | import { describe, expect, it, test } from "bun:test";
2 | import { generateInvoiceNumber } from "./number";
3 |
4 | describe("Generate invoice number", () => {
5 |   it("should generate correct invoice number for count less than 10", () => {
6 |     expect(generateInvoiceNumber(0)).toBe("INV-001");
7 |     expect(generateInvoiceNumber(5)).toBe("INV-006");
8 |     expect(generateInvoiceNumber(9)).toBe("INV-010");
9 |   });
10 |
11 |   it("should generate correct invoice number for count between 10 and 99", () => {
12 |     expect(generateInvoiceNumber(10)).toBe("INV-011");
13 |     expect(generateInvoiceNumber(50)).toBe("INV-051");
14 |     expect(generateInvoiceNumber(99)).toBe("INV-100");
15 |   });
16 |
17 |   it("should generate correct invoice number for count 100 and above", () => {
18 |     expect(generateInvoiceNumber(100)).toBe("INV-101");
19 |     expect(generateInvoiceNumber(500)).toBe("INV-501");
20 |     expect(generateInvoiceNumber(999)).toBe("INV-1000");
21 |   });
22 |
23 |   it("should handle large numbers correctly", () => {
24 |     expect(generateInvoiceNumber(9999)).toBe("INV-10000");
25 |     expect(generateInvoiceNumber(99999)).toBe("INV-100000");
26 |   });
27 | });
```

packages/supabase/src/client/client.ts
```
1 | import { createBrowserClient } from "@supabase/ssr";
2 | import type { Database } from "../types";
3 |
4 | export const createClient = () => {
5 |   return createBrowserClient<Database>(
6 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
7 |     process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
8 |     {
9 |       global: {
10 |         headers: {
11 |           // https://supabase.com/docs/guides/platform/read-replicas#experimental-routing
12 |           "sb-lb-routing-mode": "alpha-all-services",
13 |         },
14 |       },
15 |     },
16 |   );
17 | };
```

packages/supabase/src/client/job.ts
```
1 | import { createClient as createSupabaseClient } from "@supabase/supabase-js";
2 | import type { Database } from "../types/db";
3 |
4 | export const createClient = () =>
5 |   createSupabaseClient<Database>(
6 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
7 |     process.env.SUPABASE_SERVICE_KEY!,
8 |     {
9 |       global: {
10 |         headers: {
11 |           "sb-lb-routing-mode": "alpha-all-services",
12 |         },
13 |       },
14 |     },
15 |   );
```

packages/supabase/src/client/middleware.ts
```
1 | import { type CookieOptions, createServerClient } from "@supabase/ssr";
2 | import type { NextRequest, NextResponse } from "next/server";
3 |
4 | export async function updateSession(
5 |   request: NextRequest,
6 |   response: NextResponse,
7 | ) {
8 |   const supabase = createServerClient(
9 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
10 |     process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
11 |     {
12 |       global: {
13 |         headers: {
14 |           // https://supabase.com/docs/guides/platform/read-replicas#experimental-routing
15 |           "sb-lb-routing-mode": "alpha-all-services",
16 |         },
17 |       },
18 |       cookies: {
19 |         get(name: string) {
20 |           return request.cookies.get(name)?.value;
21 |         },
22 |         set(name: string, value: string, options: CookieOptions) {
23 |           request.cookies.set({ name, value, ...options });
24 |           response.cookies.set({ name, value, ...options });
25 |         },
26 |         remove(name: string, options: CookieOptions) {
27 |           request.cookies.set({ name, value: "", ...options });
28 |           response.cookies.set({ name, value: "", ...options });
29 |         },
30 |       },
31 |     },
32 |   );
33 |
34 |   await supabase.auth.getUser();
35 |
36 |   return response;
37 | }
```

packages/supabase/src/client/server.ts
```
1 | import { type CookieOptions, createServerClient } from "@supabase/ssr";
2 | import { cookies, headers } from "next/headers";
3 | import type { Database } from "../types";
4 |
5 | const conWarn = console.warn;
6 | const conLog = console.log;
7 |
8 | const IGNORE_WARNINGS = [
9 |   "Using the user object as returned from supabase.auth.getSession()",
10 | ];
11 |
12 | console.warn = (...args) => {
13 |   const match = args.find((arg) =>
14 |     typeof arg === "string"
15 |       ? IGNORE_WARNINGS.find((warning) => arg.includes(warning))
16 |       : false,
17 |   );
18 |   if (!match) {
19 |     conWarn(...args);
20 |   }
21 | };
22 |
23 | console.log = (...args) => {
24 |   const match = args.find((arg) =>
25 |     typeof arg === "string"
26 |       ? IGNORE_WARNINGS.find((warning) => arg.includes(warning))
27 |       : false,
28 |   );
29 |   if (!match) {
30 |     conLog(...args);
31 |   }
32 | };
33 |
34 | type CreateClientOptions = {
35 |   admin?: boolean;
36 |   schema?: "public" | "storage";
37 | };
38 |
39 | export const createClient = (options?: CreateClientOptions) => {
40 |   const { admin = false, ...rest } = options ?? {};
41 |
42 |   const cookieStore = cookies();
43 |
44 |   const key = admin
45 |     ? process.env.SUPABASE_SERVICE_KEY!
46 |     : process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
47 |
48 |   const auth = admin
49 |     ? {
50 |         persistSession: false,
51 |         autoRefreshToken: false,
52 |         detectSessionInUrl: false,
53 |       }
54 |     : {};
55 |
56 |   return createServerClient<Database>(
57 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
58 |     key,
59 |     {
60 |       ...rest,
61 |       cookies: {
62 |         get(name: string) {
63 |           return cookieStore.get(name)?.value;
64 |         },
65 |         set(name: string, value: string, options: CookieOptions) {
66 |           try {
67 |             cookieStore.set({ name, value, ...options });
68 |           } catch (error) {}
69 |         },
70 |         remove(name: string, options: CookieOptions) {
71 |           try {
72 |             cookieStore.set({ name, value: "", ...options });
73 |           } catch (error) {}
74 |         },
75 |       },
76 |       auth,
77 |       global: {
78 |         headers: {
79 |           // Pass user agent from browser
80 |           "user-agent": headers().get("user-agent") as string,
81 |           // https://supabase.com/docs/guides/platform/read-replicas#experimental-routing
82 |           "sb-lb-routing-mode": "alpha-all-services",
83 |         },
84 |       },
85 |     },
86 |   );
87 | };
```

packages/supabase/src/mutations/index.ts
```
1 | import { getAccessValidForDays } from "@midday/engine/gocardless/utils";
2 | import { addDays } from "date-fns";
3 | import { getCurrentUserTeamQuery, getUserInviteQuery } from "../queries";
4 | import type { Client } from "../types";
5 |
6 | type CreateBankConnectionPayload = {
7 |   accounts: {
8 |     account_id: string;
9 |     institution_id: string;
10 |     logo_url: string;
11 |     name: string;
12 |     bank_name: string;
13 |     currency: string;
14 |     enabled: boolean;
15 |     balance: number;
16 |     type: "depository" | "credit" | "other_asset" | "loan" | "other_liability";
17 |     account_reference: string | null;
18 |   }[];
19 |   balance: number;
20 |   accessToken?: string;
21 |   enrollmentId?: string;
22 |   referenceId?: string;
23 |   teamId: string;
24 |   userId: string;
25 |   provider: "gocardless" | "teller" | "plaid";
26 | };
27 |
28 | export async function createBankConnection(
29 |   supabase: Client,
30 |   {
31 |     accounts,
32 |     accessToken,
33 |     enrollmentId,
34 |     referenceId,
35 |     teamId,
36 |     userId,
37 |     provider,
38 |   }: CreateBankConnectionPayload,
39 | ) {
40 |   // Get first account to create a bank connection
41 |   const account = accounts?.at(0);
42 |
43 |   if (!account) {
44 |     return;
45 |   }
46 |
47 |   // NOTE: GoCardLess connection expires after 90-180 days
48 |   const expiresAt =
49 |     provider === "gocardless"
50 |       ? addDays(
51 |           new Date(),
52 |           getAccessValidForDays({ institutionId: account.institution_id }),
53 |         ).toDateString()
54 |       : undefined;
55 |
56 |   const bankConnection = await supabase
57 |     .from("bank_connections")
58 |     .upsert(
59 |       {
60 |         institution_id: account.institution_id,
61 |         name: account.bank_name,
62 |         logo_url: account.logo_url,
63 |         team_id: teamId,
64 |         provider,
65 |         access_token: accessToken,
66 |         enrollment_id: enrollmentId,
67 |         reference_id: referenceId,
68 |         expires_at: expiresAt,
69 |       },
70 |       {
71 |         onConflict: "institution_id, team_id",
72 |       },
73 |     )
74 |     .select()
75 |     .single();
76 |
77 |   await supabase.from("bank_accounts").upsert(
78 |     accounts.map(
79 |       (account) => ({
80 |         account_id: account.account_id,
81 |         bank_connection_id: bankConnection?.data?.id,
82 |         team_id: teamId,
83 |         created_by: userId,
84 |         name: account.name,
85 |         currency: account.currency,
86 |         enabled: account.enabled,
87 |         type: account.type,
88 |         account_reference: account.account_reference,
89 |         balance: account.balance ?? 0,
90 |       }),
91 |       {
92 |         onConflict: "account_id",
93 |       },
94 |     ),
95 |   );
96 |
97 |   return bankConnection;
98 | }
99 |
100 | type UpdateBankConnectionData = {
101 |   id: string;
102 |   referenceId?: string;
103 | };
104 |
105 | // NOTE: Only GoCardLess needs to be updated
106 | export async function updateBankConnection(
107 |   supabase: Client,
108 |   data: UpdateBankConnectionData,
109 | ) {
110 |   const { id, referenceId } = data;
111 |
112 |   return await supabase
113 |     .from("bank_connections")
114 |     .update({
115 |       expires_at: addDays(
116 |         new Date(),
117 |         getAccessValidForDays({ institutionId: id }),
118 |       ).toDateString(),
119 |       reference_id: referenceId,
120 |     })
121 |     .eq("id", id)
122 |     .select()
123 |     .single();
124 | }
125 |
126 | type CreateTransactionsData = {
127 |   transactions: any[];
128 |   teamId: string;
129 | };
130 |
131 | export async function createTransactions(
132 |   supabase: Client,
133 |   data: CreateTransactionsData,
134 | ) {
135 |   const { transactions, teamId } = data;
136 |
137 |   return supabase.from("transactions").insert(
138 |     transactions.map((transaction) => ({
139 |       ...transaction,
140 |       team_id: teamId,
141 |     })),
142 |   );
143 | }
144 |
145 | export async function updateTransaction(
146 |   supabase: Client,
147 |   id: string,
148 |   data: any,
149 | ) {
150 |   return supabase
151 |     .from("transactions")
152 |     .update(data)
153 |     .eq("id", id)
154 |     .select("id, category, category_slug, team_id, name, status, internal")
155 |     .single();
156 | }
157 |
158 | export async function updateUser(supabase: Client, data: any) {
159 |   const {
160 |     data: { session },
161 |   } = await supabase.auth.getSession();
162 |
163 |   if (!session?.user) {
164 |     return;
165 |   }
166 |
167 |   return supabase
168 |     .from("users")
169 |     .update(data)
170 |     .eq("id", session.user.id)
171 |     .select()
172 |     .single();
173 | }
174 |
175 | export async function deleteUser(supabase: Client) {
176 |   const {
177 |     data: { session },
178 |   } = await supabase.auth.getSession();
179 |
180 |   if (!session?.user) {
181 |     return;
182 |   }
183 |
184 |   await Promise.all([
185 |     supabase.auth.admin.deleteUser(session.user.id),
186 |     supabase.from("users").delete().eq("id", session.user.id),
187 |     supabase.auth.signOut(),
188 |   ]);
189 |
190 |   return session.user.id;
191 | }
192 |
193 | export async function updateTeam(supabase: Client, data: any) {
[TRUNCATED]
```

packages/supabase/src/queries/cached-queries.ts
```
1 | import "server-only";
2 |
3 | import { unstable_cache } from "next/cache";
4 | import { cache } from "react";
5 | import { createClient } from "../client/server";
6 | import {
7 |   type GetBurnRateQueryParams,
8 |   type GetCategoriesParams,
9 |   type GetCustomersQueryParams,
10 |   type GetExpensesQueryParams,
11 |   type GetInvoiceSummaryParams,
12 |   type GetInvoicesQueryParams,
13 |   type GetMetricsParams,
14 |   type GetRunwayQueryParams,
15 |   type GetSpendingParams,
16 |   type GetTeamBankAccountsParams,
17 |   type GetTrackerProjectsQueryParams,
18 |   type GetTrackerRecordsByRangeParams,
19 |   type GetTransactionsParams,
20 |   getBankAccountsBalancesQuery,
21 |   getBankAccountsCurrenciesQuery,
22 |   getBankConnectionsByTeamIdQuery,
23 |   getBurnRateQuery,
24 |   getCategoriesQuery,
25 |   getCustomersQuery,
26 |   getExpensesQuery,
27 |   getInvoiceSummaryQuery,
28 |   getInvoiceTemplatesQuery,
29 |   getInvoicesQuery,
30 |   getLastInvoiceNumberQuery,
31 |   getMetricsQuery,
32 |   getPaymentStatusQuery,
33 |   getRunwayQuery,
34 |   getSpendingQuery,
35 |   getTagsQuery,
36 |   getTeamBankAccountsQuery,
37 |   getTeamInvitesQuery,
38 |   getTeamMembersQuery,
39 |   getTeamSettingsQuery,
40 |   getTeamUserQuery,
41 |   getTeamsByUserIdQuery,
42 |   getTrackerProjectsQuery,
43 |   getTrackerRecordsByRangeQuery,
44 |   getTransactionsQuery,
45 |   getUserInvitesQuery,
46 |   getUserQuery,
47 | } from "../queries";
48 |
49 | export const getTransactions = async (
50 |   params: Omit<GetTransactionsParams, "teamId">,
51 | ) => {
52 |   const supabase = createClient();
53 |   const user = await getUser();
54 |   const teamId = user?.data?.team_id;
55 |
56 |   if (!teamId) {
57 |     return null;
58 |   }
59 |
60 |   return unstable_cache(
61 |     async () => {
62 |       return getTransactionsQuery(supabase, { ...params, teamId });
63 |     },
64 |     ["transactions", teamId],
65 |     {
66 |       revalidate: 600,
67 |       tags: [`transactions_${teamId}`],
68 |     },
69 |   )(params);
70 | };
71 |
72 | // Cache per request
73 | export const getSession = cache(async () => {
74 |   const supabase = createClient();
75 |
76 |   return supabase.auth.getSession();
77 | });
78 |
79 | // Cache per request and revalidate every 30 minutes
80 | export const getUser = cache(async () => {
81 |   const {
82 |     data: { session },
83 |   } = await getSession();
84 |
85 |   const userId = session?.user?.id;
86 |
87 |   if (!userId) {
88 |     return null;
89 |   }
90 |
91 |   const supabase = createClient();
92 |
93 |   return unstable_cache(
94 |     async () => {
95 |       return getUserQuery(supabase, userId);
96 |     },
97 |     ["user", userId],
98 |     {
99 |       tags: [`user_${userId}`],
100 |       // 30 minutes, jwt expires in 1 hour
101 |       revalidate: 1800,
102 |     },
103 |   )();
104 | });
105 |
106 | export const getTeamUser = async () => {
107 |   const supabase = createClient();
108 |   const { data } = await getUser();
109 |
110 |   return unstable_cache(
111 |     async () => {
112 |       return getTeamUserQuery(supabase, {
113 |         userId: data.id,
114 |         teamId: data.team_id,
115 |       });
116 |     },
117 |     ["team", "user", data.id],
118 |     {
119 |       tags: [`team_user_${data.id}`],
120 |       revalidate: 1800,
121 |     },
122 |   )(data.id);
123 | };
124 |
125 | export const getBankConnectionsByTeamId = async () => {
126 |   const supabase = createClient();
127 |   const user = await getUser();
128 |   const teamId = user?.data?.team_id;
129 |
130 |   if (!teamId) {
131 |     return null;
132 |   }
133 |
134 |   return unstable_cache(
135 |     async () => {
136 |       return getBankConnectionsByTeamIdQuery(supabase, teamId);
137 |     },
138 |     ["bank_connections", teamId],
139 |     {
140 |       tags: [`bank_connections_${teamId}`],
141 |       revalidate: 3600,
142 |     },
143 |   )(teamId);
144 | };
145 |
146 | export const getTeamBankAccounts = async (
147 |   params?: Omit<GetTeamBankAccountsParams, "teamId">,
148 | ) => {
149 |   const supabase = createClient();
150 |
151 |   const user = await getUser();
152 |   const teamId = user?.data?.team_id;
153 |
154 |   if (!teamId) {
155 |     return null;
156 |   }
157 |
158 |   return unstable_cache(
159 |     async () => {
160 |       return getTeamBankAccountsQuery(supabase, { ...params, teamId });
161 |     },
162 |     ["bank_accounts", teamId],
163 |     {
164 |       tags: [`bank_accounts_${teamId}`],
165 |       revalidate: 180,
166 |     },
167 |   )(params);
168 | };
169 |
170 | export const getTeamMembers = async () => {
171 |   const supabase = createClient();
172 |
173 |   const user = await getUser();
174 |   const teamId = user?.data?.team_id;
175 |
176 |   if (!teamId) {
177 |     return null;
178 |   }
179 |
180 |   return unstable_cache(
181 |     async () => {
182 |       return getTeamMembersQuery(supabase, teamId);
183 |     },
184 |     ["team_members", teamId],
185 |     {
186 |       tags: [`team_members_${teamId}`],
187 |       revalidate: 180,
188 |     },
189 |   )(teamId);
190 | };
191 |
192 | export const getSpending = async (
193 |   params: Omit<GetSpendingParams, "teamId">,
194 | ) => {
195 |   const supabase = createClient();
196 |   const user = await getUser();
197 |   const teamId = user?.data?.team_id;
198 |
199 |   if (!teamId) {
200 |     return null;
[TRUNCATED]
```

packages/supabase/src/queries/client.ts
```
1 | export { useQuery } from "@supabase-cache-helpers/postgrest-react-query";
```

packages/supabase/src/queries/index.ts
```
1 | import { UTCDate } from "@date-fns/utc";
2 | import {
3 |   addDays,
4 |   endOfMonth,
5 |   formatISO,
6 |   isWithinInterval,
7 |   startOfMonth,
8 |   subYears,
9 | } from "date-fns";
10 | import type { Client } from "../types";
11 |
12 | function transactionCategory(transaction) {
13 |   return (
14 |     transaction?.category ?? {
15 |       id: "uncategorized",
16 |       name: "Uncategorized",
17 |       color: "#606060",
18 |     }
19 |   );
20 | }
21 |
22 | export function getPercentageIncrease(a: number, b: number) {
23 |   return a > 0 && b > 0 ? Math.abs(((a - b) / b) * 100).toFixed() : 0;
24 | }
25 |
26 | export async function getUserQuery(supabase: Client, userId: string) {
27 |   return supabase
28 |     .from("users")
29 |     .select(
30 |       `
31 |       *,
32 |       team:team_id(*)
33 |     `,
34 |     )
35 |     .eq("id", userId)
36 |     .single()
37 |     .throwOnError();
38 | }
39 |
40 | export async function getCurrentUserTeamQuery(supabase: Client) {
41 |   const {
42 |     data: { session },
43 |   } = await supabase.auth.getSession();
44 |
45 |   if (!session?.user) {
46 |     return;
47 |   }
48 |
49 |   return getUserQuery(supabase, session.user?.id);
50 | }
51 |
52 | export async function getBankConnectionsByTeamIdQuery(
53 |   supabase: Client,
54 |   teamId: string,
55 | ) {
56 |   return supabase
57 |     .from("bank_connections")
58 |     .select("*")
59 |     .eq("team_id", teamId)
60 |     .throwOnError();
61 | }
62 |
63 | export type GetTeamBankAccountsParams = {
64 |   teamId: string;
65 |   enabled?: boolean;
66 | };
67 |
68 | export async function getTeamBankAccountsQuery(
69 |   supabase: Client,
70 |   params: GetTeamBankAccountsParams,
71 | ) {
72 |   const { teamId, enabled } = params;
73 |
74 |   const query = supabase
75 |     .from("bank_accounts")
76 |     .select("*, bank:bank_connections(*)")
77 |     .eq("team_id", teamId)
78 |     .order("created_at", { ascending: true })
79 |     .order("name", { ascending: false })
80 |     .throwOnError();
81 |
82 |   if (enabled) {
83 |     query.eq("enabled", enabled);
84 |   }
85 |
86 |   return query;
87 | }
88 |
89 | export async function getTeamMembersQuery(supabase: Client, teamId: string) {
90 |   const { data } = await supabase
91 |     .from("users_on_team")
92 |     .select(
93 |       `
94 |       id,
95 |       role,
96 |       team_id,
97 |       user:users(id, full_name, avatar_url, email)
98 |     `,
99 |     )
100 |     .eq("team_id", teamId)
101 |     .order("created_at")
102 |     .throwOnError();
103 |
104 |   return {
105 |     data,
106 |   };
107 | }
108 |
109 | type GetTeamUserParams = {
110 |   teamId: string;
111 |   userId: string;
112 | };
113 |
114 | export async function getTeamUserQuery(
115 |   supabase: Client,
116 |   params: GetTeamUserParams,
117 | ) {
118 |   const { data } = await supabase
119 |     .from("users_on_team")
120 |     .select(
121 |       `
122 |       id,
123 |       role,
124 |       team_id,
125 |       user:users(id, full_name, avatar_url, email)
126 |     `,
127 |     )
128 |     .eq("team_id", params.teamId)
129 |     .eq("user_id", params.userId)
130 |     .throwOnError()
131 |     .single();
132 |
133 |   return {
134 |     data,
135 |   };
136 | }
137 |
138 | export type GetSpendingParams = {
139 |   from: string;
140 |   to: string;
141 |   teamId: string;
142 |   currency?: string;
143 | };
144 |
145 | export async function getSpendingQuery(
146 |   supabase: Client,
147 |   params: GetSpendingParams,
148 | ) {
149 |   return supabase.rpc("get_spending_v3", {
150 |     team_id: params.teamId,
151 |     date_from: params.from,
152 |     date_to: params.to,
153 |     base_currency: params.currency,
154 |   });
155 | }
156 |
157 | export type GetTransactionsParams = {
158 |   teamId: string;
159 |   to: number;
160 |   from: number;
161 |   sort?: [string, "asc" | "desc"];
162 |   searchQuery?: string;
163 |   filter?: {
164 |     statuses?: string[];
165 |     attachments?: "include" | "exclude";
166 |     categories?: string[];
167 |     tags?: string[];
168 |     accounts?: string[];
169 |     assignees?: string[];
170 |     type?: "income" | "expense";
171 |     start?: string;
172 |     end?: string;
173 |     recurring?: string[];
174 |     amount_range?: [number, number];
175 |     amount?: [string, string];
176 |   };
177 | };
178 |
179 | export async function getTransactionsQuery(
180 |   supabase: Client,
181 |   params: GetTransactionsParams,
182 | ) {
183 |   const { from = 0, to, filter, sort, teamId, searchQuery } = params;
184 |
185 |   const {
186 |     statuses,
187 |     attachments,
188 |     categories,
189 |     tags,
190 |     type,
191 |     accounts,
192 |     start,
193 |     end,
194 |     assignees,
195 |     recurring,
196 |     amount_range,
197 |     amount,
198 |   } = filter || {};
199 |
200 |   const columns = [
201 |     "id",
202 |     "date",
203 |     "amount",
204 |     "currency",
205 |     "method",
206 |     "status",
207 |     "note",
208 |     "manual",
[TRUNCATED]
```

packages/supabase/src/types/db.ts
```
1 | export type Json =
2 |   | string
3 |   | number
4 |   | boolean
5 |   | null
6 |   | { [key: string]: Json | undefined }
7 |   | Json[]
8 |
9 | export type Database = {
10 |   public: {
11 |     Tables: {
12 |       apps: {
13 |         Row: {
14 |           app_id: string
15 |           config: Json | null
16 |           created_at: string | null
17 |           created_by: string | null
18 |           id: string
19 |           settings: Json | null
20 |           team_id: string | null
21 |         }
22 |         Insert: {
23 |           app_id: string
24 |           config?: Json | null
25 |           created_at?: string | null
26 |           created_by?: string | null
27 |           id?: string
28 |           settings?: Json | null
29 |           team_id?: string | null
30 |         }
31 |         Update: {
32 |           app_id?: string
33 |           config?: Json | null
34 |           created_at?: string | null
35 |           created_by?: string | null
36 |           id?: string
37 |           settings?: Json | null
38 |           team_id?: string | null
39 |         }
40 |         Relationships: [
41 |           {
42 |             foreignKeyName: "apps_created_by_fkey"
43 |             columns: ["created_by"]
44 |             isOneToOne: false
45 |             referencedRelation: "users"
46 |             referencedColumns: ["id"]
47 |           },
48 |           {
49 |             foreignKeyName: "integrations_team_id_fkey"
50 |             columns: ["team_id"]
51 |             isOneToOne: false
52 |             referencedRelation: "teams"
53 |             referencedColumns: ["id"]
54 |           },
55 |         ]
56 |       }
57 |       bank_accounts: {
58 |         Row: {
59 |           account_id: string
60 |           account_reference: string | null
61 |           balance: number | null
62 |           bank_connection_id: string | null
63 |           base_balance: number | null
64 |           base_currency: string | null
65 |           created_at: string
66 |           created_by: string
67 |           currency: string | null
68 |           enabled: boolean
69 |           error_details: string | null
70 |           error_retries: number | null
71 |           id: string
72 |           manual: boolean | null
73 |           name: string | null
74 |           team_id: string
75 |           type: Database["public"]["Enums"]["account_type"] | null
76 |         }
77 |         Insert: {
78 |           account_id: string
79 |           account_reference?: string | null
80 |           balance?: number | null
81 |           bank_connection_id?: string | null
82 |           base_balance?: number | null
83 |           base_currency?: string | null
84 |           created_at?: string
85 |           created_by: string
86 |           currency?: string | null
87 |           enabled?: boolean
88 |           error_details?: string | null
89 |           error_retries?: number | null
90 |           id?: string
91 |           manual?: boolean | null
92 |           name?: string | null
93 |           team_id: string
94 |           type?: Database["public"]["Enums"]["account_type"] | null
95 |         }
96 |         Update: {
97 |           account_id?: string
98 |           account_reference?: string | null
99 |           balance?: number | null
100 |           bank_connection_id?: string | null
101 |           base_balance?: number | null
102 |           base_currency?: string | null
103 |           created_at?: string
104 |           created_by?: string
105 |           currency?: string | null
106 |           enabled?: boolean
107 |           error_details?: string | null
108 |           error_retries?: number | null
109 |           id?: string
110 |           manual?: boolean | null
111 |           name?: string | null
112 |           team_id?: string
113 |           type?: Database["public"]["Enums"]["account_type"] | null
114 |         }
115 |         Relationships: [
116 |           {
117 |             foreignKeyName: "bank_accounts_bank_connection_id_fkey"
118 |             columns: ["bank_connection_id"]
119 |             isOneToOne: false
120 |             referencedRelation: "bank_connections"
121 |             referencedColumns: ["id"]
122 |           },
123 |           {
124 |             foreignKeyName: "bank_accounts_created_by_fkey"
125 |             columns: ["created_by"]
126 |             isOneToOne: false
127 |             referencedRelation: "users"
128 |             referencedColumns: ["id"]
129 |           },
130 |           {
131 |             foreignKeyName: "public_bank_accounts_team_id_fkey"
132 |             columns: ["team_id"]
133 |             isOneToOne: false
134 |             referencedRelation: "teams"
135 |             referencedColumns: ["id"]
136 |           },
137 |         ]
138 |       }
139 |       bank_connections: {
140 |         Row: {
141 |           access_token: string | null
142 |           created_at: string
143 |           enrollment_id: string | null
144 |           error_details: string | null
145 |           error_retries: number | null
146 |           expires_at: string | null
147 |           id: string
148 |           institution_id: string
149 |           last_accessed: string | null
150 |           logo_url: string | null
151 |           name: string
152 |           provider: Database["public"]["Enums"]["bank_providers"] | null
153 |           reference_id: string | null
154 |           status: Database["public"]["Enums"]["connection_status"] | null
155 |           team_id: string
156 |         }
157 |         Insert: {
158 |           access_token?: string | null
159 |           created_at?: string
160 |           enrollment_id?: string | null
161 |           error_details?: string | null
[TRUNCATED]
```

packages/supabase/src/types/index.ts
```
1 | import type { SupabaseClient } from "@supabase/supabase-js";
2 | import type { Database } from "../types/db";
3 |
4 | export type Client = SupabaseClient<Database>;
5 |
6 | export * from "./db";
```

packages/supabase/src/utils/storage.ts
```
1 | import type { SupabaseClient } from "@supabase/supabase-js";
2 |
3 | export const EMPTY_FOLDER_PLACEHOLDER_FILE_NAME = ".emptyFolderPlaceholder";
4 |
5 | type UploadParams = {
6 |   file: File;
7 |   path: string[];
8 |   bucket: string;
9 | };
10 |
11 | export async function upload(
12 |   client: SupabaseClient,
13 |   { file, path, bucket }: UploadParams,
14 | ) {
15 |   const storage = client.storage.from(bucket);
16 |
17 |   const result = await storage.upload(path.join("/"), file, {
18 |     upsert: true,
19 |     cacheControl: "3600",
20 |   });
21 |
22 |   if (!result.error) {
23 |     return storage.getPublicUrl(path.join("/")).data.publicUrl;
24 |   }
25 |
26 |   throw result.error;
27 | }
28 |
29 | type RemoveParams = {
30 |   path: string[];
31 |   bucket: string;
32 | };
33 |
34 | export async function remove(
35 |   client: SupabaseClient,
36 |   { bucket, path }: RemoveParams,
37 | ) {
38 |   return client.storage
39 |     .from(bucket)
40 |     .remove([decodeURIComponent(path.join("/"))]);
41 | }
42 |
43 | type DeleteFolderParams = {
44 |   path: string[];
45 |   bucket: string;
46 | };
47 |
48 | export async function deleteFolder(
49 |   client: SupabaseClient,
50 |   { bucket, path }: DeleteFolderParams,
51 | ) {
52 |   const { data: list } = await client.storage
53 |     .from(bucket)
54 |     .list(decodeURIComponent(path.join("/")));
55 |
56 |   const filesToRemove = list?.flatMap((file) => {
57 |     // Folder, remove empty file before folder
58 |     if (!file.id) {
59 |       return [
60 |         `${decodeURIComponent(
61 |           [...path, file.name].join("/"),
62 |         )}/${EMPTY_FOLDER_PLACEHOLDER_FILE_NAME}`,
63 |         decodeURIComponent([...path, file.name].join("/")),
64 |       ];
65 |     }
66 |
67 |     return [decodeURIComponent([...path, file.name].join("/"))];
68 |   });
69 |
70 |   return client.storage.from(bucket).remove(filesToRemove);
71 | }
72 |
73 | type CreateFolderParams = {
74 |   path: string[];
75 |   name: string;
76 |   bucket: string;
77 | };
78 |
79 | export async function createFolder(
80 |   client: SupabaseClient,
81 |   { bucket, path, name }: CreateFolderParams,
82 | ) {
83 |   const fullPath = decodeURIComponent(
84 |     [...path, name, EMPTY_FOLDER_PLACEHOLDER_FILE_NAME].join("/"),
85 |   );
86 |
87 |   const { error, data } = await client.storage
88 |     .from(bucket)
89 |     .upload(fullPath, new File([], EMPTY_FOLDER_PLACEHOLDER_FILE_NAME));
90 |
91 |   if (error) {
92 |     throw Error(error.message);
93 |   }
94 |
95 |   return data;
96 | }
97 |
98 | type DownloadParams = {
99 |   path: string;
100 |   bucket: string;
101 | };
102 |
103 | export async function download(
104 |   client: SupabaseClient,
105 |   { bucket, path }: DownloadParams,
106 | ) {
107 |   return client.storage.from(bucket).download(path);
108 | }
109 |
110 | type ShareParams = {
111 |   path: string;
112 |   bucket: string;
113 |   expireIn: number;
114 |   options?: {
115 |     download?: boolean;
116 |   };
117 | };
118 |
119 | export async function share(
120 |   client: SupabaseClient,
121 |   { bucket, path, expireIn, options }: ShareParams,
122 | ) {
123 |   return client.storage.from(bucket).createSignedUrl(path, expireIn, options);
124 | }
```

packages/ui/src/components/accordion.stories.tsx
```
1 | import type { Meta, StoryObj } from "@storybook/react";
2 | import {
3 |   Accordion,
4 |   AccordionContent,
5 |   AccordionItem,
6 |   AccordionTrigger,
7 | } from "./accordion";
8 |
9 | const meta: Meta<typeof Accordion> = {
10 |   component: () => (
11 |     <Accordion type="single" collapsible className="w-full max-w-[500px]">
12 |       <AccordionItem value="item-1">
13 |         <AccordionTrigger>Is it accessible?</AccordionTrigger>
14 |         <AccordionContent>
15 |           Yes. It adheres to the WAI-ARIA design pattern.
16 |         </AccordionContent>
17 |       </AccordionItem>
18 |       <AccordionItem value="item-2">
19 |         <AccordionTrigger>Is it styled?</AccordionTrigger>
20 |         <AccordionContent>
21 |           Yes. It comes with default styles that matches the other
22 |           components&apos; aesthetic.
23 |         </AccordionContent>
24 |       </AccordionItem>
25 |       <AccordionItem value="item-3">
26 |         <AccordionTrigger>Is it animated?</AccordionTrigger>
27 |         <AccordionContent>
28 |           Yes. It&apos;s animated by default, but you can disable it if you
29 |           prefer.
30 |         </AccordionContent>
31 |       </AccordionItem>
32 |     </Accordion>
33 |   ),
34 | };
35 |
36 | export default meta;
37 |
38 | type Story = StoryObj<typeof Accordion>;
39 |
40 | export const Default: Story = {};
```

packages/ui/src/components/accordion.tsx
```
1 | "use client";
2 |
3 | import * as AccordionPrimitive from "@radix-ui/react-accordion";
4 | import { ChevronDown } from "lucide-react";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const Accordion = AccordionPrimitive.Root;
9 |
10 | const AccordionItem = React.forwardRef<
11 |   React.ElementRef<typeof AccordionPrimitive.Item>,
12 |   React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
13 | >(({ className, ...props }, ref) => (
14 |   <AccordionPrimitive.Item
15 |     ref={ref}
16 |     className={cn("border-b border-border", className)}
17 |     {...props}
18 |   />
19 | ));
20 | AccordionItem.displayName = "AccordionItem";
21 | const AccordionTrigger = React.forwardRef<
22 |   React.ElementRef<typeof AccordionPrimitive.Trigger>,
23 |   React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger> & {
24 |     chevronBefore?: boolean;
25 |   }
26 | >(({ className, children, chevronBefore, ...props }, ref) => (
27 |   <AccordionPrimitive.Header className="flex w-full">
28 |     <AccordionPrimitive.Trigger
29 |       ref={ref}
30 |       className={cn(
31 |         "flex flex-1 items-center justify-between py-4 font-medium transition-all [&[data-state=open]>svg]:rotate-180",
32 |         chevronBefore && "[&[data-state=open]>svg]:rotate-0",
33 |         className,
34 |       )}
35 |       {...props}
36 |     >
37 |       {chevronBefore && (
38 |         <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200 -rotate-90" />
39 |       )}
40 |       {children}
41 |       {!chevronBefore && (
42 |         <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
43 |       )}
44 |     </AccordionPrimitive.Trigger>
45 |   </AccordionPrimitive.Header>
46 | ));
47 | AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName;
48 |
49 | const AccordionContent = React.forwardRef<
50 |   React.ElementRef<typeof AccordionPrimitive.Content>,
51 |   React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
52 | >(({ className, children, ...props }, ref) => (
53 |   <AccordionPrimitive.Content
54 |     ref={ref}
55 |     className={cn(
56 |       "overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",
57 |       className,
58 |     )}
59 |     {...props}
60 |   >
61 |     <div className="pb-4 pt-0">{children}</div>
62 |   </AccordionPrimitive.Content>
63 | ));
64 | AccordionContent.displayName = AccordionPrimitive.Content.displayName;
65 |
66 | export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };
```

packages/ui/src/components/alert-dialog.stories.tsx
```
1 | import type { Meta, StoryObj } from "@storybook/react";
2 | import {
3 |   AlertDialog,
4 |   AlertDialogAction,
5 |   AlertDialogCancel,
6 |   AlertDialogContent,
7 |   AlertDialogDescription,
8 |   AlertDialogFooter,
9 |   AlertDialogHeader,
10 |   AlertDialogTitle,
11 |   AlertDialogTrigger,
12 | } from "./alert-dialog";
13 | import { Button } from "./button";
14 |
15 | const meta: Meta<typeof AlertDialog> = {
16 |   component: () => (
17 |     <AlertDialog>
18 |       <AlertDialogTrigger asChild>
19 |         <Button variant="outline">Show Dialog</Button>
20 |       </AlertDialogTrigger>
21 |       <AlertDialogContent>
22 |         <AlertDialogHeader>
23 |           <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
24 |           <AlertDialogDescription>
25 |             This action cannot be undone. This will permanently delete your
26 |             account and remove your data from our servers.
27 |           </AlertDialogDescription>
28 |         </AlertDialogHeader>
29 |         <AlertDialogFooter>
30 |           <AlertDialogCancel>Cancel</AlertDialogCancel>
31 |           <AlertDialogAction>Continue</AlertDialogAction>
32 |         </AlertDialogFooter>
33 |       </AlertDialogContent>
34 |     </AlertDialog>
35 |   ),
36 | };
37 |
38 | export default meta;
39 |
40 | type Story = StoryObj<typeof AlertDialog>;
41 |
42 | export const Default: Story = {};
```

packages/ui/src/components/alert-dialog.tsx
```
1 | "use client";
2 |
3 | import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 | import { buttonVariants } from "./button";
7 |
8 | const AlertDialog = AlertDialogPrimitive.Root;
9 |
10 | const AlertDialogTrigger = AlertDialogPrimitive.Trigger;
11 |
12 | const AlertDialogPortal = AlertDialogPrimitive.Portal;
13 |
14 | const AlertDialogOverlay = React.forwardRef<
15 |   React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
16 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
17 | >(({ className, children, ...props }, ref) => (
18 |   <AlertDialogPrimitive.Overlay
19 |     className={cn(
20 |       "fixed inset-0 z-50 bg-[#f6f6f3]/60 dark:bg-[#121212]/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
21 |       className
22 |     )}
23 |     {...props}
24 |     ref={ref}
25 |   />
26 | ));
27 | AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName;
28 |
29 | const AlertDialogContent = React.forwardRef<
30 |   React.ElementRef<typeof AlertDialogPrimitive.Content>,
31 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
32 | >(({ className, ...props }, ref) => (
33 |   <AlertDialogPortal>
34 |     <AlertDialogOverlay />
35 |     <AlertDialogPrimitive.Content
36 |       ref={ref}
37 |       className={cn(
38 |         "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] md:w-full",
39 |         className
40 |       )}
41 |       {...props}
42 |     />
43 |   </AlertDialogPortal>
44 | ));
45 | AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName;
46 |
47 | const AlertDialogHeader = ({
48 |   className,
49 |   ...props
50 | }: React.HTMLAttributes<HTMLDivElement>) => (
51 |   <div
52 |     className={cn(
53 |       "flex flex-col space-y-2 text-center sm:text-left",
54 |       className
55 |     )}
56 |     {...props}
57 |   />
58 | );
59 | AlertDialogHeader.displayName = "AlertDialogHeader";
60 |
61 | const AlertDialogFooter = ({
62 |   className,
63 |   ...props
64 | }: React.HTMLAttributes<HTMLDivElement>) => (
65 |   <div
66 |     className={cn(
67 |       "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
68 |       className
69 |     )}
70 |     {...props}
71 |   />
72 | );
73 | AlertDialogFooter.displayName = "AlertDialogFooter";
74 |
75 | const AlertDialogTitle = React.forwardRef<
76 |   React.ElementRef<typeof AlertDialogPrimitive.Title>,
77 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
78 | >(({ className, ...props }, ref) => (
79 |   <AlertDialogPrimitive.Title
80 |     ref={ref}
81 |     className={cn("text-lg font-medium", className)}
82 |     {...props}
83 |   />
84 | ));
85 | AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName;
86 |
87 | const AlertDialogDescription = React.forwardRef<
88 |   React.ElementRef<typeof AlertDialogPrimitive.Description>,
89 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
90 | >(({ className, ...props }, ref) => (
91 |   <AlertDialogPrimitive.Description
92 |     ref={ref}
93 |     className={cn("text-sm text-[#606060]", className)}
94 |     {...props}
95 |   />
96 | ));
97 | AlertDialogDescription.displayName =
98 |   AlertDialogPrimitive.Description.displayName;
99 |
100 | const AlertDialogAction = React.forwardRef<
101 |   React.ElementRef<typeof AlertDialogPrimitive.Action>,
102 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
103 | >(({ className, ...props }, ref) => (
104 |   <AlertDialogPrimitive.Action
105 |     ref={ref}
106 |     className={cn(buttonVariants(), className)}
107 |     {...props}
108 |   />
109 | ));
110 | AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName;
111 |
112 | const AlertDialogCancel = React.forwardRef<
113 |   React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
114 |   React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
115 | >(({ className, ...props }, ref) => (
116 |   <AlertDialogPrimitive.Cancel
117 |     ref={ref}
118 |     className={cn(
119 |       buttonVariants({ variant: "outline" }),
120 |       "mt-2 sm:mt-0",
121 |       className
122 |     )}
123 |     {...props}
124 |   />
125 | ));
126 | AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName;
127 |
128 | export {
129 |   AlertDialog,
130 |   AlertDialogPortal,
131 |   AlertDialogOverlay,
132 |   AlertDialogTrigger,
133 |   AlertDialogContent,
134 |   AlertDialogHeader,
135 |   AlertDialogFooter,
136 |   AlertDialogTitle,
137 |   AlertDialogDescription,
138 |   AlertDialogAction,
139 |   AlertDialogCancel,
140 | };
```

packages/ui/src/components/alert.tsx
```
1 | import { type VariantProps, cva } from "class-variance-authority";
2 | import * as React from "react";
3 | import { cn } from "../utils";
4 |
5 | const alertVariants = cva(
6 |   "relative w-full border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
7 |   {
8 |     variants: {
9 |       variant: {
10 |         default: "bg-background text-foreground",
11 |         destructive:
12 |           "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
13 |         warning: "dark:border-[#4a2800] dark:bg-[#1f1400]",
14 |       },
15 |     },
16 |     defaultVariants: {
17 |       variant: "default",
18 |     },
19 |   }
20 | );
21 |
22 | const Alert = React.forwardRef<
23 |   HTMLDivElement,
24 |   React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
25 | >(({ className, variant, ...props }, ref) => (
26 |   <div
27 |     ref={ref}
28 |     role="alert"
29 |     className={cn(alertVariants({ variant }), className)}
30 |     {...props}
31 |   />
32 | ));
33 | Alert.displayName = "Alert";
34 |
35 | const AlertTitle = React.forwardRef<
36 |   HTMLParagraphElement,
37 |   React.HTMLAttributes<HTMLHeadingElement>
38 | >(({ className, ...props }, ref) => (
39 |   <h5
40 |     ref={ref}
41 |     className={cn("mb-1 font-medium leading-none tracking-tight", className)}
42 |     {...props}
43 |   />
44 | ));
45 | AlertTitle.displayName = "AlertTitle";
46 |
47 | const AlertDescription = React.forwardRef<
48 |   HTMLParagraphElement,
49 |   React.HTMLAttributes<HTMLParagraphElement>
50 | >(({ className, ...props }, ref) => (
51 |   <div
52 |     ref={ref}
53 |     className={cn("text-sm [&_p]:leading-relaxed", className)}
54 |     {...props}
55 |   />
56 | ));
57 | AlertDescription.displayName = "AlertDescription";
58 |
59 | export { Alert, AlertTitle, AlertDescription };
```

packages/ui/src/components/animated-size-container.tsx
```
1 | import { motion } from "framer-motion";
2 | import {
3 |   type ComponentPropsWithoutRef,
4 |   type PropsWithChildren,
5 |   forwardRef,
6 |   useRef,
7 | } from "react";
8 | import { useResizeObserver } from "../hooks";
9 | import { cn } from "../utils";
10 |
11 | type AnimatedSizeContainerProps = PropsWithChildren<{
12 |   width?: boolean;
13 |   height?: boolean;
14 | }> &
15 |   Omit<ComponentPropsWithoutRef<typeof motion.div>, "animate" | "children">;
16 |
17 | /**
18 |  * A container with animated width and height (each optional) based on children dimensions
19 |  */
20 | const AnimatedSizeContainer = forwardRef<
21 |   HTMLDivElement,
22 |   AnimatedSizeContainerProps
23 | >(
24 |   (
25 |     {
26 |       width = false,
27 |       height = false,
28 |       className,
29 |       transition,
30 |       children,
31 |       ...rest
32 |     }: AnimatedSizeContainerProps,
33 |     forwardedRef,
34 |   ) => {
35 |     const containerRef = useRef<HTMLDivElement>(null);
36 |     const resizeObserverEntry = useResizeObserver(containerRef);
37 |
38 |     return (
39 |       <motion.div
40 |         ref={forwardedRef}
41 |         className={cn("overflow-hidden", className)}
42 |         animate={{
43 |           width: width
44 |             ? resizeObserverEntry?.contentRect?.width ?? "auto"
45 |             : "auto",
46 |           height: height
47 |             ? resizeObserverEntry?.contentRect?.height ?? "auto"
48 |             : "auto",
49 |         }}
50 |         transition={transition ?? { type: "spring", duration: 0.3 }}
51 |         {...rest}
52 |       >
53 |         <div
54 |           ref={containerRef}
55 |           className={cn(height && "h-max", width && "w-max")}
56 |         >
57 |           {children}
58 |         </div>
59 |       </motion.div>
60 |     );
61 |   },
62 | );
63 |
64 | AnimatedSizeContainer.displayName = "AnimatedSizeContainer";
65 |
66 | export { AnimatedSizeContainer };
```

packages/ui/src/components/avatar.stories.tsx
```
1 | import type { Meta, StoryObj } from "@storybook/react";
2 | import { Avatar, AvatarFallback, AvatarImage } from "./avatar";
3 |
4 | const meta: Meta<typeof Avatar> = {
5 |   component: () => (
6 |     <Avatar>
7 |       <AvatarImage src="https://github.com/shadcn.png" alt="@shadcn" />
8 |       <AvatarFallback>CN</AvatarFallback>
9 |     </Avatar>
10 |   ),
11 | };
12 |
13 | export default meta;
14 |
15 | type Story = StoryObj<typeof Avatar>;
16 |
17 | export const Default: Story = {};
```

packages/ui/src/components/avatar.tsx
```
1 | "use client";
2 |
3 | import * as AvatarPrimitive from "@radix-ui/react-avatar";
4 | import Image from "next/image";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const Avatar = React.forwardRef<
9 |   React.ElementRef<typeof AvatarPrimitive.Root>,
10 |   React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
11 | >(({ className, ...props }, ref) => (
12 |   <AvatarPrimitive.Root
13 |     ref={ref}
14 |     className={cn(
15 |       "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
16 |       className,
17 |     )}
18 |     {...props}
19 |   />
20 | ));
21 | Avatar.displayName = AvatarPrimitive.Root.displayName;
22 |
23 | export const AvatarImageNext = React.forwardRef<
24 |   React.ElementRef<typeof Image>,
25 |   React.ComponentPropsWithoutRef<typeof Image>
26 | >(({ className, onError, ...props }, ref) => {
27 |   const [hasError, setHasError] = React.useState(false);
28 |
29 |   if (hasError || !props.src) {
30 |     return null;
31 |   }
32 |
33 |   return (
34 |     <Image
35 |       ref={ref}
36 |       className={cn("aspect-square h-full w-full absolute z-10", className)}
37 |       onError={(e) => {
38 |         setHasError(true);
39 |         onError?.(e);
40 |       }}
41 |       {...props}
42 |     />
43 |   );
44 | });
45 |
46 | AvatarImageNext.displayName = "AvatarImageNext";
47 |
48 | const AvatarImage = React.forwardRef<
49 |   React.ElementRef<typeof AvatarPrimitive.Image>,
50 |   React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
51 | >(({ className, ...props }, ref) => (
52 |   <AvatarPrimitive.Image
53 |     ref={ref}
54 |     className={cn("aspect-square h-full w-full", className)}
55 |     {...props}
56 |   />
57 | ));
58 | AvatarImage.displayName = AvatarPrimitive.Image.displayName;
59 |
60 | const AvatarFallback = React.forwardRef<
61 |   React.ElementRef<typeof AvatarPrimitive.Fallback>,
62 |   React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
63 | >(({ className, ...props }, ref) => (
64 |   <AvatarPrimitive.Fallback
65 |     ref={ref}
66 |     className={cn(
67 |       "flex h-full w-full items-center justify-center rounded-full bg-accent",
68 |       className,
69 |     )}
70 |     {...props}
71 |   />
72 | ));
73 | AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName;
74 |
75 | export { Avatar, AvatarImage, AvatarFallback };
```

packages/ui/src/components/badge.tsx
```
1 | import { type VariantProps, cva } from "class-variance-authority";
2 | import type * as React from "react";
3 | import { cn } from "../utils";
4 |
5 | const badgeVariants = cva(
6 |   "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
7 |   {
8 |     variants: {
9 |       variant: {
10 |         default:
11 |           "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
12 |         secondary:
13 |           "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
14 |         destructive:
15 |           "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
16 |         outline: "text-foreground",
17 |         tag: "font-mono text-[#878787] bg-[#F2F1EF] text-[10px] dark:bg-[#1D1D1D] border-none font-normal rounded-none",
18 |       },
19 |     },
20 |     defaultVariants: {
21 |       variant: "default",
22 |     },
23 |   },
24 | );
25 |
26 | export interface BadgeProps
27 |   extends React.HTMLAttributes<HTMLDivElement>,
28 |     VariantProps<typeof badgeVariants> {}
29 |
30 | function Badge({ className, variant, ...props }: BadgeProps) {
31 |   return (
32 |     <div className={cn(badgeVariants({ variant }), className)} {...props} />
33 |   );
34 | }
35 |
36 | export { Badge, badgeVariants };
```

packages/ui/src/components/breadcrumb.tsx
```
1 | import { ChevronRightIcon, DotsHorizontalIcon } from "@radix-ui/react-icons";
2 | import { Slot } from "@radix-ui/react-slot";
3 | import * as React from "react";
4 | import { cn } from "../utils";
5 |
6 | const Breadcrumb = React.forwardRef<
7 |   HTMLElement,
8 |   React.ComponentPropsWithoutRef<"nav"> & {
9 |     separator?: React.ReactNode;
10 |   }
11 | >(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />);
12 | Breadcrumb.displayName = "Breadcrumb";
13 |
14 | const BreadcrumbList = React.forwardRef<
15 |   HTMLOListElement,
16 |   React.ComponentPropsWithoutRef<"ol">
17 | >(({ className, ...props }, ref) => (
18 |   <ol
19 |     ref={ref}
20 |     className={cn(
21 |       "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
22 |       className
23 |     )}
24 |     {...props}
25 |   />
26 | ));
27 | BreadcrumbList.displayName = "BreadcrumbList";
28 |
29 | const BreadcrumbItem = React.forwardRef<
30 |   HTMLLIElement,
31 |   React.ComponentPropsWithoutRef<"li">
32 | >(({ className, ...props }, ref) => (
33 |   <li
34 |     ref={ref}
35 |     className={cn("inline-flex items-center gap-1.5", className)}
36 |     {...props}
37 |   />
38 | ));
39 | BreadcrumbItem.displayName = "BreadcrumbItem";
40 |
41 | const BreadcrumbLink = React.forwardRef<
42 |   HTMLAnchorElement,
43 |   React.ComponentPropsWithoutRef<"a"> & {
44 |     asChild?: boolean;
45 |   }
46 | >(({ asChild, className, ...props }, ref) => {
47 |   const Comp = asChild ? Slot : "a";
48 |
49 |   return (
50 |     <Comp
51 |       ref={ref}
52 |       className={cn("transition-colors hover:text-foreground", className)}
53 |       {...props}
54 |     />
55 |   );
56 | });
57 | BreadcrumbLink.displayName = "BreadcrumbLink";
58 |
59 | const BreadcrumbPage = React.forwardRef<
60 |   HTMLSpanElement,
61 |   React.ComponentPropsWithoutRef<"span">
62 | >(({ className, ...props }, ref) => (
63 |   <span
64 |     ref={ref}
65 |     role="link"
66 |     aria-disabled="true"
67 |     aria-current="page"
68 |     className={cn("font-normal text-foreground", className)}
69 |     {...props}
70 |   />
71 | ));
72 | BreadcrumbPage.displayName = "BreadcrumbPage";
73 |
74 | const BreadcrumbSeparator = ({
75 |   children,
76 |   className,
77 |   ...props
78 | }: React.ComponentProps<"li">) => (
79 |   <li
80 |     role="presentation"
81 |     aria-hidden="true"
82 |     className={cn("[&>svg]:size-3.5", className)}
83 |     {...props}
84 |   >
85 |     {children ?? <ChevronRightIcon />}
86 |   </li>
87 | );
88 | BreadcrumbSeparator.displayName = "BreadcrumbSeparator";
89 |
90 | const BreadcrumbEllipsis = ({
91 |   className,
92 |   ...props
93 | }: React.ComponentProps<"span">) => (
94 |   <span
95 |     role="presentation"
96 |     aria-hidden="true"
97 |     className={cn("flex h-9 w-9 items-center justify-center", className)}
98 |     {...props}
99 |   >
100 |     <DotsHorizontalIcon className="h-4 w-4" />
101 |     <span className="sr-only">More</span>
102 |   </span>
103 | );
104 | BreadcrumbEllipsis.displayName = "BreadcrumbElipssis";
105 |
106 | export {
107 |   Breadcrumb,
108 |   BreadcrumbList,
109 |   BreadcrumbItem,
110 |   BreadcrumbLink,
111 |   BreadcrumbPage,
112 |   BreadcrumbSeparator,
113 |   BreadcrumbEllipsis,
114 | };
```

packages/ui/src/components/button.stories.tsx
```
1 | import type { Meta, StoryObj } from "@storybook/react";
2 | import { ChevronRight } from "lucide-react";
3 | import { Button } from "./button";
4 |
5 | const meta: Meta<typeof Button> = {
6 |   component: Button,
7 | };
8 |
9 | export default meta;
10 |
11 | type Story = StoryObj<typeof Button>;
12 |
13 | export const Primary: Story = {
14 |   args: {
15 |     children: "Button",
16 |   },
17 | };
18 |
19 | export const Secondary: Story = {
20 |   args: {
21 |     children: "Button",
22 |     variant: "secondary",
23 |   },
24 | };
25 |
26 | export const Destructive: Story = {
27 |   args: {
28 |     children: "Button",
29 |     variant: "destructive",
30 |   },
31 | };
32 |
33 | export const Outline: Story = {
34 |   args: {
35 |     children: "Button",
36 |     variant: "outline",
37 |   },
38 | };
39 |
40 | export const Ghost: Story = {
41 |   args: {
42 |     children: "Button",
43 |     variant: "ghost",
44 |   },
45 | };
46 |
47 | export const Icon: Story = {
48 |   args: {
49 |     children: <ChevronRight />,
50 |     variant: "outline",
51 |     size: "icon",
52 |   },
53 | };
```

packages/ui/src/components/button.tsx
```
1 | import { Slot } from "@radix-ui/react-slot";
2 | import { type VariantProps, cva } from "class-variance-authority";
3 | import * as React from "react";
4 | import { cn } from "../utils";
5 |
6 | const buttonVariants = cva(
7 |   "inline-flex items-center justify-center text-sm font-medium transition-colors focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",
8 |   {
9 |     variants: {
10 |       variant: {
11 |         default: "bg-primary text-primary-foreground hover:bg-primary/90",
12 |         destructive:
13 |           "bg-destructive text-destructive-foreground hover:bg-destructive/90",
14 |         outline:
15 |           "border border bg-transparent hover:bg-accent hover:text-accent-foreground",
16 |         secondary:
17 |           "bg-secondary text-secondary-foreground hover:bg-secondary/80",
18 |         ghost: "hover:bg-accent hover:text-accent-foreground",
19 |         link: "text-primary underline-offset-4 hover:underline",
20 |       },
21 |       size: {
22 |         default: "h-9 px-4 py-2",
23 |         sm: "h-8 px-3 text-xs",
24 |         lg: "h-10 px-8",
25 |         icon: "h-9 w-9",
26 |       },
27 |     },
28 |     defaultVariants: {
29 |       variant: "default",
30 |       size: "default",
31 |     },
32 |   },
33 | );
34 |
35 | export interface ButtonProps
36 |   extends React.ButtonHTMLAttributes<HTMLButtonElement>,
37 |     VariantProps<typeof buttonVariants> {
38 |   asChild?: boolean;
39 | }
40 |
41 | const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
42 |   ({ className, variant, size, asChild = false, ...props }, ref) => {
43 |     const Comp = asChild ? Slot : "button";
44 |     return (
45 |       <Comp
46 |         className={cn(buttonVariants({ variant, size, className }))}
47 |         ref={ref}
48 |         {...props}
49 |       />
50 |     );
51 |   },
52 | );
53 | Button.displayName = "Button";
54 |
55 | export { Button, buttonVariants };
```

packages/ui/src/components/calendar.stories.tsx
```
1 | import type { Meta, StoryObj } from "@storybook/react";
2 | import { Calendar } from "./calendar";
3 |
4 | const meta: Meta<typeof Calendar> = {
5 |   component: () => (
6 |     <Calendar
7 |       mode="single"
8 |       selected={new Date("2024-01-01")}
9 |       onSelect={() => {}}
10 |       className="rounded-md border"
11 |     />
12 |   ),
13 | };
14 |
15 | export default meta;
16 |
17 | type Story = StoryObj<typeof Calendar>;
18 |
19 | export const Default: Story = {};
```

packages/ui/src/components/calendar.tsx
```
1 | "use client";
2 |
3 | import { ChevronLeft, ChevronRight } from "lucide-react";
4 | import type * as React from "react";
5 | import { DayPicker } from "react-day-picker";
6 | import { cn } from "../utils";
7 | import { buttonVariants } from "./button";
8 |
9 | export type CalendarProps = React.ComponentProps<typeof DayPicker>;
10 |
11 | function Calendar({
12 |   className,
13 |   classNames,
14 |   showOutsideDays = true,
15 |   ...props
16 | }: CalendarProps) {
17 |   return (
18 |     <DayPicker
19 |       showOutsideDays={showOutsideDays}
20 |       className={cn("p-3", className)}
21 |       classNames={{
22 |         months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
23 |         month: "space-y-4",
24 |         caption: "flex justify-center pt-1 relative items-center",
25 |         caption_label: "text-sm font-medium",
26 |         nav: "space-x-1 flex items-center",
27 |         nav_button: cn(
28 |           buttonVariants({ variant: "outline" }),
29 |           "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",
30 |         ),
31 |         nav_button_previous: "absolute left-1",
32 |         nav_button_next: "absolute right-1",
33 |         table: "w-full border-collapse space-y-1",
34 |         head_row: "flex",
35 |         head_cell:
36 |           "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
37 |         row: "flex w-full mt-2",
38 |         cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
39 |         day: cn(
40 |           buttonVariants({ variant: "ghost" }),
41 |           "h-9 w-9 p-0 font-normal aria-selected:opacity-100",
42 |         ),
43 |         day_range_end: "day-range-end",
44 |         day_selected:
45 |           "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
46 |         day_today: "bg-accent text-accent-foreground",
47 |         day_outside:
48 |           "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
49 |         day_disabled: "text-muted-foreground opacity-50",
50 |         day_range_middle:
51 |           "aria-selected:bg-accent aria-selected:text-accent-foreground",
52 |         day_hidden: "invisible",
53 |         ...classNames,
54 |       }}
55 |       components={{
56 |         IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,
57 |         IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,
58 |       }}
59 |       {...props}
60 |     />
61 |   );
62 | }
63 | Calendar.displayName = "Calendar";
64 |
65 | export { Calendar };
```

packages/ui/src/components/card.tsx
```
1 | import * as React from "react";
2 | import { cn } from "../utils";
3 |
4 | const Card = React.forwardRef<
5 |   HTMLDivElement,
6 |   React.HTMLAttributes<HTMLDivElement>
7 | >(({ className, ...props }, ref) => (
8 |   <div
9 |     ref={ref}
10 |     className={cn("border bg-background text-card-foreground", className)}
11 |     {...props}
12 |   />
13 | ));
14 | Card.displayName = "Card";
15 |
16 | const CardHeader = React.forwardRef<
17 |   HTMLDivElement,
18 |   React.HTMLAttributes<HTMLDivElement>
19 | >(({ className, ...props }, ref) => (
20 |   <div
21 |     ref={ref}
22 |     className={cn("flex flex-col space-y-1.5 p-6", className)}
23 |     {...props}
24 |   />
25 | ));
26 | CardHeader.displayName = "CardHeader";
27 |
28 | const CardTitle = React.forwardRef<
29 |   HTMLParagraphElement,
30 |   React.HTMLAttributes<HTMLHeadingElement>
31 | >(({ className, ...props }, ref) => (
32 |   <h3
33 |     ref={ref}
34 |     className={cn(
35 |       "text-lg font-medium leading-none tracking-tight mb-2",
36 |       className
37 |     )}
38 |     {...props}
39 |   />
40 | ));
41 | CardTitle.displayName = "CardTitle";
42 |
43 | const CardDescription = React.forwardRef<
44 |   HTMLParagraphElement,
45 |   React.HTMLAttributes<HTMLParagraphElement>
46 | >(({ className, ...props }, ref) => (
47 |   <p ref={ref} className={cn("text-sm text-[#606060]", className)} {...props} />
48 | ));
49 | CardDescription.displayName = "CardDescription";
50 |
51 | const CardContent = React.forwardRef<
52 |   HTMLDivElement,
53 |   React.HTMLAttributes<HTMLDivElement>
54 | >(({ className, ...props }, ref) => (
55 |   <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
56 | ));
57 | CardContent.displayName = "CardContent";
58 |
59 | const CardFooter = React.forwardRef<
60 |   HTMLDivElement,
61 |   React.HTMLAttributes<HTMLDivElement>
62 | >(({ className, ...props }, ref) => (
63 |   <div
64 |     ref={ref}
65 |     className={cn(
66 |       "flex items-center p-6 border-t text-xs text-[#606060]",
67 |       className
68 |     )}
69 |     {...props}
70 |   />
71 | ));
72 | CardFooter.displayName = "CardFooter";
73 |
74 | export {
75 |   Card,
76 |   CardHeader,
77 |   CardFooter,
78 |   CardTitle,
79 |   CardDescription,
80 |   CardContent,
81 | };
```

packages/ui/src/components/carousel.tsx
```
1 | "use client";
2 |
3 | import useEmblaCarousel, {
4 |   type UseEmblaCarouselType,
5 | } from "embla-carousel-react";
6 | import * as React from "react";
7 | import { cn } from "../utils";
8 | import { Button } from "./button";
9 | import { Icons } from "./icons";
10 |
11 | type CarouselApi = UseEmblaCarouselType[1];
12 | type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
13 | type CarouselOptions = UseCarouselParameters[0];
14 | type CarouselPlugin = UseCarouselParameters[1];
15 |
16 | type CarouselProps = {
17 |   opts?: CarouselOptions;
18 |   plugins?: CarouselPlugin;
19 |   orientation?: "horizontal" | "vertical";
20 |   setApi?: (api: CarouselApi) => void;
21 | };
22 |
23 | type CarouselContextProps = {
24 |   carouselRef: ReturnType<typeof useEmblaCarousel>[0];
25 |   api: ReturnType<typeof useEmblaCarousel>[1];
26 |   scrollPrev: () => void;
27 |   scrollNext: () => void;
28 |   canScrollPrev: boolean;
29 |   canScrollNext: boolean;
30 |   scrollTo: (index: number) => void;
31 | } & CarouselProps;
32 |
33 | const CarouselContext = React.createContext<CarouselContextProps | null>(null);
34 |
35 | function useCarousel() {
36 |   const context = React.useContext(CarouselContext);
37 |
38 |   if (!context) {
39 |     throw new Error("useCarousel must be used within a <Carousel />");
40 |   }
41 |
42 |   return context;
43 | }
44 |
45 | const Carousel = React.forwardRef<
46 |   HTMLDivElement,
47 |   React.HTMLAttributes<HTMLDivElement> & CarouselProps
48 | >(
49 |   (
50 |     {
51 |       orientation = "horizontal",
52 |       opts,
53 |       setApi,
54 |       plugins,
55 |       className,
56 |       children,
57 |       ...props
58 |     },
59 |     ref,
60 |   ) => {
61 |     const [carouselRef, api] = useEmblaCarousel(
62 |       {
63 |         ...opts,
64 |         axis: orientation === "horizontal" ? "x" : "y",
65 |       },
66 |       plugins,
67 |     );
68 |     const [canScrollPrev, setCanScrollPrev] = React.useState(false);
69 |     const [canScrollNext, setCanScrollNext] = React.useState(false);
70 |
71 |     const onSelect = React.useCallback((api: CarouselApi) => {
72 |       if (!api) {
73 |         return;
74 |       }
75 |
76 |       setCanScrollPrev(api.canScrollPrev());
77 |       setCanScrollNext(api.canScrollNext());
78 |     }, []);
79 |
80 |     const scrollPrev = React.useCallback(() => {
81 |       api?.scrollPrev();
82 |     }, [api]);
83 |
84 |     const scrollNext = React.useCallback(() => {
85 |       api?.scrollNext();
86 |     }, [api]);
87 |
88 |     const scrollTo = React.useCallback(
89 |       (index: number) => {
90 |         api?.scrollTo(index);
91 |       },
92 |       [api],
93 |     );
94 |
95 |     React.useEffect(() => {
96 |       if (!api || !setApi) {
97 |         return;
98 |       }
99 |
100 |       setApi(api);
101 |     }, [api, setApi]);
102 |
103 |     React.useEffect(() => {
104 |       if (!api) {
105 |         return;
106 |       }
107 |
108 |       onSelect(api);
109 |       api.on("reInit", onSelect);
110 |       api.on("select", onSelect);
111 |
112 |       return () => {
113 |         api?.off("select", onSelect);
114 |       };
115 |     }, [api, onSelect]);
116 |
117 |     return (
118 |       <CarouselContext.Provider
119 |         value={{
120 |           carouselRef,
121 |           api: api,
122 |           opts,
123 |           orientation:
124 |             orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
125 |           scrollPrev,
126 |           scrollNext,
127 |           canScrollPrev,
128 |           canScrollNext,
129 |           scrollTo,
130 |         }}
131 |       >
132 |         <div
133 |           ref={ref}
134 |           className={cn("relative", className)}
135 |           role="region"
136 |           aria-roledescription="carousel"
137 |           {...props}
138 |         >
139 |           {children}
140 |         </div>
141 |       </CarouselContext.Provider>
142 |     );
143 |   },
144 | );
145 | Carousel.displayName = "Carousel";
146 |
147 | const CarouselContent = React.forwardRef<
148 |   HTMLDivElement,
149 |   React.HTMLAttributes<HTMLDivElement>
150 | >(({ className, ...props }, ref) => {
151 |   const { carouselRef, orientation } = useCarousel();
152 |
153 |   return (
154 |     <div ref={carouselRef} className="overflow-hidden">
155 |       <div
156 |         ref={ref}
157 |         className={cn(
158 |           "flex",
159 |           orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
160 |           className,
161 |         )}
162 |         {...props}
163 |       />
164 |     </div>
165 |   );
166 | });
167 | CarouselContent.displayName = "CarouselContent";
168 |
169 | const CarouselItem = React.forwardRef<
170 |   HTMLDivElement,
171 |   React.HTMLAttributes<HTMLDivElement>
172 | >(({ className, ...props }, ref) => {
173 |   const { orientation } = useCarousel();
174 |
175 |   return (
176 |     <div
177 |       ref={ref}
178 |       role="group"
179 |       aria-roledescription="slide"
180 |       className={cn(
181 |         "min-w-0 shrink-0 grow-0 basis-full",
182 |         orientation === "horizontal" ? "pl-4" : "pt-4",
183 |         className,
184 |       )}
185 |       {...props}
186 |     />
187 |   );
188 | });
189 | CarouselItem.displayName = "CarouselItem";
190 |
191 | const CarouselPrevious = React.forwardRef<
192 |   HTMLButtonElement,
193 |   React.ComponentProps<typeof Button>
194 | >(({ className, variant = "outline", size = "icon", ...props }, ref) => {
195 |   const { orientation, scrollPrev, canScrollPrev } = useCarousel();
196 |
197 |   return (
198 |     <Button
[TRUNCATED]
```

packages/ui/src/components/chart.tsx
```
1 | "use client";
2 |
3 | import * as React from "react";
4 | import * as RechartsPrimitive from "recharts";
5 | import { cn } from "../utils";
6 |
7 | // Format: { THEME_NAME: CSS_SELECTOR }
8 | const THEMES = { light: "", dark: ".dark" } as const;
9 |
10 | export type ChartConfig = {
11 |   [k in string]: {
12 |     label?: React.ReactNode;
13 |     icon?: React.ComponentType;
14 |   } & (
15 |     | { color?: string; theme?: never }
16 |     | { color?: never; theme: Record<keyof typeof THEMES, string> }
17 |   );
18 | };
19 |
20 | type ChartContextProps = {
21 |   config: ChartConfig;
22 | };
23 |
24 | const ChartContext = React.createContext<ChartContextProps | null>(null);
25 |
26 | function useChart() {
27 |   const context = React.useContext(ChartContext);
28 |
29 |   if (!context) {
30 |     throw new Error("useChart must be used within a <ChartContainer />");
31 |   }
32 |
33 |   return context;
34 | }
35 |
36 | const ChartContainer = React.forwardRef<
37 |   HTMLDivElement,
38 |   React.ComponentProps<"div"> & {
39 |     config: ChartConfig;
40 |     children: React.ComponentProps<
41 |       typeof RechartsPrimitive.ResponsiveContainer
42 |     >["children"];
43 |   }
44 | >(({ id, className, children, config, ...props }, ref) => {
45 |   const uniqueId = React.useId();
46 |   const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;
47 |
48 |   return (
49 |     <ChartContext.Provider value={{ config }}>
50 |       <div
51 |         data-chart={chartId}
52 |         ref={ref}
53 |         className={cn(
54 |           "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
55 |           className,
56 |         )}
57 |         {...props}
58 |       >
59 |         <ChartStyle id={chartId} config={config} />
60 |         <RechartsPrimitive.ResponsiveContainer>
61 |           {children}
62 |         </RechartsPrimitive.ResponsiveContainer>
63 |       </div>
64 |     </ChartContext.Provider>
65 |   );
66 | });
67 | ChartContainer.displayName = "Chart";
68 |
69 | const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
70 |   const colorConfig = Object.entries(config).filter(
71 |     ([_, config]) => config.theme || config.color,
72 |   );
73 |
74 |   if (!colorConfig.length) {
75 |     return null;
76 |   }
77 |
78 |   return (
79 |     <style
80 |       // biome-ignore lint/security/noDangerouslySetInnerHtml: <explanation>
81 |       dangerouslySetInnerHTML={{
82 |         __html: Object.entries(THEMES)
83 |           .map(
84 |             ([theme, prefix]) => `
85 | ${prefix} [data-chart=${id}] {
86 | ${colorConfig
87 |   .map(([key, itemConfig]) => {
88 |     const color =
89 |       itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
90 |       itemConfig.color;
91 |     return color ? `  --color-${key}: ${color};` : null;
92 |   })
93 |   .join("\n")}
94 | }
95 | `,
96 |           )
97 |           .join("\n"),
98 |       }}
99 |     />
100 |   );
101 | };
102 |
103 | const ChartTooltip = RechartsPrimitive.Tooltip;
104 |
105 | const ChartTooltipContent = React.forwardRef<
106 |   HTMLDivElement,
107 |   React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
108 |     React.ComponentProps<"div"> & {
109 |       hideLabel?: boolean;
110 |       hideIndicator?: boolean;
111 |       indicator?: "line" | "dot" | "dashed";
112 |       nameKey?: string;
113 |       labelKey?: string;
114 |     }
115 | >(
116 |   (
117 |     {
118 |       active,
119 |       payload,
120 |       className,
121 |       indicator = "dot",
122 |       hideLabel = false,
123 |       hideIndicator = false,
124 |       label,
125 |       labelFormatter,
126 |       labelClassName,
127 |       formatter,
128 |       color,
129 |       nameKey,
130 |       labelKey,
131 |     },
132 |     ref,
133 |   ) => {
134 |     const { config } = useChart();
135 |
136 |     const tooltipLabel = React.useMemo(() => {
137 |       if (hideLabel || !payload?.length) {
138 |         return null;
139 |       }
140 |
141 |       const [item] = payload;
142 |       const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
143 |       const itemConfig = getPayloadConfigFromPayload(config, item, key);
144 |       const value =
145 |         !labelKey && typeof label === "string"
146 |           ? config[label as keyof typeof config]?.label || label
147 |           : itemConfig?.label;
148 |
149 |       if (labelFormatter) {
150 |         return (
151 |           <div className={cn("font-medium", labelClassName)}>
152 |             {labelFormatter(value, payload)}
153 |           </div>
154 |         );
155 |       }
156 |
157 |       if (!value) {
158 |         return null;
159 |       }
160 |
161 |       return <div className={cn("font-medium", labelClassName)}>{value}</div>;
162 |     }, [
163 |       label,
164 |       labelFormatter,
165 |       payload,
[TRUNCATED]
```

packages/ui/src/components/checkbox.tsx
```
1 | "use client";
2 |
3 | import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
4 | import { CheckIcon } from "@radix-ui/react-icons";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const Checkbox = React.forwardRef<
9 |   React.ElementRef<typeof CheckboxPrimitive.Root>,
10 |   React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
11 | >(({ className, ...props }, ref) => (
12 |   <CheckboxPrimitive.Root
13 |     ref={ref}
14 |     className={cn(
15 |       "peer h-4 w-4 shrink-0 border focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
16 |       className
17 |     )}
18 |     {...props}
19 |   >
20 |     <CheckboxPrimitive.Indicator
21 |       className={cn("flex items-center justify-center text-current")}
22 |     >
23 |       <CheckIcon className="h-4 w-4" />
24 |     </CheckboxPrimitive.Indicator>
25 |   </CheckboxPrimitive.Root>
26 | ));
27 | Checkbox.displayName = CheckboxPrimitive.Root.displayName;
28 |
29 | export { Checkbox };
```

packages/ui/src/components/collapsible.tsx
```
1 | "use client";
2 |
3 | import * as CollapsiblePrimitive from "@radix-ui/react-collapsible";
4 |
5 | const Collapsible = CollapsiblePrimitive.Root;
6 |
7 | const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger;
8 |
9 | const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent;
10 |
11 | export { Collapsible, CollapsibleTrigger, CollapsibleContent };
```

packages/ui/src/components/combobox-dropdown.tsx
```
1 | "use client";
2 |
3 | import { Check, ChevronsUpDown } from "lucide-react";
4 | import * as React from "react";
5 |
6 | import { CommandList } from "cmdk";
7 | import { cn } from "../utils";
8 | import { Button } from "./button";
9 | import {
10 |   Command,
11 |   CommandEmpty,
12 |   CommandGroup,
13 |   CommandInput,
14 |   CommandItem,
15 | } from "./command";
16 | import { Popover, PopoverContent, PopoverTrigger } from "./popover";
17 |
18 | export type ComboboxItem = {
19 |   id: string;
20 |   label: string;
21 |   disabled?: boolean;
22 | };
23 |
24 | type Props<T> = {
25 |   placeholder?: React.ReactNode;
26 |   searchPlaceholder?: string;
27 |   items: T[];
28 |   onSelect: (item: T) => void;
29 |   selectedItem?: T;
30 |   renderSelectedItem?: (selectedItem: T) => React.ReactNode;
31 |   renderOnCreate?: (value: string) => React.ReactNode;
32 |   renderListItem?: (listItem: {
33 |     isChecked: boolean;
34 |     item: T;
35 |   }) => React.ReactNode;
36 |   emptyResults?: React.ReactNode;
37 |   popoverProps?: React.ComponentProps<typeof PopoverContent>;
38 |   disabled?: boolean;
39 |   onCreate?: (value: string) => void;
40 |   headless?: boolean;
41 |   className?: string;
42 | };
43 |
44 | export function ComboboxDropdown<T extends ComboboxItem>({
45 |   headless,
46 |   placeholder,
47 |   searchPlaceholder,
48 |   items,
49 |   onSelect,
50 |   selectedItem: incomingSelectedItem,
51 |   renderSelectedItem = (item) => item.label,
52 |   renderListItem,
53 |   renderOnCreate,
54 |   emptyResults,
55 |   popoverProps,
56 |   disabled,
57 |   onCreate,
58 |   className,
59 | }: Props<T>) {
60 |   const [open, setOpen] = React.useState(false);
61 |   const [internalSelectedItem, setInternalSelectedItem] = React.useState<
62 |     T | undefined
63 |   >();
64 |   const [inputValue, setInputValue] = React.useState("");
65 |
66 |   const selectedItem = incomingSelectedItem ?? internalSelectedItem;
67 |
68 |   const filteredItems = items.filter((item) =>
69 |     item.label.toLowerCase().includes(inputValue.toLowerCase()),
70 |   );
71 |
72 |   const showCreate = onCreate && Boolean(inputValue) && !filteredItems.length;
73 |
74 |   const Component = (
75 |     <Command loop shouldFilter={false}>
76 |       <CommandInput
77 |         value={inputValue}
78 |         onValueChange={setInputValue}
79 |         placeholder={searchPlaceholder ?? "Search item..."}
80 |         className="px-3"
81 |       />
82 |
83 |       <CommandGroup>
84 |         <CommandList className="max-h-[225px] overflow-auto">
85 |           {filteredItems.map((item) => {
86 |             const isChecked = selectedItem?.id === item.id;
87 |
88 |             return (
89 |               <CommandItem
90 |                 disabled={item.disabled}
91 |                 className={cn("cursor-pointer", className)}
92 |                 key={item.id}
93 |                 value={item.id}
94 |                 onSelect={(id) => {
95 |                   const foundItem = items.find((item) => item.id === id);
96 |
97 |                   if (!foundItem) {
98 |                     console.log("No item found", id);
99 |                     return;
100 |                   }
101 |
102 |                   onSelect(foundItem);
103 |                   setInternalSelectedItem(foundItem);
104 |                   setOpen(false);
105 |                 }}
106 |               >
107 |                 {renderListItem ? (
108 |                   renderListItem({ isChecked, item })
109 |                 ) : (
110 |                   <>
111 |                     <Check
112 |                       className={cn(
113 |                         "mr-2 h-4 w-4",
114 |                         isChecked ? "opacity-100" : "opacity-0",
115 |                       )}
116 |                     />
117 |                     {item.label}
118 |                   </>
119 |                 )}
120 |               </CommandItem>
121 |             );
122 |           })}
123 |
124 |           <CommandEmpty>{emptyResults ?? "No item found"}</CommandEmpty>
125 |
126 |           {showCreate && (
127 |             <CommandItem
128 |               key={inputValue}
129 |               value={inputValue}
130 |               onSelect={() => {
131 |                 onCreate(inputValue);
132 |                 setOpen(false);
133 |                 setInputValue("");
134 |               }}
135 |               onMouseDown={(event) => {
136 |                 event.preventDefault();
137 |                 event.stopPropagation();
138 |               }}
139 |             >
140 |               {renderOnCreate ? renderOnCreate(inputValue) : null}
141 |             </CommandItem>
142 |           )}
143 |         </CommandList>
144 |       </CommandGroup>
145 |     </Command>
146 |   );
147 |
148 |   if (headless) {
149 |     return Component;
150 |   }
151 |
152 |   return (
153 |     <Popover open={open} onOpenChange={setOpen} modal>
154 |       <PopoverTrigger asChild disabled={disabled} className="w-full">
155 |         <Button
156 |           variant="outline"
157 |           aria-expanded={open}
158 |           className="w-full justify-between relative"
159 |         >
160 |           <span className="truncate text-ellipsis pr-3">
161 |             {selectedItem
162 |               ? ((
163 |                   <span className="flex items-center overflow-hidden whitespace-nowrap text-ellipsis block">
164 |                     {renderSelectedItem?.(selectedItem)}
165 |                   </span>
166 |                 ) ?? selectedItem.label)
167 |               : (placeholder ?? "Select item...")}
168 |           </span>
169 |           <ChevronsUpDown className="size-4 opacity-50 absolute right-2" />
170 |         </Button>
171 |       </PopoverTrigger>
172 |
173 |       <PopoverContent
174 |         className="p-0"
175 |         {...popoverProps}
176 |         style={{
177 |           width: "var(--radix-popover-trigger-width)",
178 |           ...popoverProps?.style,
179 |         }}
180 |       >
181 |         {Component}
182 |       </PopoverContent>
183 |     </Popover>
184 |   );
185 | }
```

packages/ui/src/components/combobox.tsx
```
1 | "use client";
2 |
3 | import { Command as CommandPrimitive } from "cmdk";
4 | import { Loader2 } from "lucide-react";
5 | import { useCallback, useRef, useState } from "react";
6 | import { cn } from "../utils";
7 | import {
8 |   CommandGroup,
9 |   CommandInput,
10 |   CommandItem,
11 |   CommandList,
12 | } from "./command";
13 | import { Icons } from "./icons";
14 |
15 | export type Option = Record<"id" | "name", string> & Record<string, string>;
16 |
17 | type ComboboxProps = {
18 |   options: Option[];
19 |   emptyMessage: string;
20 |   value?: Option;
21 |   onSelect?: (value?: Option) => void;
22 |   onCreate?: (value?: string) => void;
23 |   onRemove?: () => void;
24 |   onValueChange?: (value: string) => void;
25 |   isLoading?: boolean;
26 |   disabled?: boolean;
27 |   placeholder?: string;
28 |   className?: string;
29 |   classNameList?: string;
30 |   autoFocus?: boolean;
31 |   showIcon?: boolean;
32 |   CreateComponent?: React.ReactElement<{ value: string }>;
33 | };
34 |
35 | export const Combobox = ({
36 |   options,
37 |   placeholder,
38 |   value,
39 |   onSelect,
40 |   onRemove,
41 |   onCreate,
42 |   disabled,
43 |   className,
44 |   classNameList,
45 |   isLoading = false,
46 |   showIcon = true,
47 |   autoFocus,
48 |   onValueChange,
49 |   CreateComponent,
50 | }: ComboboxProps) => {
51 |   const inputRef = useRef<HTMLInputElement>(null);
52 |   const [isOpen, setOpen] = useState(false);
53 |   const [selected, setSelected] = useState<Option | undefined>(value as Option);
54 |   const [inputValue, setInputValue] = useState<string>(value?.name || "");
55 |
56 |   const handleOnValueChange = (value: string) => {
57 |     setInputValue(value);
58 |     onValueChange?.(value);
59 |
60 |     if (value) {
61 |       setOpen(true);
62 |     } else {
63 |       setOpen(false);
64 |     }
65 |   };
66 |
67 |   const handleOnRemove = () => {
68 |     setSelected(undefined);
69 |     setInputValue("");
70 |     onRemove?.();
71 |   };
72 |
73 |   const handleBlur = useCallback(() => {
74 |     setOpen(false);
75 |     setInputValue(selected?.name);
76 |   }, [selected]);
77 |
78 |   const handleOnFocus = () => {
79 |     if (inputValue !== value?.name) {
80 |       setOpen(true);
81 |     }
82 |   };
83 |
84 |   const handleSelectOption = useCallback(
85 |     (selectedOption: Option) => {
86 |       setInputValue(selectedOption.name);
87 |
88 |       setSelected(selectedOption);
89 |       onSelect?.(selectedOption);
90 |
91 |       // This is a hack to prevent the input from being focused after the user selects an option
92 |       // We can call this hack: "The next tick"
93 |       setTimeout(() => {
94 |         inputRef?.current?.blur();
95 |       }, 0);
96 |     },
97 |     [onSelect],
98 |   );
99 |
100 |   return (
101 |     <CommandPrimitive className="w-full">
102 |       <div className="flex items-center w-full relative">
103 |         {showIcon && (
104 |           <Icons.Search className="w-[18px] h-[18px] absolute left-4 pointer-events-none" />
105 |         )}
106 |
107 |         <CommandInput
108 |           ref={inputRef}
109 |           value={inputValue}
110 |           onValueChange={handleOnValueChange}
111 |           onBlur={handleBlur}
112 |           onFocus={handleOnFocus}
113 |           placeholder={placeholder}
114 |           disabled={disabled}
115 |           className={className}
116 |           autoFocus={autoFocus}
117 |         />
118 |
119 |         {isLoading && (
120 |           <Loader2 className="w-[16px] h-[16px] absolute right-2 animate-spin text-dark-gray" />
121 |         )}
122 |
123 |         {!isLoading && selected && onRemove && (
124 |           <Icons.Close
125 |             className="w-[18px] h-[18px] absolute right-2"
126 |             onClick={handleOnRemove}
127 |           />
128 |         )}
129 |       </div>
130 |
131 |       <div className="relative w-full">
132 |         <CommandList
133 |           className="w-full outline-none animate-in fade-in-0 zoom-in-95"
134 |           hidden={!isOpen}
135 |         >
136 |           {inputValue?.length > 0 && (
137 |             <CommandGroup
138 |               className={cn(
139 |                 "bg-background absolute z-10 w-full max-h-[250px] overflow-auto py-2 border px-2",
140 |                 classNameList,
141 |               )}
142 |             >
143 |               {options?.map(({ component: Component, ...option }) => {
144 |                 return (
145 |                   <CommandItem
146 |                     key={option.id}
147 |                     value={`${option.name}_${option.id}`}
148 |                     onMouseDown={(event) => {
149 |                       event.preventDefault();
150 |                       event.stopPropagation();
151 |                     }}
152 |                     onSelect={() => handleSelectOption(option)}
153 |                     className="flex items-center gap-2 w-full px-2"
154 |                   >
155 |                     {Component ? <Component /> : option.name}
156 |                   </CommandItem>
157 |                 );
158 |               })}
159 |
160 |               {onCreate &&
161 |                 !options?.find(
162 |                   (o) => o.name.toLowerCase() === inputValue.toLowerCase(),
163 |                 ) && (
164 |                   <CommandItem
165 |                     key={inputValue}
166 |                     value={inputValue}
167 |                     onSelect={() => onCreate(inputValue)}
168 |                     onMouseDown={(event) => {
169 |                       event.preventDefault();
170 |                       event.stopPropagation();
171 |                     }}
172 |                   >
173 |                     {CreateComponent ? (
174 |                       <CreateComponent value={inputValue} />
175 |                     ) : (
176 |                       `Create "${inputValue}"`
177 |                     )}
178 |                   </CommandItem>
179 |                 )}
180 |             </CommandGroup>
181 |           )}
[TRUNCATED]
```

packages/ui/src/components/command.tsx
```
1 | "use client";
2 |
3 | import type { DialogProps } from "@radix-ui/react-dialog";
4 | import { Command as CommandPrimitive } from "cmdk";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 | import { Dialog, DialogContent } from "./dialog";
8 |
9 | const Command = React.forwardRef<
10 |   React.ElementRef<typeof CommandPrimitive>,
11 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive>
12 | >(({ className, ...props }, ref) => (
13 |   <CommandPrimitive
14 |     ref={ref}
15 |     className={cn(
16 |       "flex h-full w-full flex-col overflow-hidden text-popover-foreground",
17 |       className,
18 |     )}
19 |     {...props}
20 |   />
21 | ));
22 | Command.displayName = CommandPrimitive.displayName;
23 |
24 | interface CommandDialogProps extends DialogProps {}
25 |
26 | const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
27 |   return (
28 |     <Dialog {...props}>
29 |       <DialogContent className="overflow-hidden p-0 max-w-[740px]" hideClose>
30 |         <Command className="h-[480px] &_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
31 |           {children}
32 |         </Command>
33 |       </DialogContent>
34 |     </Dialog>
35 |   );
36 | };
37 |
38 | const CommandInput = React.forwardRef<
39 |   React.ElementRef<typeof CommandPrimitive.Input>,
40 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
41 | >(({ className, ...props }, ref) => (
42 |   <div className="flex items-center w-full" cmdk-input-wrapper="">
43 |     <CommandPrimitive.Input
44 |       ref={ref}
45 |       className={cn(
46 |         "flex h-10 w-full bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
47 |         className,
48 |       )}
49 |       {...props}
50 |     />
51 |   </div>
52 | ));
53 |
54 | CommandInput.displayName = CommandPrimitive.Input.displayName;
55 |
56 | const CommandList = React.forwardRef<
57 |   React.ElementRef<typeof CommandPrimitive.List>,
58 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
59 | >(({ className, ...props }, ref) => (
60 |   <CommandPrimitive.List
61 |     ref={ref}
62 |     className={cn(
63 |       "max-h-[350px] w-full overflow-y-auto overflow-x-hidden",
64 |       className,
65 |     )}
66 |     {...props}
67 |   />
68 | ));
69 |
70 | CommandList.displayName = CommandPrimitive.List.displayName;
71 |
72 | const CommandEmpty = React.forwardRef<
73 |   React.ElementRef<typeof CommandPrimitive.Empty>,
74 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
75 | >((props, ref) => (
76 |   <CommandPrimitive.Empty
77 |     ref={ref}
78 |     className="py-6 text-center text-sm"
79 |     {...props}
80 |   />
81 | ));
82 |
83 | CommandEmpty.displayName = CommandPrimitive.Empty.displayName;
84 |
85 | const CommandGroup = React.forwardRef<
86 |   React.ElementRef<typeof CommandPrimitive.Group>,
87 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
88 | >(({ className, ...props }, ref) => (
89 |   <CommandPrimitive.Group
90 |     ref={ref}
91 |     className={cn(
92 |       "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
93 |       className,
94 |     )}
95 |     {...props}
96 |   />
97 | ));
98 |
99 | CommandGroup.displayName = CommandPrimitive.Group.displayName;
100 |
101 | const CommandSeparator = React.forwardRef<
102 |   React.ElementRef<typeof CommandPrimitive.Separator>,
103 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
104 | >(({ className, ...props }, ref) => (
105 |   <CommandPrimitive.Separator
106 |     ref={ref}
107 |     className={cn("-mx-1 h-px bg-border", className)}
108 |     {...props}
109 |   />
110 | ));
111 | CommandSeparator.displayName = CommandPrimitive.Separator.displayName;
112 |
113 | const CommandItem = React.forwardRef<
114 |   React.ElementRef<typeof CommandPrimitive.Item>,
115 |   React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
116 | >(({ className, ...props }, ref) => (
117 |   <CommandPrimitive.Item
118 |     ref={ref}
119 |     className={cn(
120 |       "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground",
121 |       className,
122 |     )}
123 |     {...props}
124 |   />
125 | ));
126 |
127 | CommandItem.displayName = CommandPrimitive.Item.displayName;
128 |
129 | const CommandShortcut = ({
130 |   className,
131 |   ...props
132 | }: React.HTMLAttributes<HTMLSpanElement>) => {
133 |   return (
134 |     <span
135 |       className={cn(
136 |         "ml-auto text-xs tracking-widest text-muted-foreground",
137 |         className,
138 |       )}
139 |       {...props}
140 |     />
141 |   );
142 | };
143 | CommandShortcut.displayName = "CommandShortcut";
144 |
145 | export {
146 |   Command,
147 |   CommandDialog,
148 |   CommandInput,
149 |   CommandList,
150 |   CommandEmpty,
151 |   CommandGroup,
[TRUNCATED]
```

packages/ui/src/components/context-menu.tsx
```
1 | "use client";
2 |
3 | import * as ContextMenuPrimitive from "@radix-ui/react-context-menu";
4 | import { Check, ChevronRight, Circle } from "lucide-react";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const ContextMenu = ContextMenuPrimitive.Root;
9 |
10 | const ContextMenuTrigger = ContextMenuPrimitive.Trigger;
11 |
12 | const ContextMenuGroup = ContextMenuPrimitive.Group;
13 |
14 | const ContextMenuPortal = ContextMenuPrimitive.Portal;
15 |
16 | const ContextMenuSub = ContextMenuPrimitive.Sub;
17 |
18 | const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup;
19 |
20 | const ContextMenuSubTrigger = React.forwardRef<
21 |   React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
22 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
23 |     inset?: boolean;
24 |   }
25 | >(({ className, inset, children, ...props }, ref) => (
26 |   <ContextMenuPrimitive.SubTrigger
27 |     ref={ref}
28 |     className={cn(
29 |       "flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
30 |       inset && "pl-8",
31 |       className
32 |     )}
33 |     {...props}
34 |   >
35 |     {children}
36 |     <ChevronRight className="ml-auto h-4 w-4" />
37 |   </ContextMenuPrimitive.SubTrigger>
38 | ));
39 | ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName;
40 |
41 | const ContextMenuSubContent = React.forwardRef<
42 |   React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
43 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
44 | >(({ className, ...props }, ref) => (
45 |   <ContextMenuPrimitive.SubContent
46 |     ref={ref}
47 |     className={cn(
48 |       "z-50 min-w-[8rem] overflow-hidden border bg-background p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
49 |       className
50 |     )}
51 |     {...props}
52 |   />
53 | ));
54 | ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName;
55 |
56 | const ContextMenuContent = React.forwardRef<
57 |   React.ElementRef<typeof ContextMenuPrimitive.Content>,
58 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
59 | >(({ className, ...props }, ref) => (
60 |   <ContextMenuPrimitive.Portal>
61 |     <ContextMenuPrimitive.Content
62 |       ref={ref}
63 |       className={cn(
64 |         "z-50 min-w-[8rem] overflow-hidden border bg-background p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
65 |         className
66 |       )}
67 |       {...props}
68 |     />
69 |   </ContextMenuPrimitive.Portal>
70 | ));
71 | ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName;
72 |
73 | const ContextMenuItem = React.forwardRef<
74 |   React.ElementRef<typeof ContextMenuPrimitive.Item>,
75 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
76 |     inset?: boolean;
77 |   }
78 | >(({ className, inset, ...props }, ref) => (
79 |   <ContextMenuPrimitive.Item
80 |     ref={ref}
81 |     className={cn(
82 |       "relative flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
83 |       inset && "pl-8",
84 |       className
85 |     )}
86 |     {...props}
87 |   />
88 | ));
89 | ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName;
90 |
91 | const ContextMenuCheckboxItem = React.forwardRef<
92 |   React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
93 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
94 | >(({ className, children, checked, ...props }, ref) => (
95 |   <ContextMenuPrimitive.CheckboxItem
96 |     ref={ref}
97 |     className={cn(
98 |       "relative flex cursor-default select-none items-center py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
99 |       className
100 |     )}
101 |     checked={checked}
102 |     {...props}
103 |   >
104 |     <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
105 |       <ContextMenuPrimitive.ItemIndicator>
106 |         <Check className="h-4 w-4" />
107 |       </ContextMenuPrimitive.ItemIndicator>
108 |     </span>
109 |     {children}
110 |   </ContextMenuPrimitive.CheckboxItem>
111 | ));
112 | ContextMenuCheckboxItem.displayName =
113 |   ContextMenuPrimitive.CheckboxItem.displayName;
114 |
115 | const ContextMenuRadioItem = React.forwardRef<
116 |   React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
117 |   React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
118 | >(({ className, children, ...props }, ref) => (
119 |   <ContextMenuPrimitive.RadioItem
120 |     ref={ref}
121 |     className={cn(
[TRUNCATED]
```

packages/ui/src/components/currency-input.tsx
```
1 | import { NumericFormat, type NumericFormatProps } from "react-number-format";
2 | import { Input } from "./input";
3 |
4 | export function CurrencyInput({
5 |   thousandSeparator = true,
6 |   ...props
7 | }: NumericFormatProps) {
8 |   return (
9 |     <NumericFormat
10 |       thousandSeparator={thousandSeparator}
11 |       customInput={Input}
12 |       {...props}
13 |     />
14 |   );
15 | }
```

packages/ui/src/components/date-range-picker.tsx
```
1 | "use client";
2 |
3 | import type React from "react";
4 | import type { DateRange } from "react-day-picker";
5 | import { cn } from "../utils";
6 | import { Button } from "./button";
7 | import { Calendar } from "./calendar";
8 | import { Icons } from "./icons";
9 | import { Popover, PopoverContent, PopoverTrigger } from "./popover";
10 |
11 | type Props = {
12 |   range: DateRange;
13 |   className: React.HTMLAttributes<HTMLDivElement>;
14 |   onSelect: (range?: DateRange) => void;
15 |   placeholder: string;
16 |   disabled?: boolean;
17 | };
18 |
19 | export function DateRangePicker({
20 |   className,
21 |   range,
22 |   disabled,
23 |   onSelect,
24 |   placeholder,
25 | }: Props) {
26 |   return (
27 |     <div className={cn("grid gap-2", className)}>
28 |       <Popover>
29 |         <PopoverTrigger asChild disabled={disabled}>
30 |           <Button
31 |             variant="outline"
32 |             className={cn("justify-start text-left font-medium space-x-2")}
33 |           >
34 |             <span>{placeholder}</span>
35 |             <Icons.ChevronDown />
36 |           </Button>
37 |         </PopoverTrigger>
38 |         <PopoverContent className="w-auto p-0 mt-2" align="end">
39 |           <Calendar
40 |             initialFocus
41 |             mode="range"
42 |             defaultMonth={range?.from}
43 |             selected={range}
44 |             onSelect={onSelect}
45 |             numberOfMonths={2}
46 |           />
47 |         </PopoverContent>
48 |       </Popover>
49 |     </div>
50 |   );
51 | }
```

packages/ui/src/components/dialog.tsx
```
1 | "use client";
2 |
3 | import * as DialogPrimitive from "@radix-ui/react-dialog";
4 | import { Cross2Icon } from "@radix-ui/react-icons";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const Dialog = DialogPrimitive.Root;
9 |
10 | const DialogTrigger = DialogPrimitive.Trigger;
11 |
12 | const DialogPortal = DialogPrimitive.Portal;
13 |
14 | const DialogOverlay = React.forwardRef<
15 |   React.ElementRef<typeof DialogPrimitive.Overlay>,
16 |   React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
17 | >(({ className, ...props }, ref) => (
18 |   <DialogPrimitive.Overlay
19 |     ref={ref}
20 |     className={cn(
21 |       "fixed inset-0 z-50 bg-[#f6f6f3]/60 dark:bg-[#121212]/80 data-[state=closed]:animate-[dialog-overlay-hide_100ms] data-[state=open]:animate-[dialog-overlay-show_100ms]",
22 |       className,
23 |     )}
24 |     {...props}
25 |   />
26 | ));
27 | DialogOverlay.displayName = DialogPrimitive.Overlay.displayName;
28 |
29 | const DialogContent = React.forwardRef<
30 |   React.ElementRef<typeof DialogPrimitive.Content>,
31 |   React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
32 | >(({ className, children, hideClose, ...props }, ref) => (
33 |   <DialogPortal>
34 |     <DialogOverlay />
35 |     <DialogPrimitive.Content
36 |       ref={ref}
37 |       className={cn(
38 |         "bg-background border-border border fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90vw] max-w-xl dark:p-px text-primary z-50 data-[state=closed]:animate-[dialog-content-hide_100ms] data-[state=open]:animate-[dialog-content-show_100ms]",
39 |         className,
40 |       )}
41 |       {...props}
42 |     >
43 |       {children}
44 |
45 |       {!hideClose && (
46 |         <DialogPrimitive.Close className="absolute right-6 top-6 opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
47 |           <Cross2Icon className="h-4 w-4" />
48 |           <span className="sr-only">Close</span>
49 |         </DialogPrimitive.Close>
50 |       )}
51 |     </DialogPrimitive.Content>
52 |   </DialogPortal>
53 | ));
54 | DialogContent.displayName = DialogPrimitive.Content.displayName;
55 |
56 | const DialogContentFrameless = React.forwardRef<
57 |   React.ElementRef<typeof DialogPrimitive.Content>,
58 |   React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
59 | >(({ className, children, ...props }, ref) => (
60 |   <DialogPortal>
61 |     <DialogOverlay />
62 |     <DialogPrimitive.Content
63 |       ref={ref}
64 |       className={cn(
65 |         "fixed bg-background top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90vw] max-w-xl border dark:border-none dark:p-px text-primary z-50 data-[state=closed]:animate-[dialog-content-hide_100ms] data-[state=open]:animate-[dialog-content-show_100ms]",
66 |         className,
67 |       )}
68 |       {...props}
69 |     >
70 |       {children}
71 |     </DialogPrimitive.Content>
72 |   </DialogPortal>
73 | ));
74 |
75 | const DialogHeader = ({
76 |   className,
77 |   ...props
78 | }: React.HTMLAttributes<HTMLDivElement>) => (
79 |   <div
80 |     className={cn("flex flex-col space-y-1.5 text-left", className)}
81 |     {...props}
82 |   />
83 | );
84 | DialogHeader.displayName = "DialogHeader";
85 |
86 | const DialogFooter = ({
87 |   className,
88 |   ...props
89 | }: React.HTMLAttributes<HTMLDivElement>) => (
90 |   <div
91 |     className={cn(
92 |       "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
93 |       className,
94 |     )}
95 |     {...props}
96 |   />
97 | );
98 | DialogFooter.displayName = "DialogFooter";
99 |
100 | const DialogTitle = React.forwardRef<
101 |   React.ElementRef<typeof DialogPrimitive.Title>,
102 |   React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
103 | >(({ className, ...props }, ref) => (
104 |   <DialogPrimitive.Title
105 |     ref={ref}
106 |     className={cn(
107 |       "text-lg font-semibold leading-none tracking-tight mb-4",
108 |       className,
109 |     )}
110 |     {...props}
111 |   />
112 | ));
113 | DialogTitle.displayName = DialogPrimitive.Title.displayName;
114 |
115 | const DialogDescription = React.forwardRef<
116 |   React.ElementRef<typeof DialogPrimitive.Description>,
117 |   React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
118 | >(({ className, ...props }, ref) => (
119 |   <DialogPrimitive.Description
120 |     ref={ref}
121 |     className={cn("text-sm text-[#878787]", className)}
122 |     {...props}
123 |   />
124 | ));
125 | DialogDescription.displayName = DialogPrimitive.Description.displayName;
126 |
127 | export {
128 |   Dialog,
129 |   DialogPortal,
130 |   DialogOverlay,
131 |   DialogTrigger,
132 |   DialogContent,
133 |   DialogHeader,
134 |   DialogFooter,
135 |   DialogTitle,
136 |   DialogDescription,
137 |   DialogContentFrameless,
138 | };
```

packages/ui/src/components/drawer.tsx
```
1 | "use client";
2 |
3 | import * as React from "react";
4 | import { Drawer as DrawerPrimitive } from "vaul";
5 | import { cn } from "../utils";
6 |
7 | const Drawer = ({
8 |   shouldScaleBackground = true,
9 |   ...props
10 | }: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
11 |   <DrawerPrimitive.Root
12 |     shouldScaleBackground={shouldScaleBackground}
13 |     {...props}
14 |   />
15 | );
16 | Drawer.displayName = "Drawer";
17 |
18 | const DrawerTrigger = DrawerPrimitive.Trigger;
19 |
20 | const DrawerPortal = DrawerPrimitive.Portal;
21 |
22 | const DrawerClose = DrawerPrimitive.Close;
23 |
24 | const DrawerOverlay = React.forwardRef<
25 |   React.ElementRef<typeof DrawerPrimitive.Overlay>,
26 |   React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
27 | >(({ className, ...props }, ref) => (
28 |   <DrawerPrimitive.Overlay
29 |     ref={ref}
30 |     className={cn("fixed inset-0 z-50 bg-black/80", className)}
31 |     {...props}
32 |   />
33 | ));
34 | DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName;
35 |
36 | const DrawerContent = React.forwardRef<
37 |   React.ElementRef<typeof DrawerPrimitive.Content>,
38 |   React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
39 | >(({ className, children, ...props }, ref) => (
40 |   <DrawerPortal>
41 |     <DrawerOverlay />
42 |     <DrawerPrimitive.Content
43 |       ref={ref}
44 |       className={cn(
45 |         "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
46 |         className
47 |       )}
48 |       {...props}
49 |     >
50 |       <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-accent" />
51 |       {children}
52 |     </DrawerPrimitive.Content>
53 |   </DrawerPortal>
54 | ));
55 | DrawerContent.displayName = "DrawerContent";
56 |
57 | const DrawerHeader = ({
58 |   className,
59 |   ...props
60 | }: React.HTMLAttributes<HTMLDivElement>) => (
61 |   <div
62 |     className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
63 |     {...props}
64 |   />
65 | );
66 | DrawerHeader.displayName = "DrawerHeader";
67 |
68 | const DrawerFooter = ({
69 |   className,
70 |   ...props
71 | }: React.HTMLAttributes<HTMLDivElement>) => (
72 |   <div
73 |     className={cn("mt-auto flex flex-col gap-2 p-4", className)}
74 |     {...props}
75 |   />
76 | );
77 | DrawerFooter.displayName = "DrawerFooter";
78 |
79 | const DrawerTitle = React.forwardRef<
80 |   React.ElementRef<typeof DrawerPrimitive.Title>,
81 |   React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
82 | >(({ className, ...props }, ref) => (
83 |   <DrawerPrimitive.Title
84 |     ref={ref}
85 |     className={cn(
86 |       "text-lg font-semibold leading-none tracking-tight",
87 |       className
88 |     )}
89 |     {...props}
90 |   />
91 | ));
92 | DrawerTitle.displayName = DrawerPrimitive.Title.displayName;
93 |
94 | const DrawerDescription = React.forwardRef<
95 |   React.ElementRef<typeof DrawerPrimitive.Description>,
96 |   React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
97 | >(({ className, ...props }, ref) => (
98 |   <DrawerPrimitive.Description
99 |     ref={ref}
100 |     className={cn("text-sm text-muted-foreground", className)}
101 |     {...props}
102 |   />
103 | ));
104 | DrawerDescription.displayName = DrawerPrimitive.Description.displayName;
105 |
106 | export {
107 |   Drawer,
108 |   DrawerPortal,
109 |   DrawerOverlay,
110 |   DrawerTrigger,
111 |   DrawerClose,
112 |   DrawerContent,
113 |   DrawerHeader,
114 |   DrawerFooter,
115 |   DrawerTitle,
116 |   DrawerDescription,
117 | };
```

packages/ui/src/components/dropdown-menu.tsx
```
1 | "use client";
2 |
3 | import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";
4 | import {
5 |   CheckIcon,
6 |   ChevronRightIcon,
7 |   DotFilledIcon,
8 | } from "@radix-ui/react-icons";
9 | import * as React from "react";
10 | import { cn } from "../utils";
11 |
12 | const DropdownMenu = DropdownMenuPrimitive.Root;
13 |
14 | const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;
15 |
16 | const DropdownMenuGroup = DropdownMenuPrimitive.Group;
17 |
18 | const DropdownMenuPortal = DropdownMenuPrimitive.Portal;
19 |
20 | const DropdownMenuSub = DropdownMenuPrimitive.Sub;
21 |
22 | const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;
23 |
24 | const DropdownMenuSubTrigger = React.forwardRef<
25 |   React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
26 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
27 |     inset?: boolean;
28 |   }
29 | >(({ className, inset, children, ...props }, ref) => (
30 |   <DropdownMenuPrimitive.SubTrigger
31 |     ref={ref}
32 |     className={cn(
33 |       "flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
34 |       inset && "pl-8",
35 |       className,
36 |     )}
37 |     {...props}
38 |   >
39 |     {children}
40 |     <ChevronRightIcon className="ml-auto h-4 w-4" />
41 |   </DropdownMenuPrimitive.SubTrigger>
42 | ));
43 | DropdownMenuSubTrigger.displayName =
44 |   DropdownMenuPrimitive.SubTrigger.displayName;
45 |
46 | const DropdownMenuSubContent = React.forwardRef<
47 |   React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
48 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
49 | >(({ className, ...props }, ref) => (
50 |   <DropdownMenuPrimitive.SubContent
51 |     ref={ref}
52 |     className={cn(
53 |       "z-50 min-w-[8rem] overflow-hidden border bg-background p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
54 |       className,
55 |     )}
56 |     {...props}
57 |   />
58 | ));
59 | DropdownMenuSubContent.displayName =
60 |   DropdownMenuPrimitive.SubContent.displayName;
61 |
62 | const DropdownMenuContent = React.forwardRef<
63 |   React.ElementRef<typeof DropdownMenuPrimitive.Content>,
64 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
65 | >(({ className, sideOffset = 4, ...props }, ref) => (
66 |   <DropdownMenuPrimitive.Portal>
67 |     <DropdownMenuPrimitive.Content
68 |       ref={ref}
69 |       sideOffset={sideOffset}
70 |       className={cn(
71 |         "z-50 min-w-[8rem] overflow-hidden border bg-background p-1 text-popover-foreground shadow-md",
72 |         "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
73 |         className,
74 |       )}
75 |       {...props}
76 |     />
77 |   </DropdownMenuPrimitive.Portal>
78 | ));
79 | DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;
80 |
81 | const DropdownMenuItem = React.forwardRef<
82 |   React.ElementRef<typeof DropdownMenuPrimitive.Item>,
83 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
84 |     inset?: boolean;
85 |     asDialogTrigger?: boolean;
86 |   }
87 | >(({ className, inset, asDialogTrigger, ...props }, ref) => (
88 |   <DropdownMenuPrimitive.Item
89 |     ref={ref}
90 |     className={cn(
91 |       "relative flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
92 |       inset && "pl-8",
93 |       className,
94 |     )}
95 |     {...(asDialogTrigger && { onSelect: (evt) => evt.preventDefault() })}
96 |     {...props}
97 |   />
98 | ));
99 | DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;
100 |
101 | const DropdownMenuCheckboxItem = React.forwardRef<
102 |   React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
103 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
104 | >(({ className, children, checked, ...props }, ref) => (
105 |   <DropdownMenuPrimitive.CheckboxItem
106 |     ref={ref}
107 |     className={cn(
108 |       "relative flex cursor-default select-none items-center py-1.5 pl-4 pr-12 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
109 |       className,
110 |     )}
111 |     checked={checked}
112 |     {...props}
113 |   >
114 |     {children}
115 |
116 |     <span className="absolute right-2 flex h-2 w-2 items-center justify-center">
117 |       <DropdownMenuPrimitive.ItemIndicator>
118 |         <CheckIcon className="h-4 w-4" />
119 |       </DropdownMenuPrimitive.ItemIndicator>
120 |     </span>
121 |   </DropdownMenuPrimitive.CheckboxItem>
122 | ));
123 | DropdownMenuCheckboxItem.displayName =
124 |   DropdownMenuPrimitive.CheckboxItem.displayName;
125 |
126 | const DropdownMenuRadioItem = React.forwardRef<
127 |   React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
128 |   React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
[TRUNCATED]
```

packages/ui/src/components/form.tsx
```
1 | import type * as LabelPrimitive from "@radix-ui/react-label";
2 | import { Slot } from "@radix-ui/react-slot";
3 | import * as React from "react";
4 | import {
5 |   Controller,
6 |   type ControllerProps,
7 |   type FieldPath,
8 |   type FieldValues,
9 |   FormProvider,
10 |   useFormContext,
11 | } from "react-hook-form";
12 | import { cn } from "../utils";
13 | import { Label } from "./label";
14 |
15 | const Form = FormProvider;
16 |
17 | type FormFieldContextValue<
18 |   TFieldValues extends FieldValues = FieldValues,
19 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
20 | > = {
21 |   name: TName;
22 | };
23 |
24 | const FormFieldContext = React.createContext<FormFieldContextValue>(
25 |   {} as FormFieldContextValue,
26 | );
27 |
28 | const FormField = <
29 |   TFieldValues extends FieldValues = FieldValues,
30 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
31 | >({
32 |   ...props
33 | }: ControllerProps<TFieldValues, TName>) => {
34 |   return (
35 |     <FormFieldContext.Provider value={{ name: props.name }}>
36 |       <Controller {...props} />
37 |     </FormFieldContext.Provider>
38 |   );
39 | };
40 |
41 | const useFormField = () => {
42 |   const fieldContext = React.useContext(FormFieldContext);
43 |   const itemContext = React.useContext(FormItemContext);
44 |   const { getFieldState, formState } = useFormContext();
45 |
46 |   const fieldState = getFieldState(fieldContext.name, formState);
47 |
48 |   if (!fieldContext) {
49 |     throw new Error("useFormField should be used within <FormField>");
50 |   }
51 |
52 |   const { id } = itemContext;
53 |
54 |   return {
55 |     id,
56 |     name: fieldContext.name,
57 |     formItemId: `${id}-form-item`,
58 |     formDescriptionId: `${id}-form-item-description`,
59 |     formMessageId: `${id}-form-item-message`,
60 |     ...fieldState,
61 |   };
62 | };
63 |
64 | type FormItemContextValue = {
65 |   id: string;
66 | };
67 |
68 | const FormItemContext = React.createContext<FormItemContextValue>(
69 |   {} as FormItemContextValue,
70 | );
71 |
72 | const FormItem = React.forwardRef<
73 |   HTMLDivElement,
74 |   React.HTMLAttributes<HTMLDivElement>
75 | >(({ className, ...props }, ref) => {
76 |   const id = React.useId();
77 |
78 |   return (
79 |     <FormItemContext.Provider value={{ id }}>
80 |       <div ref={ref} className={cn("space-y-2", className)} {...props} />
81 |     </FormItemContext.Provider>
82 |   );
83 | });
84 | FormItem.displayName = "FormItem";
85 |
86 | const FormLabel = React.forwardRef<
87 |   React.ElementRef<typeof LabelPrimitive.Root>,
88 |   React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
89 | >(({ className, ...props }, ref) => {
90 |   const { error, formItemId } = useFormField();
91 |
92 |   return (
93 |     <Label
94 |       ref={ref}
95 |       className={cn(error && "text-destructive", className)}
96 |       htmlFor={formItemId}
97 |       {...props}
98 |     />
99 |   );
100 | });
101 | FormLabel.displayName = "FormLabel";
102 |
103 | const FormControl = React.forwardRef<
104 |   React.ElementRef<typeof Slot>,
105 |   React.ComponentPropsWithoutRef<typeof Slot>
106 | >(({ ...props }, ref) => {
107 |   const { error, formItemId, formDescriptionId, formMessageId } =
108 |     useFormField();
109 |
110 |   return (
111 |     <Slot
112 |       ref={ref}
113 |       id={formItemId}
114 |       aria-describedby={
115 |         !error
116 |           ? `${formDescriptionId}`
117 |           : `${formDescriptionId} ${formMessageId}`
118 |       }
119 |       aria-invalid={!!error}
120 |       {...props}
121 |     />
122 |   );
123 | });
124 | FormControl.displayName = "FormControl";
125 |
126 | const FormDescription = React.forwardRef<
127 |   HTMLParagraphElement,
128 |   React.HTMLAttributes<HTMLParagraphElement>
129 | >(({ className, ...props }, ref) => {
130 |   const { formDescriptionId } = useFormField();
131 |
132 |   return (
133 |     <p
134 |       ref={ref}
135 |       id={formDescriptionId}
136 |       className={cn("text-[0.8rem] text-muted-foreground", className)}
137 |       {...props}
138 |     />
139 |   );
140 | });
141 | FormDescription.displayName = "FormDescription";
142 |
143 | const FormMessage = React.forwardRef<
144 |   HTMLParagraphElement,
145 |   React.HTMLAttributes<HTMLParagraphElement>
146 | >(({ className, children, ...props }, ref) => {
147 |   const { error, formMessageId } = useFormField();
148 |   const body = error ? String(error?.message) : children;
149 |
150 |   if (!body) {
151 |     return null;
152 |   }
153 |
154 |   return (
155 |     <p
156 |       ref={ref}
157 |       id={formMessageId}
158 |       className={cn("text-[0.8rem] font-medium text-destructive", className)}
159 |       {...props}
160 |     >
161 |       {body}
162 |     </p>
163 |   );
164 | });
165 | FormMessage.displayName = "FormMessage";
166 |
167 | export {
168 |   useFormField,
169 |   Form,
170 |   FormItem,
171 |   FormLabel,
172 |   FormControl,
173 |   FormDescription,
174 |   FormMessage,
175 |   FormField,
176 | };
```

packages/ui/src/components/hover-card.tsx
```
1 | "use client";
2 |
3 | import * as HoverCardPrimitive from "@radix-ui/react-hover-card";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const HoverCard = HoverCardPrimitive.Root;
8 |
9 | const HoverCardTrigger = HoverCardPrimitive.Trigger;
10 |
11 | const HoverCardContent = React.forwardRef<
12 |   React.ElementRef<typeof HoverCardPrimitive.Content>,
13 |   React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
14 | >(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
15 |   <HoverCardPrimitive.Portal>
16 |     <HoverCardPrimitive.Content
17 |       ref={ref}
18 |       align={align}
19 |       sideOffset={sideOffset}
20 |       className={cn(
21 |         "z-50 w-64 border bg-background p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
22 |         className
23 |       )}
24 |       {...props}
25 |     />
26 |   </HoverCardPrimitive.Portal>
27 | ));
28 | HoverCardContent.displayName = HoverCardPrimitive.Content.displayName;
29 |
30 | export { HoverCard, HoverCardTrigger, HoverCardContent };
```

packages/ui/src/components/icons.tsx
```
1 | import { ArchiveIcon } from "@radix-ui/react-icons";
2 | import { FaXTwitter } from "react-icons/fa6";
3 | import { FiGithub } from "react-icons/fi";
4 | import {
5 |   MdAdd,
6 |   MdAddLink,
7 |   MdArrowBack,
8 |   MdArrowLeft,
9 |   MdArrowRight,
10 |   MdArrowRightAlt,
11 |   MdArrowUpward,
12 |   MdAttachMoney,
13 |   MdAutoAwesome,
14 |   MdBarChart,
15 |   MdChangeHistory,
16 |   MdChevronLeft,
17 |   MdChevronRight,
18 |   MdClose,
19 |   MdDescription,
20 |   MdDownloading,
21 |   MdDragIndicator,
22 |   MdDriveFileMove,
23 |   MdEditCalendar,
24 |   MdErrorOutline,
25 |   MdExpandLess,
26 |   MdExpandMore,
27 |   MdFence,
28 |   MdFolder,
29 |   MdFolderSpecial,
30 |   MdFolderZip,
31 |   MdFormatBold,
32 |   MdFormatItalic,
33 |   MdFormatStrikethrough,
34 |   MdFormatUnderlined,
35 |   MdInventory2,
36 |   MdIosShare,
37 |   MdKeyboardArrowDown,
38 |   MdKeyboardArrowLeft,
39 |   MdKeyboardArrowRight,
40 |   MdKeyboardArrowUp,
41 |   MdMenu,
42 |   MdMoreHoriz,
43 |   MdOutlineAccountBalance,
44 |   MdOutlineAccountCircle,
45 |   MdOutlineApps,
46 |   MdOutlineArchive,
47 |   MdOutlineArrowDownward,
48 |   MdOutlineArrowForward,
49 |   MdOutlineArrowOutward,
50 |   MdOutlineAssuredWorkload,
51 |   MdOutlineAttachFile,
52 |   MdOutlineAttachMoney,
53 |   MdOutlineAutoAwesome,
54 |   MdOutlineBackspace,
55 |   MdOutlineBrokenImage,
56 |   MdOutlineCalculate,
57 |   MdOutlineCalendarMonth,
58 |   MdOutlineCancel,
59 |   MdOutlineCategory,
60 |   MdOutlineChatBubbleOutline,
61 |   MdOutlineClear,
62 |   MdOutlineCloseFullscreen,
63 |   MdOutlineConfirmationNumber,
64 |   MdOutlineContentCopy,
65 |   MdOutlineCreateNewFolder,
66 |   MdOutlineCropFree,
67 |   MdOutlineDashboardCustomize,
68 |   MdOutlineDelete,
69 |   MdOutlineDescription,
70 |   MdOutlineDone,
71 |   MdOutlineDownload,
72 |   MdOutlineEditNote,
73 |   MdOutlineEmail,
74 |   MdOutlineEqualizer,
75 |   MdOutlineExitToApp,
76 |   MdOutlineFace,
77 |   MdOutlineFactCheck,
78 |   MdOutlineFileDownload,
79 |   MdOutlineFilterList,
80 |   MdOutlineForwardToInbox,
81 |   MdOutlineHandyman,
82 |   MdOutlineHourglassTop,
83 |   MdOutlineInbox,
84 |   MdOutlineInsertPhoto,
85 |   MdOutlineInventory2,
86 |   MdOutlineLaunch,
87 |   MdOutlineListAlt,
88 |   MdOutlineMoreTime,
89 |   MdOutlineMoreVert,
90 |   MdOutlineMoveToInbox,
91 |   MdOutlineNotificationsNone,
92 |   MdOutlineOpenInFull,
93 |   MdOutlineOpenInNew,
94 |   MdOutlinePalette,
95 |   MdOutlinePause,
96 |   MdOutlinePlayArrow,
97 |   MdOutlineQrCode2,
98 |   MdOutlineQuestionAnswer,
99 |   MdOutlineRepeat,
100 |   MdOutlineSettings,
101 |   MdOutlineSpellcheck,
102 |   MdOutlineSquareFoot,
103 |   MdOutlineStyle,
104 |   MdOutlineSubject,
105 |   MdOutlineTask,
106 |   MdOutlineTimer,
107 |   MdOutlineTune,
108 |   MdOutlineUploadFile,
109 |   MdOutlineVisibility,
110 |   MdOutlineVolumeOff,
111 |   MdOutlineVolumeUp,
112 |   MdOutlineWrapText,
113 |   MdPause,
114 |   MdPauseCircle,
115 |   MdPeople,
116 |   MdPerson,
117 |   MdPictureAsPdf,
118 |   MdPlayArrow,
119 |   MdPlayCircle,
120 |   MdRefresh,
121 |   MdRemove,
122 |   MdReplay,
123 |   MdRuleFolder,
124 |   MdSearch,
125 |   MdSecurity,
126 |   MdSignalCellularAlt,
127 |   MdSnippetFolder,
128 |   MdSort,
129 |   MdSubdirectoryArrowLeft,
130 |   MdTopic,
131 |   MdTrendingDown,
132 |   MdTrendingUp,
133 | } from "react-icons/md";
134 | import { PiDiscordLogo } from "react-icons/pi";
135 |
136 | export const Icons = {
137 |   LogoSmall: (props: any) => (
138 |     <svg
139 |       xmlns="http://www.w3.org/2000/svg"
140 |       width={32}
141 |       height={32}
142 |       fill="none"
143 |       {...props}
144 |     >
145 |       <path
146 |         fill="currentColor"
147 |         fillRule="evenodd"
148 |         d="M15.304 0c-2.41.103-4.681.739-6.7 1.792l6.7 11.606V0Zm0 18.603-6.7 11.605a15.927 15.927 0 0 0 6.7 1.792V18.603ZM16.697 32V18.595L23.4 30.206A15.928 15.928 0 0 1 16.697 32Zm0-18.594V0c2.41.103 4.684.74 6.704 1.794l-6.704 11.612Zm-14.205 11.2L14.1 17.904 7.398 29.51a16.1 16.1 0 0 1-4.906-4.905Zm27.02-17.208-11.607 6.701 6.701-11.607a16.101 16.101 0 0 1 4.905 4.906ZM2.49 7.396A16.1 16.1 0 0 1 7.398 2.49l6.704 11.61L2.49 7.396Zm-.697 1.206A15.927 15.927 0 0 0 0 15.306h13.406L1.793 8.602ZM1.794 23.4A15.927 15.927 0 0 1 0 16.699h13.401L1.794 23.4Zm16.805-8.095H32a15.927 15.927 0 0 0-1.792-6.702l-11.61 6.702ZM30.207 23.4l-11.604-6.7H32c-.104 2.41-.74 4.68-1.793 6.7Zm-12.3-5.494 6.699 11.604a16.1 16.1 0 0 0 4.904-4.905l-11.604-6.7Z"
149 |         clipRule="evenodd"
150 |       />
151 |     </svg>
152 |   ),
153 |   LogoIcon: (props: any) => (
154 |     <svg
155 |       xmlns="http://www.w3.org/2000/svg"
156 |       width={16}
157 |       height={17}
158 |       fill="none"
159 |       {...props}
160 |     >
161 |       <path
162 |         fill="currentColor"
163 |         fillRule="evenodd"
[TRUNCATED]
```

packages/ui/src/components/input-otp.tsx
```
1 | "use client";
2 |
3 | import { DashIcon } from "@radix-ui/react-icons";
4 | import { OTPInput, type SlotProps } from "input-otp";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const InputOTP = React.forwardRef<
9 |   React.ElementRef<typeof OTPInput>,
10 |   React.ComponentPropsWithoutRef<typeof OTPInput>
11 | >(({ className, ...props }, ref) => (
12 |   <OTPInput
13 |     ref={ref}
14 |     containerClassName={cn("flex items-center gap-2", className)}
15 |     {...props}
16 |   />
17 | ));
18 | InputOTP.displayName = "InputOTP";
19 |
20 | const InputOTPGroup = React.forwardRef<
21 |   React.ElementRef<"div">,
22 |   React.ComponentPropsWithoutRef<"div">
23 | >(({ className, ...props }, ref) => (
24 |   <div ref={ref} className={cn("flex items-center", className)} {...props} />
25 | ));
26 | InputOTPGroup.displayName = "InputOTPGroup";
27 |
28 | const InputOTPSlot = React.forwardRef<
29 |   React.ElementRef<"div">,
30 |   SlotProps & React.ComponentPropsWithoutRef<"div">
31 | >(({ char, hasFakeCaret, isActive, className, ...props }, ref) => {
32 |   return (
33 |     <div
34 |       ref={ref}
35 |       className={cn(
36 |         "relative flex h-16 w-16 items-center justify-center border-y border-r border-input text-2xl transition-all first:rounded-l-md first:border-l last:rounded-r-md",
37 |         isActive && "z-10 ring-1 ring-ring",
38 |         className,
39 |       )}
40 |       {...props}
41 |     >
42 |       {char}
43 |       {hasFakeCaret && (
44 |         <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
45 |           <div className="animate-caret-blink h-4 w-px bg-foreground duration-1000" />
46 |         </div>
47 |       )}
48 |     </div>
49 |   );
50 | });
51 | InputOTPSlot.displayName = "InputOTPSlot";
52 |
53 | const InputOTPSeparator = React.forwardRef<
54 |   React.ElementRef<"div">,
55 |   React.ComponentPropsWithoutRef<"div">
56 | >(({ ...props }, ref) => (
57 |   <div ref={ref} {...props}>
58 |     <DashIcon />
59 |   </div>
60 | ));
61 | InputOTPSeparator.displayName = "InputOTPSeparator";
62 |
63 | export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };
```

packages/ui/src/components/input.tsx
```
1 | import * as React from "react";
2 | import { cn } from "../utils";
3 |
4 | export interface InputProps
5 |   extends React.InputHTMLAttributes<HTMLInputElement> {}
6 |
7 | const Input = React.forwardRef<HTMLInputElement, InputProps>(
8 |   ({ className, type, ...props }, ref) => {
9 |     return (
10 |       <input
11 |         type={type}
12 |         className={cn(
13 |           "flex h-9 w-full border bg-transparent px-3 py-1 text-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",
14 |           className,
15 |         )}
16 |         ref={ref}
17 |         {...props}
18 |       />
19 |     );
20 |   },
21 | );
22 | Input.displayName = "Input";
23 |
24 | export { Input };
```

packages/ui/src/components/label.tsx
```
1 | "use client";
2 |
3 | import * as LabelPrimitive from "@radix-ui/react-label";
4 | import { type VariantProps, cva } from "class-variance-authority";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const labelVariants = cva(
9 |   "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
10 | );
11 |
12 | const Label = React.forwardRef<
13 |   React.ElementRef<typeof LabelPrimitive.Root>,
14 |   React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
15 |     VariantProps<typeof labelVariants>
16 | >(({ className, ...props }, ref) => (
17 |   <LabelPrimitive.Root
18 |     ref={ref}
19 |     className={cn(labelVariants(), className)}
20 |     {...props}
21 |   />
22 | ));
23 | Label.displayName = LabelPrimitive.Root.displayName;
24 |
25 | export { Label };
```

packages/ui/src/components/multiple-selector.tsx
```
1 | "use client";
2 |
3 | import { Command as CommandPrimitive, useCommandState } from "cmdk";
4 | import { X } from "lucide-react";
5 | import * as React from "react";
6 | import { forwardRef, useEffect } from "react";
7 |
8 | import { cn } from "../utils";
9 | import { Badge } from "./badge";
10 | import { Command, CommandGroup, CommandItem, CommandList } from "./command";
11 |
12 | export interface Option {
13 |   value: string;
14 |   label: string;
15 |   create?: boolean;
16 |   disable?: boolean;
17 |   /** fixed option that can't be removed. */
18 |   fixed?: boolean;
19 |   /** Group the options by providing key. */
20 |   [key: string]: string | boolean | undefined;
21 | }
22 | interface GroupOption {
23 |   [key: string]: Option[];
24 | }
25 |
26 | interface MultipleSelectorProps {
27 |   value?: Option[];
28 |   defaultOptions?: Option[];
29 |   /** manually controlled options */
30 |   options?: Option[];
31 |   placeholder?: string;
32 |   /** Loading component. */
33 |   loadingIndicator?: React.ReactNode;
34 |   /** Empty component. */
35 |   emptyIndicator?: React.ReactNode;
36 |   /** Debounce time for async search. Only work with `onSearch`. */
37 |   delay?: number;
38 |   /**
39 |    * Only work with `onSearch` prop. Trigger search when `onFocus`.
40 |    * For example, when user click on the input, it will trigger the search to get initial options.
41 |    **/
42 |   triggerSearchOnFocus?: boolean;
43 |   /** async search */
44 |   onSearch?: (value: string) => Promise<Option[]>;
45 |   /**
46 |    * sync search. This search will not showing loadingIndicator.
47 |    * The rest props are the same as async search.
48 |    * i.e.: creatable, groupBy, delay.
49 |    **/
50 |   onSearchSync?: (value: string) => Option[];
51 |   onChange?: (options: Option[]) => void;
52 |   onCreate?: (option: Option) => void;
53 |   /** Limit the maximum number of selected options. */
54 |   maxSelected?: number;
55 |   /** When the number of selected options exceeds the limit, the onMaxSelected will be called. */
56 |   onMaxSelected?: (maxLimit: number) => void;
57 |   /** Hide the placeholder when there are options selected. */
58 |   hidePlaceholderWhenSelected?: boolean;
59 |   disabled?: boolean;
60 |   /** Group the options base on provided key. */
61 |   groupBy?: string;
62 |   className?: string;
63 |   badgeClassName?: string;
64 |   /**
65 |    * First item selected is a default behavior by cmdk. That is why the default is true.
66 |    * This is a workaround solution by add a dummy item.
67 |    *
68 |    * @reference: https://github.com/pacocoursey/cmdk/issues/171
69 |    */
70 |   selectFirstItem?: boolean;
71 |   /** Allow user to create option when there is no option matched. */
72 |   creatable?: boolean;
73 |   /** Props of `Command` */
74 |   commandProps?: React.ComponentPropsWithoutRef<typeof Command>;
75 |   /** Props of `CommandInput` */
76 |   inputProps?: Omit<
77 |     React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>,
78 |     "value" | "placeholder" | "disabled"
79 |   >;
80 |   /** hide the clear all button. */
81 |   hideClearAllButton?: boolean;
82 |
83 |   renderOption?: (option: Option) => React.ReactNode;
84 | }
85 |
86 | export interface MultipleSelectorRef {
87 |   selectedValue: Option[];
88 |   input: HTMLInputElement;
89 |   focus: () => void;
90 |   reset: () => void;
91 | }
92 |
93 | export function useDebounce<T>(value: T, delay?: number): T {
94 |   const [debouncedValue, setDebouncedValue] = React.useState<T>(value);
95 |
96 |   useEffect(() => {
97 |     const timer = setTimeout(() => setDebouncedValue(value), delay || 500);
98 |
99 |     return () => {
100 |       clearTimeout(timer);
101 |     };
102 |   }, [value, delay]);
103 |
104 |   return debouncedValue;
105 | }
106 |
107 | function transToGroupOption(options: Option[], groupBy?: string) {
108 |   if (options.length === 0) {
109 |     return {};
110 |   }
111 |   if (!groupBy) {
112 |     return {
113 |       "": options,
114 |     };
115 |   }
116 |
117 |   const groupOption: GroupOption = {};
118 |   options.forEach((option) => {
119 |     const key = (option[groupBy] as string) || "";
120 |     if (!groupOption[key]) {
121 |       groupOption[key] = [];
122 |     }
123 |     groupOption[key].push(option);
124 |   });
125 |   return groupOption;
126 | }
127 |
128 | function removePickedOption(groupOption: GroupOption, picked: Option[]) {
129 |   const cloneOption = JSON.parse(JSON.stringify(groupOption)) as GroupOption;
130 |
131 |   for (const [key, value] of Object.entries(cloneOption)) {
132 |     cloneOption[key] = value.filter(
133 |       (val) => !picked.find((p) => p.value === val.value),
134 |     );
135 |   }
136 |   return cloneOption;
137 | }
138 |
139 | function isOptionsExist(groupOption: GroupOption, targetOption: Option[]) {
140 |   for (const [, value] of Object.entries(groupOption)) {
141 |     if (
142 |       value.some((option) => targetOption.find((p) => p.value === option.value))
143 |     ) {
144 |       return true;
145 |     }
146 |   }
147 |   return false;
148 | }
149 |
150 | /**
151 |  * The `CommandEmpty` of shadcn/ui will cause the cmdk empty not rendering correctly.
152 |  * So we create one and copy the `Empty` implementation from `cmdk`.
153 |  *
[TRUNCATED]
```

packages/ui/src/components/navigation-menu.tsx
```
1 | import { ChevronDownIcon } from "@radix-ui/react-icons";
2 | import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu";
3 | import { cva } from "class-variance-authority";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const NavigationMenu = React.forwardRef<
8 |   React.ElementRef<typeof NavigationMenuPrimitive.Root>,
9 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
10 | >(({ className, children, ...props }, ref) => (
11 |   <NavigationMenuPrimitive.Root
12 |     ref={ref}
13 |     className={cn("relative z-10 flex flex-1 items-center", className)}
14 |     {...props}
15 |   >
16 |     {children}
17 |     <NavigationMenuViewport />
18 |   </NavigationMenuPrimitive.Root>
19 | ));
20 | NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;
21 |
22 | const NavigationMenuList = React.forwardRef<
23 |   React.ElementRef<typeof NavigationMenuPrimitive.List>,
24 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
25 | >(({ className, ...props }, ref) => (
26 |   <NavigationMenuPrimitive.List
27 |     ref={ref}
28 |     className={cn(
29 |       "group flex flex-1 list-none items-center justify-center space-x-1",
30 |       className
31 |     )}
32 |     {...props}
33 |   />
34 | ));
35 | NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;
36 |
37 | const NavigationMenuItem = NavigationMenuPrimitive.Item;
38 |
39 | const navigationMenuTriggerStyle = cva(
40 |   "h-8 items-center justify-center text-sm font-medium transition-colors px-3 py-2 inline-flex text-secondary-foreground hover:bg-secondary"
41 | );
42 |
43 | const NavigationMenuTrigger = React.forwardRef<
44 |   React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
45 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
46 | >(({ className, children, ...props }, ref) => (
47 |   <NavigationMenuPrimitive.Trigger
48 |     ref={ref}
49 |     className={cn(navigationMenuTriggerStyle(), "group", className)}
50 |     {...props}
51 |   >
52 |     {children}{" "}
53 |     <ChevronDownIcon
54 |       className="relative top-0 ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180"
55 |       aria-hidden="true"
56 |     />
57 |   </NavigationMenuPrimitive.Trigger>
58 | ));
59 | NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;
60 |
61 | const NavigationMenuContent = React.forwardRef<
62 |   React.ElementRef<typeof NavigationMenuPrimitive.Content>,
63 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
64 | >(({ className, ...props }, ref) => (
65 |   <NavigationMenuPrimitive.Content
66 |     ref={ref}
67 |     className={cn(
68 |       "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
69 |       className
70 |     )}
71 |     {...props}
72 |   />
73 | ));
74 | NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;
75 |
76 | const NavigationMenuLink = NavigationMenuPrimitive.Link;
77 |
78 | const NavigationMenuViewport = React.forwardRef<
79 |   React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
80 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
81 | >(({ className, ...props }, ref) => (
82 |   <div className={cn("absolute left-0 top-full flex justify-center")}>
83 |     <NavigationMenuPrimitive.Viewport
84 |       className={cn(
85 |         "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden border border-border bg-popover text-popover-foreground shadow-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
86 |         className
87 |       )}
88 |       ref={ref}
89 |       {...props}
90 |     />
91 |   </div>
92 | ));
93 | NavigationMenuViewport.displayName =
94 |   NavigationMenuPrimitive.Viewport.displayName;
95 |
96 | const NavigationMenuIndicator = React.forwardRef<
97 |   React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
98 |   React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
99 | >(({ className, ...props }, ref) => (
100 |   <NavigationMenuPrimitive.Indicator
101 |     ref={ref}
102 |     className={cn(
103 |       "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
104 |       className
105 |     )}
106 |     {...props}
107 |   >
108 |     <div className="relative top-[60%] h-2 w-2 rotate-45 bg-border shadow-md" />
109 |   </NavigationMenuPrimitive.Indicator>
110 | ));
111 | NavigationMenuIndicator.displayName =
112 |   NavigationMenuPrimitive.Indicator.displayName;
113 |
114 | export {
115 |   navigationMenuTriggerStyle,
116 |   NavigationMenu,
117 |   NavigationMenuList,
118 |   NavigationMenuItem,
119 |   NavigationMenuContent,
120 |   NavigationMenuTrigger,
121 |   NavigationMenuLink,
122 |   NavigationMenuIndicator,
123 |   NavigationMenuViewport,
124 | };
```

packages/ui/src/components/popover.tsx
```
1 | "use client";
2 |
3 | import * as PopoverPrimitive from "@radix-ui/react-popover";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Popover = PopoverPrimitive.Root;
8 |
9 | const PopoverTrigger = PopoverPrimitive.Trigger;
10 |
11 | const PopoverContent = React.forwardRef<
12 |   React.ElementRef<typeof PopoverPrimitive.Content>,
13 |   React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
14 | >(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
15 |   <PopoverPrimitive.Portal>
16 |     <PopoverPrimitive.Content
17 |       ref={ref}
18 |       align={align}
19 |       sideOffset={sideOffset}
20 |       className={cn(
21 |         "z-50 w-72 border bg-background p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
22 |         className
23 |       )}
24 |       {...props}
25 |     />
26 |   </PopoverPrimitive.Portal>
27 | ));
28 | PopoverContent.displayName = PopoverPrimitive.Content.displayName;
29 |
30 | const PopoverContentWithoutPortal = React.forwardRef<
31 |   React.ElementRef<typeof PopoverPrimitive.Content>,
32 |   React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
33 | >(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
34 |   <PopoverPrimitive.Content
35 |     ref={ref}
36 |     align={align}
37 |     sideOffset={sideOffset}
38 |     className={cn(
39 |       "z-50 w-72 border bg-background p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
40 |       className
41 |     )}
42 |     {...props}
43 |   />
44 | ));
45 |
46 | export { Popover, PopoverTrigger, PopoverContent, PopoverContentWithoutPortal };
```

packages/ui/src/components/progress.tsx
```
1 | "use client";
2 |
3 | import * as ProgressPrimitive from "@radix-ui/react-progress";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Progress = React.forwardRef<
8 |   React.ElementRef<typeof ProgressPrimitive.Root>,
9 |   React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
10 | >(({ className, value, ...props }, ref) => (
11 |   <ProgressPrimitive.Root
12 |     ref={ref}
13 |     className={cn(
14 |       "relative h-4 w-full overflow-hidden bg-secondary",
15 |       className
16 |     )}
17 |     {...props}
18 |   >
19 |     <ProgressPrimitive.Indicator
20 |       className="h-full w-full flex-1 bg-primary transition-all"
21 |       style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
22 |     />
23 |   </ProgressPrimitive.Root>
24 | ));
25 | Progress.displayName = ProgressPrimitive.Root.displayName;
26 |
27 | export { Progress };
```

packages/ui/src/components/quantity-input.tsx
```
1 | import { Minus, Plus } from "lucide-react";
2 | import * as React from "react";
3 | import { cn } from "../utils";
4 |
5 | type Props = {
6 |   value?: number;
7 |   min?: number;
8 |   max?: number;
9 |   onChange?: (value: number) => void;
10 |   onBlur?: () => void;
11 |   onFocus?: () => void;
12 |   className?: string;
13 | };
14 |
15 | export function QuantityInput({
16 |   value = 0,
17 |   min = Number.NEGATIVE_INFINITY,
18 |   max = Number.POSITIVE_INFINITY,
19 |   onChange,
20 |   onBlur,
21 |   onFocus,
22 |   className,
23 | }: Props) {
24 |   const inputRef = React.useRef<HTMLInputElement>(null);
25 |   const [rawValue, setRawValue] = React.useState(String(value));
26 |
27 |   const handleInput: React.ChangeEventHandler<HTMLInputElement> = ({
28 |     currentTarget: el,
29 |   }) => {
30 |     const input = el.value;
31 |     setRawValue(input);
32 |
33 |     // Check if input can be parsed as a valid number
34 |     const num = Number.parseFloat(input);
35 |     if (!Number.isNaN(num) && min <= num && num <= max) {
36 |       onChange?.(num);
37 |     }
38 |   };
39 |
40 |   const handlePointerDown =
41 |     (diff: number) => (event: React.PointerEvent<HTMLButtonElement>) => {
42 |       if (event.pointerType === "mouse") {
43 |         event.preventDefault();
44 |         inputRef.current?.focus();
45 |       }
46 |       const newVal = Math.min(Math.max(value + diff, min), max);
47 |       onChange?.(newVal);
48 |       setRawValue(String(newVal));
49 |     };
50 |
51 |   return (
52 |     <div
53 |       className={cn(
54 |         "group flex items-stretch transition-[box-shadow] font-mono",
55 |         className,
56 |       )}
57 |     >
58 |       <button
59 |         aria-label="Decrease"
60 |         className="flex items-center pr-[.325em]"
61 |         disabled={value <= min}
62 |         onPointerDown={handlePointerDown(-1)}
63 |         type="button"
64 |         tabIndex={-1}
65 |       >
66 |         <Minus
67 |           className="size-2"
68 |           absoluteStrokeWidth
69 |           strokeWidth={3.5}
70 |           tabIndex={-1}
71 |         />
72 |       </button>
73 |       <div className="relative grid items-center justify-items-center text-center">
74 |         <input
75 |           ref={inputRef}
76 |           className="flex w-8 text-center transition-colors file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 p-0 border-0 h-6 text-xs !bg-transparent border-b border-transparent focus:border-border [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"
77 |           style={{ fontKerning: "none" }}
78 |           type="number"
79 |           min={min}
80 |           max={max}
81 |           autoComplete="off"
82 |           step={0.1}
83 |           value={rawValue}
84 |           onInput={handleInput}
85 |           onBlur={onBlur}
86 |           onFocus={onFocus}
87 |           inputMode="decimal"
88 |         />
89 |       </div>
90 |       <button
91 |         aria-label="Increase"
92 |         className="flex items-center pl-[.325em]"
93 |         disabled={value >= max}
94 |         onPointerDown={handlePointerDown(1)}
95 |         type="button"
96 |         tabIndex={-1}
97 |       >
98 |         <Plus
99 |           className="size-2"
100 |           absoluteStrokeWidth
101 |           strokeWidth={3.5}
102 |           tabIndex={-1}
103 |         />
104 |       </button>
105 |     </div>
106 |   );
107 | }
```

packages/ui/src/components/radio-group.tsx
```
1 | "use client";
2 |
3 | import { CheckIcon } from "@radix-ui/react-icons";
4 | import * as RadioGroupPrimitive from "@radix-ui/react-radio-group";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const RadioGroup = React.forwardRef<
9 |   React.ElementRef<typeof RadioGroupPrimitive.Root>,
10 |   React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
11 | >(({ className, ...props }, ref) => {
12 |   return (
13 |     <RadioGroupPrimitive.Root
14 |       className={cn("grid gap-2", className)}
15 |       {...props}
16 |       ref={ref}
17 |     />
18 |   );
19 | });
20 | RadioGroup.displayName = RadioGroupPrimitive.Root.displayName;
21 |
22 | const RadioGroupItem = React.forwardRef<
23 |   React.ElementRef<typeof RadioGroupPrimitive.Item>,
24 |   React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
25 | >(({ className, children, ...props }, ref) => {
26 |   return (
27 |     <RadioGroupPrimitive.Item
28 |       ref={ref}
29 |       className={cn(
30 |         "aspect-square h-4 w-4 rounded-full border border-primary text-primary focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",
31 |         className
32 |       )}
33 |       {...props}
34 |     >
35 |       <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
36 |         <CheckIcon className="h-3.5 w-3.5 fill-primary" />
37 |       </RadioGroupPrimitive.Indicator>
38 |     </RadioGroupPrimitive.Item>
39 |   );
40 | });
41 | RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName;
42 |
43 | export { RadioGroup, RadioGroupItem };
```

packages/ui/src/components/scroll-area.tsx
```
1 | "use client";
2 |
3 | import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const ScrollArea = React.forwardRef<
8 |   React.ElementRef<typeof ScrollAreaPrimitive.Root>,
9 |   React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root> & {
10 |     hideScrollbar?: boolean;
11 |   }
12 | >(({ className, children, hideScrollbar, ...props }, ref) => (
13 |   <ScrollAreaPrimitive.Root
14 |     className={cn("relative overflow-hidden", className)}
15 |     {...props}
16 |   >
17 |     <ScrollAreaPrimitive.Viewport
18 |       className="h-full w-full rounded-[inherit]"
19 |       ref={ref}
20 |     >
21 |       {children}
22 |     </ScrollAreaPrimitive.Viewport>
23 |     <ScrollBar className={hideScrollbar ? "hidden" : undefined} />
24 |     <ScrollAreaPrimitive.Corner />
25 |   </ScrollAreaPrimitive.Root>
26 | ));
27 | ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName;
28 |
29 | const ScrollBar = React.forwardRef<
30 |   React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
31 |   React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
32 | >(({ className, orientation = "vertical", ...props }, ref) => (
33 |   <ScrollAreaPrimitive.ScrollAreaScrollbar
34 |     ref={ref}
35 |     orientation={orientation}
36 |     className={cn(
37 |       "flex touch-none select-none transition-colors",
38 |       orientation === "vertical" &&
39 |         "h-full w-2.5 border-l border-l-transparent p-[1px]",
40 |       orientation === "horizontal" &&
41 |         "h-2.5 flex-col border-t border-t-transparent p-[1px]",
42 |       className,
43 |     )}
44 |     {...props}
45 |   >
46 |     <ScrollAreaPrimitive.ScrollAreaThumb
47 |       className={cn(
48 |         "relative rounded-full bg-border",
49 |         orientation === "vertical" && "flex-1",
50 |       )}
51 |     />
52 |   </ScrollAreaPrimitive.ScrollAreaScrollbar>
53 | ));
54 | ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName;
55 |
56 | export { ScrollArea, ScrollBar };
```

packages/ui/src/components/select.tsx
```
1 | "use client";
2 |
3 | import {
4 |   CheckIcon,
5 |   ChevronDownIcon,
6 |   ChevronUpIcon,
7 | } from "@radix-ui/react-icons";
8 | import * as SelectPrimitive from "@radix-ui/react-select";
9 | import * as React from "react";
10 | import { cn } from "../utils";
11 | import { Icons } from "./icons";
12 |
13 | const Select = SelectPrimitive.Root;
14 |
15 | const SelectGroup = SelectPrimitive.Group;
16 |
17 | const SelectValue = SelectPrimitive.Value;
18 |
19 | const SelectTrigger = React.forwardRef<
20 |   React.ElementRef<typeof SelectPrimitive.Trigger>,
21 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger> & {
22 |     hideIcon?: boolean;
23 |   }
24 | >(({ className, children, hideIcon = false, ...props }, ref) => (
25 |   <SelectPrimitive.Trigger
26 |     ref={ref}
27 |     className={cn(
28 |       "!flex h-9 w-full items-center justify-between whitespace-nowrap border border-border bg-transparent px-3 py-2 text-sm font-normal placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
29 |       className,
30 |     )}
31 |     {...props}
32 |   >
33 |     <span className="line-clamp-1">{children}</span>
34 |     {!hideIcon && (
35 |       <div className="h-4 w-4">
36 |         <SelectPrimitive.Icon asChild>
37 |           <Icons.ChevronDown className="h-4 w-4" />
38 |         </SelectPrimitive.Icon>
39 |       </div>
40 |     )}
41 |   </SelectPrimitive.Trigger>
42 | ));
43 | SelectTrigger.displayName = SelectPrimitive.Trigger.displayName;
44 |
45 | const SelectScrollUpButton = React.forwardRef<
46 |   React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
47 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
48 | >(({ className, ...props }, ref) => (
49 |   <SelectPrimitive.ScrollUpButton
50 |     ref={ref}
51 |     className={cn(
52 |       "flex cursor-default items-center justify-center py-1",
53 |       className,
54 |     )}
55 |     {...props}
56 |   >
57 |     <ChevronUpIcon />
58 |   </SelectPrimitive.ScrollUpButton>
59 | ));
60 | SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;
61 |
62 | const SelectScrollDownButton = React.forwardRef<
63 |   React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
64 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
65 | >(({ className, ...props }, ref) => (
66 |   <SelectPrimitive.ScrollDownButton
67 |     ref={ref}
68 |     className={cn(
69 |       "flex cursor-default items-center justify-center py-1",
70 |       className,
71 |     )}
72 |     {...props}
73 |   >
74 |     <ChevronDownIcon />
75 |   </SelectPrimitive.ScrollDownButton>
76 | ));
77 | SelectScrollDownButton.displayName =
78 |   SelectPrimitive.ScrollDownButton.displayName;
79 |
80 | const SelectContent = React.forwardRef<
81 |   React.ElementRef<typeof SelectPrimitive.Content>,
82 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
83 | >(({ className, children, position = "popper", ...props }, ref) => (
84 |   <SelectPrimitive.Portal>
85 |     <SelectPrimitive.Content
86 |       ref={ref}
87 |       className={cn(
88 |         "relative z-50 max-h-96 min-w-[8rem] overflow-hidden border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
89 |         position === "popper" &&
90 |           "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
91 |         className,
92 |       )}
93 |       position={position}
94 |       {...props}
95 |     >
96 |       <SelectScrollUpButton />
97 |       <SelectPrimitive.Viewport
98 |         className={cn(
99 |           "p-1",
100 |           position === "popper" &&
101 |             "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]",
102 |         )}
103 |       >
104 |         {children}
105 |       </SelectPrimitive.Viewport>
106 |       <SelectScrollDownButton />
107 |     </SelectPrimitive.Content>
108 |   </SelectPrimitive.Portal>
109 | ));
110 | SelectContent.displayName = SelectPrimitive.Content.displayName;
111 |
112 | const SelectLabel = React.forwardRef<
113 |   React.ElementRef<typeof SelectPrimitive.Label>,
114 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
115 | >(({ className, ...props }, ref) => (
116 |   <SelectPrimitive.Label
117 |     ref={ref}
118 |     className={cn("px-2 py-1.5 text-sm font-medium", className)}
119 |     {...props}
120 |   />
121 | ));
122 | SelectLabel.displayName = SelectPrimitive.Label.displayName;
123 |
124 | const SelectItem = React.forwardRef<
125 |   React.ElementRef<typeof SelectPrimitive.Item>,
126 |   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
127 | >(({ className, children, ...props }, ref) => (
128 |   <SelectPrimitive.Item
129 |     ref={ref}
130 |     className={cn(
131 |       "relative flex w-full cursor-default select-none items-center py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
132 |       className,
133 |     )}
134 |     {...props}
135 |   >
[TRUNCATED]
```

packages/ui/src/components/separator.tsx
```
1 | "use client";
2 |
3 | import * as SeparatorPrimitive from "@radix-ui/react-separator";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Separator = React.forwardRef<
8 |   React.ElementRef<typeof SeparatorPrimitive.Root>,
9 |   React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
10 | >(
11 |   (
12 |     { className, orientation = "horizontal", decorative = true, ...props },
13 |     ref
14 |   ) => (
15 |     <SeparatorPrimitive.Root
16 |       ref={ref}
17 |       decorative={decorative}
18 |       orientation={orientation}
19 |       className={cn(
20 |         "shrink-0 bg-border",
21 |         orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
22 |         className
23 |       )}
24 |       {...props}
25 |     />
26 |   )
27 | );
28 | Separator.displayName = SeparatorPrimitive.Root.displayName;
29 |
30 | export { Separator };
```

packages/ui/src/components/sheet.tsx
```
1 | "use client";
2 |
3 | import * as SheetPrimitive from "@radix-ui/react-dialog";
4 | import { type VariantProps, cva } from "class-variance-authority";
5 | import * as React from "react";
6 | import { cn } from "../utils";
7 |
8 | const Sheet = SheetPrimitive.Root;
9 |
10 | const SheetTrigger = SheetPrimitive.Trigger;
11 |
12 | const SheetClose = SheetPrimitive.Close;
13 |
14 | const SheetPortal = SheetPrimitive.Portal;
15 |
16 | const SheetOverlay = React.forwardRef<
17 |   React.ElementRef<typeof SheetPrimitive.Overlay>,
18 |   React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
19 | >(({ className, ...props }, ref) => (
20 |   <SheetPrimitive.Overlay
21 |     className={cn(
22 |       "fixed inset-0 z-50 bg-[#f6f6f3]/60 dark:bg-black/60 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
23 |       className,
24 |     )}
25 |     {...props}
26 |     ref={ref}
27 |   />
28 | ));
29 | SheetOverlay.displayName = SheetPrimitive.Overlay.displayName;
30 |
31 | const sheetVariants = cva(
32 |   "fixed z-50 gap-4 transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-200 data-[state=open]:duration-300",
33 |   {
34 |     variants: {
35 |       side: {
36 |         top: "inset-x-0 top-0 data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
37 |         bottom:
38 |           "inset-x-0 bottom-0 data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
39 |         left: "inset-y-0 left-0 h-full w-3/4 data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
40 |         right:
41 |           "inset-y-0 right-0 h-full w-3/4 data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-[520px]",
42 |       },
43 |     },
44 |     defaultVariants: {
45 |       side: "right",
46 |     },
47 |   },
48 | );
49 |
50 | interface SheetContentProps
51 |   extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
52 |     VariantProps<typeof sheetVariants> {
53 |   stack?: boolean;
54 | }
55 |
56 | const SheetContent = React.forwardRef<
57 |   React.ElementRef<typeof SheetPrimitive.Content>,
58 |   SheetContentProps
59 | >(
60 |   (
61 |     { side = "right", stack = false, className, children, title, ...props },
62 |     ref,
63 |   ) => (
64 |     <SheetPortal>
65 |       <SheetOverlay />
66 |       <SheetPrimitive.Content
67 |         onOpenAutoFocus={(e) => e.preventDefault()}
68 |         ref={ref}
69 |         className={cn("md:p-4", sheetVariants({ side }))}
70 |         aria-describedby={props["aria-describedby"] || undefined}
71 |         {...props}
72 |       >
73 |         <div
74 |           className={cn(
75 |             "border w-full h-full bg-[#FAFAF9] dark:bg-[#121212] p-6 relative overflow-hidden",
76 |             className,
77 |           )}
78 |         >
79 |           <SheetTitle className="sr-only">{title}</SheetTitle>
80 |           {children}
81 |         </div>
82 |       </SheetPrimitive.Content>
83 |     </SheetPortal>
84 |   ),
85 | );
86 | SheetContent.displayName = SheetPrimitive.Content.displayName;
87 |
88 | const SheetHeader = ({
89 |   className,
90 |   ...props
91 | }: React.HTMLAttributes<HTMLDivElement>) => (
92 |   <div
93 |     className={cn(
94 |       "flex flex-col space-y-2 text-center sm:text-left",
95 |       className,
96 |     )}
97 |     {...props}
98 |   />
99 | );
100 | SheetHeader.displayName = "SheetHeader";
101 |
102 | const SheetFooter = ({
103 |   className,
104 |   ...props
105 | }: React.HTMLAttributes<HTMLDivElement>) => (
106 |   <div
107 |     className={cn(
108 |       "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
109 |       className,
110 |     )}
111 |     {...props}
112 |   />
113 | );
114 | SheetFooter.displayName = "SheetFooter";
115 |
116 | const SheetTitle = React.forwardRef<
117 |   React.ElementRef<typeof SheetPrimitive.Title>,
118 |   React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
119 | >(({ className, ...props }, ref) => (
120 |   <SheetPrimitive.Title
121 |     ref={ref}
122 |     className={cn("text-lg font-semibold text-foreground", className)}
123 |     {...props}
124 |   />
125 | ));
126 | SheetTitle.displayName = SheetPrimitive.Title.displayName;
127 |
128 | const SheetDescription = React.forwardRef<
129 |   React.ElementRef<typeof SheetPrimitive.Description>,
130 |   React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
131 | >(({ className, ...props }, ref) => (
132 |   <SheetPrimitive.Description
133 |     ref={ref}
134 |     className={cn("text-sm text-muted-foreground", className)}
135 |     {...props}
136 |   />
137 | ));
138 | SheetDescription.displayName = SheetPrimitive.Description.displayName;
139 |
140 | export {
141 |   Sheet,
142 |   SheetPortal,
143 |   SheetOverlay,
144 |   SheetTrigger,
145 |   SheetClose,
146 |   SheetContent,
147 |   SheetHeader,
148 |   SheetFooter,
149 |   SheetTitle,
150 |   SheetDescription,
151 | };
```

packages/ui/src/components/skeleton.tsx
```
1 | import type * as React from "react";
2 | import { cn } from "../utils";
3 |
4 | function Skeleton({
5 |   className,
6 |   ...props
7 | }: React.HTMLAttributes<HTMLDivElement>) {
8 |   return (
9 |     <div className={cn("animate-pulse bg-primary/10", className)} {...props} />
10 |   );
11 | }
12 |
13 | export { Skeleton };
```

packages/ui/src/components/slider.tsx
```
1 | "use client";
2 |
3 | import * as SliderPrimitive from "@radix-ui/react-slider";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Slider = React.forwardRef<
8 |   React.ElementRef<typeof SliderPrimitive.Root>,
9 |   React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
10 | >(({ className, ...props }, ref) => (
11 |   <SliderPrimitive.Root
12 |     ref={ref}
13 |     className={cn(
14 |       "relative flex w-full touch-none select-none items-center",
15 |       className,
16 |     )}
17 |     {...props}
18 |   >
19 |     <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
20 |       <SliderPrimitive.Range className="absolute h-full bg-primary" />
21 |     </SliderPrimitive.Track>
22 |     <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
23 |     <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
24 |   </SliderPrimitive.Root>
25 | ));
26 | Slider.displayName = SliderPrimitive.Root.displayName;
27 |
28 | export { Slider };
```

packages/ui/src/components/spinner.tsx
```
1 | const bars = Array(12).fill(0);
2 |
3 | export const Spinner = ({ size = 16 }) => {
4 |   return (
5 |     <div className="loading-parent">
6 |       <div
7 |         className="loading-wrapper"
8 |         data-visible
9 |         // @ts-ignore
10 |         style={{ "--spinner-size": `${size}px` }}
11 |       >
12 |         <div className="spinner">
13 |           {bars.map((_, i) => (
14 |             <div className="loading-bar" key={`spinner-bar-${i.toString()}`} />
15 |           ))}
16 |         </div>
17 |       </div>
18 |     </div>
19 |   );
20 | };
```

packages/ui/src/components/submit-button.tsx
```
1 | import { Loader2 } from "lucide-react";
2 | import { cn } from "../utils";
3 | import { Button, type ButtonProps } from "./button";
4 |
5 | export function SubmitButton({
6 |   children,
7 |   isSubmitting,
8 |   disabled,
9 |   ...props
10 | }: {
11 |   children: React.ReactNode;
12 |   isSubmitting: boolean;
13 |   disabled?: boolean;
14 | } & ButtonProps) {
15 |   return (
16 |     <Button
17 |       disabled={isSubmitting || disabled}
18 |       {...props}
19 |       className={cn(props.className, "relative")}
20 |     >
21 |       <span className={cn({ "opacity-0": isSubmitting })}>{children}</span>
22 |
23 |       {isSubmitting && (
24 |         <span className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
25 |           <Loader2 className="h-4 w-4 animate-spin" />
26 |         </span>
27 |       )}
28 |     </Button>
29 |   );
30 | }
```

packages/ui/src/components/switch.tsx
```
1 | "use client";
2 |
3 | import * as SwitchPrimitives from "@radix-ui/react-switch";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Switch = React.forwardRef<
8 |   React.ElementRef<typeof SwitchPrimitives.Root>,
9 |   React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
10 | >(({ className, ...props }, ref) => (
11 |   <SwitchPrimitives.Root
12 |     className={cn(
13 |       "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
14 |       className
15 |     )}
16 |     {...props}
17 |     ref={ref}
18 |   >
19 |     <SwitchPrimitives.Thumb
20 |       className={cn(
21 |         "pointer-events-none block h-5 w-5 rounded-full bg-background ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
22 |       )}
23 |     />
24 |   </SwitchPrimitives.Root>
25 | ));
26 | Switch.displayName = SwitchPrimitives.Root.displayName;
27 |
28 | export { Switch };
```

packages/ui/src/components/table.tsx
```
1 | import * as React from "react";
2 | import { cn } from "../utils";
3 |
4 | const Table = React.forwardRef<
5 |   HTMLTableElement,
6 |   React.HTMLAttributes<HTMLTableElement>
7 | >(({ className, ...props }, ref) => (
8 |   <table
9 |     ref={ref}
10 |     className={cn("w-full caption-bottom text-sm relative", className)}
11 |     {...props}
12 |   />
13 | ));
14 | Table.displayName = "Table";
15 |
16 | const TableHeader = React.forwardRef<
17 |   HTMLTableSectionElement,
18 |   React.HTMLAttributes<HTMLTableSectionElement>
19 | >(({ className, ...props }, ref) => (
20 |   <thead
21 |     ref={ref}
22 |     className={cn("[&_tr]:border-b border", className)}
23 |     {...props}
24 |   />
25 | ));
26 | TableHeader.displayName = "TableHeader";
27 |
28 | const TableBody = React.forwardRef<
29 |   HTMLTableSectionElement,
30 |   React.HTMLAttributes<HTMLTableSectionElement>
31 | >(({ className, ...props }, ref) => (
32 |   <tbody
33 |     ref={ref}
34 |     className={cn("[&_tr:last-child]:border-0 border", className)}
35 |     {...props}
36 |   />
37 | ));
38 | TableBody.displayName = "TableBody";
39 |
40 | const TableFooter = React.forwardRef<
41 |   HTMLTableSectionElement,
42 |   React.HTMLAttributes<HTMLTableSectionElement>
43 | >(({ className, ...props }, ref) => (
44 |   <tfoot
45 |     ref={ref}
46 |     className={cn("bg-primary font-medium text-primary-foreground", className)}
47 |     {...props}
48 |   />
49 | ));
50 | TableFooter.displayName = "TableFooter";
51 |
52 | const TableRow = React.forwardRef<
53 |   HTMLTableRowElement,
54 |   React.HTMLAttributes<HTMLTableRowElement>
55 | >(({ className, ...props }, ref) => (
56 |   <tr ref={ref} className={cn("border-b", className)} {...props} />
57 | ));
58 | TableRow.displayName = "TableRow";
59 |
60 | const TableHead = React.forwardRef<
61 |   HTMLTableCellElement,
62 |   React.ThHTMLAttributes<HTMLTableCellElement>
63 | >(({ className, ...props }, ref) => (
64 |   <th
65 |     ref={ref}
66 |     className={cn(
67 |       "h-12 px-4 text-left align-middle font-semibold [&:has([role=checkbox])]:pr-0 border-r last:border-none w-auto",
68 |       className
69 |     )}
70 |     {...props}
71 |   />
72 | ));
73 | TableHead.displayName = "TableHead";
74 |
75 | const TableCell = React.forwardRef<
76 |   HTMLTableCellElement,
77 |   React.TdHTMLAttributes<HTMLTableCellElement>
78 | >(({ className, ...props }, ref) => (
79 |   <td
80 |     ref={ref}
81 |     className={cn(
82 |       "px-4 py-2 align-middle [&:has([role=checkbox])]:pr-0 border-r last:border-none",
83 |       className
84 |     )}
85 |     {...props}
86 |   />
87 | ));
88 | TableCell.displayName = "TableCell";
89 |
90 | const TableCaption = React.forwardRef<
91 |   HTMLTableCaptionElement,
92 |   React.HTMLAttributes<HTMLTableCaptionElement>
93 | >(({ className, ...props }, ref) => (
94 |   <caption
95 |     ref={ref}
96 |     className={cn("mt-4 text-sm text-muted-foreground", className)}
97 |     {...props}
98 |   />
99 | ));
100 | TableCaption.displayName = "TableCaption";
101 |
102 | export {
103 |   Table,
104 |   TableHeader,
105 |   TableBody,
106 |   TableFooter,
107 |   TableHead,
108 |   TableRow,
109 |   TableCell,
110 |   TableCaption,
111 | };
```

packages/ui/src/components/tabs.tsx
```
1 | "use client";
2 |
3 | import * as TabsPrimitive from "@radix-ui/react-tabs";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const Tabs = TabsPrimitive.Root;
8 |
9 | const TabsList = React.forwardRef<
10 |   React.ElementRef<typeof TabsPrimitive.List>,
11 |   React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
12 | >(({ className, ...props }, ref) => (
13 |   <TabsPrimitive.List
14 |     ref={ref}
15 |     className={cn(
16 |       "inline-flex h-10 items-center justify-center bg-accent p-1 text-muted-foreground",
17 |       className
18 |     )}
19 |     {...props}
20 |   />
21 | ));
22 | TabsList.displayName = TabsPrimitive.List.displayName;
23 |
24 | const TabsTrigger = React.forwardRef<
25 |   React.ElementRef<typeof TabsPrimitive.Trigger>,
26 |   React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
27 | >(({ className, ...props }, ref) => (
28 |   <TabsPrimitive.Trigger
29 |     ref={ref}
30 |     className={cn(
31 |       "inline-flex items-center justify-center whitespace-nowrap px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground",
32 |       className
33 |     )}
34 |     {...props}
35 |   />
36 | ));
37 | TabsTrigger.displayName = TabsPrimitive.Trigger.displayName;
38 |
39 | const TabsContent = React.forwardRef<
40 |   React.ElementRef<typeof TabsPrimitive.Content>,
41 |   React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
42 | >(({ className, ...props }, ref) => (
43 |   <TabsPrimitive.Content
44 |     ref={ref}
45 |     className={cn(
46 |       "mt-2 ring-offset-background focus-visible:outline-none",
47 |       className
48 |     )}
49 |     {...props}
50 |   />
51 | ));
52 | TabsContent.displayName = TabsPrimitive.Content.displayName;
53 |
54 | export { Tabs, TabsList, TabsTrigger, TabsContent };
```

packages/ui/src/components/textarea.tsx
```
1 | import * as React from "react";
2 | import { cn } from "../utils";
3 |
4 | export interface TextareaProps
5 |   extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}
6 |
7 | const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
8 |   ({ className, ...props }, ref) => {
9 |     return (
10 |       <textarea
11 |         className={cn(
12 |           "flex min-h-[60px] w-full border bg-transparent px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",
13 |           className
14 |         )}
15 |         ref={ref}
16 |         {...props}
17 |       />
18 |     );
19 |   }
20 | );
21 | Textarea.displayName = "Textarea";
22 |
23 | export { Textarea };
```

packages/ui/src/components/time-range-input.tsx
```
1 | "use client";
2 |
3 | import { differenceInMinutes, parse } from "date-fns";
4 | import { useEffect, useState } from "react";
5 | import { Icons } from "./icons";
6 |
7 | export function TimeRangeInput({
8 |   value,
9 |   onChange,
10 | }: {
11 |   value: { start: string; end: string };
12 |   onChange: (value: { start: string; end: string }) => void;
13 | }) {
14 |   const [startTime, setStartTime] = useState(value.start);
15 |   const [endTime, setEndTime] = useState(value.end);
16 |   const [duration, setDuration] = useState("");
17 |
18 |   useEffect(() => {
19 |     setStartTime(value.start);
20 |     setEndTime(value.end);
21 |   }, [value]);
22 |
23 |   useEffect(() => {
24 |     if (!startTime || !endTime) {
25 |       return;
26 |     }
27 |
28 |     const start = parse(startTime, "HH:mm", new Date());
29 |     const end = parse(endTime, "HH:mm", new Date());
30 |     const diff = differenceInMinutes(end, start);
31 |     const hours = Math.floor(diff / 60);
32 |     const minutes = diff % 60;
33 |     setDuration(`${hours}h ${minutes}min`);
34 |   }, [startTime, endTime]);
35 |
36 |   return (
37 |     <div className="flex items-center w-full border border-border px-4 py-2">
38 |       <div className="flex items-center space-x-2 flex-1">
39 |         <Icons.Time className="w-5 h-5 text-[#878787]" />
40 |         <input
41 |           type="time"
42 |           value={startTime}
43 |           onChange={(e) => {
44 |             setStartTime(e.target.value);
45 |             onChange({ ...value, start: e.target.value });
46 |           }}
47 |           className="bg-transparent focus:outline-none text-sm"
48 |         />
49 |       </div>
50 |       <div className="flex items-center justify-center flex-shrink-0 mx-4">
51 |         <Icons.ArrowRightAlt className="w-5 h-5 text-[#878787]" />
52 |       </div>
53 |       <div className="flex items-center space-x-2 flex-1 justify-end">
54 |         <input
55 |           type="time"
56 |           value={endTime}
57 |           onChange={(e) => {
58 |             setEndTime(e.target.value);
59 |             onChange({ ...value, end: e.target.value });
60 |           }}
61 |           className="bg-transparent focus:outline-none text-sm"
62 |         />
63 |         <span className="text-[#878787] text-sm">{duration}</span>
64 |       </div>
65 |     </div>
66 |   );
67 | }
```

packages/ui/src/components/toast.tsx
```
1 | import * as ToastPrimitives from "@radix-ui/react-toast";
2 | import { type VariantProps, cva } from "class-variance-authority";
3 | import { X } from "lucide-react";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const ToastProvider = ToastPrimitives.Provider;
8 |
9 | const ToastViewport = React.forwardRef<
10 |   React.ElementRef<typeof ToastPrimitives.Viewport>,
11 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
12 | >(({ className, ...props }, ref) => (
13 |   <ToastPrimitives.Viewport
14 |     ref={ref}
15 |     className={cn(
16 |       "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:left-0 sm:top-auto sm:flex-col md:max-w-[420px]",
17 |       className,
18 |     )}
19 |     {...props}
20 |   />
21 | ));
22 | ToastViewport.displayName = ToastPrimitives.Viewport.displayName;
23 |
24 | const toastVariants = cva(
25 |   "dark:bg-secondary text-foreground border bg-[#F6F6F3] group pointer-events-auto relative flex w-full items-center overflow-hidden border p-5 pr-5 transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-left-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
26 |   {
27 |     variants: {
28 |       variant: {
29 |         default: "",
30 |         error: "",
31 |         success: "",
32 |         progress: "",
33 |         spinner: "",
34 |         ai: "",
35 |         destructive:
36 |           "destructive group border-destructive bg-destructive text-destructive-foreground",
37 |       },
38 |     },
39 |     defaultVariants: {
40 |       variant: "default",
41 |     },
42 |   },
43 | );
44 |
45 | const Toast = React.forwardRef<
46 |   React.ElementRef<typeof ToastPrimitives.Root>,
47 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
48 |     VariantProps<typeof toastVariants>
49 | >(({ className, variant, ...props }, ref) => {
50 |   return (
51 |     <ToastPrimitives.Root
52 |       ref={ref}
53 |       className={cn(toastVariants({ variant }), className)}
54 |       {...props}
55 |     />
56 |   );
57 | });
58 | Toast.displayName = ToastPrimitives.Root.displayName;
59 |
60 | const ToastAction = React.forwardRef<
61 |   React.ElementRef<typeof ToastPrimitives.Action>,
62 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
63 | >(({ className, ...props }, ref) => (
64 |   <ToastPrimitives.Action
65 |     ref={ref}
66 |     className={cn(
67 |       "inline-flex h-8 shrink-0 items-center justify-center border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
68 |       className,
69 |     )}
70 |     {...props}
71 |   />
72 | ));
73 | ToastAction.displayName = ToastPrimitives.Action.displayName;
74 |
75 | const ToastClose = React.forwardRef<
76 |   React.ElementRef<typeof ToastPrimitives.Close>,
77 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
78 | >(({ className, ...props }, ref) => (
79 |   <ToastPrimitives.Close
80 |     ref={ref}
81 |     className={cn(
82 |       "absolute right-2 top-2 p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
83 |       className,
84 |     )}
85 |     toast-close=""
86 |     {...props}
87 |   >
88 |     <X className="h-4 w-4" />
89 |   </ToastPrimitives.Close>
90 | ));
91 | ToastClose.displayName = ToastPrimitives.Close.displayName;
92 |
93 | const ToastTitle = React.forwardRef<
94 |   React.ElementRef<typeof ToastPrimitives.Title>,
95 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
96 | >(({ className, ...props }, ref) => (
97 |   <ToastPrimitives.Title
98 |     ref={ref}
99 |     className={cn("text-sm", className)}
100 |     {...props}
101 |   />
102 | ));
103 | ToastTitle.displayName = ToastPrimitives.Title.displayName;
104 |
105 | const ToastDescription = React.forwardRef<
106 |   React.ElementRef<typeof ToastPrimitives.Description>,
107 |   React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
108 | >(({ className, ...props }, ref) => (
109 |   <ToastPrimitives.Description
110 |     ref={ref}
111 |     className={cn("text-xs text-[#878787]", className)}
112 |     {...props}
113 |   />
114 | ));
115 | ToastDescription.displayName = ToastPrimitives.Description.displayName;
116 |
117 | type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;
118 |
119 | type ToastActionElement = React.ReactElement<typeof ToastAction>;
120 |
121 | export {
122 |   type ToastProps,
123 |   type ToastActionElement,
124 |   ToastProvider,
125 |   ToastViewport,
126 |   Toast,
127 |   ToastTitle,
128 |   ToastDescription,
129 |   ToastClose,
130 |   ToastAction,
131 | };
```

packages/ui/src/components/toaster.tsx
```
1 | "use client";
2 |
3 | import { Loader2 } from "lucide-react";
4 | import { Icons } from "./icons";
5 | import { Progress } from "./progress";
6 | import {
7 |   Toast,
8 |   ToastClose,
9 |   ToastDescription,
10 |   ToastProvider,
11 |   ToastTitle,
12 |   ToastViewport,
13 | } from "./toast";
14 | import { useToast } from "./use-toast";
15 |
16 | export function Toaster() {
17 |   const { toasts } = useToast();
18 |
19 |   return (
20 |     <ToastProvider>
21 |       {toasts.map(
22 |         ({
23 |           id,
24 |           title,
25 |           description,
26 |           progress = 0,
27 |           action,
28 |           footer,
29 |           ...props
30 |         }) => {
31 |           return (
32 |             <Toast key={id} {...props} className="flex flex-col">
33 |               <div className="flex w-full">
34 |                 <div className="space-y-2 w-full justify-center">
35 |                   <div className="flex space-x-2 justify-between">
36 |                     <div className="flex space-x-2 items-center">
37 |                       {props?.variant && (
38 |                         <div className="w-[20px] h-[20px] flex items-center">
39 |                           {props.variant === "ai" && (
40 |                             <Icons.AI className="text-[#0064D9]" />
41 |                           )}
42 |                           {props?.variant === "success" && <Icons.Check />}
43 |                           {props?.variant === "error" && (
44 |                             <Icons.Error className="text-[#FF3638]" />
45 |                           )}
46 |                           {props?.variant === "progress" && (
47 |                             <Loader2 className="h-4 w-4 animate-spin" />
48 |                           )}
49 |                           {props?.variant === "spinner" && (
50 |                             <Loader2 className="h-4 w-4 animate-spin" />
51 |                           )}
52 |                         </div>
53 |                       )}
54 |                       <div>{title && <ToastTitle>{title}</ToastTitle>}</div>
55 |                     </div>
56 |
57 |                     <div>
58 |                       {props?.variant === "progress" && (
59 |                         <span className="text-sm text-[#878787]">
60 |                           {progress}%
61 |                         </span>
62 |                       )}
63 |                     </div>
64 |                   </div>
65 |
66 |                   {props.variant === "progress" && (
67 |                     <Progress
68 |                       value={progress}
69 |                       className="w-full rounded-none h-[3px] bg-border"
70 |                     />
71 |                   )}
72 |
73 |                   {description && (
74 |                     <ToastDescription>{description}</ToastDescription>
75 |                   )}
76 |                 </div>
77 |                 {action}
78 |                 <ToastClose />
79 |               </div>
80 |
81 |               <div className="w-full flex justify-end">{footer}</div>
82 |             </Toast>
83 |           );
84 |         },
85 |       )}
86 |       <ToastViewport />
87 |     </ToastProvider>
88 |   );
89 | }
```

packages/ui/src/components/tooltip.tsx
```
1 | "use client";
2 |
3 | import * as TooltipPrimitive from "@radix-ui/react-tooltip";
4 | import * as React from "react";
5 | import { cn } from "../utils";
6 |
7 | const TooltipProvider = TooltipPrimitive.Provider;
8 |
9 | const Tooltip = TooltipPrimitive.Root;
10 |
11 | const TooltipTrigger = TooltipPrimitive.Trigger;
12 |
13 | const TooltipContent = React.forwardRef<
14 |   React.ElementRef<typeof TooltipPrimitive.Content>,
15 |   React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
16 | >(({ className, sideOffset = 4, ...props }, ref) => (
17 |   <TooltipPrimitive.Portal>
18 |     <TooltipPrimitive.Content
19 |       ref={ref}
20 |       sideOffset={sideOffset}
21 |       className={cn(
22 |         "z-50 overflow-hidden border bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#1A1A1A]/95 px-4 py-3 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
23 |         className,
24 |       )}
25 |       {...props}
26 |     />
27 |   </TooltipPrimitive.Portal>
28 | ));
29 | TooltipContent.displayName = TooltipPrimitive.Content.displayName;
30 |
31 | export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };
```

packages/ui/src/components/use-toast.tsx
```
1 | // Inspired by react-hot-toast library
2 | import * as React from "react";
3 | import type { ToastActionElement, ToastProps } from "./toast";
4 |
5 | const TOAST_LIMIT = 1;
6 | const TOAST_REMOVE_DELAY = 1000000;
7 |
8 | type ToasterToast = ToastProps & {
9 |   id: string;
10 |   title?: React.ReactNode;
11 |   description?: React.ReactNode;
12 |   action?: ToastActionElement;
13 |   progress?: number;
14 |   footer?: React.ReactNode;
15 | };
16 |
17 | const actionTypes = {
18 |   ADD_TOAST: "ADD_TOAST",
19 |   UPDATE_TOAST: "UPDATE_TOAST",
20 |   DISMISS_TOAST: "DISMISS_TOAST",
21 |   REMOVE_TOAST: "REMOVE_TOAST",
22 | } as const;
23 |
24 | let count = 0;
25 |
26 | function genId() {
27 |   count = (count + 1) % Number.MAX_VALUE;
28 |   return count.toString();
29 | }
30 |
31 | type ActionType = typeof actionTypes;
32 |
33 | type Action =
34 |   | {
35 |       type: ActionType["ADD_TOAST"];
36 |       toast: ToasterToast;
37 |     }
38 |   | {
39 |       type: ActionType["UPDATE_TOAST"];
40 |       toast: Partial<ToasterToast>;
41 |     }
42 |   | {
43 |       type: ActionType["DISMISS_TOAST"];
44 |       toastId?: ToasterToast["id"];
45 |     }
46 |   | {
47 |       type: ActionType["REMOVE_TOAST"];
48 |       toastId?: ToasterToast["id"];
49 |     };
50 |
51 | interface State {
52 |   toasts: ToasterToast[];
53 | }
54 |
55 | const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();
56 |
57 | const addToRemoveQueue = (toastId: string) => {
58 |   if (toastTimeouts.has(toastId)) {
59 |     return;
60 |   }
61 |
62 |   const timeout = setTimeout(() => {
63 |     toastTimeouts.delete(toastId);
64 |     dispatch({
65 |       type: "REMOVE_TOAST",
66 |       toastId: toastId,
67 |     });
68 |   }, TOAST_REMOVE_DELAY);
69 |
70 |   toastTimeouts.set(toastId, timeout);
71 | };
72 |
73 | export const reducer = (state: State, action: Action): State => {
74 |   switch (action.type) {
75 |     case "ADD_TOAST":
76 |       return {
77 |         ...state,
78 |         toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
79 |       };
80 |
81 |     case "UPDATE_TOAST":
82 |       return {
83 |         ...state,
84 |         toasts: state.toasts.map((t) =>
85 |           t.id === action.toast.id ? { ...t, ...action.toast } : t,
86 |         ),
87 |       };
88 |
89 |     case "DISMISS_TOAST": {
90 |       const { toastId } = action;
91 |
92 |       // ! Side effects ! - This could be extracted into a dismissToast() action,
93 |       // but I'll keep it here for simplicity
94 |       if (toastId) {
95 |         addToRemoveQueue(toastId);
96 |       } else {
97 |         for (const toast of state.toasts) {
98 |           addToRemoveQueue(toast.id);
99 |         }
100 |       }
101 |
102 |       return {
103 |         ...state,
104 |         toasts: state.toasts.map((t) =>
105 |           t.id === toastId || toastId === undefined
106 |             ? {
107 |                 ...t,
108 |                 open: false,
109 |               }
110 |             : t,
111 |         ),
112 |       };
113 |     }
114 |     case "REMOVE_TOAST":
115 |       if (action.toastId === undefined) {
116 |         return {
117 |           ...state,
118 |           toasts: [],
119 |         };
120 |       }
121 |       return {
122 |         ...state,
123 |         toasts: state.toasts.filter((t) => t.id !== action.toastId),
124 |       };
125 |   }
126 | };
127 |
128 | const listeners: Array<(state: State) => void> = [];
129 |
130 | let memoryState: State = { toasts: [] };
131 |
132 | function dispatch(action: Action) {
133 |   memoryState = reducer(memoryState, action);
134 |   for (const listener of listeners) {
135 |     listener(memoryState);
136 |   }
137 | }
138 |
139 | type Toast = Omit<ToasterToast, "id">;
140 |
141 | function toast({ ...props }: Toast) {
142 |   const id = genId();
143 |
144 |   const update = (props: ToasterToast) =>
145 |     dispatch({
146 |       type: "UPDATE_TOAST",
147 |       toast: { ...props, id },
148 |     });
149 |
150 |   const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id });
151 |
152 |   dispatch({
153 |     type: "ADD_TOAST",
154 |     toast: {
155 |       ...props,
156 |       id,
157 |       open: true,
158 |       onOpenChange: (open) => {
159 |         if (!open) dismiss();
160 |       },
161 |     },
162 |   });
163 |
164 |   return {
165 |     id: id,
166 |     dismiss,
167 |     update,
168 |   };
169 | }
170 |
171 | function useToast() {
172 |   const [state, setState] = React.useState<State>(memoryState);
173 |
174 |   React.useEffect(() => {
175 |     listeners.push(setState);
176 |     return () => {
177 |       const index = listeners.indexOf(setState);
178 |
179 |       if (index > -1) {
180 |         listeners.splice(index, 1);
181 |       }
182 |     };
183 |   }, [state]);
184 |
185 |   return {
186 |     ...state,
187 |     toast,
188 |     dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
189 |     update: (toastId: string, props: ToasterToast) =>
190 |       dispatch({ type: "UPDATE_TOAST", toast: { ...props, id: toastId } }),
191 |   };
[TRUNCATED]
```

packages/ui/src/hooks/index.ts
```
1 | export * from "./use-media-query";
2 | export * from "./use-resize-observer";
3 | export * from "./use-enter-submit";
```

packages/ui/src/hooks/use-enter-submit.ts
```
1 | import { type RefObject, useRef } from "react";
2 |
3 | export function useEnterSubmit(): {
4 |   formRef: RefObject<HTMLFormElement>;
5 |   onKeyDown: (event: React.KeyboardEvent<HTMLTextAreaElement>) => void;
6 | } {
7 |   const formRef = useRef<HTMLFormElement>(null);
8 |
9 |   const handleKeyDown = (
10 |     event: React.KeyboardEvent<HTMLTextAreaElement>,
11 |   ): void => {
12 |     if (
13 |       event.key === "Enter" &&
14 |       !event.shiftKey &&
15 |       !event.nativeEvent.isComposing
16 |     ) {
17 |       formRef.current?.requestSubmit();
18 |       event.preventDefault();
19 |     }
20 |   };
21 |
22 |   return { formRef, onKeyDown: handleKeyDown };
23 | }
```

packages/ui/src/hooks/use-media-query.ts
```
1 | import { useEffect, useState } from "react";
2 |
3 | export function useMediaQuery(query: string) {
4 |   const [value, setValue] = useState(false);
5 |
6 |   useEffect(() => {
7 |     function onChange(event: MediaQueryListEvent) {
8 |       setValue(event.matches);
9 |     }
10 |
11 |     const result = matchMedia(query);
12 |     result.addEventListener("change", onChange);
13 |     setValue(result.matches);
14 |
15 |     return () => result.removeEventListener("change", onChange);
16 |   }, [query]);
17 |
18 |   return value;
19 | }
```

packages/ui/src/hooks/use-resize-observer.ts
```
1 | import { type RefObject, useEffect, useState } from "react";
2 |
3 | export function useResizeObserver(
4 |   elementRef: RefObject<Element>,
5 | ): ResizeObserverEntry | undefined {
6 |   const [entry, setEntry] = useState<ResizeObserverEntry>();
7 |
8 |   const updateEntry = ([entry]: ResizeObserverEntry[]): void => {
9 |     setEntry(entry);
10 |   };
11 |
12 |   useEffect(() => {
13 |     const node = elementRef?.current;
14 |     if (!node) return;
15 |
16 |     const observer = new ResizeObserver(updateEntry);
17 |
18 |     observer.observe(node);
19 |
20 |     return () => observer.disconnect();
21 |   }, [elementRef]);
22 |
23 |   return entry;
24 | }
```

packages/ui/src/utils/cn.ts
```
1 | import { type ClassValue, clsx } from "clsx";
2 | import { twMerge } from "tailwind-merge";
3 |
4 | export function cn(...inputs: ClassValue[]) {
5 |   return twMerge(clsx(inputs));
6 | }
```

packages/ui/src/utils/index.ts
```
1 | export * from "./cn";
2 | export * from "./truncate";
```

packages/ui/src/utils/truncate.ts
```
1 | export const truncate = (
2 |   str: string | null | undefined,
3 |   length: number,
4 | ): string | null => {
5 |   if (!str || str.length <= length) return str ?? null;
6 |   return `${str.slice(0, length - 3)}...`;
7 | };
```

apps/api/supabase/functions/generate-category-embedding/index.ts
```
1 | /// <reference types="https://esm.sh/@supabase/functions-js/src/edge-runtime.d.ts" />
2 |
3 | import { createClient } from "npm:@supabase/supabase-js@2.45.2";
4 | import type { Database, Tables } from "../../src/types";
5 |
6 | type TransactionCategoriesRecord = Tables<"transaction_categories">;
7 | interface WebhookPayload {
8 |   type: "INSERT";
9 |   table: string;
10 |   record: TransactionCategoriesRecord;
11 |   schema: "public";
12 |   old_record: null | TransactionCategoriesRecord;
13 | }
14 |
15 | const supabase = createClient<Database>(
16 |   Deno.env.get("SUPABASE_URL")!,
17 |   Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!,
18 | );
19 |
20 | const model = new Supabase.ai.Session("gte-small");
21 |
22 | Deno.serve(async (req) => {
23 |   const payload: WebhookPayload = await req.json();
24 |   const { id, name } = payload.record;
25 |
26 |   if (name === payload?.old_record?.name) {
27 |     return new Response("No change");
28 |   }
29 |
30 |   const embedding = await model.run(name, {
31 |     mean_pool: true,
32 |     normalize: true,
33 |   });
34 |
35 |   const { error } = await supabase
36 |     .from("transaction_categories")
37 |     .update({
38 |       embedding: JSON.stringify(embedding),
39 |     })
40 |     .eq("id", id);
41 |
42 |   if (error) {
43 |     console.warn(error.message);
44 |   }
45 |
46 |   return new Response(JSON.stringify(embedding, null, 2));
47 | });
```

apps/api/supabase/functions/generate-document-embedding/index.ts
```
1 | /// <reference types="https://esm.sh/@supabase/functions-js/src/edge-runtime.d.ts" />
2 |
3 | import { createClient } from "npm:@supabase/supabase-js@2.45.2";
4 | import { openai } from "https://esm.sh/@ai-sdk/openai@0.0.54";
5 | import { CSVLoader } from "https://esm.sh/@langchain/community@0.2.31/document_loaders/fs/csv";
6 | import { DocxLoader } from "https://esm.sh/@langchain/community@0.2.31/document_loaders/fs/docx";
7 | import { generateObject } from "https://esm.sh/ai@3.3.20";
8 | import { TextLoader } from "https://esm.sh/langchain@0.2.17/document_loaders/fs/text";
9 | import { extractText, getDocumentProxy } from "https://esm.sh/unpdf@0.11.0";
10 | import { z } from "https://esm.sh/zod@3.21.4";
11 | import type { Database, Tables } from "../../src/types";
12 | import { TAGS } from "./tags.ts";
13 |
14 | type DocumentsRecord = Tables<"documents">;
15 |
16 | interface WebhookPayload {
17 |   type: "INSERT";
18 |   table: string;
19 |   record: DocumentsRecord;
20 |   schema: "public";
21 |   old_record: null | DocumentsRecord;
22 | }
23 |
24 | const supabase = createClient<Database>(
25 |   Deno.env.get("SUPABASE_URL")!,
26 |   Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!,
27 | );
28 |
29 | Deno.serve(async (req) => {
30 |   const payload: WebhookPayload = await req.json();
31 |
32 |   const { id, name, metadata, team_id } = payload.record;
33 |
34 |   const { data: fileData } = await supabase.storage
35 |     .from("vault")
36 |     .download(name);
37 |
38 |   let document: string | null = null;
39 |
40 |   if (!fileData) {
41 |     return new Response("File not found", {
42 |       status: 404,
43 |     });
44 |   }
45 |
46 |   switch (metadata.mimetype) {
47 |     case "application/pdf": {
48 |       const content = await fileData.arrayBuffer();
49 |       const pdf = await getDocumentProxy(content);
50 |
51 |       const { text } = await extractText(pdf, {
52 |         mergePages: true,
53 |       });
54 |
55 |       // Unsupported Unicode escape sequence
56 |       document = text.replaceAll("\u0000", "");
57 |
58 |       break;
59 |     }
60 |     case "text/csv": {
61 |       const loader = new CSVLoader(fileData, {
62 |         splitPages: false,
63 |       });
64 |
65 |       document = await loader
66 |         .load()
67 |         .then((docs) => docs.map((doc) => doc.pageContent).join("\n"));
68 |       break;
69 |     }
70 |     case "application/docx": {
71 |       const loader = new DocxLoader(fileData);
72 |       document = await loader
73 |         .load()
74 |         .then((docs) => docs.map((doc) => doc.pageContent).join("\n"));
75 |
76 |       break;
77 |     }
78 |     case "text/plain": {
79 |       const loader = new TextLoader(fileData);
80 |
81 |       document = await loader
82 |         .load()
83 |         .then((docs) => docs.map((doc) => doc.pageContent).join("\n"));
84 |       break;
85 |     }
86 |     default:
87 |       return new Response(`Unsupported mimetype: ${metadata.mimetype}`, {
88 |         status: 400,
89 |       });
90 |   }
91 |
92 |   if (!document) {
93 |     return new Response("Unsupported file type or empty content", {
94 |       status: 400,
95 |     });
96 |   }
97 |
98 |   const { data: teamData } = await supabase
99 |     .from("teams")
100 |     .select("id, document_classification")
101 |     .eq("id", team_id)
102 |     .single();
103 |
104 |   let response: { title: string | null; tag: string | null } | null = null;
105 |
106 |   if (teamData?.document_classification) {
107 |     const { object } = await generateObject({
108 |       model: openai("gpt-4o"),
109 |       schema: z.object({
110 |         title: z
111 |           .string()
112 |           .nullable()
113 |           .describe("Company name, supplier name, or a document name"),
114 |         tag: TAGS.describe("Classification of the document").nullable(),
115 |       }),
116 |       prompt: `
117 |         Analyze the document and extract:
118 |         1. Title: Company name, supplier name, or document name
119 |         2. Tag: Classify using predefined tags only; return null if no match
120 |         Provide concise, accurate results based on the document content.
121 |         Document: ${document.slice(0, 1000)}
122 |     `,
123 |       temperature: 0.5,
124 |     });
125 |
126 |     response = {
127 |       title: object?.title ?? null,
128 |       tag: object?.tag ?? null,
129 |     };
130 |   }
131 |
132 |   const { error: updateError } = await supabase
133 |     .from("documents")
134 |     .update({
135 |       title: response?.title,
136 |       body: document,
137 |       tag: response?.tag,
138 |     })
139 |     .eq("id", id);
140 |
141 |   if (updateError) {
142 |     console.log(`Error updating document: ${updateError.message}`);
143 |   }
144 |
145 |   return new Response("Document processed and embedded successfully", {
146 |     status: 200,
147 |     headers: { "Content-Type": "application/json" },
148 |   });
149 | });
```

apps/api/supabase/functions/generate-document-embedding/tags.ts
```
1 | import { z } from "https://esm.sh/zod@3.21.4";
2 |
3 | export const TAGS = z.enum([
4 |   "bylaws",
5 |   "shareholder_agreements",
6 |   "board_meeting",
7 |   "corporate_policies",
8 |   "annual_reports",
9 |   "budget_reports",
10 |   "audit_reports",
11 |   "tax_returns",
12 |   "invoices_and_receipts",
13 |   "employee_handbook",
14 |   "payroll_records",
15 |   "performance_reviews",
16 |   "employee_training_materials",
17 |   "benefits_documentation",
18 |   "termination_letters",
19 |   "patents",
20 |   "trademarks",
21 |   "copyrights",
22 |   "client_contracts",
23 |   "vendor_agreements",
24 |   "compliance_reports",
25 |   "regulatory_filings",
26 |   "advertising_copy",
27 |   "press_releases",
28 |   "branding_guidelines",
29 |   "market_research_reports",
30 |   "campaign_performance_reports",
31 |   "customer_surveys",
32 |   "quality_control_reports",
33 |   "inventory_reports",
34 |   "maintenance_logs",
35 |   "production_schedules",
36 |   "vendor_agreements",
37 |   "supplier_agreements",
38 |   "sales_contracts",
39 |   "sales_reports",
40 |   "client_proposals",
41 |   "financial_records",
42 |   "customer_order_forms",
43 |   "sales_presentations",
44 |   "data_security_plans",
45 |   "system_architecture_diagrams",
46 |   "incident_response_plans",
47 |   "user_manuals",
48 |   "software_licenses",
49 |   "data_backup_logs",
50 |   "project_plans",
51 |   "task_lists",
52 |   "risk_management_plans",
53 |   "project_status_reports",
54 |   "meeting_agendas",
55 |   "lab_notebooks",
56 |   "experiment_results",
57 |   "product_design_documents",
58 |   "prototypes_and_models",
59 |   "testing_reports",
60 |   "newsletters",
61 |   "email_correspondence",
62 |   "support_tickets",
63 |   "faqs_and_knowledge",
64 |   "user_guides",
65 |   "warranty_information",
66 |   "swot_analysis",
67 |   "strategic_objectives",
68 |   "roadmaps",
69 |   "competitive_analysis",
70 |   "safety_data_sheets",
71 |   "compliance_certificates",
72 |   "incident_reports",
73 |   "emergency_response_plans",
74 |   "certification_records",
75 |   "training_schedules",
76 |   "e_learning_materials",
77 |   "competency_assessment_forms",
78 | ]);
```

apps/dashboard/jobs/tasks/inbox/document.ts
```
1 | import { DocumentClient } from "@midday/documents";
2 | import { createClient } from "@midday/supabase/job";
3 | import { schemaTask } from "@trigger.dev/sdk/v3";
4 | import { handleInboxNotifications } from "jobs/utils/inbox-notifications";
5 | import { z } from "zod";
6 |
7 | export const inboxDocument = schemaTask({
8 |   id: "inbox-document",
9 |   schema: z.object({
10 |     inboxId: z.string().uuid(),
11 |   }),
12 |   maxDuration: 300,
13 |   queue: {
14 |     concurrencyLimit: 10,
15 |   },
16 |   run: async ({ inboxId }) => {
17 |     const supabase = createClient();
18 |
19 |     const { data: inboxData } = await supabase
20 |       .from("inbox")
21 |       .select()
22 |       .eq("id", inboxId)
23 |       .single()
24 |       .throwOnError();
25 |
26 |     if (!inboxData || !inboxData.file_path) {
27 |       throw Error("Inbox data not found");
28 |     }
29 |
30 |     const { data } = await supabase.storage
31 |       .from("vault")
32 |       .download(inboxData.file_path.join("/"));
33 |
34 |     // Convert the document data to a Buffer and base64 encode it.
35 |     const buffer = await data?.arrayBuffer();
36 |
37 |     if (!buffer) {
38 |       throw Error("No file data");
39 |     }
40 |
41 |     try {
42 |       const document = new DocumentClient({
43 |         contentType: inboxData.content_type!,
44 |       });
45 |
46 |       const result = await document.getDocument({
47 |         content: Buffer.from(buffer).toString("base64"),
48 |       });
49 |
50 |       const { data: updatedInbox } = await supabase
51 |         .from("inbox")
52 |         .update({
53 |           amount: result.amount,
54 |           currency: result.currency,
55 |           display_name: result.name,
56 |           website: result.website,
57 |           date: result.date && new Date(result.date).toISOString(),
58 |           type: result.type,
59 |           description: result.description,
60 |           status: "pending",
61 |         })
62 |         .eq("id", inboxId)
63 |         .select()
64 |         .single();
65 |
66 |       if (updatedInbox?.amount) {
67 |         // TODO: Send event to match inbox
68 |       }
69 |     } catch {
70 |       // If we end up here we could not parse the document
71 |       // But we want to update the status so we show the record with fallback name (Subject/From name)
72 |       await supabase
73 |         .from("inbox")
74 |         .update({ status: "pending" })
75 |         .eq("id", inboxId);
76 |
77 |       // And send a notification about the new inbox record
78 |       // We send this if we dont find a suggested match
79 |       await handleInboxNotifications({
80 |         inboxId,
81 |         description: inboxData.display_name!,
82 |         teamId: inboxData.team_id!,
83 |       });
84 |     }
85 |   },
86 | });
```

apps/dashboard/jobs/tasks/inbox/slack-upload.ts
```
1 | import {
2 |   createSlackWebClient,
3 |   downloadFile,
4 | } from "@midday/app-store/slack-client";
5 | import { DocumentClient, prepareDocument } from "@midday/documents";
6 | import { createClient } from "@midday/supabase/job";
7 | import { schemaTask } from "@trigger.dev/sdk/v3";
8 | import { format } from "date-fns";
9 | import { z } from "zod";
10 |
11 | export const inboxSlackUpload = schemaTask({
12 |   id: "inbox-slack-upload",
13 |   schema: z.object({
14 |     teamId: z.string(),
15 |     token: z.string(),
16 |     channelId: z.string(),
17 |     threadId: z.string().optional(),
18 |     file: z.object({
19 |       id: z.string(),
20 |       name: z.string(),
21 |       mimetype: z.string(),
22 |       size: z.number(),
23 |       url: z.string(),
24 |     }),
25 |   }),
26 |   maxDuration: 300,
27 |   queue: {
28 |     concurrencyLimit: 10,
29 |   },
30 |   run: async ({
31 |     teamId,
32 |     token,
33 |     channelId,
34 |     threadId,
35 |     file: { id, name, mimetype, size, url },
36 |   }) => {
37 |     const supabase = createClient();
38 |
39 |     const slackApp = createSlackWebClient({
40 |       token,
41 |     });
42 |
43 |     if (threadId) {
44 |       await slackApp.assistant.threads.setStatus({
45 |         channel_id: channelId,
46 |         thread_ts: threadId,
47 |         status: "Is thinking...",
48 |       });
49 |     }
50 |
51 |     const fileData = await downloadFile({
52 |       privateDownloadUrl: url,
53 |       token,
54 |     });
55 |
56 |     if (!fileData) {
57 |       throw Error("No file data");
58 |     }
59 |
60 |     const document = await prepareDocument({
61 |       Content: Buffer.from(fileData).toString("base64"),
62 |       ContentType: mimetype,
63 |       ContentLength: size,
64 |       Name: name,
65 |     });
66 |
67 |     const pathTokens = [teamId, "inbox", document.fileName];
68 |
69 |     // Upload file to vault
70 |     await supabase.storage
71 |       .from("vault")
72 |       .upload(pathTokens.join("/"), new Uint8Array(document.content), {
73 |         contentType: document.mimeType,
74 |         upsert: true,
75 |       });
76 |
77 |     const { data: inboxData } = await supabase
78 |       .from("inbox")
79 |       .insert({
80 |         // NOTE: If we can't parse the name using OCR this will be the fallback name
81 |         display_name: document.name,
82 |         team_id: teamId,
83 |         file_path: pathTokens,
84 |         file_name: document.fileName,
85 |         content_type: document.mimeType,
86 |         reference_id: `${id}_${document.fileName}`,
87 |         size,
88 |       })
89 |       .select("*")
90 |       .single()
91 |       .throwOnError();
92 |
93 |     if (!inboxData) {
94 |       throw Error("Inbox data not found");
95 |     }
96 |
97 |     try {
98 |       const document = new DocumentClient({
99 |         contentType: inboxData.content_type!,
100 |       });
101 |
102 |       const result = await document.getDocument({
103 |         content: Buffer.from(fileData).toString("base64"),
104 |       });
105 |
106 |       const { data: updatedInbox } = await supabase
107 |         .from("inbox")
108 |         .update({
109 |           amount: result.amount,
110 |           currency: result.currency,
111 |           display_name: result.name,
112 |           website: result.website,
113 |           date: result.date ? new Date(result.date).toISOString() : null,
114 |           type: result.type,
115 |           description: result.description,
116 |           status: "pending",
117 |         })
118 |         .eq("id", inboxData.id)
119 |         .select()
120 |         .single();
121 |
122 |       if (updatedInbox?.amount) {
123 |         // Send notification to slack
124 |         try {
125 |           await slackApp.chat.postMessage({
126 |             channel: channelId,
127 |             thread_ts: threadId,
128 |             unfurl_links: false,
129 |             unfurl_media: false,
130 |             blocks: [
131 |               {
132 |                 type: "section",
133 |                 text: {
134 |                   type: "mrkdwn",
135 |                   text: `Here's the information I extracted from your receipt:\n\n• *Vendor:* ${updatedInbox.display_name}\n• *Amount:* ${new Intl.NumberFormat(
136 |                     "en-US",
137 |                     {
138 |                       style: "currency",
139 |                       currency: updatedInbox.currency!,
140 |                     },
141 |                   ).format(
142 |                     updatedInbox.amount,
143 |                   )}\n• *Date:* ${updatedInbox.date ? format(new Date(updatedInbox.date), "MMM d") : ""}\n\nWe'll notify you when we match it to a transaction.`,
144 |                 },
145 |               },
146 |               {
147 |                 type: "actions",
148 |                 elements: [
149 |                   {
150 |                     type: "button",
151 |                     text: {
152 |                       type: "plain_text",
153 |                       text: "Show receipt",
154 |                       emoji: true,
155 |                     },
156 |                     url: `https://app.midday.ai/inbox?id=${encodeURIComponent(updatedInbox.id)}`,
157 |                     action_id: "view_receipt",
158 |                   },
159 |                 ],
160 |               },
161 |             ],
162 |           });
163 |
164 |           if (threadId) {
165 |             await slackApp.assistant.threads.setStatus({
166 |               channel_id: channelId,
167 |               thread_ts: threadId,
168 |               status: "",
169 |             });
170 |           }
171 |         } catch (err) {
172 |           console.error(err);
173 |         }
174 |
175 |         // TODO: Send event to match inbox
176 |       }
177 |     } catch {
178 |       // If we end up here we could not parse the document
[TRUNCATED]
```

apps/dashboard/jobs/tasks/inbox/upload.ts
```
1 | import { DocumentClient } from "@midday/documents";
2 | import { createClient } from "@midday/supabase/job";
3 | import { schemaTask } from "@trigger.dev/sdk/v3";
4 | import { z } from "zod";
5 |
6 | export const inboxUpload = schemaTask({
7 |   id: "inbox-upload",
8 |   schema: z.object({
9 |     teamId: z.string().uuid(),
10 |     mimetype: z.string(),
11 |     size: z.number(),
12 |     file_path: z.array(z.string()),
13 |   }),
14 |   maxDuration: 300,
15 |   queue: {
16 |     concurrencyLimit: 25,
17 |   },
18 |   run: async ({ teamId, mimetype, size, file_path }) => {
19 |     const supabase = createClient();
20 |
21 |     const filename = file_path.at(-1);
22 |
23 |     const { data: inboxData } = await supabase
24 |       .from("inbox")
25 |       .insert({
26 |         // NOTE: If we can't parse the name using OCR this will be the fallback name
27 |         display_name: filename,
28 |         team_id: teamId,
29 |         file_path: file_path,
30 |         file_name: filename,
31 |         content_type: mimetype,
32 |         size,
33 |       })
34 |       .select("*")
35 |       .single()
36 |       .throwOnError();
37 |
38 |     if (!inboxData) {
39 |       throw Error("Inbox data not found");
40 |     }
41 |
42 |     const { data } = await supabase.storage
43 |       .from("vault")
44 |       .download(file_path.join("/"));
45 |
46 |     // Convert the document data to a Buffer and base64 encode it.
47 |     const buffer = await data?.arrayBuffer();
48 |
49 |     if (!buffer) {
50 |       throw Error("No file data");
51 |     }
52 |
53 |     try {
54 |       const document = new DocumentClient({
55 |         contentType: inboxData.content_type!,
56 |       });
57 |
58 |       const result = await document.getDocument({
59 |         content: Buffer.from(buffer).toString("base64"),
60 |       });
61 |
62 |       const { data: updatedInbox } = await supabase
63 |         .from("inbox")
64 |         .update({
65 |           amount: result.amount,
66 |           currency: result.currency,
67 |           display_name: result.name,
68 |           website: result.website,
69 |           date: result.date && new Date(result.date).toISOString(),
70 |           type: result.type,
71 |           description: result.description,
72 |           status: "pending",
73 |         })
74 |         .eq("id", inboxData.id)
75 |         .select()
76 |         .single();
77 |
78 |       // TODO: Send event to match inbox
79 |     } catch {
80 |       // If we end up here we could not parse the document
81 |       // But we want to update the status so we show the record with fallback name
82 |       await supabase
83 |         .from("inbox")
84 |         .update({ status: "pending" })
85 |         .eq("id", inboxData.id);
86 |     }
87 |   },
88 | });
```

apps/dashboard/jobs/tasks/rates/rates-scheduler.ts
```
1 | import { client } from "@midday/engine/client";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schedules } from "@trigger.dev/sdk/v3";
4 | import { processBatch } from "jobs/utils/process-batch";
5 |
6 | export const ratesScheduler = schedules.task({
7 |   id: "rates-scheduler",
8 |   cron: "0 0,12 * * *",
9 |   run: async () => {
10 |     // Only run in production (Set in Trigger.dev)
11 |     if (process.env.TRIGGER_ENVIRONMENT !== "production") return;
12 |
13 |     const supabase = createClient();
14 |
15 |     const ratesResponse = await client.rates.$get();
16 |
17 |     if (!ratesResponse.ok) {
18 |       logger.error("Failed to get rates");
19 |       throw new Error("Failed to get rates");
20 |     }
21 |
22 |     const { data: ratesData } = await ratesResponse.json();
23 |
24 |     const data = ratesData.flatMap((rate) => {
25 |       return Object.entries(rate.rates).map(([target, value]) => ({
26 |         base: rate.source,
27 |         target: target,
28 |         rate: value,
29 |         updated_at: rate.date,
30 |       }));
31 |     });
32 |
33 |     await processBatch(data, 500, async (batch) => {
34 |       await supabase.from("exchange_rates").upsert(batch, {
35 |         onConflict: "base, target",
36 |         ignoreDuplicates: false,
37 |       });
38 |
39 |       return batch;
40 |     });
41 |   },
42 | });
```

apps/dashboard/jobs/tasks/reconnect/connection.ts
```
1 | import { client } from "@midday/engine/client";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { syncConnection } from "jobs/tasks/bank/sync/connection";
5 | import { z } from "zod";
6 |
7 | export const reconnectConnection = schemaTask({
8 |   id: "reconnect-connection",
9 |   maxDuration: 300,
10 |   retry: {
11 |     maxAttempts: 2,
12 |   },
13 |   schema: z.object({
14 |     teamId: z.string().uuid(),
15 |     connectionId: z.string().uuid(),
16 |     provider: z.string(),
17 |   }),
18 |   run: async ({ teamId, connectionId, provider }) => {
19 |     const supabase = createClient();
20 |
21 |     if (provider === "gocardless") {
22 |       // We need to update the reference of the connection
23 |       const connection = await client.connections[":reference"].$get({
24 |         param: { reference: teamId },
25 |       });
26 |
27 |       const connectionResponse = await connection.json();
28 |       const referenceId = connectionResponse?.data.id;
29 |
30 |       // Update the reference_id of the new connection
31 |       if (referenceId) {
32 |         logger.info("Updating reference_id of the new connection");
33 |
34 |         await supabase
35 |           .from("bank_connections")
36 |           .update({
37 |             reference_id: referenceId,
38 |           })
39 |           .eq("id", connectionId);
40 |       }
41 |
42 |       // The account_ids can be different between the old and new connection
43 |       // So we need to check for account_reference and update
44 |       const accounts = await client.accounts.$get({
45 |         query: {
46 |           id: referenceId,
47 |           provider: "gocardless",
48 |         },
49 |       });
50 |
51 |       const accountsResponse = await accounts.json();
52 |
53 |       await Promise.all(
54 |         accountsResponse.data.map(async (account) => {
55 |           await supabase
56 |             .from("bank_accounts")
57 |             .update({
58 |               account_id: account.id,
59 |             })
60 |             .eq("account_reference", account.resource_id);
61 |         }),
62 |       );
63 |     }
64 |
65 |     await syncConnection.trigger({
66 |       connectionId,
67 |       manualSync: true,
68 |     });
69 |   },
70 | });
```

apps/dashboard/jobs/tasks/team/delete.ts
```
1 | import { client } from "@midday/engine/client";
2 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
3 | import { z } from "zod";
4 |
5 | export const deleteTeam = schemaTask({
6 |   id: "delete-team",
7 |   schema: z.object({
8 |     teamId: z.string().uuid(),
9 |     connections: z.array(
10 |       z.object({
11 |         provider: z.enum(["teller", "plaid", "gocardless"]).nullable(),
12 |         reference_id: z.string().nullable(),
13 |         access_token: z.string().nullable(),
14 |       }),
15 |     ),
16 |   }),
17 |   maxDuration: 300,
18 |   queue: {
19 |     concurrencyLimit: 10,
20 |   },
21 |   run: async ({ teamId, connections }) => {
22 |     // Unregister sync scheduler (Not implemented yet in Trigger.dev)
23 |     // await schedules.del(teamId);
24 |
25 |     // Delete connections in providers
26 |     const connectionPromises = connections.map(async (connection) => {
27 |       return client.connections.delete.$post({
28 |         json: {
29 |           id: connection.reference_id,
30 |           provider: connection.provider,
31 |           accessToken: connection.access_token,
32 |         },
33 |       });
34 |     });
35 |
36 |     logger.info("Deleting team connections", {
37 |       connections: connections.length,
38 |     });
39 |
40 |     await Promise.all(connectionPromises);
41 |   },
42 | });
```

apps/dashboard/jobs/tasks/transactions/export.ts
```
1 | import { writeToString } from "@fast-csv/format";
2 | import { createClient } from "@midday/supabase/job";
3 | import { metadata, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { BlobReader, BlobWriter, TextReader, ZipWriter } from "@zip.js/zip.js";
5 | import { serializableToBlob } from "jobs/utils/blob";
6 | import { revalidateCache } from "jobs/utils/revalidate-cache";
7 | import { z } from "zod";
8 | import { processExport } from "./process-export";
9 |
10 | // Process transactions in batches of 100
11 | const BATCH_SIZE = 100;
12 |
13 | export const exportTransactions = schemaTask({
14 |   id: "export-transactions",
15 |   schema: z.object({
16 |     teamId: z.string().uuid(),
17 |     locale: z.string(),
18 |     transactionIds: z.array(z.string().uuid()),
19 |   }),
20 |   maxDuration: 300,
21 |   queue: {
22 |     concurrencyLimit: 10,
23 |   },
24 |   machine: {
25 |     preset: "large-1x",
26 |   },
27 |   run: async ({ teamId, locale, transactionIds }) => {
28 |     const supabase = createClient();
29 |
30 |     const filePath = `export-${new Date().toISOString()}`;
31 |     const path = `${teamId}/exports`;
32 |     const fileName = `${filePath}.zip`;
33 |
34 |     metadata.set("progress", 20);
35 |
36 |     // Process transactions in batches of 100 and collect results
37 |     // Update progress for each batch
38 |     const results = [];
39 |
40 |     const totalBatches = Math.ceil(transactionIds.length / BATCH_SIZE);
41 |     const progressPerBatch = 60 / totalBatches;
42 |     let currentProgress = 20;
43 |
44 |     for (let i = 0; i < transactionIds.length; i += BATCH_SIZE) {
45 |       const transactionBatch = transactionIds.slice(i, i + BATCH_SIZE);
46 |
47 |       const batchResult = await processExport.triggerAndWait({
48 |         ids: transactionBatch,
49 |         locale,
50 |       });
51 |
52 |       results.push(batchResult);
53 |
54 |       currentProgress += progressPerBatch;
55 |       metadata.set("progress", Math.round(currentProgress));
56 |     }
57 |
58 |     const rows = results
59 |       .flatMap((r) => (r.ok ? r.output.rows : []))
60 |       //   Date is the first column
61 |       .sort(
62 |         (a, b) =>
63 |           new Date(b[0] as string).getTime() -
64 |           new Date(a[0] as string).getTime(),
65 |       );
66 |
67 |     const attachments = results.flatMap((r) =>
68 |       r.ok ? r.output.attachments : [],
69 |     );
70 |
71 |     const csv = await writeToString(rows, {
72 |       headers: [
73 |         "ID",
74 |         "Date",
75 |         "Description",
76 |         "Additional info",
77 |         "Amount",
78 |         "Currency",
79 |         "Formatted amount",
80 |         "VAT",
81 |         "Category",
82 |         "Category description",
83 |         "Status",
84 |         "Attachments",
85 |         "Balance",
86 |         "Account",
87 |         "Note",
88 |       ],
89 |     });
90 |
91 |     const zipFileWriter = new BlobWriter("application/zip");
92 |     const zipWriter = new ZipWriter(zipFileWriter);
93 |
94 |     zipWriter.add("transactions.csv", new TextReader(csv));
95 |
96 |     metadata.set("progress", 90);
97 |
98 |     // Add attachments to zip
99 |     attachments?.map((attachment) => {
100 |       if (attachment.blob) {
101 |         zipWriter.add(
102 |           attachment.name,
103 |           new BlobReader(serializableToBlob(attachment.blob)),
104 |         );
105 |       }
106 |     });
107 |
108 |     const zip = await zipWriter.close();
109 |
110 |     metadata.set("progress", 95);
111 |
112 |     await supabase.storage
113 |       .from("vault")
114 |       .upload(`${path}/${fileName}`, await zip.arrayBuffer(), {
115 |         upsert: true,
116 |         contentType: "application/zip",
117 |       });
118 |
119 |     revalidateCache({ tag: "vault", id: teamId });
120 |
121 |     metadata.set("progress", 100);
122 |
123 |     return {
124 |       filePath,
125 |       fileName,
126 |       totalItems: rows.length,
127 |     };
128 |   },
129 | });
```

apps/dashboard/jobs/tasks/transactions/import.ts
```
1 | import { mapTransactions } from "@midday/import/mappings";
2 | import { transform } from "@midday/import/transform";
3 | import { validateTransactions } from "@midday/import/validate";
4 | import { createClient } from "@midday/supabase/job";
5 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
6 | import { processBatch } from "jobs/utils/process-batch";
7 | import { revalidateCache } from "jobs/utils/revalidate-cache";
8 | import Papa from "papaparse";
9 | import { z } from "zod";
10 |
11 | const BATCH_SIZE = 500;
12 |
13 | export const importTransactions = schemaTask({
14 |   id: "import-transactions",
15 |   schema: z.object({
16 |     importType: z.enum(["csv", "image"]),
17 |     inverted: z.boolean(),
18 |     filePath: z.array(z.string()).optional(),
19 |     bankAccountId: z.string(),
20 |     currency: z.string(),
21 |     teamId: z.string(),
22 |     table: z.array(z.record(z.string(), z.string())).optional(),
23 |     mappings: z.object({
24 |       amount: z.string(),
25 |       date: z.string(),
26 |       description: z.string(),
27 |     }),
28 |   }),
29 |   maxDuration: 300,
30 |   queue: {
31 |     concurrencyLimit: 10,
32 |   },
33 |   run: async ({
34 |     teamId,
35 |     filePath,
36 |     importType,
37 |     bankAccountId,
38 |     currency,
39 |     mappings,
40 |     inverted,
41 |     table,
42 |   }) => {
43 |     const supabase = createClient();
44 |
45 |     switch (importType) {
46 |       case "csv": {
47 |         if (!filePath) {
48 |           throw new Error("File path is required");
49 |         }
50 |
51 |         const { data: fileData } = await supabase.storage
52 |           .from("vault")
53 |           .download(filePath.join("/"));
54 |
55 |         const content = await fileData?.text();
56 |
57 |         if (!content) {
58 |           throw new Error("File content is required");
59 |         }
60 |
61 |         await new Promise((resolve, reject) => {
62 |           Papa.parse(content, {
63 |             header: true,
64 |             skipEmptyLines: true,
65 |             worker: false,
66 |             complete: resolve,
67 |             error: reject,
68 |             chunk: async (
69 |               chunk: {
70 |                 data: Record<string, string>[];
71 |                 errors: Array<{ message: string }>;
72 |               },
73 |               parser: Papa.Parser,
74 |             ) => {
75 |               parser.pause();
76 |
77 |               const { data } = chunk;
78 |
79 |               if (!data?.length) {
80 |                 throw new Error("No data in CSV import chunk");
81 |               }
82 |
83 |               const mappedTransactions = mapTransactions(
84 |                 data,
85 |                 mappings,
86 |                 currency,
87 |                 teamId,
88 |                 bankAccountId,
89 |               );
90 |
91 |               const transactions = mappedTransactions.map((transaction) =>
92 |                 transform({ transaction, inverted }),
93 |               );
94 |
95 |               const { validTransactions, invalidTransactions } =
96 |                 validateTransactions(transactions);
97 |
98 |               if (invalidTransactions.length > 0) {
99 |                 logger.error("Invalid transactions", {
100 |                   invalidTransactions,
101 |                 });
102 |               }
103 |
104 |               await processBatch(
105 |                 validTransactions,
106 |                 BATCH_SIZE,
107 |                 async (batch) => {
108 |                   return supabase.from("transactions").upsert(batch, {
109 |                     onConflict: "internal_id",
110 |                     ignoreDuplicates: true,
111 |                   });
112 |                 },
113 |               );
114 |
115 |               parser.resume();
116 |             },
117 |           });
118 |         });
119 |
120 |         break;
121 |       }
122 |       case "image": {
123 |         if (!table) {
124 |           throw new Error("Table is required");
125 |         }
126 |
127 |         const mappedTransactions = mapTransactions(
128 |           table,
129 |           mappings,
130 |           currency,
131 |           teamId,
132 |           bankAccountId,
133 |         );
134 |
135 |         const transactions = mappedTransactions.map((transaction) =>
136 |           transform({ transaction, inverted }),
137 |         );
138 |
139 |         await processBatch(transactions, BATCH_SIZE, async (batch) => {
140 |           return supabase.from("transactions").upsert(batch, {
141 |             onConflict: "internal_id",
142 |             ignoreDuplicates: true,
143 |           });
144 |         });
145 |
146 |         break;
147 |       }
148 |       default: {
149 |         throw new Error("Invalid import type");
150 |       }
151 |     }
152 |
153 |     await revalidateCache({ tag: "transactions", id: teamId });
154 |   },
155 | });
```

apps/dashboard/jobs/tasks/transactions/process-export.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { download } from "@midday/supabase/storage";
3 | import { schemaTask } from "@trigger.dev/sdk/v3";
4 | import { blobToSerializable } from "jobs/utils/blob";
5 | import { processBatch } from "jobs/utils/process-batch";
6 | import { z } from "zod";
7 |
8 | const ATTACHMENT_BATCH_SIZE = 20;
9 |
10 | export const processExport = schemaTask({
11 |   id: "process-export",
12 |   schema: z.object({
13 |     ids: z.array(z.string().uuid()),
14 |     locale: z.string(),
15 |   }),
16 |   maxDuration: 300,
17 |   queue: {
18 |     concurrencyLimit: 5,
19 |   },
20 |   machine: {
21 |     preset: "large-1x",
22 |   },
23 |   run: async ({ ids, locale }) => {
24 |     const supabase = createClient();
25 |
26 |     const { data: transactionsData } = await supabase
27 |       .from("transactions")
28 |       .select(`
29 |         id,
30 |         date,
31 |         name,
32 |         description,
33 |         amount,
34 |         note,
35 |         balance,
36 |         currency,
37 |         vat:calculated_vat,
38 |         attachments:transaction_attachments(*),
39 |         category:transaction_categories(id, name, description),
40 |         bank_account:bank_accounts(id, name)
41 |       `)
42 |       .in("id", ids)
43 |       .throwOnError();
44 |
45 |     const attachments = await processBatch(
46 |       transactionsData ?? [],
47 |       ATTACHMENT_BATCH_SIZE,
48 |       async (batch) => {
49 |         const batchAttachments = await Promise.all(
50 |           batch.flatMap((transaction, idx) => {
51 |             const rowId = idx + 1;
52 |             return (transaction.attachments ?? []).map(
53 |               async (attachment, idx2: number) => {
54 |                 const filename = attachment.name?.split(".").at(0);
55 |                 const extension = attachment.name?.split(".").at(-1);
56 |
57 |                 const name =
58 |                   idx2 > 0
59 |                     ? `${filename}-${rowId}_${idx2}.${extension}`
60 |                     : `${filename}-${rowId}.${extension}`;
61 |
62 |                 const { data } = await download(supabase, {
63 |                   bucket: "vault",
64 |                   path: (attachment.path ?? []).join("/"),
65 |                 });
66 |
67 |                 return {
68 |                   id: transaction.id,
69 |                   name,
70 |                   blob: data ? await blobToSerializable(data) : null,
71 |                 };
72 |               },
73 |             );
74 |           }),
75 |         );
76 |
77 |         return batchAttachments.flat();
78 |       },
79 |     );
80 |
81 |     const rows = transactionsData
82 |       ?.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
83 |       .map((transaction) => [
84 |         transaction.id,
85 |         transaction.date,
86 |         transaction.name,
87 |         transaction.description,
88 |         transaction.amount,
89 |         transaction.currency,
90 |         Intl.NumberFormat(locale, {
91 |           style: "currency",
92 |           currency: transaction.currency,
93 |         }).format(transaction.amount),
94 |         transaction?.vat
95 |           ? Intl.NumberFormat(locale, {
96 |               style: "currency",
97 |               currency: transaction.currency,
98 |             }).format(transaction?.vat)
99 |           : "",
100 |         transaction?.category?.name ?? "",
101 |         transaction?.category?.description ?? "",
102 |         transaction?.attachments?.length > 0 ? "✔️" : "❌",
103 |
104 |         attachments
105 |           .filter((a) => a.id === transaction.id)
106 |           .map((a) => a.name)
107 |           .join(", ") ?? "",
108 |
109 |         transaction?.balance ?? "",
110 |         transaction?.bank_account?.name ?? "",
111 |         transaction?.note ?? "",
112 |       ]);
113 |
114 |     return {
115 |       rows: rows ?? [],
116 |       attachments: attachments ?? [],
117 |     };
118 |   },
119 | });
```

apps/dashboard/jobs/tasks/transactions/update-account-base-currency.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
3 | import {
4 |   getAccountBalance,
5 |   getTransactionAmount,
6 | } from "jobs/utils/base-currency";
7 | import { processBatch } from "jobs/utils/process-batch";
8 | import { z } from "zod";
9 |
10 | const BATCH_LIMIT = 500;
11 |
12 | export const updateAccountBaseCurrency = schemaTask({
13 |   id: "update-account-base-currency",
14 |   schema: z.object({
15 |     accountId: z.string().uuid(),
16 |     currency: z.string(),
17 |     balance: z.number(),
18 |     baseCurrency: z.string(),
19 |   }),
20 |   maxDuration: 300,
21 |   queue: {
22 |     concurrencyLimit: 10,
23 |   },
24 |   run: async ({ accountId, currency, balance, baseCurrency }) => {
25 |     const supabase = createClient();
26 |
27 |     const { data: exchangeRate } = await supabase
28 |       .from("exchange_rates")
29 |       .select("rate")
30 |       .eq("base", currency)
31 |       .eq("target", baseCurrency)
32 |       .single();
33 |
34 |     if (!exchangeRate) {
35 |       logger.info("No exchange rate found", {
36 |         currency,
37 |         baseCurrency,
38 |       });
39 |
40 |       return;
41 |     }
42 |
43 |     // Update account base balance and base currency
44 |     // based on the new currency exchange rate
45 |     await supabase
46 |       .from("bank_accounts")
47 |       .update({
48 |         base_balance: getAccountBalance({
49 |           currency: currency,
50 |           balance,
51 |           baseCurrency,
52 |           rate: exchangeRate.rate,
53 |         }),
54 |         base_currency: baseCurrency,
55 |       })
56 |       .eq("id", accountId);
57 |
58 |     const { data: transactionsData } = await supabase.rpc(
59 |       "get_all_transactions_by_account",
60 |       {
61 |         account_id: accountId,
62 |       },
63 |     );
64 |
65 |     const formattedTransactions = transactionsData?.map(
66 |       // Exclude fts_vector from the transaction object because it's a generated column
67 |       ({ fts_vector, ...transaction }) => ({
68 |         ...transaction,
69 |         base_amount: getTransactionAmount({
70 |           amount: transaction.amount,
71 |           currency: transaction.currency,
72 |           baseCurrency,
73 |           rate: exchangeRate?.rate,
74 |         }),
75 |         base_currency: baseCurrency,
76 |       }),
77 |     );
78 |
79 |     await processBatch(
80 |       formattedTransactions ?? [],
81 |       BATCH_LIMIT,
82 |       async (batch) => {
83 |         await supabase.from("transactions").upsert(batch, {
84 |           onConflict: "internal_id",
85 |           ignoreDuplicates: false,
86 |         });
87 |
88 |         return batch;
89 |       },
90 |     );
91 |   },
92 | });
```

apps/dashboard/jobs/tasks/transactions/update-base-currency.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { schemaTask } from "@trigger.dev/sdk/v3";
3 | import { revalidateCache } from "jobs/utils/revalidate-cache";
4 | import { triggerSequenceAndWait } from "jobs/utils/trigger-sequence";
5 | import { z } from "zod";
6 | import { updateAccountBaseCurrency } from "./update-account-base-currency";
7 |
8 | export const updateBaseCurrency = schemaTask({
9 |   id: "update-base-currency",
10 |   schema: z.object({
11 |     teamId: z.string().uuid(),
12 |     baseCurrency: z.string(),
13 |   }),
14 |   maxDuration: 300,
15 |   queue: {
16 |     concurrencyLimit: 10,
17 |   },
18 |   run: async ({ teamId, baseCurrency }) => {
19 |     const supabase = createClient();
20 |
21 |     // Get all enabled accounts
22 |     const { data: accountsData } = await supabase
23 |       .from("bank_accounts")
24 |       .select("id, currency, balance")
25 |       .eq("team_id", teamId)
26 |       .eq("enabled", true);
27 |
28 |     if (!accountsData) {
29 |       return;
30 |     }
31 |
32 |     const formattedAccounts = accountsData.map((account) => ({
33 |       accountId: account.id,
34 |       currency: account.currency,
35 |       balance: account.balance,
36 |       baseCurrency,
37 |     }));
38 |
39 |     if (formattedAccounts.length > 0) {
40 |       await triggerSequenceAndWait(
41 |         formattedAccounts,
42 |         updateAccountBaseCurrency,
43 |         {
44 |           delayMinutes: 0,
45 |         },
46 |       );
47 |
48 |       await revalidateCache({ tag: "bank", id: teamId });
49 |     }
50 |   },
51 | });
```

apps/dashboard/src/actions/ai/assistant-settings-action.ts
```
1 | "use server";
2 |
3 | import { revalidatePath } from "next/cache";
4 | import { authActionClient } from "../safe-action";
5 | import { assistantSettingsSchema } from "../schema";
6 | import { getAssistantSettings, setAssistantSettings } from "./storage";
7 |
8 | export const assistantSettingsAction = authActionClient
9 |   .schema(assistantSettingsSchema)
10 |   .metadata({
11 |     name: "assistant-settings",
12 |   })
13 |   .action(async ({ parsedInput: params, ctx: { user } }) => {
14 |     const settings = await getAssistantSettings();
15 |
16 |     await setAssistantSettings({
17 |       settings,
18 |       params,
19 |       userId: user?.id,
20 |       teamId: user?.team_id,
21 |     });
22 |
23 |     revalidatePath("/account/assistant");
24 |
25 |     return params;
26 |   });
```

apps/dashboard/src/actions/ai/clear-history-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "../safe-action";
4 | import { clearChats } from "./storage";
5 |
6 | export const clearHistoryAction = authActionClient
7 |   .metadata({
8 |     name: "clear-history",
9 |   })
10 |   .action(async ({ ctx: { user } }) => {
11 |     return clearChats({
12 |       teamId: user?.team_id,
13 |       userId: user?.id,
14 |     });
15 |   });
```

apps/dashboard/src/actions/ai/find-matching-category.ts
```
1 | "use server";
2 |
3 | import { openai } from "@ai-sdk/openai";
4 | import { streamObject } from "ai";
5 | import { createStreamableValue } from "ai/rsc";
6 | import { z } from "zod";
7 |
8 | export async function findMatchingCategory(
9 |   prompt: string,
10 |   categories: string[],
11 | ) {
12 |   const stream = createStreamableValue();
13 |
14 |   (async () => {
15 |     const { partialObjectStream } = await streamObject({
16 |       model: openai("gpt-4o-mini"),
17 |       system: `You are an AI assistant specialized in categorizing financial transactions.
18 |                Your task is to analyze the given transaction description and match it to the most appropriate category from the provided list.
19 |                Only use categories from the list provided. If no category seems to fit, respond with 'Uncategorized'.
20 |                Consider common financial terms, merchant names, and transaction patterns in your analysis.
21 |                Categories: ${categories.join("\n")}
22 |       `,
23 |       schema: z.object({
24 |         category: z
25 |           .string()
26 |           .describe("The category name that matches the prompt"),
27 |       }),
28 |       prompt,
29 |       temperature: 0.5,
30 |     });
31 |
32 |     for await (const partialObject of partialObjectStream) {
33 |       stream.update(partialObject);
34 |     }
35 |
36 |     stream.done();
37 |   })();
38 |
39 |   return { object: stream.value };
40 | }
```

apps/dashboard/src/actions/ai/generate-csv-mapping.ts
```
1 | "use server";
2 |
3 | import { openai } from "@ai-sdk/openai";
4 | import { streamObject } from "ai";
5 | import { createStreamableValue } from "ai/rsc";
6 | import { z } from "zod";
7 |
8 | export async function generateCsvMapping(
9 |   fieldColumns: string[],
10 |   firstRows: Record<string, string>[],
11 | ) {
12 |   const stream = createStreamableValue();
13 |
14 |   (async () => {
15 |     const { partialObjectStream } = await streamObject({
16 |       model: openai("gpt-4o-mini"),
17 |       schema: z.object({
18 |         date: z
19 |           .date()
20 |           .transform((value) => new Date(value))
21 |           .describe(
22 |             "The date of the transaction, return it in ISO-8601 format",
23 |           ),
24 |         description: z.string().describe("The text describing the transaction"),
25 |         amount: z
26 |           .number()
27 |           .describe(
28 |             "The amount involved in the transaction, including the minus sign if present",
29 |           ),
30 |         balance: z
31 |           .number()
32 |           .optional()
33 |           .describe(
34 |             "The balance of the account after the transaction, typically a cumulative value that changes with each transaction. It's usually a larger number compared to individual transaction amounts.",
35 |           ),
36 |       }),
37 |       prompt: `
38 |         The following columns are the headings from a CSV import file for importing a transactions.
39 |         Map these column names to the correct fields in our database (date, description, amount, balance) by providing the matching column name for each field.
40 |         You may also consult the first few rows of data to help you make the mapping, but you are mapping the columns, not the values.
41 |         If you are not sure or there is no matching column, omit the value.
42 |
43 |         Columns:
44 |         ${fieldColumns.join(",")}
45 |
46 |         First few rows of data:
47 |         ${firstRows.map((row) => JSON.stringify(row)).join("\n")}
48 |       `,
49 |       temperature: 0.2,
50 |     });
51 |
52 |     for await (const partialObject of partialObjectStream) {
53 |       stream.update(partialObject);
54 |     }
55 |
56 |     stream.done();
57 |   })();
58 |
59 |   return { object: stream.value };
60 | }
```

apps/dashboard/src/actions/ai/get-vat-rate.ts
```
1 | "use server";
2 |
3 | import { openai } from "@ai-sdk/openai";
4 | import { getCountry } from "@midday/location";
5 | import { generateObject } from "ai";
6 | import { z } from "zod";
7 | import { authActionClient } from "../safe-action";
8 | import { getVatRateSchema } from "../schema";
9 |
10 | export const getVatRateAction = authActionClient
11 |   .schema(getVatRateSchema)
12 |   .metadata({
13 |     name: "get-vat-rate",
14 |   })
15 |   .action(async ({ parsedInput: { name } }) => {
16 |     const country = getCountry();
17 |
18 |     const { object } = await generateObject({
19 |       model: openai("gpt-4o-mini"),
20 |       schema: z.object({
21 |         vat: z.number().min(5).max(100),
22 |       }),
23 |       prompt: `
24 |         You are an expert in VAT rates for the specific country and category \n
25 |         What's the VAT rate for category ${name} in ${country.name}?
26 |       `,
27 |       temperature: 0.8,
28 |     });
29 |
30 |     return {
31 |       vat: object.vat,
32 |       country: country.name,
33 |     };
34 |   });
```

apps/dashboard/src/actions/ai/storage.ts
```
1 | "use server";
2 |
3 | import { client as RedisClient } from "@midday/kv";
4 | import { getSession, getUser } from "@midday/supabase/cached-queries";
5 | import type { Chat, SettingsResponse } from "./types";
6 |
7 | export async function getAssistantSettings(): Promise<SettingsResponse> {
8 |   const user = await getUser();
9 |
10 |   const teamId = user?.data?.team_id;
11 |   const userId = user?.data?.id;
12 |
13 |   const defaultSettings: SettingsResponse = {
14 |     enabled: true,
15 |   };
16 |
17 |   const settings = await RedisClient.get(
18 |     `assistant:${teamId}:user:${userId}:settings`,
19 |   );
20 |
21 |   return {
22 |     ...defaultSettings,
23 |     ...(settings || {}),
24 |   };
25 | }
26 |
27 | type SetAassistant = {
28 |   settings: SettingsResponse;
29 |   userId: string;
30 |   teamId: string;
31 |   params: {
32 |     enabled?: boolean | undefined;
33 |   };
34 | };
35 |
36 | export async function setAssistantSettings({
37 |   settings,
38 |   params,
39 |   userId,
40 |   teamId,
41 | }: SetAassistant) {
42 |   return RedisClient.set(`assistant:${teamId}:user:${userId}:settings`, {
43 |     ...settings,
44 |     ...params,
45 |   });
46 | }
47 |
48 | export async function clearChats({
49 |   teamId,
50 |   userId,
51 | }: { teamId: string; userId: string }) {
52 |   const chats: string[] = await RedisClient.zrange(
53 |     `chat:${teamId}:user:${userId}`,
54 |     0,
55 |     -1,
56 |   );
57 |
58 |   const pipeline = RedisClient.pipeline();
59 |
60 |   for (const chat of chats) {
61 |     pipeline.del(chat);
62 |     pipeline.zrem(`chat:${teamId}:user:${userId}`, chat);
63 |   }
64 |
65 |   await pipeline.exec();
66 | }
67 |
68 | export async function getLatestChat() {
69 |   const settings = await getAssistantSettings();
70 |   if (!settings?.enabled) return null;
71 |
72 |   const user = await getUser();
73 |
74 |   const teamId = user?.data?.team_id;
75 |   const userId = user?.data?.id;
76 |
77 |   try {
78 |     const chat: string[] = await RedisClient.zrange(
79 |       `chat:${teamId}:user:${userId}`,
80 |       0,
81 |       1,
82 |       {
83 |         rev: true,
84 |       },
85 |     );
86 |
87 |     const lastId = chat.at(0);
88 |
89 |     if (lastId) {
90 |       return RedisClient.hgetall(lastId);
91 |     }
92 |   } catch (error) {
93 |     return null;
94 |   }
95 | }
96 |
97 | export async function getChats() {
98 |   const user = await getUser();
99 |
100 |   const teamId = user?.data?.team_id;
101 |   const userId = user?.data?.id;
102 |
103 |   try {
104 |     const pipeline = RedisClient.pipeline();
105 |     const chats: string[] = await RedisClient.zrange(
106 |       `chat:${teamId}:user:${userId}`,
107 |       0,
108 |       -1,
109 |       {
110 |         rev: true,
111 |       },
112 |     );
113 |
114 |     for (const chat of chats) {
115 |       pipeline.hgetall(chat);
116 |     }
117 |
118 |     const results = await pipeline.exec();
119 |
120 |     return results as Chat[];
121 |   } catch (error) {
122 |     return [];
123 |   }
124 | }
125 |
126 | export async function getChat(id: string) {
127 |   const {
128 |     data: { session },
129 |   } = await getSession();
130 |
131 |   const userId = session?.user?.id;
132 |
133 |   const chat = await RedisClient.hgetall<Chat>(`chat:${id}`);
134 |
135 |   if (!chat || (userId && chat.userId !== userId)) {
136 |     return null;
137 |   }
138 |
139 |   return chat;
140 | }
141 |
142 | export async function saveChat(chat: Chat) {
143 |   const pipeline = RedisClient.pipeline();
144 |   pipeline.hmset(`chat:${chat.id}`, chat);
145 |
146 |   const chatKey = `chat:${chat.teamId}:user:${chat.userId}`;
147 |
148 |   pipeline
149 |     .zadd(chatKey, {
150 |       score: Date.now(),
151 |       member: `chat:${chat.id}`,
152 |     })
153 |     // Expire in 30 days
154 |     .expire(chatKey, 2592000);
155 |
156 |   await pipeline.exec();
157 | }
```

apps/dashboard/src/actions/ai/types.ts
```
1 | import type { CoreMessage } from "ai";
2 | import type { ReactNode } from "react";
3 |
4 | export type Message = CoreMessage & {
5 |   id: string;
6 | };
7 |
8 | export interface Chat extends Record<string, unknown> {
9 |   id: string;
10 |   title: string;
11 |   createdAt: Date;
12 |   userId: string;
13 |   teamId: string;
14 |   messages: Message[];
15 | }
16 |
17 | export type SettingsResponse = {
18 |   enabled: boolean;
19 | };
20 |
21 | export type User = {
22 |   id: string;
23 |   team_id: string;
24 |   full_name: string;
25 |   avatar_url: string;
26 | };
27 |
28 | export type AIState = {
29 |   chatId: string;
30 |   user: User;
31 |   messages: Message[];
32 | };
33 |
34 | export type UIState = {
35 |   id: string;
36 |   display: React.ReactNode;
37 | }[];
38 |
39 | export interface ServerMessage {
40 |   role: "user" | "assistant" | "tool";
41 |   content: string;
42 | }
43 |
44 | export interface ClientMessage {
45 |   id: string;
46 |   role: "user" | "assistant";
47 |   display: ReactNode;
48 | }
49 |
50 | type ValueOrUpdater<T> = T | ((prevState: T) => T);
51 |
52 | export type MutableAIState = {
53 |   get: () => AIState;
54 |   update: (newState: ValueOrUpdater<AIState>) => void;
55 |   done: ((newState: AIState) => void) | (() => void);
56 | };
```

apps/dashboard/src/actions/customer/create-customer-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "../safe-action";
6 | import { createCustomerTagSchema } from "./schema";
7 |
8 | export const createCustomerTagAction = authActionClient
9 |   .schema(createCustomerTagSchema)
10 |   .metadata({
11 |     name: "create-customer-tag",
12 |     track: {
13 |       event: LogEvents.CreateCustomerTag.name,
14 |       channel: LogEvents.CreateCustomerTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { tagId, customerId }, ctx: { user, supabase } }) => {
19 |       const { data } = await supabase.from("customer_tags").insert({
20 |         tag_id: tagId,
21 |         customer_id: customerId,
22 |         team_id: user.team_id!,
23 |       });
24 |
25 |       revalidateTag(`customers_${user.team_id}`);
26 |
27 |       return data;
28 |     },
29 |   );
```

apps/dashboard/src/actions/customer/delete-customer-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "../safe-action";
6 | import { deleteCustomerTagSchema } from "./schema";
7 |
8 | export const deleteCustomerTagAction = authActionClient
9 |   .schema(deleteCustomerTagSchema)
10 |   .metadata({
11 |     name: "delete-customer-tag",
12 |     track: {
13 |       event: LogEvents.DeleteCustomerTag.name,
14 |       channel: LogEvents.DeleteCustomerTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { tagId, customerId }, ctx: { user, supabase } }) => {
19 |       const { data } = await supabase
20 |         .from("customer_tags")
21 |         .delete()
22 |         .eq("customer_id", customerId)
23 |         .eq("tag_id", tagId);
24 |
25 |       revalidateTag(`customers_${user.team_id}`);
26 |
27 |       return data;
28 |     },
29 |   );
```

apps/dashboard/src/actions/customer/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const deleteCustomerTagSchema = z.object({
4 |   tagId: z.string(),
5 |   customerId: z.string(),
6 | });
7 |
8 | export const createCustomerTagSchema = z.object({
9 |   tagId: z.string(),
10 |   customerId: z.string(),
11 | });
```

apps/dashboard/src/actions/inbox/filter.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { inboxFilterSchema } from "@/actions/schema";
5 | import { Cookies } from "@/utils/constants";
6 | import { addYears } from "date-fns";
7 | import { cookies } from "next/headers";
8 |
9 | export const changeInboxFilterAction = authActionClient
10 |   .schema(inboxFilterSchema)
11 |   .metadata({
12 |     name: "change-inbox-filter",
13 |   })
14 |   .action(({ parsedInput: value }) => {
15 |     cookies().set({
16 |       name: Cookies.InboxFilter,
17 |       value: value,
18 |       expires: addYears(new Date(), 1),
19 |     });
20 |
21 |     return Promise.resolve(value);
22 |   });
```

apps/dashboard/src/actions/inbox/order.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { inboxOrder } from "@/actions/schema";
5 | import { Cookies } from "@/utils/constants";
6 | import { addYears } from "date-fns";
7 | import { revalidatePath } from "next/cache";
8 | import { cookies } from "next/headers";
9 |
10 | export const inboxOrderAction = authActionClient
11 |   .schema(inboxOrder)
12 |   .metadata({
13 |     name: "inbox-order",
14 |   })
15 |   .action(({ parsedInput: value }) => {
16 |     cookies().set({
17 |       name: Cookies.InboxOrder,
18 |       value: value.toString(),
19 |       expires: addYears(new Date(), 1),
20 |     });
21 |
22 |     revalidatePath("/inbox");
23 |
24 |     return Promise.resolve(value);
25 |   });
```

apps/dashboard/src/actions/inbox/update.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { updateInboxSchema } from "@/actions/schema";
5 | import { updateInboxById } from "@midday/supabase/mutations";
6 | import { revalidatePath, revalidateTag } from "next/cache";
7 |
8 | export const updateInboxAction = authActionClient
9 |   .schema(updateInboxSchema)
10 |   .metadata({
11 |     name: "update-inbox",
12 |   })
13 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
14 |     const teamId = user.team_id;
15 |
16 |     await updateInboxById(supabase, {
17 |       ...params,
18 |       teamId,
19 |     });
20 |
21 |     revalidatePath("/inbox");
22 |     revalidateTag(`transactions_${teamId}`);
23 |
24 |     return null;
25 |   });
```

apps/dashboard/src/actions/institutions/create-gocardless-link.ts
```
1 | "use server";
2 |
3 | import { client } from "@midday/engine/client";
4 | import { LogEvents } from "@midday/events/events";
5 | import { redirect } from "next/navigation";
6 | import { authActionClient } from "../safe-action";
7 | import { createGoCardLessLinkSchema } from "../schema";
8 |
9 | export const createGoCardLessLinkAction = authActionClient
10 |   .schema(createGoCardLessLinkSchema)
11 |   .metadata({
12 |     name: "create-gocardless-link",
13 |   })
14 |   .action(
15 |     async ({
16 |       parsedInput: {
17 |         institutionId,
18 |         availableHistory,
19 |         redirectBase,
20 |         step = "account",
21 |       },
22 |       ctx: { analytics, user },
23 |     }) => {
24 |       await client.institutions[":id"].usage.$put({
25 |         param: {
26 |           id: institutionId,
27 |         },
28 |       });
29 |
30 |       const redirectTo = new URL(redirectBase);
31 |
32 |       redirectTo.searchParams.append("step", step);
33 |       redirectTo.searchParams.append("provider", "gocardless");
34 |
35 |       analytics.track({
36 |         event: LogEvents.GoCardLessLinkCreated.name,
37 |         institutionId,
38 |         availableHistory,
39 |         redirectBase,
40 |         step,
41 |       });
42 |
43 |       try {
44 |         const agreementResponse = await client.auth.gocardless.agreement.$post({
45 |           json: {
46 |             institutionId,
47 |             transactionTotalDays: availableHistory,
48 |           },
49 |         });
50 |
51 |         const { data: agreementData } = await agreementResponse.json();
52 |
53 |         const linkResponse = await client.auth.gocardless.link.$post({
54 |           json: {
55 |             agreement: agreementData.id,
56 |             institutionId,
57 |             redirect: redirectTo.toString(),
58 |           },
59 |         });
60 |
61 |         const { data: linkData } = await linkResponse.json();
62 |
63 |         return redirect(linkData.link);
64 |       } catch (error) {
65 |         // Ignore NEXT_REDIRECT error in analytics
66 |         if (error instanceof Error && error.message !== "NEXT_REDIRECT") {
67 |           analytics.track({
68 |             event: LogEvents.GoCardLessLinkFailed.name,
69 |             institutionId,
70 |             availableHistory,
71 |             redirectBase,
72 |           });
73 |
74 |           throw error;
75 |         }
76 |
77 |         throw error;
78 |       }
79 |     },
80 |   );
```

apps/dashboard/src/actions/institutions/create-plaid-link.ts
```
1 | "use server";
2 |
3 | import { client } from "@midday/engine/client";
4 | import { getSession } from "@midday/supabase/cached-queries";
5 |
6 | export const createPlaidLinkTokenAction = async (accessToken?: string) => {
7 |   const {
8 |     data: { session },
9 |   } = await getSession();
10 |
11 |   const plaidResponse = await client.auth.plaid.link.$post({
12 |     json: {
13 |       userId: session?.user?.id,
14 |       accessToken,
15 |     },
16 |   });
17 |
18 |   if (!plaidResponse.ok) {
19 |     throw new Error("Failed to create plaid link token");
20 |   }
21 |
22 |   const { data } = await plaidResponse.json();
23 |
24 |   return data.link_token;
25 | };
```

apps/dashboard/src/actions/institutions/get-accounts.ts
```
1 | "use server";
2 |
3 | import { client } from "@midday/engine/client";
4 |
5 | type GetAccountParams = {
6 |   id?: string;
7 |   accessToken?: string;
8 |   institutionId?: string; // Plaid
9 |   provider: "gocardless" | "teller" | "plaid";
10 | };
11 |
12 | export async function getAccounts({
13 |   id,
14 |   provider,
15 |   accessToken,
16 |   institutionId,
17 | }: GetAccountParams) {
18 |   const accountsResponse = await client.accounts.$get({
19 |     query: {
20 |       id,
21 |       provider,
22 |       accessToken,
23 |       institutionId,
24 |     },
25 |   });
26 |
27 |   if (!accountsResponse.ok) {
28 |     throw new Error("Failed to get accounts");
29 |   }
30 |
31 |   const { data } = await accountsResponse.json();
32 |
33 |   return {
34 |     data: data.sort((a, b) => b.balance.amount - a.balance.amount),
35 |   };
36 | }
```

apps/dashboard/src/actions/institutions/get-institutions.ts
```
1 | "use server";
2 |
3 | import { logger } from "@/utils/logger";
4 | import { client } from "@midday/engine/client";
5 |
6 | type GetAccountParams = {
7 |   countryCode: string;
8 |   query?: string;
9 | };
10 |
11 | export async function getInstitutions({
12 |   countryCode,
13 |   query,
14 | }: GetAccountParams) {
15 |   try {
16 |     const institutionsResponse = await client.institutions.$get({
17 |       query: {
18 |         countryCode,
19 |         q: query,
20 |       },
21 |     });
22 |
23 |     if (!institutionsResponse.ok) {
24 |       throw new Error("Failed to get institutions");
25 |     }
26 |
27 |     return institutionsResponse.json();
28 |   } catch (error) {
29 |     logger(error instanceof Error ? error.message : String(error));
30 |     return [];
31 |   }
32 | }
```

apps/dashboard/src/actions/institutions/reconnect-gocardless-link.tsx
```
1 | "use server";
2 |
3 | import { client } from "@midday/engine/client";
4 | import { nanoid } from "nanoid";
5 | import { redirect } from "next/navigation";
6 | import { z } from "zod";
7 | import { authActionClient } from "../safe-action";
8 |
9 | export const reconnectGoCardLessLinkAction = authActionClient
10 |   .schema(
11 |     z.object({
12 |       id: z.string(),
13 |       institutionId: z.string(),
14 |       availableHistory: z.number(),
15 |       isDesktop: z.boolean(),
16 |       redirectTo: z.string(),
17 |     }),
18 |   )
19 |   .metadata({
20 |     name: "create-gocardless-link",
21 |   })
22 |   .action(
23 |     async ({
24 |       parsedInput: {
25 |         id,
26 |         institutionId,
27 |         availableHistory,
28 |         redirectTo,
29 |         isDesktop,
30 |       },
31 |       ctx: { user },
32 |     }) => {
33 |       const reference = `${user.team_id}:${nanoid()}`;
34 |
35 |       const link = new URL(redirectTo);
36 |
37 |       link.searchParams.append("id", id);
38 |
39 |       if (isDesktop) {
40 |         link.searchParams.append("desktop", "true");
41 |       }
42 |
43 |       const agreementResponse = await client.auth.gocardless.agreement.$post({
44 |         json: {
45 |           institutionId,
46 |           transactionTotalDays: availableHistory,
47 |         },
48 |       });
49 |
50 |       const { data: agreementData } = await agreementResponse.json();
51 |
52 |       const linkResponse = await client.auth.gocardless.link.$post({
53 |         json: {
54 |           agreement: agreementData.id,
55 |           institutionId,
56 |           redirect: link.toString(),
57 |           // In the reconnect flow we need the reference based on the team
58 |           // so we can find the correct requestion id on success and update the current reference
59 |           reference,
60 |         },
61 |       });
62 |
63 |       const { data: linkData } = await linkResponse.json();
64 |
65 |       if (!linkResponse.ok) {
66 |         throw new Error("Failed to create link");
67 |       }
68 |
69 |       return redirect(linkData.link);
70 |     },
71 |   );
```

apps/dashboard/src/actions/institutions/update-institution-usage.ts
```
1 | "use server";
2 |
3 | import { client } from "@midday/engine/client";
4 | import { authActionClient } from "../safe-action";
5 | import { updateInstitutionUsageSchema } from "../schema";
6 |
7 | export const updateInstitutionUsageAction = authActionClient
8 |   .schema(updateInstitutionUsageSchema)
9 |   .metadata({
10 |     name: "update-institution-usage",
11 |   })
12 |   .action(async ({ parsedInput: { institutionId } }) => {
13 |     const usageResponse = await client.institutions[":id"].usage.$put({
14 |       param: {
15 |         id: institutionId,
16 |       },
17 |     });
18 |
19 |     if (!usageResponse.ok) {
20 |       throw new Error("Failed to update institution usage");
21 |     }
22 |
23 |     return usageResponse.json();
24 |   });
```

apps/dashboard/src/actions/invoice/create-invoice-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { tasks } from "@trigger.dev/sdk/v3";
5 | import { revalidateTag } from "next/cache";
6 | import { createInvoiceSchema } from "./schema";
7 |
8 | export const createInvoiceAction = authActionClient
9 |   .metadata({
10 |     name: "create-invoice",
11 |   })
12 |   .schema(createInvoiceSchema)
13 |   .action(
14 |     async ({ parsedInput: { id, deliveryType }, ctx: { supabase, user } }) => {
15 |       const teamId = user.team_id;
16 |
17 |       const { data: draft } = await supabase
18 |         .from("invoices")
19 |         .select("id, template")
20 |         .eq("id", id)
21 |         .single();
22 |
23 |       if (!draft) {
24 |         throw new Error("Draft not found");
25 |       }
26 |
27 |       // Update the invoice status to unpaid
28 |       const { data: invoice } = await supabase
29 |         .from("invoices")
30 |         .update({ status: "unpaid" })
31 |         .eq("id", id)
32 |         .select("*")
33 |         .single();
34 |
35 |       // Only send the email if the delivery type is create_and_send
36 |       if (deliveryType === "create_and_send") {
37 |         await tasks.trigger("send-invoice-email", {
38 |           invoiceId: invoice?.id,
39 |         });
40 |       }
41 |
42 |       await tasks.trigger("generate-invoice", {
43 |         invoiceId: invoice?.id,
44 |       });
45 |
46 |       revalidateTag(`invoice_summary_${teamId}`);
47 |       revalidateTag(`invoices_${teamId}`);
48 |       revalidateTag(`invoice_number_${teamId}`);
49 |
50 |       return invoice;
51 |     },
52 |   );
```

apps/dashboard/src/actions/invoice/delete-invoice-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { revalidateTag } from "next/cache";
5 | import { deleteInvoiceSchema } from "./schema";
6 |
7 | export const deleteInvoiceAction = authActionClient
8 |   .metadata({
9 |     name: "delete-invoice",
10 |   })
11 |   .schema(deleteInvoiceSchema)
12 |   .action(async ({ parsedInput: { id }, ctx: { user, supabase } }) => {
13 |     const teamId = user.team_id;
14 |
15 |     const { data } = await supabase
16 |       .from("invoices")
17 |       .delete()
18 |       .eq("id", id)
19 |       .select("*")
20 |       .single();
21 |
22 |     revalidateTag(`invoices_${teamId}`);
23 |     revalidateTag(`invoice_summary_${teamId}`);
24 |     revalidateTag(`invoice_number_${teamId}`);
25 |
26 |     return data;
27 |   });
```

apps/dashboard/src/actions/invoice/draft-invoice-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { parseInputValue } from "@/components/invoice/utils";
5 | import { generateToken } from "@midday/invoice/token";
6 | import { revalidateTag } from "next/cache";
7 | import { draftInvoiceSchema } from "./schema";
8 |
9 | export const draftInvoiceAction = authActionClient
10 |   .metadata({
11 |     name: "draft-invoice",
12 |   })
13 |   .schema(draftInvoiceSchema)
14 |   .action(
15 |     async ({
16 |       parsedInput: {
17 |         id,
18 |         template,
19 |         customer_details,
20 |         payment_details,
21 |         from_details,
22 |         note_details,
23 |         token: draftToken,
24 |         ...input
25 |       },
26 |       ctx: { user, supabase },
27 |     }) => {
28 |       const teamId = user.team_id;
29 |
30 |       // Only generate token if it's not provided, ie. when the invoice is created
31 |       const token = draftToken ?? (await generateToken(id));
32 |
33 |       const {
34 |         payment_details: _,
35 |         from_details: __,
36 |         ...restTemplate
37 |       } = template;
38 |
39 |       const { data } = await supabase
40 |         .from("invoices")
41 |         .upsert(
42 |           {
43 |             id,
44 |             team_id: teamId,
45 |             currency: template.currency?.toUpperCase(),
46 |             payment_details: parseInputValue(payment_details),
47 |             from_details: parseInputValue(from_details),
48 |             customer_details: parseInputValue(customer_details),
49 |             note_details: parseInputValue(note_details),
50 |             token,
51 |             user_id: user.id,
52 |             template: restTemplate,
53 |             ...input,
54 |           },
55 |           {
56 |             onConflict: "id",
57 |             merge: true,
58 |           },
59 |         )
60 |         .select("*")
61 |         .single();
62 |
63 |       revalidateTag(`invoice_summary_${teamId}`);
64 |       revalidateTag(`invoices_${teamId}`);
65 |       revalidateTag(`invoice_number_${teamId}`);
66 |
67 |       return data;
68 |     },
69 |   );
```

apps/dashboard/src/actions/invoice/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const deleteInvoiceSchema = z.object({
4 |   id: z.string(),
5 | });
6 |
7 | export const updateInvoiceSchema = z.object({
8 |   id: z.string(),
9 |   status: z.enum(["paid", "canceled", "unpaid"]).optional(),
10 |   paid_at: z.string().nullable().optional(),
11 |   internal_note: z.string().nullable().optional(),
12 | });
13 |
14 | export const updateInvoiceTemplateSchema = z.object({
15 |   customer_label: z.string().optional(),
16 |   title: z.string().optional(),
17 |   from_label: z.string().optional(),
18 |   invoice_no_label: z.string().optional(),
19 |   issue_date_label: z.string().optional(),
20 |   due_date_label: z.string().optional(),
21 |   description_label: z.string().optional(),
22 |   price_label: z.string().optional(),
23 |   quantity_label: z.string().optional(),
24 |   total_label: z.string().optional(),
25 |   total_summary_label: z.string().optional(),
26 |   vat_label: z.string().optional(),
27 |   subtotal_label: z.string().optional(),
28 |   tax_label: z.string().optional(),
29 |   discount_label: z.string().optional(),
30 |   timezone: z.string().optional(),
31 |   payment_label: z.string().optional(),
32 |   note_label: z.string().optional(),
33 |   logo_url: z.string().optional().nullable(),
34 |   currency: z.string().optional(),
35 |   payment_details: z.string().optional().nullable(),
36 |   from_details: z.string().optional().nullable(),
37 |   date_format: z.string().optional(),
38 |   include_vat: z.boolean().optional().optional(),
39 |   include_tax: z.boolean().optional().optional(),
40 |   include_discount: z.boolean().optional(),
41 |   include_decimals: z.boolean().optional(),
42 |   include_units: z.boolean().optional(),
43 |   include_qr: z.boolean().optional(),
44 |   tax_rate: z.number().min(0).max(100).optional(),
45 |   vat_rate: z.number().min(0).max(100).optional(),
46 |   size: z.enum(["a4", "letter"]).optional(),
47 |   delivery_type: z.enum(["create", "create_and_send"]).optional(),
48 |   locale: z.string().optional(),
49 | });
50 |
51 | export const draftLineItemSchema = z.object({
52 |   name: z.string().optional(),
53 |   quantity: z.number().min(0, "Quantity must be at least 0").optional(),
54 |   unit: z.string().optional().nullable(),
55 |   price: z.number().safe().optional(),
56 |   vat: z.number().min(0, "VAT must be at least 0").optional(),
57 |   tax: z.number().min(0, "Tax must be at least 0").optional(),
58 | });
59 |
60 | export const draftInvoiceSchema = z.object({
61 |   id: z.string().uuid(),
62 |   template: updateInvoiceTemplateSchema,
63 |   from_details: z.string().nullable().optional(),
64 |   customer_details: z.string().nullable().optional(),
65 |   customer_id: z.string().uuid().nullable().optional(),
66 |   customer_name: z.string().nullable().optional(),
67 |   payment_details: z.string().nullable().optional(),
68 |   note_details: z.string().nullable().optional(),
69 |   due_date: z.coerce.date(),
70 |   issue_date: z.coerce.date(),
71 |   invoice_number: z.string(),
72 |   logo_url: z.string().optional().nullable(),
73 |   vat: z.number().nullable().optional(),
74 |   tax: z.number().nullable().optional(),
75 |   discount: z.number().nullable().optional(),
76 |   subtotal: z.number().nullable().optional(),
77 |   top_block: z.any().nullable().optional(),
78 |   bottom_block: z.any().nullable().optional(),
79 |   amount: z.number().nullable().optional(),
80 |   line_items: z.array(draftLineItemSchema).optional(),
81 |   token: z.string().optional(),
82 | });
83 |
84 | export const lineItemSchema = z.object({
85 |   name: z.string().min(1, "Name is required"),
86 |   quantity: z.number().min(0, "Quantity must be at least 0"),
87 |   unit: z.string().optional(),
88 |   price: z.number(),
89 |   vat: z.number().min(0, "VAT must be at least 0").optional(),
90 |   tax: z.number().min(0, "Tax must be at least 0").optional(),
91 | });
92 |
93 | export const invoiceTemplateSchema = z.object({
94 |   title: z.string().optional(),
95 |   customer_label: z.string(),
96 |   from_label: z.string(),
97 |   invoice_no_label: z.string(),
98 |   issue_date_label: z.string(),
99 |   due_date_label: z.string(),
100 |   description_label: z.string(),
101 |   price_label: z.string(),
102 |   quantity_label: z.string(),
103 |   total_label: z.string(),
104 |   total_summary_label: z.string().optional(),
105 |   vat_label: z.string().optional(),
106 |   subtotal_label: z.string().optional(),
107 |   tax_label: z.string().optional(),
108 |   discount_label: z.string().optional(),
109 |   payment_label: z.string(),
110 |   note_label: z.string(),
111 |   logo_url: z.string().optional().nullable(),
112 |   currency: z.string(),
113 |   payment_details: z.any().nullable().optional(),
114 |   from_details: z.any().nullable().optional(),
115 |   size: z.enum(["a4", "letter"]),
116 |   include_vat: z.boolean().optional(),
117 |   include_tax: z.boolean().optional(),
118 |   include_discount: z.boolean().optional(),
[TRUNCATED]
```

apps/dashboard/src/actions/invoice/send-reminder-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { resend } from "@/utils/resend";
5 | import { UTCDate } from "@date-fns/utc";
6 | import { InvoiceReminderEmail } from "@midday/email/emails/invoice-reminder";
7 | import { getAppUrl } from "@midday/utils/envs";
8 | import { render } from "@react-email/render";
9 | import { nanoid } from "nanoid";
10 | import { z } from "zod";
11 |
12 | export const sendReminderAction = authActionClient
13 |   .metadata({
14 |     name: "send-reminder",
15 |   })
16 |   .schema(z.object({ id: z.string().uuid() }))
17 |   .action(async ({ parsedInput: { id }, ctx: { supabase, user } }) => {
18 |     const { email, name } = user.team;
19 |
20 |     const { data: invoice } = await supabase
21 |       .from("invoices")
22 |       .select("id, token, invoice_number, customer:customer_id(name, email)")
23 |       .eq("id", id)
24 |       .single();
25 |
26 |     if (!invoice) {
27 |       throw new Error("Invoice not found");
28 |     }
29 |
30 |     await resend.emails.send({
31 |       from: "Midday <middaybot@midday.ai>",
32 |       to: invoice.customer.email,
33 |       reply_to: email,
34 |       subject: `Reminder: Payment for ${invoice.invoice_number}`,
35 |       headers: {
36 |         "X-Entity-Ref-ID": nanoid(),
37 |       },
38 |       html: await render(
39 |         InvoiceReminderEmail({
40 |           companyName: invoice.customer.name,
41 |           teamName: name,
42 |           invoiceNumber: invoice.invoice_number,
43 |           link: `${getAppUrl()}/i/${invoice.token}`,
44 |         }),
45 |       ),
46 |     });
47 |
48 |     const { data } = await supabase
49 |       .from("invoices")
50 |       .update({ reminder_sent_at: new UTCDate().toISOString() })
51 |       .eq("id", id)
52 |       .select("*")
53 |       .single();
54 |
55 |     return data;
56 |   });
```

apps/dashboard/src/actions/invoice/update-invoice-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { revalidateTag } from "next/cache";
5 | import { updateInvoiceSchema } from "./schema";
6 |
7 | export const updateInvoiceAction = authActionClient
8 |   .metadata({
9 |     name: "update-invoice",
10 |   })
11 |   .schema(updateInvoiceSchema)
12 |   .action(
13 |     async ({ parsedInput: { id, ...input }, ctx: { user, supabase } }) => {
14 |       const teamId = user.team_id;
15 |
16 |       const { data } = await supabase
17 |         .from("invoices")
18 |         .update(input)
19 |         .eq("id", id)
20 |         .select("*")
21 |         .single();
22 |
23 |       revalidateTag(`invoice_summary_${teamId}`);
24 |       revalidateTag(`invoices_${teamId}`);
25 |       revalidateTag(`invoice_number_${teamId}`);
26 |
27 |       return data;
28 |     },
29 |   );
```

apps/dashboard/src/actions/invoice/update-invoice-template-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { parseInputValue } from "@/components/invoice/utils";
5 | import { revalidateTag } from "next/cache";
6 | import { updateInvoiceTemplateSchema } from "./schema";
7 |
8 | export const updateInvoiceTemplateAction = authActionClient
9 |   .metadata({
10 |     name: "update-invoice-template",
11 |   })
12 |   .schema(updateInvoiceTemplateSchema)
13 |   .action(
14 |     async ({
15 |       parsedInput: { from_details, payment_details, ...rest },
16 |       ctx: { user, supabase },
17 |     }) => {
18 |       const teamId = user.team_id;
19 |
20 |       const { data } = await supabase
21 |         .from("invoice_templates")
22 |         .upsert(
23 |           {
24 |             team_id: teamId,
25 |             from_details: parseInputValue(from_details),
26 |             payment_details: parseInputValue(payment_details),
27 |             ...rest,
28 |           },
29 |           { onConflict: "team_id" },
30 |         )
31 |         .eq("team_id", teamId)
32 |         .select()
33 |         .single();
34 |
35 |       revalidateTag(`invoice_templates_${teamId}`);
36 |
37 |       return data;
38 |     },
39 |   );
```

apps/dashboard/src/actions/project/create-project-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { createProjectSchema } from "@/actions/schema";
5 | import { Cookies } from "@/utils/constants";
6 | import { LogEvents } from "@midday/events/events";
7 | import { createProject } from "@midday/supabase/mutations";
8 | import { addYears } from "date-fns";
9 | import { revalidateTag } from "next/cache";
10 | import { cookies } from "next/headers";
11 |
12 | export const createProjectAction = authActionClient
13 |   .schema(createProjectSchema)
14 |   .metadata({
15 |     name: "create-project",
16 |     track: {
17 |       event: LogEvents.ProjectCreated.name,
18 |       channel: LogEvents.ProjectCreated.channel,
19 |     },
20 |   })
21 |   .action(
22 |     async ({ parsedInput: { tags, ...params }, ctx: { user, supabase } }) => {
23 |       const { data } = await createProject(supabase, {
24 |         ...params,
25 |         team_id: user.team_id!,
26 |       });
27 |
28 |       if (!data) {
29 |         throw new Error("Failed to create project");
30 |       }
31 |
32 |       if (tags?.length) {
33 |         await supabase.from("tracker_project_tags").insert(
34 |           tags.map((tag) => ({
35 |             tag_id: tag.id,
36 |             tracker_project_id: data?.id,
37 |             team_id: user.team_id!,
38 |           })),
39 |         );
40 |       }
41 |
42 |       cookies().set({
43 |         name: Cookies.LastProject,
44 |         value: data.id,
45 |         expires: addYears(new Date(), 1),
46 |       });
47 |
48 |       revalidateTag(`tracker_projects_${user.team_id}`);
49 |
50 |       return data;
51 |     },
52 |   );
```

apps/dashboard/src/actions/project/create-project-report.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { createProjectReportSchema } from "@/actions/schema";
5 | import { dub } from "@/utils/dub";
6 | import { LogEvents } from "@midday/events/events";
7 |
8 | export const createProjectReport = authActionClient
9 |   .schema(createProjectReportSchema)
10 |   .metadata({
11 |     name: "create-project-report",
12 |     track: {
13 |       event: LogEvents.ProjectReport.name,
14 |       channel: LogEvents.ProjectReport.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
18 |     const { data } = await supabase
19 |       .from("tracker_reports")
20 |       .insert({
21 |         team_id: user.team_id,
22 |         project_id: params.projectId,
23 |         created_by: user.id,
24 |       })
25 |       .select("*")
26 |       .single();
27 |
28 |     if (!data) {
29 |       return;
30 |     }
31 |
32 |     const link = await dub.links.create({
33 |       url: `${params.baseUrl}/report/project/${data?.id}`,
34 |     });
35 |
36 |     const { data: linkData } = await supabase
37 |       .from("tracker_reports")
38 |       .update({
39 |         link_id: link.id,
40 |         short_link: link.shortLink,
41 |       })
42 |       .eq("id", data.id)
43 |       .select("*")
44 |       .single();
45 |
46 |     return linkData;
47 |   });
```

apps/dashboard/src/actions/project/create-project-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "../safe-action";
6 | import { createProjectTagSchema } from "../schema";
7 |
8 | export const createProjectTagAction = authActionClient
9 |   .schema(createProjectTagSchema)
10 |   .metadata({
11 |     name: "create-project-tag",
12 |     track: {
13 |       event: LogEvents.CreateProjectTag.name,
14 |       channel: LogEvents.CreateProjectTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { tagId, projectId }, ctx: { user, supabase } }) => {
19 |       const { data } = await supabase.from("tracker_project_tags").insert({
20 |         tag_id: tagId,
21 |         tracker_project_id: projectId,
22 |         team_id: user.team_id!,
23 |       });
24 |
25 |       revalidateTag(`tracker_projects_${user.team_id}`);
26 |
27 |       return data;
28 |     },
29 |   );
```

apps/dashboard/src/actions/project/delete-entries-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { deleteEntriesSchema } from "@/actions/schema";
5 | import { LogEvents } from "@midday/events/events";
6 | import { revalidateTag } from "next/cache";
7 |
8 | export const deleteEntriesAction = authActionClient
9 |   .schema(deleteEntriesSchema)
10 |   .metadata({
11 |     name: "delete-entries",
12 |     track: {
13 |       event: LogEvents.TrackerDeleteEntry.name,
14 |       channel: LogEvents.TrackerDeleteEntry.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
18 |     await supabase.from("tracker_entries").delete().eq("id", params.id);
19 |
20 |     revalidateTag(`tracker_projects_${user.team_id}`);
21 |     revalidateTag(`tracker_entries_${user.team_id}`);
22 |   });
```

apps/dashboard/src/actions/project/delete-project-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { deleteProjectSchema } from "@/actions/schema";
5 | import { Cookies } from "@/utils/constants";
6 | import { LogEvents } from "@midday/events/events";
7 | import { revalidateTag } from "next/cache";
8 | import { cookies } from "next/headers";
9 |
10 | export const deleteProjectAction = authActionClient
11 |   .schema(deleteProjectSchema)
12 |   .metadata({
13 |     name: "delete-project",
14 |     track: {
15 |       event: LogEvents.ProjectDeleted.name,
16 |       channel: LogEvents.ProjectDeleted.channel,
17 |     },
18 |   })
19 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
20 |     await supabase.from("tracker_projects").delete().eq("id", params.id);
21 |
22 |     cookies().delete(Cookies.LastProject);
23 |
24 |     revalidateTag(`tracker_projects_${user.team_id}`);
25 |   });
```

apps/dashboard/src/actions/project/delete-project-tag-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { revalidateTag } from "next/cache";
5 | import { authActionClient } from "../safe-action";
6 | import { deleteProjectTagSchema } from "../schema";
7 |
8 | export const deleteProjectTagAction = authActionClient
9 |   .schema(deleteProjectTagSchema)
10 |   .metadata({
11 |     name: "delete-project-tag",
12 |     track: {
13 |       event: LogEvents.DeleteProjectTag.name,
14 |       channel: LogEvents.DeleteProjectTag.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { tagId, projectId }, ctx: { user, supabase } }) => {
19 |       const { data } = await supabase
20 |         .from("tracker_project_tags")
21 |         .delete()
22 |         .eq("tracker_project_id", projectId)
23 |         .eq("tag_id", tagId);
24 |
25 |       revalidateTag(`tracker_projects_${user.team_id}`);
26 |
27 |       return data;
28 |     },
29 |   );
```

apps/dashboard/src/actions/project/update-entries-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { updateEntriesSchema } from "@/actions/schema";
5 | import { Cookies } from "@/utils/constants";
6 | import { LogEvents } from "@midday/events/events";
7 | import { addYears } from "date-fns";
8 | import { revalidateTag } from "next/cache";
9 | import { cookies } from "next/headers";
10 |
11 | export const updateEntriesAction = authActionClient
12 |   .schema(updateEntriesSchema)
13 |   .metadata({
14 |     name: "update-entries",
15 |     track: {
16 |       event: LogEvents.TrackerCreateEntry.name,
17 |       channel: LogEvents.TrackerCreateEntry.channel,
18 |     },
19 |   })
20 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
21 |     const { action, ...payload } = params;
22 |
23 |     if (action === "delete") {
24 |       await supabase.from("tracker_entries").delete().eq("id", params.id);
25 |       revalidateTag(`tracker_projects_${user.team_id}`);
26 |
27 |       return Promise.resolve(params);
28 |     }
29 |
30 |     const { data: projectData } = await supabase
31 |       .from("tracker_projects")
32 |       .select("id, rate, currency")
33 |       .eq("id", params.project_id)
34 |       .single();
35 |
36 |     const { error } = await supabase.from("tracker_entries").upsert({
37 |       ...payload,
38 |       team_id: user.team_id,
39 |       rate: projectData?.rate,
40 |       currency: projectData?.currency,
41 |     });
42 |
43 |     if (error) {
44 |       throw Error("Something went wrong.");
45 |     }
46 |
47 |     if (payload.project_id) {
48 |       cookies().set({
49 |         name: Cookies.LastProject,
50 |         value: payload.project_id,
51 |         expires: addYears(new Date(), 1),
52 |       });
53 |     }
54 |
55 |     revalidateTag(`tracker_projects_${user.team_id}`);
56 |     revalidateTag(`tracker_entries_${user.team_id}`);
57 |
58 |     return Promise.resolve(params);
59 |   });
```

apps/dashboard/src/actions/project/update-project-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { updateProjectSchema } from "@/actions/schema";
5 | import { LogEvents } from "@midday/events/events";
6 | import { revalidateTag } from "next/cache";
7 |
8 | export const updateProjectAction = authActionClient
9 |   .schema(updateProjectSchema)
10 |   .metadata({
11 |     name: "update-project",
12 |     track: {
13 |       event: LogEvents.ProjectUpdated.name,
14 |       channel: LogEvents.ProjectUpdated.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
18 |     // We store tags in the form state, it's deleted from the action
19 |     const { id, tags, ...data } = params;
20 |
21 |     await supabase.from("tracker_projects").update(data).eq("id", id);
22 |
23 |     revalidateTag(`tracker_projects_${user.team_id}`);
24 |   });
```

apps/dashboard/src/actions/report/create-report-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { createReportSchema } from "@/actions/schema";
5 | import { dub } from "@/utils/dub";
6 | import { LogEvents } from "@midday/events/events";
7 |
8 | export const createReportAction = authActionClient
9 |   .schema(createReportSchema)
10 |   .metadata({
11 |     name: "create-report",
12 |     track: {
13 |       event: LogEvents.OverviewReport.name,
14 |       channel: LogEvents.OverviewReport.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: params, ctx: { user, supabase } }) => {
18 |     const { data } = await supabase
19 |       .from("reports")
20 |       .insert({
21 |         team_id: user.team_id,
22 |         from: params.from,
23 |         to: params.to,
24 |         type: params.type,
25 |         expire_at: params.expiresAt,
26 |         created_by: user.id,
27 |       })
28 |       .select("*")
29 |       .single();
30 |
31 |     if (!data) {
32 |       return null;
33 |     }
34 |
35 |     const link = await dub.links.create({
36 |       url: `${params.baseUrl}/report/${data.id}`,
37 |       expiresAt: params.expiresAt,
38 |     });
39 |
40 |     const { data: linkData } = await supabase
41 |       .from("reports")
42 |       .update({
43 |         link_id: link.id,
44 |         short_link: link.shortLink,
45 |       })
46 |       .eq("id", data.id)
47 |       .select("*")
48 |       .single();
49 |
50 |     return linkData;
51 |   });
```

apps/dashboard/src/actions/transactions/get-transactions-from-layout.ts
```
1 | "use server";
2 |
3 | import { LayoutProcessor } from "@midday/documents";
4 | import { z } from "zod";
5 | import { authActionClient } from "../safe-action";
6 |
7 | export const getTransactionsFromLayout = authActionClient
8 |   .schema(
9 |     z.object({
10 |       filePath: z.array(z.string()),
11 |     }),
12 |   )
13 |   .metadata({
14 |     name: "get-transactions-from-layout",
15 |   })
16 |   .action(async ({ parsedInput: { filePath }, ctx: { supabase } }) => {
17 |     const processor = new LayoutProcessor();
18 |
19 |     const { data } = await supabase.storage
20 |       .from("vault")
21 |       .download(filePath.join("/"));
22 |
23 |     const buffer = await data?.arrayBuffer();
24 |
25 |     if (!buffer) {
26 |       throw Error("No file data");
27 |     }
28 |
29 |     const transactions = await processor.getDocument({
30 |       content: Buffer.from(buffer).toString("base64"),
31 |     });
32 |
33 |     const [headerRow, ...dataRows] = transactions ?? [];
34 |
35 |     // Get the columns from the header row
36 |     const columns = headerRow?.cells.map((cell, index) => {
37 |       const content = cell.content;
38 |       return headerRow.cells.indexOf(cell) === index
39 |         ? content
40 |         : `${content}_${index}`;
41 |     });
42 |
43 |     const results = dataRows.map((row) =>
44 |       Object.fromEntries(
45 |         row.cells.map((cell, index) => [
46 |           columns?.[index] ?? `${cell.content}_${index}`,
47 |           cell.content,
48 |         ]),
49 |       ),
50 |     );
51 |
52 |     return {
53 |       columns,
54 |       results,
55 |     };
56 |   });
```

apps/dashboard/src/actions/transactions/import-transactions.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { formatAmountValue } from "@midday/import";
5 | import { importTransactions } from "jobs/tasks/transactions/import";
6 | import { z } from "zod";
7 | import { authActionClient } from "../safe-action";
8 |
9 | export const importTransactionsAction = authActionClient
10 |   .schema(
11 |     z.object({
12 |       filePath: z.array(z.string()).optional(),
13 |       bankAccountId: z.string(),
14 |       currency: z.string(),
15 |       currentBalance: z.string().optional(),
16 |       inverted: z.boolean(),
17 |       table: z.array(z.record(z.string(), z.string())).optional(),
18 |       importType: z.enum(["csv", "image"]),
19 |       mappings: z.object({
20 |         amount: z.string(),
21 |         date: z.string(),
22 |         description: z.string(),
23 |         balance: z.string().optional(),
24 |       }),
25 |     }),
26 |   )
27 |   .metadata({
28 |     name: "import-transactions",
29 |     track: {
30 |       event: LogEvents.ImportTransactions.name,
31 |       channel: LogEvents.ImportTransactions.channel,
32 |     },
33 |   })
34 |   .action(
35 |     async ({
36 |       parsedInput: {
37 |         filePath,
38 |         bankAccountId,
39 |         currency,
40 |         mappings,
41 |         currentBalance,
42 |         inverted,
43 |         table,
44 |         importType,
45 |       },
46 |       ctx: { user, supabase },
47 |     }) => {
48 |       // Update currency for account
49 |       const balance = currentBalance
50 |         ? formatAmountValue({ amount: currentBalance })
51 |         : null;
52 |
53 |       await supabase
54 |         .from("bank_accounts")
55 |         .update({ currency, balance })
56 |         .eq("id", bankAccountId);
57 |
58 |       const event = await importTransactions.trigger({
59 |         filePath,
60 |         bankAccountId,
61 |         currency,
62 |         mappings,
63 |         teamId: user.team_id!,
64 |         inverted,
65 |         importType,
66 |       });
67 |
68 |       return event;
69 |     },
70 |   );
```

apps/dashboard/src/actions/transactions/manual-sync-transactions-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { manualSyncTransactionsSchema } from "@/actions/schema";
5 | import { LogEvents } from "@midday/events/events";
6 | import { syncConnection } from "jobs/tasks/bank/sync/connection";
7 |
8 | export const manualSyncTransactionsAction = authActionClient
9 |   .schema(manualSyncTransactionsSchema)
10 |   .metadata({
11 |     name: "manual-sync-transactions",
12 |     track: {
13 |       event: LogEvents.TransactionsManualSync.name,
14 |       channel: LogEvents.TransactionsManualSync.channel,
15 |     },
16 |   })
17 |   .action(async ({ parsedInput: { connectionId } }) => {
18 |     const event = await syncConnection.trigger({
19 |       connectionId,
20 |       manualSync: true,
21 |     });
22 |
23 |     return event;
24 |   });
```

apps/dashboard/src/actions/transactions/reconnect-connection-action.ts
```
1 | "use server";
2 |
3 | import { authActionClient } from "@/actions/safe-action";
4 | import { reconnectConnectionSchema } from "@/actions/schema";
5 | import { LogEvents } from "@midday/events/events";
6 | import { reconnectConnection } from "jobs/tasks/reconnect/connection";
7 |
8 | export const reconnectConnectionAction = authActionClient
9 |   .schema(reconnectConnectionSchema)
10 |   .metadata({
11 |     name: "reconnect-connection",
12 |     track: {
13 |       event: LogEvents.ReconnectConnection.name,
14 |       channel: LogEvents.ReconnectConnection.channel,
15 |     },
16 |   })
17 |   .action(
18 |     async ({ parsedInput: { connectionId, provider }, ctx: { user } }) => {
19 |       const event = await reconnectConnection.trigger({
20 |         teamId: user.team_id!,
21 |         connectionId,
22 |         provider,
23 |       });
24 |
25 |       return event;
26 |     },
27 |   );
```

apps/dashboard/src/actions/transactions/update-currency-action.ts
```
1 | "use server";
2 |
3 | import { LogEvents } from "@midday/events/events";
4 | import { updateTeam } from "@midday/supabase/mutations";
5 | import { updateBaseCurrency } from "jobs/tasks/transactions/update-base-currency";
6 | import { revalidatePath, revalidateTag } from "next/cache";
7 | import { z } from "zod";
8 | import { authActionClient } from "../safe-action";
9 |
10 | export const updateCurrencyAction = authActionClient
11 |   .schema(
12 |     z.object({
13 |       baseCurrency: z.string(),
14 |     }),
15 |   )
16 |   .metadata({
17 |     name: "update-currency",
18 |     track: {
19 |       event: LogEvents.UpdateCurrency.name,
20 |       channel: LogEvents.UpdateCurrency.channel,
21 |     },
22 |   })
23 |   .action(
24 |     async ({ parsedInput: { baseCurrency }, ctx: { user, supabase } }) => {
25 |       if (!user.team_id) {
26 |         throw new Error("No team id");
27 |       }
28 |
29 |       await updateTeam(supabase, {
30 |         id: user.team_id,
31 |         base_currency: baseCurrency,
32 |       });
33 |
34 |       revalidateTag(`team_settings_${user.team_id}`);
35 |       revalidatePath("/settings/accounts");
36 |
37 |       const event = await updateBaseCurrency.trigger({
38 |         teamId: user.team_id,
39 |         baseCurrency,
40 |       });
41 |
42 |       return event;
43 |     },
44 |   );
```

apps/dashboard/src/app/[locale]/layout.tsx
```
1 | import "@/styles/globals.css";
2 | import { cn } from "@midday/ui/cn";
3 | import "@midday/ui/globals.css";
4 | import { Provider as Analytics } from "@midday/events/client";
5 | import { Toaster } from "@midday/ui/toaster";
6 | import { GeistMono } from "geist/font/mono";
7 | import { GeistSans } from "geist/font/sans";
8 | import type { Metadata } from "next";
9 | import type { ReactElement } from "react";
10 | import { Providers } from "./providers";
11 |
12 | export const metadata: Metadata = {
13 |   metadataBase: new URL("https://app.midday.ai"),
14 |   title: "Midday | Run your business smarter",
15 |   description:
16 |     "Automate financial tasks, stay organized, and make informed decisions effortlessly.",
17 |   twitter: {
18 |     title: "Midday | Run your business smarter",
19 |     description:
20 |       "Automate financial tasks, stay organized, and make informed decisions effortlessly.",
21 |     images: [
22 |       {
23 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
24 |         width: 800,
25 |         height: 600,
26 |       },
27 |       {
28 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
29 |         width: 1800,
30 |         height: 1600,
31 |       },
32 |     ],
33 |   },
34 |   openGraph: {
35 |     title: "Midday | Run your business smarter",
36 |     description:
37 |       "Automate financial tasks, stay organized, and make informed decisions effortlessly.",
38 |     url: "https://app.midday.ai",
39 |     siteName: "Midday",
40 |     images: [
41 |       {
42 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
43 |         width: 800,
44 |         height: 600,
45 |       },
46 |       {
47 |         url: "https://cdn.midday.ai/opengraph-image.jpg",
48 |         width: 1800,
49 |         height: 1600,
50 |       },
51 |     ],
52 |     locale: "en_US",
53 |     type: "website",
54 |   },
55 | };
56 |
57 | export const viewport = {
58 |   width: "device-width",
59 |   initialScale: 1,
60 |   maximumScale: 1,
61 |   userScalable: false,
62 |   themeColor: [
63 |     { media: "(prefers-color-scheme: light)" },
64 |     { media: "(prefers-color-scheme: dark)" },
65 |   ],
66 | };
67 |
68 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
69 | export const maxDuration = 60;
70 |
71 | export default function Layout({
72 |   children,
73 |   params: { locale },
74 | }: {
75 |   children: ReactElement;
76 |   params: { locale: string };
77 | }) {
78 |   return (
79 |     <html lang={locale} suppressHydrationWarning>
80 |       <body
81 |         className={cn(
82 |           `${GeistSans.variable} ${GeistMono.variable}`,
83 |           "whitespace-pre-line overscroll-none antialiased",
84 |         )}
85 |       >
86 |         <Providers locale={locale}>{children}</Providers>
87 |         <Toaster />
88 |         <Analytics />
89 |       </body>
90 |     </html>
91 |   );
92 | }
```

apps/dashboard/src/app/[locale]/not-found.tsx
```
1 | import Image from "next/image";
2 | import Link from "next/link";
3 | import appIcon from "public/appicon.png";
4 |
5 | export default function NotFound() {
6 |   return (
7 |     <div className="h-screen flex flex-col items-center justify-center text-center text-sm text-[#606060]">
8 |       <Image
9 |         src={appIcon}
10 |         width={80}
11 |         height={80}
12 |         alt="Midday"
13 |         quality={100}
14 |         className="mb-10"
15 |       />
16 |       <h2 className="text-xl font-semibold mb-2">Not Found</h2>
17 |       <p className="mb-4">Could not find requested resource</p>
18 |       <Link href="/" className="underline">
19 |         Return Home
20 |       </Link>
21 |     </div>
22 |   );
23 | }
```

apps/dashboard/src/app/[locale]/providers.tsx
```
1 | "use client";
2 |
3 | import { ThemeProvider } from "@/components/theme-provider";
4 | import { I18nProviderClient } from "@/locales/client";
5 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
6 | import type { ReactNode } from "react";
7 |
8 | // We need to import it here because this is the first
9 | // client component
10 | if (isDesktopApp()) {
11 |   require("@/desktop/main");
12 | }
13 |
14 | type ProviderProps = {
15 |   locale: string;
16 |   children: ReactNode;
17 | };
18 |
19 | export function Providers({ locale, children }: ProviderProps) {
20 |   return (
21 |     <I18nProviderClient locale={locale}>
22 |       <ThemeProvider
23 |         attribute="class"
24 |         defaultTheme="system"
25 |         enableSystem
26 |         disableTransitionOnChange
27 |       >
28 |         {children}
29 |       </ThemeProvider>
30 |     </I18nProviderClient>
31 |   );
32 | }
```

apps/dashboard/src/components/assistant/assistant-modal.tsx
```
1 | "use client";
2 |
3 | import { useAssistantStore } from "@/store/assistant";
4 | import { Dialog, DialogContent } from "@midday/ui/dialog";
5 | import { useHotkeys } from "react-hotkeys-hook";
6 | import { Assistant } from ".";
7 |
8 | export function AssistantModal() {
9 |   const { isOpen, setOpen } = useAssistantStore();
10 |
11 |   useHotkeys("meta+k", () => setOpen(), {
12 |     enableOnFormTags: true,
13 |   });
14 |
15 |   return (
16 |     <Dialog open={isOpen} onOpenChange={setOpen}>
17 |       <DialogContent
18 |         className="overflow-hidden p-0 max-w-full w-full h-full md:max-w-[740px] md:h-[480px] m-0 select-text"
19 |         hideClose
20 |       >
21 |         <Assistant />
22 |       </DialogContent>
23 |     </Dialog>
24 |   );
25 | }
```

apps/dashboard/src/components/assistant/button-desktop.tsx
```
1 | "use client";
2 |
3 | import { useAssistantStore } from "@/store/assistant";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 |
7 | export function DesktopAssistantButton() {
8 |   const { setOpen } = useAssistantStore();
9 |
10 |   return (
11 |     <Button
12 |       variant="outline"
13 |       size="icon"
14 |       className="rounded-full w-8 h-8 flex items-center invisible todesktop:visible"
15 |       onClick={() => setOpen()}
16 |     >
17 |       <Icons.Search size={18} />
18 |     </Button>
19 |   );
20 | }
```

apps/dashboard/src/components/assistant/button.tsx
```
1 | "use client";
2 |
3 | import { useAssistantStore } from "@/store/assistant";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function AssistantButton() {
7 |   const { setOpen } = useAssistantStore();
8 |
9 |   return (
10 |     <Button
11 |       variant="outline"
12 |       className="relative min-w-[250px] w-full justify-start text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64 border-0 p-0 hover:bg-transparent font-normal no-drag"
13 |       onClick={() => setOpen()}
14 |     >
15 |       <span className="ml-4 md:ml-0">Ask Midday a question...</span>
16 |       <kbd className="pointer-events-none absolute right-1.5 top-1.5 hidden h-5 select-none items-center gap-1 border bg-accent px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex">
17 |         <span className="text-xs">⌘</span>K
18 |       </kbd>
19 |     </Button>
20 |   );
21 | }
```

apps/dashboard/src/components/assistant/feedback.tsx
```
1 | import { sendFeebackAction } from "@/actions/send-feedback-action";
2 | import { Button } from "@midday/ui/button";
3 | import { Icons } from "@midday/ui/icons";
4 | import { Textarea } from "@midday/ui/textarea";
5 | import { Loader2 } from "lucide-react";
6 | import { useAction } from "next-safe-action/hooks";
7 | import { useState } from "react";
8 |
9 | type Props = {
10 |   onClose: () => void;
11 | };
12 |
13 | export function AssistantFeedback({ onClose }: Props) {
14 |   const [value, setValue] = useState("");
15 |
16 |   const action = useAction(sendFeebackAction, {
17 |     onSuccess: () => {
18 |       setValue("");
19 |     },
20 |   });
21 |
22 |   return (
23 |     <div className="h-full absolute top-0 left-0 right-0 bottom-0 z-[100] bg-background">
24 |       <div className="p-5 flex items-center space-x-3">
25 |         <button
26 |           type="button"
27 |           className="items-center border bg-accent p-1"
28 |           onClick={onClose}
29 |         >
30 |           <Icons.ArrowBack />
31 |         </button>
32 |         <h2>Send Feedback</h2>
33 |       </div>
34 |       <div className="p-4">
35 |         {action.status === "hasSucceeded" ? (
36 |           <div className="min-h-[100px] flex items-center justify-center flex-col space-y-1 mt-[100px]">
37 |             <p className="font-medium text-sm">Thank you for your feedback!</p>
38 |             <p className="text-sm text-[#4C4C4C]">
39 |               We will be back with you as soon as possible
40 |             </p>
41 |           </div>
42 |         ) : (
43 |           <form className="space-y-4">
44 |             <Textarea
45 |               name="feedback"
46 |               value={value}
47 |               required
48 |               autoFocus
49 |               placeholder="Your feedback..."
50 |               className="min-h-[320px] resize-none"
51 |               onChange={(evt) => setValue(evt.target.value)}
52 |             />
53 |
54 |             <div className="mt-1 flex items-center justify-end">
55 |               <Button
56 |                 type="button"
57 |                 onClick={() => action.execute({ feedback: value })}
58 |                 disabled={value.length === 0 || action.status === "executing"}
59 |               >
60 |                 {action.status === "executing" ? (
61 |                   <Loader2 className="h-4 w-4 animate-spin" />
62 |                 ) : (
63 |                   "Send"
64 |                 )}
65 |               </Button>
66 |             </div>
67 |           </form>
68 |         )}
69 |       </div>
70 |     </div>
71 |   );
72 | }
```

apps/dashboard/src/components/assistant/header.tsx
```
1 | import { useAssistantStore } from "@/store/assistant";
2 | import { Button } from "@midday/ui/button";
3 | import { Icons } from "@midday/ui/icons";
4 | import { Experimental } from "../experimental";
5 |
6 | type Props = {
7 |   isExpanded: boolean;
8 |   toggleSidebar: () => void;
9 | };
10 |
11 | export function Header({ toggleSidebar, isExpanded }: Props) {
12 |   const { setOpen } = useAssistantStore();
13 |
14 |   return (
15 |     <div className="px-4 py-3 flex justify-between items-center border-border border-b-[1px]">
16 |       <div className="flex items-center space-x-3">
17 |         <Button
18 |           variant="outline"
19 |           size="icon"
20 |           className="size-8 z-50 p-0"
21 |           onClick={toggleSidebar}
22 |         >
23 |           {isExpanded ? (
24 |             <Icons.SidebarFilled width={18} />
25 |           ) : (
26 |             <Icons.Sidebar width={18} />
27 |           )}
28 |         </Button>
29 |
30 |         <h2>Assistant</h2>
31 |       </div>
32 |
33 |       <Button
34 |         className="flex md:hidden todesktop:hidden"
35 |         size="icon"
36 |         variant="ghost"
37 |         onClick={() => setOpen()}
38 |       >
39 |         <Icons.Close />
40 |       </Button>
41 |
42 |       <div className="space-x-2 items-center hidden md:flex todesktop:flex">
43 |         <Experimental className="border-border text-[#878787]" />
44 |       </div>
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/assistant/index.tsx
```
1 | "use client";
2 |
3 | import type { AI } from "@/actions/ai/chat";
4 | import { getUIStateFromAIState } from "@/actions/ai/chat/utils";
5 | import { getChat } from "@/actions/ai/storage";
6 | import { Chat } from "@/components/chat";
7 | import { useAIState, useUIState } from "ai/rsc";
8 | import { nanoid } from "nanoid";
9 | import { useEffect, useState } from "react";
10 | import { useHotkeys } from "react-hotkeys-hook";
11 | import { AssistantFeedback } from "./feedback";
12 | import { Header } from "./header";
13 | import { SidebarList } from "./sidebar-list";
14 |
15 | export function Assistant() {
16 |   const [isExpanded, setExpanded] = useState(false);
17 |   const [showFeedback, setShowFeedback] = useState(false);
18 |   const [chatId, setChatId] = useState();
19 |   const [messages, setMessages] = useUIState<typeof AI>();
20 |   const [aiState, setAIState] = useAIState<typeof AI>();
21 |   const [input, setInput] = useState<string>("");
22 |
23 |   const toggleOpen = () => setExpanded((prev) => !prev);
24 |
25 |   const onNewChat = () => {
26 |     const newChatId = nanoid();
27 |     setInput("");
28 |     setExpanded(false);
29 |     setAIState((prev) => ({ ...prev, messages: [], chatId: newChatId }));
30 |     setMessages([]);
31 |     setChatId(newChatId);
32 |   };
33 |
34 |   const handleOnSelect = (id: string) => {
35 |     setExpanded(false);
36 |     setChatId(id);
37 |   };
38 |
39 |   useHotkeys("meta+j", () => onNewChat(), {
40 |     enableOnFormTags: true,
41 |   });
42 |
43 |   useEffect(() => {
44 |     async function fetchData() {
45 |       const result = await getChat(chatId);
46 |
47 |       if (result) {
48 |         setAIState((prev) => ({ ...prev, messages: result.messages }));
49 |         setMessages(getUIStateFromAIState(result));
50 |       }
51 |     }
52 |
53 |     fetchData();
54 |   }, [chatId]);
55 |
56 |   return (
57 |     <div className="overflow-hidden p-0 h-full w-full todesktop:max-w-[760px] md:max-w-[760px] md:h-[480px] todesktop:h-[480px]">
58 |       {showFeedback && (
59 |         <AssistantFeedback onClose={() => setShowFeedback(false)} />
60 |       )}
61 |
62 |       <SidebarList
63 |         onNewChat={onNewChat}
64 |         isExpanded={isExpanded}
65 |         setExpanded={setExpanded}
66 |         onSelect={handleOnSelect}
67 |         chatId={chatId}
68 |       />
69 |
70 |       <Header toggleSidebar={toggleOpen} isExpanded={isExpanded} />
71 |
72 |       <Chat
73 |         submitMessage={setMessages}
74 |         messages={messages}
75 |         user={aiState.user}
76 |         onNewChat={onNewChat}
77 |         setInput={setInput}
78 |         input={input}
79 |         showFeedback={() => setShowFeedback(true)}
80 |       />
81 |     </div>
82 |   );
83 | }
```

apps/dashboard/src/components/assistant/sidebar-item.tsx
```
1 | import type { Chat } from "@/actions/ai/types";
2 | import { cn } from "@midday/ui/cn";
3 |
4 | interface SidebarItemProps {
5 |   chat: Chat;
6 |   chatId?: string;
7 |   onSelect: (id: string) => void;
8 | }
9 |
10 | export function SidebarItem({ chat, chatId, onSelect }: SidebarItemProps) {
11 |   return (
12 |     <button
13 |       type="button"
14 |       className={cn(
15 |         "text-left transition-colors px-0 py-1 rounded-lg w-full text-[#878787] hover:text-primary",
16 |         chatId === chat.id && "text-primary"
17 |       )}
18 |       onClick={() => onSelect(chat.id)}
19 |     >
20 |       <span className="text-xs line-clamp-1">{chat.title}</span>
21 |     </button>
22 |   );
23 | }
```

apps/dashboard/src/components/assistant/sidebar-items.tsx
```
1 | import type { AI } from "@/actions/ai/chat";
2 | import { getChatsAction } from "@/actions/ai/chat/get-chats-action";
3 | import type { Chat } from "@/actions/ai/types";
4 | import { useAIState } from "ai/rsc";
5 | import { useEffect, useState } from "react";
6 | import { SidebarItem } from "./sidebar-item";
7 |
8 | interface SidebarItemsProps {
9 |   onSelect: (id: string) => void;
10 |   chatId?: string;
11 | }
12 |
13 | const formatRange = (key: string) => {
14 |   switch (key) {
15 |     case "1d":
16 |       return "Today";
17 |     case "2d":
18 |       return "Yesterday";
19 |     case "7d":
20 |       return "Last 7 days";
21 |     case "30d":
22 |       return "Last 30 days";
23 |     default:
24 |       return null;
25 |   }
26 | };
27 |
28 | export function SidebarItems({ onSelect, chatId }: SidebarItemsProps) {
29 |   const [items, setItems] = useState<Chat[]>([]);
30 |   const [isLoading, setLoading] = useState(false);
31 |   const [aiState] = useAIState<typeof AI>();
32 |
33 |   useEffect(() => {
34 |     async function fetchData() {
35 |       setLoading(true);
36 |
37 |       const result = await getChatsAction();
38 |
39 |       if (result) {
40 |         setItems(result);
41 |       }
42 |
43 |       setLoading(false);
44 |     }
45 |
46 |     if (
47 |       (!items.length && !isLoading) ||
48 |       (items.length !== aiState?.messages.length && !isLoading)
49 |     ) {
50 |       fetchData();
51 |     }
52 |   }, [aiState]);
53 |
54 |   return (
55 |     <div className="overflow-auto relative h-screen md:h-[410px] mt-16 scrollbar-hide p-4 pt-0 pb-[50px] flex flex-col space-y-6">
56 |       {!Object.keys(items).length && (
57 |         <div className="flex flex-col justify-center items-center h-full">
58 |           <div className="flex flex-col items-center -mt-12 text-xs space-y-1">
59 |             <span className="text-[#878787]">History</span>
60 |             <span>No results found</span>
61 |           </div>
62 |         </div>
63 |       )}
64 |
65 |       {Object.keys(items).map((key) => {
66 |         const section = items[key];
67 |
68 |         return (
69 |           <div key={key}>
70 |             {section?.length > 0 && (
71 |               <div className="sticky top-0 z-20 w-full bg-background dark:bg-[#131313] pb-1">
72 |                 <span className="font-mono text-xs">{formatRange(key)}</span>
73 |               </div>
74 |             )}
75 |
76 |             <div className="mt-1">
77 |               {section?.map((chat) => {
78 |                 return (
79 |                   <SidebarItem
80 |                     key={chat.id}
81 |                     chat={chat}
82 |                     onSelect={onSelect}
83 |                     chatId={chatId}
84 |                   />
85 |                 );
86 |               })}
87 |             </div>
88 |           </div>
89 |         );
90 |       })}
91 |     </div>
92 |   );
93 | }
```

apps/dashboard/src/components/assistant/sidebar-list.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { useClickAway } from "@uidotdev/usehooks";
3 | import { SidebarItems } from "./sidebar-items";
4 | import { Toolbar } from "./toolbar";
5 |
6 | type Props = {
7 |   isExpanded: boolean;
8 |   chatId?: string;
9 |   setExpanded: (value: boolean) => void;
10 |   onSelect: (id: string) => void;
11 |   onNewChat: () => void;
12 | };
13 |
14 | export function SidebarList({
15 |   isExpanded,
16 |   chatId,
17 |   setExpanded,
18 |   onSelect,
19 |   onNewChat,
20 | }: Props) {
21 |   const ref = useClickAway(() => {
22 |     setExpanded(false);
23 |   });
24 |
25 |   return (
26 |     <div className="relative">
27 |       <div
28 |         ref={ref}
29 |         className={cn(
30 |           "w-[220px] h-screen md:h-[477px] bg-background dark:bg-[#131313] absolute -left-[220px] top-0 bottom-[1px] duration-200 ease-out transition-all border-border border-r-[1px] z-20 invisible",
31 |           isExpanded && "visible translate-x-full"
32 |         )}
33 |       >
34 |         <SidebarItems onSelect={onSelect} chatId={chatId} />
35 |         <Toolbar onNewChat={onNewChat} />
36 |         <div className="absolute z-10 h-[477px] w-[45px] bg-gradient-to-r from-background/30 dark:from-[#131313]/30 to-background right-0 top-0 pointer-events-none" />
37 |       </div>
38 |
39 |       <div
40 |         className={cn(
41 |           "duration-200 ease-out transition-all z-10 fixed left-[1px] right-[1px] top-[1px] bottom-[1px] invisible opacity-0 bg-background",
42 |           isExpanded && "visible opacity-80"
43 |         )}
44 |       />
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/assistant/toolbar.tsx
```
1 | type Props = {
2 |   onNewChat: () => void;
3 | };
4 |
5 | export function Toolbar({ onNewChat }: Props) {
6 |   return (
7 |     <button onClick={onNewChat} type="button">
8 |       <div className="left-4 right-4 absolute z-20 bottom-4 flex items-center justify-center">
9 |         <div className="dark:bg-[#1A1A1A]/95 bg-[#F6F6F3]/95 h-8 w-full justify-between items-center flex px-2 space-x-4 text-[#878787]">
10 |           <div className="flex items-center space-x-3">
11 |             <kbd className="pointer-events-none h-5 select-none items-center gap-1.5 rounded border bg-accent px-1.5 font-mono text-[11px] font-medium flex bg-[#2C2C2C]">
12 |               <span className="text-[16px]">⌘</span>J
13 |             </kbd>
14 |             <span className="text-xs">New chat</span>
15 |           </div>
16 |         </div>
17 |       </div>
18 |     </button>
19 |   );
20 | }
```

apps/dashboard/src/components/base-currency/base-currency.loading.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 |
3 | export function Loading() {
4 |   return <Skeleton className="w-[200px] h-[36px] rounded-none" />;
5 | }
```

apps/dashboard/src/components/base-currency/base-currency.server.tsx
```
1 | import { getTeamSettings } from "@midday/supabase/cached-queries";
2 | import { SelectCurrency } from "./select-currency";
3 |
4 | export async function BaseCurrencyServer() {
5 |   const { data } = await getTeamSettings();
6 |
7 |   return <SelectCurrency defaultValue={data?.base_currency} />;
8 | }
```

apps/dashboard/src/components/base-currency/base-currency.tsx
```
1 | import {
2 |   Card,
3 |   CardContent,
4 |   CardDescription,
5 |   CardHeader,
6 |   CardTitle,
7 | } from "@midday/ui/card";
8 | import { Suspense } from "react";
9 | import { Loading } from "./base-currency.loading";
10 | import { BaseCurrencyServer } from "./base-currency.server";
11 |
12 | export function BaseCurrency() {
13 |   return (
14 |     <Card>
15 |       <CardHeader>
16 |         <CardTitle>Base currency</CardTitle>
17 |         <CardDescription>
18 |           If you have multiple currencies, you can set a base currency for your
19 |           account to view your total balance in your preferred currency.
20 |           Exchange rates are updated every 24 hours.
21 |         </CardDescription>
22 |       </CardHeader>
23 |
24 |       <CardContent>
25 |         <Suspense fallback={<Loading />}>
26 |           <BaseCurrencyServer />
27 |         </Suspense>
28 |       </CardContent>
29 |     </Card>
30 |   );
31 | }
```

apps/dashboard/src/components/base-currency/select-currency.tsx
```
1 | "use client";
2 |
3 | import { updateCurrencyAction } from "@/actions/transactions/update-currency-action";
4 | import { SelectCurrency as SelectCurrencyBase } from "@/components/select-currency";
5 | import { useSyncStatus } from "@/hooks/use-sync-status";
6 | import { uniqueCurrencies } from "@midday/location/currencies";
7 | import { Button } from "@midday/ui/button";
8 | import { useToast } from "@midday/ui/use-toast";
9 | import { useAction } from "next-safe-action/hooks";
10 | import { useEffect, useState } from "react";
11 |
12 | export function SelectCurrency({ defaultValue }: { defaultValue: string }) {
13 |   const { toast } = useToast();
14 |   const [isSyncing, setSyncing] = useState(false);
15 |   const [runId, setRunId] = useState<string | undefined>();
16 |   const [accessToken, setAccessToken] = useState<string | undefined>();
17 |
18 |   const { status, setStatus } = useSyncStatus({ runId, accessToken });
19 |
20 |   const updateCurrency = useAction(updateCurrencyAction, {
21 |     onExecute: () => setSyncing(true),
22 |     onSuccess: ({ data }) => {
23 |       if (data) {
24 |         setRunId(data.id);
25 |         setAccessToken(data.publicAccessToken);
26 |       }
27 |     },
28 |     onError: () => {
29 |       setRunId(undefined);
30 |
31 |       toast({
32 |         duration: 3500,
33 |         variant: "error",
34 |         title: "Something went wrong pleaase try again.",
35 |       });
36 |     },
37 |   });
38 |
39 |   const handleChange = async (baseCurrency: string) => {
40 |     if (baseCurrency !== defaultValue) {
41 |       toast({
42 |         title: "Update base currency",
43 |         description:
44 |           "This will update the base currency for all transactions and account balances.",
45 |         duration: 7000,
46 |         footer: (
47 |           <Button
48 |             onClick={() =>
49 |               updateCurrency.execute({
50 |                 baseCurrency: baseCurrency.toUpperCase(),
51 |               })
52 |             }
53 |           >
54 |             Update
55 |           </Button>
56 |         ),
57 |       });
58 |
59 |       return;
60 |     }
61 |   };
62 |
63 |   useEffect(() => {
64 |     if (status === "COMPLETED") {
65 |       setSyncing(false);
66 |       setStatus(null);
67 |       setRunId(undefined);
68 |       toast({
69 |         duration: 3500,
70 |         variant: "success",
71 |         title: "Transactions and account balances updated.",
72 |       });
73 |     }
74 |   }, [status]);
75 |
76 |   useEffect(() => {
77 |     if (isSyncing) {
78 |       toast({
79 |         title: "Updating...",
80 |         description: "We're updating your base currency, please wait.",
81 |         duration: Number.POSITIVE_INFINITY,
82 |         variant: "spinner",
83 |       });
84 |     }
85 |   }, [isSyncing]);
86 |
87 |   useEffect(() => {
88 |     if (status === "FAILED") {
89 |       setSyncing(false);
90 |       setRunId(undefined);
91 |
92 |       toast({
93 |         duration: 3500,
94 |         variant: "error",
95 |         title: "Something went wrong pleaase try again.",
96 |       });
97 |     }
98 |   }, [status]);
99 |
100 |   return (
101 |     <div className="w-[200px]">
102 |       <SelectCurrencyBase
103 |         onChange={handleChange}
104 |         currencies={uniqueCurrencies}
105 |         value={defaultValue}
106 |       />
107 |     </div>
108 |   );
109 | }
```

apps/dashboard/src/components/charts/area-chart.tsx
```
1 | "use client";
2 |
3 | import { useUserContext } from "@/store/user/hook";
4 | import { formatAmount } from "@/utils/format";
5 | import { format } from "date-fns";
6 | import React from "react";
7 | import {
8 |   Area,
9 |   AreaChart as BaseAreaChart,
10 |   CartesianGrid,
11 |   ResponsiveContainer,
12 |   Tooltip,
13 |   XAxis,
14 |   YAxis,
15 | } from "recharts";
16 |
17 | type ToolTipContentProps = {
18 |   payload: any;
19 | };
20 |
21 | const ToolTipContent = ({ payload }: ToolTipContentProps) => {
22 |   const { value = 0, date, currency } = payload.at(0)?.payload ?? {};
23 |   const { locale } = useUserContext((state) => state.data);
24 |
25 |   return (
26 |     <div className="w-[240px] border shadow-sm bg-background">
27 |       <div className="py-2 px-3">
28 |         <div className="flex items-center justify-between">
29 |           <p className="font-medium text-[13px]">
30 |             {formatAmount({
31 |               maximumFractionDigits: 0,
32 |               minimumFractionDigits: 0,
33 |               currency,
34 |               amount: value,
35 |               locale,
36 |             })}
37 |           </p>
38 |           <p className="text-xs text-[#606060] text-right">
39 |             {date && format(new Date(date), "MMM, y")}
40 |           </p>
41 |         </div>
42 |       </div>
43 |     </div>
44 |   );
45 | };
46 |
47 | type AreaChartProps = {
48 |   data: any;
49 |   height?: number;
50 | };
51 |
52 | export function AreaChart({ data, height = 290 }: AreaChartProps) {
53 |   return (
54 |     <ResponsiveContainer width="100%" height={height}>
55 |       <BaseAreaChart data={data}>
56 |         <defs>
57 |           <pattern
58 |             id="raster"
59 |             patternUnits="userSpaceOnUse"
60 |             width="64"
61 |             height="64"
62 |           >
63 |             <path d="M-106 110L22 -18" stroke="#282828" />
64 |             <path d="M-98 110L30 -18" stroke="#282828" />
65 |             <path d="M-90 110L38 -18" stroke="#282828" />
66 |             <path d="M-82 110L46 -18" stroke="#282828" />
67 |             <path d="M-74 110L54 -18" stroke="#282828" />
68 |             <path d="M-66 110L62 -18" stroke="#282828" />
69 |             <path d="M-58 110L70 -18" stroke="#282828" />
70 |             <path d="M-50 110L78 -18" stroke="#282828" />
71 |             <path d="M-42 110L86 -18" stroke="#282828" />
72 |             <path d="M-34 110L94 -18" stroke="#282828" />
73 |             <path d="M-26 110L102 -18" stroke="#282828" />
74 |             <path d="M-18 110L110 -18" stroke="#282828" />
75 |             <path d="M-10 110L118 -18" stroke="#282828" />
76 |             <path d="M-2 110L126 -18" stroke="#282828" />
77 |             <path d="M6 110L134 -18" stroke="#282828" />
78 |             <path d="M14 110L142 -18" stroke="#282828" />
79 |             <path d="M22 110L150 -18" stroke="#282828" />
80 |           </pattern>
81 |         </defs>
82 |
83 |         <CartesianGrid
84 |           strokeDasharray="3 3"
85 |           vertical={false}
86 |           className="stoke-[#DCDAD2] dark:stroke-[#2C2C2C]"
87 |         />
88 |
89 |         <Tooltip
90 |           content={(content) => <ToolTipContent {...content} />}
91 |           cursor={false}
92 |         />
93 |
94 |         <XAxis
95 |           dataKey="date"
96 |           stroke="#888888"
97 |           fontSize={12}
98 |           tickLine={false}
99 |           axisLine={false}
100 |           tickMargin={15}
101 |           tickFormatter={(value) => {
102 |             return format(new Date(value), "MMM");
103 |           }}
104 |           tick={{
105 |             fill: "#606060",
106 |             fontSize: 12,
107 |             fontFamily: "var(--font-sans)",
108 |           }}
109 |         />
110 |
111 |         <YAxis
112 |           stroke="#888888"
113 |           fontSize={12}
114 |           tickLine={false}
115 |           axisLine={false}
116 |           tickMargin={10}
117 |           tick={{
118 |             fill: "#606060",
119 |             fontSize: 12,
120 |             fontFamily: "var(--font-sans)",
121 |           }}
122 |         />
123 |
124 |         <Tooltip />
125 |
126 |         <Area
127 |           strokeWidth={2.5}
128 |           type="monotone"
129 |           dataKey="value"
130 |           stroke="hsl(var(--primary))"
131 |           fill="url(#raster)"
132 |         />
133 |       </BaseAreaChart>
134 |     </ResponsiveContainer>
135 |   );
136 | }
```

apps/dashboard/src/components/charts/bar-chart.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { formatAmount } from "@/utils/format";
6 | import { cn } from "@midday/ui/cn";
7 | import { format } from "date-fns";
8 | import {
9 |   Bar,
10 |   BarChart as BaseBarChart,
11 |   CartesianGrid,
12 |   Cell,
13 |   ResponsiveContainer,
14 |   Tooltip,
15 |   XAxis,
16 |   YAxis,
17 | } from "recharts";
18 | import { Status } from "./status";
19 |
20 | const ToolTipContent = ({ payload = {} }) => {
21 |   const t = useI18n();
22 |   const { locale } = useUserContext((state) => state.data);
23 |
24 |   const [current, previous] = payload;
25 |
26 |   return (
27 |     <div className="w-[240px] border shadow-sm bg-background">
28 |       <div className="border-b-[1px] px-4 py-2 flex justify-between items-center">
29 |         <p className="text-sm">
30 |           {t(`chart_type.${current?.payload?.meta?.type}`)}
31 |         </p>
32 |         <div>
33 |           {current?.payload.precentage.value > 0 && (
34 |             <Status
35 |               value={`${current?.payload.precentage.value}%`}
36 |               variant={current?.payload.precentage.status}
37 |             />
38 |           )}
39 |         </div>
40 |       </div>
41 |
42 |       <div className="p-4">
43 |         <div className="flex justify-between mb-2">
44 |           <div className="flex items-center justify-center space-x-2">
45 |             <div className="w-[8px] h-[8px] rounded-full bg-[#121212] dark:bg-[#F5F5F3]" />
46 |             <p className="font-medium text-[13px]">
47 |               {formatAmount({
48 |                 maximumFractionDigits: 0,
49 |                 minimumFractionDigits: 0,
50 |                 currency: current?.payload?.meta?.currency,
51 |                 amount: current?.payload?.current.value || 0,
52 |                 locale,
53 |               })}
54 |             </p>
55 |           </div>
56 |
57 |           <p className="text-xs text-[#606060] text-right">
58 |             {current?.payload?.meta?.period === "weekly"
59 |               ? current?.payload?.current?.date &&
60 |                 `Week ${format(
61 |                   new Date(current.payload.current.date),
62 |                   "ww, y",
63 |                 )}`
64 |               : current?.payload?.current?.date &&
65 |                 format(new Date(current.payload.current.date), "MMM, y")}
66 |           </p>
67 |         </div>
68 |
69 |         <div className="flex justify-between">
70 |           <div className="flex items-center justify-center space-x-2">
71 |             <div className="w-[8px] h-[8px] rounded-full bg-[#C6C6C6] dark:bg-[#606060]" />
72 |             <p className="font-medium text-[13px]">
73 |               {formatAmount({
74 |                 amount: previous?.payload?.previous.value || 0,
75 |                 currency: current?.payload?.meta?.currency,
76 |                 maximumFractionDigits: 0,
77 |                 minimumFractionDigits: 0,
78 |                 locale,
79 |               })}
80 |             </p>
81 |           </div>
82 |
83 |           <p className="text-xs text-[#606060] text-right">
84 |             {previous?.payload?.meta?.period === "weekly"
85 |               ? previous?.payload?.previous?.date &&
86 |                 `Week ${format(
87 |                   new Date(previous.payload.previous.date),
88 |                   "ww, y",
89 |                 )}`
90 |               : previous?.payload?.previous?.date &&
91 |                 format(new Date(previous.payload.previous.date), "MMM, y")}
92 |           </p>
93 |         </div>
94 |       </div>
95 |     </div>
96 |   );
97 | };
98 |
99 | export function BarChart({ data, height = 290 }) {
100 |   const formattedData = data?.result?.map((item) => ({
101 |     ...item,
102 |     meta: data.meta,
103 |     date: format(
104 |       new Date(item.date),
105 |       data.meta.period === "weekly" ? "w" : "MMM",
106 |     ),
107 |   }));
108 |
109 |   return (
110 |     <div className="relative h-full w-full">
111 |       <div className="space-x-4 absolute right-0 -top-10 hidden md:flex">
112 |         <div className="flex space-x-2 items-center">
113 |           <span className="w-2 h-2 rounded-full bg-[#121212] dark:bg-[#F5F5F3]" />
114 |           <span className="text-sm text-[#606060]">Current Period</span>
115 |         </div>
116 |         <div className="flex space-x-2 items-center">
117 |           <span className="w-2 h-2 rounded-full bg-[#C6C6C6] dark:bg-[#606060]" />
118 |           <span className="text-sm text-[#606060]">Last Period</span>
119 |         </div>
120 |       </div>
121 |
122 |       <ResponsiveContainer width="100%" height={height}>
123 |         <BaseBarChart data={formattedData} barGap={15}>
124 |           <XAxis
125 |             dataKey="date"
126 |             stroke="#888888"
127 |             fontSize={12}
128 |             tickLine={false}
129 |             axisLine={false}
130 |             tickMargin={15}
131 |             tick={{
132 |               fill: "#606060",
133 |               fontSize: 12,
134 |               fontFamily: "var(--font-sans)",
135 |             }}
136 |           />
137 |
138 |           <YAxis
139 |             stroke="#888888"
140 |             fontSize={12}
141 |             tickMargin={10}
142 |             tickLine={false}
143 |             axisLine={false}
[TRUNCATED]
```

apps/dashboard/src/components/charts/burn-rate-chart.tsx
```
1 | import { calculateAvgBurnRate } from "@/utils/format";
2 | import { getBurnRate, getRunway } from "@midday/supabase/cached-queries";
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 | import {
6 |   Tooltip,
7 |   TooltipContent,
8 |   TooltipProvider,
9 |   TooltipTrigger,
10 | } from "@midday/ui/tooltip";
11 | import Link from "next/link";
12 | import { AnimatedNumber } from "../animated-number";
13 | import { AreaChart } from "./area-chart";
14 | import { burnRateExamleData } from "./data";
15 |
16 | type Props = {
17 |   value: unknown;
18 |   defaultValue: unknown;
19 |   disabled?: boolean;
20 |   currency?: string;
21 | };
22 |
23 | export async function BurnRateChart({
24 |   value,
25 |   defaultValue,
26 |   disabled,
27 |   currency,
28 | }: Props) {
29 |   const [{ data: burnRateData, currency: baseCurrency }, { data: runway }] =
30 |     disabled
31 |       ? burnRateExamleData
32 |       : await Promise.all([
33 |           getBurnRate({
34 |             ...defaultValue,
35 |             ...value,
36 |             currency,
37 |           }),
38 |           getRunway({
39 |             ...defaultValue,
40 |             ...value,
41 |             currency,
42 |           }),
43 |         ]);
44 |
45 |   return (
46 |     <div className={cn(disabled && "pointer-events-none select-none")}>
47 |       <div className="space-y-2 mb-14 select-text">
48 |         <h1 className="text-4xl font-mono">
49 |           <AnimatedNumber
50 |             value={calculateAvgBurnRate(burnRateData)}
51 |             currency={baseCurrency}
52 |           />
53 |         </h1>
54 |
55 |         <div className="text-sm text-[#606060] flex items-center space-x-2">
56 |           <span>
57 |             {typeof runway === "number" && runway > 0
58 |               ? `${runway} months runway`
59 |               : "Average burn rate"}
60 |           </span>
61 |           <TooltipProvider delayDuration={100}>
62 |             <Tooltip>
63 |               <TooltipTrigger asChild>
64 |                 <Icons.Info className="h-4 w-4 mt-1" />
65 |               </TooltipTrigger>
66 |               <TooltipContent
67 |                 className="text-xs text-[#878787] max-w-[240px] p-4 space-y-2"
68 |                 side="bottom"
69 |                 sideOffset={10}
70 |               >
71 |                 <h3 className="font-medium text-primary">
72 |                   The Burn Rate is your monthly expenses divided by your current
73 |                   balance, estimating how long your funds will last.
74 |                 </h3>
75 |                 <p>
76 |                   Explanation: This tracks how fast you’re spending. If it’s
77 |                   incorrect, internal transfers may be counted as income. You
78 |                   can adjust this by excluding the transactions from the
79 |                   calculations.
80 |                 </p>
81 |
82 |                 <p>
83 |                   All amounts are converted into your{" "}
84 |                   <Link
85 |                     href="/settings/accounts"
86 |                     className="text-primary underline"
87 |                   >
88 |                     base currency
89 |                   </Link>
90 |                   .
91 |                 </p>
92 |               </TooltipContent>
93 |             </Tooltip>
94 |           </TooltipProvider>
95 |         </div>
96 |       </div>
97 |
98 |       <AreaChart data={burnRateData} />
99 |     </div>
100 |   );
101 | }
```

apps/dashboard/src/components/charts/chart-filters.server.tsx
```
1 | import { getBankAccountsCurrencies } from "@midday/supabase/cached-queries";
2 | import { Suspense } from "react";
3 | import { ChartFilters } from "./chart-filters";
4 |
5 | export async function ChartFiltersServer() {
6 |   const currencies = await getBankAccountsCurrencies();
7 |
8 |   return (
9 |     <Suspense>
10 |       <ChartFilters
11 |         currencies={
12 |           currencies?.data?.map((currency) => {
13 |             return {
14 |               id: currency.currency,
15 |               name: currency.currency,
16 |             };
17 |           }) ?? []
18 |         }
19 |       />
20 |     </Suspense>
21 |   );
22 | }
```

apps/dashboard/src/components/charts/chart-filters.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import {
5 |   DropdownMenu,
6 |   DropdownMenuContent,
7 |   DropdownMenuPortal,
8 |   DropdownMenuRadioGroup,
9 |   DropdownMenuRadioItem,
10 |   DropdownMenuSub,
11 |   DropdownMenuSubContent,
12 |   DropdownMenuSubTrigger,
13 |   DropdownMenuTrigger,
14 | } from "@midday/ui/dropdown-menu";
15 | import { Icons } from "@midday/ui/icons";
16 | import { parseAsString, useQueryStates } from "nuqs";
17 |
18 | type Props = {
19 |   currencies: {
20 |     id: string;
21 |     name: string;
22 |   }[];
23 | };
24 |
25 | export function ChartFilters({ currencies }: Props) {
26 |   const [{ currency }, setCurrency] = useQueryStates(
27 |     {
28 |       currency: parseAsString,
29 |     },
30 |     {
31 |       shallow: false,
32 |     },
33 |   );
34 |
35 |   const allCurrencies = [
36 |     {
37 |       id: "base",
38 |       name: "Base currency",
39 |     },
40 |     ...currencies,
41 |   ];
42 |
43 |   return (
44 |     <DropdownMenu>
45 |       <DropdownMenuTrigger asChild>
46 |         <Button variant="outline" size="icon">
47 |           <Icons.Filter size={18} />
48 |         </Button>
49 |       </DropdownMenuTrigger>
50 |       <DropdownMenuContent sideOffset={10} align="end" className="w-[200px]">
51 |         <DropdownMenuSub>
52 |           <DropdownMenuSubTrigger>
53 |             <Icons.Currency className="mr-2 h-4 w-4" />
54 |             <span>Currency</span>
55 |           </DropdownMenuSubTrigger>
56 |           <DropdownMenuPortal>
57 |             <DropdownMenuSubContent sideOffset={14} alignOffset={-4}>
58 |               <DropdownMenuRadioGroup
59 |                 value={currency ?? "base"}
60 |                 onValueChange={(value) =>
61 |                   setCurrency({ currency: value === "base" ? null : value })
62 |                 }
63 |               >
64 |                 {allCurrencies.map((currency) => (
65 |                   <DropdownMenuRadioItem key={currency.id} value={currency.id}>
66 |                     {currency.name}
67 |                   </DropdownMenuRadioItem>
68 |                 ))}
69 |               </DropdownMenuRadioGroup>
70 |             </DropdownMenuSubContent>
71 |           </DropdownMenuPortal>
72 |         </DropdownMenuSub>
73 |       </DropdownMenuContent>
74 |     </DropdownMenu>
75 |   );
76 | }
```

apps/dashboard/src/components/charts/chart-more.tsx
```
1 | "use client";
2 |
3 | import { ShareReport } from "@/components/share-report";
4 | import { Button } from "@midday/ui/button";
5 | import { Dialog } from "@midday/ui/dialog";
6 | import {
7 |   DropdownMenu,
8 |   DropdownMenuContent,
9 |   DropdownMenuItem,
10 |   DropdownMenuTrigger,
11 | } from "@midday/ui/dropdown-menu";
12 | import { Icons } from "@midday/ui/icons";
13 | import { useState } from "react";
14 |
15 | type Props = {
16 |   defaultValue: {
17 |     from: string;
18 |     to: string;
19 |     type: "profit" | "revenue";
20 |   };
21 |   type: "profit" | "revenue";
22 | };
23 |
24 | export function ChartMore({ defaultValue, type }: Props) {
25 |   const [isOpen, setOpen] = useState(false);
26 |
27 |   return (
28 |     <Dialog open={isOpen} onOpenChange={setOpen}>
29 |       <DropdownMenu>
30 |         <DropdownMenuTrigger asChild>
31 |           <Button variant="outline" size="icon">
32 |             <Icons.MoreHoriz size={18} />
33 |           </Button>
34 |         </DropdownMenuTrigger>
35 |         <DropdownMenuContent sideOffset={10} align="end">
36 |           <DropdownMenuItem onClick={() => setOpen(true)}>
37 |             Share report
38 |           </DropdownMenuItem>
39 |         </DropdownMenuContent>
40 |       </DropdownMenu>
41 |
42 |       <ShareReport defaultValue={defaultValue} type={type} setOpen={setOpen} />
43 |     </Dialog>
44 |   );
45 | }
```

apps/dashboard/src/components/charts/chart-period.tsx
```
1 | "use client";
2 |
3 | import { changeChartPeriodAction } from "@/actions/change-chart-period-action";
4 | import { Button } from "@midday/ui/button";
5 | import { Calendar } from "@midday/ui/calendar";
6 | import { Icons } from "@midday/ui/icons";
7 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
8 | import {
9 |   Select,
10 |   SelectContent,
11 |   SelectGroup,
12 |   SelectItem,
13 |   SelectTrigger,
14 |   SelectValue,
15 | } from "@midday/ui/select";
16 | import { formatISO } from "date-fns";
17 | import { startOfMonth, startOfYear, subMonths, subWeeks } from "date-fns";
18 | import { formatDateRange } from "little-date";
19 | import { useAction } from "next-safe-action/hooks";
20 | import { parseAsString, useQueryStates } from "nuqs";
21 |
22 | type Props = {
23 |   defaultValue: {
24 |     to: string;
25 |     from: string;
26 |   };
27 |   disabled?: string;
28 | };
29 |
30 | const periods = [
31 |   {
32 |     value: "4w",
33 |     label: "Last 4 weeks",
34 |     range: {
35 |       from: subWeeks(new Date(), 4),
36 |       to: new Date(),
37 |     },
38 |   },
39 |   {
40 |     value: "3m",
41 |     label: "Last 3 months",
42 |     range: {
43 |       from: subMonths(new Date(), 3),
44 |       to: new Date(),
45 |     },
46 |   },
47 |   {
48 |     value: "6m",
49 |     label: "Last 6 months",
50 |     range: {
51 |       from: subMonths(new Date(), 6),
52 |       to: new Date(),
53 |     },
54 |   },
55 |   {
56 |     value: "12m",
57 |     label: "Last 12 months",
58 |     range: {
59 |       from: subMonths(new Date(), 12),
60 |       to: new Date(),
61 |     },
62 |   },
63 |   {
64 |     value: "mtd",
65 |     label: "Month to date",
66 |     range: {
67 |       from: startOfMonth(new Date()),
68 |       to: new Date(),
69 |     },
70 |   },
71 |   {
72 |     value: "ytd",
73 |     label: "Year to date",
74 |     range: {
75 |       from: startOfYear(new Date()),
76 |       to: new Date(),
77 |     },
78 |   },
79 |   {
80 |     value: "all",
81 |     label: "All time",
82 |     range: {
83 |       // Can't get older data than this
84 |       from: new Date("2020-01-01"),
85 |       to: new Date(),
86 |     },
87 |   },
88 | ];
89 | export function ChartPeriod({ defaultValue, disabled }: Props) {
90 |   const { execute } = useAction(changeChartPeriodAction);
91 |
92 |   const [params, setParams] = useQueryStates(
93 |     {
94 |       from: parseAsString.withDefault(defaultValue.from),
95 |       to: parseAsString.withDefault(defaultValue.to),
96 |       period: parseAsString,
97 |     },
98 |     {
99 |       shallow: false,
100 |     },
101 |   );
102 |
103 |   const handleChangePeriod = (
104 |     range: { from: Date | null; to: Date | null } | undefined,
105 |     period?: string,
106 |   ) => {
107 |     if (!range) return;
108 |
109 |     const newRange = {
110 |       from: range.from
111 |         ? formatISO(range.from, { representation: "date" })
112 |         : params.from,
113 |       to: range.to
114 |         ? formatISO(range.to, { representation: "date" })
115 |         : params.to,
116 |       period,
117 |     };
118 |
119 |     setParams(newRange);
120 |     execute(newRange);
121 |   };
122 |
123 |   return (
124 |     <div className="flex space-x-4">
125 |       <Popover>
126 |         <PopoverTrigger asChild disabled={Boolean(disabled)}>
127 |           <Button
128 |             variant="outline"
129 |             className="justify-start text-left font-medium space-x-2"
130 |           >
131 |             <span className="line-clamp-1 text-ellipsis">
132 |               {formatDateRange(new Date(params.from), new Date(params.to), {
133 |                 includeTime: false,
134 |               })}
135 |             </span>
136 |             <Icons.ChevronDown />
137 |           </Button>
138 |         </PopoverTrigger>
139 |         <PopoverContent
140 |           className="w-screen md:w-[550px] p-0 flex-col flex space-y-4"
141 |           align="end"
142 |           sideOffset={10}
143 |         >
144 |           <div className="p-4 pb-0">
145 |             <Select
146 |               defaultValue={params.period ?? undefined}
147 |               onValueChange={(value) =>
148 |                 handleChangePeriod(
149 |                   periods.find((p) => p.value === value)?.range,
150 |                   value,
151 |                 )
152 |               }
153 |             >
154 |               <SelectTrigger className="w-full">
155 |                 <SelectValue placeholder="Select a period" />
156 |               </SelectTrigger>
157 |               <SelectContent>
158 |                 <SelectGroup>
159 |                   {periods.map((period) => (
160 |                     <SelectItem key={period.value} value={period.value}>
161 |                       {period.label}
162 |                     </SelectItem>
163 |                   ))}
164 |                 </SelectGroup>
165 |               </SelectContent>
166 |             </Select>
167 |           </div>
168 |
169 |           <Calendar
170 |             mode="range"
171 |             numberOfMonths={2}
172 |             selected={{
173 |               from: params.from && new Date(params.from),
174 |               to: params.to && new Date(params.to),
175 |             }}
176 |             defaultMonth={
177 |               new Date(new Date().setMonth(new Date().getMonth() - 1))
178 |             }
179 |             initialFocus
180 |             toDate={new Date()}
181 |             onSelect={(date) => handleChangePeriod(date)}
[TRUNCATED]
```

apps/dashboard/src/components/charts/chart-selectors.tsx
```
1 | import { ChartMore } from "@/components/charts/chart-more";
2 | import { ChartPeriod } from "@/components/charts/chart-period";
3 | import { ChartType } from "@/components/charts/chart-type";
4 | import { Cookies } from "@/utils/constants";
5 | import { cookies } from "next/headers";
6 | import { ChartFiltersServer } from "./chart-filters.server";
7 |
8 | export async function ChartSelectors({ defaultValue }) {
9 |   const chartType = cookies().get(Cookies.ChartType)?.value ?? "profit";
10 |
11 |   return (
12 |     <div className="flex justify-between mt-6 space-x-2">
13 |       <div className="flex space-x-2">
14 |         <ChartType initialValue={chartType} />
15 |       </div>
16 |
17 |       <div className="flex space-x-2">
18 |         <ChartPeriod defaultValue={defaultValue} />
19 |         <ChartFiltersServer />
20 |         <ChartMore defaultValue={defaultValue} type={chartType} />
21 |       </div>
22 |     </div>
23 |   );
24 | }
```

apps/dashboard/src/components/charts/chart-type.tsx
```
1 | "use client";
2 |
3 | import { changeChartTypeAction } from "@/actions/change-chart-type-action";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   Select,
7 |   SelectContent,
8 |   SelectGroup,
9 |   SelectItem,
10 |   SelectTrigger,
11 | } from "@midday/ui/select";
12 | import { useOptimisticAction } from "next-safe-action/hooks";
13 |
14 | const options = ["profit", "revenue", "expense", "burn_rate"];
15 |
16 | type Props = {
17 |   initialValue: string;
18 |   disabled?: boolean;
19 | };
20 |
21 | export function ChartType({ initialValue, disabled }: Props) {
22 |   const t = useI18n();
23 |   const { execute, optimisticState } = useOptimisticAction(
24 |     changeChartTypeAction,
25 |     {
26 |       currentState: initialValue,
27 |       updateFn: (_, newState) => newState,
28 |     },
29 |   );
30 |
31 |   return (
32 |     <Select defaultValue={optimisticState} onValueChange={execute}>
33 |       <SelectTrigger
34 |         className="flex-1 space-x-1 font-medium"
35 |         disabled={disabled}
36 |       >
37 |         <span>{t(`chart_type.${optimisticState}`)}</span>
38 |       </SelectTrigger>
39 |       <SelectContent>
40 |         <SelectGroup>
41 |           {options.map((option) => {
42 |             return (
43 |               <SelectItem key={option} value={option}>
44 |                 {t(`chart_type.${option}`)}
45 |               </SelectItem>
46 |             );
47 |           })}
48 |         </SelectGroup>
49 |       </SelectContent>
50 |     </Select>
51 |   );
52 | }
```

apps/dashboard/src/components/charts/charts.tsx
```
1 | import { BurnRateChart } from "./burn-rate-chart";
2 | import { ExpenseChart } from "./expense-chart";
3 | import { ProfitRevenueChart } from "./profit-revenue-chart";
4 |
5 | export function Charts(props) {
6 |   switch (props.type) {
7 |     case "revenue":
8 |     case "profit":
9 |       return <ProfitRevenueChart {...props} />;
10 |     case "burn_rate":
11 |       return <BurnRateChart {...props} />;
12 |     case "expense":
13 |       return <ExpenseChart {...props} />;
14 |     default:
15 |       return null;
16 |   }
17 | }
```

apps/dashboard/src/components/charts/data.ts
```
1 | import { getColorFromName } from "@/utils/categories";
2 |
3 | export const chartExampleData = {
4 |   summary: {
5 |     currency: "USD",
6 |     currentTotal: 800000,
7 |     prevTotal: 300000,
8 |   },
9 |   meta: {
10 |     type: "profit",
11 |     period: "monthly",
12 |     currency: "USD",
13 |   },
14 |   result: [
15 |     {
16 |       date: "Sun Jan 01 2023",
17 |       previous: {
18 |         date: "2022-1-1",
19 |         currency: "USD",
20 |         value: 10000,
21 |       },
22 |       current: {
23 |         date: "2023-1-1",
24 |         currency: "USD",
25 |         value: 20300,
26 |       },
27 |       precentage: {
28 |         currency: "USD",
29 |         value: 110,
30 |         status: "positive",
31 |       },
32 |     },
33 |     {
34 |       date: "Wed Feb 01 2023",
35 |       previous: {
36 |         date: "2022-2-1",
37 |         currency: "USD",
38 |         value: 8000,
39 |       },
40 |       current: {
41 |         date: "2023-2-1",
42 |         currency: "USD",
43 |         value: 14000,
44 |       },
45 |       precentage: {
46 |         currency: "USD",
47 |         value: 1000,
48 |         status: "positive",
49 |       },
50 |     },
51 |     {
52 |       date: "Wed Mar 01 2023",
53 |       previous: {
54 |         date: "2022-3-1",
55 |         currency: "USD",
56 |         value: 15000,
57 |       },
58 |       current: {
59 |         date: "2023-3-1",
60 |         currency: "USD",
61 |         value: 18000,
62 |       },
63 |       precentage: {
64 |         currency: "USD",
65 |         value: 1000,
66 |         status: "positive",
67 |       },
68 |     },
69 |     {
70 |       date: "Sat Apr 01 2023",
71 |       previous: {
72 |         date: "2022-4-1",
73 |         currency: "USD",
74 |         value: 7000,
75 |         status: "positive",
76 |       },
77 |       current: {
78 |         date: "2023-4-1",
79 |         currency: "USD",
80 |         value: 10000,
81 |         status: "positive",
82 |       },
83 |       precentage: {
84 |         currency: "USD",
85 |         value: 1000,
86 |         status: "positive",
87 |       },
88 |     },
89 |     {
90 |       date: "Mon May 01 2023",
91 |       previous: {
92 |         date: "2022-5-1",
93 |         currency: "USD",
94 |         value: 10000,
95 |         status: "positive",
96 |       },
97 |       current: {
98 |         date: "2023-5-1",
99 |         currency: "USD",
100 |         value: 12000,
101 |         status: "positive",
102 |       },
103 |       precentage: {
104 |         currency: "USD",
105 |         value: 1000,
106 |         status: "positive",
107 |       },
108 |     },
109 |     {
110 |       date: "Thu Jun 01 2023",
111 |       previous: {
112 |         date: "2022-6-1",
113 |         value: 300,
114 |         status: "negative",
115 |       },
116 |       current: {
117 |         date: "2023-6-1",
118 |         currency: "USD",
119 |         value: 2800,
120 |         status: "positive",
121 |       },
122 |       precentage: {
123 |         currency: "USD",
124 |         value: 1000,
125 |         status: "positive",
126 |       },
127 |     },
128 |     {
129 |       date: "Sat Jul 01 2023",
130 |       previous: {
131 |         date: "2022-7-1",
132 |         currency: "USD",
133 |         value: 1000,
134 |         status: "positive",
135 |       },
136 |       current: {
137 |         date: "2023-7-1",
138 |         currency: "USD",
139 |         value: 1000,
140 |         status: "positive",
141 |       },
142 |       precentage: {
143 |         currency: "USD",
144 |         value: 1000,
145 |         status: "positive",
146 |       },
147 |     },
148 |     {
149 |       date: "Tue Aug 01 2023",
150 |       previous: {
151 |         date: "2022-8-1",
152 |         currency: "USD",
153 |         value: 1000,
154 |         status: "positive",
155 |       },
156 |       current: {
157 |         date: "2023-8-1",
158 |         currency: "USD",
159 |         value: 1000,
160 |         status: "positive",
161 |       },
162 |       precentage: {
163 |         currency: "USD",
164 |         value: 43,
165 |         status: "positive",
166 |       },
167 |     },
168 |     {
169 |       date: "Fri Sep 01 2023",
170 |       previous: {
171 |         date: "2022-9-1",
172 |         currency: "USD",
173 |         value: 1000,
174 |         status: "positive",
175 |       },
176 |       current: {
177 |         currency: "USD",
178 |         date: "2023-9-1",
179 |         value: -3000,
180 |         status: "negative",
181 |       },
182 |       precentage: {
183 |         currency: "USD",
184 |         value: 53,
185 |         status: "positive",
186 |       },
187 |     },
188 |     {
189 |       date: "Sun Oct 01 2023",
190 |       previous: {
191 |         date: "2022-10-1",
192 |         currency: "USD",
193 |         value: 10000,
194 |         status: "positive",
195 |       },
196 |       current: {
197 |         currency: "USD",
198 |         date: "2023-10-1",
199 |         value: 20000,
200 |         status: "negative",
201 |       },
202 |       precentage: {
203 |         currency: "USD",
204 |         value: 0,
205 |         status: "positive",
206 |       },
207 |     },
208 |     {
209 |       date: "Wed Nov 01 2023",
210 |       previous: {
211 |         date: "2022-11-1",
212 |         currency: "USD",
213 |         value: 10000,
214 |         status: "positive",
215 |       },
216 |       current: {
217 |         date: "2023-11-1",
218 |         currency: "USD",
219 |         value: 20000,
220 |         status: "negative",
221 |       },
222 |       precentage: {
[TRUNCATED]
```

apps/dashboard/src/components/charts/empty-state.tsx
```
1 | import { AddAccountButton } from "@/components/add-account-button";
2 |
3 | export function EmptyState() {
4 |   return (
5 |     <div className="absolute w-full h-full top-0 left-0 flex items-center justify-center z-20">
6 |       <div className="text-center max-w-md mx-auto flex flex-col items-center justify-center">
7 |         <h2 className="text-xl font-medium mb-2">Connect bank account</h2>
8 |         <p className="text-sm text-[#878787] mb-6">
9 |           Connect your bank account to unlock powerful financial insights. Track
10 |           your spending, analyze trends, and make informed decisions.
11 |         </p>
12 |
13 |         <AddAccountButton />
14 |       </div>
15 |     </div>
16 |   );
17 | }
```

apps/dashboard/src/components/charts/expense-chart.tsx
```
1 | import { getExpenses } from "@midday/supabase/cached-queries";
2 | import { cn } from "@midday/ui/cn";
3 | import { Icons } from "@midday/ui/icons";
4 | import {
5 |   Tooltip,
6 |   TooltipContent,
7 |   TooltipProvider,
8 |   TooltipTrigger,
9 | } from "@midday/ui/tooltip";
10 | import Link from "next/link";
11 | import { AnimatedNumber } from "../animated-number";
12 | import { expenseChartExampleData } from "./data";
13 | import { StackedBarChart } from "./stacked-bar-chart";
14 |
15 | type Props = {
16 |   value: any;
17 |   defaultValue: any;
18 |   disabled?: boolean;
19 |   currency?: string;
20 | };
21 |
22 | export async function ExpenseChart({
23 |   value,
24 |   defaultValue,
25 |   disabled,
26 |   currency,
27 | }: Props) {
28 |   const data = disabled
29 |     ? expenseChartExampleData
30 |     : await getExpenses({ ...defaultValue, ...value, currency });
31 |
32 |   return (
33 |     <div className={cn(disabled && "pointer-events-none select-none")}>
34 |       <div className="space-y-2 mb-14 inline-block select-text">
35 |         <h1 className="text-4xl font-mono">
36 |           <AnimatedNumber
37 |             value={data?.summary?.averageExpense ?? 0}
38 |             currency={data?.summary?.currency ?? "USD"}
39 |           />
40 |         </h1>
41 |
42 |         <div className="text-sm text-[#606060] flex items-center space-x-2">
43 |           <p className="text-sm text-[#606060]">Average expenses</p>
44 |           <TooltipProvider delayDuration={100}>
45 |             <Tooltip>
46 |               <TooltipTrigger asChild>
47 |                 <Icons.Info className="h-4 w-4 mt-1" />
48 |               </TooltipTrigger>
49 |               <TooltipContent
50 |                 className="text-xs text-[#878787] max-w-[240px] p-4"
51 |                 side="bottom"
52 |                 sideOffset={10}
53 |               >
54 |                 <div className="space-y-2">
55 |                   <h3 className="font-medium text-primary">
56 |                     Expenses Overview
57 |                   </h3>
58 |                   <p>
59 |                     Expenses include all outgoing transactions, including
60 |                     recurring ones. The chart shows total expenses and recurring
61 |                     costs, helping you identify spending patterns and fixed
62 |                     costs.
63 |                   </p>
64 |                   <p>
65 |                     All amounts are converted into your{" "}
66 |                     <Link
67 |                       href="/settings/accounts"
68 |                       className="text-primary underline"
69 |                     >
70 |                       base currency
71 |                     </Link>
72 |                     .
73 |                   </p>
74 |                 </div>
75 |               </TooltipContent>
76 |             </Tooltip>
77 |           </TooltipProvider>
78 |         </div>
79 |       </div>
80 |       <StackedBarChart data={data} disabled={disabled} />
81 |     </div>
82 |   );
83 | }
```

apps/dashboard/src/components/charts/profit-revenue-chart.tsx
```
1 | import { getMetrics } from "@midday/supabase/cached-queries";
2 | import { cn } from "@midday/ui/cn";
3 | import { Icons } from "@midday/ui/icons";
4 | import {
5 |   Tooltip,
6 |   TooltipContent,
7 |   TooltipProvider,
8 |   TooltipTrigger,
9 | } from "@midday/ui/tooltip";
10 | import Link from "next/link";
11 | import { AnimatedNumber } from "../animated-number";
12 | import { FormatAmount } from "../format-amount";
13 | import { BarChart } from "./bar-chart";
14 | import { chartExampleData } from "./data";
15 |
16 | type Props = {
17 |   value: any;
18 |   defaultValue: any;
19 |   type: string;
20 |   disabled?: boolean;
21 |   currency?: string;
22 | };
23 |
24 | export async function ProfitRevenueChart({
25 |   value,
26 |   defaultValue,
27 |   type,
28 |   disabled,
29 |   currency,
30 | }: Props) {
31 |   const data = disabled
32 |     ? chartExampleData
33 |     : await getMetrics({ ...defaultValue, ...value, type, currency });
34 |
35 |   return (
36 |     <div className={cn(disabled && "pointer-events-none select-none")}>
37 |       <div className="space-y-2 mb-14 inline-block select-text">
38 |         <h1 className="text-4xl font-mono">
39 |           <AnimatedNumber
40 |             value={data?.summary?.currentTotal ?? 0}
41 |             currency={data?.summary?.currency ?? "USD"}
42 |           />
43 |         </h1>
44 |
45 |         <div className="text-sm text-[#606060] flex items-center space-x-2">
46 |           <p className="text-sm text-[#606060]">
47 |             vs{" "}
48 |             <FormatAmount
49 |               maximumFractionDigits={0}
50 |               minimumFractionDigits={0}
51 |               amount={data?.summary?.prevTotal ?? 0}
52 |               currency={data?.meta?.currency ?? "USD"}
53 |             />{" "}
54 |             last period
55 |           </p>
56 |           <TooltipProvider delayDuration={100}>
57 |             <Tooltip>
58 |               <TooltipTrigger asChild>
59 |                 <Icons.Info className="h-4 w-4 mt-1" />
60 |               </TooltipTrigger>
61 |               <TooltipContent
62 |                 className="text-xs text-[#878787] max-w-[240px] p-4"
63 |                 side="bottom"
64 |                 sideOffset={10}
65 |               >
66 |                 {type === "profit" ? (
67 |                   <div className="space-y-2">
68 |                     <h3 className="font-medium text-primary">
69 |                       Profit is calculated as your income minus expenses.
70 |                     </h3>
71 |                     <p>
72 |                       Explanation: This shows how much you’re making after
73 |                       costs. If the profit seems off, it may be due to internal
74 |                       transfers labeled as income. You can adjust this by
75 |                       excluding the transactions from the calculations.
76 |                     </p>
77 |
78 |                     <p>
79 |                       All amounts are converted into your{" "}
80 |                       <Link
81 |                         href="/settings/accounts"
82 |                         className="text-primary underline"
83 |                       >
84 |                         base currency
85 |                       </Link>
86 |                       .
87 |                     </p>
88 |                   </div>
89 |                 ) : (
90 |                   <div className="space-y-2">
91 |                     <h3 className="font-medium text-primary">
92 |                       Revenue represents your total income from all sources.
93 |                     </h3>
94 |                     <p>
95 |                       Explanation: This is your gross income before expenses. If
96 |                       the revenue appears too high, internal transfers may have
97 |                       been marked as income. You can fix this by excluding the
98 |                       transactions from the calculations.
99 |                     </p>
100 |
101 |                     <p>
102 |                       All amounts are converted into your{" "}
103 |                       <Link
104 |                         href="/settings/accounts"
105 |                         className="text-primary underline"
106 |                       >
107 |                         base currency
108 |                       </Link>
109 |                       .
110 |                     </p>
111 |                   </div>
112 |                 )}
113 |               </TooltipContent>
114 |             </Tooltip>
115 |           </TooltipProvider>
116 |         </div>
117 |       </div>
118 |       <BarChart data={data} disabled={disabled} />
119 |     </div>
120 |   );
121 | }
```

apps/dashboard/src/components/charts/spending-category-item.tsx
```
1 | "use client";
2 |
3 | import { useUserContext } from "@/store/user/hook";
4 | import { formatAmount } from "@/utils/format";
5 | import { CategoryColor } from "../category";
6 |
7 | type Props = {
8 |   name: string;
9 |   color: string;
10 |   amount: number;
11 |   currency: string;
12 |   percentage: number;
13 | };
14 |
15 | export function SpendingCategoryItem({
16 |   name,
17 |   color,
18 |   amount,
19 |   currency,
20 |   percentage,
21 | }: Props) {
22 |   const { locale } = useUserContext((state) => state.data);
23 |
24 |   return (
25 |     <div className="px-3 py-1 flex justify-between items-center space-x-12">
26 |       <div className="text-sm font-medium flex items-center space-x-2">
27 |         <CategoryColor name={name} color={color} />
28 |         <p>
29 |           {amount &&
30 |             formatAmount({
31 |               amount: amount,
32 |               currency,
33 |               locale,
34 |               maximumFractionDigits: 0,
35 |               minimumFractionDigits: 0,
36 |             })}
37 |         </p>
38 |       </div>
39 |       <p className="text-sm text-[#606060] truncate">{percentage}%</p>
40 |     </div>
41 |   );
42 | }
```

apps/dashboard/src/components/charts/spending-category-list.tsx
```
1 | "use client";
2 |
3 | import {
4 |   HoverCard,
5 |   HoverCardContent,
6 |   HoverCardTrigger,
7 | } from "@midday/ui/hover-card";
8 | import { Progress } from "@midday/ui/progress";
9 | import { formatISO } from "date-fns";
10 | import Link from "next/link";
11 | import { Category } from "../category";
12 | import { SpendingCategoryItem } from "./spending-category-item";
13 |
14 | type Props = {
15 |   categories: any;
16 |   period: any;
17 |   disabled: boolean;
18 | };
19 |
20 | export function SpendingCategoryList({ categories, period, disabled }: Props) {
21 |   return (
22 |     <ul className="mt-8 space-y-4 overflow-auto scrollbar-hide aspect-square pb-14">
23 |       {categories.map(({ slug, name, color, percentage, amount, currency }) => {
24 |         return (
25 |           <li key={slug}>
26 |             <HoverCard openDelay={10} closeDelay={10}>
27 |               <HoverCardTrigger asChild>
28 |                 <Link
29 |                   className="flex items-center"
30 |                   href={`/transactions?categories=${slug}&start=${formatISO(period?.from, { representation: "date" })}&end=${formatISO(period?.to, { representation: "date" })}`}
31 |                 >
32 |                   <Category
33 |                     key={slug}
34 |                     name={name}
35 |                     color={color}
36 |                     className="text-sm text-primary space-x-3 w-[90%]"
37 |                   />
38 |
39 |                   <Progress
40 |                     className="w-full rounded-none h-[6px]"
41 |                     value={percentage}
42 |                   />
43 |                 </Link>
44 |               </HoverCardTrigger>
45 |
46 |               {!disabled && (
47 |                 <HoverCardContent className="border shadow-sm bg-background py-1 px-0">
48 |                   <SpendingCategoryItem
49 |                     color={color}
50 |                     name={name}
51 |                     amount={amount}
52 |                     currency={currency}
53 |                     percentage={percentage}
54 |                   />
55 |                 </HoverCardContent>
56 |               )}
57 |             </HoverCard>
58 |           </li>
59 |         );
60 |       })}
61 |     </ul>
62 |   );
63 | }
```

apps/dashboard/src/components/charts/spending-list.tsx
```
1 | import { getSpending } from "@midday/supabase/cached-queries";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { spendingExampleData } from "./data";
4 | import { SpendingCategoryList } from "./spending-category-list";
5 |
6 | export function SpendingListSkeleton() {
7 |   return (
8 |     <div className="mt-8 space-y-4">
9 |       {[...Array(16)].map((_, index) => (
10 |         <div
11 |           key={index.toString()}
12 |           className="flex justify-between px-3 items-center"
13 |         >
14 |           <div className="w-[70%] flex space-x-4 pr-8 items-center">
15 |             <Skeleton className="rounded-[2px] size-[12px]" />
16 |             <Skeleton className="h-[6px] w-full rounded-none" />
17 |           </div>
18 |           <div className="w-full ml-auto">
19 |             <Skeleton className="w-full align-start h-[6px] rounded-none" />
20 |           </div>
21 |         </div>
22 |       ))}
23 |     </div>
24 |   );
25 | }
26 |
27 | type Props = {
28 |   initialPeriod: any;
29 |   disabled: boolean;
30 |   currency?: string;
31 | };
32 |
33 | export async function SpendingList({
34 |   initialPeriod,
35 |   disabled,
36 |   currency,
37 | }: Props) {
38 |   const spending = disabled
39 |     ? spendingExampleData
40 |     : await getSpending({ ...initialPeriod, currency });
41 |
42 |   if (!spending?.data?.length) {
43 |     return (
44 |       <div className="flex items-center justify-center aspect-square">
45 |         <p className="text-sm text-[#606060]">
46 |           No transactions have been categorized in this period.
47 |         </p>
48 |       </div>
49 |     );
50 |   }
51 |
52 |   return (
53 |     <SpendingCategoryList
54 |       categories={spending?.data}
55 |       period={initialPeriod}
56 |       disabled={disabled}
57 |     />
58 |   );
59 | }
```

apps/dashboard/src/components/charts/spending-period.tsx
```
1 | "use client";
2 |
3 | import { changeSpendingPeriodAction } from "@/actions/change-spending-period-action";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuCheckboxItem,
8 |   DropdownMenuContent,
9 |   DropdownMenuTrigger,
10 | } from "@midday/ui/dropdown-menu";
11 | import { Icons } from "@midday/ui/icons";
12 | import {
13 |   endOfMonth,
14 |   startOfMonth,
15 |   startOfYear,
16 |   subDays,
17 |   subMonths,
18 |   subYears,
19 | } from "date-fns";
20 | import { useOptimisticAction } from "next-safe-action/hooks";
21 | import Link from "next/link";
22 |
23 | const options = [
24 |   {
25 |     id: "last_30d",
26 |     from: subDays(new Date(), 30).toISOString(),
27 |     to: new Date().toISOString(),
28 |   },
29 |   {
30 |     id: "this_month",
31 |     from: startOfMonth(new Date()).toISOString(),
32 |     to: new Date().toISOString(),
33 |   },
34 |   {
35 |     id: "last_month",
36 |     from: subMonths(startOfMonth(new Date()), 1).toISOString(),
37 |     to: subMonths(endOfMonth(new Date()), 1).toISOString(),
38 |   },
39 |   {
40 |     id: "this_year",
41 |     from: startOfYear(new Date()).toISOString(),
42 |     to: new Date().toISOString(),
43 |   },
44 |   {
45 |     id: "last_year",
46 |     from: subYears(startOfMonth(new Date()), 1).toISOString(),
47 |     to: subYears(endOfMonth(new Date()), 1).toISOString(),
48 |   },
49 | ];
50 |
51 | type Props = {
52 |   initialPeriod: { id: string; from: string; to: string };
53 | };
54 |
55 | export function SpendingPeriod({ initialPeriod }: Props) {
56 |   const t = useI18n();
57 |   const { execute, optimisticState } = useOptimisticAction(
58 |     changeSpendingPeriodAction,
59 |     {
60 |       currentState: initialPeriod,
61 |       updateFn: (_, newState) => newState,
62 |     },
63 |   );
64 |
65 |   return (
66 |     <div className="flex justify-between">
67 |       <div>
68 |         <Link
69 |           href={`/transactions?start=${optimisticState.from}&end=${optimisticState.to}&amount=lte,0`}
70 |           prefetch
71 |         >
72 |           <h2 className="text-lg">Spending</h2>
73 |         </Link>
74 |       </div>
75 |
76 |       <DropdownMenu>
77 |         <DropdownMenuTrigger>
78 |           <div className="flex items-center space-x-2">
79 |             <span>{t(`spending_period.${optimisticState.id}`)}</span>
80 |             <Icons.ChevronDown />
81 |           </div>
82 |         </DropdownMenuTrigger>
83 |         <DropdownMenuContent className="w-[180px]">
84 |           {options.map((option) => (
85 |             <DropdownMenuCheckboxItem
86 |               key={option.id}
87 |               onCheckedChange={() => execute(option)}
88 |               checked={option.id === optimisticState?.id}
89 |             >
90 |               {t(`spending_period.${option.id}`)}
91 |             </DropdownMenuCheckboxItem>
92 |           ))}
93 |         </DropdownMenuContent>
94 |       </DropdownMenu>
95 |     </div>
96 |   );
97 | }
```

apps/dashboard/src/components/charts/spending.tsx
```
1 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
2 | import { Suspense } from "react";
3 | import { ErrorFallback } from "../error-fallback";
4 | import { SpendingList, SpendingListSkeleton } from "./spending-list";
5 | import { SpendingPeriod } from "./spending-period";
6 |
7 | export async function Spending({
8 |   disabled,
9 |   initialPeriod,
10 |   currency,
11 | }: {
12 |   disabled: boolean;
13 |   initialPeriod: any;
14 |   currency?: string;
15 | }) {
16 |   return (
17 |     <div className="border aspect-square relative overflow-hidden">
18 |       <div className="p-4 md:p-8 flex-col">
19 |         <SpendingPeriod initialPeriod={initialPeriod} />
20 |
21 |         <ErrorBoundary errorComponent={ErrorFallback}>
22 |           <Suspense fallback={<SpendingListSkeleton />} key={initialPeriod}>
23 |             <SpendingList
24 |               initialPeriod={initialPeriod}
25 |               disabled={disabled}
26 |               currency={currency}
27 |             />
28 |           </Suspense>
29 |         </ErrorBoundary>
30 |       </div>
31 |     </div>
32 |   );
33 | }
```

apps/dashboard/src/components/charts/stacked-bar-chart.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { formatAmount } from "@/utils/format";
6 | import { Icons } from "@midday/ui/icons";
7 | import { format } from "date-fns";
8 | import {
9 |   Bar,
10 |   CartesianGrid,
11 |   ComposedChart,
12 |   Line,
13 |   ResponsiveContainer,
14 |   Tooltip,
15 |   XAxis,
16 |   YAxis,
17 | } from "recharts";
18 |
19 | const ToolTipContent = ({ payload = [] }) => {
20 |   const t = useI18n();
21 |   const { locale } = useUserContext((state) => state.data);
22 |
23 |   const current = payload[0]?.payload;
24 |
25 |   if (!current) return null;
26 |
27 |   return (
28 |     <div className="w-[240px] border shadow-sm bg-background">
29 |       <div className="border-b-[1px] px-4 py-2 flex justify-between items-center">
30 |         <p className="text-sm">{t(`chart_type.${current.meta.type}`)}</p>
31 |       </div>
32 |
33 |       <div className="p-4">
34 |         <div className="flex justify-between mb-2">
35 |           <div className="flex items-center justify-center space-x-2">
36 |             <div className="w-[8px] h-[8px] rounded-full bg-[#C6C6C6] dark:bg-[#606060]" />
37 |             <p className="font-medium text-[13px]">
38 |               {formatAmount({
39 |                 maximumFractionDigits: 0,
40 |                 minimumFractionDigits: 0,
41 |                 currency: current.currency,
42 |                 amount: current.total,
43 |                 locale,
44 |               })}
45 |             </p>
46 |           </div>
47 |
48 |           <p className="text-xs text-[#606060] text-right">Total</p>
49 |         </div>
50 |
51 |         <div className="flex justify-between">
52 |           <div className="flex items-center justify-center space-x-2">
53 |             <Icons.DotRaster />
54 |             <p className="font-medium text-[13px]">
55 |               {formatAmount({
56 |                 amount: current.recurring,
57 |                 currency: current.currency,
58 |                 maximumFractionDigits: 0,
59 |                 minimumFractionDigits: 0,
60 |                 locale,
61 |               })}
62 |             </p>
63 |           </div>
64 |
65 |           <p className="text-xs text-[#606060] text-right">Recurring</p>
66 |         </div>
67 |       </div>
68 |     </div>
69 |   );
70 | };
71 |
72 | export function StackedBarChart({ data, height = 290 }) {
73 |   const formattedData = data.result.map((item) => ({
74 |     ...item,
75 |     value: item.value,
76 |     recurring: item.recurring,
77 |     total: item.total,
78 |     meta: data.meta,
79 |     date: format(new Date(item.date), "MMM"),
80 |   }));
81 |
82 |   return (
83 |     <div className="relative h-full w-full">
84 |       <div className="space-x-4 absolute right-0 -top-10 hidden md:flex">
85 |         <div className="flex space-x-2 items-center">
86 |           <span className="w-2 h-2 rounded-full bg-[#C6C6C6] dark:bg-[#606060]" />
87 |           <span className="text-sm text-[#606060]">Total expenses</span>
88 |         </div>
89 |         <div className="flex space-x-2 items-center">
90 |           <Icons.DotRaster />
91 |           <span className="text-sm text-[#606060]">Recurring</span>
92 |         </div>
93 |       </div>
94 |
95 |       <ResponsiveContainer width="100%" height={height}>
96 |         <ComposedChart data={formattedData} barGap={15}>
97 |           <defs>
98 |             <pattern
99 |               id="raster"
100 |               patternUnits="userSpaceOnUse"
101 |               width="64"
102 |               height="64"
103 |             >
104 |               <rect
105 |                 width="64"
106 |                 height="64"
107 |                 className="dark:fill-[#323232] fill-[#C6C6C6]"
108 |               />
109 |               <path
110 |                 d="M-106 110L22 -18"
111 |                 className="stroke-[#323232] dark:stroke-white"
112 |               />
113 |               <path
114 |                 d="M-98 110L30 -18"
115 |                 className="stroke-[#323232] dark:stroke-white"
116 |               />
117 |               <path
118 |                 d="M-90 110L38 -18"
119 |                 className="stroke-[#323232] dark:stroke-white"
120 |               />
121 |               <path
122 |                 d="M-82 110L46 -18"
123 |                 className="stroke-[#323232] dark:stroke-white"
124 |               />
125 |               <path
126 |                 d="M-74 110L54 -18"
127 |                 className="stroke-[#323232] dark:stroke-white"
128 |               />
129 |               <path
130 |                 d="M-66 110L62 -18"
131 |                 className="stroke-[#323232] dark:stroke-white"
132 |               />
133 |               <path
134 |                 d="M-58 110L70 -18"
135 |                 className="stroke-[#323232] dark:stroke-white"
136 |               />
137 |               <path
138 |                 d="M-50 110L78 -18"
139 |                 className="stroke-[#323232] dark:stroke-white"
140 |               />
141 |               <path
142 |                 d="M-42 110L86 -18"
143 |                 className="stroke-[#323232] dark:stroke-white"
144 |               />
145 |               <path
146 |                 d="M-34 110L94 -18"
147 |                 className="stroke-[#323232] dark:stroke-white"
148 |               />
[TRUNCATED]
```

apps/dashboard/src/components/charts/status.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 |
6 | type Props = {
7 |   value: string;
8 |   variant?: "positive" | "negative";
9 | };
10 |
11 | export function Status({ value, variant }: Props) {
12 |   return (
13 |     <div
14 |       className={cn(
15 |         "flex space-x-1 text-[#FF3638] items-center",
16 |         variant === "positive" && "text-[#00C969]"
17 |       )}
18 |     >
19 |       {variant === "positive" ? (
20 |         <Icons.TrendingUp size={14} />
21 |       ) : (
22 |         <Icons.TrendingDown size={14} />
23 |       )}
24 |
25 |       <p className="text-[12px] font-medium">{value}</p>
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/components/charts/transaction-list-item.tsx
```
1 | "use client";
2 |
3 | import type { UpdateTransactionValues } from "@/actions/schema";
4 | import { updateTransactionAction } from "@/actions/update-transaction-action";
5 | import { TransactionSheet } from "@/components/sheets/transaction-sheet";
6 | import { cn } from "@midday/ui/cn";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useState } from "react";
9 | import { FormatAmount } from "../format-amount";
10 | import { TransactionStatus } from "../transaction-status";
11 |
12 | type Props = {
13 |   transaction: any;
14 |   disabled?: boolean;
15 | };
16 |
17 | export function TransactionListItem({ transaction, disabled }: Props) {
18 |   const [isOpen, setOpen] = useState(false);
19 |   const updateTransaction = useAction(updateTransactionAction);
20 |
21 |   const handleUpdateTransaction = (values: UpdateTransactionValues) => {
22 |     updateTransaction.execute(values);
23 |   };
24 |
25 |   const fullfilled =
26 |     transaction?.status === "completed" || transaction?.attachments?.length > 0;
27 |
28 |   return (
29 |     <>
30 |       <div onClick={() => setOpen(true)} className="w-full">
31 |         <div className="flex items-center py-3">
32 |           <div className="w-[50%] flex space-x-2">
33 |             <span
34 |               className={cn(
35 |                 "text-sm line-clamp-1",
36 |                 disabled && "skeleton-box animate-none",
37 |                 transaction?.category?.slug === "income" && "text-[#00C969]",
38 |               )}
39 |             >
40 |               {transaction.name}
41 |             </span>
42 |           </div>
43 |           <div className="w-[35%]">
44 |             <span
45 |               className={cn(
46 |                 "text-sm line-clamp-1",
47 |                 disabled && "skeleton-box animate-none",
48 |                 transaction?.category?.slug === "income" && "text-[#00C969]",
49 |               )}
50 |             >
51 |               <FormatAmount
52 |                 amount={transaction.amount}
53 |                 currency={transaction.currency}
54 |               />
55 |             </span>
56 |           </div>
57 |
58 |           <div className="ml-auto">
59 |             <TransactionStatus fullfilled={fullfilled} />
60 |           </div>
61 |         </div>
62 |       </div>
63 |
64 |       <TransactionSheet
65 |         isOpen={isOpen}
66 |         setOpen={setOpen}
67 |         data={transaction}
68 |         updateTransaction={handleUpdateTransaction}
69 |       />
70 |     </>
71 |   );
72 | }
```

apps/dashboard/src/components/charts/transactions-item-list.tsx
```
1 | import { TransactionListItem } from "@/components/charts/transaction-list-item";
2 |
3 | export function TransactionsItemList({ transactions, disabled }) {
4 |   return (
5 |     <ul className="bullet-none divide-y cursor-pointer overflow-auto scrollbar-hide aspect-square pb-24">
6 |       {transactions?.map((transaction) => {
7 |         return (
8 |           <li key={transaction.id}>
9 |             <TransactionListItem
10 |               transaction={transaction}
11 |               disabled={disabled}
12 |             />
13 |           </li>
14 |         );
15 |       })}
16 |     </ul>
17 |   );
18 | }
```

apps/dashboard/src/components/charts/transactions-list.tsx
```
1 | import { getTransactions } from "@midday/supabase/cached-queries";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { transactionExampleData } from "./data";
4 | import { TransactionsItemList } from "./transactions-item-list";
5 |
6 | export function TransactionsListHeader() {
7 |   return (
8 |     <div className="flex py-3 border-b-[1px]">
9 |       <span className="font-medium text-sm w-[50%]">Description</span>
10 |       <span className="font-medium text-sm w-[35%]">Amount</span>
11 |       <span className="font-medium text-sm ml-auto">Status</span>
12 |     </div>
13 |   );
14 | }
15 |
16 | export function TransactionsListSkeleton() {
17 |   return (
18 |     <div className="divide-y">
19 |       {[...Array(6)].map((_, index) => (
20 |         <div
21 |           key={index.toString()}
22 |           className="flex justify-between px-3 items-center h-[49px]"
23 |         >
24 |           <div className="w-[60%]">
25 |             <Skeleton className="h-3 w-[50%]" />
26 |           </div>
27 |           <div className="w-[40%] ml-auto">
28 |             <Skeleton className="w-[60%] h-3 align-start" />
29 |           </div>
30 |         </div>
31 |       ))}
32 |     </div>
33 |   );
34 | }
35 |
36 | type Props = {
37 |   type: string;
38 |   disabled: boolean;
39 | };
40 |
41 | export async function TransactionsList({ type, disabled }: Props) {
42 |   const transactions = disabled
43 |     ? transactionExampleData
44 |     : await getTransactions({
45 |         to: 15,
46 |         from: 0,
47 |         filter: {
48 |           type,
49 |         },
50 |       });
51 |
52 |   if (!transactions?.data?.length) {
53 |     return (
54 |       <div className="flex items-center justify-center aspect-square">
55 |         <p className="text-sm text-[#606060] -mt-12">No transactions found</p>
56 |       </div>
57 |     );
58 |   }
59 |
60 |   return (
61 |     <TransactionsItemList
62 |       transactions={transactions?.data}
63 |       disabled={disabled}
64 |     />
65 |   );
66 | }
```

apps/dashboard/src/components/charts/transactions-period.tsx
```
1 | "use client";
2 |
3 | import { changeTransactionsPeriodAction } from "@/actions/change-transactions-period-action";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuCheckboxItem,
8 |   DropdownMenuContent,
9 |   DropdownMenuTrigger,
10 | } from "@midday/ui/dropdown-menu";
11 | import { Icons } from "@midday/ui/icons";
12 | import { useOptimisticAction } from "next-safe-action/hooks";
13 | import Link from "next/link";
14 |
15 | const options = ["all", "income", "expense"] as const;
16 | type TransactionType = (typeof options)[number];
17 |
18 | type Props = {
19 |   type: "all" | "income" | "expense";
20 |   disabled: boolean;
21 | };
22 |
23 | export function TransactionsPeriod({ type, disabled }: Props) {
24 |   const t = useI18n();
25 |   const { execute, optimisticState } = useOptimisticAction(
26 |     changeTransactionsPeriodAction,
27 |     {
28 |       currentState: type,
29 |       updateFn: (_, newState) => newState,
30 |     },
31 |   );
32 |
33 |   return (
34 |     <div className="flex justify-between">
35 |       <div>
36 |         <Link href="/transactions" prefetch>
37 |           <h2 className="text-lg">Transactions</h2>
38 |         </Link>
39 |       </div>
40 |
41 |       <DropdownMenu>
42 |         <DropdownMenuTrigger disabled={disabled}>
43 |           <div className="flex items-center space-x-2">
44 |             <span>{t(`transactions_period.${optimisticState}`)}</span>
45 |             <Icons.ChevronDown />
46 |           </div>
47 |         </DropdownMenuTrigger>
48 |         <DropdownMenuContent className="w-[130px]">
49 |           {options.map((option) => (
50 |             <DropdownMenuCheckboxItem
51 |               key={option}
52 |               onCheckedChange={() => execute(option as TransactionType)}
53 |               checked={option === optimisticState}
54 |             >
55 |               {t(`transactions_period.${option}`)}
56 |             </DropdownMenuCheckboxItem>
57 |           ))}
58 |         </DropdownMenuContent>
59 |       </DropdownMenu>
60 |     </div>
61 |   );
62 | }
```

apps/dashboard/src/components/charts/transactions.tsx
```
1 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
2 | import { cookies } from "next/headers";
3 | import { Suspense } from "react";
4 | import { ErrorFallback } from "../error-fallback";
5 | import {
6 |   TransactionsList,
7 |   TransactionsListHeader,
8 |   TransactionsListSkeleton,
9 | } from "./transactions-list";
10 | import { TransactionsPeriod } from "./transactions-period";
11 |
12 | export async function Transactions({ disabled }) {
13 |   const type = cookies().get("transactions-period")?.value ?? "all";
14 |
15 |   return (
16 |     <div className="border aspect-square overflow-hidden relative p-4 md:p-8">
17 |       <TransactionsPeriod type={type} disabled={disabled} />
18 |
19 |       <div className="mt-4">
20 |         <TransactionsListHeader />
21 |         <ErrorBoundary errorComponent={ErrorFallback}>
22 |           <Suspense key={type} fallback={<TransactionsListSkeleton />}>
23 |             <TransactionsList type={type} disabled={disabled} />
24 |           </Suspense>
25 |         </ErrorBoundary>
26 |       </div>
27 |     </div>
28 |   );
29 | }
```

apps/dashboard/src/components/chat/chat-avatar.tsx
```
1 | "use client";
2 |
3 | import type { AI } from "@/actions/ai/chat";
4 | import { Avatar, AvatarImageNext } from "@midday/ui/avatar";
5 | import { useAIState } from "ai/rsc";
6 |
7 | type Props = {
8 |   role: "assistant" | "user";
9 | };
10 | export function ChatAvatar({ role }: Props) {
11 |   const [aiState] = useAIState<typeof AI>();
12 |
13 |   switch (role) {
14 |     case "user": {
15 |       return (
16 |         <Avatar className="size-6">
17 |           <AvatarImageNext
18 |             src={aiState?.user?.avatar_url || ""}
19 |             alt={aiState?.user?.full_name ?? ""}
20 |             width={24}
21 |             height={24}
22 |           />
23 |         </Avatar>
24 |       );
25 |     }
26 |
27 |     default:
28 |       return (
29 |         <svg
30 |           xmlns="http://www.w3.org/2000/svg"
31 |           width={24}
32 |           height={24}
33 |           fill="none"
34 |         >
35 |           <path
36 |             fill="currentColor"
37 |             fillRule="evenodd"
38 |             d="M11.479 0a11.945 11.945 0 0 0-5.026 1.344l5.026 8.705V0Zm0 13.952-5.026 8.704A11.946 11.946 0 0 0 11.48 24V13.952ZM12.523 24V13.946l5.028 8.708A11.943 11.943 0 0 1 12.523 24Zm0-13.946V0c1.808.078 3.513.555 5.028 1.346l-5.028 8.708Zm-10.654 8.4 8.706-5.026-5.026 8.706a12.075 12.075 0 0 1-3.68-3.68ZM22.134 5.55l-8.706 5.026 5.027-8.706a12.075 12.075 0 0 1 3.679 3.68ZM1.868 5.547a12.075 12.075 0 0 1 3.68-3.68l5.028 8.708-8.708-5.028Zm-.523.904A11.945 11.945 0 0 0 0 11.479h10.054l-8.71-5.028Zm0 11.1A11.945 11.945 0 0 1 0 12.524h10.053L1.346 17.55Zm12.606-6.072H24a11.946 11.946 0 0 0-1.345-5.026l-8.705 5.026Zm8.705 6.07-8.704-5.025H24a11.945 11.945 0 0 1-1.344 5.025Zm-9.226-4.12 5.024 8.702a12.075 12.075 0 0 0 3.678-3.678l-8.702-5.025Z"
39 |             clipRule="evenodd"
40 |           />
41 |         </svg>
42 |       );
43 |   }
44 | }
```

apps/dashboard/src/components/chat/chat-empty.tsx
```
1 | import { Icons } from "@midday/ui/icons";
2 |
3 | type Props = {
4 |   firstName: string;
5 | };
6 |
7 | export function ChatEmpty({ firstName }: Props) {
8 |   return (
9 |     <div className="w-full mt-[200px] todesktop:mt-24 md:mt-24 flex flex-col items-center justify-center text-center">
10 |       <Icons.LogoSmall />
11 |       <span className="font-medium text-xl mt-6">
12 |         Hi {firstName}, how can I help <br />
13 |         you today?
14 |       </span>
15 |     </div>
16 |   );
17 | }
```

apps/dashboard/src/components/chat/chat-examples.tsx
```
1 | "use client";
2 |
3 | import { shuffle } from "@midday/utils";
4 | import { motion } from "framer-motion";
5 | import { useMemo, useRef } from "react";
6 | import { useDraggable } from "react-use-draggable-scroll";
7 | import { chatExamples } from "./examples";
8 |
9 | const listVariant = {
10 |   hidden: { y: 45, opacity: 0 },
11 |   show: {
12 |     y: 0,
13 |     opacity: 1,
14 |     transition: {
15 |       duration: 0.3,
16 |       staggerChildren: 0.08,
17 |     },
18 |   },
19 | };
20 |
21 | const itemVariant = {
22 |   hidden: { y: 45, opacity: 0 },
23 |   show: { y: 0, opacity: 1 },
24 | };
25 |
26 | export function ChatExamples({ onSubmit }) {
27 |   const items = useMemo(() => shuffle(chatExamples), []);
28 |   const ref = useRef();
29 |   const { events } = useDraggable(ref);
30 |
31 |   const totalLength = chatExamples.reduce((accumulator, currentString) => {
32 |     return accumulator + currentString.length * 8.2 + 20;
33 |   }, 0);
34 |
35 |   return (
36 |     <div
37 |       className="absolute z-10 bottom-[100px] left-0 right-0 overflow-scroll scrollbar-hide cursor-grabbing hidden md:block"
38 |       {...events}
39 |       ref={ref}
40 |     >
41 |       <motion.ul
42 |         variants={listVariant}
43 |         initial="hidden"
44 |         animate="show"
45 |         className="flex space-x-4 ml-4 items-center"
46 |         style={{ width: `${totalLength}px` }}
47 |       >
48 |         {items.map((example) => (
49 |           <button key={example} type="button" onClick={() => onSubmit(example)}>
50 |             <motion.li
51 |               variants={itemVariant}
52 |               className="font-mono text-[#878787] bg-[#F2F1EF] text-xs dark:bg-[#1D1D1D] px-3 py-2 rounded-full cursor-default"
53 |             >
54 |               {example}
55 |             </motion.li>
56 |           </button>
57 |         ))}
58 |       </motion.ul>
59 |     </div>
60 |   );
61 | }
```

apps/dashboard/src/components/chat/chat-footer.tsx
```
1 | import { useAssistantStore } from "@/store/assistant";
2 | import { Icons } from "@midday/ui/icons";
3 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
4 | import { app, platform } from "@todesktop/client-core";
5 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
6 | import { useRouter } from "next/navigation";
7 |
8 | type Props = {
9 |   onSubmit: () => void;
10 |   showFeedback: () => void;
11 | };
12 |
13 | export function ChatFooter({ onSubmit, showFeedback }: Props) {
14 |   const router = useRouter();
15 |   const { setOpen } = useAssistantStore();
16 |
17 |   const handleOpenUrl = (url: string) => {
18 |     if (isDesktopApp()) {
19 |       return platform.os.openURL(url);
20 |     }
21 |
22 |     router.push(url);
23 |   };
24 |
25 |   return (
26 |     <div className="hidden todesktop:flex md:flex px-3 h-[40px] w-full border-t-[1px] items-center bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#151515]/[99]">
27 |       <Popover>
28 |         <PopoverTrigger>
29 |           <div className="scale-50 opacity-50 -ml-2">
30 |             <Icons.LogoSmall />
31 |           </div>
32 |         </PopoverTrigger>
33 |
34 |         <PopoverContent
35 |           className="bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#1A1A1A]/95 p-2 rounded-lg -ml-2 w-auto"
36 |           side="top"
37 |           align="start"
38 |           sideOffset={10}
39 |         >
40 |           <ul className="flex flex-col space-y-2">
41 |             <li>
42 |               <button
43 |                 type="button"
44 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
45 |                 onClick={() => handleOpenUrl("https://x.com/middayai")}
46 |               >
47 |                 <Icons.X className="w-[16px] h-[16px]" />
48 |                 <span>Follow us</span>
49 |               </button>
50 |             </li>
51 |             <li>
52 |               <button
53 |                 type="button"
54 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
55 |                 onClick={() => handleOpenUrl("https://go.midday.ai/anPiuRx")}
56 |               >
57 |                 <Icons.Discord className="w-[16px] h-[16px]" />
58 |                 <span>Join Our Community</span>
59 |               </button>
60 |             </li>
61 |
62 |             <li>
63 |               <button
64 |                 type="button"
65 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
66 |                 onClick={showFeedback}
67 |               >
68 |                 <Icons.ChatBubble className="w-[16px] h-[16px]" />
69 |                 <span>Send feedback</span>
70 |               </button>
71 |             </li>
72 |
73 |             <li>
74 |               <button
75 |                 type="button"
76 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
77 |                 onClick={() => handleOpenUrl("https://git.new/midday")}
78 |               >
79 |                 <Icons.GithubOutline className="w-[16px] h-[16px]" />
80 |                 <span>Github</span>
81 |               </button>
82 |             </li>
83 |
84 |             <li>
85 |               <button
86 |                 type="button"
87 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
88 |                 onClick={() => {
89 |                   router.push("/account/assistant");
90 |                   setOpen();
91 |                 }}
92 |               >
93 |                 <Icons.Settings className="w-[16px] h-[16px]" />
94 |                 <span>Settings</span>
95 |               </button>
96 |             </li>
97 |
98 |             <li className="hidden todesktop:block">
99 |               <button
100 |                 type="button"
101 |                 className="flex space-x-2 items-center text-xs hover:bg-[#F2F1EF] dark:hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1 text-destructive"
102 |                 onClick={() => app.quit()}
103 |               >
104 |                 <Icons.ExitToApp className="w-[16px] h-[16px]" />
105 |                 <span>Quit Midday</span>
106 |               </button>
107 |             </li>
108 |           </ul>
109 |         </PopoverContent>
110 |       </Popover>
111 |
112 |       <div className="ml-auto flex space-x-4">
113 |         <button
114 |           className="flex space-x-2 items-center text-xs"
115 |           type="button"
116 |           onClick={onSubmit}
117 |         >
118 |           <span>Submit</span>
119 |           <kbd className="pointer-events-none h-5 select-none items-center gap-1 border bg-accent px-1.5 font-mono text-[10px] font-medium">
120 |             <span>↵</span>
121 |           </kbd>
122 |         </button>
123 |       </div>
124 |     </div>
125 |   );
126 | }
```

apps/dashboard/src/components/chat/chat-list.tsx
```
1 | "use client";
2 |
3 | import type { ClientMessage } from "@/actions/ai/types";
4 | import { cn } from "@midday/ui/cn";
5 |
6 | type Props = {
7 |   messages: ClientMessage[];
8 |   className?: string;
9 | };
10 |
11 | export function ChatList({ messages, className }: Props) {
12 |   if (!messages.length) {
13 |     return null;
14 |   }
15 |
16 |   return (
17 |     <div className={cn("flex flex-col select-text", className)}>
18 |       {messages
19 |         .filter((tool) => tool.display !== undefined)
20 |         .map((message, index) => (
21 |           <div key={message.id}>
22 |             {message.display}
23 |             {index < messages.length - 1 && <div className="my-6" />}
24 |           </div>
25 |         ))}
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/components/chat/examples.ts
```
1 | export const chatExamples = [
2 |   `What's my burn rate`,
3 |   `What's my runway`,
4 |   "Show transactions without receipts",
5 |   "What is my spending on Software",
6 |   "Find a receipt or invoice",
7 |   "Find a transaction",
8 |   `What's my profit for last year`,
9 |   `What's my revenue`,
10 |   "Create a report",
11 |   "Forecast profit",
12 |   "Forecast revenue",
13 |   "Find a document",
14 |   "Recurring transactions",
15 |   "Top expenses this month",
16 | ];
```

apps/dashboard/src/components/chat/index.tsx
```
1 | "use client";
2 |
3 | import type { ClientMessage } from "@/actions/ai/types";
4 | import { useEnterSubmit } from "@/hooks/use-enter-submit";
5 | import { useScrollAnchor } from "@/hooks/use-scroll-anchor";
6 | import { useAssistantStore } from "@/store/assistant";
7 | import { ScrollArea } from "@midday/ui/scroll-area";
8 | import { Textarea } from "@midday/ui/textarea";
9 | import { useActions } from "ai/rsc";
10 | import { nanoid } from "nanoid";
11 | import { useEffect, useRef } from "react";
12 | import { ChatEmpty } from "./chat-empty";
13 | import { ChatExamples } from "./chat-examples";
14 | import { ChatFooter } from "./chat-footer";
15 | import { ChatList } from "./chat-list";
16 | import { UserMessage } from "./messages";
17 |
18 | export function Chat({
19 |   messages,
20 |   submitMessage,
21 |   user,
22 |   onNewChat,
23 |   input,
24 |   setInput,
25 |   showFeedback,
26 | }) {
27 |   const { submitUserMessage } = useActions();
28 |   const { formRef, onKeyDown } = useEnterSubmit();
29 |   const ref = useRef(false);
30 |   const inputRef = useRef<HTMLTextAreaElement>(null);
31 |
32 |   const { message } = useAssistantStore();
33 |
34 |   const onSubmit = async (input: string) => {
35 |     const value = input.trim();
36 |
37 |     if (value.length === 0) {
38 |       return null;
39 |     }
40 |
41 |     setInput("");
42 |     scrollToBottom();
43 |
44 |     submitMessage((message: ClientMessage[]) => [
45 |       ...message,
46 |       {
47 |         id: nanoid(),
48 |         role: "user",
49 |         display: <UserMessage>{value}</UserMessage>,
50 |       },
51 |     ]);
52 |
53 |     const responseMessage = await submitUserMessage(value);
54 |
55 |     submitMessage((messages: ClientMessage[]) => [
56 |       ...messages,
57 |       responseMessage,
58 |     ]);
59 |   };
60 |
61 |   useEffect(() => {
62 |     if (!ref.current && message) {
63 |       onNewChat();
64 |       onSubmit(message);
65 |       ref.current = true;
66 |     }
67 |   }, []);
68 |
69 |   useEffect(() => {
70 |     requestAnimationFrame(() => {
71 |       inputRef?.current.focus();
72 |     });
73 |   }, [messages]);
74 |
75 |   const { messagesRef, scrollRef, visibilityRef, scrollToBottom } =
76 |     useScrollAnchor();
77 |
78 |   const showExamples = messages.length === 0 && !input;
79 |
80 |   return (
81 |     <div className="relative">
82 |       <ScrollArea className="todesktop:h-[335px] md:h-[335px]" ref={scrollRef}>
83 |         <div ref={messagesRef}>
84 |           {messages.length ? (
85 |             <ChatList messages={messages} className="p-4 pb-8" />
86 |           ) : (
87 |             <ChatEmpty firstName={user?.full_name.split(" ").at(0)} />
88 |           )}
89 |
90 |           <div className="w-full h-px" ref={visibilityRef} />
91 |         </div>
92 |       </ScrollArea>
93 |
94 |       <div className="fixed bottom-[1px] left-[1px] right-[1px] todesktop:h-[88px] md:h-[88px] bg-background border-border border-t-[1px]">
95 |         {showExamples && <ChatExamples onSubmit={onSubmit} />}
96 |
97 |         <form
98 |           ref={formRef}
99 |           onSubmit={(evt) => {
100 |             evt.preventDefault();
101 |             onSubmit(input);
102 |           }}
103 |         >
104 |           <Textarea
105 |             ref={inputRef}
106 |             tabIndex={0}
107 |             rows={1}
108 |             spellCheck={false}
109 |             autoComplete="off"
110 |             autoCorrect="off"
111 |             value={input}
112 |             className="h-12 min-h-12 pt-3 resize-none border-none"
113 |             placeholder="Ask Midday a question..."
114 |             onKeyDown={onKeyDown}
115 |             onChange={(evt) => {
116 |               setInput(evt.target.value);
117 |             }}
118 |           />
119 |         </form>
120 |
121 |         <ChatFooter
122 |           onSubmit={() => onSubmit(input)}
123 |           showFeedback={showFeedback}
124 |         />
125 |       </div>
126 |     </div>
127 |   );
128 | }
```

apps/dashboard/src/components/chat/messages.tsx
```
1 | "use client";
2 |
3 | import { useStreamableText } from "@/hooks/use-streamable-text";
4 | import { cn } from "@midday/ui/cn";
5 | import type { StreamableValue } from "ai/rsc";
6 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
7 | import { ErrorFallback } from "../error-fallback";
8 | import { MemoizedReactMarkdown } from "../markdown";
9 | import { ChatAvatar } from "./chat-avatar";
10 | import { spinner } from "./spinner";
11 |
12 | export function UserMessage({ children }: { children: React.ReactNode }) {
13 |   return (
14 |     <div className="group relative flex items-start">
15 |       <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
16 |         <ChatAvatar role="user" />
17 |       </div>
18 |
19 |       <div className="ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed">
20 |         {children}
21 |       </div>
22 |     </div>
23 |   );
24 | }
25 |
26 | export function SpinnerMessage() {
27 |   return (
28 |     <div className="group relative flex items-start">
29 |       <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
30 |         <ChatAvatar role="assistant" />
31 |       </div>
32 |
33 |       <div className="ml-4 flex-1 space-y-2 overflow-hidden pl-2">
34 |         {spinner}
35 |       </div>
36 |     </div>
37 |   );
38 | }
39 |
40 | export function BotMessage({
41 |   content,
42 | }: {
43 |   content: string | StreamableValue<string>;
44 | }) {
45 |   const text = useStreamableText(content);
46 |
47 |   return (
48 |     <ErrorBoundary errorComponent={ErrorFallback}>
49 |       <div className="group relative flex items-start">
50 |         <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
51 |           <ChatAvatar role="assistant" />
52 |         </div>
53 |
54 |         <div className="ml-4 flex-1 overflow-hidden pl-2 text-xs font-mono">
55 |           <MemoizedReactMarkdown
56 |             className="prose break-words dark:prose-invert leading-relaxed prose-pre:p-0 mb-2 last:mb-0 text-xs font-mono"
57 |             components={{
58 |               p({ children }) {
59 |                 return children;
60 |               },
61 |               ol({ children }) {
62 |                 return <ol>{children}</ol>;
63 |               },
64 |               ul({ children }) {
65 |                 return <ul>{children}</ul>;
66 |               },
67 |             }}
68 |           >
69 |             {text}
70 |           </MemoizedReactMarkdown>
71 |         </div>
72 |       </div>
73 |     </ErrorBoundary>
74 |   );
75 | }
76 |
77 | export function BotCard({
78 |   children,
79 |   showAvatar = true,
80 |   className,
81 | }: {
82 |   children?: React.ReactNode;
83 |   showAvatar?: boolean;
84 |   className?: string;
85 | }) {
86 |   return (
87 |     <ErrorBoundary errorComponent={ErrorFallback}>
88 |       <div className="group relative flex items-start">
89 |         <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
90 |           {showAvatar && <ChatAvatar role="assistant" />}
91 |         </div>
92 |
93 |         <div
94 |           className={cn(
95 |             "ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed",
96 |             className,
97 |           )}
98 |         >
99 |           {children}
100 |         </div>
101 |       </div>
102 |     </ErrorBoundary>
103 |   );
104 | }
```

apps/dashboard/src/components/chat/spinner.tsx
```
1 | "use client";
2 |
3 | export const spinner = (
4 |   <svg
5 |     fill="none"
6 |     stroke="currentColor"
7 |     strokeWidth="1.5"
8 |     viewBox="0 0 24 24"
9 |     strokeLinecap="round"
10 |     strokeLinejoin="round"
11 |     xmlns="http://www.w3.org/2000/svg"
12 |     className="size-5 animate-spin stroke-zinc-400"
13 |   >
14 |     <path d="M12 3v3m6.366-.366-2.12 2.12M21 12h-3m.366 6.366-2.12-2.12M12 21v-3m-6.366.366 2.12-2.12M3 12h3m-.366-6.366 2.12 2.12" />
15 |   </svg>
16 | );
```

apps/dashboard/src/components/forms/create-team-form.tsx
```
1 | "use client";
2 |
3 | import { createTeamAction } from "@/actions/create-team-action";
4 | import { createTeamSchema } from "@/actions/schema";
5 | import { zodResolver } from "@hookform/resolvers/zod";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   Form,
9 |   FormControl,
10 |   FormField,
11 |   FormItem,
12 |   FormMessage,
13 | } from "@midday/ui/form";
14 | import { Input } from "@midday/ui/input";
15 | import { Loader2 } from "lucide-react";
16 | import { useAction } from "next-safe-action/hooks";
17 | import { useForm } from "react-hook-form";
18 | import type { z } from "zod";
19 |
20 | export function CreateTeamForm() {
21 |   const createTeam = useAction(createTeamAction);
22 |
23 |   const form = useForm<z.infer<typeof createTeamSchema>>({
24 |     resolver: zodResolver(createTeamSchema),
25 |     defaultValues: {
26 |       name: "",
27 |     },
28 |   });
29 |
30 |   function onSubmit(values: z.infer<typeof createTeamSchema>) {
31 |     createTeam.execute({ name: values.name, redirectTo: "/teams/invite" });
32 |   }
33 |
34 |   return (
35 |     <Form {...form}>
36 |       <form onSubmit={form.handleSubmit(onSubmit)}>
37 |         <FormField
38 |           control={form.control}
39 |           name="name"
40 |           render={({ field }) => (
41 |             <FormItem>
42 |               <FormControl>
43 |                 <Input
44 |                   autoFocus
45 |                   className="mt-3"
46 |                   placeholder="Ex: Acme Marketing or Acme Co"
47 |                   autoComplete="off"
48 |                   autoCapitalize="none"
49 |                   autoCorrect="off"
50 |                   spellCheck="false"
51 |                   {...field}
52 |                 />
53 |               </FormControl>
54 |
55 |               <FormMessage />
56 |             </FormItem>
57 |           )}
58 |         />
59 |
60 |         <Button
61 |           className="mt-6 w-full"
62 |           type="submit"
63 |           disabled={createTeam.status === "executing"}
64 |         >
65 |           {createTeam.status === "executing" ? (
66 |             <Loader2 className="h-4 w-4 animate-spin" />
67 |           ) : (
68 |             "Next"
69 |           )}
70 |         </Button>
71 |       </form>
72 |     </Form>
73 |   );
74 | }
```

apps/dashboard/src/components/forms/create-transaction-form.tsx
```
1 | import { findMatchingCategory } from "@/actions/ai/find-matching-category";
2 | import { createTransactionAction } from "@/actions/create-transaction-action";
3 | import { createTransactionSchema } from "@/actions/schema";
4 | import { AssignUser } from "@/components/assign-user";
5 | import { Attachments } from "@/components/attachments";
6 | import { SelectAccount } from "@/components/select-account";
7 | import { SelectCategory } from "@/components/select-category";
8 | import { SelectCurrency } from "@/components/select-currency";
9 | import { zodResolver } from "@hookform/resolvers/zod";
10 | import { uniqueCurrencies } from "@midday/location/currencies";
11 | import {
12 |   Accordion,
13 |   AccordionContent,
14 |   AccordionItem,
15 |   AccordionTrigger,
16 | } from "@midday/ui/accordion";
17 | import { Button } from "@midday/ui/button";
18 | import { Calendar } from "@midday/ui/calendar";
19 | import { CurrencyInput } from "@midday/ui/currency-input";
20 | import {
21 |   Form,
22 |   FormControl,
23 |   FormField,
24 |   FormItem,
25 |   FormLabel,
26 |   FormMessage,
27 | } from "@midday/ui/form";
28 | import { Input } from "@midday/ui/input";
29 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
30 | import { Select } from "@midday/ui/select";
31 | import { SubmitButton } from "@midday/ui/submit-button";
32 | import { Textarea } from "@midday/ui/textarea";
33 | import { useToast } from "@midday/ui/use-toast";
34 | import { readStreamableValue } from "ai/rsc";
35 | import { format } from "date-fns";
36 | import { useAction } from "next-safe-action/hooks";
37 | import { useLayoutEffect, useState } from "react";
38 | import { useForm } from "react-hook-form";
39 | import type { z } from "zod";
40 |
41 | export function CreateTransactionForm({
42 |   categories,
43 |   userId,
44 |   accountId,
45 |   currency,
46 |   onCreate,
47 | }: {
48 |   currency: string;
49 |   categories: any;
50 |   userId: string;
51 |   accountId: string;
52 |   onCreate: () => void;
53 | }) {
54 |   const { toast } = useToast();
55 |   const [isOpen, setIsOpen] = useState(false);
56 |
57 |   const createTransaction = useAction(createTransactionAction, {
58 |     onSuccess: () => {
59 |       onCreate();
60 |
61 |       toast({
62 |         title: "Transaction created",
63 |         description: "Transaction created successfully",
64 |         variant: "success",
65 |       });
66 |     },
67 |   });
68 |
69 |   const form = useForm<z.infer<typeof createTransactionSchema>>({
70 |     resolver: zodResolver(createTransactionSchema),
71 |     defaultValues: {
72 |       name: undefined,
73 |       category_slug: undefined,
74 |       date: new Date().toISOString(),
75 |       bank_account_id: accountId,
76 |       assigned_id: userId,
77 |       note: undefined,
78 |       currency,
79 |       attachments: undefined,
80 |     },
81 |   });
82 |
83 |   const category = form.watch("category_slug");
84 |   const attachments = form.watch("attachments");
85 |
86 |   const handleOnBlur = async (e: React.FocusEvent<HTMLInputElement>) => {
87 |     const prompt = e.target.value;
88 |
89 |     if (!category && prompt.length > 5) {
90 |       const { object } = await findMatchingCategory(
91 |         prompt,
92 |         categories?.map((category) => category.name),
93 |       );
94 |
95 |       let finalObject = {};
96 |
97 |       for await (const partialObject of readStreamableValue(object)) {
98 |         if (partialObject) {
99 |           finalObject = {
100 |             category: categories?.find(
101 |               (category) => category.name === partialObject?.category,
102 |             ),
103 |           };
104 |         }
105 |       }
106 |
107 |       if (finalObject?.category?.slug) {
108 |         form.setValue("category_slug", finalObject.category.slug, {
109 |           shouldValidate: true,
110 |         });
111 |       }
112 |     }
113 |   };
114 |
115 |   useLayoutEffect(() => {
116 |     // This is a workaround to ensure that the form is rendered before we try to set the focus
117 |     setTimeout(() => {
118 |       form.setFocus("name");
119 |     }, 10);
120 |   }, [form.setFocus]);
121 |
122 |   return (
123 |     <Form {...form}>
124 |       <form
125 |         onSubmit={form.handleSubmit(createTransaction.execute)}
126 |         className="space-y-8"
127 |       >
128 |         <FormField
129 |           control={form.control}
130 |           name="name"
131 |           render={({ field }) => (
132 |             <FormItem>
133 |               <FormLabel>Description</FormLabel>
134 |               <FormControl>
135 |                 <Input
136 |                   {...field}
137 |                   onBlur={handleOnBlur}
138 |                   autoComplete="off"
139 |                   autoCapitalize="none"
140 |                   autoCorrect="off"
141 |                   spellCheck="false"
142 |                 />
143 |               </FormControl>
144 |
145 |               <FormMessage />
146 |             </FormItem>
147 |           )}
148 |         />
149 |
150 |         <div className="flex space-x-4 mt-4">
151 |           <FormField
152 |             control={form.control}
153 |             name="amount"
154 |             render={({ field }) => (
155 |               <FormItem className="w-full">
156 |                 <FormLabel>Amount</FormLabel>
157 |                 <FormControl>
158 |                   <CurrencyInput
159 |                     value={field.value}
160 |                     onValueChange={(values) => {
161 |                       field.onChange(values.floatValue);
162 |
163 |                       if (values.floatValue && values.floatValue > 0) {
164 |                         form.setValue("category_slug", "income");
165 |                       }
166 |
167 |                       if (
168 |                         category === "income" &&
169 |                         values.floatValue !== undefined &&
170 |                         values.floatValue < 0
171 |                       ) {
172 |                         form.setValue("category_slug", undefined);
173 |                       }
[TRUNCATED]
```

apps/dashboard/src/components/forms/customer-form.tsx
```
1 | "use client";
2 |
3 | import { createCustomerAction } from "@/actions/create-customer-action";
4 | import { createCustomerTagAction } from "@/actions/customer/create-customer-tag-action";
5 | import { deleteCustomerTagAction } from "@/actions/customer/delete-customer-tag-action";
6 | import { useCustomerParams } from "@/hooks/use-customer-params";
7 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
8 | import { zodResolver } from "@hookform/resolvers/zod";
9 | import {
10 |   Accordion,
11 |   AccordionContent,
12 |   AccordionItem,
13 |   AccordionTrigger,
14 | } from "@midday/ui/accordion";
15 | import { Button } from "@midday/ui/button";
16 | import {
17 |   Form,
18 |   FormControl,
19 |   FormDescription,
20 |   FormField,
21 |   FormItem,
22 |   FormLabel,
23 |   FormMessage,
24 | } from "@midday/ui/form";
25 | import { Input } from "@midday/ui/input";
26 | import { Label } from "@midday/ui/label";
27 | import { SubmitButton } from "@midday/ui/submit-button";
28 | import { Textarea } from "@midday/ui/textarea";
29 | import { useAction } from "next-safe-action/hooks";
30 | import { useEffect, useState } from "react";
31 | import { useForm } from "react-hook-form";
32 | import { z } from "zod";
33 | import { CountrySelector } from "../country-selector";
34 | import type { Customer } from "../invoice/customer-details";
35 | import {
36 |   type AddressDetails,
37 |   SearchAddressInput,
38 | } from "../search-address-input";
39 | import { SelectTags } from "../select-tags";
40 | import { VatNumberInput } from "../vat-number-input";
41 |
42 | const formSchema = z.object({
43 |   id: z.string().uuid().optional(),
44 |   name: z.string().min(1, {
45 |     message: "Name must be at least 1 characters.",
46 |   }),
47 |   email: z.string().email({
48 |     message: "Email is not valid.",
49 |   }),
50 |   phone: z.string().nullable().optional(),
51 |   website: z
52 |     .string()
53 |     .nullable()
54 |     .optional()
55 |     .transform((url) => url?.replace(/^https?:\/\//, "")),
56 |   contact: z.string().nullable().optional(),
57 |   address_line_1: z.string().nullable().optional(),
58 |   address_line_2: z.string().nullable().optional(),
59 |   city: z.string().nullable().optional(),
60 |   state: z.string().nullable().optional(),
61 |   country: z.string().nullable().optional(),
62 |   country_code: z.string().nullable().optional(),
63 |   zip: z.string().nullable().optional(),
64 |   vat_number: z.string().nullable().optional(),
65 |   note: z.string().nullable().optional(),
66 |   tags: z
67 |     .array(
68 |       z.object({
69 |         id: z.string().uuid(),
70 |         value: z.string(),
71 |       }),
72 |     )
73 |     .optional()
74 |     .nullable(),
75 | });
76 |
77 | const excludedDomains = [
78 |   "gmail.com",
79 |   "yahoo.com",
80 |   "hotmail.com",
81 |   "outlook.com",
82 |   "google.com",
83 |   "aol.com",
84 |   "msn.com",
85 |   "icloud.com",
86 |   "me.com",
87 |   "mac.com",
88 |   "live.com",
89 |   "hotmail.co.uk",
90 |   "hotmail.com.au",
91 |   "hotmail.com.br",
92 | ];
93 |
94 | type Props = {
95 |   data?: Customer;
96 | };
97 |
98 | export function CustomerForm({ data }: Props) {
99 |   const [sections, setSections] = useState<string[]>(["general"]);
100 |   const { setParams: setCustomerParams, name } = useCustomerParams();
101 |   const { setParams: setInvoiceParams } = useInvoiceParams();
102 |
103 |   const deleteCustomerTag = useAction(deleteCustomerTagAction);
104 |   const createCustomerTag = useAction(createCustomerTagAction);
105 |
106 |   const isEdit = !!data;
107 |
108 |   const createCustomer = useAction(createCustomerAction, {
109 |     onSuccess: ({ data }) => {
110 |       if (data) {
111 |         setInvoiceParams({ selectedCustomerId: data.id });
112 |         setCustomerParams(null);
113 |       }
114 |     },
115 |   });
116 |
117 |   const form = useForm<z.infer<typeof formSchema>>({
118 |     resolver: zodResolver(formSchema),
119 |     defaultValues: {
120 |       id: undefined,
121 |       name: name ?? undefined,
122 |       email: undefined,
123 |       website: undefined,
124 |       address_line_1: undefined,
125 |       address_line_2: undefined,
126 |       city: undefined,
127 |       state: undefined,
128 |       country: undefined,
129 |       zip: undefined,
130 |       vat_number: undefined,
131 |       note: undefined,
132 |       phone: undefined,
133 |       contact: undefined,
134 |       tags: undefined,
135 |     },
136 |   });
137 |
138 |   useEffect(() => {
139 |     if (data) {
140 |       setSections(["general", "details"]);
141 |       form.reset({
142 |         ...data,
143 |         tags:
144 |           data.tags?.map((tag) => ({
145 |             id: tag.tag?.id ?? "",
146 |             value: tag.tag?.name ?? "",
147 |             label: tag.tag?.name ?? "",
148 |           })) ?? undefined,
149 |       });
150 |     }
151 |   }, [data]);
152 |
153 |   const onSelectAddress = (address: AddressDetails) => {
154 |     form.setValue("address_line_1", address.address_line_1);
155 |     form.setValue("city", address.city);
156 |     form.setValue("state", address.state);
157 |     form.setValue("country", address.country);
158 |     form.setValue("country_code", address.country_code);
159 |     form.setValue("zip", address.zip);
160 |   };
161 |
162 |   const handleEmailBlur = (e: React.FocusEvent<HTMLInputElement>) => {
163 |     const email = e.target.value.trim();
[TRUNCATED]
```

apps/dashboard/src/components/forms/invite-form.tsx
```
1 | "use client";
2 |
3 | import { inviteTeamMembersAction } from "@/actions/invite-team-members-action";
4 | import {
5 |   type InviteTeamMembersFormValues,
6 |   inviteTeamMembersSchema,
7 | } from "@/actions/schema";
8 | import { zodResolver } from "@hookform/resolvers/zod";
9 | import { Button } from "@midday/ui/button";
10 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
11 | import { Input } from "@midday/ui/input";
12 | import {
13 |   Select,
14 |   SelectContent,
15 |   SelectItem,
16 |   SelectTrigger,
17 |   SelectValue,
18 | } from "@midday/ui/select";
19 | import { useToast } from "@midday/ui/use-toast";
20 | import { Loader2 } from "lucide-react";
21 | import { useAction } from "next-safe-action/hooks";
22 | import Link from "next/link";
23 | import { useFieldArray, useForm } from "react-hook-form";
24 |
25 | export function InviteForm() {
26 |   const { toast } = useToast();
27 |
28 |   const inviteMembers = useAction(inviteTeamMembersAction, {
29 |     onError: () => {
30 |       toast({
31 |         duration: 3500,
32 |         variant: "error",
33 |         title: "Something went wrong please try again.",
34 |       });
35 |     },
36 |   });
37 |
38 |   const form = useForm<InviteTeamMembersFormValues>({
39 |     resolver: zodResolver(inviteTeamMembersSchema),
40 |     defaultValues: {
41 |       invites: [
42 |         {
43 |           email: "",
44 |           role: "member",
45 |         },
46 |       ],
47 |     },
48 |   });
49 |
50 |   const onSubmit = form.handleSubmit((data) => {
51 |     inviteMembers.execute({
52 |       // Remove invites without email (last appended invite validation)
53 |       invites: data.invites.filter((invite) => invite.email !== undefined),
54 |       redirectTo: "/",
55 |     });
56 |   });
57 |
58 |   const { fields, append } = useFieldArray({
59 |     name: "invites",
60 |     control: form.control,
61 |   });
62 |
63 |   return (
64 |     <Form {...form}>
65 |       <form onSubmit={form.handleSubmit(onSubmit)}>
66 |         {fields.map((field, index) => (
67 |           <div
68 |             className="flex items-center justify-between mt-3 space-x-4"
69 |             key={index.toString()}
70 |           >
71 |             <FormField
72 |               control={form.control}
73 |               key={field.id}
74 |               name={`invites.${index}.email`}
75 |               render={({ field }) => (
76 |                 <FormItem className="flex-1">
77 |                   <FormControl>
78 |                     <Input
79 |                       placeholder="jane@example.com"
80 |                       type="email"
81 |                       autoComplete="off"
82 |                       autoCapitalize="none"
83 |                       autoCorrect="off"
84 |                       spellCheck="false"
85 |                       {...field}
86 |                     />
87 |                   </FormControl>
88 |                 </FormItem>
89 |               )}
90 |             />
91 |
92 |             <FormField
93 |               control={form.control}
94 |               name={`invites.${index}.role`}
95 |               render={({ field }) => (
96 |                 <FormItem>
97 |                   <Select
98 |                     onValueChange={field.onChange}
99 |                     defaultValue={field.value}
100 |                   >
101 |                     <FormControl>
102 |                       <SelectTrigger className="min-w-[120px]">
103 |                         <SelectValue placeholder="Select role" />
104 |                       </SelectTrigger>
105 |                     </FormControl>
106 |                     <SelectContent>
107 |                       <SelectItem value="owner">Owner</SelectItem>
108 |                       <SelectItem value="member">Member</SelectItem>
109 |                     </SelectContent>
110 |                   </Select>
111 |                 </FormItem>
112 |               )}
113 |             />
114 |           </div>
115 |         ))}
116 |
117 |         <Button
118 |           variant="outline"
119 |           type="button"
120 |           className="mt-4 border-none bg-[#F2F1EF] text-[11px] dark:bg-[#1D1D1D]"
121 |           onClick={() => append({ email: undefined, role: "member" })}
122 |         >
123 |           Add more
124 |         </Button>
125 |
126 |         <div className="border-t-[1px] pt-4 mt-8 items-center justify-between">
127 |           <div>
128 |             {Object.values(form.formState.errors).length > 0 && (
129 |               <span className="text-sm text-destructive">
130 |                 Please complete the fields above.
131 |               </span>
132 |             )}
133 |           </div>
134 |
135 |           <div className="flex items-center justify-between">
136 |             <Link href="/">
137 |               <Button
138 |                 variant="ghost"
139 |                 className="p-0 hover:bg-transparent font-normal"
140 |               >
141 |                 Skip this step
142 |               </Button>
143 |             </Link>
144 |
145 |             <Button
146 |               type="submit"
147 |               disabled={inviteMembers.status === "executing"}
148 |             >
149 |               {inviteMembers.status === "executing" ? (
150 |                 <Loader2 className="h-4 w-4 animate-spin" />
151 |               ) : (
152 |                 "Send invites"
153 |               )}
154 |             </Button>
155 |           </div>
156 |         </div>
157 |       </form>
158 |     </Form>
159 |   );
160 | }
```

apps/dashboard/src/components/forms/tracker-project-form.tsx
```
1 | "use client";
2 |
3 | import { createProjectTagAction } from "@/actions/project/create-project-tag-action";
4 | import { deleteProjectTagAction } from "@/actions/project/delete-project-tag-action";
5 | import type { Customer } from "@/components/invoice/customer-details";
6 | import { uniqueCurrencies } from "@midday/location/currencies";
7 | import { Button } from "@midday/ui/button";
8 | import { Collapsible, CollapsibleContent } from "@midday/ui/collapsible";
9 | import { CurrencyInput } from "@midday/ui/currency-input";
10 | import {
11 |   Form,
12 |   FormControl,
13 |   FormDescription,
14 |   FormField,
15 |   FormItem,
16 |   FormLabel,
17 |   FormMessage,
18 | } from "@midday/ui/form";
19 | import { Input } from "@midday/ui/input";
20 | import { Label } from "@midday/ui/label";
21 | import {
22 |   Select,
23 |   SelectContent,
24 |   SelectItem,
25 |   SelectTrigger,
26 |   SelectValue,
27 | } from "@midday/ui/select";
28 | import { Switch } from "@midday/ui/switch";
29 | import { Textarea } from "@midday/ui/textarea";
30 | import { Loader2 } from "lucide-react";
31 | import { useAction } from "next-safe-action/hooks";
32 | import { useEffect, useState } from "react";
33 | import { SearchCustomer } from "../search-customer";
34 | import { SelectTags } from "../select-tags";
35 |
36 | type Props = {
37 |   onSubmit: (data: any) => void;
38 |   isSaving: boolean;
39 |   form: any;
40 |   customers: Customer[];
41 | };
42 |
43 | export function TrackerProjectForm({
44 |   onSubmit,
45 |   isSaving,
46 |   form,
47 |   customers,
48 | }: Props) {
49 |   const [isOpen, setIsOpen] = useState(false);
50 |
51 |   const deleteProjectTag = useAction(deleteProjectTagAction);
52 |   const createProjectTag = useAction(createProjectTagAction);
53 |
54 |   const isEdit = form.getValues("id") !== undefined;
55 |
56 |   useEffect(() => {
57 |     setIsOpen(Boolean(form.getValues("billable")));
58 |   }, [form.getValues()]);
59 |
60 |   return (
61 |     <Form {...form}>
62 |       <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
63 |         <FormField
64 |           control={form.control}
65 |           name="name"
66 |           render={({ field }) => (
67 |             <FormItem>
68 |               <FormLabel>Name</FormLabel>
69 |               <FormControl>
70 |                 <Input
71 |                   {...field}
72 |                   autoComplete="off"
73 |                   autoCapitalize="none"
74 |                   autoCorrect="off"
75 |                   spellCheck="false"
76 |                 />
77 |               </FormControl>
78 |               <FormDescription>
79 |                 This is the project display name.
80 |               </FormDescription>
81 |               <FormMessage />
82 |             </FormItem>
83 |           )}
84 |         />
85 |
86 |         <FormField
87 |           control={form.control}
88 |           name="customer_id"
89 |           render={({ field }) => (
90 |             <FormItem>
91 |               <FormLabel>Customer</FormLabel>
92 |               <FormControl>
93 |                 <SearchCustomer
94 |                   data={customers}
95 |                   onSelect={(id) => field.onChange(id)}
96 |                   selectedId={field.value}
97 |                 />
98 |               </FormControl>
99 |               <FormDescription>
100 |                 Link a customer to enable direct invoicing.
101 |               </FormDescription>
102 |               <FormMessage />
103 |             </FormItem>
104 |           )}
105 |         />
106 |
107 |         <div className="mt-6">
108 |           <Label htmlFor="tags" className="mb-2 block">
109 |             Expense Tags
110 |           </Label>
111 |
112 |           <SelectTags
113 |             tags={form.getValues("tags")}
114 |             onRemove={(tag) => {
115 |               deleteProjectTag.execute({
116 |                 tagId: tag.id,
117 |                 projectId: form.getValues("id"),
118 |               });
119 |             }}
120 |             // Only for create projects
121 |             onCreate={(tag) => {
122 |               if (!isEdit) {
123 |                 form.setValue(
124 |                   "tags",
125 |                   [
126 |                     ...(form.getValues("tags") ?? []),
127 |                     { id: tag.id, value: tag.name },
128 |                   ],
129 |                   {
130 |                     shouldDirty: true,
131 |                     shouldValidate: true,
132 |                   },
133 |                 );
134 |               }
135 |             }}
136 |             // Only for edit projects
137 |             onSelect={(tag) => {
138 |               if (isEdit) {
139 |                 createProjectTag.execute({
140 |                   tagId: tag.id,
141 |                   projectId: form.getValues("id"),
142 |                 });
143 |               }
144 |             }}
145 |           />
146 |
147 |           <FormDescription className="mt-2">
148 |             Tags help categorize and track project expenses.
149 |           </FormDescription>
150 |         </div>
151 |
152 |         <FormField
153 |           control={form.control}
154 |           name="description"
155 |           render={({ field }) => (
156 |             <FormItem>
157 |               <FormLabel>Description</FormLabel>
158 |               <FormControl>
159 |                 <Textarea className="resize-none" {...field} />
160 |               </FormControl>
161 |               <FormDescription>
162 |                 Add a short description about the project.
163 |               </FormDescription>
164 |               <FormMessage />
165 |             </FormItem>
166 |           )}
167 |         />
168 |
169 |         <div className="flex space-x-4 mt-4">
170 |           <FormField
171 |             control={form.control}
172 |             name="estimate"
173 |             render={({ field }) => (
174 |               <FormItem>
175 |                 <FormLabel>Time Estimate</FormLabel>
176 |                 <FormControl>
177 |                   <Input
178 |                     placeholder="0"
179 |                     {...field}
180 |                     type="number"
181 |                     min={0}
182 |                     onChange={(evt) => field.onChange(+evt.target.value)}
183 |                     autoComplete="off"
184 |                     autoCapitalize="none"
[TRUNCATED]
```

apps/dashboard/src/components/forms/tracker-record-form.tsx
```
1 | import { useTrackerParams } from "@/hooks/use-tracker-params";
2 | import { NEW_EVENT_ID } from "@/utils/tracker";
3 | import { zodResolver } from "@hookform/resolvers/zod";
4 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
5 | import { Input } from "@midday/ui/input";
6 | import { SubmitButton } from "@midday/ui/submit-button";
7 | import { TimeRangeInput } from "@midday/ui/time-range-input";
8 | import { differenceInSeconds, parse } from "date-fns";
9 | import { useEffect } from "react";
10 | import { useForm } from "react-hook-form";
11 | import { z } from "zod";
12 | import { AssignUser } from "../assign-user";
13 | import { TrackerSelectProject } from "../tracker-select-project";
14 |
15 | const formSchema = z.object({
16 |   id: z.string().optional(),
17 |   duration: z.number().min(1),
18 |   project_id: z.string(),
19 |   assigned_id: z.string().optional(),
20 |   description: z.string().optional(),
21 |   start: z.string(),
22 |   end: z.string(),
23 | });
24 |
25 | type Props = {
26 |   eventId?: string;
27 |   userId: string;
28 |   teamId: string;
29 |   onCreate: (values: z.infer<typeof formSchema>) => void;
30 |   projectId?: string | null;
31 |   start?: string;
32 |   end?: string;
33 |   onSelectProject: (selected: { id: string; name: string }) => void;
34 |   description?: string;
35 |   isSaving: boolean;
36 | };
37 |
38 | export function TrackerRecordForm({
39 |   eventId,
40 |   userId,
41 |   teamId,
42 |   onCreate,
43 |   projectId,
44 |   start,
45 |   end,
46 |   onSelectProject,
47 |   description,
48 |   isSaving,
49 | }: Props) {
50 |   const { projectId: selectedProjectId } = useTrackerParams();
51 |
52 |   const isUpdate = eventId && eventId !== NEW_EVENT_ID;
53 |
54 |   const form = useForm<z.infer<typeof formSchema>>({
55 |     resolver: zodResolver(formSchema),
56 |     defaultValues: {
57 |       id: eventId,
58 |       assigned_id: userId,
59 |       project_id: selectedProjectId ?? undefined,
60 |       start,
61 |       end,
62 |       description: description ?? undefined,
63 |     },
64 |   });
65 |
66 |   useEffect(() => {
67 |     if (eventId && eventId !== NEW_EVENT_ID) {
68 |       form.setValue("id", eventId, { shouldValidate: true });
69 |     }
70 |
71 |     if (eventId === NEW_EVENT_ID) {
72 |       form.setValue("id", undefined);
73 |     }
74 |
75 |     if (start) {
76 |       form.setValue("start", start);
77 |     }
78 |     if (end) {
79 |       form.setValue("end", end);
80 |     }
81 |
82 |     if (projectId) {
83 |       form.setValue("project_id", projectId, { shouldValidate: true });
84 |     }
85 |
86 |     if (description) {
87 |       form.setValue("description", description);
88 |     }
89 |
90 |     if (start && end) {
91 |       const startDate = parse(start, "HH:mm", new Date());
92 |       const endDate = parse(end, "HH:mm", new Date());
93 |
94 |       const durationInSeconds = differenceInSeconds(endDate, startDate);
95 |
96 |       if (durationInSeconds) {
97 |         form.setValue("duration", durationInSeconds, { shouldValidate: true });
98 |       }
99 |     }
100 |   }, [start, end, projectId, description, eventId]);
101 |
102 |   return (
103 |     <Form {...form}>
104 |       <form
105 |         onSubmit={form.handleSubmit(onCreate)}
106 |         className="mb-12 mt-6 space-y-4"
107 |       >
108 |         <TimeRangeInput
109 |           value={{ start: form.watch("start"), end: form.watch("end") }}
110 |           onChange={(value) => {
111 |             form.setValue("start", value.start);
112 |             form.setValue("end", value.end);
113 |           }}
114 |         />
115 |
116 |         <FormField
117 |           control={form.control}
118 |           name="project_id"
119 |           render={({ field }) => (
120 |             <FormItem className="w-full">
121 |               <FormControl>
122 |                 <TrackerSelectProject
123 |                   onCreate={(project) => {
124 |                     if (project) {
125 |                       field.onChange(project.id);
126 |                       onSelectProject(project);
127 |                     }
128 |                   }}
129 |                   teamId={teamId}
130 |                   selectedId={field.value}
131 |                   onSelect={(selected) => {
132 |                     if (selected) {
133 |                       field.onChange(selected.id);
134 |                       onSelectProject(selected);
135 |                     }
136 |                   }}
137 |                 />
138 |               </FormControl>
139 |             </FormItem>
140 |           )}
141 |         />
142 |
143 |         <FormField
144 |           control={form.control}
145 |           name="assigned_id"
146 |           render={({ field }) => (
147 |             <FormItem className="w-full">
148 |               <FormControl>
149 |                 <AssignUser
150 |                   selectedId={form.watch("assigned_id")}
151 |                   onSelect={(assignedId: string) => {
152 |                     if (assignedId) {
153 |                       field.onChange(assignedId);
154 |                     }
155 |                   }}
156 |                 />
157 |               </FormControl>
158 |             </FormItem>
159 |           )}
160 |         />
161 |
162 |         <FormField
163 |           control={form.control}
164 |           name="description"
165 |           render={({ field }) => (
166 |             <FormItem>
167 |               <FormControl>
168 |                 <Input placeholder="Description" {...field} />
169 |               </FormControl>
170 |             </FormItem>
171 |           )}
172 |         />
173 |
174 |         <div className="flex mt-6 justify-between">
175 |           <SubmitButton
176 |             className="w-full"
177 |             disabled={isSaving || !form.formState.isValid}
178 |             isSubmitting={isSaving}
[TRUNCATED]
```

apps/dashboard/src/components/forms/update-record-form.tsx
```
1 | import { secondsToHoursAndMinutes } from "@/utils/format";
2 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
3 | import { Button } from "@midday/ui/button";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 |
6 | export function RecordSkeleton() {
7 |   return (
8 |     <div className="mb-4">
9 |       <div className="flex items-center">
10 |         <div className="flex space-x-2 items-center">
11 |           <Skeleton className="h-8 w-8 rounded-full" />
12 |           <div className="text-sm flex flex-col space-y-1">
13 |             <Skeleton className="h-3 w-[160px]" />
14 |             <Skeleton className="h-3 w-8" />
15 |           </div>
16 |         </div>
17 |         <span className="ml-auto">
18 |           <Skeleton className="h-3 w-8" />
19 |         </span>
20 |       </div>
21 |     </div>
22 |   );
23 | }
24 |
25 | export function UpdateRecordForm({
26 |   id,
27 |   assigned,
28 |   duration,
29 |   onDelete,
30 |   description,
31 | }) {
32 |   return (
33 |     <div className="mb-4 group">
34 |       <div className="flex items-center">
35 |         <div className="flex space-x-2 items-center">
36 |           <Avatar className="h-8 w-8">
37 |             <AvatarImageNext
38 |               src={assigned.avatar_url}
39 |               alt={assigned?.full_name ?? ""}
40 |               width={32}
41 |               height={32}
42 |             />
43 |             <AvatarFallback>
44 |               <span className="text-xs">
45 |                 {assigned?.full_name?.charAt(0)?.toUpperCase()}
46 |               </span>
47 |             </AvatarFallback>
48 |           </Avatar>
49 |           <div className="text-sm flex flex-col">
50 |             <span>{assigned.full_name}</span>
51 |             <span className="text-muted-foreground">{description}</span>
52 |           </div>
53 |         </div>
54 |         <span className="ml-auto group-hover:hidden">
55 |           {secondsToHoursAndMinutes(duration)}
56 |         </span>
57 |         <Button
58 |           variant="outline"
59 |           className="ml-auto hidden group-hover:block text-xs h-7 p-0 px-2"
60 |           onClick={() => onDelete(id)}
61 |         >
62 |           Remove
63 |         </Button>
64 |       </div>
65 |     </div>
66 |   );
67 | }
```

apps/dashboard/src/components/invoice/amount-input.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { CurrencyInput } from "@midday/ui/currency-input";
3 | import { useState } from "react";
4 | import { useController, useFormContext } from "react-hook-form";
5 | import type { NumericFormatProps } from "react-number-format";
6 |
7 | export function AmountInput({
8 |   className,
9 |   name,
10 |   ...props
11 | }: Omit<NumericFormatProps, "value" | "onChange"> & {
12 |   name: string;
13 | }) {
14 |   const [isFocused, setIsFocused] = useState(false);
15 |   const { control } = useFormContext();
16 |   const {
17 |     field: { value, onChange, onBlur },
18 |   } = useController({
19 |     name,
20 |     control,
21 |   });
22 |
23 |   const isPlaceholder = !value && !isFocused;
24 |
25 |   return (
26 |     <div className="relative font-mono">
27 |       <CurrencyInput
28 |         autoComplete="off"
29 |         value={value}
30 |         onValueChange={(values) => {
31 |           onChange(values.floatValue, { shouldValidate: true });
32 |         }}
33 |         onFocus={() => setIsFocused(true)}
34 |         onBlur={() => {
35 |           setIsFocused(false);
36 |           onBlur();
37 |         }}
38 |         {...props}
39 |         className={cn(
40 |           className,
41 |           isPlaceholder && "opacity-0",
42 |           "p-0 border-0 h-6 text-xs !bg-transparent border-b border-transparent focus:border-border",
43 |         )}
44 |         thousandSeparator={true}
45 |       />
46 |
47 |       {isPlaceholder && (
48 |         <div className="absolute inset-0 pointer-events-none">
49 |           <div className="h-full w-full bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]" />
50 |         </div>
51 |       )}
52 |     </div>
53 |   );
54 | }
```

apps/dashboard/src/components/invoice/customer-details.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { Editor } from "@/components/invoice/editor";
5 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
6 | import type { JSONContent } from "@tiptap/react";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useEffect } from "react";
9 | import { Controller, useFormContext } from "react-hook-form";
10 | import { SelectCustomer } from "../select-customer";
11 | import { LabelInput } from "./label-input";
12 | import { transformCustomerToContent } from "./utils";
13 |
14 | export interface Customer {
15 |   id: string;
16 |   name: string;
17 |   email: string;
18 |   phone?: string;
19 |   address_line_1?: string;
20 |   address_line_2?: string;
21 |   token: string;
22 |   city?: string;
23 |   state?: string;
24 |   zip?: string;
25 |   country?: string;
26 |   vat?: string;
27 |   contact?: string;
28 |   website?: string;
29 |   tags?: { tag: { id: string; name: string } }[];
30 | }
31 |
32 | interface CustomerDetailsProps {
33 |   customers: Customer[];
34 | }
35 |
36 | export function CustomerDetails({ customers }: CustomerDetailsProps) {
37 |   const { control, setValue, watch } = useFormContext();
38 |   const { setParams, selectedCustomerId } = useInvoiceParams();
39 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
40 |
41 |   const content = watch("customer_details");
42 |   const id = watch("id");
43 |
44 |   const handleLabelSave = (value: string) => {
45 |     updateInvoiceTemplate.execute({ customer_label: value });
46 |   };
47 |
48 |   const handleOnChange = (content?: JSONContent | null) => {
49 |     // Reset the selected customer id when the content is changed
50 |     setParams({ selectedCustomerId: null });
51 |
52 |     setValue("customer_details", content, {
53 |       shouldValidate: true,
54 |       shouldDirty: true,
55 |     });
56 |
57 |     if (!content) {
58 |       setValue("customer_name", null, { shouldValidate: true });
59 |       setValue("customer_id", null, { shouldValidate: true });
60 |     }
61 |   };
62 |
63 |   useEffect(() => {
64 |     const customer = customers.find((c) => c.id === selectedCustomerId);
65 |
66 |     if (customer) {
67 |       const customerContent = transformCustomerToContent(customer);
68 |
69 |       // Remove the selected customer id from the url so we don't introduce a race condition
70 |       setParams({ selectedCustomerId: null });
71 |
72 |       setValue("customer_name", customer.name, { shouldValidate: true });
73 |       setValue("customer_id", customer.id, { shouldValidate: true });
74 |       setValue("customer_details", customerContent, {
75 |         shouldValidate: true,
76 |         shouldDirty: true,
77 |       });
78 |     }
79 |   }, [selectedCustomerId, customers]);
80 |
81 |   return (
82 |     <div>
83 |       <LabelInput
84 |         name="template.customer_label"
85 |         className="mb-2 block"
86 |         onSave={handleLabelSave}
87 |       />
88 |       {content ? (
89 |         <Controller
90 |           name="customer_details"
91 |           control={control}
92 |           render={({ field }) => (
93 |             <Editor
94 |               // NOTE: This is a workaround to get the new content to render
95 |               key={id}
96 |               initialContent={field.value}
97 |               onChange={handleOnChange}
98 |               className="min-h-[90px]"
99 |             />
100 |           )}
101 |         />
102 |       ) : (
103 |         <SelectCustomer data={customers} />
104 |       )}
105 |     </div>
106 |   );
107 | }
```

apps/dashboard/src/components/invoice/description.tsx
```
1 | "use client";
2 |
3 | import { isValidJSON } from "@midday/invoice/content";
4 | import { cn } from "@midday/ui/cn";
5 | import type { JSONContent } from "@tiptap/react";
6 | import { useFormContext } from "react-hook-form";
7 | import { Editor } from "./editor";
8 |
9 | export function Description({
10 |   className,
11 |   name,
12 |   ...props
13 | }: React.ComponentProps<typeof Editor> & { name: string }) {
14 |   const { watch, setValue } = useFormContext();
15 |   const fieldValue = watch(name);
16 |
17 |   const handleOnChange = (content?: JSONContent | null) => {
18 |     const value = content ? JSON.stringify(content) : null;
19 |
20 |     setValue(name, value, {
21 |       shouldValidate: true,
22 |       shouldDirty: true,
23 |     });
24 |   };
25 |
26 |   return (
27 |     <div className="relative">
28 |       <Editor
29 |         key={name}
30 |         initialContent={
31 |           isValidJSON(fieldValue) ? JSON.parse(fieldValue) : fieldValue
32 |         }
33 |         onChange={handleOnChange}
34 |         className={cn(
35 |           "border-0 p-0 min-h-6 border-b border-transparent focus:border-border font-mono text-xs pt-1",
36 |           "transition-colors duration-200",
37 |           className,
38 |         )}
39 |         {...props}
40 |       />
41 |     </div>
42 |   );
43 | }
```

apps/dashboard/src/components/invoice/due-date.tsx
```
1 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
2 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
3 | import { TZDate } from "@date-fns/tz";
4 | import { Calendar } from "@midday/ui/calendar";
5 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
6 | import { format } from "date-fns";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useState } from "react";
9 | import { useFormContext } from "react-hook-form";
10 | import { LabelInput } from "./label-input";
11 |
12 | export function DueDate() {
13 |   const { setValue, watch } = useFormContext<InvoiceFormValues>();
14 |   const dueDate = watch("due_date");
15 |   const dateFormat = watch("template.date_format");
16 |
17 |   const [isOpen, setIsOpen] = useState(false);
18 |
19 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
20 |
21 |   const handleSelect = (date: Date | undefined) => {
22 |     if (date) {
23 |       setValue("due_date", date, { shouldValidate: true, shouldDirty: true });
24 |       setIsOpen(false);
25 |     }
26 |   };
27 |
28 |   return (
29 |     <div className="flex space-x-1 items-center">
30 |       <div className="flex items-center">
31 |         <LabelInput
32 |           name="template.due_date_label"
33 |           onSave={(value) => {
34 |             updateInvoiceTemplate.execute({
35 |               due_date_label: value,
36 |             });
37 |           }}
38 |         />
39 |         <span className="text-[11px] text-[#878787] font-mono">:</span>
40 |       </div>
41 |       <Popover open={isOpen} onOpenChange={setIsOpen} modal>
42 |         <PopoverTrigger className="text-primary text-[11px] font-mono whitespace-nowrap flex">
43 |           {dueDate && format(dueDate, dateFormat)}
44 |         </PopoverTrigger>
45 |         <PopoverContent className="w-auto p-0">
46 |           <Calendar
47 |             mode="single"
48 |             selected={dueDate ? new TZDate(dueDate, "UTC") : undefined}
49 |             onSelect={handleSelect}
50 |             initialFocus
51 |           />
52 |         </PopoverContent>
53 |       </Popover>
54 |     </div>
55 |   );
56 | }
```

apps/dashboard/src/components/invoice/edit-block.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
4 | import { cn } from "@midday/ui/cn";
5 | import { Controller, useFormContext } from "react-hook-form";
6 | import { Editor } from "./editor";
7 |
8 | type Props = {
9 |   name: keyof InvoiceFormValues;
10 | };
11 |
12 | export function EditBlock({ name }: Props) {
13 |   const { control, watch } = useFormContext();
14 |   const id = watch("id");
15 |
16 |   return (
17 |     <div className="group">
18 |       <Controller
19 |         name={name}
20 |         control={control}
21 |         render={({ field }) => (
22 |           <Editor
23 |             // NOTE: This is a workaround to get the new content to render
24 |             key={id}
25 |             tabIndex={-1}
26 |             initialContent={field.value}
27 |             onChange={field.onChange}
28 |             placeholder="Write something..."
29 |             disablePlaceholder
30 |             className={cn(
31 |               "transition-opacity",
32 |               field.value ? "opacity-100" : "opacity-0 group-hover:opacity-100",
33 |             )}
34 |           />
35 |         )}
36 |       />
37 |     </div>
38 |   );
39 | }
```

apps/dashboard/src/components/invoice/editor.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Editor as BaseEditor } from "@midday/ui/editor";
5 | import type { Editor as EditorInstance, JSONContent } from "@tiptap/react";
6 | import { useCallback, useState } from "react";
7 |
8 | type Props = {
9 |   initialContent?: JSONContent;
10 |   className?: string;
11 |   onChange?: (content?: JSONContent | null) => void;
12 |   onBlur?: (content: JSONContent | null) => void;
13 |   placeholder?: string;
14 |   disablePlaceholder?: boolean;
15 |   tabIndex?: number;
16 | };
17 |
18 | export function Editor({
19 |   initialContent,
20 |   className,
21 |   onChange,
22 |   onBlur,
23 |   placeholder,
24 |   disablePlaceholder = false,
25 |   tabIndex,
26 | }: Props) {
27 |   const [isFocused, setIsFocused] = useState(false);
28 |   const [content, setContent] = useState<JSONContent | null | undefined>(
29 |     initialContent,
30 |   );
31 |
32 |   const handleUpdate = useCallback(
33 |     (editor: EditorInstance) => {
34 |       const json = editor.getJSON();
35 |       const newIsEmpty = editor.state.doc.textContent.length === 0;
36 |
37 |       setContent(newIsEmpty ? null : json);
38 |       onChange?.(newIsEmpty ? null : json);
39 |     },
40 |     [onChange],
41 |   );
42 |
43 |   const handleBlur = useCallback(() => {
44 |     setIsFocused(false);
45 |
46 |     // Only call onBlur if the content has changed
47 |     if (content !== initialContent) {
48 |       onBlur?.(content ?? null);
49 |     }
50 |     onBlur?.(content ?? null);
51 |   }, [content, onBlur]);
52 |
53 |   const showPlaceholder = !disablePlaceholder && !content && !isFocused;
54 |
55 |   return (
56 |     <BaseEditor
57 |       className={cn(
58 |         "font-mono text-[11px] text-primary leading-[18px] invoice-editor",
59 |         showPlaceholder &&
60 |           "w-full bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]",
61 |         className,
62 |       )}
63 |       placeholder={placeholder}
64 |       initialContent={content ?? undefined}
65 |       onUpdate={handleUpdate}
66 |       onFocus={() => setIsFocused(true)}
67 |       onBlur={handleBlur}
68 |       tabIndex={tabIndex}
69 |     />
70 |   );
71 | }
```

apps/dashboard/src/components/invoice/form-context.tsx
```
1 | "use client";
2 |
3 | import {
4 |   type InvoiceFormValues,
5 |   type InvoiceTemplate,
6 |   invoiceFormSchema,
7 | } from "@/actions/invoice/schema";
8 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
9 | import { UTCDate } from "@date-fns/utc";
10 | import { zodResolver } from "@hookform/resolvers/zod";
11 | import type { Settings } from "@midday/invoice/default";
12 | import { createClient } from "@midday/supabase/client";
13 | import { getDraftInvoiceQuery } from "@midday/supabase/queries";
14 | import { addMonths } from "date-fns";
15 | import { useEffect, useState } from "react";
16 | import { FormProvider, useForm } from "react-hook-form";
17 | import { v4 as uuidv4 } from "uuid";
18 |
19 | const defaultTemplate: InvoiceTemplate = {
20 |   title: "Invoice",
21 |   customer_label: "To",
22 |   from_label: "From",
23 |   invoice_no_label: "Invoice No",
24 |   issue_date_label: "Issue Date",
25 |   due_date_label: "Due Date",
26 |   description_label: "Description",
27 |   price_label: "Price",
28 |   quantity_label: "Quantity",
29 |   total_label: "Total",
30 |   total_summary_label: "Total",
31 |   subtotal_label: "Subtotal",
32 |   vat_label: "VAT",
33 |   tax_label: "Tax",
34 |   payment_label: "Payment Details",
35 |   payment_details: undefined,
36 |   note_label: "Note",
37 |   logo_url: undefined,
38 |   currency: "USD",
39 |   from_details: undefined,
40 |   size: "a4",
41 |   include_vat: true,
42 |   include_tax: true,
43 |   discount_label: "Discount",
44 |   include_discount: false,
45 |   include_units: false,
46 |   include_decimals: false,
47 |   include_qr: true,
48 |   date_format: "dd/MM/yyyy",
49 |   tax_rate: 0,
50 |   vat_rate: 0,
51 |   delivery_type: "create",
52 |   timezone: undefined,
53 | };
54 |
55 | type FormContextProps = {
56 |   id?: string | null;
57 |   children: React.ReactNode;
58 |   template: InvoiceTemplate;
59 |   invoiceNumber: string;
60 |   defaultSettings: Settings;
61 |   isOpen: boolean;
62 | };
63 |
64 | export function FormContext({
65 |   id,
66 |   children,
67 |   template,
68 |   defaultSettings,
69 |   isOpen,
70 |   invoiceNumber,
71 | }: FormContextProps) {
72 |   const supabase = createClient();
73 |   const { lineItems, currency } = useInvoiceParams();
74 |   const [isLoading, setLoading] = useState(false);
75 |
76 |   const defaultValues = {
77 |     id: uuidv4(),
78 |     template: {
79 |       ...defaultTemplate,
80 |       size: defaultSettings.size ?? defaultTemplate.size,
81 |       include_tax: defaultSettings.include_tax ?? defaultTemplate.include_tax,
82 |       include_vat: defaultSettings.include_vat ?? defaultTemplate.include_vat,
83 |       locale: defaultSettings.locale,
84 |       // Use user timezone
85 |       timezone: defaultSettings.timezone,
86 |       ...template,
87 |     },
88 |     customer_details: undefined,
89 |     from_details: template.from_details ?? defaultTemplate.from_details,
90 |     payment_details:
91 |       template.payment_details ?? defaultTemplate.payment_details,
92 |     note_details: undefined,
93 |     customer_id: undefined,
94 |     issue_date: new UTCDate(),
95 |     due_date: addMonths(new UTCDate(), 1),
96 |     invoice_number: invoiceNumber,
97 |     line_items: [{ name: "", quantity: 0, price: 0, vat: 0 }],
98 |     tax: undefined,
99 |     token: undefined,
100 |     discount: undefined,
101 |     subtotal: undefined,
102 |     status: "draft",
103 |     top_block: undefined,
104 |     bottom_block: undefined,
105 |   };
106 |
107 |   const form = useForm<InvoiceFormValues>({
108 |     resolver: zodResolver(invoiceFormSchema),
109 |     defaultValues,
110 |     mode: "onChange",
111 |   });
112 |
113 |   useEffect(() => {
114 |     if (!isOpen) {
115 |       form.reset(defaultValues);
116 |     }
117 |   }, [isOpen]);
118 |
119 |   useEffect(() => {
120 |     async function fetchInvoice() {
121 |       const { data } = await getDraftInvoiceQuery(supabase, id);
122 |
123 |       if (data) {
124 |         form.reset({
125 |           ...data,
126 |           template: {
127 |             ...defaultValues.template,
128 |             ...data.template,
129 |           },
130 |         });
131 |       }
132 |
133 |       setLoading(false);
134 |     }
135 |
136 |     if (id) {
137 |       setLoading(true);
138 |       fetchInvoice();
139 |     }
140 |   }, [id, isOpen]);
141 |
142 |   // These values comes from the tracker table
143 |   useEffect(() => {
144 |     if (lineItems) {
145 |       form.setValue("line_items", lineItems);
146 |     }
147 |   }, [lineItems]);
148 |
149 |   useEffect(() => {
150 |     if (currency) {
151 |       form.setValue("template.currency", currency);
152 |     }
153 |   }, [currency]);
154 |
155 |   if (isLoading) {
156 |     return null;
157 |   }
158 |
159 |   return <FormProvider {...form}>{children}</FormProvider>;
160 | }
```

apps/dashboard/src/components/invoice/form.tsx
```
1 | import { draftInvoiceAction } from "@/actions/invoice/draft-invoice-action";
2 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
3 | import { formatRelativeTime } from "@/utils/format";
4 | import { Icons } from "@midday/ui/icons";
5 | import { ScrollArea } from "@midday/ui/scroll-area";
6 | import { useDebounce } from "@uidotdev/usehooks";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useEffect, useState } from "react";
9 | import { useFormContext, useWatch } from "react-hook-form";
10 | import { OpenURL } from "../open-url";
11 | import { type Customer, CustomerDetails } from "./customer-details";
12 | import { EditBlock } from "./edit-block";
13 | import { FromDetails } from "./from-details";
14 | import { LineItems } from "./line-items";
15 | import { Logo } from "./logo";
16 | import { Meta } from "./meta";
17 | import { NoteDetails } from "./note-details";
18 | import { PaymentDetails } from "./payment-details";
19 | import { SubmitButton } from "./submit-button";
20 | import { Summary } from "./summary";
21 | import { transformFormValuesToDraft } from "./utils";
22 |
23 | type Props = {
24 |   teamId: string;
25 |   customers: Customer[];
26 |   updatedAt?: Date;
27 |   onSubmit: (values: InvoiceFormValues) => void;
28 |   isSubmitting: boolean;
29 | };
30 |
31 | export function Form({ teamId, customers, onSubmit, isSubmitting }: Props) {
32 |   const [lastUpdated, setLastUpdated] = useState<Date | undefined>();
33 |   const [lastEditedText, setLastEditedText] = useState("");
34 |
35 |   const form = useFormContext<InvoiceFormValues>();
36 |
37 |   const token = form.watch("token");
38 |
39 |   const draftInvoice = useAction(draftInvoiceAction, {
40 |     onSuccess: ({ data }) => {
41 |       setLastUpdated(new Date());
42 |       form.setValue("token", data?.token, { shouldValidate: true });
43 |     },
44 |   });
45 |
46 |   // Only watch the fields that are used in the upsert action
47 |   const formValues = useWatch({
48 |     control: form.control,
49 |     name: [
50 |       "customer_details",
51 |       "customer_id",
52 |       "customer_name",
53 |       "template",
54 |       "line_items",
55 |       "amount",
56 |       "vat",
57 |       "tax",
58 |       "due_date",
59 |       "issue_date",
60 |       "note_details",
61 |       "payment_details",
62 |       "from_details",
63 |       "invoice_number",
64 |       "top_block",
65 |       "bottom_block",
66 |     ],
67 |   });
68 |
69 |   const isDirty = form.formState.isDirty;
70 |   const invoiceNumberValid = !form.getFieldState("invoice_number").error;
71 |   const debouncedValues = useDebounce(formValues, 500);
72 |
73 |   useEffect(() => {
74 |     const currentFormValues = form.getValues();
75 |
76 |     // Only draft the invoice if the customer is selected and the invoice number is valid
77 |     if (isDirty && form.watch("customer_id") && invoiceNumberValid) {
78 |       draftInvoice.execute(transformFormValuesToDraft(currentFormValues));
79 |     }
80 |   }, [debouncedValues, isDirty, invoiceNumberValid]);
81 |
82 |   useEffect(() => {
83 |     const updateLastEditedText = () => {
84 |       if (!lastUpdated) {
85 |         setLastEditedText("");
86 |         return;
87 |       }
88 |
89 |       setLastEditedText(`Edited ${formatRelativeTime(lastUpdated)}`);
90 |     };
91 |
92 |     updateLastEditedText();
93 |     const intervalId = setInterval(updateLastEditedText, 1000);
94 |
95 |     return () => clearInterval(intervalId);
96 |   }, [lastUpdated]);
97 |
98 |   // Submit the form and the draft invoice
99 |   const handleSubmit = (values: InvoiceFormValues) => {
100 |     onSubmit(values);
101 |
102 |     draftInvoice.execute(transformFormValuesToDraft(values));
103 |   };
104 |
105 |   // Prevent form from submitting when pressing enter
106 |   const handleKeyDown = (e: React.KeyboardEvent<HTMLFormElement>) => {
107 |     if (e.key === "Enter") {
108 |       e.preventDefault();
109 |     }
110 |   };
111 |
112 |   return (
113 |     <form
114 |       onSubmit={form.handleSubmit(handleSubmit)}
115 |       className="relative h-full"
116 |       onKeyDown={handleKeyDown}
117 |     >
118 |       <ScrollArea className="h-[calc(100vh-200px)] bg-background" hideScrollbar>
119 |         <div className="p-8 pb-4 h-full flex flex-col">
120 |           <div className="flex justify-between">
121 |             <Meta teamId={teamId} />
122 |             <Logo teamId={teamId} />
123 |           </div>
124 |
125 |           <div className="grid grid-cols-2 gap-6 mt-8 mb-4">
126 |             <div>
127 |               <FromDetails />
128 |             </div>
129 |             <div>
130 |               <CustomerDetails customers={customers} />
131 |             </div>
132 |           </div>
133 |
134 |           <EditBlock name="top_block" />
135 |
136 |           <div className="mt-4">
137 |             <LineItems />
138 |           </div>
139 |
140 |           <div className="mt-12 flex justify-end mb-8">
141 |             <Summary />
142 |           </div>
143 |
144 |           <div className="flex flex-col mt-auto">
145 |             <div className="grid grid-cols-2 gap-6 mb-4 overflow-hidden">
146 |               <PaymentDetails />
147 |               <NoteDetails />
148 |             </div>
149 |
150 |             <EditBlock name="bottom_block" />
151 |           </div>
152 |         </div>
153 |       </ScrollArea>
154 |
155 |       <div className="absolute bottom-14 w-full h-9">
[TRUNCATED]
```

apps/dashboard/src/components/invoice/from-details.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { Editor } from "@/components/invoice/editor";
5 | import { useAction } from "next-safe-action/hooks";
6 | import { Controller, useFormContext } from "react-hook-form";
7 | import { LabelInput } from "./label-input";
8 |
9 | export function FromDetails() {
10 |   const { control, watch } = useFormContext();
11 |   const id = watch("id");
12 |
13 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
14 |
15 |   return (
16 |     <div>
17 |       <LabelInput
18 |         name="template.from_label"
19 |         className="mb-2 block"
20 |         onSave={(value) => {
21 |           updateInvoiceTemplate.execute({
22 |             from_label: value,
23 |           });
24 |         }}
25 |       />
26 |
27 |       <Controller
28 |         name="from_details"
29 |         control={control}
30 |         render={({ field }) => (
31 |           <Editor
32 |             // NOTE: This is a workaround to get the new content to render
33 |             key={id}
34 |             initialContent={field.value}
35 |             onChange={field.onChange}
36 |             onBlur={(content) => {
37 |               updateInvoiceTemplate.execute({
38 |                 from_details: content ? JSON.stringify(content) : null,
39 |               });
40 |             }}
41 |             className="min-h-[90px] [&>div]:min-h-[90px]"
42 |           />
43 |         )}
44 |       />
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/invoice/input.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { Input as BaseInput, type InputProps } from "@midday/ui/input";
3 | import { useState } from "react";
4 | import { useFormContext } from "react-hook-form";
5 |
6 | export function Input({ className, ...props }: InputProps) {
7 |   const { register, watch } = useFormContext();
8 |   const [isFocused, setIsFocused] = useState(false);
9 |   const fieldName = props.name as string;
10 |   const fieldValue = watch(fieldName);
11 |
12 |   const { ref, ...rest } = register(fieldName, {
13 |     valueAsNumber: props.type === "number",
14 |   });
15 |
16 |   const isPlaceholder = !fieldValue && !isFocused;
17 |
18 |   return (
19 |     <div className="relative">
20 |       <BaseInput
21 |         {...props}
22 |         {...rest}
23 |         ref={ref}
24 |         autoComplete="off"
25 |         value={fieldValue || ""}
26 |         className={cn(
27 |           "border-0 p-0 h-6 border-b border-transparent focus:border-border font-mono text-xs",
28 |           isPlaceholder && "opacity-0",
29 |           className,
30 |         )}
31 |         onFocus={(evt) => {
32 |           setIsFocused(true);
33 |           props.onFocus?.(evt);
34 |         }}
35 |         onBlur={(evt) => {
36 |           setIsFocused(false);
37 |           props.onBlur?.(evt);
38 |         }}
39 |       />
40 |       {isPlaceholder && (
41 |         <div className="absolute inset-0 pointer-events-none">
42 |           <div className="h-full w-full bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]" />
43 |         </div>
44 |       )}
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/invoice/invoice-no.tsx
```
1 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
2 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
3 | import { createClient } from "@midday/supabase/client";
4 | import { searchInvoiceNumberQuery } from "@midday/supabase/queries";
5 | import { cn } from "@midday/ui/cn";
6 | import {
7 |   Tooltip,
8 |   TooltipContent,
9 |   TooltipProvider,
10 |   TooltipTrigger,
11 | } from "@midday/ui/tooltip";
12 | import { useAction } from "next-safe-action/hooks";
13 | import { useEffect, useState } from "react";
14 | import { useFormContext } from "react-hook-form";
15 | import { Input } from "./input";
16 | import { LabelInput } from "./label-input";
17 |
18 | type Props = {
19 |   teamId: string;
20 | };
21 |
22 | export function InvoiceNo({ teamId }: Props) {
23 |   const { watch, setError, clearErrors } = useFormContext();
24 |   const supabase = createClient();
25 |   const invoiceNumber = watch("invoice_number");
26 |
27 |   const [isInvoiceNumberExists, setIsInvoiceNumberExists] = useState(false);
28 |
29 |   const { type } = useInvoiceParams();
30 |
31 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
32 |
33 |   useEffect(() => {
34 |     async function searchInvoiceNumber() {
35 |       if (invoiceNumber) {
36 |         const { data } = await searchInvoiceNumberQuery(supabase, {
37 |           teamId,
38 |           query: invoiceNumber,
39 |         });
40 |
41 |         const exists = data && data.length > 0;
42 |         setIsInvoiceNumberExists(exists ?? false);
43 |
44 |         if (exists) {
45 |           setError("invoice_number", {
46 |             type: "manual",
47 |             message: "Invoice number already exists",
48 |           });
49 |         } else {
50 |           clearErrors("invoice_number");
51 |         }
52 |       }
53 |     }
54 |
55 |     // Only search for invoice number if we are creating a new invoice
56 |     if (type === "create") {
57 |       searchInvoiceNumber();
58 |     }
59 |   }, [invoiceNumber, teamId, type]);
60 |
61 |   return (
62 |     <div className="flex space-x-1 items-center">
63 |       <div className="flex items-center flex-shrink-0">
64 |         <LabelInput
65 |           name="template.invoice_no_label"
66 |           onSave={(value) => {
67 |             updateInvoiceTemplate.execute({
68 |               invoice_no_label: value,
69 |             });
70 |           }}
71 |           className="truncate"
72 |         />
73 |         <span className="text-[11px] text-[#878787] font-mono flex-shrink-0">
74 |           :
75 |         </span>
76 |       </div>
77 |
78 |       <TooltipProvider delayDuration={100}>
79 |         <Tooltip>
80 |           <TooltipTrigger asChild>
81 |             <div>
82 |               <Input
83 |                 name="invoice_number"
84 |                 className={cn(
85 |                   "w-28 flex-shrink p-0 border-none text-[11px] h-4.5 overflow-hidden",
86 |                   isInvoiceNumberExists ? "text-red-500" : "",
87 |                 )}
88 |               />
89 |             </div>
90 |           </TooltipTrigger>
91 |           {isInvoiceNumberExists && (
92 |             <TooltipContent className="text-xs px-3 py-1.5">
93 |               <p>Invoice number already exists</p>
94 |             </TooltipContent>
95 |           )}
96 |         </Tooltip>
97 |       </TooltipProvider>
98 |     </div>
99 |   );
100 | }
```

apps/dashboard/src/components/invoice/invoice-title.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { useAction } from "next-safe-action/hooks";
5 | import { useFormContext } from "react-hook-form";
6 | import { Input } from "./input";
7 |
8 | export function InvoiceTitle() {
9 |   const { watch } = useFormContext();
10 |   const invoiceTitle = watch("template.title");
11 |
12 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
13 |
14 |   return (
15 |     <Input
16 |       className="text-[21px] font-medium mb-2 w-fit min-w-[100px] !border-none"
17 |       name="template.title"
18 |       onBlur={() => {
19 |         updateInvoiceTemplate.execute({ title: invoiceTitle });
20 |       }}
21 |     />
22 |   );
23 | }
```

apps/dashboard/src/components/invoice/issue-date.tsx
```
1 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
2 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
3 | import { TZDate } from "@date-fns/tz";
4 | import { Calendar } from "@midday/ui/calendar";
5 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
6 | import { format } from "date-fns";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useState } from "react";
9 | import { useFormContext } from "react-hook-form";
10 | import { LabelInput } from "./label-input";
11 |
12 | export function IssueDate() {
13 |   const { setValue, watch } = useFormContext<InvoiceFormValues>();
14 |   const issueDate = watch("issue_date");
15 |   const dateFormat = watch("template.date_format");
16 |   const [isOpen, setIsOpen] = useState(false);
17 |
18 |   const handleSelect = (date: Date | undefined) => {
19 |     if (date) {
20 |       setValue("issue_date", date, { shouldValidate: true, shouldDirty: true });
21 |       setIsOpen(false);
22 |     }
23 |   };
24 |
25 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
26 |
27 |   return (
28 |     <div className="flex space-x-1 items-center">
29 |       <div className="flex items-center">
30 |         <LabelInput
31 |           name="template.issue_date_label"
32 |           onSave={(value) => {
33 |             updateInvoiceTemplate.execute({
34 |               issue_date_label: value,
35 |             });
36 |           }}
37 |         />
38 |         <span className="text-[11px] text-[#878787] font-mono">:</span>
39 |       </div>
40 |
41 |       <Popover open={isOpen} onOpenChange={setIsOpen} modal>
42 |         <PopoverTrigger className="text-primary text-[11px] font-mono whitespace-nowrap flex">
43 |           {issueDate && format(issueDate, dateFormat)}
44 |         </PopoverTrigger>
45 |         <PopoverContent className="w-auto p-0">
46 |           <Calendar
47 |             mode="single"
48 |             selected={issueDate ? new TZDate(issueDate, "UTC") : undefined}
49 |             onSelect={handleSelect}
50 |             initialFocus
51 |           />
52 |         </PopoverContent>
53 |       </Popover>
54 |     </div>
55 |   );
56 | }
```

apps/dashboard/src/components/invoice/label-input.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { useFormContext } from "react-hook-form";
5 |
6 | type Props = {
7 |   name: string;
8 |   required?: boolean;
9 |   className?: string;
10 |   onSave?: (value: string) => void;
11 | };
12 |
13 | export function LabelInput({ name, className, onSave }: Props) {
14 |   const { setValue, watch } = useFormContext();
15 |   const value = watch(name);
16 |
17 |   return (
18 |     <span
19 |       className={cn(
20 |         "text-[11px] text-[#878787] min-w-10 font-mono outline-none",
21 |         className,
22 |       )}
23 |       id={name}
24 |       contentEditable
25 |       suppressContentEditableWarning
26 |       onBlur={(e) => {
27 |         const newValue = e.currentTarget.textContent || "";
28 |         setValue(name, newValue, { shouldValidate: true });
29 |
30 |         // Only call onSave if the value has changed
31 |         if (newValue !== value) {
32 |           onSave?.(newValue);
33 |         }
34 |       }}
35 |     >
36 |       {value}
37 |     </span>
38 |   );
39 | }
```

apps/dashboard/src/components/invoice/line-items.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
4 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
5 | import { formatAmount } from "@/utils/format";
6 | import { calculateLineItemTotal } from "@midday/invoice/calculate";
7 | import { Button } from "@midday/ui/button";
8 | import { Icons } from "@midday/ui/icons";
9 | import { Reorder, useDragControls } from "framer-motion";
10 | import { useAction } from "next-safe-action/hooks";
11 | import { useFieldArray, useFormContext, useWatch } from "react-hook-form";
12 | import { AmountInput } from "./amount-input";
13 | import { Description } from "./description";
14 | import { Input } from "./input";
15 | import { LabelInput } from "./label-input";
16 | import { QuantityInput } from "./quantity-input";
17 |
18 | export function LineItems() {
19 |   const { control } = useFormContext<InvoiceFormValues>();
20 |   const currency = useWatch({ control, name: "template.currency" });
21 |
22 |   const includeDecimals = useWatch({
23 |     control,
24 |     name: "template.include_decimals",
25 |   });
26 |
27 |   const includeUnits = useWatch({
28 |     control,
29 |     name: "template.include_units",
30 |   });
31 |
32 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
33 |
34 |   const { fields, append, remove, swap } = useFieldArray({
35 |     control,
36 |     name: "line_items",
37 |   });
38 |
39 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
40 |
41 |   const reorderList = (newFields: typeof fields) => {
42 |     const firstDiffIndex = fields.findIndex(
43 |       (field, index) => field.id !== newFields[index]?.id,
44 |     );
45 |
46 |     if (firstDiffIndex !== -1) {
47 |       const newIndex = newFields.findIndex(
48 |         (field) => field.id === fields[firstDiffIndex]?.id,
49 |       );
50 |
51 |       if (newIndex !== -1) {
52 |         swap(firstDiffIndex, newIndex);
53 |       }
54 |     }
55 |   };
56 |
57 |   const handleRemove = (index: number) => {
58 |     if (fields.length > 1) {
59 |       remove(index);
60 |     }
61 |   };
62 |
63 |   return (
64 |     <div className="space-y-4">
65 |       <div
66 |         className={`grid ${includeUnits ? "grid-cols-[1.5fr_15%25%_15%]" : "grid-cols-[1.5fr_15%_15%_15%]"} gap-4 items-end mb-2`}
67 |       >
68 |         <LabelInput
69 |           name="template.description_label"
70 |           onSave={(value) => {
71 |             updateInvoiceTemplate.execute({
72 |               description_label: value,
73 |             });
74 |           }}
75 |           className="truncate"
76 |         />
77 |
78 |         <LabelInput
79 |           name="template.quantity_label"
80 |           onSave={(value) => {
81 |             updateInvoiceTemplate.execute({
82 |               quantity_label: value,
83 |             });
84 |           }}
85 |           className="truncate"
86 |         />
87 |
88 |         <LabelInput
89 |           name="template.price_label"
90 |           onSave={(value) => {
91 |             updateInvoiceTemplate.execute({
92 |               price_label: value,
93 |             });
94 |           }}
95 |           className="truncate"
96 |         />
97 |
98 |         <LabelInput
99 |           name="template.total_label"
100 |           onSave={(value) => {
101 |             updateInvoiceTemplate.execute({
102 |               total_label: value,
103 |             });
104 |           }}
105 |           className="text-right truncate"
106 |         />
107 |       </div>
108 |
109 |       <Reorder.Group
110 |         axis="y"
111 |         values={fields}
112 |         onReorder={reorderList}
113 |         className="!m-0"
114 |       >
115 |         {fields.map((field, index) => (
116 |           <LineItemRow
117 |             key={field.id}
118 |             item={field}
119 |             index={index}
120 |             handleRemove={handleRemove}
121 |             isReorderable={fields.length > 1}
122 |             currency={currency}
123 |             maximumFractionDigits={maximumFractionDigits}
124 |             includeUnits={includeUnits}
125 |           />
126 |         ))}
127 |       </Reorder.Group>
128 |
129 |       <button
130 |         type="button"
131 |         onClick={() =>
132 |           append({
133 |             name: "",
134 |             quantity: 0,
135 |             price: 0,
136 |           })
137 |         }
138 |         className="flex items-center space-x-2 text-xs text-[#878787] font-mono"
139 |       >
140 |         <Icons.Add />
141 |         <span className="text-[11px]">Add item</span>
142 |       </button>
143 |     </div>
144 |   );
145 | }
146 |
147 | function LineItemRow({
148 |   index,
149 |   handleRemove,
150 |   isReorderable,
151 |   item,
152 |   currency,
153 |   maximumFractionDigits,
154 |   includeUnits,
155 | }: {
156 |   index: number;
157 |   handleRemove: (index: number) => void;
158 |   isReorderable: boolean;
159 |   item: InvoiceFormValues["line_items"][number];
160 |   currency: string;
161 |   maximumFractionDigits: number;
162 |   includeUnits?: boolean;
163 | }) {
164 |   const controls = useDragControls();
165 |   const { control } = useFormContext<InvoiceFormValues>();
166 |
167 |   const locale = useWatch({ control, name: "template.locale" });
168 |
169 |   const price = useWatch({
170 |     control,
171 |     name: `line_items.${index}.price`,
172 |   });
173 |
174 |   const quantity = useWatch({
175 |     control,
176 |     name: `line_items.${index}.quantity`,
177 |   });
178 |
179 |   return (
180 |     <Reorder.Item
[TRUNCATED]
```

apps/dashboard/src/components/invoice/logo.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
4 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
5 | import { useUpload } from "@/hooks/use-upload";
6 | import { Icons } from "@midday/ui/icons";
7 | import { Skeleton } from "@midday/ui/skeleton";
8 | import { useToast } from "@midday/ui/use-toast";
9 | import { useAction } from "next-safe-action/hooks";
10 | import { useFormContext } from "react-hook-form";
11 |
12 | export function Logo({ teamId }: { teamId: string }) {
13 |   const { watch, setValue } = useFormContext<InvoiceFormValues>();
14 |   const logoUrl = watch("template.logo_url");
15 |   const { uploadFile, isLoading } = useUpload();
16 |   const { toast } = useToast();
17 |
18 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
19 |
20 |   const handleUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
21 |     const file = event.target.files?.[0];
22 |     if (file) {
23 |       try {
24 |         const { url } = await uploadFile({
25 |           file,
26 |           path: [teamId, "invoice", file.name],
27 |           bucket: "avatars",
28 |         });
29 |
30 |         setValue("template.logo_url", url, { shouldValidate: true });
31 |
32 |         updateInvoiceTemplate.execute({
33 |           logo_url: url,
34 |         });
35 |       } catch (error) {
36 |         toast({
37 |           title: "Something went wrong, please try again.",
38 |           variant: "error",
39 |         });
40 |       }
41 |     }
42 |   };
43 |
44 |   return (
45 |     <div className="relative h-[80px] group">
46 |       <label htmlFor="logo-upload" className="block h-full">
47 |         {isLoading ? (
48 |           <Skeleton className="w-full h-full" />
49 |         ) : logoUrl ? (
50 |           <>
51 |             <img
52 |               src={logoUrl}
53 |               alt="Invoice logo"
54 |               className="h-full w-auto max-w-none object-contain"
55 |             />
56 |             <button
57 |               type="button"
58 |               className="absolute inset-0 bg-black bg-opacity-50 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity flex-col gap-1"
59 |               style={{ width: "auto" }}
60 |               onClick={(e) => {
61 |                 e.preventDefault();
62 |                 setValue("template.logo_url", undefined, {
63 |                   shouldValidate: true,
64 |                 });
65 |                 updateInvoiceTemplate.execute({ logo_url: null });
66 |               }}
67 |             >
68 |               <Icons.Clear className="size-4" />
69 |               <span className="text-xs font-medium">Remove</span>
70 |             </button>
71 |           </>
72 |         ) : (
73 |           <div className="h-[80px] w-[80px] bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]" />
74 |         )}
75 |       </label>
76 |
77 |       <input
78 |         id="logo-upload"
79 |         type="file"
80 |         accept="image/jpeg,image/jpg,image/png"
81 |         className="hidden"
82 |         onChange={handleUpload}
83 |         disabled={isLoading}
84 |       />
85 |     </div>
86 |   );
87 | }
```

apps/dashboard/src/components/invoice/meta.tsx
```
1 | import { DueDate } from "./due-date";
2 | import { InvoiceNo } from "./invoice-no";
3 | import { InvoiceTitle } from "./invoice-title";
4 | import { IssueDate } from "./issue-date";
5 |
6 | type Props = {
7 |   teamId: string;
8 | };
9 |
10 | export function Meta({ teamId }: Props) {
11 |   return (
12 |     <div>
13 |       <InvoiceTitle />
14 |
15 |       <div className="flex flex-col gap-0.5">
16 |         <div>
17 |           <InvoiceNo teamId={teamId} />
18 |         </div>
19 |         <div>
20 |           <IssueDate />
21 |         </div>
22 |         <div>
23 |           <DueDate />
24 |         </div>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/components/invoice/note-details.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { Editor } from "@/components/invoice/editor";
5 | import { useAction } from "next-safe-action/hooks";
6 | import { Controller, useFormContext } from "react-hook-form";
7 | import { LabelInput } from "./label-input";
8 |
9 | export function NoteDetails() {
10 |   const { control, watch } = useFormContext();
11 |   const id = watch("id");
12 |
13 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
14 |
15 |   return (
16 |     <div>
17 |       <LabelInput
18 |         name="template.note_label"
19 |         onSave={(value) => {
20 |           updateInvoiceTemplate.execute({
21 |             note_label: value,
22 |           });
23 |         }}
24 |         className="mb-2 block"
25 |       />
26 |
27 |       <Controller
28 |         control={control}
29 |         name="note_details"
30 |         render={({ field }) => {
31 |           return (
32 |             <Editor
33 |               // NOTE: This is a workaround to get the new content to render
34 |               key={id}
35 |               initialContent={field.value}
36 |               onChange={field.onChange}
37 |               className="min-h-[78px]"
38 |             />
39 |           );
40 |         }}
41 |       />
42 |     </div>
43 |   );
44 | }
```

apps/dashboard/src/components/invoice/payment-details.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { Editor } from "@/components/invoice/editor";
5 | import { useAction } from "next-safe-action/hooks";
6 | import { Controller, useFormContext } from "react-hook-form";
7 | import { LabelInput } from "./label-input";
8 |
9 | export function PaymentDetails() {
10 |   const { control, watch } = useFormContext();
11 |   const id = watch("id");
12 |
13 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
14 |
15 |   return (
16 |     <div>
17 |       <LabelInput
18 |         name="template.payment_label"
19 |         onSave={(value) => {
20 |           updateInvoiceTemplate.execute({
21 |             payment_label: value,
22 |           });
23 |         }}
24 |         className="mb-2 block"
25 |       />
26 |
27 |       <Controller
28 |         control={control}
29 |         name="payment_details"
30 |         render={({ field }) => (
31 |           <Editor
32 |             // NOTE: This is a workaround to get the new content to render
33 |             key={id}
34 |             initialContent={field.value}
35 |             onChange={field.onChange}
36 |             onBlur={(content) => {
37 |               updateInvoiceTemplate.execute({
38 |                 payment_details: content ? JSON.stringify(content) : null,
39 |               });
40 |             }}
41 |             className="min-h-[78px]"
42 |           />
43 |         )}
44 |       />
45 |     </div>
46 |   );
47 | }
```

apps/dashboard/src/components/invoice/quantity-input.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { QuantityInput as BaseQuantityInput } from "@midday/ui/quantity-input";
3 | import { useState } from "react";
4 | import { useController, useFormContext } from "react-hook-form";
5 |
6 | export function QuantityInput({
7 |   name,
8 |   ...props
9 | }: { name: string } & Omit<Parameters<typeof BaseQuantityInput>[0], "value">) {
10 |   const [isFocused, setIsFocused] = useState(false);
11 |
12 |   const { control } = useFormContext();
13 |   const {
14 |     field: { value, onChange, onBlur },
15 |   } = useController({
16 |     name,
17 |     control,
18 |   });
19 |
20 |   const isPlaceholder = !value && !isFocused;
21 |
22 |   return (
23 |     <div className="relative">
24 |       <BaseQuantityInput
25 |         {...props}
26 |         value={value}
27 |         min={0}
28 |         onChange={onChange}
29 |         onFocus={() => setIsFocused(true)}
30 |         className={cn(
31 |           isPlaceholder && "opacity-0 [&_button]:pointer-events-none",
32 |         )}
33 |         onBlur={() => {
34 |           setIsFocused(false);
35 |           onBlur();
36 |         }}
37 |       />
38 |
39 |       {isPlaceholder && (
40 |         <div className="absolute inset-0 pointer-events-none">
41 |           <div className="h-full w-full bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]" />
42 |         </div>
43 |       )}
44 |     </div>
45 |   );
46 | }
```

apps/dashboard/src/components/invoice/settings-menu.tsx
```
1 | "use client";
2 |
3 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
4 | import { uniqueCurrencies } from "@midday/location/currencies";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuCheckboxItem,
8 |   DropdownMenuContent,
9 |   DropdownMenuSub,
10 |   DropdownMenuSubContent,
11 |   DropdownMenuSubTrigger,
12 |   DropdownMenuTrigger,
13 | } from "@midday/ui/dropdown-menu";
14 | import { Icons } from "@midday/ui/icons";
15 | import { useAction } from "next-safe-action/hooks";
16 | import { useFormContext } from "react-hook-form";
17 | import { SelectCurrency } from "../select-currency";
18 |
19 | const dateFormats = [
20 |   { value: "dd/MM/yyyy", label: "DD/MM/YYYY" },
21 |   { value: "MM/dd/yyyy", label: "MM/DD/YYYY" },
22 |   { value: "yyyy-MM-dd", label: "YYYY-MM-DD" },
23 | ];
24 |
25 | const invoiceSizes = [
26 |   { value: "a4", label: "A4" },
27 |   { value: "letter", label: "Letter" },
28 | ];
29 |
30 | const booleanOptions = [
31 |   { value: true, label: "Yes" },
32 |   { value: false, label: "No" },
33 | ];
34 |
35 | const menuItems = [
36 |   {
37 |     icon: Icons.DateFormat,
38 |     label: "Date format",
39 |     options: dateFormats,
40 |     key: "date_format",
41 |   },
42 |   {
43 |     icon: Icons.CropFree,
44 |     label: "Invoice size",
45 |     options: invoiceSizes,
46 |     key: "size",
47 |   },
48 |   {
49 |     icon: Icons.Tax,
50 |     label: "Sales Tax",
51 |     options: booleanOptions,
52 |     key: "include_tax",
53 |   },
54 |   {
55 |     icon: Icons.Vat,
56 |     label: "VAT",
57 |     options: booleanOptions,
58 |     key: "include_vat",
59 |   },
60 |   {
61 |     icon: Icons.CurrencyOutline,
62 |     label: "Currency",
63 |     options: uniqueCurrencies.map((currency) => ({
64 |       value: currency,
65 |       label: currency,
66 |     })),
67 |     key: "currency",
68 |   },
69 |   {
70 |     icon: Icons.ConfirmationNumber,
71 |     label: "Discount",
72 |     options: booleanOptions,
73 |     key: "include_discount",
74 |   },
75 |   {
76 |     icon: Icons.Straighten,
77 |     label: "Units",
78 |     options: booleanOptions,
79 |     key: "include_units",
80 |   },
81 |   {
82 |     icon: Icons.Decimals,
83 |     label: "Decimals",
84 |     options: booleanOptions,
85 |     key: "include_decimals",
86 |   },
87 |   {
88 |     icon: Icons.QrCode,
89 |     label: "QR Code",
90 |     options: booleanOptions,
91 |     key: "include_qr",
92 |   },
93 | ];
94 |
95 | export function SettingsMenu() {
96 |   const { watch, setValue } = useFormContext();
97 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
98 |
99 |   return (
100 |     <DropdownMenu>
101 |       <DropdownMenuTrigger asChild>
102 |         <button type="button">
103 |           <Icons.MoreVertical className="size-5" />
104 |         </button>
105 |       </DropdownMenuTrigger>
106 |       <DropdownMenuContent align="end" className="w-48">
107 |         {menuItems.map((item, index) => {
108 |           const watchKey = `template.${item.key}`;
109 |
110 |           if (item.key === "currency") {
111 |             return (
112 |               <DropdownMenuSub key={index.toString()}>
113 |                 <DropdownMenuSubTrigger>
114 |                   <item.icon className="mr-2 size-4" />
115 |                   <span className="text-xs">{item.label}</span>
116 |                 </DropdownMenuSubTrigger>
117 |                 <DropdownMenuSubContent className="p-0">
118 |                   <SelectCurrency
119 |                     headless
120 |                     className="text-xs"
121 |                     currencies={uniqueCurrencies}
122 |                     value={watch(watchKey)}
123 |                     onChange={(value) => {
124 |                       setValue(watchKey, value, {
125 |                         shouldValidate: true,
126 |                       });
127 |                       updateInvoiceTemplate.execute({
128 |                         [item.key]: value,
129 |                       });
130 |                     }}
131 |                   />
132 |                 </DropdownMenuSubContent>
133 |               </DropdownMenuSub>
134 |             );
135 |           }
136 |
137 |           return (
138 |             <DropdownMenuSub key={index.toString()}>
139 |               <DropdownMenuSubTrigger>
140 |                 <item.icon className="mr-2 size-4" />
141 |                 <span className="text-xs">{item.label}</span>
142 |               </DropdownMenuSubTrigger>
143 |               <DropdownMenuSubContent className="p-0 max-h-48 overflow-y-auto">
144 |                 {item.options.map((option, optionIndex) => (
145 |                   <DropdownMenuCheckboxItem
146 |                     key={optionIndex.toString()}
147 |                     className="text-xs"
148 |                     checked={watch(watchKey) === option.value}
149 |                     onCheckedChange={(checked) => {
150 |                       if (checked) {
151 |                         setValue(watchKey, option.value, {
152 |                           shouldValidate: true,
153 |                         });
154 |
155 |                         updateInvoiceTemplate.execute({
156 |                           [item.key]: option.value,
157 |                         });
158 |                       }
159 |                     }}
160 |                     onSelect={(event) => event.preventDefault()}
161 |                   >
162 |                     {option.label}
163 |                   </DropdownMenuCheckboxItem>
164 |                 ))}
165 |               </DropdownMenuSubContent>
166 |             </DropdownMenuSub>
167 |           );
168 |         })}
169 |       </DropdownMenuContent>
170 |     </DropdownMenu>
171 |   );
172 | }
```

apps/dashboard/src/components/invoice/submit-button.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
4 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
5 | import { Button } from "@midday/ui/button";
6 | import {
7 |   DropdownMenu,
8 |   DropdownMenuCheckboxItem,
9 |   DropdownMenuContent,
10 |   DropdownMenuTrigger,
11 | } from "@midday/ui/dropdown-menu";
12 | import { Icons } from "@midday/ui/icons";
13 | import { SubmitButton as BaseSubmitButton } from "@midday/ui/submit-button";
14 | import { useAction } from "next-safe-action/hooks";
15 | import { useState } from "react";
16 | import { useFormContext } from "react-hook-form";
17 |
18 | type Props = {
19 |   isSubmitting: boolean;
20 |   disabled?: boolean;
21 | };
22 |
23 | export function SubmitButton({ isSubmitting, disabled }: Props) {
24 |   const { watch, setValue, formState } = useFormContext<InvoiceFormValues>();
25 |
26 |   const selectedOption = watch("template.delivery_type");
27 |   const canUpdate = watch("status") !== "draft";
28 |
29 |   const invoiceNumberValid = !formState.errors.invoice_number;
30 |
31 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
32 |
33 |   const handleOptionChange = (value: string) => {
34 |     const deliveryType = value as "create" | "create_and_send";
35 |
36 |     updateInvoiceTemplate.execute({
37 |       delivery_type: deliveryType,
38 |     });
39 |
40 |     setValue("template.delivery_type", deliveryType, {
41 |       shouldValidate: true,
42 |     });
43 |   };
44 |
45 |   const isValid = formState.isValid && invoiceNumberValid;
46 |
47 |   const options = [
48 |     {
49 |       label: canUpdate ? "Update" : "Create",
50 |       value: "create",
51 |     },
52 |     {
53 |       label: canUpdate ? "Update & Send" : "Create & Send",
54 |       value: "create_and_send",
55 |     },
56 |   ];
57 |
58 |   return (
59 |     <div className="flex divide-x">
60 |       <BaseSubmitButton
61 |         isSubmitting={isSubmitting}
62 |         disabled={!isValid || disabled}
63 |       >
64 |         {options.find((o) => o.value === selectedOption)?.label}
65 |       </BaseSubmitButton>
66 |
67 |       <DropdownMenu>
68 |         <DropdownMenuTrigger asChild>
69 |           <Button
70 |             disabled={!isValid || isSubmitting || disabled}
71 |             className="size-9 p-0 [&[data-state=open]>svg]:rotate-180"
72 |           >
73 |             <Icons.ChevronDown className="size-4 transition-transform duration-200" />
74 |           </Button>
75 |         </DropdownMenuTrigger>
76 |         <DropdownMenuContent align="end" sideOffset={10}>
77 |           {options.map((option) => (
78 |             <DropdownMenuCheckboxItem
79 |               key={option.value}
80 |               checked={selectedOption === option.value}
81 |               onCheckedChange={() => handleOptionChange(option.value)}
82 |             >
83 |               {option.label}
84 |             </DropdownMenuCheckboxItem>
85 |           ))}
86 |         </DropdownMenuContent>
87 |       </DropdownMenu>
88 |     </div>
89 |   );
90 | }
```

apps/dashboard/src/components/invoice/summary.tsx
```
1 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
2 | import { updateInvoiceTemplateAction } from "@/actions/invoice/update-invoice-template-action";
3 | import { calculateTotal } from "@midday/invoice/calculate";
4 | import { useAction } from "next-safe-action/hooks";
5 | import { useCallback, useEffect } from "react";
6 | import { useFormContext, useWatch } from "react-hook-form";
7 | import { AnimatedNumber } from "../animated-number";
8 | import { FormatAmount } from "../format-amount";
9 | import { AmountInput } from "./amount-input";
10 | import { LabelInput } from "./label-input";
11 | import { TaxInput } from "./tax-input";
12 | import { VATInput } from "./vat-input";
13 |
14 | export function Summary() {
15 |   const { control, setValue } = useFormContext<InvoiceFormValues>();
16 |
17 |   const updateInvoiceTemplate = useAction(updateInvoiceTemplateAction);
18 |
19 |   const includeDecimals = useWatch({
20 |     control,
21 |     name: "template.include_decimals",
22 |   });
23 |
24 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
25 |
26 |   const currency = useWatch({
27 |     control,
28 |     name: "template.currency",
29 |   });
30 |
31 |   const locale = useWatch({
32 |     control,
33 |     name: "template.locale",
34 |   });
35 |
36 |   const includeTax = useWatch({
37 |     control,
38 |     name: "template.include_tax",
39 |   });
40 |
41 |   const taxRate = useWatch({
42 |     control,
43 |     name: "template.tax_rate",
44 |   });
45 |
46 |   const vatRate = useWatch({
47 |     control,
48 |     name: "template.vat_rate",
49 |   });
50 |
51 |   const includeVAT = useWatch({
52 |     control,
53 |     name: "template.include_vat",
54 |   });
55 |
56 |   const includeDiscount = useWatch({
57 |     control,
58 |     name: "template.include_discount",
59 |   });
60 |
61 |   const lineItems = useWatch({
62 |     control,
63 |     name: "line_items",
64 |   });
65 |
66 |   const discount = useWatch({
67 |     control,
68 |     name: "discount",
69 |   });
70 |
71 |   const {
72 |     subTotal,
73 |     total,
74 |     vat: totalVAT,
75 |     tax: totalTax,
76 |   } = calculateTotal({
77 |     lineItems,
78 |     taxRate,
79 |     vatRate,
80 |     includeTax,
81 |     discount: discount ?? 0,
82 |   });
83 |
84 |   const updateFormValues = useCallback(() => {
85 |     setValue("amount", total, { shouldValidate: true });
86 |     setValue("vat", totalVAT, { shouldValidate: true });
87 |     setValue("tax", totalTax, { shouldValidate: true });
88 |     setValue("subtotal", subTotal, { shouldValidate: true });
89 |   }, [total, totalVAT, totalTax, subTotal]);
90 |
91 |   useEffect(() => {
92 |     updateFormValues();
93 |   }, [updateFormValues]);
94 |
95 |   useEffect(() => {
96 |     if (!includeTax) {
97 |       setValue("template.tax_rate", 0, { shouldValidate: true });
98 |     }
99 |   }, [includeTax]);
100 |
101 |   useEffect(() => {
102 |     if (!includeVAT) {
103 |       setValue("template.vat_rate", 0, { shouldValidate: true });
104 |     }
105 |   }, [includeVAT]);
106 |
107 |   useEffect(() => {
108 |     if (!includeDiscount) {
109 |       setValue("discount", 0, { shouldValidate: true });
110 |     }
111 |   }, [includeDiscount]);
112 |
113 |   return (
114 |     <div className="w-[320px] flex flex-col">
115 |       <div className="flex justify-between items-center py-1">
116 |         <LabelInput
117 |           className="flex-shrink-0 min-w-6"
118 |           name="template.subtotal_label"
119 |           onSave={(value) => {
120 |             updateInvoiceTemplate.execute({
121 |               subtotal_label: value,
122 |             });
123 |           }}
124 |         />
125 |         <span className="text-right font-mono text-[11px] text-[#878787]">
126 |           <FormatAmount
127 |             amount={subTotal}
128 |             maximumFractionDigits={maximumFractionDigits}
129 |             currency={currency}
130 |             locale={locale}
131 |           />
132 |         </span>
133 |       </div>
134 |
135 |       {includeDiscount && (
136 |         <div className="flex justify-between items-center py-1">
137 |           <LabelInput
138 |             name="template.discount_label"
139 |             onSave={(value) => {
140 |               updateInvoiceTemplate.execute({
141 |                 discount_label: value,
142 |               });
143 |             }}
144 |           />
145 |
146 |           <AmountInput
147 |             placeholder="0"
148 |             allowNegative={false}
149 |             name="discount"
150 |             className="text-right font-mono text-[11px] text-[#878787] border-none"
151 |           />
152 |         </div>
153 |       )}
154 |
155 |       {includeVAT && (
156 |         <div className="flex justify-between items-center py-1">
157 |           <div className="flex items-center gap-1">
158 |             <LabelInput
159 |               className="flex-shrink-0 min-w-5"
160 |               name="template.vat_label"
161 |               onSave={(value) => {
162 |                 updateInvoiceTemplate.execute({
163 |                   vat_label: value,
164 |                 });
165 |               }}
166 |             />
167 |
168 |             <VATInput />
169 |           </div>
170 |
171 |           <span className="text-right font-mono text-[11px] text-[#878787]">
172 |             <FormatAmount
173 |               amount={totalVAT}
174 |               maximumFractionDigits={maximumFractionDigits}
175 |               currency={currency}
176 |               locale={locale}
177 |             />
178 |           </span>
179 |         </div>
180 |       )}
181 |
182 |       {includeTax && (
183 |         <div className="flex justify-between items-center py-1">
[TRUNCATED]
```

apps/dashboard/src/components/invoice/tax-input.tsx
```
1 | import { CurrencyInput } from "@midday/ui/currency-input";
2 | import { useController, useFormContext } from "react-hook-form";
3 |
4 | export function TaxInput() {
5 |   const { control } = useFormContext();
6 |   const {
7 |     field: { value, onChange },
8 |   } = useController({
9 |     name: "template.tax_rate",
10 |     control,
11 |   });
12 |
13 |   return (
14 |     <CurrencyInput
15 |       suffix="%)"
16 |       prefix="("
17 |       autoComplete="off"
18 |       value={value}
19 |       onValueChange={(values) => {
20 |         onChange(values.floatValue);
21 |       }}
22 |       className="p-0 border-0 h-6 text-xs !bg-transparent font-mono flex-shrink-0 w-16 text-[11px] text-[#878787]"
23 |       thousandSeparator={false}
24 |       decimalScale={2}
25 |       isAllowed={(values) => {
26 |         const { floatValue } = values;
27 |         return (
28 |           floatValue === undefined || (floatValue >= 0 && floatValue <= 100)
29 |         );
30 |       }}
31 |       allowNegative={false}
32 |     />
33 |   );
34 | }
```

apps/dashboard/src/components/invoice/utils.ts
```
1 | import type { InvoiceFormValues } from "@/actions/invoice/schema";
2 | import type { Customer } from "./customer-details";
3 |
4 | export const transformCustomerToContent = (customer?: Customer) => {
5 |   if (!customer) return null;
6 |
7 |   const content = [];
8 |
9 |   if (customer.name) {
10 |     content.push({
11 |       type: "paragraph",
12 |       content: [
13 |         {
14 |           text: customer.name,
15 |           type: "text",
16 |         },
17 |       ],
18 |     });
19 |   }
20 |
21 |   if (customer.address_line_1) {
22 |     content.push({
23 |       type: "paragraph",
24 |       content: [{ text: customer.address_line_1, type: "text" }],
25 |     });
26 |   }
27 |
28 |   if (customer.zip || customer.city) {
29 |     content.push({
30 |       type: "paragraph",
31 |       content: [
32 |         {
33 |           text: `${customer.zip || ""} ${customer.city || ""}`.trim(),
34 |           type: "text",
35 |         },
36 |       ],
37 |     });
38 |   }
39 |
40 |   if (customer.country) {
41 |     content.push({
42 |       type: "paragraph",
43 |       content: [{ text: customer.country, type: "text" }],
44 |     });
45 |   }
46 |
47 |   if (customer.email) {
48 |     content.push({
49 |       type: "paragraph",
50 |       content: [{ text: customer.email, type: "text" }],
51 |     });
52 |   }
53 |
54 |   if (customer.phone) {
55 |     content.push({
56 |       type: "paragraph",
57 |       content: [{ text: customer.phone, type: "text" }],
58 |     });
59 |   }
60 |
61 |   if (customer.vat) {
62 |     content.push({
63 |       type: "paragraph",
64 |       content: [{ text: `VAT: ${customer.vat}`, type: "text" }],
65 |     });
66 |   }
67 |
68 |   return {
69 |     type: "doc",
70 |     content,
71 |   };
72 | };
73 |
74 | export const transformFormValuesToDraft = (values: InvoiceFormValues) => {
75 |   return {
76 |     ...values,
77 |     template: {
78 |       ...values.template,
79 |       ...(values.payment_details && {
80 |         payment_details: JSON.stringify(values.payment_details),
81 |       }),
82 |       ...(values.from_details && {
83 |         from_details: JSON.stringify(values.from_details),
84 |       }),
85 |     },
86 |     ...(values.payment_details && {
87 |       payment_details: JSON.stringify(values.payment_details),
88 |     }),
89 |     ...(values.from_details && {
90 |       from_details: JSON.stringify(values.from_details),
91 |     }),
92 |     ...(values.customer_details && {
93 |       customer_details: JSON.stringify(values.customer_details),
94 |     }),
95 |     ...(values.note_details && {
96 |       note_details: JSON.stringify(values.note_details),
97 |     }),
98 |   };
99 | };
100 |
101 | export function parseInputValue(value?: string | null) {
102 |   if (value === null) return null;
103 |   return value ? JSON.parse(value) : undefined;
104 | }
```

apps/dashboard/src/components/invoice/vat-input.tsx
```
1 | import { CurrencyInput } from "@midday/ui/currency-input";
2 | import { useController, useFormContext } from "react-hook-form";
3 |
4 | export function VATInput() {
5 |   const { control } = useFormContext();
6 |   const {
7 |     field: { value, onChange },
8 |   } = useController({
9 |     name: "template.vat_rate",
10 |     control,
11 |   });
12 |
13 |   return (
14 |     <CurrencyInput
15 |       suffix="%)"
16 |       prefix="("
17 |       autoComplete="off"
18 |       value={value}
19 |       onValueChange={(values) => {
20 |         onChange(values.floatValue);
21 |       }}
22 |       className="p-0 border-0 h-6 text-xs !bg-transparent font-mono flex-shrink-0 w-16 text-[11px] text-[#878787]"
23 |       thousandSeparator={false}
24 |       decimalScale={2}
25 |       isAllowed={(values) => {
26 |         const { floatValue } = values;
27 |         return (
28 |           floatValue === undefined || (floatValue >= 0 && floatValue <= 100)
29 |         );
30 |       }}
31 |       allowNegative={false}
32 |     />
33 |   );
34 | }
```

apps/dashboard/src/components/modals/add-new-device.tsx
```
1 | "use client";
2 |
3 | import { mfaVerifyAction } from "@/actions/mfa-verify-action";
4 | import { createClient } from "@midday/supabase/client";
5 | import { Button } from "@midday/ui/button";
6 | import { Dialog, DialogContent } from "@midday/ui/dialog";
7 | import { InputOTP, InputOTPGroup, InputOTPSlot } from "@midday/ui/input-otp";
8 | import { useAction } from "next-safe-action/hooks";
9 | import Image from "next/image";
10 | import { usePathname, useRouter, useSearchParams } from "next/navigation";
11 | import { useEffect, useState } from "react";
12 |
13 | export function AddNewDeviceModal() {
14 |   const supabase = createClient();
15 |   const searchParams = useSearchParams();
16 |   const router = useRouter();
17 |   const pathname = usePathname();
18 |   const [isValidating, setValidating] = useState(false);
19 |   const [factorId, setFactorId] = useState("");
20 |   const [error, setError] = useState(false);
21 |   const [qr, setQR] = useState("");
22 |   const isOpen = searchParams.get("add") === "device";
23 |
24 |   const verify = useAction(mfaVerifyAction, {
25 |     onSuccess: () => router.push(pathname),
26 |   });
27 |
28 |   const onComplete = async (code: string) => {
29 |     if (!isValidating) {
30 |       setValidating(true);
31 |
32 |       const challenge = await supabase.auth.mfa.challenge({ factorId });
33 |
34 |       if (!challenge.data) {
35 |         setError(true);
36 |         return;
37 |       }
38 |
39 |       verify.execute({
40 |         factorId,
41 |         challengeId: challenge.data.id,
42 |         code,
43 |       });
44 |     }
45 |   };
46 |
47 |   useEffect(() => {
48 |     setValidating(false);
49 |     setError(false);
50 |
51 |     async function enroll() {
52 |       const { data, error } = await supabase.auth.mfa.enroll({
53 |         factorType: "totp",
54 |       });
55 |
56 |       if (error) {
57 |         throw error;
58 |       }
59 |
60 |       setFactorId(data.id);
61 |
62 |       setQR(data.totp.qr_code);
63 |     }
64 |
65 |     if (isOpen) {
66 |       enroll();
67 |     }
68 |   }, [isOpen]);
69 |
70 |   const handleOnClose = () => {
71 |     router.push(pathname);
72 |
73 |     supabase.auth.mfa.unenroll({
74 |       factorId,
75 |     });
76 |   };
77 |
78 |   return (
79 |     <Dialog open={isOpen} onOpenChange={handleOnClose}>
80 |       <DialogContent
81 |         className="max-w-[455px]"
82 |         onInteractOutside={(evt) => {
83 |           evt.preventDefault();
84 |         }}
85 |       >
86 |         <div className="p-6">
87 |           <div className="flex items-center justify-center mt-8">
88 |             <div className="w-[190px] h-[190px] bg-white rounded-md">
89 |               {qr && (
90 |                 <Image
91 |                   src={qr}
92 |                   alt="qr"
93 |                   width={190}
94 |                   height={190}
95 |                   quality={100}
96 |                 />
97 |               )}
98 |             </div>
99 |           </div>
100 |
101 |           <div className="my-8">
102 |             <p className="font-medium pb-1 text-2xl text-[#606060]">
103 |               Use an authenticator app to scan the following QR code, and
104 |               provide the code to complete the setup.
105 |             </p>
106 |           </div>
107 |
108 |           <div className="flex w-full justify-center">
109 |             <InputOTP
110 |               maxLength={6}
111 |               onComplete={onComplete}
112 |               autoFocus
113 |               disabled={isValidating}
114 |               className={error ? "invalid" : ""}
115 |               render={({ slots }) => (
116 |                 <InputOTPGroup>
117 |                   {slots.map((slot, index) => (
118 |                     <InputOTPSlot key={index.toString()} {...slot} />
119 |                   ))}
120 |                 </InputOTPGroup>
121 |               )}
122 |             />
123 |           </div>
124 |
125 |           <div className="flex border-t-[1px] pt-4 mt-4 justify-center">
126 |             <Button
127 |               onClick={handleOnClose}
128 |               variant="ghost"
129 |               className="text-medium text-sm hover:bg-transparent"
130 |             >
131 |               Cancel
132 |             </Button>
133 |           </div>
134 |         </div>
135 |       </DialogContent>
136 |     </Dialog>
137 |   );
138 | }
```

apps/dashboard/src/components/modals/connect-transactions-modal.tsx
```
1 | "use client";
2 |
3 | import { createPlaidLinkTokenAction } from "@/actions/institutions/create-plaid-link";
4 | import { exchangePublicToken } from "@/actions/institutions/exchange-public-token";
5 | import { getInstitutions } from "@/actions/institutions/get-institutions";
6 | import { useConnectParams } from "@/hooks/use-connect-params";
7 | import type { Institutions } from "@midday-ai/engine/resources/institutions/institutions";
8 | import { track } from "@midday/events/client";
9 | import { LogEvents } from "@midday/events/events";
10 | import { Button } from "@midday/ui/button";
11 | import {
12 |   Dialog,
13 |   DialogContent,
14 |   DialogDescription,
15 |   DialogHeader,
16 |   DialogTitle,
17 | } from "@midday/ui/dialog";
18 | import { Input } from "@midday/ui/input";
19 | import { Skeleton } from "@midday/ui/skeleton";
20 | import { useDebounce, useScript } from "@uidotdev/usehooks";
21 | import { useRouter } from "next/navigation";
22 | import { useEffect, useState } from "react";
23 | import { usePlaidLink } from "react-plaid-link";
24 | import { BankLogo } from "../bank-logo";
25 | import { ConnectBankProvider } from "../connect-bank-provider";
26 | import { CountrySelector } from "../country-selector";
27 | import { InstitutionInfo } from "../institution-info";
28 |
29 | function SearchSkeleton() {
30 |   return (
31 |     <div className="space-y-4">
32 |       {Array.from(new Array(10), (_, index) => (
33 |         <div className="flex items-center space-x-4" key={index.toString()}>
34 |           <Skeleton className="h-9 w-9 rounded-full" />
35 |           <div className="flex flex-col space-y-1">
36 |             <Skeleton className="h-2 rounded-none w-[140px]" />
37 |             <Skeleton className="h-2 rounded-none w-[40px]" />
38 |           </div>
39 |         </div>
40 |       ))}
41 |     </div>
42 |   );
43 | }
44 |
45 | type SearchResultProps = {
46 |   id: string;
47 |   name: string;
48 |   logo: string | null;
49 |   provider: string;
50 |   availableHistory: number;
51 |   openPlaid: () => void;
52 | };
53 |
54 | function SearchResult({
55 |   id,
56 |   name,
57 |   logo,
58 |   provider,
59 |   availableHistory,
60 |   openPlaid,
61 | }: SearchResultProps) {
62 |   return (
63 |     <div className="flex justify-between">
64 |       <div className="flex items-center">
65 |         <BankLogo src={logo} alt={name} />
66 |
67 |         <div className="ml-4 space-y-1 cursor-default">
68 |           <p className="text-sm font-medium leading-none">{name}</p>
69 |           <InstitutionInfo provider={provider}>
70 |             <span className="text-[#878787] text-xs capitalize">
71 |               Via {provider}
72 |             </span>
73 |           </InstitutionInfo>
74 |         </div>
75 |       </div>
76 |
77 |       <ConnectBankProvider
78 |         id={id}
79 |         provider={provider}
80 |         openPlaid={openPlaid}
81 |         availableHistory={availableHistory}
82 |       />
83 |     </div>
84 |   );
85 | }
86 |
87 | type ConnectTransactionsModalProps = {
88 |   countryCode: string;
89 | };
90 |
91 | export function ConnectTransactionsModal({
92 |   countryCode: initialCountryCode,
93 | }: ConnectTransactionsModalProps) {
94 |   const router = useRouter();
95 |   const [loading, setLoading] = useState(true);
96 |   const [results, setResults] = useState<Institutions["data"]>([]);
97 |   const [plaidToken, setPlaidToken] = useState<string | undefined>();
98 |
99 |   const {
100 |     countryCode,
101 |     q: query,
102 |     step,
103 |     setParams,
104 |   } = useConnectParams(initialCountryCode);
105 |
106 |   const isOpen = step === "connect";
107 |   const debouncedSearchTerm = useDebounce(query, 200);
108 |
109 |   // NOTE: Load SDKs here so it's not unmonted
110 |   useScript("https://cdn.teller.io/connect/connect.js", {
111 |     removeOnUnmount: false,
112 |   });
113 |
114 |   const { open: openPlaid } = usePlaidLink({
115 |     token: plaidToken,
116 |     publicKey: "",
117 |     env: process.env.NEXT_PUBLIC_PLAID_ENVIRONMENT!,
118 |     clientName: "Midday",
119 |     product: ["transactions"],
120 |     onSuccess: async (public_token, metadata) => {
121 |       const { access_token, item_id } = await exchangePublicToken(public_token);
122 |
123 |       setParams({
124 |         step: "account",
125 |         provider: "plaid",
126 |         token: access_token,
127 |         ref: item_id,
128 |         institution_id: metadata.institution?.institution_id,
129 |       });
130 |       track({
131 |         event: LogEvents.ConnectBankAuthorized.name,
132 |         channel: LogEvents.ConnectBankAuthorized.channel,
133 |         provider: "plaid",
134 |       });
135 |     },
136 |     onExit: () => {
137 |       setParams({ step: "connect" });
138 |
139 |       track({
140 |         event: LogEvents.ConnectBankCanceled.name,
141 |         channel: LogEvents.ConnectBankCanceled.channel,
142 |         provider: "plaid",
143 |       });
144 |     },
145 |   });
146 |
147 |   const handleOnClose = () => {
148 |     setParams(
149 |       {
150 |         step: null,
151 |         countryCode: null,
152 |         q: null,
153 |         ref: null,
154 |       },
155 |       {
156 |         // NOTE: Rerender so the overview modal is visible
157 |         shallow: false,
158 |       },
159 |     );
160 |   };
161 |
162 |   async function fetchData(query?: string) {
163 |     try {
164 |       setLoading(true);
165 |       const { data } = await getInstitutions({ countryCode, query });
[TRUNCATED]
```

apps/dashboard/src/components/modals/create-categories-modal.tsx
```
1 | import { createCategoriesAction } from "@/actions/create-categories-action";
2 | import {
3 |   type CreateCategoriesFormValues,
4 |   createCategoriesSchema,
5 | } from "@/actions/schema";
6 | import { InputColor } from "@/components/input-color";
7 | import { zodResolver } from "@hookform/resolvers/zod";
8 | import { Button } from "@midday/ui/button";
9 | import {
10 |   DialogContent,
11 |   DialogDescription,
12 |   DialogFooter,
13 |   DialogHeader,
14 |   DialogTitle,
15 | } from "@midday/ui/dialog";
16 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
17 | import { Icons } from "@midday/ui/icons";
18 | import { Input } from "@midday/ui/input";
19 | import { useToast } from "@midday/ui/use-toast";
20 | import { Loader2 } from "lucide-react";
21 | import { useAction } from "next-safe-action/hooks";
22 | import { useEffect } from "react";
23 | import { useFieldArray, useForm } from "react-hook-form";
24 | import { VatInput } from "../vat-input";
25 |
26 | type Props = {
27 |   onOpenChange: (isOpen: boolean) => void;
28 |   isOpen: boolean;
29 | };
30 |
31 | const newItem = {
32 |   name: undefined,
33 |   description: undefined,
34 |   vat: undefined,
35 |   color: undefined,
36 | };
37 |
38 | export function CreateCategoriesModal({ onOpenChange, isOpen }: Props) {
39 |   const { toast } = useToast();
40 |
41 |   const createCategories = useAction(createCategoriesAction, {
42 |     onSuccess: () => {
43 |       onOpenChange(false);
44 |
45 |       toast({
46 |         title: "Successfully created categories.",
47 |         variant: "success",
48 |         duration: 3500,
49 |       });
50 |     },
51 |     onError: () => {
52 |       toast({
53 |         duration: 3500,
54 |         variant: "error",
55 |         title: "Something went wrong please try again.",
56 |       });
57 |     },
58 |   });
59 |
60 |   const form = useForm<CreateCategoriesFormValues>({
61 |     resolver: zodResolver(createCategoriesSchema),
62 |     defaultValues: {
63 |       categories: [newItem],
64 |     },
65 |   });
66 |
67 |   useEffect(() => {
68 |     form.reset({
69 |       categories: [newItem],
70 |     });
71 |   }, [isOpen]);
72 |
73 |   const onSubmit = form.handleSubmit((data) => {
74 |     createCategories.execute({
75 |       categories: data.categories.filter(
76 |         (category) => category.name !== undefined,
77 |       ),
78 |     });
79 |   });
80 |
81 |   const { fields, append } = useFieldArray({
82 |     name: "categories",
83 |     control: form.control,
84 |   });
85 |
86 |   return (
87 |     <DialogContent className="max-w-[455px]">
88 |       <Form {...form}>
89 |         <form onSubmit={form.handleSubmit(onSubmit)}>
90 |           <div className="p-4">
91 |             <DialogHeader className="mb-4">
92 |               <DialogTitle>Create categories</DialogTitle>
93 |               <DialogDescription>
94 |                 You can add your own categories here.
95 |               </DialogDescription>
96 |             </DialogHeader>
97 |
98 |             <div className="flex flex-col space-y-6 max-h-[400px] overflow-auto">
99 |               {fields.map((field, index) => (
100 |                 <div key={field.id} className="flex flex-col space-y-2">
101 |                   <div className="flex space-x-2">
102 |                     <FormField
103 |                       control={form.control}
104 |                       name={`categories.${index}.name`}
105 |                       render={({ field }) => (
106 |                         <FormItem className="flex-1">
107 |                           <FormControl>
108 |                             <InputColor
109 |                               autoFocus
110 |                               placeholder="Name"
111 |                               onChange={({ name, color }) => {
112 |                                 field.onChange(name);
113 |                                 form.setValue(
114 |                                   `categories.${index}.color`,
115 |                                   color,
116 |                                 );
117 |                               }}
118 |                               defaultValue={field.value}
119 |                               defaultColor={form.watch(
120 |                                 `categories.${index}.color`,
121 |                               )}
122 |                             />
123 |                           </FormControl>
124 |                         </FormItem>
125 |                       )}
126 |                     />
127 |
128 |                     <div className="flex-1 relative">
129 |                       <FormField
130 |                         control={form.control}
131 |                         name={`categories.${index}.vat`}
132 |                         render={({ field }) => (
133 |                           <FormItem className="flex-1">
134 |                             <FormControl>
135 |                               <VatInput
136 |                                 value={field.value}
137 |                                 name={form.watch(`categories.${index}.name`)}
138 |                                 onChange={(evt) => {
139 |                                   field.onChange(evt.target.value);
140 |                                 }}
141 |                                 onSelect={(vat) => {
142 |                                   if (vat) {
143 |                                     form.setValue(
144 |                                       `categories.${index}.vat`,
145 |                                       vat.toString(),
146 |                                     );
147 |                                   }
148 |                                 }}
149 |                               />
150 |                             </FormControl>
151 |                           </FormItem>
152 |                         )}
153 |                       />
154 |                     </div>
155 |                   </div>
156 |
157 |                   <FormField
158 |                     control={form.control}
159 |                     name={`categories.${index}.description`}
160 |                     render={({ field }) => (
161 |                       <FormItem className="flex-1">
162 |                         <FormControl>
163 |                           <Input
164 |                             {...field}
165 |                             autoFocus={false}
166 |                             placeholder="Description"
167 |                           />
168 |                         </FormControl>
169 |                       </FormItem>
170 |                     )}
171 |                   />
172 |                 </div>
173 |               ))}
174 |             </div>
175 |
176 |             <Button
177 |               variant="outline"
178 |               type="button"
179 |               className="mt-4 space-x-1"
180 |               onClick={() => {
181 |                 append(newItem, { shouldFocus: false });
182 |               }}
[TRUNCATED]
```

apps/dashboard/src/components/modals/create-team-modal.tsx
```
1 | import { createTeamAction } from "@/actions/create-team-action";
2 | import { createTeamSchema } from "@/actions/schema";
3 | import { zodResolver } from "@hookform/resolvers/zod";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   DialogContent,
7 |   DialogDescription,
8 |   DialogFooter,
9 |   DialogHeader,
10 |   DialogTitle,
11 | } from "@midday/ui/dialog";
12 | import {
13 |   Form,
14 |   FormControl,
15 |   FormField,
16 |   FormItem,
17 |   FormMessage,
18 | } from "@midday/ui/form";
19 | import { Input } from "@midday/ui/input";
20 | import { Loader2 } from "lucide-react";
21 | import { useAction } from "next-safe-action/hooks";
22 | import { useForm } from "react-hook-form";
23 | import type { z } from "zod";
24 |
25 | type Props = {
26 |   onOpenChange: (isOpen: boolean) => void;
27 | };
28 |
29 | export function CreateTeamModal({ onOpenChange }: Props) {
30 |   const createTeam = useAction(createTeamAction, {
31 |     onSuccess: () => onOpenChange(false),
32 |   });
33 |
34 |   const form = useForm<z.infer<typeof createTeamSchema>>({
35 |     resolver: zodResolver(createTeamSchema),
36 |     defaultValues: {
37 |       name: "",
38 |       redirectTo: "/",
39 |     },
40 |   });
41 |
42 |   function onSubmit(values: z.infer<typeof createTeamSchema>) {
43 |     createTeam.execute({ name: values.name });
44 |   }
45 |
46 |   return (
47 |     <DialogContent className="max-w-[455px]">
48 |       <div className="p-4">
49 |         <DialogHeader>
50 |           <DialogTitle>Create team</DialogTitle>
51 |           <DialogDescription>
52 |             For example, you can use the name of your company or department.
53 |           </DialogDescription>
54 |         </DialogHeader>
55 |
56 |         <Form {...form}>
57 |           <form onSubmit={form.handleSubmit(onSubmit)}>
58 |             <FormField
59 |               control={form.control}
60 |               name="name"
61 |               render={({ field }) => (
62 |                 <FormItem>
63 |                   <FormControl>
64 |                     <Input
65 |                       autoFocus
66 |                       className="mt-3"
67 |                       placeholder="Ex: Acme Marketing or Acme Co"
68 |                       autoComplete="off"
69 |                       autoCapitalize="none"
70 |                       autoCorrect="off"
71 |                       spellCheck="false"
72 |                       {...field}
73 |                     />
74 |                   </FormControl>
75 |
76 |                   <FormMessage />
77 |                 </FormItem>
78 |               )}
79 |             />
80 |
81 |             <div className="mt-6 mb-6">
82 |               <DialogFooter>
83 |                 <div className="space-x-4">
84 |                   <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
85 |                     Cancel
86 |                   </Button>
87 |                   <Button
88 |                     type="submit"
89 |                     disabled={createTeam.status === "executing"}
90 |                   >
91 |                     {createTeam.status === "executing" ? (
92 |                       <Loader2 className="h-4 w-4 animate-spin" />
93 |                     ) : (
94 |                       "Continue"
95 |                     )}
96 |                   </Button>
97 |                 </div>
98 |               </DialogFooter>
99 |             </div>
100 |           </form>
101 |         </Form>
102 |       </div>
103 |     </DialogContent>
104 |   );
105 | }
```

apps/dashboard/src/components/modals/edit-bank-account-modal.tsx
```
1 | import { updateBankAccountAction } from "@/actions/update-bank-account-action";
2 | import { useI18n } from "@/locales/client";
3 | import { zodResolver } from "@hookform/resolvers/zod";
4 | import { Button } from "@midday/ui/button";
5 | import { CurrencyInput } from "@midday/ui/currency-input";
6 | import {
7 |   Dialog,
8 |   DialogContent,
9 |   DialogFooter,
10 |   DialogHeader,
11 |   DialogTitle,
12 | } from "@midday/ui/dialog";
13 | import {
14 |   Form,
15 |   FormControl,
16 |   FormDescription,
17 |   FormField,
18 |   FormItem,
19 |   FormLabel,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import {
24 |   Select,
25 |   SelectContent,
26 |   SelectItem,
27 |   SelectTrigger,
28 |   SelectValue,
29 | } from "@midday/ui/select";
30 | import { Loader2 } from "lucide-react";
31 | import { useAction } from "next-safe-action/hooks";
32 | import { useForm } from "react-hook-form";
33 | import { z } from "zod";
34 |
35 | const formSchema = z.object({
36 |   name: z.string().min(1, {
37 |     message: "Account Name must be at least 1 characters.",
38 |   }),
39 |   type: z.string(),
40 |   balance: z.number().min(0, {
41 |     message: "Balance must be at least 0.",
42 |   }),
43 | });
44 |
45 | type Props = {
46 |   id: string;
47 |   onOpenChange: (isOpen: boolean) => void;
48 |   isOpen: boolean;
49 |   defaultName: string;
50 |   defaultType?: string;
51 |   defaultBalance: number;
52 | };
53 |
54 | export function EditBankAccountModal({
55 |   id,
56 |   onOpenChange,
57 |   isOpen,
58 |   defaultName,
59 |   defaultType,
60 |   defaultBalance,
61 | }: Props) {
62 |   const t = useI18n();
63 |
64 |   const updateAccount = useAction(updateBankAccountAction, {
65 |     onSuccess: () => onOpenChange(false),
66 |   });
67 |
68 |   const form = useForm<z.infer<typeof formSchema>>({
69 |     resolver: zodResolver(formSchema),
70 |     defaultValues: {
71 |       name: defaultName,
72 |       type: defaultType,
73 |       balance: defaultBalance,
74 |     },
75 |   });
76 |
77 |   function onSubmit(values: z.infer<typeof formSchema>) {
78 |     updateAccount.execute({ id, ...values });
79 |   }
80 |
81 |   const accountTypes = () => {
82 |     return [
83 |       "depository",
84 |       "credit",
85 |       "other_asset",
86 |       "loan",
87 |       "other_liability",
88 |     ].map((type) => (
89 |       <SelectItem key={type} value={type}>
90 |         {t(`account_type.${type}`)}
91 |       </SelectItem>
92 |     ));
93 |   };
94 |
95 |   return (
96 |     <Dialog open={isOpen} onOpenChange={onOpenChange}>
97 |       <DialogContent
98 |         className="max-w-[455px]"
99 |         onOpenAutoFocus={(evt) => evt.preventDefault()}
100 |       >
101 |         <div className="p-4">
102 |           <DialogHeader>
103 |             <DialogTitle className="flex justify-between">
104 |               Edit Account
105 |             </DialogTitle>
106 |           </DialogHeader>
107 |
108 |           <Form {...form}>
109 |             <form onSubmit={form.handleSubmit(onSubmit)} className="mt-6">
110 |               <FormField
111 |                 control={form.control}
112 |                 name="name"
113 |                 render={({ field }) => (
114 |                   <FormItem>
115 |                     <FormLabel>Name</FormLabel>
116 |                     <FormControl>
117 |                       <Input
118 |                         autoFocus
119 |                         placeholder="Company Account"
120 |                         autoComplete="off"
121 |                         autoCapitalize="none"
122 |                         autoCorrect="off"
123 |                         spellCheck="false"
124 |                         {...field}
125 |                       />
126 |                     </FormControl>
127 |                     <FormDescription>
128 |                       You can change the name of the account here
129 |                     </FormDescription>
130 |                     <FormMessage />
131 |                   </FormItem>
132 |                 )}
133 |               />
134 |
135 |               <FormField
136 |                 control={form.control}
137 |                 name="type"
138 |                 render={({ field }) => (
139 |                   <FormItem className="mt-4">
140 |                     <FormLabel>Type</FormLabel>
141 |                     <Select
142 |                       onValueChange={field.onChange}
143 |                       defaultValue={field.value}
144 |                     >
145 |                       <FormControl>
146 |                         <SelectTrigger>
147 |                           <SelectValue placeholder="Change account type" />
148 |                         </SelectTrigger>
149 |                       </FormControl>
150 |                       <SelectContent>{accountTypes()}</SelectContent>
151 |                     </Select>
152 |                     <FormDescription>Change the account type</FormDescription>
153 |                   </FormItem>
154 |                 )}
155 |               />
156 |
157 |               <FormField
158 |                 control={form.control}
159 |                 name="balance"
160 |                 render={({ field }) => (
161 |                   <FormItem className="mt-4">
162 |                     <FormLabel>Balance</FormLabel>
163 |
164 |                     <FormControl>
165 |                       <CurrencyInput
166 |                         min={0}
167 |                         value={field.value}
168 |                         onValueChange={(values) => {
169 |                           field.onChange(values.floatValue);
170 |                         }}
171 |                       />
172 |                     </FormControl>
173 |
174 |                     <FormDescription>
175 |                       Change the account balance
176 |                     </FormDescription>
177 |                   </FormItem>
178 |                 )}
179 |               />
180 |
181 |               <DialogFooter className="mt-10 w-full">
182 |                 <div className="space-y-4 w-full">
183 |                   <Button
184 |                     disabled={updateAccount.status === "executing"}
185 |                     className="w-full"
186 |                     type="submit"
187 |                   >
188 |                     {updateAccount.status === "executing" ? (
[TRUNCATED]
```

apps/dashboard/src/components/modals/edit-category-modal.tsx
```
1 | import {
2 |   type UpdateCategoriesFormValues,
3 |   updateCategorySchema,
4 | } from "@/actions/schema";
5 | import { updateCategoryAction } from "@/actions/update-category-action";
6 | import { zodResolver } from "@hookform/resolvers/zod";
7 | import { Button } from "@midday/ui/button";
8 | import {
9 |   Dialog,
10 |   DialogContent,
11 |   DialogFooter,
12 |   DialogHeader,
13 |   DialogTitle,
14 | } from "@midday/ui/dialog";
15 | import {
16 |   Form,
17 |   FormControl,
18 |   FormField,
19 |   FormItem,
20 |   FormMessage,
21 | } from "@midday/ui/form";
22 | import { Input } from "@midday/ui/input";
23 | import { Loader2 } from "lucide-react";
24 | import { useAction } from "next-safe-action/hooks";
25 | import { useForm } from "react-hook-form";
26 | import { InputColor } from "../input-color";
27 | import { VatInput } from "../vat-input";
28 |
29 | type Props = {
30 |   id: string;
31 |   onOpenChange: (isOpen: boolean) => void;
32 |   isOpen: boolean;
33 |   defaultValue: {
34 |     name: string;
35 |     color: string;
36 |     description?: string;
37 |     vat?: string;
38 |   };
39 | };
40 |
41 | export function EditCategoryModal({
42 |   id,
43 |   onOpenChange,
44 |   isOpen,
45 |   defaultValue,
46 | }: Props) {
47 |   const updateCategory = useAction(updateCategoryAction, {
48 |     onSuccess: () => onOpenChange(false),
49 |   });
50 |
51 |   const form = useForm<UpdateCategoriesFormValues>({
52 |     resolver: zodResolver(updateCategorySchema),
53 |     defaultValues: {
54 |       id,
55 |       name: defaultValue.name,
56 |       color: defaultValue.color,
57 |       description: defaultValue.description ?? undefined,
58 |       vat: defaultValue?.vat?.toString() ?? undefined,
59 |     },
60 |   });
61 |
62 |   function onSubmit(values: UpdateCategoriesFormValues) {
63 |     updateCategory.execute({
64 |       ...values,
65 |       description: values.description?.length ? values.description : null,
66 |       vat: values.vat?.length ? values.vat.toString() : null,
67 |     });
68 |   }
69 |
70 |   return (
71 |     <Dialog open={isOpen} onOpenChange={onOpenChange}>
72 |       <DialogContent className="max-w-[455px]">
73 |         <div className="p-4">
74 |           <DialogHeader>
75 |             <DialogTitle>Edit Category</DialogTitle>
76 |           </DialogHeader>
77 |
78 |           <Form {...form}>
79 |             <form onSubmit={form.handleSubmit(onSubmit)} className="mt-6 mb-6">
80 |               <div className="flex flex-col space-y-2">
81 |                 <div className="flex space-x-2">
82 |                   <FormField
83 |                     control={form.control}
84 |                     name="name"
85 |                     render={({ field }) => (
86 |                       <FormItem className="flex-1">
87 |                         <FormControl>
88 |                           <div className="relative">
89 |                             <div
90 |                               className="size-3 transition-colors rounded-[2px] absolute top-3 left-2"
91 |                               style={{
92 |                                 backgroundColor: form.watch("color"),
93 |                               }}
94 |                             />
95 |
96 |                             <InputColor
97 |                               placeholder="Category"
98 |                               onChange={({ name, color }) => {
99 |                                 form.setValue("color", color);
100 |                                 field.onChange(name);
101 |                               }}
102 |                               defaultValue={field.value}
103 |                               defaultColor={form.watch("color")}
104 |                             />
105 |
106 |                             <FormMessage />
107 |                           </div>
108 |                         </FormControl>
109 |                       </FormItem>
110 |                     )}
111 |                   />
112 |
113 |                   <div className="flex-1 relative">
114 |                     <FormField
115 |                       control={form.control}
116 |                       name="vat"
117 |                       render={({ field }) => (
118 |                         <FormItem className="flex-1">
119 |                           <FormControl>
120 |                             <VatInput
121 |                               value={field.value}
122 |                               name={form.watch("name")}
123 |                               onChange={(evt) => {
124 |                                 field.onChange(evt.target.value);
125 |                               }}
126 |                               onSelect={(vat) => {
127 |                                 if (vat) {
128 |                                   form.setValue("vat", vat.toString());
129 |                                 }
130 |                               }}
131 |                             />
132 |                           </FormControl>
133 |                         </FormItem>
134 |                       )}
135 |                     />
136 |                   </div>
137 |                 </div>
138 |
139 |                 <FormField
140 |                   control={form.control}
141 |                   name="description"
142 |                   render={({ field }) => (
143 |                     <FormItem className="flex-1">
144 |                       <FormControl>
145 |                         <Input
146 |                           {...field}
147 |                           autoFocus={false}
148 |                           placeholder="Description"
149 |                         />
150 |                       </FormControl>
151 |                     </FormItem>
152 |                   )}
153 |                 />
154 |               </div>
155 |
156 |               <DialogFooter className="mt-8 w-full">
157 |                 <div className="space-y-4 w-full">
158 |                   <Button
159 |                     disabled={updateCategory.status === "executing"}
160 |                     className="w-full"
161 |                     type="submit"
162 |                   >
163 |                     {updateCategory.status === "executing" ? (
164 |                       <Loader2 className="h-4 w-4 animate-spin" />
165 |                     ) : (
166 |                       "Save"
167 |                     )}
168 |                   </Button>
169 |                 </div>
170 |               </DialogFooter>
171 |             </form>
172 |           </Form>
173 |         </div>
174 |       </DialogContent>
175 |     </Dialog>
176 |   );
177 | }
```

apps/dashboard/src/components/modals/edit-inbox-modal.tsx
```
1 | import { updateInboxAction } from "@/actions/inbox/update";
2 | import {
3 |   type UpdateInboxFormValues,
4 |   updateInboxSchema,
5 | } from "@/actions/schema";
6 | import { zodResolver } from "@hookform/resolvers/zod";
7 | import { Button } from "@midday/ui/button";
8 | import {
9 |   Dialog,
10 |   DialogContent,
11 |   DialogFooter,
12 |   DialogHeader,
13 |   DialogTitle,
14 | } from "@midday/ui/dialog";
15 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
16 | import { Input } from "@midday/ui/input";
17 | import { Loader2 } from "lucide-react";
18 | import { useAction } from "next-safe-action/hooks";
19 | import { useEffect } from "react";
20 | import { useForm } from "react-hook-form";
21 | import { SelectCurrency } from "../select-currency";
22 |
23 | type Props = {
24 |   id: string;
25 |   onOpenChange: (isOpen: boolean) => void;
26 |   isOpen: boolean;
27 |   currencies: string[];
28 |   defaultValue: {
29 |     display_name: string;
30 |     amount: string;
31 |     currency: string;
32 |   };
33 | };
34 |
35 | export function EditInboxModal({
36 |   id,
37 |   onOpenChange,
38 |   isOpen,
39 |   defaultValue,
40 |   currencies,
41 | }: Props) {
42 |   const updateCategory = useAction(updateInboxAction, {
43 |     onSuccess: () => onOpenChange(false),
44 |   });
45 |
46 |   const form = useForm<UpdateInboxFormValues>({
47 |     resolver: zodResolver(updateInboxSchema),
48 |   });
49 |
50 |   useEffect(() => {
51 |     form.reset({
52 |       id,
53 |       display_name: defaultValue.display_name,
54 |       amount: defaultValue.amount?.toString(),
55 |       currency: defaultValue.currency ?? undefined,
56 |     });
57 |   }, [id]);
58 |
59 |   function onSubmit(values: UpdateInboxFormValues) {
60 |     updateCategory.execute(values);
61 |   }
62 |
63 |   return (
64 |     <Dialog open={isOpen} onOpenChange={onOpenChange}>
65 |       <DialogContent className="max-w-[455px]">
66 |         <div className="p-4">
67 |           <DialogHeader>
68 |             <DialogTitle>Edit</DialogTitle>
69 |           </DialogHeader>
70 |
71 |           <Form {...form}>
72 |             <form onSubmit={form.handleSubmit(onSubmit)} className="mt-6 mb-6">
73 |               <div className="flex flex-col space-y-2">
74 |                 <FormField
75 |                   control={form.control}
76 |                   name="display_name"
77 |                   render={({ field }) => (
78 |                     <FormItem className="flex-1">
79 |                       <FormControl>
80 |                         <Input {...field} placeholder="Name" />
81 |                       </FormControl>
82 |                     </FormItem>
83 |                   )}
84 |                 />
85 |
86 |                 <div className="flex flex-row space-x-2">
87 |                   <FormField
88 |                     control={form.control}
89 |                     name="amount"
90 |                     render={({ field }) => (
91 |                       <FormItem className="w-full">
92 |                         <FormControl>
93 |                           <Input {...field} placeholder="Amount" />
94 |                         </FormControl>
95 |                       </FormItem>
96 |                     )}
97 |                   />
98 |
99 |                   <FormField
100 |                     control={form.control}
101 |                     name="currency"
102 |                     render={({ field }) => (
103 |                       <FormItem className="w-full">
104 |                         <FormControl>
105 |                           <SelectCurrency
106 |                             className="w-full text-xs"
107 |                             {...field}
108 |                             currencies={Object.values(currencies)?.map(
109 |                               (currency) => currency,
110 |                             )}
111 |                           />
112 |                         </FormControl>
113 |                       </FormItem>
114 |                     )}
115 |                   />
116 |                 </div>
117 |               </div>
118 |
119 |               <DialogFooter className="mt-8 w-full">
120 |                 <div className="space-y-4 w-full">
121 |                   <Button
122 |                     disabled={updateCategory.status === "executing"}
123 |                     className="w-full"
124 |                     type="submit"
125 |                   >
126 |                     {updateCategory.status === "executing" ? (
127 |                       <Loader2 className="h-4 w-4 animate-spin" />
128 |                     ) : (
129 |                       "Save"
130 |                     )}
131 |                   </Button>
132 |                 </div>
133 |               </DialogFooter>
134 |             </form>
135 |           </Form>
136 |         </div>
137 |       </DialogContent>
138 |     </Dialog>
139 |   );
140 | }
```

apps/dashboard/src/components/modals/inbox-settings-modal.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import {
5 |   DialogContent,
6 |   DialogDescription,
7 |   DialogHeader,
8 |   DialogTitle,
9 | } from "@midday/ui/dialog";
10 | import { Dialog } from "@midday/ui/dialog";
11 | import { Icons } from "@midday/ui/icons";
12 | import { useState } from "react";
13 | import { InboxSettings } from "../inbox-settings";
14 |
15 | type Props = {
16 |   forwardEmail: string;
17 |   inboxForwarding: boolean;
18 |   inboxId: string;
19 | };
20 |
21 | export function InboxSettingsModal({
22 |   forwardEmail,
23 |   inboxForwarding,
24 |   inboxId,
25 | }: Props) {
26 |   const [open, setOpen] = useState(false);
27 |
28 |   return (
29 |     <Dialog open={open} onOpenChange={setOpen}>
30 |       <div>
31 |         <Button variant="outline" size="icon" onClick={() => setOpen(true)}>
32 |           <Icons.InboxCustomize />
33 |         </Button>
34 |       </div>
35 |
36 |       <DialogContent
37 |         className="max-w-[455px]"
38 |         onOpenAutoFocus={(evt) => evt.preventDefault()}
39 |       >
40 |         <div className="p-4">
41 |           <DialogHeader className="mb-8">
42 |             <DialogTitle>Settings</DialogTitle>
43 |             <DialogDescription>
44 |               Make changes to your inbox here. Click save when you're done.
45 |             </DialogDescription>
46 |           </DialogHeader>
47 |
48 |           <InboxSettings
49 |             forwardEmail={forwardEmail}
50 |             inboxForwarding={inboxForwarding}
51 |             inboxId={inboxId}
52 |             onSuccess={() => setOpen(false)}
53 |           />
54 |         </div>
55 |       </DialogContent>
56 |     </Dialog>
57 |   );
58 | }
```

apps/dashboard/src/components/modals/invite-team-members-modal.tsx
```
1 | "use client";
2 |
3 | import { inviteTeamMembersAction } from "@/actions/invite-team-members-action";
4 | import {
5 |   type InviteTeamMembersFormValues,
6 |   inviteTeamMembersSchema,
7 | } from "@/actions/schema";
8 | import { zodResolver } from "@hookform/resolvers/zod";
9 | import { Button } from "@midday/ui/button";
10 | import {
11 |   DialogContent,
12 |   DialogDescription,
13 |   DialogFooter,
14 |   DialogHeader,
15 |   DialogTitle,
16 | } from "@midday/ui/dialog";
17 | import { Form, FormControl, FormField, FormItem } from "@midday/ui/form";
18 | import { Icons } from "@midday/ui/icons";
19 | import { Input } from "@midday/ui/input";
20 | import {
21 |   Select,
22 |   SelectContent,
23 |   SelectItem,
24 |   SelectTrigger,
25 |   SelectValue,
26 | } from "@midday/ui/select";
27 | import { useToast } from "@midday/ui/use-toast";
28 | import { Loader2 } from "lucide-react";
29 | import { useAction } from "next-safe-action/hooks";
30 | import { useEffect } from "react";
31 | import { useFieldArray, useForm } from "react-hook-form";
32 |
33 | export function InviteTeamMembersModal({ onOpenChange, isOpen }) {
34 |   const { toast } = useToast();
35 |
36 |   const inviteMembers = useAction(inviteTeamMembersAction, {
37 |     onSuccess: () => {
38 |       onOpenChange(false);
39 |
40 |       toast({
41 |         title: "Successfully invited Team Members.",
42 |         variant: "success",
43 |         duration: 3500,
44 |       });
45 |     },
46 |     onError: () => {
47 |       toast({
48 |         duration: 3500,
49 |         variant: "error",
50 |         title: "Something went wrong please try again.",
51 |       });
52 |     },
53 |   });
54 |
55 |   const form = useForm<InviteTeamMembersFormValues>({
56 |     resolver: zodResolver(inviteTeamMembersSchema),
57 |     defaultValues: {
58 |       invites: [
59 |         {
60 |           email: "",
61 |           role: "member",
62 |         },
63 |       ],
64 |     },
65 |   });
66 |
67 |   useEffect(() => {
68 |     form.reset();
69 |   }, [isOpen]);
70 |
71 |   const onSubmit = form.handleSubmit((data) => {
72 |     inviteMembers.execute({
73 |       // Remove invites without email (last appended invite validation)
74 |       invites: data.invites.filter((invite) => invite.email !== undefined),
75 |       revalidatePath: "/settings/members",
76 |     });
77 |   });
78 |
79 |   const { fields, append } = useFieldArray({
80 |     name: "invites",
81 |     control: form.control,
82 |   });
83 |
84 |   return (
85 |     <DialogContent className="max-w-[455px]">
86 |       <Form {...form}>
87 |         <form onSubmit={form.handleSubmit(onSubmit)}>
88 |           <div className="p-4">
89 |             <DialogHeader>
90 |               <DialogTitle>Invite Members</DialogTitle>
91 |               <DialogDescription>
92 |                 Invite new members by email address.
93 |               </DialogDescription>
94 |             </DialogHeader>
95 |
96 |             {fields.map((field, index) => (
97 |               <div
98 |                 className="flex items-center justify-between mt-3 space-x-4"
99 |                 key={index.toString()}
100 |               >
101 |                 <FormField
102 |                   control={form.control}
103 |                   key={field.id}
104 |                   name={`invites.${index}.email`}
105 |                   render={({ field }) => (
106 |                     <FormItem className="flex-1">
107 |                       <FormControl>
108 |                         <Input
109 |                           placeholder="jane@example.com"
110 |                           type="email"
111 |                           autoComplete="off"
112 |                           autoCapitalize="none"
113 |                           autoCorrect="off"
114 |                           spellCheck="false"
115 |                           {...field}
116 |                         />
117 |                       </FormControl>
118 |                     </FormItem>
119 |                   )}
120 |                 />
121 |
122 |                 <FormField
123 |                   control={form.control}
124 |                   name={`invites.${index}.role`}
125 |                   render={({ field }) => (
126 |                     <FormItem>
127 |                       <Select
128 |                         onValueChange={field.onChange}
129 |                         defaultValue={field.value}
130 |                       >
131 |                         <FormControl>
132 |                           <SelectTrigger>
133 |                             <SelectValue placeholder="Select role" />
134 |                           </SelectTrigger>
135 |                         </FormControl>
136 |                         <SelectContent>
137 |                           <SelectItem value="owner">Owner</SelectItem>
138 |                           <SelectItem value="member">Member</SelectItem>
139 |                         </SelectContent>
140 |                       </Select>
141 |                     </FormItem>
142 |                   )}
143 |                 />
144 |               </div>
145 |             ))}
146 |
147 |             <Button
148 |               variant="outline"
149 |               type="button"
150 |               className="mt-4 space-x-1"
151 |               onClick={() => append({ email: undefined, role: "member" })}
152 |             >
153 |               <Icons.Add />
154 |               <span>Add more</span>
155 |             </Button>
156 |             <DialogFooter className="border-t-[1px] pt-4 mt-8 items-center !justify-between">
157 |               <div>
158 |                 {Object.values(form.formState.errors).length > 0 && (
159 |                   <span className="text-sm text-destructive">
160 |                     Please complete the fields above.
161 |                   </span>
162 |                 )}
163 |               </div>
164 |               <Button
165 |                 type="submit"
166 |                 disabled={inviteMembers.status === "executing"}
167 |                 className="w-full md:w-auto"
168 |               >
169 |                 {inviteMembers.status === "executing" ? (
170 |                   <Loader2 className="h-4 w-4 animate-spin" />
171 |                 ) : (
172 |                   "Invite"
173 |                 )}
174 |               </Button>
175 |             </DialogFooter>
176 |           </div>
177 |         </form>
178 |       </Form>
179 |     </DialogContent>
180 |   );
181 | }
```

apps/dashboard/src/components/modals/overview-modal.tsx
```
1 | "use client";
2 |
3 | import { hideConnectFlowAction } from "@/actions/hide-connect-flow-action";
4 | import { AddAccountButton } from "@/components/add-account-button";
5 | import { cn } from "@midday/ui/cn";
6 | import { Dialog, DialogContent } from "@midday/ui/dialog";
7 | import { useAction } from "next-safe-action/hooks";
8 | import Image from "next/image";
9 | import OverViewScreenOneLight from "public/assets/overview-1-light.png";
10 | import OverViewScreenOne from "public/assets/overview-1.png";
11 | import OverViewScreenTwoLight from "public/assets/overview-2-light.png";
12 | import OverViewScreenTwo from "public/assets/overview-2.png";
13 | import { Fragment, useState } from "react";
14 |
15 | const images = [
16 |   { id: 1, src: OverViewScreenOne, src2: OverViewScreenOneLight },
17 |   { id: 2, src: OverViewScreenTwo, src2: OverViewScreenTwoLight },
18 | ];
19 |
20 | export function OverviewModal({
21 |   defaultOpen = false,
22 | }: { defaultOpen?: boolean }) {
23 |   const [activeId, setActive] = useState(1);
24 |   const [isOpen, setIsOpen] = useState(defaultOpen);
25 |
26 |   const hideConnectFlow = useAction(hideConnectFlowAction);
27 |
28 |   const handleOnOpenChange = () => {
29 |     setIsOpen(!isOpen);
30 |
31 |     if (isOpen) {
32 |       hideConnectFlow.execute();
33 |     }
34 |   };
35 |
36 |   return (
37 |     <Dialog
38 |       defaultOpen={defaultOpen}
39 |       open={isOpen}
40 |       onOpenChange={handleOnOpenChange}
41 |     >
42 |       <DialogContent
43 |         onInteractOutside={(e) => {
44 |           e.preventDefault();
45 |         }}
46 |       >
47 |         <div className="bg-background p-2">
48 |           <div className="p-4">
49 |             <div className="mb-8 space-y-5">
50 |               <h2 className="font-medium text-xl">
51 |                 Get insights of your business you didn't know
52 |               </h2>
53 |               <p className="text-[#878787] text-sm">
54 |                 View real-time profit/revenue as well as revenue numbers.
55 |                 Compare to previous years. See what you spend your money on and
56 |                 where you can save.
57 |               </p>
58 |             </div>
59 |
60 |             <div className="pb-8 relative h-[272px]">
61 |               {images.map((image) => (
62 |                 <Fragment key={image.id}>
63 |                   <Image
64 |                     quality={100}
65 |                     src={image.src}
66 |                     width={486}
67 |                     height={251}
68 |                     alt="Overview"
69 |                     className={cn(
70 |                       "w-full opacity-0 absolute transition-all hidden dark:block",
71 |                       image.id === activeId && "opacity-1",
72 |                     )}
73 |                   />
74 |
75 |                   <Image
76 |                     quality={100}
77 |                     src={image.src2}
78 |                     width={486}
79 |                     height={251}
80 |                     alt="Overview"
81 |                     className={cn(
82 |                       "w-full opacity-0 absolute transition-all block dark:hidden",
83 |                       image.id === activeId && "opacity-1",
84 |                     )}
85 |                   />
86 |                 </Fragment>
87 |               ))}
88 |             </div>
89 |
90 |             <div className="flex justify-between mt-12 items-center">
91 |               <div className="flex space-x-2">
92 |                 {images.map((image) => (
93 |                   <button
94 |                     type="button"
95 |                     onMouseEnter={() => setActive(image.id)}
96 |                     onClick={() => setActive(image.id)}
97 |                     key={image.id}
98 |                     className={cn(
99 |                       "w-[16px] h-[6px] rounded-full bg-[#1D1D1D] dark:bg-[#D9D9D9] opacity-30 transition-all cursor-pointer",
100 |                       image.id === activeId && "opacity-1",
101 |                     )}
102 |                   />
103 |                 ))}
104 |               </div>
105 |
106 |               <AddAccountButton onClick={handleOnOpenChange} />
107 |             </div>
108 |           </div>
109 |         </div>
110 |       </DialogContent>
111 |     </Dialog>
112 |   );
113 | }
```

apps/dashboard/src/components/modals/select-bank-accounts.tsx
```
1 | "use client";
2 |
3 | import { connectBankAccountAction } from "@/actions/connect-bank-account-action";
4 | import { getAccounts } from "@/actions/institutions/get-accounts";
5 | import { connectBankAccountSchema } from "@/actions/schema";
6 | import { sendSupportAction } from "@/actions/send-support-action";
7 | import { useConnectParams } from "@/hooks/use-connect-params";
8 | import { useI18n } from "@/locales/client";
9 | import { getInitials } from "@/utils/format";
10 | import { zodResolver } from "@hookform/resolvers/zod";
11 | import { Avatar, AvatarFallback } from "@midday/ui/avatar";
12 | import { Button } from "@midday/ui/button";
13 | import {
14 |   Dialog,
15 |   DialogContent,
16 |   DialogDescription,
17 |   DialogHeader,
18 |   DialogTitle,
19 | } from "@midday/ui/dialog";
20 | import {
21 |   Form,
22 |   FormControl,
23 |   FormField,
24 |   FormItem,
25 |   FormLabel,
26 | } from "@midday/ui/form";
27 | import { Icons } from "@midday/ui/icons";
28 | import { Skeleton } from "@midday/ui/skeleton";
29 | import { Switch } from "@midday/ui/switch";
30 | import { Tabs, TabsContent } from "@midday/ui/tabs";
31 | import { Textarea } from "@midday/ui/textarea";
32 | import { useToast } from "@midday/ui/use-toast";
33 | import { Loader2 } from "lucide-react";
34 | import { useAction } from "next-safe-action/hooks";
35 | import { useEffect, useState } from "react";
36 | import { useForm } from "react-hook-form";
37 | import z from "zod";
38 | import { FormatAmount } from "../format-amount";
39 | import { LoadingTransactionsEvent } from "../loading-transactions-event";
40 |
41 | type Account = {
42 |   id: string;
43 |   name: string;
44 |   balance: number;
45 |   currency: string;
46 |   type: string;
47 |   subtype: string;
48 |   mask: string;
49 |   institution: {
50 |     id: string;
51 |     name: string;
52 |   };
53 | };
54 |
55 | function RowsSkeleton() {
56 |   return (
57 |     <div className="space-y-6">
58 |       <div className="flex items-center space-x-4">
59 |         <Skeleton className="h-9 w-9 rounded-full" />
60 |         <div className="space-y-2">
61 |           <Skeleton className="h-3.5 w-[210px] rounded-none" />
62 |           <Skeleton className="h-2.5 w-[180px] rounded-none" />
63 |         </div>
64 |       </div>
65 |       <div className="flex items-center space-x-4">
66 |         <Skeleton className="h-9 w-9 rounded-full" />
67 |         <div className="space-y-2">
68 |           <Skeleton className="h-3.5 w-[250px] rounded-none" />
69 |           <Skeleton className="h-2.5 w-[200px] rounded-none" />
70 |         </div>
71 |       </div>
72 |     </div>
73 |   );
74 | }
75 |
76 | function SupportForm() {
77 |   const form = useForm({
78 |     resolver: zodResolver(z.object({ message: z.string() })),
79 |     defaultValues: {
80 |       message: "",
81 |     },
82 |   });
83 |
84 |   const sendSupport = useAction(sendSupportAction, {
85 |     onSuccess: () => {
86 |       form.reset();
87 |     },
88 |   });
89 |
90 |   const handleOnSubmit = form.handleSubmit((values) => {
91 |     sendSupport.execute({
92 |       message: values.message,
93 |       type: "bank-connection",
94 |       priority: "3",
95 |       subject: "Select bank accounts",
96 |       url: document.URL,
97 |     });
98 |   });
99 |
100 |   if (sendSupport.status === "hasSucceeded") {
101 |     return (
102 |       <div className="h-[250px] flex items-center justify-center flex-col space-y-1">
103 |         <p className="font-medium text-sm">Thank you!</p>
104 |         <p className="text-sm text-[#4C4C4C]">
105 |           We will be back with you as soon as possible.
106 |         </p>
107 |       </div>
108 |     );
109 |   }
110 |
111 |   return (
112 |     <Form {...form}>
113 |       <form onSubmit={handleOnSubmit}>
114 |         <FormField
115 |           control={form.control}
116 |           name="message"
117 |           render={({ field }) => (
118 |             <FormItem>
119 |               <FormLabel>Message</FormLabel>
120 |               <FormControl>
121 |                 <Textarea
122 |                   placeholder="Describe the issue you're facing, along with any relevant information. Please be as detailed and specific as possible."
123 |                   className="resize-none min-h-[150px]"
124 |                   autoFocus
125 |                   {...field}
126 |                 />
127 |               </FormControl>
128 |             </FormItem>
129 |           )}
130 |         />
131 |
132 |         <div className="flex justify-end">
133 |           <Button
134 |             type="submit"
135 |             disabled={
136 |               sendSupport.status === "executing" || !form.formState.isValid
137 |             }
138 |             className="mt-4"
139 |           >
140 |             {sendSupport.status === "executing" ? (
141 |               <Loader2 className="h-4 w-4 animate-spin" />
142 |             ) : (
143 |               "Submit"
144 |             )}
145 |           </Button>
146 |         </div>
147 |       </form>
148 |     </Form>
149 |   );
150 | }
151 |
152 | export function SelectBankAccountsModal() {
153 |   const { toast } = useToast();
154 |   const t = useI18n();
155 |
156 |   const [accounts, setAccounts] = useState<Account[]>([]);
[TRUNCATED]
```

apps/dashboard/src/components/modals/transactions-modal.tsx
```
1 | "use client";
2 |
3 | import { hideConnectFlowAction } from "@/actions/hide-connect-flow-action";
4 | import { AddAccountButton } from "@/components/add-account-button";
5 | import { cn } from "@midday/ui/cn";
6 | import { Dialog, DialogContent } from "@midday/ui/dialog";
7 | import { useAction } from "next-safe-action/hooks";
8 | import Image from "next/image";
9 | import TransactionsScreenOneLight from "public/assets/transactions-1-light.png";
10 | import TransactionsScreenOne from "public/assets/transactions-1.png";
11 | import TransactionsScreenTwoLight from "public/assets/transactions-2-light.png";
12 | import TransactionsScreenTwo from "public/assets/transactions-2.png";
13 | import { Fragment, useState } from "react";
14 |
15 | const images = [
16 |   { id: 1, src: TransactionsScreenOne, src2: TransactionsScreenOneLight },
17 |   { id: 2, src: TransactionsScreenTwo, src2: TransactionsScreenTwoLight },
18 | ];
19 |
20 | export function TransactionsModal({
21 |   defaultOpen = false,
22 | }: {
23 |   defaultOpen?: boolean;
24 | }) {
25 |   const [activeId, setActive] = useState(1);
26 |   const [isOpen, setIsOpen] = useState(defaultOpen);
27 |
28 |   const hideConnectFlow = useAction(hideConnectFlowAction);
29 |
30 |   const handleOnOpenChange = () => {
31 |     setIsOpen(!isOpen);
32 |
33 |     if (isOpen) {
34 |       hideConnectFlow.execute();
35 |     }
36 |   };
37 |
38 |   return (
39 |     <Dialog
40 |       defaultOpen={defaultOpen}
41 |       open={isOpen}
42 |       onOpenChange={handleOnOpenChange}
43 |     >
44 |       <DialogContent
45 |         onInteractOutside={(e) => {
46 |           e.preventDefault();
47 |         }}
48 |       >
49 |         <div className="bg-background p-2">
50 |           <div className="p-4">
51 |             <div className="mb-8 space-y-5">
52 |               <h2 className="font-medium text-xl">
53 |                 Get real-time transaction data
54 |               </h2>
55 |               <p className="text-[#878787] text-sm">
56 |                 Get instant transaction insights. Easily spot missing receipts,
57 |                 categorize expenses, and reconcile everything seamlessly for
58 |                 accounting.
59 |               </p>
60 |             </div>
61 |
62 |             <div className="pb-8 relative h-[272px]">
63 |               {images.map((image) => (
64 |                 <Fragment key={image.id}>
65 |                   <Image
66 |                     quality={100}
67 |                     src={image.src}
68 |                     width={486}
69 |                     height={251}
70 |                     alt="Overview"
71 |                     className={cn(
72 |                       "w-full opacity-0 absolute transition-all hidden dark:block",
73 |                       image.id === activeId && "opacity-1",
74 |                     )}
75 |                   />
76 |
77 |                   <Image
78 |                     quality={100}
79 |                     src={image.src2}
80 |                     width={486}
81 |                     height={251}
82 |                     alt="Overview"
83 |                     className={cn(
84 |                       "w-full opacity-0 absolute transition-all block dark:hidden",
85 |                       image.id === activeId && "opacity-1",
86 |                     )}
87 |                   />
88 |                 </Fragment>
89 |               ))}
90 |             </div>
91 |
92 |             <div className="flex justify-between mt-12 items-center">
93 |               <div className="flex space-x-2">
94 |                 {images.map((image) => (
95 |                   <button
96 |                     type="button"
97 |                     onMouseEnter={() => setActive(image.id)}
98 |                     onClick={() => setActive(image.id)}
99 |                     key={image.id}
100 |                     className={cn(
101 |                       "w-[16px] h-[6px] rounded-full bg-[#1D1D1D] dark:bg-[#D9D9D9] opacity-30 transition-all cursor-pointer",
102 |                       image.id === activeId && "opacity-1",
103 |                     )}
104 |                   />
105 |                 ))}
106 |               </div>
107 |
108 |               <AddAccountButton />
109 |             </div>
110 |           </div>
111 |         </div>
112 |       </DialogContent>
113 |     </Dialog>
114 |   );
115 | }
```

apps/dashboard/src/components/modals/vault-settings-modal.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import {
5 |   DialogContent,
6 |   DialogDescription,
7 |   DialogHeader,
8 |   DialogTitle,
9 | } from "@midday/ui/dialog";
10 | import { Dialog } from "@midday/ui/dialog";
11 | import { Icons } from "@midday/ui/icons";
12 | import { useState } from "react";
13 | import { VaultSettings } from "../vault-settings";
14 |
15 | type Props = {
16 |   documentClassification: boolean;
17 | };
18 |
19 | export function VaultSettingsModal({ documentClassification }: Props) {
20 |   const [open, setOpen] = useState(false);
21 |
22 |   return (
23 |     <Dialog open={open} onOpenChange={setOpen}>
24 |       <div>
25 |         <Button variant="outline" size="icon" onClick={() => setOpen(true)}>
26 |           <Icons.Settings />
27 |         </Button>
28 |       </div>
29 |
30 |       <DialogContent
31 |         className="max-w-[455px]"
32 |         onOpenAutoFocus={(evt) => evt.preventDefault()}
33 |       >
34 |         <div className="p-4">
35 |           <DialogHeader className="mb-8">
36 |             <DialogTitle>Settings</DialogTitle>
37 |             <DialogDescription>
38 |               Make changes to your vault here. Click save when you're done.
39 |             </DialogDescription>
40 |           </DialogHeader>
41 |
42 |           <VaultSettings
43 |             documentClassification={documentClassification}
44 |             onSuccess={() => setOpen(false)}
45 |           />
46 |         </div>
47 |       </DialogContent>
48 |     </Dialog>
49 |   );
50 | }
```

apps/dashboard/src/components/sheets/create-transaction-sheet.tsx
```
1 | "use client";
2 |
3 | import { CreateTransactionForm } from "@/components/forms/create-transaction-form";
4 | import { Drawer, DrawerContent } from "@midday/ui/drawer";
5 | import { useMediaQuery } from "@midday/ui/hooks";
6 | import { ScrollArea } from "@midday/ui/scroll-area";
7 | import { Sheet, SheetContent, SheetHeader, SheetTitle } from "@midday/ui/sheet";
8 | import { useQueryState } from "nuqs";
9 | import React from "react";
10 |
11 | export function CreateTransactionSheet({
12 |   categories,
13 |   userId,
14 |   accountId,
15 |   currency,
16 | }: {
17 |   categories: any;
18 |   userId: string;
19 |   accountId: string;
20 |   currency: string;
21 | }) {
22 |   const isDesktop = useMediaQuery("(min-width: 768px)");
23 |   const [open, setOpen] = useQueryState("create-transaction");
24 |
25 |   const isOpen = Boolean(open);
26 |
27 |   const handleOpenChange = (open: boolean) => {
28 |     setOpen(open ? "true" : null);
29 |   };
30 |
31 |   if (isDesktop) {
32 |     return (
33 |       <Sheet open={isOpen} onOpenChange={handleOpenChange}>
34 |         <SheetContent>
35 |           <SheetHeader className="mb-8">
36 |             <SheetTitle>Create Transaction</SheetTitle>
37 |           </SheetHeader>
38 |
39 |           <ScrollArea className="h-full p-0 pb-[100px]" hideScrollbar>
40 |             <CreateTransactionForm
41 |               categories={categories}
42 |               userId={userId}
43 |               accountId={accountId}
44 |               currency={currency}
45 |               onCreate={() => setOpen(null)}
46 |             />
47 |           </ScrollArea>
48 |         </SheetContent>
49 |       </Sheet>
50 |     );
51 |   }
52 |
53 |   return (
54 |     <Drawer open={isOpen} onOpenChange={handleOpenChange}>
55 |       <DrawerContent className="p-6">
56 |         <CreateTransactionForm
57 |           categories={categories}
58 |           userId={userId}
59 |           accountId={accountId}
60 |           currency={currency}
61 |           onCreate={() => setOpen(null)}
62 |         />
63 |       </DrawerContent>
64 |     </Drawer>
65 |   );
66 | }
```

apps/dashboard/src/components/sheets/customer-create-sheet.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
7 | import React from "react";
8 | import { CustomerForm } from "../forms/customer-form";
9 |
10 | export function CustomerCreateSheet() {
11 |   const { setParams, createCustomer } = useCustomerParams();
12 |
13 |   const isOpen = Boolean(createCustomer);
14 |
15 |   return (
16 |     <Sheet open={isOpen} onOpenChange={() => setParams(null)}>
17 |       <SheetContent stack>
18 |         <SheetHeader className="mb-6 flex justify-between items-center flex-row">
19 |           <h2 className="text-xl">Create Customer</h2>
20 |           <Button
21 |             size="icon"
22 |             variant="ghost"
23 |             onClick={() => setParams(null)}
24 |             className="p-0 m-0 size-auto hover:bg-transparent"
25 |           >
26 |             <Icons.Close className="size-5" />
27 |           </Button>
28 |         </SheetHeader>
29 |
30 |         <CustomerForm />
31 |       </SheetContent>
32 |     </Sheet>
33 |   );
34 | }
```

apps/dashboard/src/components/sheets/customer-edit-sheet.tsx
```
1 | "use client";
2 |
3 | import { deleteCustomerAction } from "@/actions/delete-customer-action";
4 | import { useCustomerParams } from "@/hooks/use-customer-params";
5 | import { createClient } from "@midday/supabase/client";
6 | import { getCustomerQuery } from "@midday/supabase/queries";
7 | import {
8 |   AlertDialog,
9 |   AlertDialogAction,
10 |   AlertDialogCancel,
11 |   AlertDialogContent,
12 |   AlertDialogDescription,
13 |   AlertDialogFooter,
14 |   AlertDialogHeader,
15 |   AlertDialogTitle,
16 |   AlertDialogTrigger,
17 | } from "@midday/ui/alert-dialog";
18 | import {
19 |   DropdownMenu,
20 |   DropdownMenuContent,
21 |   DropdownMenuItem,
22 |   DropdownMenuTrigger,
23 | } from "@midday/ui/dropdown-menu";
24 | import { Icons } from "@midday/ui/icons";
25 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
26 | import { useAction } from "next-safe-action/hooks";
27 | import React, { useEffect, useState } from "react";
28 | import { CustomerForm } from "../forms/customer-form";
29 | import type { Customer } from "../invoice/customer-details";
30 |
31 | export function CustomerEditSheet() {
32 |   const [customer, setCustomer] = useState<Customer | null>(null);
33 |   const { setParams, customerId } = useCustomerParams();
34 |
35 |   const isOpen = Boolean(customerId);
36 |   const supabase = createClient();
37 |
38 |   const deleteCustomer = useAction(deleteCustomerAction, {
39 |     onSuccess: () => {
40 |       setParams({
41 |         customerId: null,
42 |       });
43 |     },
44 |   });
45 |
46 |   useEffect(() => {
47 |     async function fetchCustomer() {
48 |       if (customerId) {
49 |         const { data } = await getCustomerQuery(supabase, customerId);
50 |
51 |         if (data) {
52 |           setCustomer(data as Customer);
53 |         }
54 |       }
55 |     }
56 |
57 |     if (customerId) {
58 |       fetchCustomer();
59 |     } else {
60 |       setCustomer(null);
61 |     }
62 |   }, [customerId, supabase]);
63 |
64 |   return (
65 |     <Sheet open={isOpen} onOpenChange={() => setParams(null)}>
66 |       <SheetContent stack>
67 |         <SheetHeader className="mb-6 flex justify-between items-center flex-row">
68 |           <h2 className="text-xl">Edit Customer</h2>
69 |
70 |           {customerId && (
71 |             <DropdownMenu>
72 |               <DropdownMenuTrigger asChild>
73 |                 <button type="button">
74 |                   <Icons.MoreVertical className="size-5" />
75 |                 </button>
76 |               </DropdownMenuTrigger>
77 |               <DropdownMenuContent sideOffset={10} align="end">
78 |                 <AlertDialog>
79 |                   <AlertDialogTrigger asChild>
80 |                     <DropdownMenuItem
81 |                       className="text-destructive"
82 |                       onSelect={(e) => e.preventDefault()}
83 |                     >
84 |                       Delete
85 |                     </DropdownMenuItem>
86 |                   </AlertDialogTrigger>
87 |                   <AlertDialogContent>
88 |                     <AlertDialogHeader>
89 |                       <AlertDialogTitle>
90 |                         Are you absolutely sure?
91 |                       </AlertDialogTitle>
92 |                       <AlertDialogDescription>
93 |                         This action cannot be undone. This will permanently
94 |                         delete the customer and remove their data from our
95 |                         servers.
96 |                       </AlertDialogDescription>
97 |                     </AlertDialogHeader>
98 |                     <AlertDialogFooter>
99 |                       <AlertDialogCancel>Cancel</AlertDialogCancel>
100 |                       <AlertDialogAction
101 |                         onClick={() =>
102 |                           deleteCustomer.execute({ id: customerId })
103 |                         }
104 |                       >
105 |                         Delete
106 |                       </AlertDialogAction>
107 |                     </AlertDialogFooter>
108 |                   </AlertDialogContent>
109 |                 </AlertDialog>
110 |               </DropdownMenuContent>
111 |             </DropdownMenu>
112 |           )}
113 |         </SheetHeader>
114 |
115 |         <CustomerForm data={customer} />
116 |       </SheetContent>
117 |     </Sheet>
118 |   );
119 | }
```

apps/dashboard/src/components/sheets/global-sheets.tsx
```
1 | import { Cookies } from "@/utils/constants";
2 | import { getUser } from "@midday/supabase/cached-queries";
3 | import { cookies } from "next/headers";
4 | import { Suspense } from "react";
5 | import { CustomerCreateSheet } from "./customer-create-sheet";
6 | import { CustomerEditSheet } from "./customer-edit-sheet";
7 | import { InvoiceCommentsSheet } from "./invoice-comments";
8 | import { InvoiceCreateSheetServer } from "./invoice-create-sheet.server";
9 | import { TrackerSheetsServer } from "./tracker-sheets.server";
10 |
11 | type Props = {
12 |   defaultCurrency: string;
13 | };
14 |
15 | export async function GlobalSheets({ defaultCurrency }: Props) {
16 |   const { data: userData } = await getUser();
17 |
18 |   return (
19 |     <>
20 |       <Suspense fallback={null}>
21 |         <TrackerSheetsServer
22 |           teamId={userData?.team_id}
23 |           userId={userData?.id}
24 |           timeFormat={userData?.time_format}
25 |           defaultCurrency={defaultCurrency}
26 |         />
27 |       </Suspense>
28 |
29 |       <CustomerCreateSheet />
30 |       <CustomerEditSheet />
31 |       <InvoiceCommentsSheet />
32 |
33 |       <Suspense fallback={null}>
34 |         {/* We preload the invoice data (template, invoice number etc) */}
35 |         <InvoiceCreateSheetServer teamId={userData?.team_id} />
36 |       </Suspense>
37 |     </>
38 |   );
39 | }
```

apps/dashboard/src/components/sheets/invoice-comments.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | // import { createClient } from "@midday/supabase/client";
5 | // import { getCustomerQuery } from "@midday/supabase/queries";
6 |
7 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
8 | import React, { useEffect, useState } from "react";
9 | import { InvoiceComments } from "../invoice-comments";
10 |
11 | export function InvoiceCommentsSheet() {
12 |   //   const [customer, setCustomer] = useState<Customer | null>(null);
13 |   const { setParams, invoiceId, type } = useInvoiceParams();
14 |
15 |   const isOpen = Boolean(invoiceId && type === "comments");
16 |   //   const supabase = createClient();
17 |
18 |   //   useEffect(() => {
19 |   //     async function fetchCustomer() {
20 |   //       const { data } = await getCustomerQuery(supabase, customerId);
21 |
22 |   //       if (data) {
23 |   //         setCustomer(data);
24 |   //       }
25 |   //     }
26 |
27 |   //     if (customerId) {
28 |   //       fetchCustomer();
29 |   //     }
30 |   //   }, [customerId]);
31 |
32 |   return (
33 |     <Sheet open={isOpen} onOpenChange={() => setParams(null)}>
34 |       <SheetContent>
35 |         <SheetHeader className="mb-10 flex justify-between items-center flex-row">
36 |           <h2 className="text-xl">Comments</h2>
37 |         </SheetHeader>
38 |
39 |         <InvoiceComments />
40 |       </SheetContent>
41 |     </Sheet>
42 |   );
43 | }
```

apps/dashboard/src/components/sheets/invoice-create-sheet.server.tsx
```
1 | import { getDefaultSettings } from "@midday/invoice/default";
2 | import {
3 |   getCustomers,
4 |   getInvoiceTemplates,
5 |   getLastInvoiceNumber,
6 | } from "@midday/supabase/cached-queries";
7 | import { InvoiceCreateSheet } from "./invoice-create-sheet";
8 |
9 | export async function InvoiceCreateSheetServer({ teamId }: { teamId: string }) {
10 |   const [
11 |     { data: templatesData },
12 |     { data: customersData },
13 |     { data: invoiceNumber },
14 |   ] = await Promise.all([
15 |     getInvoiceTemplates(),
16 |     getCustomers(),
17 |     getLastInvoiceNumber(),
18 |   ]);
19 |
20 |   const defaultSettings = await getDefaultSettings();
21 |
22 |   // Filter out null values
23 |   const template = templatesData
24 |     ? Object.fromEntries(
25 |         Object.entries(templatesData).filter(([_, value]) => value !== null),
26 |       )
27 |     : {};
28 |
29 |   return (
30 |     <InvoiceCreateSheet
31 |       teamId={teamId}
32 |       customers={customersData}
33 |       template={template}
34 |       defaultSettings={defaultSettings}
35 |       invoiceNumber={invoiceNumber}
36 |     />
37 |   );
38 | }
```

apps/dashboard/src/components/sheets/invoice-create-sheet.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceTemplate } from "@/actions/invoice/schema";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import type { Settings } from "@midday/invoice/default";
6 | import { Sheet } from "@midday/ui/sheet";
7 | import React from "react";
8 | import type { Customer } from "../invoice/customer-details";
9 | import { FormContext } from "../invoice/form-context";
10 | import { InvoiceSheetContent } from "./invoice-sheet-content";
11 |
12 | type Props = {
13 |   teamId: string;
14 |   template: InvoiceTemplate;
15 |   customers: Customer[];
16 |   defaultSettings: Settings;
17 |   invoiceNumber: string | null;
18 | };
19 |
20 | export function InvoiceCreateSheet({
21 |   teamId,
22 |   template,
23 |   customers,
24 |   defaultSettings,
25 |   invoiceNumber,
26 | }: Props) {
27 |   const { setParams, type, invoiceId } = useInvoiceParams();
28 |   const isOpen = Boolean(type === "create" || type === "edit");
29 |
30 |   return (
31 |     <FormContext
32 |       template={template}
33 |       invoiceNumber={invoiceNumber}
34 |       isOpen={isOpen}
35 |       id={invoiceId}
36 |       defaultSettings={defaultSettings}
37 |     >
38 |       <Sheet open={isOpen} onOpenChange={() => setParams(null)}>
39 |         <InvoiceSheetContent
40 |           teamId={teamId}
41 |           customers={customers}
42 |           invoiceNumber={invoiceNumber}
43 |         />
44 |       </Sheet>
45 |     </FormContext>
46 |   );
47 | }
```

apps/dashboard/src/components/sheets/invoice-details-sheet.tsx
```
1 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
2 | import { Drawer, DrawerContent } from "@midday/ui/drawer";
3 | import { useMediaQuery } from "@midday/ui/hooks";
4 | import { Sheet, SheetContent } from "@midday/ui/sheet";
5 | import React from "react";
6 | import { InvoiceDetails } from "../invoice-details";
7 | import type { Invoice } from "../tables/invoices/columns";
8 |
9 | type Props = {
10 |   setOpen: (id?: string) => void;
11 |   isOpen: boolean;
12 |   data?: Invoice;
13 |   locale: string;
14 | };
15 |
16 | export function InvoiceDetailsSheet({ setOpen, isOpen, data, locale }: Props) {
17 |   const isDesktop = useMediaQuery("(min-width: 768px)");
18 |   const { invoiceId } = useInvoiceParams();
19 |
20 |   if (isDesktop) {
21 |     return (
22 |       <Sheet open={isOpen} onOpenChange={setOpen}>
23 |         <SheetContent>
24 |           <InvoiceDetails id={invoiceId} data={data} />
25 |         </SheetContent>
26 |       </Sheet>
27 |     );
28 |   }
29 |
30 |   return (
31 |     <Drawer
32 |       open={isOpen}
33 |       onOpenChange={(open: boolean) => {
34 |         if (!open) {
35 |           setOpen(undefined);
36 |         }
37 |       }}
38 |     >
39 |       <DrawerContent className="p-6">
40 |         <InvoiceDetails id={invoiceId} data={data} />
41 |       </DrawerContent>
42 |     </Drawer>
43 |   );
44 | }
```

apps/dashboard/src/components/sheets/invoice-sheet-content.tsx
```
1 | "use client";
2 |
3 | import { createInvoiceAction } from "@/actions/invoice/create-invoice-action";
4 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
5 | import { Button } from "@midday/ui/button";
6 | import { SheetContent, SheetHeader } from "@midday/ui/sheet";
7 | import { useAction } from "next-safe-action/hooks";
8 | import { useEffect, useState } from "react";
9 | import { useFormContext } from "react-hook-form";
10 | import { InvoiceSuccessful } from "../invoice-successful";
11 | import type { Customer } from "../invoice/customer-details";
12 | import { Form } from "../invoice/form";
13 | import { SettingsMenu } from "../invoice/settings-menu";
14 | import { OpenURL } from "../open-url";
15 | import type { Invoice } from "../tables/invoices/columns";
16 |
17 | function InvoiceSheetHeader({
18 |   type,
19 | }: { type: "created" | "created_and_sent" }) {
20 |   if (type === "created") {
21 |     return (
22 |       <SheetHeader className="mb-6 flex flex-col">
23 |         <h2 className="text-xl">Created</h2>
24 |         <p className="text-sm text-[#808080]">
25 |           Your invoice was created successfully
26 |         </p>
27 |       </SheetHeader>
28 |     );
29 |   }
30 |
31 |   if (type === "created_and_sent") {
32 |     return (
33 |       <SheetHeader className="mb-6 flex flex-col">
34 |         <h2 className="text-xl">Created & Sent</h2>
35 |         <p className="text-sm text-[#808080]">
36 |           Your invoice was created and sent successfully
37 |         </p>
38 |       </SheetHeader>
39 |     );
40 |   }
41 |
42 |   return null;
43 | }
44 |
45 | type Props = {
46 |   teamId: string;
47 |   customers: Customer[];
48 |   invoiceNumber: string | null;
49 | };
50 |
51 | export function InvoiceSheetContent({
52 |   teamId,
53 |   customers,
54 |   invoiceNumber,
55 | }: Props) {
56 |   const { setParams, type } = useInvoiceParams();
57 |   const [invoice, setInvoice] = useState<Invoice | null>(null);
58 |
59 |   const createInvoice = useAction(createInvoiceAction, {
60 |     onSuccess: ({ data }) => {
61 |       setInvoice(data);
62 |     },
63 |   });
64 |
65 |   const { watch } = useFormContext();
66 |   const templateSize = watch("template.size");
67 |   const deliveryType = watch("template.delivery_type");
68 |
69 |   const size = templateSize === "a4" ? 650 : 740;
70 |   const isOpen = Boolean(type === "create" || type === "edit");
71 |
72 |   useEffect(() => {
73 |     setInvoice(null);
74 |   }, [isOpen]);
75 |
76 |   if (invoice && invoice.status !== "draft") {
77 |     return (
78 |       <SheetContent className="bg-white dark:bg-[#0C0C0C] transition-[max-width] duration-300 ease-in-out">
79 |         <InvoiceSheetHeader
80 |           type={
81 |             invoice?.template.delivery_type === "create_and_send"
82 |               ? "created_and_sent"
83 |               : "created"
84 |           }
85 |         />
86 |
87 |         <div className="flex flex-col justify-center h-[calc(100vh-260px)]">
88 |           <InvoiceSuccessful invoice={invoice} />
89 |         </div>
90 |
91 |         <div className="flex mt-auto absolute bottom-6 justify-end gap-4 right-6 left-6">
92 |           <OpenURL href={`${window.location.origin}/i/${invoice.token}`}>
93 |             <Button variant="secondary">View invoice</Button>
94 |           </OpenURL>
95 |
96 |           <Button
97 |             onClick={() => {
98 |               setInvoice(null);
99 |               setParams(null, { shallow: false });
100 |
101 |               setTimeout(() => {
102 |                 setParams({ type: "create" });
103 |               }, 600);
104 |             }}
105 |           >
106 |             Create another
107 |           </Button>
108 |         </div>
109 |       </SheetContent>
110 |     );
111 |   }
112 |
113 |   return (
114 |     <SheetContent
115 |       style={{ maxWidth: size }}
116 |       className="bg-white dark:bg-[#0C0C0C] transition-[max-width] duration-300 ease-in-out"
117 |     >
118 |       <SheetHeader className="mb-6 flex justify-between items-center flex-row">
119 |         <div className="ml-auto">
120 |           <SettingsMenu />
121 |         </div>
122 |       </SheetHeader>
123 |
124 |       <Form
125 |         teamId={teamId}
126 |         customers={customers}
127 |         isSubmitting={createInvoice.isPending}
128 |         onSubmit={({ id }) => createInvoice.execute({ id, deliveryType })}
129 |         invoiceNumber={invoiceNumber}
130 |       />
131 |     </SheetContent>
132 |   );
133 | }
```

apps/dashboard/src/components/sheets/tracker-create-sheet.tsx
```
1 | "use client";
2 |
3 | import { createProjectAction } from "@/actions/project/create-project-action";
4 | import { createProjectSchema } from "@/actions/schema";
5 | import { TrackerProjectForm } from "@/components/forms/tracker-project-form";
6 | import type { Customer } from "@/components/invoice/customer-details";
7 | import { useTrackerParams } from "@/hooks/use-tracker-params";
8 | import { zodResolver } from "@hookform/resolvers/zod";
9 | import { Drawer, DrawerContent, DrawerHeader } from "@midday/ui/drawer";
10 | import { useMediaQuery } from "@midday/ui/hooks";
11 | import { ScrollArea } from "@midday/ui/scroll-area";
12 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
13 | import { useToast } from "@midday/ui/use-toast";
14 | import { useAction } from "next-safe-action/hooks";
15 | import React from "react";
16 | import { useForm } from "react-hook-form";
17 | import type { z } from "zod";
18 |
19 | type Props = {
20 |   currencyCode: string;
21 |   customers: Customer[];
22 | };
23 |
24 | export function TrackerCreateSheet({ currencyCode, customers }: Props) {
25 |   const { toast } = useToast();
26 |   const isDesktop = useMediaQuery("(min-width: 768px)");
27 |   const { setParams, create } = useTrackerParams();
28 |
29 |   const isOpen = create;
30 |
31 |   const form = useForm<z.infer<typeof createProjectSchema>>({
32 |     resolver: zodResolver(createProjectSchema),
33 |     defaultValues: {
34 |       name: undefined,
35 |       description: undefined,
36 |       rate: undefined,
37 |       status: "in_progress",
38 |       billable: false,
39 |       estimate: 0,
40 |       currency: currencyCode,
41 |       customer_id: undefined,
42 |     },
43 |   });
44 |
45 |   const action = useAction(createProjectAction, {
46 |     onSuccess: () => {
47 |       setParams({ create: null });
48 |       form.reset();
49 |     },
50 |     onError: () => {
51 |       toast({
52 |         duration: 3500,
53 |         variant: "error",
54 |         title: "Something went wrong please try again.",
55 |       });
56 |     },
57 |   });
58 |
59 |   if (isDesktop) {
60 |     return (
61 |       <Sheet open={isOpen} onOpenChange={() => setParams({ create: null })}>
62 |         <SheetContent>
63 |           <SheetHeader className="mb-8 flex justify-between items-center flex-row">
64 |             <h2 className="text-xl">Create Project</h2>
65 |           </SheetHeader>
66 |
67 |           <ScrollArea className="h-full p-0 pb-28" hideScrollbar>
68 |             <TrackerProjectForm
69 |               isSaving={action.status === "executing"}
70 |               onSubmit={action.execute}
71 |               form={form}
72 |               customers={customers}
73 |             />
74 |           </ScrollArea>
75 |         </SheetContent>
76 |       </Sheet>
77 |     );
78 |   }
79 |
80 |   return (
81 |     <Drawer
82 |       open={isOpen}
83 |       onOpenChange={(open: boolean) => {
84 |         if (!open) {
85 |           setParams({ create: null });
86 |         }
87 |       }}
88 |     >
89 |       <DrawerContent className="p-6">
90 |         <DrawerHeader className="mb-8 flex justify-between items-center flex-row">
91 |           <h2 className="text-xl">Create Project</h2>
92 |         </DrawerHeader>
93 |
94 |         <TrackerProjectForm
95 |           isSaving={action.status === "executing"}
96 |           onSubmit={action.execute}
97 |           form={form}
98 |           customers={customers}
99 |         />
100 |       </DrawerContent>
101 |     </Drawer>
102 |   );
103 | }
```

apps/dashboard/src/components/sheets/tracker-schedule-sheet.tsx
```
1 | "use client";
2 |
3 | import { useTrackerParams } from "@/hooks/use-tracker-params";
4 | import { Drawer, DrawerContent } from "@midday/ui/drawer";
5 | import { useMediaQuery } from "@midday/ui/hooks";
6 | import { Sheet, SheetContent } from "@midday/ui/sheet";
7 | import React from "react";
8 | import { TrackerSchedule } from "../tracker-schedule";
9 |
10 | type Props = {
11 |   teamId: string;
12 |   userId: string;
13 |   timeFormat: number;
14 |   lastProjectId?: string;
15 | };
16 |
17 | export function TrackerScheduleSheet({
18 |   teamId,
19 |   userId,
20 |   timeFormat,
21 |   lastProjectId,
22 | }: Props) {
23 |   const isDesktop = useMediaQuery("(min-width: 768px)");
24 |   const { setParams, projectId, range, selectedDate, update, create } =
25 |     useTrackerParams();
26 |
27 |   const isOpen =
28 |     !update &&
29 |     !create &&
30 |     (Boolean(projectId) || range?.length === 2 || Boolean(selectedDate));
31 |
32 |   if (isDesktop) {
33 |     return (
34 |       <Sheet
35 |         open={isOpen}
36 |         onOpenChange={() =>
37 |           setParams({ projectId: null, range: null, selectedDate: null })
38 |         }
39 |       >
40 |         <SheetContent>
41 |           <TrackerSchedule
42 |             teamId={teamId}
43 |             userId={userId}
44 |             timeFormat={timeFormat}
45 |             projectId={lastProjectId}
46 |           />
47 |         </SheetContent>
48 |       </Sheet>
49 |     );
50 |   }
51 |
52 |   return (
53 |     <Drawer
54 |       open={isOpen}
55 |       onOpenChange={(open: boolean) => {
56 |         if (!open) {
57 |           setParams({ projectId: null, range: null, selectedDate: null });
58 |         }
59 |       }}
60 |     >
61 |       <DrawerContent>
62 |         <TrackerSchedule
63 |           teamId={teamId}
64 |           userId={userId}
65 |           timeFormat={timeFormat}
66 |           projectId={lastProjectId}
67 |         />
68 |       </DrawerContent>
69 |     </Drawer>
70 |   );
71 | }
```

apps/dashboard/src/components/sheets/tracker-sheets.server.tsx
```
1 | import { Cookies } from "@/utils/constants";
2 | import { getCustomers } from "@midday/supabase/cached-queries";
3 | import { cookies } from "next/headers";
4 | import { TrackerCreateSheet } from "./tracker-create-sheet";
5 | import { TrackerScheduleSheet } from "./tracker-schedule-sheet";
6 | import { TrackerUpdateSheet } from "./tracker-update-sheet";
7 |
8 | type Props = {
9 |   teamId: string;
10 |   userId: string;
11 |   timeFormat: number;
12 |   defaultCurrency: string;
13 | };
14 |
15 | export async function TrackerSheetsServer({
16 |   teamId,
17 |   userId,
18 |   timeFormat,
19 |   defaultCurrency,
20 | }: Props) {
21 |   const { data: customers } = await getCustomers();
22 |
23 |   const projectId = cookies().get(Cookies.LastProject)?.value;
24 |
25 |   return (
26 |     <>
27 |       <TrackerUpdateSheet
28 |         teamId={teamId}
29 |         userId={userId}
30 |         customers={customers}
31 |       />
32 |
33 |       <TrackerCreateSheet
34 |         currencyCode={defaultCurrency}
35 |         customers={customers}
36 |       />
37 |
38 |       <TrackerScheduleSheet
39 |         teamId={teamId}
40 |         userId={userId}
41 |         timeFormat={timeFormat}
42 |         lastProjectId={projectId}
43 |       />
44 |     </>
45 |   );
46 | }
```

apps/dashboard/src/components/sheets/tracker-update-sheet.tsx
```
1 | "use client";
2 |
3 | import { deleteProjectAction } from "@/actions/project/delete-project-action";
4 | import { updateProjectAction } from "@/actions/project/update-project-action";
5 | import { updateProjectSchema } from "@/actions/schema";
6 | import { TrackerProjectForm } from "@/components/forms/tracker-project-form";
7 | import type { Customer } from "@/components/invoice/customer-details";
8 | import { useTrackerParams } from "@/hooks/use-tracker-params";
9 | import { zodResolver } from "@hookform/resolvers/zod";
10 | import { createClient } from "@midday/supabase/client";
11 | import { getTrackerProjectQuery } from "@midday/supabase/queries";
12 | import {
13 |   AlertDialog,
14 |   AlertDialogAction,
15 |   AlertDialogCancel,
16 |   AlertDialogContent,
17 |   AlertDialogDescription,
18 |   AlertDialogFooter,
19 |   AlertDialogHeader,
20 |   AlertDialogTitle,
21 |   AlertDialogTrigger,
22 | } from "@midday/ui/alert-dialog";
23 | import { Drawer, DrawerContent, DrawerHeader } from "@midday/ui/drawer";
24 | import {
25 |   DropdownMenu,
26 |   DropdownMenuContent,
27 |   DropdownMenuItem,
28 |   DropdownMenuTrigger,
29 | } from "@midday/ui/dropdown-menu";
30 | import { useMediaQuery } from "@midday/ui/hooks";
31 | import { Icons } from "@midday/ui/icons";
32 | import { ScrollArea } from "@midday/ui/scroll-area";
33 | import { Sheet, SheetContent, SheetHeader } from "@midday/ui/sheet";
34 | import { useToast } from "@midday/ui/use-toast";
35 | import { useAction } from "next-safe-action/hooks";
36 | import React, { useEffect, useState } from "react";
37 | import { useForm } from "react-hook-form";
38 | import type { z } from "zod";
39 |
40 | type Props = {
41 |   userId: string;
42 |   teamId: string;
43 |   customers: Customer[];
44 | };
45 |
46 | export function TrackerUpdateSheet({ teamId, customers }: Props) {
47 |   const { toast } = useToast();
48 |   const isDesktop = useMediaQuery("(min-width: 768px)");
49 |   const [isLoading, setIsLoading] = useState(false);
50 |   const { setParams, update, projectId } = useTrackerParams();
51 |   const supabase = createClient();
52 |   const id = projectId ?? "";
53 |
54 |   const isOpen = update !== null && Boolean(projectId);
55 |
56 |   const form = useForm<z.infer<typeof updateProjectSchema>>({
57 |     resolver: zodResolver(updateProjectSchema),
58 |     defaultValues: {
59 |       id: undefined,
60 |       name: undefined,
61 |       description: undefined,
62 |       rate: undefined,
63 |       status: undefined,
64 |       billable: undefined,
65 |       estimate: 0,
66 |       currency: undefined,
67 |       customer_id: undefined,
68 |       tags: undefined,
69 |     },
70 |   });
71 |
72 |   useEffect(() => {
73 |     const fetchData = async () => {
74 |       setIsLoading(true);
75 |
76 |       const { data } = await getTrackerProjectQuery(supabase, {
77 |         teamId,
78 |         projectId: id,
79 |       });
80 |
81 |       if (data) {
82 |         form.reset({
83 |           id: data.id,
84 |           name: data.name,
85 |           description: data.description ?? undefined,
86 |           rate: data.rate ?? undefined,
87 |           status: data.status ?? undefined,
88 |           billable: data.billable ?? undefined,
89 |           estimate: data.estimate ?? undefined,
90 |           currency: data.currency ?? undefined,
91 |           customer_id: data.customer_id ?? undefined,
92 |           tags:
93 |             data.tags?.map((tag) => ({
94 |               id: tag.tag?.id ?? "",
95 |               label: tag.tag?.name ?? "",
96 |               value: tag.tag?.name ?? "",
97 |             })) ?? undefined,
98 |         });
99 |       }
100 |
101 |       setIsLoading(false);
102 |     };
103 |
104 |     if (id) {
105 |       fetchData();
106 |     }
107 |   }, [id]);
108 |
109 |   const deleteAction = useAction(deleteProjectAction, {
110 |     onSuccess: () => {
111 |       setParams({ update: null, projectId: null });
112 |       form.reset();
113 |     },
114 |     onError: () => {
115 |       toast({
116 |         duration: 2500,
117 |         variant: "error",
118 |         title: "Something went wrong please try again.",
119 |       });
120 |     },
121 |   });
122 |
123 |   const updateAction = useAction(updateProjectAction, {
124 |     onSuccess: () => {
125 |       setParams({ update: null, projectId: null });
126 |       form.reset();
127 |     },
128 |     onError: () => {
129 |       toast({
130 |         duration: 3500,
131 |         variant: "error",
132 |         title: "Something went wrong please try again.",
133 |       });
134 |     },
135 |   });
136 |
137 |   useEffect(() => {
138 |     if (!isOpen) {
139 |       form.reset();
140 |     }
141 |   }, [isOpen]);
142 |
143 |   if (isLoading) {
144 |     return null;
145 |   }
146 |
147 |   if (isDesktop) {
148 |     return (
149 |       <AlertDialog>
150 |         <Sheet
151 |           open={isOpen}
152 |           onOpenChange={() => setParams({ update: null, projectId: null })}
153 |         >
154 |           <SheetContent>
155 |             <SheetHeader className="mb-8 flex justify-between items-center flex-row">
156 |               <h2 className="text-xl">Edit Project</h2>
157 |
158 |               <DropdownMenu>
159 |                 <DropdownMenuTrigger>
160 |                   <Icons.MoreVertical className="w-5 h-5" />
161 |                 </DropdownMenuTrigger>
162 |
163 |                 <DropdownMenuContent
164 |                   className="w-42"
165 |                   sideOffset={10}
166 |                   align="end"
167 |                 >
168 |                   <AlertDialogTrigger asChild>
169 |                     <DropdownMenuItem className="text-destructive">
170 |                       Delete
171 |                     </DropdownMenuItem>
172 |                   </AlertDialogTrigger>
173 |                 </DropdownMenuContent>
174 |               </DropdownMenu>
175 |             </SheetHeader>
176 |
[TRUNCATED]
```

apps/dashboard/src/components/sheets/transaction-sheet.tsx
```
1 | import type { UpdateTransactionValues } from "@/actions/schema";
2 | import { Drawer, DrawerContent } from "@midday/ui/drawer";
3 | import { useMediaQuery } from "@midday/ui/hooks";
4 | import { Sheet, SheetContent } from "@midday/ui/sheet";
5 | import React from "react";
6 | import { TransactionDetails } from "../transaction-details";
7 |
8 | type Props = {
9 |   setOpen: (open: boolean) => void;
10 |   isOpen: boolean;
11 |   data: any;
12 |   ids?: string[];
13 |   updateTransaction: (
14 |     values: UpdateTransactionValues,
15 |     optimisticData: any,
16 |   ) => void;
17 | };
18 |
19 | export function TransactionSheet({
20 |   setOpen,
21 |   isOpen,
22 |   data,
23 |   ids,
24 |   updateTransaction,
25 | }: Props) {
26 |   const isDesktop = useMediaQuery("(min-width: 768px)");
27 |
28 |   if (isDesktop) {
29 |     return (
30 |       <Sheet open={isOpen} onOpenChange={setOpen}>
31 |         <SheetContent>
32 |           <TransactionDetails
33 |             data={data}
34 |             ids={ids}
35 |             updateTransaction={updateTransaction}
36 |           />
37 |         </SheetContent>
38 |       </Sheet>
39 |     );
40 |   }
41 |
42 |   return (
43 |     <Drawer
44 |       open={isOpen}
45 |       onOpenChange={(open: boolean) => {
46 |         if (!open) {
47 |           setOpen(false);
48 |         }
49 |       }}
50 |     >
51 |       <DrawerContent className="p-6">
52 |         <TransactionDetails
53 |           data={data}
54 |           ids={ids}
55 |           updateTransaction={updateTransaction}
56 |         />
57 |       </DrawerContent>
58 |     </Drawer>
59 |   );
60 | }
```

apps/dashboard/src/desktop/components/browser-navigation.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { Icons } from "@midday/ui/icons";
5 | import { webContents } from "@todesktop/client-core";
6 | import { useEffect, useState } from "react";
7 |
8 | export function BrowserNavigation() {
9 |   const [canGoForward, setCanGoForward] = useState(false);
10 |   const [canGoBack, setCanGoBack] = useState(false);
11 |
12 |   useEffect(() => {
13 |     webContents.on("did-navigate", async () => {
14 |       if (await webContents.canGoForward()) {
15 |         setCanGoForward(true);
16 |       } else {
17 |         setCanGoForward(false);
18 |       }
19 |
20 |       if (await webContents.canGoBack()) {
21 |         setCanGoBack(true);
22 |       } else {
23 |         setCanGoBack(false);
24 |       }
25 |     });
26 |   }, []);
27 |
28 |   const handleOnNavigate = (dir: "back" | "forward") => {
29 |     if (dir === "back") {
30 |       window.todesktop.contents.goBack();
31 |     }
32 |
33 |     if (dir === "forward") {
34 |       window.todesktop.contents.goForward();
35 |     }
36 |   };
37 |
38 |   return (
39 |     <div className="hidden todesktop:block no-drag h-6">
40 |       <button
41 |         type="button"
42 |         onClick={() => handleOnNavigate("back")}
43 |         className={cn(!canGoBack && "opacity-50")}
44 |         disabled={!canGoBack}
45 |       >
46 |         <Icons.ChevronLeft className="h-6 w-6" />
47 |       </button>
48 |       <button
49 |         type="button"
50 |         onClick={() => handleOnNavigate("forward")}
51 |         className={cn(!canGoForward && "opacity-50")}
52 |         disabled={!canGoForward}
53 |       >
54 |         <Icons.ChevronRight className="h-6 w-6" />
55 |       </button>
56 |     </div>
57 |   );
58 | }
```

apps/dashboard/src/desktop/components/desktop-update.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import {
5 |   Tooltip,
6 |   TooltipContent,
7 |   TooltipProvider,
8 |   TooltipTrigger,
9 | } from "@midday/ui/tooltip";
10 | import { todesktopUpdater } from "@todesktop/client-core";
11 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
12 | import { AnimatePresence, motion } from "framer-motion";
13 | import { useEffect, useState } from "react";
14 |
15 | export function DesktopUpdate() {
16 |   if (!isDesktopApp()) {
17 |     return null;
18 |   }
19 |
20 |   const [status, setStatus] = useState<
21 |     "update-available" | "update-downloaded"
22 |   >();
23 |
24 |   useEffect(() => {
25 |     todesktopUpdater.on("update-available", () => {
26 |       setStatus("update-available");
27 |     });
28 |
29 |     todesktopUpdater.on("update-downloaded", () => {
30 |       setStatus("update-downloaded");
31 |     });
32 |   }, []);
33 |
34 |   const handleOnClick = async () => {
35 |     if (status === "update-available") {
36 |       // Note: Should we handle download binary here?
37 |     }
38 |
39 |     if (status === "update-downloaded") {
40 |       setStatus(null);
41 |       todesktopUpdater.restartAndInstall();
42 |     }
43 |   };
44 |
45 |   return (
46 |     <AnimatePresence>
47 |       {status && (
48 |         <motion.div
49 |           initial={{ opacity: 0 }}
50 |           animate={{ opacity: 1 }}
51 |           exit={{ opacity: 0 }}
52 |         >
53 |           <TooltipProvider delayDuration={50}>
54 |             <Tooltip>
55 |               <TooltipTrigger asChild>
56 |                 <div className="w-[11px] h-[11px] bg-[#7aafd3] rounded-full flex items-center justify-center invisible todesktop:visible">
57 |                   <button
58 |                     className={cn("update-available", status)}
59 |                     type="button"
60 |                     onClick={handleOnClick}
61 |                   >
62 |                     <svg
63 |                       width="12"
64 |                       height="12"
65 |                       viewBox="0 0 12 12"
66 |                       fill="none"
67 |                       xmlns="http://www.w3.org/2000/svg"
68 |                     >
69 |                       <path
70 |                         d="M6 3.25V8.75M6 8.75L8.25 6.5M6 8.75L3.75 6.5"
71 |                         stroke="#294771"
72 |                         stroke-width="1.5"
73 |                         stroke-linecap="round"
74 |                         stroke-linejoin="round"
75 |                         className="svg-update"
76 |                       />
77 |                       <circle
78 |                         cx="6"
79 |                         cy="6"
80 |                         r="2.25"
81 |                         stroke="#294771"
82 |                         stroke-width="4.5"
83 |                         className="svg-progress"
84 |                       />
85 |                       <path
86 |                         d="M3.75 6C3.75 4.75736 4.75736 3.75 6 3.75C6.39468 3.75 6.71356 3.83142 7.00573 3.99422L6.42675 4.5732C6.26926 4.73069 6.3808 4.99997 6.60353 4.99997H8.74998C8.88805 4.99997 8.99998 4.88805 8.99998 4.74997V2.60353C8.99998 2.3808 8.73069 2.26926 8.5732 2.42675L8.09023 2.90972C7.51041 2.49373 6.83971 2.25 6 2.25C3.92893 2.25 2.25 3.92893 2.25 6C2.25 8.07107 3.92893 9.75 6 9.75C7.63395 9.75 9.02199 8.70541 9.53642 7.24993C9.67446 6.8594 9.46977 6.4309 9.07923 6.29287C8.68869 6.15483 8.2602 6.35953 8.12216 6.75007C7.81293 7.62497 6.97849 8.25 6 8.25C4.75736 8.25 3.75 7.24264 3.75 6Z"
87 |                         fill="#294771"
88 |                         className="svg-refresh"
89 |                       />
90 |                     </svg>
91 |                   </button>
92 |                 </div>
93 |               </TooltipTrigger>
94 |
95 |               <TooltipContent sideOffset={10} className="text-xs p-2">
96 |                 {status === "update-available" && "Update Available"}
97 |                 {status === "update-downloaded" && "Relaunch to Update"}
98 |               </TooltipContent>
99 |             </Tooltip>
100 |           </TooltipProvider>
101 |         </motion.div>
102 |       )}
103 |     </AnimatePresence>
104 |   );
105 | }
```

apps/dashboard/src/store/user/hook.ts
```
1 | import { useContext } from "react";
2 | import { useStore } from "zustand";
3 | import { UserContext, type UserState } from "./store";
4 |
5 | export function useUserContext<T>(selector: (state: UserState) => T): T {
6 |   const store = useContext(UserContext);
7 |
8 |   if (!store) {
9 |     throw new Error("Missing UserContext.Provider in the tree");
10 |   }
11 |
12 |   return useStore(store, selector);
13 | }
```

apps/dashboard/src/store/user/provider.tsx
```
1 | "use client";
2 |
3 | import { useEffect } from "react";
4 | import { UserContext, type UserProps, createUserStore } from "./store";
5 |
6 | type UserProviderProps = React.PropsWithChildren<UserProps>;
7 |
8 | export function UserProvider({ children, data }: UserProviderProps) {
9 |   const store = createUserStore({ data });
10 |
11 |   useEffect(() => {
12 |     if (data) {
13 |       store.setState({ data });
14 |     } else {
15 |       store.setState({
16 |         data: {
17 |           locale: window.navigator.language || "en-US",
18 |         },
19 |       });
20 |     }
21 |   }, [data, store]);
22 |
23 |   return <UserContext.Provider value={store}>{children}</UserContext.Provider>;
24 | }
```

apps/dashboard/src/store/user/store.ts
```
1 | import { createContext } from "react";
2 | import { createStore } from "zustand";
3 |
4 | type User = {
5 |   id: string;
6 |   team_id: string;
7 |   full_name: string;
8 |   locale: string;
9 |   date_format: string;
10 |   timezone: string;
11 | };
12 |
13 | export interface UserProps {
14 |   data: User;
15 | }
16 |
17 | export interface UserState extends UserProps {
18 |   setUser: (user: User) => void;
19 | }
20 |
21 | export const createUserStore = (initProps: UserProps) => {
22 |   return createStore<UserState>()((set) => ({
23 |     data: initProps?.data,
24 |     setUser: (user: User) => set({ data: user }),
25 |   }));
26 | };
27 |
28 | export type UserStore = ReturnType<typeof createUserStore>;
29 | export const UserContext = createContext<UserStore | null>(null);
```

apps/dashboard/src/store/vault/hook.ts
```
1 | import { useContext } from "react";
2 | import { useStore } from "zustand";
3 | import { VaultContext, type VaultState } from "./store";
4 |
5 | export function useVaultContext<T>(selector: (state: VaultState) => T): T {
6 |   const store = useContext(VaultContext);
7 |
8 |   if (!store) {
9 |     throw new Error("Missing VaultContext.Provider in the tree");
10 |   }
11 |
12 |   return useStore(store, selector);
13 | }
```

apps/dashboard/src/store/vault/provider.tsx
```
1 | "use client";
2 |
3 | import { useEffect } from "react";
4 | import { VaultContext, type VaultProps, createVaultStore } from "./store";
5 |
6 | type VaultProviderProps = React.PropsWithChildren<VaultProps>;
7 |
8 | export function VaultProvider({ children, data }: VaultProviderProps) {
9 |   const store = createVaultStore({ data });
10 |
11 |   useEffect(() => {
12 |     store.setState({ data });
13 |   }, [data, store]);
14 |
15 |   return (
16 |     <VaultContext.Provider value={store}>{children}</VaultContext.Provider>
17 |   );
18 | }
```

apps/dashboard/src/store/vault/store.ts
```
1 | import { createContext } from "react";
2 | import { createStore } from "zustand";
3 |
4 | type Item = {
5 |   id?: string;
6 |   name?: string;
7 |   tag?: string;
8 |   isFolder?: boolean;
9 |   isEditing?: boolean;
10 |   isLoading?: boolean;
11 | };
12 |
13 | export interface VaultProps {
14 |   data: Item[];
15 | }
16 |
17 | export interface VaultState extends VaultProps {
18 |   deleteItem: (id: string) => void;
19 |   createFolder: (item: Item) => void;
20 |   updateItem: (id: string, payload: Item) => void;
21 | }
22 |
23 | export type VaultStore = ReturnType<typeof createVaultStore>;
24 | export const VaultContext = createContext<VaultStore | null>(null);
25 |
26 | const DEFAULT_PROPS: VaultProps = {
27 |   data: [],
28 | };
29 |
30 | export const createVaultStore = (initProps?: Partial<VaultProps>) => {
31 |   return createStore<VaultState>()((set) => ({
32 |     ...DEFAULT_PROPS,
33 |     ...initProps,
34 |
35 |     deleteItem: (id) => {
36 |       set((state) => ({
37 |         data: state.data.filter((item) =>
38 |           item.isFolder ? item.name !== id : item.id !== id,
39 |         ),
40 |       }));
41 |     },
42 |
43 |     createFolder: (item) => {
44 |       set((state) => ({
45 |         data: [
46 |           ...state.data,
47 |           {
48 |             ...item,
49 |             isEditing: true,
50 |             isFolder: true,
51 |             id: item.name,
52 |           },
53 |         ],
54 |       }));
55 |     },
56 |
57 |     updateItem: (id, payload) => {
58 |       set((state) => {
59 |         return {
60 |           data: state.data.map((d) => (d.id === id ? { ...d, ...payload } : d)),
61 |         };
62 |       });
63 |     },
64 |   }));
65 | };
```

apps/docs/api-reference/engine/endpoint/auth-link-gocardless.mdx
```
1 | ---
2 | openapi: post /auth/gocardless/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/auth-link-plaid.mdx
```
1 | ---
2 | openapi: post /auth/plaid/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-account-balance.mdx
```
1 | ---
2 | openapi: get /accounts/balance
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-accounts.mdx
```
1 | ---
2 | openapi: get /accounts
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-accountsbalance.mdx
```
1 | ---
2 | openapi: get /accounts/balance
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-auth-link.mdx
```
1 | ---
2 | openapi: post /auth/gocardless/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-health.mdx
```
1 | ---
2 | openapi: get /health
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-institutionssearch.mdx
```
1 | ---
2 | openapi: get /institutions/search
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-link.mdx
```
1 | ---
2 | openapi: post /auth/plaid/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/get-transactions.mdx
```
1 | ---
2 | openapi: get /transactions
3 | ---
```

apps/docs/api-reference/engine/endpoint/gocardless-auth-link.mdx
```
1 | ---
2 | openapi: post /auth/gocardless/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/health.mdx
```
1 | ---
2 | openapi: get /health
3 | ---
```

apps/docs/api-reference/engine/endpoint/plaid-auth-link.mdx
```
1 | ---
2 | openapi: post /auth/plaid/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/post-authgocardlessexchange.mdx
```
1 | ---
2 | openapi: post /auth/gocardless/exchange
3 | ---
```

apps/docs/api-reference/engine/endpoint/post-authgocardlesslink.mdx
```
1 | ---
2 | openapi: post /auth/gocardless/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/post-authplaidexchange.mdx
```
1 | ---
2 | openapi: post /auth/plaid/exchange
3 | ---
```

apps/docs/api-reference/engine/endpoint/post-authplaidlink.mdx
```
1 | ---
2 | openapi: post /auth/plaid/link
3 | ---
```

apps/docs/api-reference/engine/endpoint/search-institutions.mdx
```
1 | ---
2 | openapi: get /institutions/search
3 | ---
```

apps/engine/src/providers/gocardless/gocardless-api.ts
```
1 | import { ProviderError } from "@/utils/error";
2 | import { logger } from "@/utils/logger";
3 | import { formatISO, subDays } from "date-fns";
4 | import xior from "xior";
5 | import type { XiorInstance, XiorRequestConfig } from "xior";
6 | import type { GetInstitutionsRequest, ProviderParams } from "../types";
7 | import type {
8 |   DeleteRequistionResponse,
9 |   GetAccessTokenResponse,
10 |   GetAccountBalanceResponse,
11 |   GetAccountDetailsResponse,
12 |   GetAccountResponse,
13 |   GetAccountsRequest,
14 |   GetAccountsResponse,
15 |   GetInstitutionResponse,
16 |   GetInstitutionsResponse,
17 |   GetRefreshTokenResponse,
18 |   GetRequisitionResponse,
19 |   GetRequisitionsResponse,
20 |   GetTransactionsRequest,
21 |   GetTransactionsResponse,
22 |   PostCreateAgreementResponse,
23 |   PostEndUserAgreementRequest,
24 |   PostRequisitionsRequest,
25 |   PostRequisitionsResponse,
26 | } from "./types";
27 | import { getAccessValidForDays, getMaxHistoricalDays, isError } from "./utils";
28 |
29 | export class GoCardLessApi {
30 |   #baseUrl = "https://bankaccountdata.gocardless.com";
31 |
32 |   // Cache keys
33 |   #accessTokenCacheKey = "gocardless_access_token";
34 |   #refreshTokenCacheKey = "gocardless_refresh_token";
35 |   #institutionsCacheKey = "gocardless_institutions";
36 |
37 |   #kv: KVNamespace;
38 |
39 |   #oneHour = 3600;
40 |
41 |   #secretKey;
42 |   #secretId;
43 |
44 |   constructor(params: Omit<ProviderParams, "provider">) {
45 |     this.#kv = params.kv;
46 |     this.#secretId = params.envs.GOCARDLESS_SECRET_ID;
47 |     this.#secretKey = params.envs.GOCARDLESS_SECRET_KEY;
48 |   }
49 |
50 |   async getHealthCheck() {
51 |     try {
52 |       await this.#get("/api/v2/swagger.json");
53 |
54 |       return true;
55 |     } catch {
56 |       return false;
57 |     }
58 |   }
59 |
60 |   async #getRefreshToken(refresh: string): Promise<string> {
61 |     const response = await this.#post<GetRefreshTokenResponse>(
62 |       "/api/v2/token/refresh/",
63 |       undefined,
64 |       {
65 |         refresh,
66 |       },
67 |     );
68 |
69 |     await this.#kv?.put(this.#accessTokenCacheKey, response.access, {
70 |       expirationTtl: response.access_expires - this.#oneHour,
71 |     });
72 |
73 |     return response.refresh;
74 |   }
75 |
76 |   async #getAccessToken(): Promise<string> {
77 |     const [accessToken, refreshToken] = await Promise.all([
78 |       this.#kv?.get(this.#accessTokenCacheKey),
79 |       this.#kv?.get(this.#refreshTokenCacheKey),
80 |     ]);
81 |
82 |     if (typeof accessToken === "string") {
83 |       return accessToken;
84 |     }
85 |
86 |     if (typeof refreshToken === "string") {
87 |       return this.#getRefreshToken(refreshToken);
88 |     }
89 |
90 |     const response = await this.#post<GetAccessTokenResponse>(
91 |       "/api/v2/token/new/",
92 |       undefined,
93 |       {
94 |         secret_id: this.#secretId,
95 |         secret_key: this.#secretKey,
96 |       },
97 |     );
98 |
99 |     try {
100 |       await Promise.all([
101 |         this.#kv?.put(this.#accessTokenCacheKey, response.access, {
102 |           expirationTtl: response.access_expires - this.#oneHour,
103 |         }),
104 |         this.#kv?.put(this.#refreshTokenCacheKey, response.refresh, {
105 |           expirationTtl: response.refresh_expires - this.#oneHour,
106 |         }),
107 |       ]);
108 |     } catch (error) {
109 |       logger("Error saving tokens");
110 |     }
111 |
112 |     return response.access;
113 |   }
114 |
115 |   async getAccountBalance(
116 |     accountId: string,
117 |   ): Promise<
118 |     GetAccountBalanceResponse["balances"][0]["balanceAmount"] | undefined
119 |   > {
120 |     const token = await this.#getAccessToken();
121 |
122 |     try {
123 |       const { balances } = await this.#get<GetAccountBalanceResponse>(
124 |         `/api/v2/accounts/${accountId}/balances/`,
125 |         token,
126 |       );
127 |
128 |       const foundInterimAvailable = balances?.find(
129 |         (account) =>
130 |           account.balanceType === "interimAvailable" ||
131 |           account.balanceType === "interimBooked",
132 |       );
133 |
134 |       // For some accounts, the interimAvailable balance is 0, so we need to use the expected balance
135 |       const foundExpectedAvailable = balances?.find(
136 |         (account) => account.balanceType === "expected",
137 |       );
138 |
139 |       return (
140 |         foundInterimAvailable?.balanceAmount ||
141 |         foundExpectedAvailable?.balanceAmount
142 |       );
143 |     } catch (error) {
144 |       const parsedError = isError(error);
145 |
146 |       if (parsedError) {
147 |         throw new ProviderError(parsedError);
148 |       }
149 |     }
150 |   }
151 |
152 |   async getInstitutions(
153 |     params?: GetInstitutionsRequest,
154 |   ): Promise<GetInstitutionsResponse> {
155 |     const countryCode = params?.countryCode;
156 |     const cacheKey = `${this.#institutionsCacheKey}_${countryCode}`;
157 |
158 |     const institutions = await this.#kv?.get(cacheKey);
159 |
160 |     if (institutions) {
161 |       return JSON.parse(institutions) as GetInstitutionsResponse;
162 |     }
163 |
164 |     const token = await this.#getAccessToken();
165 |
166 |     const response = await this.#get<GetInstitutionsResponse>(
167 |       "/api/v2/institutions/",
168 |       token,
169 |       undefined,
170 |       {
171 |         params: {
172 |           country: countryCode,
173 |         },
174 |       },
175 |     );
176 |
177 |     this.#kv?.put(cacheKey, JSON.stringify(response), {
178 |       expirationTtl: this.#oneHour,
179 |     });
180 |
181 |     if (countryCode) {
182 |       return response.filter((institution) =>
183 |         institution.countries.includes(countryCode),
184 |       );
185 |     }
186 |
187 |     return response;
188 |   }
189 |
190 |   async buildLink({
191 |     institutionId,
[TRUNCATED]
```

apps/engine/src/providers/gocardless/gocardless-provider.ts
```
1 | import type { Provider } from "../interface";
2 | import type {
3 |   DeleteAccountsRequest,
4 |   DeleteConnectionRequest,
5 |   GetAccountBalanceRequest,
6 |   GetAccountsRequest,
7 |   GetConnectionStatusRequest,
8 |   GetInstitutionsRequest,
9 |   GetTransactionsRequest,
10 |   ProviderParams,
11 | } from "../types";
12 | import { GoCardLessApi } from "./gocardless-api";
13 | import {
14 |   transformAccount,
15 |   transformAccountBalance,
16 |   transformConnectionStatus,
17 |   transformInstitution,
18 |   transformTransaction,
19 | } from "./transform";
20 |
21 | export class GoCardLessProvider implements Provider {
22 |   #api: GoCardLessApi;
23 |
24 |   constructor(params: Omit<ProviderParams, "provider">) {
25 |     this.#api = new GoCardLessApi(params);
26 |   }
27 |
28 |   async getHealthCheck() {
29 |     return this.#api.getHealthCheck();
30 |   }
31 |
32 |   async getTransactions({ accountId, latest }: GetTransactionsRequest) {
33 |     const response = await this.#api.getTransactions({
34 |       latest,
35 |       accountId,
36 |     });
37 |
38 |     return (response ?? []).map(transformTransaction);
39 |   }
40 |
41 |   async getAccounts({ id }: GetAccountsRequest) {
42 |     if (!id) {
43 |       throw Error("Missing params");
44 |     }
45 |
46 |     const response = await this.#api.getAccounts({ id });
47 |
48 |     return (response ?? []).map(transformAccount);
49 |   }
50 |
51 |   async getAccountBalance({ accountId }: GetAccountBalanceRequest) {
52 |     if (!accountId) {
53 |       throw Error("Missing params");
54 |     }
55 |
56 |     const response = await this.#api.getAccountBalance(accountId);
57 |
58 |     return transformAccountBalance(response);
59 |   }
60 |
61 |   async getInstitutions({ countryCode }: GetInstitutionsRequest) {
62 |     if (!countryCode) {
63 |       throw Error("Missing countryCode");
64 |     }
65 |
66 |     const response = await this.#api.getInstitutions({ countryCode });
67 |
68 |     return response.map(transformInstitution);
69 |   }
70 |
71 |   async deleteAccounts({ accountId }: DeleteAccountsRequest) {
72 |     if (!accountId) {
73 |       throw Error("Missing params");
74 |     }
75 |
76 |     await this.#api.deleteRequisition(accountId);
77 |   }
78 |
79 |   async getConnectionStatus({ id }: GetConnectionStatusRequest) {
80 |     if (!id) {
81 |       throw Error("Missing params");
82 |     }
83 |
84 |     const response = await this.#api.getRequestion(id);
85 |
86 |     return transformConnectionStatus(response);
87 |   }
88 |
89 |   async deleteConnection({ id }: DeleteConnectionRequest) {
90 |     if (!id) {
91 |       throw Error("Missing params");
92 |     }
93 |
94 |     await this.#api.deleteRequisition(id);
95 |   }
96 | }
```

apps/engine/src/providers/gocardless/transform.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import {
3 |   transformAccount,
4 |   transformAccountBalance,
5 |   transformTransaction,
6 | } from "./transform";
7 |
8 | test("Transform income transaction", () => {
9 |   expect(
10 |     transformTransaction({
11 |       transactionId:
12 |         "8wwecA0PsWWCLPLazQzht2oOcxSIQ5UlWPHaNBpC3tjYtc002faJcjWzRpyO4sjz66kRpb7_5rA",
13 |       entryReference: "5490990006",
14 |       bookingDate: "2024-02-23",
15 |       valueDate: "2024-02-23",
16 |       transactionAmount: {
17 |         amount: "-38000.00",
18 |         currency: "SEK",
19 |       },
20 |       additionalInformation: "LÖN         160434262327",
21 |       proprietaryBankTransactionCode: "Transfer",
22 |       internalTransactionId: "86b1bc36e6a6d2a5dee8ff7138920255",
23 |     }),
24 |   ).toMatchSnapshot();
25 | });
26 |
27 | test("Transform accounts", () => {
28 |   expect(
29 |     transformAccount({
30 |       id: "b11e5627-cac8-41c9-a74a-2b88438fe07d",
31 |       created: "2024-02-23T13:29:47.314568Z",
32 |       last_accessed: "2024-03-06T16:34:16.782598Z",
33 |       iban: "3133",
34 |       institution_id: "PLEO_PLEODK00",
35 |       status: "READY",
36 |       owner_name: "",
37 |       account: {
38 |         resourceId: "3133",
39 |         currency: "SEK",
40 |         name: "Pleo Account",
41 |         product: "Pleo",
42 |         cashAccountType: "TRAN",
43 |         iban: "123",
44 |         ownerName: "Name",
45 |       },
46 |       balance: {
47 |         currency: "SEK",
48 |         amount: "1942682.86",
49 |       },
50 |       institution: {
51 |         id: "PLEO_PLEODK00",
52 |         name: "Pleo",
53 |         bic: "PLEODK00",
54 |         transaction_total_days: "90",
55 |         countries: ["DK", "GB", "DE", "SE", "ES", "IE", "DK"],
56 |         logo: "https://cdn-logos.gocardless.com/ais/PLEO_PLEODK00.png",
57 |       },
58 |     }),
59 |   ).toMatchSnapshot();
60 | });
61 |
62 | test("Transform account balance", () => {
63 |   expect(
64 |     transformAccountBalance({
65 |       currency: "SEK",
66 |       amount: "1942682.86",
67 |     }),
68 |   ).toMatchSnapshot();
69 | });
```

apps/engine/src/providers/gocardless/transform.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { getFileExtension, getLogoURL } from "@/utils/logo";
3 | import { capitalCase } from "change-case";
4 | import type {
5 |   Account as BaseAccount,
6 |   Balance as BaseAccountBalance,
7 |   Transaction as BaseTransaction,
8 |   ConnectionStatus,
9 | } from "../types";
10 | import type {
11 |   GetRequisitionResponse,
12 |   Institution,
13 |   Transaction,
14 |   TransactionDescription,
15 |   TransformAccount,
16 |   TransformAccountBalance,
17 |   TransformAccountName,
18 |   TransformInstitution,
19 |   TransformTransaction,
20 | } from "./types";
21 |
22 | export const mapTransactionCategory = (transaction: Transaction) => {
23 |   if (+transaction.transactionAmount.amount > 0) {
24 |     return "income";
25 |   }
26 |
27 |   if (transaction?.proprietaryBankTransactionCode === "Transfer") {
28 |     return "transfer";
29 |   }
30 |
31 |   return null;
32 | };
33 |
34 | export const mapTransactionMethod = (type?: string) => {
35 |   switch (type) {
36 |     case "Payment":
37 |     case "Bankgiro payment":
38 |     case "Incoming foreign payment":
39 |       return "payment";
40 |     case "Card purchase":
41 |     case "Card foreign purchase":
42 |       return "card_purchase";
43 |     case "Card ATM":
44 |       return "card_atm";
45 |     case "Transfer":
46 |       return "transfer";
47 |     default:
48 |       return "other";
49 |   }
50 | };
51 |
52 | export const transformTransactionName = (transaction: Transaction) => {
53 |   if (transaction?.creditorName) {
54 |     return capitalCase(transaction.creditorName);
55 |   }
56 |
57 |   if (transaction?.debtorName) {
58 |     return capitalCase(transaction?.debtorName);
59 |   }
60 |
61 |   if (transaction?.additionalInformation) {
62 |     return capitalCase(transaction.additionalInformation);
63 |   }
64 |
65 |   if (transaction?.remittanceInformationStructured) {
66 |     return capitalCase(transaction.remittanceInformationStructured);
67 |   }
68 |
69 |   if (transaction?.remittanceInformationUnstructured) {
70 |     return capitalCase(transaction.remittanceInformationUnstructured);
71 |   }
72 |
73 |   const remittanceInformation =
74 |     transaction?.remittanceInformationUnstructuredArray?.at(0);
75 |
76 |   if (remittanceInformation) {
77 |     return capitalCase(remittanceInformation);
78 |   }
79 |
80 |   console.log("No transaction name", transaction);
81 |
82 |   // When there is no name, we use the proprietary bank transaction code (Service Fee)
83 |   if (transaction.proprietaryBankTransactionCode) {
84 |     return transaction.proprietaryBankTransactionCode;
85 |   }
86 |
87 |   return "No information";
88 | };
89 |
90 | const transformDescription = ({
91 |   transaction,
92 |   name,
93 | }: TransactionDescription) => {
94 |   if (transaction?.remittanceInformationUnstructuredArray?.length) {
95 |     const text = transaction?.remittanceInformationUnstructuredArray.join(" ");
96 |     const description = capitalCase(text);
97 |
98 |     // NOTE: Sometimes the description is the same as name
99 |     // Let's skip that and just save if they are not the same
100 |     if (description !== name) {
101 |       return description;
102 |     }
103 |   }
104 |
105 |   const additionalInformation =
106 |     transaction.additionalInformation &&
107 |     capitalCase(transaction.additionalInformation);
108 |
109 |   if (additionalInformation !== name) {
110 |     return additionalInformation;
111 |   }
112 |
113 |   return null;
114 | };
115 |
116 | export const transformTransaction = (
117 |   transaction: TransformTransaction,
118 | ): BaseTransaction => {
119 |   const method = mapTransactionMethod(
120 |     transaction?.proprietaryBankTransactionCode,
121 |   );
122 |
123 |   let currencyExchange: { rate: number; currency: string } | undefined;
124 |
125 |   if (Array.isArray(transaction.currencyExchange)) {
126 |     const rate = Number.parseFloat(
127 |       transaction.currencyExchange.at(0)?.exchangeRate ?? "",
128 |     );
129 |
130 |     if (rate) {
131 |       const currency = transaction?.currencyExchange?.at(0)?.sourceCurrency;
132 |
133 |       if (currency) {
134 |         currencyExchange = {
135 |           rate,
136 |           currency: currency.toUpperCase(),
137 |         };
138 |       }
139 |     }
140 |   }
141 |
142 |   const name = transformTransactionName(transaction);
143 |   const description = transformDescription({ transaction, name }) ?? null;
144 |   const balance = transaction?.balanceAfterTransaction?.balanceAmount?.amount
145 |     ? +transaction.balanceAfterTransaction.balanceAmount.amount
146 |     : null;
147 |
148 |   return {
149 |     id: transaction.internalTransactionId,
150 |     date: transaction.bookingDate,
151 |     name,
152 |     method,
153 |     amount: +transaction.transactionAmount.amount,
154 |     currency: transaction.transactionAmount.currency,
155 |     category: mapTransactionCategory(transaction),
156 |     currency_rate: currencyExchange?.rate || null,
157 |     currency_source: currencyExchange?.currency?.toUpperCase() || null,
158 |     balance,
159 |     description,
160 |     status: "posted",
161 |   };
162 | };
163 |
164 | const transformAccountName = (account: TransformAccountName) => {
165 |   // First try to use the name from the account
166 |   if (account?.name) {
167 |     return capitalCase(account.name);
168 |   }
169 |
170 |   // Then try to use the product
171 |   if (account?.product) {
172 |     return account.product;
173 |   }
174 |
175 |   // Then try to use the institution name
176 |   if (account?.institution?.name) {
177 |     return `${account.institution.name} (${account.currency.toUpperCase()})`;
178 |   }
179 |
180 |   // Last use a default name
181 |   return "No name";
182 | };
183 |
184 | export const transformAccount = ({
185 |   id,
186 |   account,
187 |   balance,
188 |   institution,
[TRUNCATED]
```

apps/engine/src/providers/gocardless/types.ts
```
1 | import type { Balance, Providers } from "../types";
2 |
3 | export type Transaction = {
4 |   transactionAmount: { amount: string; currency: string };
5 |   currencyExchange?: {
6 |     exchangeRate: string;
7 |     targetCurrency: string;
8 |     sourceCurrency: string;
9 |   }[];
10 |   remittanceInformationStructured?: string;
11 |   remittanceInformationStructuredArray?: string[];
12 |   remittanceInformationUnstructured?: string;
13 |   remittanceInformationUnstructuredArray?: string[];
14 |   proprietaryBankTransactionCode?: string;
15 |   entryReference?: string;
16 |   transactionId?: string;
17 |   internalTransactionId: string;
18 |   bookingDate: string;
19 |   valueDate?: string;
20 |   additionalInformation?: string;
21 |   creditorName?: string;
22 |   creditorAccount?: { iban?: string };
23 |   debtorName?: string;
24 |   debtorAccount?: { iban?: string };
25 |   balanceAfterTransaction?: {
26 |     balanceAmount?: {
27 |       amount: string;
28 |     };
29 |   };
30 | };
31 |
32 | export type Institution = {
33 |   id: string;
34 |   name: string;
35 |   bic: string;
36 |   transaction_total_days: string;
37 |   logo: string;
38 |   countries: string[];
39 | };
40 |
41 | export type GetRefreshTokenResponse = {
42 |   access: string;
43 |   access_expires: number;
44 |   refresh: string;
45 |   refresh_expires: number;
46 | };
47 |
48 | export type GetAccessTokenResponse = {
49 |   access: string;
50 |   access_expires: number;
51 |   refresh: string;
52 |   refresh_expires: number;
53 | };
54 |
55 | export type GetInstitutionsResponse = Institution[];
56 | export type GetInstitutionResponse = Institution;
57 |
58 | export type PostRequisitionsRequest = {
59 |   institutionId: string;
60 |   agreement: string;
61 |   redirect: string;
62 |   reference?: string;
63 | };
64 |
65 | export type PostEndUserAgreementRequest = {
66 |   institutionId: string;
67 |   transactionTotalDays: number;
68 | };
69 |
70 | export type PostRequisitionsResponse = {
71 |   id: string;
72 |   created: string;
73 |   redirect: string;
74 |   status: string;
75 |   institution_id: string;
76 |   agreement: string;
77 |   reference: string;
78 |   accounts: string[];
79 |   link: string;
80 |   ssn: string | null;
81 |   account_selection: boolean;
82 |   redirect_immediate: boolean;
83 | };
84 |
85 | export type PostCreateAgreementResponse = {
86 |   id: string;
87 |   created: string;
88 |   institution_id: string;
89 |   max_historical_days: number;
90 |   access_valid_for_days: number;
91 |   access_scope: string[];
92 |   accepted: boolean;
93 | };
94 |
95 | export type GetAccountResponse = {
96 |   id: string;
97 |   created: string;
98 |   last_accessed: string;
99 |   iban?: string;
100 |   institution_id: string;
101 |   status: string;
102 |   owner_name?: string;
103 | };
104 |
105 | export type Account = {
106 |   resourceId: string;
107 |   iban: string;
108 |   currency: string;
109 |   ownerName: string;
110 |   name: string;
111 |   product: string;
112 |   cashAccountType: string;
113 | };
114 |
115 | export type AccountDetails = {
116 |   account: Account;
117 | };
118 |
119 | export type GetAccountDetailsResponse = GetAccountResponse & AccountDetails;
120 |
121 | export type GetAccountsRequest = {
122 |   id: string;
123 | };
124 |
125 | export type Requestion = {
126 |   id: string;
127 |   created: string;
128 |   redirect: string;
129 |   status: "CR" | "GC" | "UA" | "RJ" | "SA" | "GA" | "LN" | "EX";
130 |   institution_id: string;
131 |   agreement: string;
132 |   reference: string;
133 |   accounts: string[];
134 |   user_language: string;
135 |   link: string;
136 |   ssn: string;
137 |   account_selection: boolean;
138 |   redirect_immediate: boolean;
139 | };
140 |
141 | export type GetRequisitionResponse = Requestion;
142 |
143 | export type GetRequisitionsResponse = {
144 |   count: number;
145 |   next: string;
146 |   previous: string;
147 |   results: Requestion[];
148 | };
149 |
150 | export type DeleteRequistionResponse = {
151 |   summary: string;
152 |   detail: string;
153 |   status_code: number;
154 | };
155 |
156 | export type GetBalanceRequest = {
157 |   amount: string;
158 |   currency: string;
159 | };
160 |
161 | export type GetAccountsResponse = {
162 |   id: string;
163 |   created: string;
164 |   last_accessed: string;
165 |   iban?: string;
166 |   institution_id: string;
167 |   status: string;
168 |   owner_name?: string;
169 |   account: Account;
170 |   balance?: GetBalanceRequest;
171 |   institution: Institution;
172 |   resourceId?: string;
173 | }[];
174 |
175 | export type GetTransactionsRequest = {
176 |   accountId: string;
177 |   latest?: boolean;
178 | };
179 |
180 | export type GetTransactionsResponse = {
181 |   transactions: {
182 |     booked: Transaction[];
183 |     posted: Transaction[];
184 |   };
185 | };
186 |
187 | export type TransactionDescription = {
188 |   transaction: Transaction;
189 |   name?: string;
190 | };
191 |
192 | export type TransformTransaction = Transaction;
193 |
194 | export type TransformInstitution = {
195 |   id: string;
196 |   name: string;
197 |   logo: string | null;
198 |   provider: Providers;
199 | };
200 |
201 | export type TransformAccount = GetAccountsResponse[0];
202 |
203 | export type TransformAccountName = {
[TRUNCATED]
```

apps/engine/src/providers/gocardless/utils.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import { getAccessValidForDays, getMaxHistoricalDays } from "./utils";
3 |
4 | test("Should return 90 days", () => {
5 |   expect(
6 |     getMaxHistoricalDays({
7 |       institutionId: "SWEDBANK_SWEDSESS",
8 |       transactionTotalDays: 720,
9 |     }),
10 |   ).toEqual(90);
11 | });
12 |
13 | test("Should return 720 days", () => {
14 |   expect(
15 |     getMaxHistoricalDays({
16 |       institutionId: "NOT_RESTRICTED",
17 |       transactionTotalDays: 720,
18 |     }),
19 |   ).toEqual(720);
20 | });
21 |
22 | test("Should return 90 days", () => {
23 |   expect(
24 |     getAccessValidForDays({
25 |       institutionId: "CUMBERLAND_CMBSGB2A",
26 |     }),
27 |   ).toEqual(90);
28 | });
29 |
30 | test("Should return 720 days", () => {
31 |   expect(
32 |     getAccessValidForDays({
33 |       institutionId: "NOT_RESTRICTED",
34 |     }),
35 |   ).toEqual(180);
36 | });
```

apps/engine/src/providers/gocardless/utils.ts
```
1 | export function isError(error: unknown) {
2 |   if (!error) return false;
3 |
4 |   const goCardLessError = error as {
5 |     response: {
6 |       data: {
7 |         summary: string;
8 |         detail: string;
9 |         type?: string;
10 |       };
11 |     };
12 |   };
13 |
14 |   return {
15 |     code:
16 |       goCardLessError.response.data.type ||
17 |       goCardLessError.response.data.summary,
18 |     message: goCardLessError.response.data.detail,
19 |   };
20 | }
21 |
22 | type GetMaxHistoricalDays = {
23 |   transactionTotalDays: number;
24 |   institutionId: string;
25 | };
26 |
27 | // https://bankaccountdata.zendesk.com/hc/en-gb/articles/11529718632476-Extended-history-and-continuous-access-edge-cases
28 | export function getMaxHistoricalDays({
29 |   transactionTotalDays,
30 |   institutionId,
31 | }: GetMaxHistoricalDays) {
32 |   const RESTRICTED_TO_90DAYS = [
33 |     "BRED_BREDFRPP",
34 |     "SWEDBANK_SWEDSESS",
35 |     "INDUSTRA_MULTLV2X",
36 |     "MEDICINOSBANK_MDBALT22",
37 |     "CESKA_SPORITELNA_LONG_GIBACZPX",
38 |     "LHV_LHVBEE22",
39 |     "BRED_BREDFRPP",
40 |     "LABORALKUTXA_CLPEES2M",
41 |     "BANKINTER_BKBKESMM",
42 |     "CAIXABANK_CAIXESBB",
43 |     "JEKYLL_JEYKLL002",
44 |     "SANTANDER_DE_SCFBDE33",
45 |     "BBVA_BBVAESMM",
46 |     "BANCA_AIDEXA_AIDXITMM",
47 |     "BANCA_PATRIMONI_SENVITT1",
48 |     "BANCA_SELLA_SELBIT2B",
49 |     "CARTALIS_CIMTITR1",
50 |     "DOTS_HYEEIT22",
51 |     "HYPE_BUSINESS_HYEEIT22",
52 |     "HYPE_HYEEIT2",
53 |     "ILLIMITY_ITTPIT2M",
54 |     "SMARTIKA_SELBIT22",
55 |     "TIM_HYEEIT22",
56 |     "TOT_SELBIT2B",
57 |     "OPYN_BITAITRRB2B",
58 |     "PAYTIPPER_PAYTITM1",
59 |     "SELLA_PERSONAL_CREDIT_SELBIT22",
60 |     // "LUMINOR_", TODO: Fix based on country (all countries)
61 |     // 'SEB_', (Baltics)
62 |   ];
63 |
64 |   const RESTRICTED_TO_180DAYS = ["COOP_EKRDEE22"];
65 |
66 |   if (RESTRICTED_TO_90DAYS.some((str) => str.startsWith(institutionId))) {
67 |     return 90;
68 |   }
69 |
70 |   if (RESTRICTED_TO_180DAYS.some((str) => str.startsWith(institutionId))) {
71 |     return 180;
72 |   }
73 |
74 |   return transactionTotalDays;
75 | }
76 |
77 | type GetAccessValidForDays = {
78 |   institutionId: string;
79 | };
80 |
81 | export function getAccessValidForDays({
82 |   institutionId,
83 | }: GetAccessValidForDays) {
84 |   const RESTRICTED_TO_90DAYS = [
85 |     "CUMBERLAND_CMBSGB2A",
86 |     "NEWDAY_AMAZON_NEWDUK00X01",
87 |     "NEWDAY_NEWPAY_NEWDUK00X15",
88 |     "NEWDAY_BIP_NEWDUK00X05",
89 |     "NEWDAY_ARGOS_NEWDUK00X04",
90 |     "NEWDAY_MARBLES_NEWDUK00X13",
91 |     "NEWDAY_WALLIS_NEWDUK00X21",
92 |     "NEWDAY_HOUSEOFFRASER_NEWDUK00X11",
93 |     "NEWDAY_EVANS_NEWDUK00X09",
94 |     "NEWDAY_BURTON_NEWDUK00X06",
95 |     "NEWDAY_AQUA_NEWDUK00X02",
96 |     "NEWDAY_TUI_NEWDUK00X20",
97 |     "NEWDAY_DEBENHAMS_NEWDUK00X07",
98 |     "NEWDAY_OPUS_NEWDUK00X16",
99 |     "NEWDAY_FLUID_NEWDUK00X10",
100 |     "NEWDAY_PULSE_NEWDUK00X17",
101 |     "NEWDAY_DOROTHYPERKINS_NEWDUK00X08",
102 |     "CATER_ALLEN_CATEGB21",
103 |     "ONEPAY_1PAYGB00",
104 |     "BANK_OF_IRELAND_BUSINESS_ONLINE_BOFIGB2B",
105 |     "BANK_OF_IRELAND_B365_BOFIGB2B",
106 |     "LOMBARD_ODIER_GB_LOCYGB2L",
107 |     "HOARES_HOABGB2L",
108 |     "CHASE_CHASGB2L",
109 |     "ABNAMRO_ABNAGB2L",
110 |     "UBS_UBSWGB2L",
111 |     "CAXTON_CAXTGB2L",
112 |     "EBURY_EBURGB2L",
113 |     "COUTTS_COUTGB22",
114 |     "ALPHA_FX_APAHGB2L",
115 |     "CYNERGY_BCYPGB2L",
116 |     "CASHPLUS_NWBKGB2L",
117 |     "MONZO_MONZGB2L",
118 |     "HANDELSBANKEN_HANDGB22",
119 |     "HANDELSBANKEN_CORPORATE_HANDGB22",
120 |     "SAINSBURYS_SANBGB21",
121 |     "TESCOBANK_TPFGGB2E",
122 |     "BBVAUK_BBVAGB2L",
123 |     "STARLING_SRLGGB3L",
124 |     "REVOLUT_REVOGB21",
125 |     "SANTANDER_GB_ABBYGB2L",
126 |     "TIDE_TIDEGB00X01",
127 |     "SVB_SVBKGB2L",
128 |     "FIRST_DIRECT_MIDLGB22",
129 |     "MNS_MSFEGB21",
130 |     "HSBC_KINETIC_HBUKGB4B",
131 |     "HSBC_BUSINESS_HBUKGB4B",
132 |     "HSBC_HBUKGB4B",
133 |     "HSBC_NET_HBUKGB4B",
134 |     "ARBUTHNOT_LATHAM_ARBUGB2L",
135 |     "CHE_CHELGB21",
136 |     "YBS_YORBGB2V",
137 |     "NATWEST_NWBKGB2L",
138 |     "RBS_GB_RBSSGBKC",
139 |     "NATWEST_CORP_NWBKGB2L",
140 |     "ADAM_COMPANY_ACIMGB21",
141 |     "RBS_GB_CORP_RBSSGBKC",
142 |     "RBS_GB_CS_RBSSGBKC",
143 |     "NATWEST_CS_NWBKGB2L",
144 |     "ULSTER_ULSBGB2B",
145 |     "NATWEST_INTERNATONAL_RBOSGIGI",
146 |     "VANQUIS_VQISGB21",
147 |     "NATIONWIDE_NAIAGB21",
148 |     "CAPITALONE_NFBKUSF1",
149 |     "DANSKEBANK_DABAGB2B",
150 |     "DANSKEBANK_BUSINESS_DABAGB2B",
151 |     "UNION_UBPGGB2X",
152 |     "WISE_TRWIGB22",
153 |     "TRIODOS_TRIOGB22",
154 |     "AMERICAN_EXPRESS_AESUGB21",
155 |     "BARCLAYS_CORPORATE_BUKBGB22",
156 |     "BARCLAYS_BUSINESS_BUKBGB22",
157 |     "BARCLAYCARD_COMMERCIAL_BUKBGB22",
158 |     "BARCLAYCARD_BUKBGB22",
159 |     "BARCLAYS_BUKBGB22",
160 |     "BARCLAYS_WEALTH_BUKBGB22",
161 |     "VIRGIN_NRNBGB22",
162 |     "GLOBALREACH_GRPLGB2L",
163 |     "COOPERATIVE_CPBKGB22",
164 |     "UNITY_TRUST_UYTBGB22",
165 |     "AIRWALLEX_AIPTAU32",
166 |     "SOLDO_SOAVGB21",
167 |     "GOHENRY_IDFEGIG1",
168 |     "GHANA_GHIBGB2L",
169 |     "THINKMONEY_THKMGB21",
170 |     "METTLE_NWBKGB2L",
171 |     "HARGREAVES_LANSDOWN_HLSVGB22",
172 |     "MONESE_MNEEGB21",
173 |     "TSB_GB_TSBSGB2A",
174 |     "AIB_FTBKGB2B",
175 |     "AIB_AIBKGB2L",
176 |     "AIB_CORP_AIBKGB2L",
177 |     "FINECO_UK_FEBIITM2",
178 |     "CREDITSUISSE_CSUKGB2L",
179 |     "SMBC_SMBCGB2L",
180 |     "MBNA_MBNAGB22",
181 |     "LLOYDS_COMMERCIAL_LOYDGB2L",
182 |     "LLOYDS_BUSINESS_LOYDGB2L",
183 |     "BANK_OF_SCOTLAND_BOFSGBS1",
184 |     "BANK_OF_SCOTLAND_BUSINESS_BOFSGBS1",
[TRUNCATED]
```

apps/engine/src/providers/plaid/plaid-api.ts
```
1 | import { PLAID_COUNTRIES } from "@/utils/countries";
2 | import { ProviderError } from "@/utils/error";
3 | import { logger } from "@/utils/logger";
4 | import { paginate } from "@/utils/paginate";
5 | import { withRetry } from "@/utils/retry";
6 | import {
7 |   Configuration,
8 |   type CountryCode,
9 |   type ItemPublicTokenExchangeResponse,
10 |   type LinkTokenCreateResponse,
11 |   PlaidApi as PlaidBaseApi,
12 |   PlaidEnvironments,
13 |   Products,
14 |   type Transaction,
15 | } from "plaid";
16 | import type {
17 |   ConnectionStatus,
18 |   GetInstitutionsRequest,
19 |   ProviderParams,
20 | } from "../types";
21 | import type {
22 |   DisconnectAccountRequest,
23 |   GetAccountBalanceRequest,
24 |   GetAccountBalanceResponse,
25 |   GetAccountsRequest,
26 |   GetAccountsResponse,
27 |   GetConnectionStatusRequest,
28 |   GetStatusResponse,
29 |   GetTransactionsRequest,
30 |   GetTransactionsResponse,
31 |   ItemPublicTokenExchangeRequest,
32 |   LinkTokenCreateRequest,
33 | } from "./types";
34 | import { isError } from "./utils";
35 |
36 | export class PlaidApi {
37 |   #client: PlaidBaseApi;
38 |   #clientId: string;
39 |   #clientSecret: string;
40 |
41 |   #countryCodes = PLAID_COUNTRIES as CountryCode[];
42 |
43 |   constructor(params: Omit<ProviderParams, "provider">) {
44 |     this.#clientId = params.envs.PLAID_CLIENT_ID;
45 |     this.#clientSecret = params.envs.PLAID_SECRET;
46 |
47 |     const configuration = new Configuration({
48 |       basePath:
49 |         PlaidEnvironments[params.envs.PLAID_ENVIRONMENT || "production"],
50 |       baseOptions: {
51 |         headers: {
52 |           "PLAID-CLIENT-ID": this.#clientId,
53 |           "PLAID-SECRET": this.#clientSecret,
54 |         },
55 |       },
56 |     });
57 |
58 |     this.#client = new PlaidBaseApi(configuration);
59 |   }
60 |
61 |   #generateWebhookUrl(environment: "sandbox" | "production") {
62 |     if (environment === "sandbox") {
63 |       return "https://staging.app.midday.ai/api/webhook/plaid";
64 |     }
65 |
66 |     return "https://app.midday.ai/api/webhook/plaid";
67 |   }
68 |
69 |   async getHealthCheck() {
70 |     try {
71 |       const response = await fetch(
72 |         "https://status.plaid.com/api/v2/status.json",
73 |       );
74 |
75 |       const data = (await response.json()) as GetStatusResponse;
76 |
77 |       return (
78 |         data.status.indicator === "none" ||
79 |         data.status.indicator === "maintenance"
80 |       );
81 |     } catch {
82 |       return false;
83 |     }
84 |   }
85 |
86 |   async getAccountBalance({
87 |     accessToken,
88 |     accountId,
89 |   }: GetAccountBalanceRequest): Promise<GetAccountBalanceResponse | undefined> {
90 |     try {
91 |       const accounts = await this.#client.accountsGet({
92 |         access_token: accessToken,
93 |         options: {
94 |           account_ids: [accountId],
95 |         },
96 |       });
97 |
98 |       return accounts.data.accounts.at(0)?.balances;
99 |     } catch (error) {
100 |       const parsedError = isError(error);
101 |
102 |       if (parsedError) {
103 |         throw new ProviderError(parsedError);
104 |       }
105 |     }
106 |   }
107 |
108 |   async getAccounts({
109 |     accessToken,
110 |     institutionId,
111 |   }: GetAccountsRequest): Promise<GetAccountsResponse | undefined> {
112 |     try {
113 |       const accounts = await this.#client.accountsGet({
114 |         access_token: accessToken,
115 |       });
116 |
117 |       const institution = await this.institutionsGetById(institutionId);
118 |
119 |       return accounts.data.accounts.map((account) => ({
120 |         ...account,
121 |         institution: {
122 |           id: institution.data.institution.institution_id,
123 |           name: institution.data.institution.name,
124 |         },
125 |       }));
126 |     } catch (error) {
127 |       const parsedError = isError(error);
128 |
129 |       if (parsedError) {
130 |         throw new ProviderError(parsedError);
131 |       }
132 |     }
133 |   }
134 |
135 |   async getTransactions({
136 |     accessToken,
137 |     accountId,
138 |     latest,
139 |   }: GetTransactionsRequest): Promise<GetTransactionsResponse | undefined> {
140 |     let added: Array<Transaction> = [];
141 |     let cursor = undefined;
142 |     let hasMore = true;
143 |     try {
144 |       if (latest) {
145 |         const { data } = await this.#client.transactionsSync({
146 |           access_token: accessToken,
147 |           count: 100,
148 |         });
149 |
150 |         added = added.concat(data.added);
151 |       } else {
152 |         while (hasMore) {
153 |           const { data } = await this.#client.transactionsSync({
154 |             access_token: accessToken,
155 |             cursor,
156 |           });
157 |
158 |           added = added.concat(data.added);
159 |           hasMore = data.has_more;
160 |           cursor = data.next_cursor;
161 |         }
162 |       }
163 |
164 |       // NOTE: Plaid transactions for all accounts
165 |       // we need to filter based on the provided accountId and pending status
166 |       return added
167 |         .filter((transaction) => transaction.account_id === accountId)
168 |         .filter((transaction) => !transaction.pending);
169 |     } catch (error) {
170 |       const parsedError = isError(error);
171 |
172 |       if (parsedError) {
173 |         throw new ProviderError(parsedError);
174 |       }
175 |     }
176 |   }
177 |
178 |   async linkTokenCreate({
179 |     userId,
180 |     language = "en",
181 |     accessToken,
182 |     environment = "production",
183 |   }: LinkTokenCreateRequest): Promise<
184 |     import("axios").AxiosResponse<LinkTokenCreateResponse>
185 |   > {
186 |     return this.#client.linkTokenCreate({
187 |       client_id: this.#clientId,
188 |       secret: this.#clientSecret,
[TRUNCATED]
```

apps/engine/src/providers/plaid/plaid-provider.ts
```
1 | import type { Provider } from "../interface";
2 | import type {
3 |   DeleteAccountsRequest,
4 |   DeleteConnectionRequest,
5 |   GetAccountBalanceRequest,
6 |   GetAccountsRequest,
7 |   GetConnectionStatusRequest,
8 |   GetInstitutionsRequest,
9 |   GetTransactionsRequest,
10 |   ProviderParams,
11 | } from "../types";
12 | import { PlaidApi } from "./plaid-api";
13 | import {
14 |   transformAccount,
15 |   transformAccountBalance,
16 |   transformInstitution,
17 |   transformTransaction,
18 | } from "./transform";
19 |
20 | export class PlaidProvider implements Provider {
21 |   #api: PlaidApi;
22 |
23 |   constructor(params: Omit<ProviderParams, "provider">) {
24 |     this.#api = new PlaidApi(params);
25 |   }
26 |
27 |   async getTransactions({
28 |     accessToken,
29 |     accountId,
30 |     accountType,
31 |     latest,
32 |   }: GetTransactionsRequest) {
33 |     if (!accessToken || !accountId) {
34 |       throw Error("accessToken or accountId is missing");
35 |     }
36 |
37 |     const response = await this.#api.getTransactions({
38 |       accessToken,
39 |       accountId,
40 |       latest,
41 |     });
42 |
43 |     return (response ?? []).map((transaction) =>
44 |       transformTransaction({
45 |         transaction,
46 |         accountType,
47 |       }),
48 |     );
49 |   }
50 |
51 |   async getHealthCheck() {
52 |     return this.#api.getHealthCheck();
53 |   }
54 |
55 |   async getAccounts({ accessToken, institutionId }: GetAccountsRequest) {
56 |     if (!accessToken || !institutionId) {
57 |       throw Error("accessToken or institutionId is missing");
58 |     }
59 |
60 |     const response = await this.#api.getAccounts({
61 |       accessToken,
62 |       institutionId,
63 |     });
64 |
65 |     return (response ?? []).map(transformAccount);
66 |   }
67 |
68 |   async getAccountBalance({
69 |     accessToken,
70 |     accountId,
71 |   }: GetAccountBalanceRequest) {
72 |     if (!accessToken || !accountId) {
73 |       throw Error("Missing params");
74 |     }
75 |
76 |     const response = await this.#api.getAccountBalance({
77 |       accessToken,
78 |       accountId,
79 |     });
80 |
81 |     return transformAccountBalance(response);
82 |   }
83 |
84 |   async getInstitutions({ countryCode }: GetInstitutionsRequest) {
85 |     const response = await this.#api.getInstitutions({
86 |       countryCode,
87 |     });
88 |
89 |     return response.map(transformInstitution);
90 |   }
91 |
92 |   async deleteAccounts({ accessToken }: DeleteAccountsRequest) {
93 |     if (!accessToken) {
94 |       throw Error("accessToken is missing");
95 |     }
96 |
97 |     await this.#api.deleteAccounts({
98 |       accessToken,
99 |     });
100 |   }
101 |
102 |   async getConnectionStatus({ accessToken }: GetConnectionStatusRequest) {
103 |     if (!accessToken) {
104 |       throw Error("accessToken is missing");
105 |     }
106 |
107 |     const response = await this.#api.getConnectionStatus({ accessToken });
108 |
109 |     return response;
110 |   }
111 |
112 |   async deleteConnection({ accessToken }: DeleteConnectionRequest) {
113 |     if (!accessToken) {
114 |       throw Error("accessToken is missing");
115 |     }
116 |
117 |     await this.#api.deleteAccounts({ accessToken });
118 |   }
119 | }
```

apps/engine/src/providers/plaid/transform.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import {
3 |   AccountSubtype,
4 |   AccountType,
5 |   CounterpartyType,
6 |   TransactionCode,
7 |   TransactionPaymentChannelEnum,
8 |   TransactionTransactionTypeEnum,
9 | } from "plaid";
10 | import {
11 |   transformAccount,
12 |   transformAccountBalance,
13 |   transformTransaction,
14 | } from "./transform";
15 |
16 | test("Transform pending transaction", () => {
17 |   expect(
18 |     transformTransaction({
19 |       accountType: "credit",
20 |       transaction: {
21 |         account_id: "AG7EkLW7DRSVaN8Z75jMT1DJN51QpWc9LKB7w",
22 |         account_owner: null,
23 |         amount: 5.4,
24 |         authorized_date: "2024-02-23",
25 |         authorized_datetime: null,
26 |         category: ["Travel", "Taxi"],
27 |         category_id: "22016000",
28 |         check_number: null,
29 |         counterparties: [
30 |           {
31 |             confidence_level: "VERY_HIGH",
32 |             entity_id: "eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd",
33 |             logo_url: "https://plaid-merchant-logos.plaid.com/uber_1060.png",
34 |             name: "Uber",
35 |             type: CounterpartyType.Merchant,
36 |             website: "uber.com",
37 |           },
38 |         ],
39 |         date: "2024-02-24",
40 |         datetime: null,
41 |         iso_currency_code: "CAD",
42 |         location: {
43 |           address: null,
44 |           city: null,
45 |           country: null,
46 |           lat: null,
47 |           lon: null,
48 |           postal_code: null,
49 |           region: null,
50 |           store_number: null,
51 |         },
52 |         logo_url: "https://plaid-merchant-logos.plaid.com/uber_1060.png",
53 |         merchant_entity_id: "eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd",
54 |         merchant_name: "Uber",
55 |         name: "Uber 063015 SF**POOL**",
56 |         payment_channel: TransactionPaymentChannelEnum.Online,
57 |         payment_meta: {
58 |           by_order_of: null,
59 |           payee: null,
60 |           payer: null,
61 |           payment_method: null,
62 |           payment_processor: null,
63 |           ppd_id: null,
64 |           reason: null,
65 |           reference_number: null,
66 |         },
67 |         pending: true,
68 |         pending_transaction_id: null,
69 |         personal_finance_category: {
70 |           confidence_level: "VERY_HIGH",
71 |           detailed: "TRANSPORTATION_TAXIS_AND_RIDE_SHARES",
72 |           primary: "TRANSPORTATION",
73 |         },
74 |         personal_finance_category_icon_url:
75 |           "https://plaid-category-icons.plaid.com/PFC_TRANSPORTATION.png",
76 |         transaction_code: null,
77 |         transaction_id: "NxkDjlyk45cQoDm5PEqJuKJaw6qrj9cy89zBA",
78 |         transaction_type: TransactionTransactionTypeEnum.Special,
79 |         unofficial_currency_code: null,
80 |         website: "uber.com",
81 |       },
82 |     }),
83 |   ).toMatchSnapshot();
84 | });
85 |
86 | test("Transform income transaction", () => {
87 |   expect(
88 |     transformTransaction({
89 |       accountType: "depository",
90 |       transaction: {
91 |         account_id: "AG7EkLW7DRSVaN8Z75jMT1DJN51QpWc9LKB7w",
92 |         account_owner: null,
93 |         amount: 1500,
94 |         authorized_date: "2024-02-22",
95 |         authorized_datetime: null,
96 |         category: ["Travel", "Airlines and Aviation Services"],
97 |         category_id: "22001000",
98 |         check_number: null,
99 |         counterparties: [
100 |           {
101 |             confidence_level: "VERY_HIGH",
102 |             entity_id: "NKDjqyAdQQzpyeD8qpLnX0D6yvLe2KYKYYzQ4",
103 |             logo_url:
104 |               "https://plaid-merchant-logos.plaid.com/united_airlines_1065.png",
105 |             name: "United Airlines",
106 |             type: CounterpartyType.Merchant,
107 |             website: "united.com",
108 |           },
109 |         ],
110 |         date: "2024-02-22",
111 |         datetime: null,
112 |         iso_currency_code: "CAD",
113 |         location: {
114 |           address: null,
115 |           city: null,
116 |           country: null,
117 |           lat: null,
118 |           lon: null,
119 |           postal_code: null,
120 |           region: null,
121 |           store_number: null,
122 |         },
123 |         logo_url:
124 |           "https://plaid-merchant-logos.plaid.com/united_airlines_1065.png",
125 |         merchant_entity_id: "NKDjqyAdQQzpyeD8qpLnX0D6yvLe2KYKYYzQ4",
126 |         merchant_name: "United Airlines",
127 |         name: "United Airlines",
128 |         payment_channel: TransactionPaymentChannelEnum.InStore,
129 |         payment_meta: {
130 |           by_order_of: null,
131 |           payee: null,
132 |           payer: null,
133 |           payment_method: null,
134 |           payment_processor: null,
135 |           ppd_id: null,
136 |           reason: null,
137 |           reference_number: null,
138 |         },
139 |         pending: false,
140 |         pending_transaction_id: null,
141 |         personal_finance_category: {
142 |           confidence_level: "VERY_HIGH",
143 |           detailed: "TRAVEL_FLIGHTS",
144 |           primary: "TRAVEL",
145 |         },
146 |         personal_finance_category_icon_url:
147 |           "https://plaid-category-icons.plaid.com/PFC_TRAVEL.png",
148 |         transaction_code: null,
149 |         transaction_id: "5QKmMdaKWgtzkvKEPmqriLZR1mV3kMF5X9EeX",
150 |         transaction_type: TransactionTransactionTypeEnum.Special,
151 |         unofficial_currency_code: null,
152 |         website: "united.com",
153 |       },
154 |     }),
155 |   ).toMatchSnapshot();
156 | });
157 |
158 | test("Transform type transfer", () => {
159 |   expect(
160 |     transformTransaction({
161 |       accountType: "credit",
162 |       transaction: {
163 |         account_id: "AG7EkLW7DRSVaN8Z75jMT1DJN51QpWc9LKB7w",
164 |         account_owner: null,
165 |         amount: 31.53,
166 |         authorized_date: "2024-02-23",
167 |         authorized_datetime: null,
168 |         category: ["Travel", "Taxi"],
169 |         category_id: "22016000",
170 |         check_number: null,
171 |         counterparties: [
172 |           {
173 |             confidence_level: "VERY_HIGH",
174 |             entity_id: "eyg8o776k0QmNgVpAmaQj4WgzW9Qzo6O51gdd",
175 |             logo_url: "https://plaid-merchant-logos.plaid.com/uber_1060.png",
[TRUNCATED]
```

apps/engine/src/providers/plaid/transform.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { getType } from "@/utils/account";
3 | import { getLogoURL } from "@/utils/logo";
4 | import { capitalCase } from "change-case";
5 | import type { Transaction, TransactionCode } from "plaid";
6 | import type {
7 |   Account as BaseAccount,
8 |   Balance as BaseBalance,
9 |   Transaction as BaseTransaction,
10 | } from "../types";
11 | import type {
12 |   TransformAccount,
13 |   TransformAccountBalance,
14 |   TransformInstitution,
15 |   TransformTransactionPayload,
16 | } from "./types";
17 |
18 | export const mapTransactionMethod = (type?: TransactionCode | null) => {
19 |   switch (type) {
20 |     case "bill payment":
21 |       return "payment";
22 |     case "purchase":
23 |       return "card_purchase";
24 |     case "atm":
25 |       return "card_atm";
26 |     case "transfer":
27 |       return "transfer";
28 |     case "interest":
29 |       return "interest";
30 |     case "bank charge":
31 |       return "fee";
32 |     default:
33 |       return "other";
34 |   }
35 | };
36 |
37 | type MapTransactionCategory = {
38 |   transaction: Transaction;
39 |   amount: number;
40 | };
41 |
42 | export const mapTransactionCategory = ({
43 |   transaction,
44 |   amount,
45 | }: MapTransactionCategory) => {
46 |   if (transaction.personal_finance_category?.primary === "INCOME") {
47 |     return "income";
48 |   }
49 |
50 |   if (amount > 0) {
51 |     return "income";
52 |   }
53 |
54 |   if (
55 |     transaction.transaction_code === "bank charge" ||
56 |     transaction.personal_finance_category?.primary === "BANK_FEES"
57 |   ) {
58 |     return "fees";
59 |   }
60 |
61 |   if (transaction.personal_finance_category?.primary === "FOOD_AND_DRINK") {
62 |     return "meals";
63 |   }
64 |
65 |   if (
66 |     transaction.personal_finance_category?.primary === "TRANSPORTATION" ||
67 |     transaction.personal_finance_category?.primary === "TRAVEL"
68 |   ) {
69 |     return "travel";
70 |   }
71 |
72 |   if (
73 |     transaction.personal_finance_category?.detailed ===
74 |     "GENERAL_SERVICES_OTHER_GENERAL_SERVICES"
75 |   ) {
76 |     return "software";
77 |   }
78 |
79 |   if (
80 |     transaction.personal_finance_category?.detailed ===
81 |       "RENT_AND_UTILITIES_GAS_AND_ELECTRICITY" ||
82 |     transaction.personal_finance_category?.detailed ===
83 |       "RENT_AND_UTILITIES_SEWAGE_AND_WASTE_MANAGEMENT" ||
84 |     transaction.personal_finance_category?.detailed ===
85 |       "RENT_AND_UTILITIES_WATER" ||
86 |     transaction.personal_finance_category?.detailed ===
87 |       "RENT_AND_UTILITIES_OTHER_UTILITIES"
88 |   ) {
89 |     return "facilities-expenses";
90 |   }
91 |
92 |   if (
93 |     transaction.personal_finance_category?.detailed ===
94 |     "RENT_AND_UTILITIES_RENT"
95 |   ) {
96 |     return "rent";
97 |   }
98 |
99 |   if (
100 |     transaction.personal_finance_category?.detailed ===
101 |       "RENT_AND_UTILITIES_INTERNET_AND_CABLE" ||
102 |     transaction.personal_finance_category?.detailed ===
103 |       "RENT_AND_UTILITIES_TELEPHONE"
104 |   ) {
105 |     return "internet-and-telephone";
106 |   }
107 |
108 |   if (transaction.personal_finance_category?.primary === "HOME_IMPROVEMENT") {
109 |     return "office-supplies";
110 |   }
111 |
112 |   if (transaction.personal_finance_category?.primary === "ENTERTAINMENT") {
113 |     return "activity";
114 |   }
115 |
116 |   return null;
117 | };
118 |
119 | const formatAmout = (amount: number) => {
120 |   // Positive values when money moves out of the account; negative values when money moves in.
121 |   // For example, debit card purchases are positive; credit card payments, direct deposits, and refunds are negative.
122 |   return +(amount * -1);
123 | };
124 |
125 | const transformDescription = (transaction: Transaction) => {
126 |   const name = capitalCase(transaction.name);
127 |
128 |   if (
129 |     transaction?.original_description &&
130 |     transaction.original_description !== name
131 |   ) {
132 |     return capitalCase(transaction.original_description);
133 |   }
134 |
135 |   if (transaction?.merchant_name && transaction?.merchant_name !== name) {
136 |     return transaction?.merchant_name;
137 |   }
138 |
139 |   return null;
140 | };
141 |
142 | export const transformTransaction = ({
143 |   transaction,
144 | }: TransformTransactionPayload): BaseTransaction => {
145 |   const method = mapTransactionMethod(transaction?.transaction_code);
146 |   const amount = formatAmout(transaction.amount);
147 |   const description = transformDescription(transaction) ?? null;
148 |
149 |   return {
150 |     id: transaction.transaction_id,
151 |     date: transaction.date,
152 |     name: transaction.name,
153 |     description,
154 |     currency_rate: null,
155 |     currency_source: null,
156 |     method,
157 |     amount,
158 |     currency:
159 |       transaction?.iso_currency_code?.toUpperCase() ||
160 |       transaction?.unofficial_currency_code?.toUpperCase() ||
161 |       "USD",
162 |     category: mapTransactionCategory({ transaction, amount }),
163 |     balance: null,
164 |     status: transaction.pending ? "pending" : "posted",
165 |   };
166 | };
167 |
168 | export const transformAccount = ({
169 |   account_id,
170 |   name,
171 |   balances,
172 |   institution,
173 |   type,
174 | }: TransformAccount): BaseAccount => {
175 |   return {
176 |     id: account_id,
[TRUNCATED]
```

apps/engine/src/providers/plaid/types.ts
```
1 | import type { AccountType } from "@/utils/account";
2 | import type {
3 |   AccountsGetResponse,
4 |   Institution as BaseInstitution,
5 |   Transaction,
6 |   TransactionsSyncResponse,
7 | } from "plaid";
8 |
9 | export type LinkTokenCreateRequest = {
10 |   userId: string;
11 |   language?: string;
12 |   accessToken?: string;
13 |   environment?: "sandbox" | "production";
14 | };
15 |
16 | export type GetStatusResponse = {
17 |   page: {
18 |     id: string;
19 |     name: string;
20 |     url: string;
21 |     time_zone: string;
22 |     updated_at: string;
23 |   };
24 |   status: {
25 |     indicator: string;
26 |     description: string;
27 |   };
28 | };
29 |
30 | export type GetTransactionsRequest = {
31 |   accessToken: string;
32 |   accountId: string;
33 |   latest?: boolean;
34 | };
35 |
36 | export type GetAccountsRequest = {
37 |   accessToken: string;
38 |   institutionId: string;
39 | };
40 |
41 | export type ItemPublicTokenExchangeRequest = {
42 |   publicToken: string;
43 | };
44 |
45 | export type Institution = {
46 |   id: string;
47 |   name: string;
48 |   logo?: string | null;
49 | };
50 |
51 | export type TransformInstitution = BaseInstitution;
52 |
53 | export type AccountWithInstitution = AccountsGetResponse["accounts"][0] & {
54 |   institution: Institution;
55 | };
56 |
57 | export type GetAccountsResponse = AccountWithInstitution[];
58 |
59 | export type TransformAccount = AccountWithInstitution;
60 |
61 | export type TransformAccountBalance =
62 |   AccountsGetResponse["accounts"][0]["balances"];
63 |
64 | export type TransformTransaction = Transaction;
65 |
66 | export type GetTransactionsResponse = TransactionsSyncResponse["added"];
67 |
68 | export type GetAccountBalanceResponse =
69 |   AccountsGetResponse["accounts"][0]["balances"];
70 |
71 | export interface GetAccountBalanceRequest {
72 |   accessToken: string;
73 |   accountId: string;
74 | }
75 |
76 | export type TransformTransactionPayload = {
77 |   transaction: TransformTransaction;
78 |   accountType: AccountType;
79 | };
80 |
81 | export type DisconnectAccountRequest = {
82 |   accessToken: string;
83 | };
84 |
85 | export type GetConnectionStatusRequest = {
86 |   accessToken: string;
87 | };
```

apps/engine/src/providers/plaid/utils.ts
```
1 | import axios from "axios";
2 |
3 | export function isError(error: unknown) {
4 |   if (!error) return false;
5 |   if (!axios.isAxiosError(error)) return false;
6 |   if (typeof error.response?.data !== "object") return false;
7 |
8 |   const { data } = error.response;
9 |
10 |   return {
11 |     code: data.error_code,
12 |     message: data.error_message,
13 |   };
14 | }
```

apps/engine/src/providers/teller/teller-api.ts
```
1 | import { ProviderError } from "@/utils/error";
2 | import type {
3 |   GetConnectionStatusRequest,
4 |   GetConnectionStatusResponse,
5 |   ProviderParams,
6 | } from "../types";
7 | import type {
8 |   AuthenticatedRequest,
9 |   DisconnectAccountRequest,
10 |   GetAccountBalanceRequest,
11 |   GetAccountBalanceResponse,
12 |   GetAccountsResponse,
13 |   GetInstitutionsResponse,
14 |   GetTransactionsRequest,
15 |   GetTransactionsResponse,
16 | } from "./types";
17 | import { isError } from "./utils";
18 |
19 | export class TellerApi {
20 |   #baseUrl = "https://api.teller.io";
21 |
22 |   #fetcher: Fetcher;
23 |
24 |   constructor(params: Omit<ProviderParams, "provider">) {
25 |     this.#fetcher = params.fetcher as Fetcher;
26 |   }
27 |
28 |   async getHealthCheck() {
29 |     try {
30 |       await fetch(`${this.#baseUrl}/health`);
31 |       return true;
32 |     } catch (error) {
33 |       return false;
34 |     }
35 |   }
36 |
37 |   async getAccounts({
38 |     accessToken,
39 |   }: AuthenticatedRequest): Promise<GetAccountsResponse> {
40 |     const accounts: GetAccountsResponse = await this.#get(
41 |       "/accounts",
42 |       accessToken,
43 |     );
44 |
45 |     return Promise.all(
46 |       accounts?.map(async (account) => {
47 |         const balance = await this.getAccountBalance({
48 |           accountId: account.id,
49 |           accessToken,
50 |         });
51 |
52 |         return { ...account, balance };
53 |       }),
54 |     );
55 |   }
56 |
57 |   async getTransactions({
58 |     accountId,
59 |     accessToken,
60 |     latest,
61 |     count,
62 |   }: GetTransactionsRequest): Promise<GetTransactionsResponse> {
63 |     const result = await this.#get<GetTransactionsResponse>(
64 |       `/accounts/${accountId}/transactions`,
65 |       accessToken,
66 |       {
67 |         count: latest ? 100 : count,
68 |       },
69 |     );
70 |
71 |     // NOTE: Remove pending transactions until upsert issue is fixed
72 |     return result.filter((transaction) => transaction.status !== "pending");
73 |   }
74 |
75 |   async getAccountBalance({
76 |     accountId,
77 |     accessToken,
78 |   }: GetAccountBalanceRequest): Promise<GetAccountBalanceResponse> {
79 |     const transactions = await this.getTransactions({
80 |       accountId,
81 |       accessToken,
82 |       count: 20,
83 |     });
84 |
85 |     const amount = transactions.find(
86 |       (transaction) => transaction.running_balance !== null,
87 |     )?.running_balance;
88 |
89 |     return {
90 |       currency: "USD",
91 |       amount: +(amount ?? 0),
92 |     };
93 |   }
94 |
95 |   async getInstitutions(): Promise<GetInstitutionsResponse> {
96 |     return this.#get("/institutions");
97 |   }
98 |
99 |   async getConnectionStatus({
100 |     accessToken,
101 |   }: GetConnectionStatusRequest): Promise<GetConnectionStatusResponse> {
102 |     try {
103 |       const accounts = await this.#get("/accounts", accessToken);
104 |
105 |       if (!Array.isArray(accounts)) {
106 |         return { status: "disconnected" };
107 |       }
108 |
109 |       // If we can fetch any accounts, the connection is active
110 |       // Check all accounts in parallel
111 |       const results = await Promise.allSettled(
112 |         accounts.map((account) =>
113 |           this.#get(`/accounts/${account.id}`, accessToken),
114 |         ),
115 |       );
116 |
117 |       // If any account request succeeded, connection is valid
118 |       if (results.some((result) => result.status === "fulfilled")) {
119 |         return { status: "connected" };
120 |       }
121 |
122 |       // If we couldn't verify any accounts, assume disconnected
123 |       return { status: "disconnected" };
124 |     } catch (error) {
125 |       const parsedError = isError(error);
126 |
127 |       if (parsedError) {
128 |         const providerError = new ProviderError(parsedError);
129 |
130 |         if (providerError.code === "disconnected") {
131 |           return { status: "disconnected" };
132 |         }
133 |       }
134 |     }
135 |
136 |     // If we get here, the account is not disconnected
137 |     // But it could be a connection issue between Teller and the institution
138 |     return { status: "connected" };
139 |   }
140 |
141 |   async deleteAccounts({
142 |     accessToken,
143 |   }: DisconnectAccountRequest): Promise<void> {
144 |     await this.#fetcher.fetch(`${this.#baseUrl}/accounts`, {
145 |       method: "delete",
146 |       headers: new Headers({
147 |         Authorization: `Basic ${btoa(`${accessToken}:`)}`,
148 |       }),
149 |     });
150 |   }
151 |
152 |   async #get<TResponse>(
153 |     path: string,
154 |     token?: string,
155 |     params?: Record<string, string | number | undefined>,
156 |   ): Promise<TResponse> {
157 |     const url = new URL(`${this.#baseUrl}/${path}`);
158 |
159 |     if (params) {
160 |       for (const [key, value] of Object.entries(params)) {
161 |         if (value) {
162 |           url.searchParams.append(key, value.toString());
163 |         }
164 |       }
165 |     }
166 |
167 |     return <TResponse>this.#fetcher
168 |       .fetch(url.toString(), {
169 |         headers: new Headers({
170 |           Authorization: `Basic ${btoa(`${token}:`)}`,
171 |         }),
172 |       })
173 |       .then((response) => response.json())
174 |       .then((data) => {
175 |         const error = isError(data);
176 |
177 |         if (error) {
178 |           throw new ProviderError(error);
179 |         }
180 |
181 |         return data as TResponse;
182 |       });
183 |   }
184 | }
```

apps/engine/src/providers/teller/teller-provider.ts
```
1 | import type { Provider } from "../interface";
2 | import type {
3 |   DeleteAccountsRequest,
4 |   DeleteConnectionRequest,
5 |   GetAccountBalanceRequest,
6 |   GetAccountsRequest,
7 |   GetConnectionStatusRequest,
8 |   GetTransactionsRequest,
9 |   ProviderParams,
10 | } from "../types";
11 | import { TellerApi } from "./teller-api";
12 | import {
13 |   transformAccount,
14 |   transformInstitution,
15 |   transformTransaction,
16 | } from "./transform";
17 |
18 | export class TellerProvider implements Provider {
19 |   #api: TellerApi;
20 |
21 |   constructor(params: Omit<ProviderParams, "provider">) {
22 |     this.#api = new TellerApi(params);
23 |   }
24 |
25 |   async getHealthCheck() {
26 |     return this.#api.getHealthCheck();
27 |   }
28 |
29 |   async getTransactions({
30 |     accountId,
31 |     accessToken,
32 |     accountType,
33 |     latest,
34 |   }: GetTransactionsRequest) {
35 |     if (!accessToken) {
36 |       throw Error("accessToken missing");
37 |     }
38 |
39 |     const response = await this.#api.getTransactions({
40 |       accountId,
41 |       accessToken,
42 |       latest,
43 |     });
44 |
45 |     return response.map((transaction) =>
46 |       transformTransaction({
47 |         transaction,
48 |         accountType,
49 |       }),
50 |     );
51 |   }
52 |
53 |   async getAccounts({ accessToken }: GetAccountsRequest) {
54 |     if (!accessToken) {
55 |       throw Error("accessToken missing");
56 |     }
57 |
58 |     const response = await this.#api.getAccounts({ accessToken });
59 |
60 |     return response.map(transformAccount);
61 |   }
62 |
63 |   async getAccountBalance({
64 |     accessToken,
65 |     accountId,
66 |   }: GetAccountBalanceRequest) {
67 |     if (!accessToken || !accountId) {
68 |       throw Error("Missing params");
69 |     }
70 |
71 |     return this.#api.getAccountBalance({
72 |       accessToken,
73 |       accountId,
74 |     });
75 |   }
76 |
77 |   async getInstitutions() {
78 |     const response = await this.#api.getInstitutions();
79 |
80 |     return response.map(transformInstitution);
81 |   }
82 |
83 |   async deleteAccounts({ accessToken }: DeleteAccountsRequest) {
84 |     if (!accessToken) {
85 |       throw Error("accessToken is missing");
86 |     }
87 |
88 |     await this.#api.deleteAccounts({
89 |       accessToken,
90 |     });
91 |   }
92 |
93 |   async getConnectionStatus({ accessToken }: GetConnectionStatusRequest) {
94 |     if (!accessToken) {
95 |       throw Error("accessToken missing");
96 |     }
97 |
98 |     const response = await this.#api.getConnectionStatus({ accessToken });
99 |
100 |     return response;
101 |   }
102 |
103 |   async deleteConnection({ accessToken }: DeleteConnectionRequest) {
104 |     if (!accessToken) {
105 |       throw Error("accessToken missing");
106 |     }
107 |
108 |     await this.#api.deleteAccounts({ accessToken });
109 |   }
110 | }
```

apps/engine/src/providers/teller/transform.test.ts
```
1 | import { expect, test } from "bun:test";
2 | import {
3 |   transformAccount,
4 |   transformAccountBalance,
5 |   transformTransaction,
6 | } from "./transform";
7 |
8 | test("Transform pending transaction", () => {
9 |   expect(
10 |     transformTransaction({
11 |       accountType: "depository",
12 |       transaction: {
13 |         type: "check",
14 |         status: "pending",
15 |         running_balance: null,
16 |         links: {
17 |           self: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000/transactions/txn_os41r5u90e29shubl2000",
18 |           account: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000",
19 |         },
20 |         id: "txn_os41r5u90e29shubl2000",
21 |         details: {
22 |           processing_status: "complete",
23 |           counterparty: {
24 |             type: "organization",
25 |             name: "BANK OF MANY",
26 |           },
27 |           category: "general",
28 |         },
29 |         description: "Online Check Deposit",
30 |         date: "2024-03-05",
31 |         amount: "-83.62",
32 |         account_id: "acc_os41qe3a66ks2djhss000",
33 |       },
34 |     }),
35 |   ).toMatchSnapshot();
36 | });
37 |
38 | test("Transform pending transaction", () => {
39 |   expect(
40 |     transformTransaction({
41 |       accountType: "credit",
42 |       transaction: {
43 |         type: "check",
44 |         status: "pending",
45 |         running_balance: null,
46 |         links: {
47 |           self: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000/transactions/txn_os41r5u90e29shubl2000",
48 |           account: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000",
49 |         },
50 |         id: "txn_os41r5u90e29shubl2000",
51 |         details: {
52 |           processing_status: "complete",
53 |           counterparty: {
54 |             type: "organization",
55 |             name: "BANK OF MANY",
56 |           },
57 |           category: "general",
58 |         },
59 |         description: "Technology",
60 |         date: "2024-03-05",
61 |         amount: "29",
62 |         account_id: "acc_os41qe3a66ks2djhss000",
63 |       },
64 |     }),
65 |   ).toMatchSnapshot();
66 | });
67 |
68 | test("Transform card payment transaction", () => {
69 |   expect(
70 |     transformTransaction({
71 |       accountType: "depository",
72 |       transaction: {
73 |         type: "card_payment",
74 |         status: "posted",
75 |         running_balance: "83431.46",
76 |         links: {
77 |           self: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000/transactions/txn_os41r5u90e29shubl2005",
78 |           account: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000",
79 |         },
80 |         id: "txn_os41r5u90e29shubl2005",
81 |         details: {
82 |           processing_status: "complete",
83 |           counterparty: {
84 |             type: "organization",
85 |             name: "NORDSTROM",
86 |           },
87 |           category: "shopping",
88 |         },
89 |         description: "Nordstrom",
90 |         date: "2024-03-01",
91 |         amount: "-68.90",
92 |         account_id: "acc_os41qe3a66ks2djhss000",
93 |       },
94 |     }),
95 |   ).toMatchSnapshot();
96 | });
97 |
98 | test("Transform income transaction", () => {
99 |   expect(
100 |     transformTransaction({
101 |       accountType: "depository",
102 |       transaction: {
103 |         type: "card_payment",
104 |         status: "posted",
105 |         running_balance: "83296.40",
106 |         links: {
107 |           self: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000/transactions/txn_os41r5u90e29shubl2002",
108 |           account: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000",
109 |         },
110 |         id: "txn_os41r5u90e29shubl2002",
111 |         details: {
112 |           processing_status: "complete",
113 |           counterparty: {
114 |             type: "organization",
115 |             name: "EXXON MOBIL",
116 |           },
117 |           category: "fuel",
118 |         },
119 |         description: "Exxon Mobil",
120 |         date: "2024-03-03",
121 |         amount: "1000000",
122 |         account_id: "acc_os41qe3a66ks2djhss000",
123 |       },
124 |     }),
125 |   ).toMatchSnapshot();
126 | });
127 |
128 | test("Transform type transfer", () => {
129 |   expect(
130 |     transformTransaction({
131 |       accountType: "depository",
132 |       transaction: {
133 |         type: "transfer",
134 |         status: "posted",
135 |         running_balance: "85897.25",
136 |         links: {
137 |           self: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000/transactions/txn_os41r5ua0e29shubl2001",
138 |           account: "https://api.teller.io/accounts/acc_os41qe3a66ks2djhss000",
139 |         },
140 |         id: "txn_os41r5ua0e29shubl2001",
141 |         details: {
142 |           processing_status: "complete",
143 |           counterparty: {
144 |             type: "person",
145 |             name: "YOURSELF",
146 |           },
147 |           category: "general",
148 |         },
149 |         description: "Recurring Transfer to Savings",
150 |         date: "2024-01-27",
151 |         amount: "-37.99",
152 |         account_id: "acc_os41qe3a66ks2djhss000",
153 |       },
154 |     }),
155 |   ).toMatchSnapshot();
156 | });
157 |
158 | test("Transform accounts", () => {
159 |   expect(
160 |     transformAccount({
161 |       type: "credit",
162 |       subtype: "credit_card",
163 |       status: "open",
164 |       name: "Platinum Card",
165 |       links: {
166 |         transactions:
167 |           "https://api.teller.io/accounts/acc_os557c2mge29shubl2000/transactions",
168 |         self: "https://api.teller.io/accounts/acc_os557c2mge29shubl2000",
169 |         balances:
170 |           "https://api.teller.io/accounts/acc_os557c2mge29shubl2000/balances",
171 |       },
172 |       last_four: "6587",
173 |       institution: {
174 |         name: "Mercury",
175 |         id: "mercury",
176 |       },
177 |       balance: {
178 |         currency: "USD",
179 |         amount: 2011100,
180 |       },
181 |       id: "acc_os557c2mge29shubl2000",
182 |       enrollment_id: "enr_os557c8pck2deoskak000",
183 |       currency: "USD",
184 |     }),
185 |   ).toMatchSnapshot();
186 | });
187 |
188 | test("Transform account balance", () => {
189 |   expect(
190 |     transformAccountBalance({
191 |       currency: "USD",
192 |       amount: 2011100,
193 |     }),
194 |   ).toMatchSnapshot();
195 | });
```

apps/engine/src/providers/teller/transform.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { getType } from "@/utils/account";
3 | import { getLogoURL } from "@/utils/logo";
4 | import { capitalCase } from "change-case";
5 | import type {
6 |   Account as BaseAccount,
7 |   Balance as BaseAccountBalance,
8 |   Transaction as BaseTransaction,
9 | } from "../types";
10 | import type {
11 |   FormatAmount,
12 |   Transaction,
13 |   TransformAccount,
14 |   TransformAccountBalance,
15 |   TransformInstitution,
16 |   TransformTransaction,
17 | } from "./types";
18 |
19 | export const mapTransactionMethod = (type?: string) => {
20 |   switch (type) {
21 |     case "payment":
22 |     case "bill_payment":
23 |     case "digital_payment":
24 |       return "payment";
25 |     case "card_payment":
26 |       return "card_purchase";
27 |     case "atm":
28 |       return "card_atm";
29 |     case "transfer":
30 |       return "transfer";
31 |     case "ach":
32 |       return "ach";
33 |     case "interest":
34 |       return "interest";
35 |     case "deposit":
36 |       return "deposit";
37 |     case "wire":
38 |       return "wire";
39 |     case "fee":
40 |       return "fee";
41 |     default:
42 |       return "other";
43 |   }
44 | };
45 |
46 | type MapTransactionCategory = {
47 |   transaction: Transaction;
48 |   amount: number;
49 | };
50 |
51 | export const mapTransactionCategory = ({
52 |   transaction,
53 |   amount,
54 | }: MapTransactionCategory) => {
55 |   if (transaction.type === "fee") {
56 |     return "fees";
57 |   }
58 |
59 |   if (amount > 0) {
60 |     return "income";
61 |   }
62 |
63 |   switch (transaction?.details.category) {
64 |     case "bar":
65 |     case "dining":
66 |     case "groceries":
67 |       return "meals";
68 |     case "transport":
69 |     case "transportation":
70 |       return "travel";
71 |     case "tax":
72 |       return "taxes";
73 |     case "office":
74 |       return "office-supplies";
75 |     case "phone":
76 |       return "internet-and-telephone";
77 |     case "software":
78 |       return "software";
79 |     case "entertainment":
80 |     case "sport":
81 |       return "activity";
82 |     case "utilities":
83 |     case "electronics":
84 |       return "equipment";
85 |     default:
86 |       return null;
87 |   }
88 | };
89 |
90 | export const transformDescription = (transaction: Transaction) => {
91 |   const description =
92 |     transaction?.details?.counterparty?.name &&
93 |     capitalCase(transaction.details.counterparty.name);
94 |
95 |   if (transaction.description !== description && description) {
96 |     return capitalCase(description);
97 |   }
98 |
99 |   return null;
100 | };
101 |
102 | const formatAmout = ({ amount, accountType }: FormatAmount) => {
103 |   // NOTE: For account credit positive values when money moves out of the account; negative values when money moves in.
104 |   if (accountType === "credit") {
105 |     return +(amount * -1);
106 |   }
107 |
108 |   return +amount;
109 | };
110 |
111 | export const transformTransaction = ({
112 |   transaction,
113 |   accountType,
114 | }: TransformTransaction): BaseTransaction => {
115 |   const method = mapTransactionMethod(transaction.type);
116 |   const description = transformDescription(transaction);
117 |   const amount = formatAmout({
118 |     amount: +transaction.amount,
119 |     accountType,
120 |   });
121 |
122 |   return {
123 |     id: transaction.id,
124 |     date: transaction.date,
125 |     name: transaction.description && capitalCase(transaction.description),
126 |     description: description ?? null,
127 |     currency_rate: null,
128 |     currency_source: null,
129 |     method,
130 |     amount,
131 |     currency: "USD",
132 |     category: mapTransactionCategory({ transaction, amount }),
133 |     balance: transaction?.running_balance ? +transaction.running_balance : null,
134 |     status: transaction?.status === "posted" ? "posted" : "pending",
135 |   };
136 | };
137 |
138 | export const transformAccount = ({
139 |   id,
140 |   name,
141 |   currency,
142 |   enrollment_id,
143 |   type,
144 |   institution,
145 |   balance,
146 | }: TransformAccount): BaseAccount => {
147 |   return {
148 |     id,
149 |     name,
150 |     currency: currency.toUpperCase(),
151 |     enrollment_id: enrollment_id,
152 |     institution: transformInstitution(institution),
153 |     type: getType(type),
154 |     balance: transformAccountBalance(balance),
155 |     resource_id: null,
156 |   };
157 | };
158 |
159 | export const transformAccountBalance = (
160 |   account: TransformAccountBalance,
161 | ): BaseAccountBalance => ({
162 |   currency: account.currency.toUpperCase(),
163 |   amount: +account.amount,
164 | });
165 |
166 | export const transformInstitution = (institution: TransformInstitution) => ({
167 |   id: institution.id,
168 |   name: institution.name,
169 |   logo: getLogoURL(institution.id),
170 |   provider: Providers.Enum.teller,
171 | });
```

apps/engine/src/providers/teller/types.ts
```
1 | // Thank you: https://github.com/maybe-finance/maybe-archive/blob/04bf3d135bdbb1fdaa2dd669dca4738c797cc382/libs/teller-api/src/types/accounts.ts
2 |
3 | import type { AccountType } from "@/utils/account";
4 |
5 | export type DetailCategory =
6 |   | "accommodation"
7 |   | "advertising"
8 |   | "bar"
9 |   | "charity"
10 |   | "clothing"
11 |   | "dining"
12 |   | "education"
13 |   | "electronics"
14 |   | "entertainment"
15 |   | "fuel"
16 |   | "general"
17 |   | "groceries"
18 |   | "health"
19 |   | "home"
20 |   | "income"
21 |   | "insurance"
22 |   | "investment"
23 |   | "loan"
24 |   | "office"
25 |   | "phone"
26 |   | "service"
27 |   | "shopping"
28 |   | "software"
29 |   | "sport"
30 |   | "tax"
31 |   | "transport"
32 |   | "transportation"
33 |   | "utilities";
34 |
35 | type DetailProcessingStatus = "pending" | "complete";
36 |
37 | export type Transaction = {
38 |   details: {
39 |     category?: DetailCategory;
40 |     processing_status: DetailProcessingStatus;
41 |     counterparty?: {
42 |       name?: string;
43 |       type?: "organization" | "person";
44 |     };
45 |   };
46 |   running_balance: string | null;
47 |   description: string;
48 |   id: string;
49 |   date: string;
50 |   account_id: string;
51 |   links: {
52 |     self: string;
53 |     account: string;
54 |   };
55 |   amount: string;
56 |   status: "posted" | "pending";
57 |   type: string;
58 | };
59 |
60 | export type GetTransactionsResponse = Transaction[];
61 | export type GetTransactionResponse = Transaction;
62 |
63 | export type DisconnectAccountRequest = {
64 |   accessToken: string;
65 | };
66 |
67 | export interface GetTransactionsRequest extends AuthenticatedRequest {
68 |   accountId: string;
69 |   latest?: boolean;
70 |   count?: number;
71 | }
72 |
73 | export type AuthenticationResponse = {
74 |   token: string;
75 | };
76 |
77 | export type AuthenticatedRequest = {
78 |   accessToken: string;
79 | };
80 |
81 | type Institution = {
82 |   id: string;
83 |   name: string;
84 | };
85 |
86 | interface BaseAccount {
87 |   enrollment_id: string;
88 |   links: {
89 |     balances: string;
90 |     self: string;
91 |     transactions: string;
92 |   };
93 |   institution: Institution;
94 |   name: string;
95 |   currency: string;
96 |   id: string;
97 |   last_four: string;
98 |   status: AccountStatus;
99 | }
100 |
101 | export type CreditSubtype = "credit_card";
102 |
103 | export type AccountStatus = "open" | "closed";
104 |
105 | export type DepositorySubtypes =
106 |   | "checking"
107 |   | "savings"
108 |   | "money_market"
109 |   | "certificate_of_deposit"
110 |   | "treasury"
111 |   | "sweep";
112 |
113 | interface DepositoryAccount extends BaseAccount {
114 |   type: "depository";
115 |   subtype: DepositorySubtypes;
116 | }
117 |
118 | interface CreditAccount extends BaseAccount {
119 |   type: "credit";
120 |   subtype: CreditSubtype;
121 | }
122 |
123 | export type Account = DepositoryAccount | CreditAccount;
124 |
125 | export type TransformAccount = Account & {
126 |   balance: GetAccountBalanceResponse;
127 | };
128 |
129 | export type GetAccountsResponse = TransformAccount[];
130 |
131 | export interface GetAccountBalanceRequest extends AuthenticatedRequest {
132 |   accountId: string;
133 | }
134 |
135 | export type GetAccountBalanceResponse = {
136 |   currency: string;
137 |   amount: number;
138 | };
139 |
140 | export type TransformTransaction = {
141 |   transaction: Transaction;
142 |   accountType: AccountType;
143 | };
144 |
145 | export type FormatAmount = {
146 |   amount: number;
147 |   accountType: AccountType;
148 | };
149 |
150 | export type TransformAccountBalance = GetAccountBalanceResponse;
151 |
152 | export type GetInstitutionsResponse = Institution[];
153 |
154 | export type TransformInstitution = Institution;
```

apps/engine/src/providers/teller/utils.ts
```
1 | export function isError(
2 |   data: unknown,
3 | ): false | { code: string; message: string } {
4 |   if (typeof data !== "object" || data === null || !("error" in data)) {
5 |     return false;
6 |   }
7 |
8 |   const tellerError = data as { error: { code: string; message: string } };
9 |
10 |   return {
11 |     code: tellerError.error.code,
12 |     message: tellerError.error.message,
13 |   };
14 | }
```

apps/engine/src/routes/accounts/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema } from "@/common/schema";
3 | import { Provider } from "@/providers";
4 | import { createErrorResponse } from "@/utils/error";
5 | import { createRoute } from "@hono/zod-openapi";
6 | import { OpenAPIHono } from "@hono/zod-openapi";
7 | import { env } from "hono/adapter";
8 | import {
9 |   AccountBalanceParamsSchema,
10 |   AccountBalanceSchema,
11 |   AccountsParamsSchema,
12 |   AccountsSchema,
13 |   DeleteAccountsParamsSchema,
14 |   DeleteSchema,
15 | } from "./schema";
16 |
17 | const app = new OpenAPIHono<{ Bindings: Bindings }>()
18 |   .openapi(
19 |     createRoute({
20 |       method: "get",
21 |       path: "/",
22 |       summary: "Get Accounts",
23 |       request: {
24 |         query: AccountsParamsSchema,
25 |       },
26 |       responses: {
27 |         200: {
28 |           content: {
29 |             "application/json": {
30 |               schema: AccountsSchema,
31 |             },
32 |           },
33 |           description: "Retrieve accounts",
34 |         },
35 |         400: {
36 |           content: {
37 |             "application/json": {
38 |               schema: ErrorSchema,
39 |             },
40 |           },
41 |           description: "Returns an error",
42 |         },
43 |       },
44 |     }),
45 |     async (c) => {
46 |       const envs = env(c);
47 |
48 |       const { provider, accessToken, institutionId, id } = c.req.valid("query");
49 |
50 |       const api = new Provider({
51 |         provider,
52 |         kv: c.env.KV,
53 |         fetcher: c.env.TELLER_CERT,
54 |         envs,
55 |       });
56 |
57 |       try {
58 |         const data = await api.getAccounts({
59 |           id,
60 |           accessToken,
61 |           institutionId,
62 |         });
63 |
64 |         return c.json(
65 |           {
66 |             data,
67 |           },
68 |           200,
69 |         );
70 |       } catch (error) {
71 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
72 |
73 |         return c.json(errorResponse, 400);
74 |       }
75 |     },
76 |   )
77 |   .openapi(
78 |     createRoute({
79 |       method: "delete",
80 |       path: "/",
81 |       summary: "Delete Accounts",
82 |       request: {
83 |         query: DeleteAccountsParamsSchema,
84 |       },
85 |       responses: {
86 |         200: {
87 |           content: {
88 |             "application/json": {
89 |               schema: DeleteSchema,
90 |             },
91 |           },
92 |           description: "Retrieve accounts",
93 |         },
94 |         400: {
95 |           content: {
96 |             "application/json": {
97 |               schema: ErrorSchema,
98 |             },
99 |           },
100 |           description: "Returns an error",
101 |         },
102 |       },
103 |     }),
104 |     async (c) => {
105 |       const envs = env(c);
106 |       const { provider, accountId, accessToken } = c.req.valid("query");
107 |
108 |       const api = new Provider({
109 |         provider,
110 |         fetcher: c.env.TELLER_CERT,
111 |         kv: c.env.KV,
112 |         envs,
113 |       });
114 |
115 |       try {
116 |         await api.deleteAccounts({
117 |           accessToken,
118 |           accountId,
119 |         });
120 |
121 |         return c.json(
122 |           {
123 |             success: true,
124 |           },
125 |           200,
126 |         );
127 |       } catch (error) {
128 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
129 |
130 |         return c.json(errorResponse, 400);
131 |       }
132 |     },
133 |   )
134 |   .openapi(
135 |     createRoute({
136 |       method: "get",
137 |       path: "/balance",
138 |       summary: "Get Account Balance",
139 |       request: {
140 |         query: AccountBalanceParamsSchema,
141 |       },
142 |       responses: {
143 |         200: {
144 |           content: {
145 |             "application/json": {
146 |               schema: AccountBalanceSchema,
147 |             },
148 |           },
149 |           description: "Retrieve account balance",
150 |         },
151 |         400: {
152 |           content: {
153 |             "application/json": {
154 |               schema: ErrorSchema,
155 |             },
156 |           },
157 |           description: "Returns an error",
158 |         },
159 |       },
160 |     }),
161 |     async (c) => {
162 |       const envs = env(c);
163 |       const { provider, accessToken, id } = c.req.valid("query");
164 |
165 |       const api = new Provider({
166 |         provider,
167 |         fetcher: c.env.TELLER_CERT,
168 |         kv: c.env.KV,
169 |         envs,
170 |       });
171 |
172 |       try {
173 |         const data = await api.getAccountBalance({
174 |           accessToken,
175 |           accountId: id,
176 |         });
177 |
178 |         return c.json(
179 |           {
180 |             data,
181 |           },
182 |           200,
183 |         );
184 |       } catch (error) {
185 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
186 |
187 |         return c.json(errorResponse, 400);
188 |       }
189 |     },
190 |   );
191 |
192 | export default app;
```

apps/engine/src/routes/accounts/schema.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { z } from "@hono/zod-openapi";
3 | import { InstitutionSchema } from "../institutions/schema";
4 |
5 | export const AccountsParamsSchema = z.object({
6 |   id: z
7 |     .string()
8 |     .optional()
9 |     .openapi({
10 |       description: "GoCardLess reference id",
11 |       param: {
12 |         name: "id",
13 |         in: "query",
14 |       },
15 |       example: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
16 |     }),
17 |   provider: Providers.openapi({
18 |     example: Providers.Enum.teller,
19 |   }),
20 |   accessToken: z
21 |     .string()
22 |     .optional()
23 |     .openapi({
24 |       description: "Teller or Plaid access token",
25 |       param: {
26 |         name: "accessToken",
27 |         in: "query",
28 |       },
29 |       example: "test_token_ky6igyqi3qxa4",
30 |     }),
31 |   institutionId: z
32 |     .string()
33 |     .optional()
34 |     .openapi({
35 |       description: "Plaid institution id",
36 |       param: {
37 |         name: "institutionId",
38 |         in: "query",
39 |       },
40 |       example: "ins_109508",
41 |     }),
42 | });
43 |
44 | export const AccountSchema = z
45 |   .object({
46 |     id: z.string().openapi({
47 |       example: "9293961c-df93-4d6d-a2cc-fc3e353b2d10",
48 |     }),
49 |     name: z.string().openapi({
50 |       example: "Savings account",
51 |     }),
52 |     type: z
53 |       .enum(["depository", "credit", "other_asset", "loan", "other_liability"])
54 |       .openapi({
55 |         example: "depository",
56 |       }),
57 |     balance: z.object({
58 |       amount: z.number().openapi({
59 |         example: 100.0,
60 |       }),
61 |       currency: z.string().openapi({
62 |         example: "USD",
63 |       }),
64 |     }),
65 |     currency: z.string().openapi({
66 |       example: "USD",
67 |     }),
68 |     institution: InstitutionSchema,
69 |     enrollment_id: z
70 |       .string()
71 |       .openapi({
72 |         description: "Teller/Plaid enrollment id",
73 |         example: "add29d44-1b36-4bcc-b317-b2cbc73ab8e7",
74 |       })
75 |       .nullable(),
76 |     resource_id: z
77 |       .string()
78 |       .openapi({
79 |         description: "GoCardLess reference id",
80 |         example: "GBRGZX62Y8",
81 |       })
82 |       .nullable(),
83 |   })
84 |   .openapi("AccountSchema");
85 |
86 | export const AccountsSchema = z
87 |   .object({
88 |     data: z.array(AccountSchema),
89 |   })
90 |   .openapi("AccountsSchema");
91 |
92 | export const AccountBalanceParamsSchema = z
93 |   .object({
94 |     id: z.string().openapi({
95 |       description: "Account id",
96 |       param: {
97 |         name: "id",
98 |         in: "query",
99 |       },
100 |       example: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
101 |     }),
102 |     provider: Providers.openapi({
103 |       example: Providers.Enum.teller,
104 |     }),
105 |     accessToken: z
106 |       .string()
107 |       .optional()
108 |       .openapi({
109 |         description: "Teller or Plaid access token",
110 |         param: {
111 |           name: "accessToken",
112 |           in: "query",
113 |         },
114 |         example: "test_token_ky6igyqi3qxa4",
115 |       }),
116 |   })
117 |   .openapi("AccountBalanceParamsSchema");
118 |
119 | export const AccountBalanceSchema = z
120 |   .object({
121 |     data: z
122 |       .object({
123 |         amount: z.number().openapi({
124 |           example: 20000,
125 |         }),
126 |         currency: z.string().openapi({
127 |           example: "USD",
128 |         }),
129 |       })
130 |       .nullable(),
131 |   })
132 |   .openapi("AccountBalanceSchema");
133 |
134 | export const DeleteAccountsParamsSchema = z
135 |   .object({
136 |     accountId: z.string().openapi({
137 |       description: "Account id (GoCardLess)",
138 |       param: {
139 |         name: "accountId",
140 |         in: "query",
141 |       },
142 |       example: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
143 |     }),
144 |     provider: Providers.openapi({
145 |       example: Providers.Enum.teller,
146 |     }),
147 |     accessToken: z
148 |       .string()
149 |       .optional()
150 |       .openapi({
151 |         description: "Teller or Plaid access token",
152 |         param: {
153 |           name: "accessToken",
154 |           in: "query",
155 |         },
156 |         example: "test_token_ky6igyqi3qxa4",
157 |       }),
158 |   })
159 |   .openapi("DeleteAccountsParamsSchema");
160 |
161 | export const DeleteSchema = z
162 |   .object({
163 |     success: z.boolean().openapi({
164 |       example: true,
165 |     }),
166 |   })
167 |   .openapi("DeleteSchema");
```

apps/engine/src/routes/auth/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema } from "@/common/schema";
3 | import { GoCardLessApi } from "@/providers/gocardless/gocardless-api";
4 | import { PlaidApi } from "@/providers/plaid/plaid-api";
5 | import { createErrorResponse } from "@/utils/error";
6 | import { createRoute } from "@hono/zod-openapi";
7 | import { OpenAPIHono } from "@hono/zod-openapi";
8 | import { env } from "hono/adapter";
9 | import {
10 |   GoCardLessAgreementBodySchema,
11 |   GoCardLessAgreementSchema,
12 |   GoCardLessExchangeBodySchema,
13 |   GoCardLessExchangeSchema,
14 |   GoCardLessLinkBodySchema,
15 |   GoCardLessLinkSchema,
16 |   PlaidExchangeBodySchema,
17 |   PlaidExchangeSchema,
18 |   PlaidLinkBodySchema,
19 |   PlaidLinkSchema,
20 | } from "./schema";
21 |
22 | const app = new OpenAPIHono<{ Bindings: Bindings }>()
23 |   .openapi(
24 |     createRoute({
25 |       method: "post",
26 |       path: "/plaid/link",
27 |       summary: "Auth Link (Plaid)",
28 |       request: {
29 |         body: {
30 |           content: {
31 |             "application/json": {
32 |               schema: PlaidLinkBodySchema,
33 |             },
34 |           },
35 |         },
36 |       },
37 |       responses: {
38 |         200: {
39 |           content: {
40 |             "application/json": {
41 |               schema: PlaidLinkSchema,
42 |             },
43 |           },
44 |           description: "Retrieve Link",
45 |         },
46 |         400: {
47 |           content: {
48 |             "application/json": {
49 |               schema: ErrorSchema,
50 |             },
51 |           },
52 |           description: "Returns an error",
53 |         },
54 |       },
55 |     }),
56 |     async (c) => {
57 |       const envs = env(c);
58 |
59 |       const { userId, language, accessToken } = await c.req.json();
60 |
61 |       const api = new PlaidApi({
62 |         kv: c.env.KV,
63 |         envs,
64 |       });
65 |
66 |       try {
67 |         const { data } = await api.linkTokenCreate({
68 |           userId,
69 |           language,
70 |           accessToken,
71 |         });
72 |
73 |         return c.json(
74 |           {
75 |             data,
76 |           },
77 |           200,
78 |         );
79 |       } catch (error) {
80 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
81 |
82 |         return c.json(errorResponse, 400);
83 |       }
84 |     },
85 |   )
86 |   .openapi(
87 |     createRoute({
88 |       method: "post",
89 |       path: "/plaid/exchange",
90 |       summary: "Exchange token (Plaid)",
91 |       request: {
92 |         body: {
93 |           content: {
94 |             "application/json": {
95 |               schema: PlaidExchangeBodySchema,
96 |             },
97 |           },
98 |         },
99 |       },
100 |       responses: {
101 |         200: {
102 |           content: {
103 |             "application/json": {
104 |               schema: PlaidExchangeSchema,
105 |             },
106 |           },
107 |           description: "Retrieve Exchange",
108 |         },
109 |         400: {
110 |           content: {
111 |             "application/json": {
112 |               schema: ErrorSchema,
113 |             },
114 |           },
115 |           description: "Returns an error",
116 |         },
117 |       },
118 |     }),
119 |     async (c) => {
120 |       const envs = env(c);
121 |
122 |       const { token } = await c.req.json();
123 |
124 |       const api = new PlaidApi({
125 |         kv: c.env.KV,
126 |         envs,
127 |       });
128 |
129 |       try {
130 |         const data = await api.itemPublicTokenExchange({
131 |           publicToken: token,
132 |         });
133 |
134 |         return c.json(data, 200);
135 |       } catch (error) {
136 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
137 |
138 |         return c.json(errorResponse, 400);
139 |       }
140 |     },
141 |   )
142 |   .openapi(
143 |     createRoute({
144 |       method: "post",
145 |       path: "/gocardless/link",
146 |       summary: "Auth link (GoCardLess)",
147 |       request: {
148 |         body: {
149 |           content: {
150 |             "application/json": {
151 |               schema: GoCardLessLinkBodySchema,
152 |             },
153 |           },
154 |         },
155 |       },
156 |       responses: {
157 |         200: {
158 |           content: {
159 |             "application/json": {
160 |               schema: GoCardLessLinkSchema,
161 |             },
162 |           },
163 |           description: "Retrieve Link",
164 |         },
165 |         400: {
166 |           content: {
167 |             "application/json": {
168 |               schema: ErrorSchema,
169 |             },
170 |           },
171 |           description: "Returns an error",
172 |         },
173 |       },
174 |     }),
175 |     async (c) => {
176 |       const envs = env(c);
177 |
178 |       const { institutionId, agreement, redirect, reference } =
179 |         await c.req.json();
180 |
181 |       const api = new GoCardLessApi({
182 |         kv: c.env.KV,
183 |         envs,
184 |       });
185 |
186 |       try {
187 |         const data = await api.buildLink({
188 |           institutionId,
189 |           agreement,
190 |           redirect,
191 |           reference,
192 |         });
193 |
194 |         return c.json(
195 |           {
196 |             data,
197 |           },
198 |           200,
199 |         );
200 |       } catch (error) {
201 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
202 |
203 |         return c.json(errorResponse, 400);
204 |       }
205 |     },
206 |   )
207 |   .openapi(
208 |     createRoute({
209 |       method: "post",
210 |       path: "/gocardless/agreement",
211 |       summary: "Agreement (GoCardLess)",
212 |       request: {
213 |         body: {
214 |           content: {
215 |             "application/json": {
216 |               schema: GoCardLessAgreementBodySchema,
217 |             },
218 |           },
219 |         },
220 |       },
221 |       responses: {
222 |         200: {
223 |           content: {
224 |             "application/json": {
[TRUNCATED]
```

apps/engine/src/routes/auth/schema.ts
```
1 | import { z } from "@hono/zod-openapi";
2 |
3 | export const PlaidLinkBodySchema = z
4 |   .object({
5 |     userId: z.string().optional().openapi({
6 |       example: "9293961c-df93-4d6d-a2cc-fc3e353b2d10",
7 |     }),
8 |     language: z.string().optional().openapi({
9 |       example: "en",
10 |     }),
11 |     accessToken: z.string().optional().openapi({
12 |       example: "ojwmef9823f892n9h98h2efoqed9823hdodfcoj13er92hef",
13 |       description: "Used when initiating the reconnect flow",
14 |     }),
15 |   })
16 |   .openapi("PlaidLinkBodySchema");
17 |
18 | export const PlaidLinkSchema = z
19 |   .object({
20 |     data: z.object({
21 |       link_token: z.string().openapi({
22 |         example: "ojwmef9823f892n9h98h2efoqed9823hdodfcoj13er92hef",
23 |       }),
24 |       expiration: z.string().openapi({
25 |         example: "2024-06-01",
26 |       }),
27 |     }),
28 |   })
29 |   .openapi("PlaidLinkSchema");
30 |
31 | export const PlaidExchangeBodySchema = z
32 |   .object({
33 |     token: z.string().openapi({
34 |       example: "ojwmef9823f892n9h98h2efoqed9823hdodfcoj13er92hef",
35 |     }),
36 |   })
37 |   .openapi("PlaidExchangeBodySchema");
38 |
39 | export const PlaidExchangeSchema = z
40 |   .object({
41 |     data: z.object({
42 |       access_token: z.string().openapi({
43 |         example: "access_9293961c",
44 |       }),
45 |       item_id: z.string().openapi({
46 |         example: "item_9293961c",
47 |       }),
48 |     }),
49 |   })
50 |   .openapi("PlaidExchangeSchema");
51 |
52 | export const GoCardLessLinkBodySchema = z
53 |   .object({
54 |     institutionId: z.string().openapi({
55 |       example: "REVOLUT_REVOGB21",
56 |     }),
57 |     redirect: z.string().openapi({
58 |       example: "http://www.yourwebpage.com",
59 |     }),
60 |     agreement: z
61 |       .string()
62 |       .openapi({
63 |         example: "2dea1b84-97b0-4cb4-8805-302c227587c8",
64 |       })
65 |       .nullable(),
66 |     reference: z.string().optional().openapi({
67 |       example: "1234567890",
68 |     }),
69 |   })
70 |   .openapi("GoCardLessLinkBodySchema");
71 |
72 | export const GoCardLessLinkSchema = z
73 |   .object({
74 |     data: z.object({
75 |       link: z.string().openapi({
76 |         example:
77 |           "https://ob.gocardless.com/psd2/start/3fa85f64-5717-4562-b3fc-2c963f66afa6/REVOLUT_REVOGB21",
78 |       }),
79 |     }),
80 |   })
81 |   .openapi("GoCardLessLinkSchema");
82 |
83 | export const GoCardLessExchangeBodySchema = z
84 |   .object({
85 |     institutionId: z.string().openapi({
86 |       example: "REVOLUT_REVOGB21",
87 |     }),
88 |     transactionTotalDays: z.number().openapi({
89 |       example: 90,
90 |     }),
91 |   })
92 |   .openapi("GoCardLessExchangeBodySchema");
93 |
94 | export const GoCardLessExchangeSchema = z
95 |   .object({
96 |     data: z.object({
97 |       id: z.string().openapi({
98 |         example: "2dea1b84-97b0-4cb4-8805-302c227587c8",
99 |       }),
100 |       access_valid_for_days: z.number().openapi({
101 |         example: 90,
102 |       }),
103 |       max_historical_days: z.number().openapi({
104 |         example: 90,
105 |       }),
106 |       institution_id: z.string().openapi({
107 |         example: "REVOLUT_REVOGB21",
108 |       }),
109 |     }),
110 |   })
111 |   .openapi("GoCardLessExchangeSchema");
112 |
113 | export const GoCardLessAgreementBodySchema = z
114 |   .object({
115 |     institutionId: z.string().openapi({
116 |       example: "REVOLUT_REVOGB21",
117 |     }),
118 |     transactionTotalDays: z.number().openapi({
119 |       example: 90,
120 |     }),
121 |   })
122 |   .openapi("GoCardLessAgreementBodySchema");
123 |
124 | export const GoCardLessAgreementSchema = z
125 |   .object({
126 |     data: z.object({
127 |       id: z.string().openapi({
128 |         example: "2dea1b84-97b0-4cb4-8805-302c227587c8",
129 |       }),
130 |       created: z.string().openapi({
131 |         example: "2024-01-01",
132 |       }),
133 |       access_valid_for_days: z.number().openapi({
134 |         example: 90,
135 |       }),
136 |       max_historical_days: z.number().openapi({
137 |         example: 90,
138 |       }),
139 |       institution_id: z.string().openapi({
140 |         example: "REVOLUT_REVOGB21",
141 |       }),
142 |       accepted: z.boolean().openapi({
143 |         example: true,
144 |       }),
145 |     }),
146 |   })
147 |   .openapi("GoCardLessAgreementSchema");
```

apps/engine/src/routes/connections/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema, Providers } from "@/common/schema";
3 | import { Provider } from "@/providers";
4 | import { GoCardLessApi } from "@/providers/gocardless/gocardless-api";
5 | import { createErrorResponse } from "@/utils/error";
6 | import { createRoute } from "@hono/zod-openapi";
7 | import { OpenAPIHono } from "@hono/zod-openapi";
8 | import { env } from "hono/adapter";
9 | import {
10 |   ConnectionByReferenceParamsSchema,
11 |   ConnectionByReferenceSchema,
12 |   ConnectionDeletedSchema,
13 |   ConnectionStatusQuerySchema,
14 |   ConnectionStatusSchema,
15 |   DeleteConnectionBodySchema,
16 |   GoCardLessConnectionsSchema,
17 | } from "./schema";
18 |
19 | const app = new OpenAPIHono<{ Bindings: Bindings }>()
20 |   .openapi(
21 |     createRoute({
22 |       method: "get",
23 |       path: "/status",
24 |       summary: "Get Connection Status",
25 |       request: {
26 |         query: ConnectionStatusQuerySchema,
27 |       },
28 |       responses: {
29 |         200: {
30 |           content: {
31 |             "application/json": {
32 |               schema: ConnectionStatusSchema,
33 |             },
34 |           },
35 |           description: "Retrieve connection status",
36 |         },
37 |         400: {
38 |           content: {
39 |             "application/json": {
40 |               schema: ErrorSchema,
41 |             },
42 |           },
43 |           description: "Returns an error",
44 |         },
45 |       },
46 |     }),
47 |     async (c) => {
48 |       const envs = env(c);
49 |
50 |       const { id, provider, accessToken } = c.req.valid("query");
51 |
52 |       const api = new Provider({
53 |         provider,
54 |         kv: c.env.KV,
55 |         fetcher: c.env.TELLER_CERT,
56 |         envs,
57 |       });
58 |
59 |       try {
60 |         const data = await api.getConnectionStatus({
61 |           id,
62 |           accessToken,
63 |         });
64 |
65 |         return c.json(
66 |           {
67 |             data,
68 |           },
69 |           200,
70 |         );
71 |       } catch (error) {
72 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
73 |
74 |         return c.json(errorResponse, 400);
75 |       }
76 |     },
77 |   )
78 |   .openapi(
79 |     createRoute({
80 |       method: "post",
81 |       path: "/delete",
82 |       summary: "Delete Connection",
83 |       request: {
84 |         body: {
85 |           content: {
86 |             "application/json": {
87 |               schema: DeleteConnectionBodySchema,
88 |             },
89 |           },
90 |         },
91 |       },
92 |       responses: {
93 |         200: {
94 |           content: {
95 |             "application/json": {
96 |               schema: ConnectionDeletedSchema,
97 |             },
98 |           },
99 |           description: "Connection deleted successfully",
100 |         },
101 |         400: {
102 |           content: {
103 |             "application/json": {
104 |               schema: ErrorSchema,
105 |             },
106 |           },
107 |           description: "Returns an error",
108 |         },
109 |       },
110 |     }),
111 |     async (c) => {
112 |       const envs = env(c);
113 |       const { id, provider, accessToken } = await c.req.json();
114 |
115 |       const api = new Provider({
116 |         provider,
117 |         kv: c.env.KV,
118 |         fetcher: c.env.TELLER_CERT,
119 |         envs,
120 |       });
121 |
122 |       try {
123 |         await api.deleteConnection({
124 |           id,
125 |           accessToken,
126 |         });
127 |
128 |         return c.json(
129 |           {
130 |             data: {
131 |               success: true,
132 |             },
133 |           },
134 |           200,
135 |         );
136 |       } catch (error) {
137 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
138 |
139 |         return c.json(errorResponse, 400);
140 |       }
141 |     },
142 |   )
143 |   .openapi(
144 |     createRoute({
145 |       method: "get",
146 |       path: "/gocardless",
147 |       summary: "Get GoCardless Connections",
148 |       responses: {
149 |         200: {
150 |           content: {
151 |             "application/json": {
152 |               schema: GoCardLessConnectionsSchema,
153 |             },
154 |           },
155 |           description: "Retrieve GoCardless connections",
156 |         },
157 |         400: {
158 |           content: {
159 |             "application/json": {
160 |               schema: ErrorSchema,
161 |             },
162 |           },
163 |           description: "Returns an error",
164 |         },
165 |       },
166 |     }),
167 |     async (c) => {
168 |       const envs = env(c);
169 |
170 |       const api = new GoCardLessApi({
171 |         kv: c.env.KV,
172 |         envs,
173 |       });
174 |
175 |       try {
176 |         const data = await api.getRequisitions();
177 |
178 |         return c.json(
179 |           {
180 |             count: data.count,
181 |             next: data.next,
182 |             previous: data.previous,
183 |             results: data.results,
184 |           },
185 |           200,
186 |         );
187 |       } catch (error) {
188 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
189 |
190 |         return c.json(errorResponse, 400);
191 |       }
192 |     },
193 |   )
194 |   .openapi(
195 |     createRoute({
196 |       method: "get",
197 |       path: "/:reference",
198 |       summary: "Get Connection by Reference",
199 |       request: {
200 |         params: ConnectionByReferenceParamsSchema,
201 |       },
202 |       responses: {
203 |         200: {
204 |           content: {
205 |             "application/json": {
206 |               schema: ConnectionByReferenceSchema,
207 |             },
208 |           },
209 |           description: "Retrieve connection by reference",
210 |         },
211 |         404: {
212 |           content: {
213 |             "application/json": {
214 |               schema: ErrorSchema,
215 |             },
216 |           },
217 |           description: "Connection not found",
218 |         },
219 |         400: {
220 |           content: {
[TRUNCATED]
```

apps/engine/src/routes/connections/schema.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { z } from "@hono/zod-openapi";
3 |
4 | export const ConnectionStatusQuerySchema = z.object({
5 |   id: z
6 |     .string()
7 |     .optional()
8 |     .openapi({
9 |       description: "GoCardLess reference id",
10 |       param: {
11 |         name: "id",
12 |         in: "query",
13 |       },
14 |       example: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
15 |     }),
16 |   provider: Providers.openapi({
17 |     example: Providers.Enum.teller,
18 |   }),
19 |   accessToken: z
20 |     .string()
21 |     .optional()
22 |     .openapi({
23 |       description: "Teller or Plaid access token",
24 |       param: {
25 |         name: "accessToken",
26 |         in: "query",
27 |       },
28 |       example: "test_token_ky6igyqi3qxa4",
29 |     }),
30 | });
31 |
32 | export const ConnectionStatusSchema = z
33 |   .object({
34 |     data: z.object({
35 |       status: z.string().openapi({
36 |         example: "connected",
37 |       }),
38 |     }),
39 |   })
40 |   .openapi("ConnectionStatusSchema");
41 |
42 | export const ConnectionDeletedSchema = z.object({
43 |   data: z.object({
44 |     success: z.boolean(),
45 |   }),
46 | });
47 |
48 | export const DeleteConnectionBodySchema = z.object({
49 |   id: z
50 |     .string()
51 |     .optional()
52 |     .openapi({
53 |       description: "GoCardLess reference id",
54 |       param: {
55 |         name: "id",
56 |         in: "query",
57 |       },
58 |       example: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
59 |     }),
60 |   provider: Providers.openapi({
61 |     example: Providers.Enum.teller,
62 |   }),
63 |   accessToken: z
64 |     .string()
65 |     .optional()
66 |     .openapi({
67 |       description: "Teller or Plaid access token",
68 |       param: {
69 |         name: "accessToken",
70 |         in: "query",
71 |       },
72 |       example: "test_token_ky6igyqi3qxa4",
73 |     }),
74 | });
75 |
76 | export const ConnectionByReferenceParamsSchema = z.object({
77 |   reference: z.string().openapi({
78 |     description: "GoCardLess reference id",
79 |     param: {
80 |       name: "reference",
81 |       in: "path",
82 |     },
83 |   }),
84 | });
85 |
86 | export const ConnectionByReferenceSchema = z.object({
87 |   data: z.object({
88 |     id: z.string(),
89 |     accounts: z.array(z.string()),
90 |   }),
91 | });
92 |
93 | export const GoCardLessConnectionSchema = z.object({
94 |   id: z.string(),
95 |   created: z.string(),
96 |   redirect: z.string(),
97 |   status: z.enum(["CR", "GC", "UA", "RJ", "SA", "GA", "LN", "EX"]),
98 |   institution_id: z.string(),
99 |   agreement: z.string(),
100 |   reference: z.string(),
101 |   accounts: z.array(z.string()),
102 |   user_language: z.string(),
103 |   link: z.string(),
104 |   ssn: z.string(),
105 |   account_selection: z.boolean(),
106 |   redirect_immediate: z.boolean(),
107 | });
108 |
109 | export const GoCardLessConnectionsSchema = z.object({
110 |   count: z.number(),
111 |   next: z.string(),
112 |   previous: z.string(),
113 |   results: z.array(GoCardLessConnectionSchema),
114 | });
```

apps/engine/src/routes/enrich/index.ts
```
1 | import { GeneralErrorSchema } from "@/common/schema";
2 | import { enrichTransactionWithLLM } from "@/utils/enrich";
3 | import { OpenAPIHono, createRoute } from "@hono/zod-openapi";
4 | import type { Bindings } from "hono/types";
5 | import { EnrichBodySchema, EnrichSchema } from "./schema";
6 |
7 | const app = new OpenAPIHono<{ Bindings: Bindings }>().openapi(
8 |   createRoute({
9 |     method: "post",
10 |     path: "/",
11 |     summary: "Enrich transactions",
12 |     request: {
13 |       body: {
14 |         content: {
15 |           "application/json": {
16 |             schema: EnrichBodySchema,
17 |           },
18 |         },
19 |       },
20 |     },
21 |     responses: {
22 |       200: {
23 |         content: {
24 |           "application/json": {
25 |             schema: EnrichSchema,
26 |           },
27 |         },
28 |         description: "Enrich a transaction",
29 |       },
30 |       400: {
31 |         content: {
32 |           "application/json": {
33 |             schema: GeneralErrorSchema,
34 |           },
35 |         },
36 |         description: "Returns an error",
37 |       },
38 |     },
39 |   }),
40 |   async (c) => {
41 |     const { data } = c.req.valid("json");
42 |
43 |     try {
44 |       const enrichments = await Promise.all(
45 |         data.map(async ({ id, ...transaction }) => {
46 |           // @ts-ignore
47 |           const enrichment = await enrichTransactionWithLLM(c, transaction);
48 |           return {
49 |             id,
50 |             ...enrichment,
51 |           };
52 |         }),
53 |       );
54 |
55 |       return c.json(
56 |         {
57 |           data: enrichments,
58 |         },
59 |         200,
60 |       );
61 |     } catch (error) {
62 |       console.error(error);
63 |       return c.json(
64 |         {
65 |           error: "Internal server error",
66 |           message: "Internal server error",
67 |           requestId: c.get("requestId"),
68 |           code: "400",
69 |         },
70 |         400,
71 |       );
72 |     }
73 |   },
74 | );
75 |
76 | export default app;
```

apps/engine/src/routes/enrich/schema.ts
```
1 | import { z } from "@hono/zod-openapi";
2 |
3 | export const EnrichBodySchema = z.object({
4 |   data: z
5 |     .array(
6 |       z.object({
7 |         id: z.string().openapi("The id of the transaction"),
8 |         date: z.coerce.date().openapi("The date of the transaction"),
9 |         description: z.string().openapi("The description of the transaction"),
10 |         currency: z.string().openapi("The currency of the transaction"),
11 |         amount: z.number().openapi("The amount of the transaction"),
12 |         category: z
13 |           .string()
14 |           .optional()
15 |           .openapi("The category of the transaction"),
16 |       }),
17 |     )
18 |     .min(1)
19 |     .max(50)
20 |     .openapi("The transactions to enrich"),
21 | });
22 |
23 | export const EnrichSchema = z
24 |   .object({
25 |     data: z.array(
26 |       z.object({
27 |         category: z
28 |           .string()
29 |           .openapi("The category of the transaction")
30 |           .nullable(),
31 |         company: z.string().openapi("The company name").nullable(),
32 |         website: z
33 |           .string()
34 |           .url()
35 |           .openapi("The website of the company")
36 |           .nullable(),
37 |         subscription: z
38 |           .boolean()
39 |           .openapi(
40 |             "Whether the transaction is a recurring subscription payment",
41 |           ),
42 |       }),
43 |     ),
44 |   })
45 |   .openapi("EnrichSchema");
46 |
47 | export const OutputSchema = z.object({
48 |   category: z
49 |     .enum([
50 |       "travel",
51 |       "office_supplies",
52 |       "meals",
53 |       "software",
54 |       "rent",
55 |       "equipment",
56 |       "internet_and_telephone",
57 |       "facilities_expenses",
58 |       "activity",
59 |       "taxes",
60 |       "fees",
61 |     ])
62 |     .describe("The category of the transaction")
63 |     .nullable(),
64 |   company: z.string().describe("The company name").nullable(),
65 |   website: z
66 |     .string()
67 |     .describe("The website of the company, only root domains without protocol")
68 |     .nullable(),
69 |   subscription: z
70 |     .boolean()
71 |     .describe("Whether the transaction is a recurring subscription payment")
72 |     .default(false),
73 | });
74 |
75 | export type EnrichBody = z.infer<typeof EnrichBodySchema>;
```

apps/engine/src/routes/health/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema } from "@/common/schema";
3 | import { Provider } from "@/providers";
4 | import { getHealthCheck } from "@/utils/search";
5 | import { createRoute } from "@hono/zod-openapi";
6 | import { OpenAPIHono } from "@hono/zod-openapi";
7 | import { env } from "hono/adapter";
8 | import { HealthSchema } from "./schema";
9 |
10 | const app = new OpenAPIHono<{ Bindings: Bindings }>().openapi(
11 |   createRoute({
12 |     method: "get",
13 |     path: "/",
14 |     summary: "Health",
15 |     responses: {
16 |       200: {
17 |         content: {
18 |           "application/json": {
19 |             schema: HealthSchema,
20 |           },
21 |         },
22 |         description: "Retrieve health",
23 |       },
24 |       400: {
25 |         content: {
26 |           "application/json": {
27 |             schema: ErrorSchema,
28 |           },
29 |         },
30 |         description: "Returns an error",
31 |       },
32 |     },
33 |   }),
34 |   async (c) => {
35 |     const envs = env(c);
36 |
37 |     const api = new Provider();
38 |
39 |     const providers = await api.getHealthCheck({
40 |       kv: c.env.KV,
41 |       fetcher: c.env.TELLER_CERT,
42 |       envs,
43 |     });
44 |
45 |     const search = await getHealthCheck(envs);
46 |
47 |     const allServices = {
48 |       ...providers,
49 |       search,
50 |     };
51 |
52 |     const isHealthy = Object.values(allServices).every(
53 |       (service) => service.healthy,
54 |     );
55 |
56 |     if (isHealthy) {
57 |       return c.json(
58 |         {
59 |           data: allServices,
60 |         },
61 |         200,
62 |       );
63 |     }
64 |
65 |     return c.json(
66 |       {
67 |         requestId: c.get("requestId"),
68 |         message: "Service unhelthy",
69 |         code: "bad_request",
70 |       },
71 |       400,
72 |     );
73 |   },
74 | );
75 |
76 | export default app;
```

apps/engine/src/routes/health/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const HealthSchema = z
4 |   .object({
5 |     data: z.object({
6 |       plaid: z.object({
7 |         healthy: z.boolean(),
8 |       }),
9 |       gocardless: z.object({
10 |         healthy: z.boolean(),
11 |       }),
12 |       teller: z.object({
13 |         healthy: z.boolean(),
14 |       }),
15 |       search: z.object({
16 |         healthy: z.boolean(),
17 |       }),
18 |     }),
19 |   })
20 |   .openapi("HealthSchema");
```

apps/engine/src/routes/institutions/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema } from "@/common/schema";
3 | import type { Providers } from "@/providers/types";
4 | import { createErrorResponse } from "@/utils/error";
5 | import { SearchClient } from "@/utils/search";
6 | import { createRoute } from "@hono/zod-openapi";
7 | import { OpenAPIHono } from "@hono/zod-openapi";
8 | import { env } from "hono/adapter";
9 | import {
10 |   InstitutionParamsSchema,
11 |   InstitutionsSchema,
12 |   UpdateUsageParamsSchema,
13 |   UpdateUsageSchema,
14 | } from "./schema";
15 | import { excludedInstitutions } from "./utils";
16 |
17 | type Document = {
18 |   id: string;
19 |   name: string;
20 |   logo: string | null;
21 |   available_history: number | null;
22 |   provider: Providers;
23 |   popularity: number;
24 | };
25 |
26 | type SearchResult = {
27 |   hits: {
28 |     document: Document;
29 |   }[];
30 | };
31 |
32 | const app = new OpenAPIHono<{ Bindings: Bindings }>()
33 |   .openapi(
34 |     createRoute({
35 |       method: "get",
36 |       path: "/",
37 |       summary: "Get Institutions",
38 |       request: {
39 |         query: InstitutionParamsSchema,
40 |       },
41 |       responses: {
42 |         200: {
43 |           content: {
44 |             "application/json": {
45 |               schema: InstitutionsSchema,
46 |             },
47 |           },
48 |           description: "Retrieve institutions",
49 |         },
50 |         400: {
51 |           content: {
52 |             "application/json": {
53 |               schema: ErrorSchema,
54 |             },
55 |           },
56 |           description: "Returns an error",
57 |         },
58 |       },
59 |     }),
60 |     async (c) => {
61 |       const envs = env(c);
62 |       const { countryCode, q = "*", limit = "50" } = c.req.valid("query");
63 |
64 |       const typesense = SearchClient(envs);
65 |
66 |       const searchParameters = {
67 |         q,
68 |         query_by: "name",
69 |         filter_by: `countries:=[${countryCode}]`,
70 |         limit: +limit,
71 |       };
72 |
73 |       try {
74 |         const result = await typesense
75 |           .collections("institutions")
76 |           .documents()
77 |           .search(searchParameters);
78 |
79 |         const resultString: string =
80 |           typeof result === "string" ? result : JSON.stringify(result);
81 |
82 |         const data: SearchResult = JSON.parse(resultString);
83 |
84 |         const filteredInstitutions = data.hits.filter(
85 |           ({ document }) => !excludedInstitutions.includes(document.id),
86 |         );
87 |
88 |         return c.json(
89 |           {
90 |             data: filteredInstitutions.map(({ document }) => ({
91 |               id: document.id,
92 |               name: document.name,
93 |               logo: document.logo ?? null,
94 |               popularity: document.popularity,
95 |               available_history: document.available_history
96 |                 ? +document.available_history
97 |                 : null,
98 |               provider: document.provider,
99 |             })),
100 |           },
101 |           200,
102 |         );
103 |       } catch (error) {
104 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
105 |
106 |         return c.json(errorResponse, 400);
107 |       }
108 |     },
109 |   )
110 |   .openapi(
111 |     createRoute({
112 |       method: "put",
113 |       path: "/{id}/usage",
114 |       summary: "Update Institution Usage",
115 |       request: {
116 |         params: UpdateUsageParamsSchema,
117 |       },
118 |       responses: {
119 |         200: {
120 |           content: {
121 |             "application/json": {
122 |               schema: UpdateUsageSchema,
123 |             },
124 |           },
125 |           description: "Update institution usage",
126 |         },
127 |         400: {
128 |           content: {
129 |             "application/json": {
130 |               schema: ErrorSchema,
131 |             },
132 |           },
133 |           description: "Returns an error",
134 |         },
135 |       },
136 |     }),
137 |     async (c) => {
138 |       const envs = env(c);
139 |       const id = c.req.param("id");
140 |
141 |       const typesense = SearchClient(envs);
142 |
143 |       try {
144 |         const original = await typesense
145 |           .collections("institutions")
146 |           .documents(id)
147 |           .retrieve();
148 |
149 |         const originalData: Document =
150 |           typeof original === "string" && JSON.parse(original);
151 |
152 |         const result = await typesense
153 |           .collections("institutions")
154 |           .documents(id)
155 |           .update({
156 |             popularity: originalData?.popularity + 1 || 0,
157 |           });
158 |
159 |         const data: Document =
160 |           typeof result === "string" ? JSON.parse(result) : [];
161 |
162 |         return c.json(
163 |           {
164 |             data,
165 |           },
166 |           200,
167 |         );
168 |       } catch (error) {
169 |         const errorResponse = createErrorResponse(error, c.get("requestId"));
170 |
171 |         return c.json(errorResponse, 400);
172 |       }
173 |     },
174 |   );
175 |
176 | export default app;
```

apps/engine/src/routes/institutions/schema.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { ALL_COUNTRIES } from "@/utils/countries";
3 | import { z } from "@hono/zod-openapi";
4 |
5 | export const InstitutionSchema = z
6 |   .object({
7 |     id: z.string().openapi({
8 |       example: "9293961c-df93-4d6d-a2cc-fc3e353b2d10",
9 |     }),
10 |     name: z.string().openapi({
11 |       example: "Wells Fargo Bank",
12 |     }),
13 |     logo: z
14 |       .string()
15 |       .openapi({
16 |         example:
17 |           "https://cdn.midday.ai/institution/9293961c-df93-4d6d-a2cc-fc3e353b2d10.jpg",
18 |       })
19 |       .nullable(),
20 |     available_history: z
21 |       .number()
22 |       .optional()
23 |       .openapi({
24 |         example: 365,
25 |       })
26 |       .nullable(),
27 |     provider: Providers.openapi({
28 |       example: Providers.Enum.teller,
29 |     }),
30 |   })
31 |   .openapi("InstitutionSchema");
32 |
33 | export const InstitutionsSchema = z
34 |   .object({
35 |     data: z.array(InstitutionSchema),
36 |   })
37 |   .openapi("InstitutionsSchema");
38 |
39 | export const UpdateUsageParamsSchema = z
40 |   .object({
41 |     id: z.string().openapi({
42 |       param: {
43 |         name: "id",
44 |         in: "path",
45 |       },
46 |       example: "STARLING_SRLGGB3L",
47 |     }),
48 |   })
49 |   .openapi("UpdateUsageParamsSchema");
50 |
51 | export const UpdateUsageSchema = z
52 |   .object({
53 |     data: InstitutionSchema,
54 |   })
55 |   .openapi("UpdateUsageSchema");
56 |
57 | export const InstitutionParamsSchema = z
58 |   .object({
59 |     q: z
60 |       .string()
61 |       .optional()
62 |       .openapi({
63 |         description: "Search query",
64 |         param: {
65 |           name: "q",
66 |           in: "query",
67 |         },
68 |         example: "Swedbank",
69 |       }),
70 |     limit: z
71 |       .string()
72 |       .optional()
73 |       .openapi({
74 |         description: "Limit results",
75 |         param: {
76 |           name: "limit",
77 |           in: "query",
78 |         },
79 |         example: "50",
80 |       }),
81 |     countryCode: z.enum(ALL_COUNTRIES as [string, ...string[]]).openapi({
82 |       description: "Country code",
83 |       param: {
84 |         name: "countryCode",
85 |         in: "query",
86 |       },
87 |       example: ALL_COUNTRIES.at(1),
88 |     }),
89 |   })
90 |   .openapi("InstitutionParamsSchema");
```

apps/engine/src/routes/institutions/utils.ts
```
1 | import { GoCardLessProvider } from "@/providers/gocardless/gocardless-provider";
2 | import { PlaidProvider } from "@/providers/plaid/plaid-provider";
3 | import { TellerProvider } from "@/providers/teller/teller-provider";
4 | import type { ProviderParams } from "@/providers/types";
5 |
6 | export const excludedInstitutions = [
7 |   "ins_56", // Chase - Plaid
8 | ];
9 |
10 | export async function getInstitutions(
11 |   params: Omit<
12 |     ProviderParams & { countryCode: string; storage: R2Bucket },
13 |     "provider"
14 |   >,
15 | ) {
16 |   const { countryCode } = params;
17 |
18 |   const gocardless = new GoCardLessProvider(params);
19 |   const teller = new TellerProvider(params);
20 |   const plaid = new PlaidProvider(params);
21 |
22 |   const result = await Promise.all([
23 |     teller.getInstitutions(),
24 |     gocardless.getInstitutions({ countryCode }),
25 |     plaid.getInstitutions({ countryCode }),
26 |   ]);
27 |
28 |   return result.flat();
29 | }
```

apps/engine/src/routes/rates/index.ts
```
1 | import { GeneralErrorSchema } from "@/common/schema";
2 | import { getRates } from "@/utils/rates";
3 | import { OpenAPIHono, createRoute } from "@hono/zod-openapi";
4 | import type { Bindings } from "hono/types";
5 | import { RatesSchema } from "./schema";
6 |
7 | const app = new OpenAPIHono<{ Bindings: Bindings }>().openapi(
8 |   createRoute({
9 |     method: "get",
10 |     path: "/",
11 |     summary: "Get rates",
12 |     responses: {
13 |       200: {
14 |         content: {
15 |           "application/json": {
16 |             schema: RatesSchema,
17 |           },
18 |         },
19 |         description: "Retrieve rates",
20 |       },
21 |       400: {
22 |         content: {
23 |           "application/json": {
24 |             schema: GeneralErrorSchema,
25 |           },
26 |         },
27 |         description: "Returns an error",
28 |       },
29 |     },
30 |   }),
31 |   async (c) => {
32 |     try {
33 |       const data = await getRates();
34 |
35 |       return c.json(
36 |         {
37 |           data,
38 |         },
39 |         200,
40 |       );
41 |     } catch (error) {
42 |       return c.json(
43 |         {
44 |           error: "Internal server error",
45 |           message: "Internal server error",
46 |           requestId: c.get("requestId"),
47 |           code: "400",
48 |         },
49 |         400,
50 |       );
51 |     }
52 |   },
53 | );
54 |
55 | export default app;
```

apps/engine/src/routes/rates/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const RatesSchema = z
4 |   .object({
5 |     data: z.array(
6 |       z.object({
7 |         source: z.string().openapi({
8 |           example: "USD",
9 |         }),
10 |         date: z.string().openapi({
11 |           example: "2024-02-29",
12 |         }),
13 |         rates: z.record(z.string(), z.number()).openapi({
14 |           example: {
15 |             EUR: 0.925393,
16 |             GBP: 0.792256,
17 |             SEK: 10.0,
18 |             BDT: 200.0,
19 |           },
20 |         }),
21 |       }),
22 |     ),
23 |   })
24 |
25 |   .openapi("RatesSchema");
```

apps/engine/src/routes/transactions/index.ts
```
1 | import type { Bindings } from "@/common/bindings";
2 | import { ErrorSchema } from "@/common/schema";
3 | import { Provider } from "@/providers";
4 | import { createErrorResponse } from "@/utils/error";
5 | import { createRoute } from "@hono/zod-openapi";
6 | import { OpenAPIHono } from "@hono/zod-openapi";
7 | import { env } from "hono/adapter";
8 | import { TransactionsParamsSchema, TransactionsSchema } from "./schema";
9 |
10 | const app = new OpenAPIHono<{ Bindings: Bindings }>().openapi(
11 |   createRoute({
12 |     method: "get",
13 |     path: "/",
14 |     summary: "Get transactions",
15 |     request: {
16 |       query: TransactionsParamsSchema,
17 |     },
18 |     responses: {
19 |       200: {
20 |         content: {
21 |           "application/json": {
22 |             schema: TransactionsSchema,
23 |           },
24 |         },
25 |         description: "Retrieve transactions",
26 |       },
27 |       400: {
28 |         content: {
29 |           "application/json": {
30 |             schema: ErrorSchema,
31 |           },
32 |         },
33 |         description: "Returns an error",
34 |       },
35 |     },
36 |   }),
37 |   async (c) => {
38 |     const envs = env(c);
39 |     const { provider, accountId, accountType, latest, accessToken } =
40 |       c.req.valid("query");
41 |
42 |     const api = new Provider({
43 |       provider,
44 |       fetcher: c.env.TELLER_CERT,
45 |       kv: c.env.KV,
46 |       envs,
47 |     });
48 |
49 |     try {
50 |       const data = await api.getTransactions({
51 |         accountId,
52 |         accessToken,
53 |         accountType,
54 |         latest,
55 |       });
56 |
57 |       return c.json(
58 |         {
59 |           data,
60 |         },
61 |         200,
62 |       );
63 |     } catch (error) {
64 |       const errorResponse = createErrorResponse(error, c.get("requestId"));
65 |
66 |       return c.json(errorResponse, 400);
67 |     }
68 |   },
69 | );
70 |
71 | export default app;
```

apps/engine/src/routes/transactions/schema.ts
```
1 | import { Providers } from "@/common/schema";
2 | import { z } from "@hono/zod-openapi";
3 |
4 | export const TransactionsParamsSchema = z
5 |   .object({
6 |     provider: Providers.openapi({
7 |       param: {
8 |         name: "provider",
9 |         in: "query",
10 |       },
11 |       example: Providers.Enum.teller,
12 |     }),
13 |     accountId: z.string().openapi({
14 |       description: "Get transactions by accountId",
15 |       param: {
16 |         name: "accountId",
17 |         in: "query",
18 |       },
19 |       example: "5341343-4234-4c65-815c-t234213442",
20 |     }),
21 |     accountType: z.enum(["credit", "depository"]).openapi({
22 |       description:
23 |         "Get transactions with the correct amount depending on credit or depository",
24 |       param: {
25 |         name: "accountType",
26 |         in: "query",
27 |       },
28 |       example: "depository",
29 |     }),
30 |     accessToken: z
31 |       .string()
32 |       .optional()
33 |       .openapi({
34 |         description: "Used for Teller and Plaid",
35 |         param: {
36 |           name: "accessToken",
37 |           in: "query",
38 |         },
39 |         example: "token-123",
40 |       }),
41 |     latest: z
42 |       .preprocess((val) => val === "true", z.boolean().default(false))
43 |       .openapi({
44 |         description: "Get latest transactions",
45 |         param: {
46 |           name: "latest",
47 |           in: "query",
48 |         },
49 |         example: "true",
50 |       }),
51 |   })
52 |   .openapi("TransactionsParamsSchema");
53 |
54 | export const TransactionSchema = z
55 |   .object({
56 |     id: z.string().openapi({
57 |       example: "9293961c-df93-4d6d-a2cc-fc3e353b2d10",
58 |     }),
59 |     description: z
60 |       .string()
61 |       .openapi({
62 |         example: "Transfer to bank account",
63 |       })
64 |       .nullable(),
65 |     method: z
66 |       .string()
67 |       .openapi({
68 |         example: "other",
69 |       })
70 |       .nullable(),
71 |     amount: z.number().openapi({
72 |       example: 100,
73 |     }),
74 |     name: z.string().openapi({
75 |       example: "Vercel Inc.",
76 |     }),
77 |     date: z.string().openapi({
78 |       example: "2024-06-12",
79 |     }),
80 |     currency: z.string().openapi({
81 |       example: "USD",
82 |     }),
83 |     status: z.enum(["pending", "posted"]).openapi({
84 |       example: "posted",
85 |     }),
86 |     category: z
87 |       .string()
88 |       .openapi({
89 |         example: "travel",
90 |       })
91 |       .nullable(),
92 |     balance: z
93 |       .number()
94 |       .openapi({
95 |         example: 10000,
96 |       })
97 |       .nullable(),
98 |   })
99 |   .openapi("TransactionSchema");
100 |
101 | export const TransactionsSchema = z
102 |   .object({
103 |     data: z.array(TransactionSchema),
104 |   })
105 |   .openapi("TransactionsSchema");
```

apps/website/src/app/branding/page.tsx
```
1 | import { BrandCanvas } from "@/components/brand-canvas";
2 | import type { Metadata } from "next";
3 |
4 | export const metadata: Metadata = {
5 |   title: "Branding",
6 |   description: "Download branding assets, logo, screenshots and more.",
7 | };
8 |
9 | export default function Page() {
10 |   return <BrandCanvas />;
11 | }
```

apps/website/src/app/components/page.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Card } from "@midday/ui/card";
3 | import { cn } from "@midday/ui/cn";
4 | import type { Metadata } from "next";
5 | import Image from "next/image";
6 | import Link from "next/link";
7 | import editor from "./editor.png";
8 | import invoiceOg from "./invoice-og.png";
9 | import invoiceReact from "./invoice-react.png";
10 | import invoiceToolbar from "./invoice-toolbar.png";
11 | import invoice from "./invoice.png";
12 | import pdf from "./pdf.png";
13 |
14 | export const metadata: Metadata = {
15 |   title: "Components | Midday",
16 |   description:
17 |     "A list of open source components that can be used in your project.",
18 | };
19 |
20 | const components = [
21 |   {
22 |     name: "Editor",
23 |     description: "A rich text editor with AI tools powered by Vercel AI SDK.",
24 |     image: editor,
25 |     href: "/components/editor",
26 |     className: "mt-24 max-w-[300px]",
27 |     ready: true,
28 |   },
29 |
30 |   {
31 |     name: "Invoice PDF Template",
32 |     description: "A React PDF template supporting Tiptap JSON and more.",
33 |     image: pdf,
34 |     href: "/components/invoice",
35 |     ready: true,
36 |   },
37 |   {
38 |     name: "Invoice React Template",
39 |     description: "A React template for invoices supporting Tiptap JSON format.",
40 |     image: invoiceReact,
41 |     href: "/components/invoice-react",
42 |     ready: true,
43 |   },
44 |   {
45 |     name: "Invoice Open Graph Template",
46 |     description: "A Next.js Open Graph template for invoices.",
47 |     image: invoiceOg,
48 |     href: "/components/invoice-og",
49 |     ready: true,
50 |   },
51 |   {
52 |     name: "Invoice Toolbar",
53 |     description: "A toolbar for invoices with comments and avatars.",
54 |     image: invoiceToolbar,
55 |     href: "/components/invoice-toolbar",
56 |     ready: true,
57 |     className: "mt-24 max-w-[220px]",
58 |   },
59 |   {
60 |     name: "Invoice Editor",
61 |     description:
62 |       "A visual invoice editor thats highly customizable and easy to use.",
63 |     image: invoice,
64 |     href: "/components",
65 |     ready: false,
66 |   },
67 | ];
68 |
69 | export default function Page() {
70 |   return (
71 |     <div className="container mb-52">
72 |       <div className="mb-40 flex flex-col items-center">
73 |         <h1 className="mt-24 font-medium text-center text-[55px] md:text-[170px] mb-2 leading-none text-stroke">
74 |           Components
75 |         </h1>
76 |
77 |         <div className="flex items-center flex-col text-center relative">
78 |           <p className="text-lg mt-4 max-w-[600px]">
79 |             A collection of open-source components based on Midday features.
80 |           </p>
81 |         </div>
82 |
83 |         <a href="https://git.new/midday" target="_blank" rel="noreferrer">
84 |           <Button className="mt-8">View on Github</Button>
85 |         </a>
86 |       </div>
87 |
88 |       <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8">
89 |         {components.map(
90 |           ({ name, description, image, href, ready, className }) => (
91 |             <Link href={href} key={name} className="flex">
92 |               <Card className="p-6 flex flex-col group w-full">
93 |                 <div className="flex items-center justify-between mb-4">
94 |                   <h2 className="text-lg font-semibold">{name}</h2>
95 |                   {!ready && (
96 |                     <span className="text-[#F5F5F3] dark:border dark:border-border rounded-full text-[10px] font-mono px-1.5 py-1 bg-[#1D1D1D]">
97 |                       Coming soon
98 |                     </span>
99 |                   )}
100 |                 </div>
101 |                 <p className="text-sm text-[#878787]">{description}</p>
102 |
103 |                 <div className="flex justify-center mt-6 w-full">
104 |                   <Image
105 |                     src={image}
106 |                     alt={name}
107 |                     className={cn(
108 |                       "transition-transform duration-300 group-hover:-translate-y-2",
109 |                       className,
110 |                     )}
111 |                   />
112 |                 </div>
113 |               </Card>
114 |             </Link>
115 |           ),
116 |         )}
117 |       </div>
118 |     </div>
119 |   );
120 | }
```

apps/website/src/app/download/page.tsx
```
1 | import { CopyInput } from "@/components/copy-input";
2 | import { Keyboard } from "@/components/keyboard";
3 | import { Button } from "@midday/ui/button";
4 | import type { Metadata } from "next";
5 | import Image from "next/image";
6 | import appIcon from "public/app-icon.png";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Download",
10 |   description:
11 |     "With Midday on Mac you have everything accessible just one click away.",
12 | };
13 |
14 | export default function Page() {
15 |   return (
16 |     <div className="container flex flex-col items-center mb-12 md:mb-48 text-center">
17 |       <h1 className="mt-24 font-medium text-center text-5xl mb-24">
18 |         Always at your fingertips.
19 |       </h1>
20 |
21 |       <Keyboard />
22 |
23 |       <Image
24 |         src={appIcon}
25 |         alt="Midday App"
26 |         width={120}
27 |         height={120}
28 |         quality={90}
29 |         className="w-[80px] h-[80px] mt-12 md:mt-0 md:h-auto md:w-auto"
30 |       />
31 |       <p className="mb-4 text-2xl	font-medium mt-8">Midday for Mac</p>
32 |       <p className="text-[#878787] font-sm max-w-[500px]">
33 |         With Midday on Mac you have everything <br />
34 |         accessible just one click away.
35 |       </p>
36 |
37 |       <a href="https://go.midday.ai/d" download>
38 |         <Button
39 |           variant="outline"
40 |           className="border border-primary h-12 px-6 mt-8"
41 |         >
42 |           Download
43 |         </Button>
44 |       </a>
45 |
46 |       <p className="text-xs text-[#878787] mt-4">
47 |         Supports apple silicon & intel
48 |       </p>
49 |
50 |       <CopyInput
51 |         value="curl -sL https://go.midday.ai/d | tar -xz"
52 |         className="max-w-[410px] mt-8 font-mono font-normal hidden md:block rounded-full"
53 |       />
54 |     </div>
55 |   );
56 | }
```

apps/website/src/app/engine/page.tsx
```
1 | import { DynamicImage } from "@/components/dynamic-image";
2 | import { SubscribeInput } from "@/components/subscribe-input";
3 | import type { Metadata } from "next";
4 | import Image from "next/image";
5 | import engineSDK from "public/engine-sdk.png";
6 | import engineLight from "public/engine-ui-light.png";
7 | import engineDark from "public/engine-ui.png";
8 |
9 | export const metadata: Metadata = {
10 |   title: "Engine",
11 |   description:
12 |     "Midday engine streamlines banking integrations with a single API effortlessly connecting to multiple providers and get one unified format.",
13 | };
14 |
15 | export default function Page() {
16 |   return (
17 |     <div className="w-full dark:bg-[#0C0C0C] flex flex-col items-center justify-center mt-24">
18 |       <h1 className="text-[100px] md:text-[170px] font-medium text-center text-primary relative z-20 leading-none">
19 |         One API
20 |       </h1>
21 |
22 |       <h2 className="text-[100px] md:text-[170px] leading-none text-dotted text-center">
23 |         to rule them all
24 |       </h2>
25 |
26 |       <div className="mb-2 mt-6">
27 |         <p className="text-[#707070] mt-4 mb-8 text-center max-w-[550px]">
28 |           Midday engine streamlines banking integrations with a single API
29 |           effortlessly connecting to multiple providers and get one unified
30 |           format.
31 |         </p>
32 |       </div>
33 |
34 |       <SubscribeInput />
35 |
36 |       <div className="text-center flex flex-col items-center mt-[140px]">
37 |         <h3 className="mb-4 text-2xl font-medium">
38 |           Unlimited bank connections
39 |         </h3>
40 |         <p className="text-[#878787] font-sm max-w-[600px]">
41 |           Expand your market reach by enabling multiple banking providers with
42 |           just one click. We add even more providers in the future.
43 |         </p>
44 |
45 |         <DynamicImage
46 |           lightSrc={engineLight}
47 |           darkSrc={engineDark}
48 |           alt="Engine UI"
49 |           width={1026}
50 |           height={552}
51 |           className="mt-16"
52 |           quality={90}
53 |         />
54 |       </div>
55 |
56 |       <div className="text-center flex flex-col items-center mt-24">
57 |         <h3 className="mb-4 text-2xl font-medium">
58 |           One SDK, implement in minutes
59 |         </h3>
60 |         <p className="text-[#878787] font-sm max-w-[600px]">
61 |           With Midday Engine SDK you can implement banking providers in matter
62 |           of minutes.
63 |         </p>
64 |
65 |         <Image
66 |           src={engineSDK}
67 |           alt="Engine SDK"
68 |           width={740}
69 |           height={420}
70 |           className="mt-8"
71 |         />
72 |       </div>
73 |     </div>
74 |   );
75 | }
```

apps/website/src/app/feature-request/features.tsx
```
1 | export const features = [
2 |   {
3 |     id: "xero",
4 |     name: "Xero",
5 |     description:
6 |       "Integrating with Xero allows you to synchronize transactions and attachments neatly organized in your bookkeeping software, making it easier for you or your accountant to close your books faster.",
7 |     logo: (
8 |       <svg
9 |         xmlns="http://www.w3.org/2000/svg"
10 |         width={60}
11 |         height={60}
12 |         fill="none"
13 |       >
14 |         <g clipPath="url(#a)">
15 |           <mask
16 |             id="b"
17 |             width={88}
18 |             height={88}
19 |             x={-14}
20 |             y={-14}
21 |             maskUnits="userSpaceOnUse"
22 |             style={{
23 |               maskType: "luminance",
24 |             }}
25 |           >
26 |             <path
27 |               fill="#fff"
28 |               d="M-13.205-13.275h86.464V73.19h-86.464v-86.464Z"
29 |             />
30 |           </mask>
31 |           <g mask="url(#b)">
32 |             <path
33 |               fill="white"
34 |               d="M30 59.885c16.505 0 29.886-13.38 29.886-29.885C59.886 13.494 46.505.114 30 .114S.114 13.494.114 30c0 16.505 13.38 29.885 29.886 29.885Z"
35 |             />
36 |             <path
37 |               fill="#121212"
38 |               d="m14.42 29.913 5.1-5.112a.914.914 0 0 0-1.3-1.285l-5.096 5.094-5.118-5.101a.914.914 0 1 0-1.285 1.299l5.1 5.098-5.097 5.107a.914.914 0 1 0 1.282 1.3l5.11-5.103 5.091 5.085a.911.911 0 0 0 1.576-.628.907.907 0 0 0-.266-.644l-5.097-5.11ZM44.74 29.912c0 .915.745 1.66 1.662 1.66.914 0 1.66-.745 1.66-1.66 0-.916-.746-1.66-1.66-1.66-.917 0-1.662.744-1.662 1.66Z"
39 |             />
40 |             <path
41 |               fill="#121212"
42 |               d="M41.59 29.912a4.814 4.814 0 0 1 4.81-4.809 4.815 4.815 0 0 1 4.808 4.81A4.814 4.814 0 0 1 46.4 34.72a4.814 4.814 0 0 1-4.81-4.808Zm-1.891 0c0 3.695 3.006 6.7 6.7 6.7 3.695 0 6.703-3.005 6.703-6.7 0-3.694-3.008-6.7-6.702-6.7a6.709 6.709 0 0 0-6.701 6.7ZM39.223 23.326h-.28a3.8 3.8 0 0 0-2.339.79.916.916 0 0 0-.892-.72.904.904 0 0 0-.906.907l.003 11.286a.915.915 0 0 0 1.827-.002v-6.939c0-2.313.212-3.247 2.193-3.494.184-.023.383-.02.383-.02.543-.018.928-.39.928-.894a.916.916 0 0 0-.917-.914ZM21.677 28.81l.003-.077a4.842 4.842 0 0 1 9.402.076h-9.405Zm11.276-.173c-.394-1.864-1.415-3.396-2.969-4.38-2.272-1.442-5.272-1.362-7.467.198a6.777 6.777 0 0 0-2.823 5.503c0 .538.065 1.081.2 1.616a6.754 6.754 0 0 0 5.687 5.006 6.379 6.379 0 0 0 2.41-.16c.701-.171 1.38-.455 2.004-.855.648-.417 1.19-.966 1.714-1.624l.032-.036c.364-.451.296-1.093-.104-1.4-.337-.258-.904-.363-1.35.208a6.233 6.233 0 0 1-.32.417c-.354.392-.794.771-1.32 1.065a4.81 4.81 0 0 1-2.247.568c-2.658-.03-4.08-1.885-4.586-3.21a4.806 4.806 0 0 1-.204-.768 1.715 1.715 0 0 1-.012-.14l9.538-.002c1.308-.028 2.011-.95 1.817-2.006Z"
43 |             />
44 |           </g>
45 |         </g>
46 |         <defs>
47 |           <clipPath id="a">
48 |             <path fill="#fff" d="M0 0h60v60H0z" />
49 |           </clipPath>
50 |         </defs>
51 |       </svg>
52 |     ),
53 |   },
54 |   {
55 |     id: "quickbooks",
56 |     name: "Quickbooks",
57 |     description:
58 |       "Integrating with QuickBooks enables you to synchronize transactions and attachments, neatly organizing them in your bookkeeping software. This streamlines the process for you or your accountant to close your books faster.",
59 |     logo: (
60 |       <svg
61 |         xmlns="http://www.w3.org/2000/svg"
62 |         width={60}
63 |         height={60}
64 |         fill="none"
65 |       >
66 |         <path
67 |           fill="white"
[TRUNCATED]
```

apps/website/src/app/feature-request/page.tsx
```
1 | import { AppDetails } from "@/components/app-details";
2 | import { FeatureRequestModal } from "@/components/feature-request-modal";
3 | import { Button } from "@midday/ui/button";
4 | import { Dialog, DialogTrigger } from "@midday/ui/dialog";
5 | import type { Metadata } from "next";
6 | import { features } from "./features";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Feature Request",
10 |   description:
11 |     "Follow our roadmap and vote for what will be our next priority.",
12 | };
13 |
14 | export default async function Page() {
15 |   return (
16 |     <Dialog>
17 |       <div className="container max-w-[1050px]">
18 |         <h1 className="mt-24 font-medium text-center text-5xl mb-8">
19 |           Feature Request
20 |         </h1>
21 |
22 |         <p className="text-[#878787] font-sm text-center max-w-[550px] m-auto">
23 |           Follow our roadmap and vote for what will be our next priority.
24 |         </p>
25 |
26 |         <div className="flex justify-center mt-8">
27 |           <DialogTrigger asChild>
28 |             <Button
29 |               className="bg-transparent text-primary px-4 border-primary"
30 |               variant="outline"
31 |             >
32 |               Submit a request
33 |             </Button>
34 |           </DialogTrigger>
35 |         </div>
36 |
37 |         <div className="divide-y">
38 |           {features.map((feature) => {
39 |             return <AppDetails key={feature.id} {...feature} />;
40 |           })}
41 |         </div>
42 |       </div>
43 |
44 |       <FeatureRequestModal />
45 |     </Dialog>
46 |   );
47 | }
```

apps/website/src/app/inbox/page.tsx
```
1 | import { CopyInput } from "@/components/copy-input";
2 | import { CtaButton } from "@/components/cta-button";
3 | import { DynamicImage } from "@/components/dynamic-image";
4 | import type { Metadata } from "next";
5 | import BulkLight from "public/product-bulk-light.png";
6 | import BulkDark from "public/product-bulk.png";
7 | import InboxLight from "public/product-inbox-light.jpg";
8 | import InboxDark from "public/product-inbox.jpg";
9 | import MatchLight from "public/product-match-light.png";
10 | import MatchDark from "public/product-match.png";
11 |
12 | export const metadata: Metadata = {
13 |   title: "Inbox",
14 |   description:
15 |     "Automatically match incoming invoices or receipts to the correct transaction.",
16 | };
17 |
18 | export default function Page() {
19 |   return (
20 |     <div className="container mb-52">
21 |       <div className="mb-40">
22 |         <h1 className="mt-24 font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none text-stroke">
23 |           Magic
24 |         </h1>
25 |
26 |         <h3 className="font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none">
27 |           Inbox
28 |         </h3>
29 |
30 |         <div className="flex items-center flex-col text-center relative">
31 |           <p className="text-lg mt-4 max-w-[600px]">
32 |             Use your personalized email for invoices and receipts, with
33 |             transaction suggestions from Midday. Easily search, reconcile and
34 |             export documents to keep your business organized.
35 |           </p>
36 |
37 |           <CtaButton>Automate your reconciliation process</CtaButton>
38 |         </div>
39 |       </div>
40 |
41 |       <DynamicImage darkSrc={InboxDark} lightSrc={InboxLight} alt="Inbox" />
42 |
43 |       <div className="flex items-center flex-col text-center relative mt-28">
44 |         <div>
45 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
46 |             Automatic reconciliation
47 |           </h4>
48 |           <p className="text-[#878787] text-sm">
49 |             1. Use your personalized email address for your invoices and
50 |             receipts.
51 |             <br /> 2. The invoice arrives in the inbox, Midday gives you a
52 |             transaction suggestion to match it with. <br />
53 |             3. Your transactions now have the correct attachments, making it
54 |             easy for you to export them.
55 |           </p>
56 |         </div>
57 |
58 |         <CopyInput
59 |           value="inbox.f3f1s@midday.ai"
60 |           className="max-w-[240px] mt-8"
61 |         />
62 |
63 |         <DynamicImage
64 |           darkSrc={MatchDark}
65 |           lightSrc={MatchLight}
66 |           alt="Matching"
67 |           className="mt-10 max-w-[834px] w-full"
68 |         />
69 |
70 |         <div className="mt-32 max-w-[600px]">
71 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
72 |             Keep track and find that old receipt
73 |           </h4>
74 |           <p className="text-[#878787] text-sm mb-10">
75 |             Quickly search for specific content within your receipts and
76 |             invoices. Bulk upload by dragging and dropping, with automatic
77 |             storage in your vault. Keep everything organized and accessible to
78 |             simplify receipt reconciliation.
79 |           </p>
80 |         </div>
81 |
82 |         <DynamicImage
83 |           darkSrc={BulkDark}
84 |           lightSrc={BulkLight}
85 |           alt="Receipt"
86 |           className="mt-10 max-w-[1374px] w-full"
87 |         />
88 |       </div>
89 |     </div>
90 |   );
91 | }
```

apps/website/src/app/invoice/page.tsx
```
1 | import { CtaButton } from "@/components/cta-button";
2 | import { DynamicImage } from "@/components/dynamic-image";
3 | import type { Metadata } from "next";
4 | import InvoiceLight from "public/product-invoice-light.jpg";
5 | import InvoiceDark from "public/product-invoice.jpg";
6 | import PdfLight from "public/product-pdf-light.png";
7 | import PdfDark from "public/product-pdf.png";
8 | import StatusLight from "public/product-status-light.png";
9 | import StatusDark from "public/product-status.png";
10 |
11 | export const metadata: Metadata = {
12 |   title: "Invoice",
13 |   description:
14 |     "Create web-based invoices in seconds. Have an easy overview of all your invoices and see your outstanding balance.",
15 | };
16 |
17 | export default function Page() {
18 |   return (
19 |     <div className="container mb-52">
20 |       <div className="mb-40">
21 |         <div className="mt-24 text-center">
22 |           <h1 className="mt-24 font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none text-stroke">
23 |             Seamless
24 |           </h1>
25 |         </div>
26 |
27 |         <h3 className="font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none">
28 |           Invoice
29 |         </h3>
30 |
31 |         <div className="flex items-center flex-col text-center relative">
32 |           <p className="text-lg mt-4 max-w-[600px]">
33 |             Create web-based invoices in seconds. Have an easy overview of all
34 |             your invoices and see your outstanding balance.
35 |           </p>
36 |
37 |           <CtaButton>Create invoices in seconds</CtaButton>
38 |         </div>
39 |       </div>
40 |
41 |       <DynamicImage
42 |         darkSrc={InvoiceDark}
43 |         lightSrc={InvoiceLight}
44 |         alt="Invoice"
45 |       />
46 |
47 |       <div className="flex items-center flex-col text-center relative mt-28">
48 |         <div className="max-w-[600px]">
49 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
50 |             Fast and easy
51 |           </h4>
52 |           <p className="text-[#878787] text-sm">
53 |             Create and send invoices to your customers with ease. Add essential
54 |             details like VAT, sales tax, discounts and a personalized logo to
55 |             make your invoices professional and tailored to your needs. You can
56 |             send web invoices, export them as PDFs, and even track whether your
57 |             invoices have been viewed by the recipient.
58 |           </p>
59 |         </div>
60 |
61 |         <DynamicImage
62 |           darkSrc={PdfDark}
63 |           lightSrc={PdfLight}
64 |           alt="Pdf"
65 |           className="mt-10 max-w-[536px] w-full"
66 |         />
67 |
68 |         <div className="mt-32 max-w-[600px]">
69 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
70 |             Track payments and stay organized
71 |           </h4>
72 |           <p className="text-[#878787] text-sm mb-10">
73 |             Monitor your sent balance, stay on top of overdue payments, and send
74 |             reminders to ensure timely settlements. With these tools, managing
75 |             your invoicing process becomes streamlined and efficient, giving you
76 |             more time to focus on growing your business.
77 |           </p>
78 |         </div>
79 |
80 |         <DynamicImage
81 |           darkSrc={StatusDark}
82 |           lightSrc={StatusLight}
83 |           alt="Pdf"
84 |           className="mt-10 max-w-[736px] w-full"
85 |         />
86 |       </div>
87 |     </div>
88 |   );
89 | }
```

apps/website/src/app/open-startup/page.tsx
```
1 | import { BankAccountsChart } from "@/components/charts/bank-accounts-chart";
2 | import { BankConnectionsChart } from "@/components/charts/bank-connections-chart";
3 | import { InboxChart } from "@/components/charts/inbox-chart";
4 | import { InvoiceCustomersChart } from "@/components/charts/invoice-customers";
5 | import { InvoicesChart } from "@/components/charts/invoices-chart";
6 | import { ReportsChart } from "@/components/charts/reports-chart";
7 | import { TrackerEntriesChart } from "@/components/charts/tracker-entries-chart";
8 | import { TrackerProjectsChart } from "@/components/charts/tracker-projects-chart";
9 | import { TransactionEnrichmentsChart } from "@/components/charts/transaction-enrichments-chart";
10 | import { TransactionsChart } from "@/components/charts/transactions-chart";
11 | import { UsersChart } from "@/components/charts/users-chart";
12 | import { VaultChart } from "@/components/charts/vault-chart";
13 | import {
14 |   Table,
15 |   TableBody,
16 |   TableCell,
17 |   TableHead,
18 |   TableHeader,
19 |   TableRow,
20 | } from "@midday/ui/table";
21 | import { Tabs, TabsContent, TabsList, TabsTrigger } from "@midday/ui/tabs";
22 |
23 | import type { Metadata } from "next";
24 |
25 | export const metadata: Metadata = {
26 |   title: "Open Startup",
27 |   description:
28 |     "We value transparency and aim to keep you informed about our journey every step of the way.",
29 | };
30 |
31 | export default async function Page() {
32 |   return (
33 |     <div className="container max-w-[1050px]">
34 |       <h1 className="mt-24 font-medium text-center text-5xl mb-8">
35 |         Open Startup
36 |       </h1>
37 |
38 |       <p className="text-[#878787] font-sm text-center max-w-[550px] m-auto">
39 |         We value transparency and aim to keep you informed about our journey
40 |         every step of the way.
41 |       </p>
42 |
43 |       <Tabs defaultValue="metrics">
44 |         <TabsList className="p-0 h-auto space-x-6 bg-transparent flex items-center mt-8">
45 |           <TabsTrigger className="p-0 !bg-transparent" value="metrics">
46 |             Metrics
47 |           </TabsTrigger>
48 |           <TabsTrigger className="p-0 !bg-transparent" value="values">
49 |             Company values
50 |           </TabsTrigger>
51 |           <TabsTrigger className="p-0 !bg-transparent" value="table">
52 |             Cap table
53 |           </TabsTrigger>
54 |         </TabsList>
55 |
56 |         <TabsContent value="metrics" className="m-0 h-full">
57 |           <div className="grid md:grid-cols-2 gap-6 mt-12">
58 |             <UsersChart />
59 |             <TransactionsChart />
60 |             <TransactionEnrichmentsChart />
61 |             <BankAccountsChart />
62 |             <BankConnectionsChart />
63 |             <VaultChart />
64 |             <InvoicesChart />
65 |             <InvoiceCustomersChart />
66 |             <TrackerEntriesChart />
67 |             <TrackerProjectsChart />
68 |             <InboxChart />
69 |             <ReportsChart />
70 |           </div>
71 |         </TabsContent>
72 |
73 |         <TabsContent
74 |           value="values"
75 |           className="h-full max-w-[800px] m-auto mt-10"
76 |         >
77 |           <h2 className="text-2xl mb-4">Transparency</h2>
78 |           <p className="mb-10 text-[#878787]">
79 |             We prioritize transparency as we believe it is essential for
80 |             fostering trust and credibility in all aspects of our operations.
81 |             It's not just a value, it's the foundation of our relationships with
82 |             users alike. We prioritize clear and accurate information for users,
83 |             empowering them to make informed decisions confidently. We uphold
84 |             transparency with our users, offering open communication about
85 |             financial performance and strategies to maintain strong, mutually
86 |             beneficial relationships.
87 |           </p>
88 |
89 |           <h2 className="text-2xl mb-4">Expectation</h2>
90 |           <p className="mb-10 text-[#878787]">
91 |             Accurately setting expectations is crucial, directly tied to our
92 |             dedication to transparency. We've observed many startups fall short
93 |             due to overpromising, highlighting the importance of aligning
94 |             promises with reality. By maintaining this alignment, we cultivate
95 |             trust and integrity, fostering a culture of accountability guided by
96 |             transparency.
97 |           </p>
98 |
99 |           <h2 className="text-2xl mb-4">Strategic Growth</h2>
100 |           <p className="mb-10 text-[#878787]">
101 |             We firmly believe in the potential of assembling the right team to
102 |             build a highly profitable company. However, we also recognize that
103 |             size doesn't necessarily equate to success. Having experienced the
104 |             inefficiencies of overbloated organizations firsthand, we understand
105 |             the importance of agility and efficiency. For us, it's not about the
106 |             number of seats we fill, but rather the quality of individuals we
107 |             bring on board. Hence, our focus lies in growing intelligently,
108 |             prioritizing talent and effectiveness over sheer size.
109 |           </p>
110 |         </TabsContent>
111 |
112 |         <TabsContent
113 |           value="table"
114 |           className="h-full max-w-[800px] m-auto mt-10"
[TRUNCATED]
```

apps/website/src/app/oss-friends/page.tsx
```
1 | import type { Metadata } from "next";
2 |
3 | export const metadata: Metadata = {
4 |   title: "OSS Friends",
5 |   description:
6 |     "We believe in a better and more sustainable future powered by Open Source software.",
7 | };
8 |
9 | type Friend = {
10 |   name: string;
11 |   href: string;
12 |   description: string;
13 | };
14 |
15 | export default async function Page() {
16 |   const ossFriends: Friend[] = await fetch(
17 |     "https://formbricks.com/api/oss-friends",
18 |     {
19 |       next: {
20 |         revalidate: 3600,
21 |       },
22 |       cache: "force-cache",
23 |     },
24 |   )
25 |     .then(async (res) => res.json())
26 |     .then(({ data }) => data)
27 |     .catch(() => []);
28 |
29 |   return (
30 |     <div className="container max-w-[1050px]">
31 |       <h1 className="mt-24 font-medium text-center text-5xl mb-8">
32 |         Our Open Source Friends
33 |       </h1>
34 |
35 |       <p className="text-[#878787] font-sm text-center">
36 |         We believe in a better and more sustainable future powered by Open
37 |         Source software.
38 |         <br /> Below you can find a list of our friends who are just as
39 |         passionate about open source and the future as we are.
40 |       </p>
41 |
42 |       <div className="grid md:grid-cols-3 gap-6 mt-12">
43 |         {ossFriends.map((friend) => {
44 |           return (
45 |             <div
46 |               key={friend.name}
47 |               className="border border-border dark:bg-[#121212] p-4"
48 |             >
49 |               <div className="flex justify-between items-center mb-2">
50 |                 <a href={friend.href} target="_blank" rel="noreferrer">
51 |                   <h3 className="font-medium text-md">{friend.name}</h3>
52 |                 </a>
53 |                 <a href={friend.href} target="_blank" rel="noreferrer">
54 |                   <span className="sr-only">Open link</span>
55 |                   <svg
56 |                     xmlns="http://www.w3.org/2000/svg"
57 |                     width={24}
58 |                     height={24}
59 |                     className="fill-primary scale-75"
60 |                   >
61 |                     <path fill="none" d="M0 0h24v24H0V0z" />
62 |                     <path d="M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z" />
63 |                   </svg>
64 |                 </a>
65 |               </div>
66 |               <p className="text-sm text-[#878787]">{friend.description}</p>
67 |             </div>
68 |           );
69 |         })}
70 |       </div>
71 |     </div>
72 |   );
73 | }
```

apps/website/src/app/overview/page.tsx
```
1 | import { Assistant } from "@/components/assistant";
2 | import { CtaButton } from "@/components/cta-button";
3 | import { DynamicImage } from "@/components/dynamic-image";
4 | import type { Metadata } from "next";
5 | import OverviewLight from "public/product-overview-light.jpg";
6 | import OverviewDark from "public/product-overview.jpg";
7 | import SpendingLight from "public/product-spending-light.png";
8 | import SpendingDark from "public/product-spending.png";
9 |
10 | export const metadata: Metadata = {
11 |   title: "Financial Overview",
12 |   description:
13 |     "Get real-time insight into your business's financial state. Keep track of your spending, income and overall financial health.",
14 | };
15 |
16 | export default function Page() {
17 |   return (
18 |     <div className="container mb-52">
19 |       <div className="mb-40">
20 |         <h1 className="mt-24 font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none text-stroke">
21 |           Financial
22 |         </h1>
23 |
24 |         <h3 className="font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none">
25 |           Overview
26 |         </h3>
27 |
28 |         <div className="flex items-center flex-col text-center relative">
29 |           <p className="text-lg mt-4 max-w-[600px]">
30 |             Track key financial metrics like revenue, profit and loss, burn
31 |             rate, and expenses. View a consolidated currency overview across all
32 |             your accounts, and generate shareable reports.
33 |           </p>
34 |
35 |           <CtaButton>Get on top of your finances</CtaButton>
36 |         </div>
37 |       </div>
38 |
39 |       <DynamicImage
40 |         darkSrc={OverviewDark}
41 |         lightSrc={OverviewLight}
42 |         alt="Overview"
43 |         className="mt-28"
44 |       />
45 |
46 |       <div className="flex items-center flex-col text-center relative mt-28">
47 |         <div className="max-w-[600px]">
48 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
49 |             From revenue to spending
50 |           </h4>
51 |           <p className="text-[#878787] text-sm">
52 |             Connect your business with over 20,000 banks across 33 countries,
53 |             including the US, Canada, the UK, and Europe. Gain seamless insights
54 |             into your income and expenses by integrating your existing bank
55 |             accounts. With a unified view of all your finances, you’ll have a
56 |             clearer picture of your financial health and the tools to make
57 |             informed decisions about your business.
58 |           </p>
59 |         </div>
60 |
61 |         <DynamicImage
62 |           darkSrc={SpendingDark}
63 |           lightSrc={SpendingLight}
64 |           alt="Spending"
65 |           className="mt-10 max-w-[834px] w-full"
66 |         />
67 |
68 |         <div className="mt-32 max-w-[550px]">
69 |           <h4 className="font-medium text-xl md:text-2xl mb-4">Dive deeper</h4>
70 |           <p className="text-[#878787] text-sm md:mb-10">
71 |             Our assistant is here to help you navigate your financial data with
72 |             ease. Ask questions about your key financial metrics and get
73 |             instant, insightful answers. With access to real-time data across
74 |             your connected bank accounts, the assistant helps you make informed
75 |             decisions and stay on top of your business finances.
76 |           </p>
77 |         </div>
78 |
79 |         <div className="text-left scale-[0.45] md:scale-100 -mt-20 md:mt-0">
80 |           <Assistant />
81 |         </div>
82 |       </div>
83 |     </div>
84 |   );
85 | }
```

apps/website/src/app/policy/page.tsx
```
1 | import type { Metadata } from "next";
2 |
3 | export const metadata: Metadata = {
4 |   title: "Policy",
5 |   description: "Privacy Policy",
6 | };
7 |
8 | export default function Page() {
9 |   return (
10 |     <>
11 |       <div className="max-w-[600px] m-auto my-20">
12 |         <h1 className="scroll-m-20 text-2xl tracking-tight lg:text-3xl">
13 |           Privacy Policy
14 |         </h1>
15 |
16 |         <div className="text-component line-height-lg v-space-md">
17 |           <p className="leading-7 mt-8">Last updated: October 26, 2023</p>
18 |
19 |           <p className="leading-7 mt-8">
20 |             Midday Labs AB ("us", "we", or "our") operates the Midday
21 |             application (hereinafter referred to as the "Service").
22 |           </p>
23 |
24 |           <p className="leading-7 mt-8">
25 |             This page informs you of our policies regarding the collection, use
26 |             and disclosure of personal data when you use our Service and the
27 |             choices you have associated with that data.
28 |           </p>
29 |
30 |           <p className="leading-7 mt-8">
31 |             We use your data to provide and improve the Service. By using the
32 |             Service, you agree to the collection and use of information in
33 |             accordance with this policy. Unless otherwise defined in this
34 |             Privacy Policy, the terms used in this Privacy Policy have the same
35 |             meanings as in our Terms and Conditions.
36 |           </p>
37 |
38 |           <h2>Definitions</h2>
39 |           <ul>
40 |             <li>
41 |               <p className="leading-7 mt-8">
42 |                 <strong>Service</strong>
43 |               </p>
44 |               <p className="leading-7 mt-8">
45 |                 Service is the Midday application operated by Midday Labs AB
46 |               </p>
47 |             </li>
48 |             <li>
49 |               <p className="leading-7 mt-8">
50 |                 <strong>Personal Data</strong>
51 |               </p>
52 |               <p className="leading-7 mt-8">
53 |                 Personal Data means data about a living individual who can be
54 |                 identified from those data (or from those and other information
55 |                 either in our possession or likely to come into our possession).
56 |               </p>
57 |             </li>
58 |             <li>
59 |               <p className="leading-7 mt-8">
60 |                 <strong>Usage Data</strong>
61 |               </p>
62 |               <p className="leading-7 mt-8">
63 |                 Usage Data is data collected automatically either generated by
64 |                 the use of the Service or from the Service infrastructure itself
65 |                 (for example, the duration of a page visit).
66 |               </p>
67 |             </li>
68 |             <li>
69 |               <p className="leading-7 mt-8">
70 |                 <strong>Cookies</strong>
71 |               </p>
72 |               <p className="leading-7 mt-8">
73 |                 Cookies are small files stored on your device (computer or
74 |                 mobile device).
75 |               </p>
76 |             </li>
77 |             <li>
78 |               <p className="leading-7 mt-8">
79 |                 <strong>Data Controller</strong>
80 |               </p>
81 |               <p className="leading-7 mt-8">
82 |                 Data Controller means the natural or legal person who (either
83 |                 alone or jointly or in common with other persons) determines the
84 |                 purposes for which and the manner in which any personal
85 |                 information are, or are to be, processed.
86 |               </p>
87 |               <p className="leading-7 mt-8">
88 |                 For the purpose of this Privacy Policy, we are a Data Controller
89 |                 of your Personal Data.
90 |               </p>
91 |             </li>
92 |             <li>
93 |               <p className="leading-7 mt-8">
94 |                 <strong>Data Processors (or Service Providers)</strong>
95 |               </p>
96 |               <p className="leading-7 mt-8">
97 |                 Data Processor (or Service Provider) means any natural or legal
98 |                 person who processes the data on behalf of the Data Controller.
99 |               </p>
100 |               <p className="leading-7 mt-8">
101 |                 We may use the services of various Service Providers in order to
102 |                 process your data more effectively.
103 |               </p>
104 |             </li>
105 |             <li>
106 |               <p className="leading-7 mt-8">
107 |                 <strong>Data Subject (or User)</strong>
108 |               </p>
109 |               <p className="leading-7 mt-8">
110 |                 Data Subject is any living individual who is using our Service
111 |                 and is the subject of Personal Data.
112 |               </p>
113 |             </li>
114 |           </ul>
115 |
116 |           <h2>Information Collection and Use</h2>
[TRUNCATED]
```

apps/website/src/app/pricing/page.tsx
```
1 | import { Testimonials } from "@/components/testimonials";
2 | import {
3 |   Accordion,
4 |   AccordionContent,
5 |   AccordionItem,
6 |   AccordionTrigger,
7 | } from "@midday/ui/accordion";
8 | import { Button } from "@midday/ui/button";
9 | import type { Metadata } from "next";
10 | import Link from "next/link";
11 |
12 | export const metadata: Metadata = {
13 |   title: "Pricing",
14 |   description: "Midday's pricing",
15 | };
16 |
17 | export default function Page() {
18 |   return (
19 |     <>
20 |       <div className="container">
21 |         <div className="min-h-[950px]">
22 |           <h1 className="mt-24 font-medium text-center text-[100px] md:text-[170px] mb-2 leading-none">
23 |             Free
24 |           </h1>
25 |
26 |           <h3 className="font-medium text-center text-[100px] md:text-[170px] mb-2 text-stroke leading-none">
27 |             while in beta
28 |           </h3>
29 |
30 |           <div className="flex items-center flex-col text-center relative">
31 |             <div className="mt-12 mb-12" />
32 |             <p className="text-xl mt-4">Claim $49/mo deal</p>
33 |
34 |             <div className="mt-8">
35 |               <div className="flex items-center space-x-4">
36 |                 <Link
37 |                   href="https://cal.com/pontus-midday/15min"
38 |                   target="_blank"
39 |                   rel="noopener noreferrer"
40 |                 >
41 |                   <Button
42 |                     variant="outline"
43 |                     className="border border-primary h-12 px-6"
44 |                   >
45 |                     Talk to us
46 |                   </Button>
47 |                 </Link>
48 |
49 |                 <a
50 |                   target="_blank"
51 |                   rel="noreferrer"
52 |                   href="https://app.midday.ai"
53 |                 >
54 |                   <Button className="h-12 px-5">Get Started</Button>
55 |                 </a>
56 |               </div>
57 |             </div>
58 |           </div>
59 |         </div>
60 |
61 |         <div className="container  max-w-[800px]">
62 |           <div className="-mt-[200px] ">
63 |             <div className="text-center">
64 |               <h4 className="text-4xl">Frequently asked questions</h4>
65 |             </div>
66 |
67 |             <Accordion type="single" collapsible className="w-full mt-10 mb-48">
68 |               <AccordionItem value="item-1">
69 |                 <AccordionTrigger>
70 |                   <span className="truncate">Can I self-host Midday.ai?</span>
71 |                 </AccordionTrigger>
72 |                 <AccordionContent>
73 |                   Absolutely. We are currently writing the documentation for
74 |                   this. You can find the repository{" "}
75 |                   <a
76 |                     target="_blank"
77 |                     rel="noreferrer"
78 |                     href="https://git.new/midday"
79 |                     className="underline"
80 |                   >
81 |                     here
82 |                   </a>
83 |                   .
84 |                 </AccordionContent>
85 |               </AccordionItem>
86 |               <AccordionItem value="item-2">
87 |                 <AccordionTrigger>
88 |                   Can I run Midday.ai locally?
89 |                 </AccordionTrigger>
90 |                 <AccordionContent>
91 |                   Yes. We are currently writing documentation for this. You can
92 |                   find the repository{" "}
93 |                   <a
94 |                     target="_blank"
95 |                     rel="noreferrer"
96 |                     href="https://git.new/midday"
97 |                     className="underline"
98 |                   >
99 |                     here
100 |                   </a>
101 |                   .
102 |                 </AccordionContent>
103 |               </AccordionItem>
104 |               <AccordionItem value="item-3">
105 |                 <AccordionTrigger>Is Midday.ai open source?</AccordionTrigger>
106 |                 <AccordionContent>
107 |                   Yes. You can find the repository{" "}
108 |                   <a
109 |                     target="_blank"
110 |                     rel="noreferrer"
111 |                     href="https://git.new/midday"
112 |                     className="underline"
113 |                   >
114 |                     here
115 |                   </a>
116 |                   .
117 |                 </AccordionContent>
118 |               </AccordionItem>
119 |               <AccordionItem value="item-4">
120 |                 <AccordionTrigger>
121 |                   <span className="truncate max-w-[300px] md:max-w-full">
122 |                     What are your data privacy & security policies?
123 |                   </span>
124 |                 </AccordionTrigger>
125 |                 <AccordionContent>
126 |                   We take data privacy very seriously and implement
127 |                   state-of-the-art security measures to protect your data. We
128 |                   are also actively working towards SOC 2 Type II compliance. We
129 |                   encrypt data at rest, and sensitive data on row level. We also
130 |                   support 2FA authentication.
131 |                   <Link href="/policy">midday.ai/policy</Link>.
132 |                 </AccordionContent>
133 |               </AccordionItem>
134 |
135 |               <AccordionItem value="item-5">
136 |                 <AccordionTrigger>
137 |                   <span className="truncate max-w-[300px] md:max-w-full">
138 |                     Can I cancel my subscription at any time?
139 |                   </span>
140 |                 </AccordionTrigger>
141 |                 <AccordionContent>
142 |                   Yes, you can cancel your subscription at any time. If you
143 |                   cancel your subscription, you will still be able to use Midday
144 |                   until the end of your billing period.
145 |                 </AccordionContent>
[TRUNCATED]
```

apps/website/src/app/story/page.tsx
```
1 | import { DynamicImage } from "@/components/dynamic-image";
2 | import type { Metadata } from "next";
3 | import Image from "next/image";
4 | import signatureDark from "public/email/signature-dark.png";
5 | import signatureLight from "public/email/signature.png";
6 | import founders from "public/founders.png";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Story",
10 |   description: "This is why we’re building Midday.",
11 | };
12 |
13 | export default function Page() {
14 |   return (
15 |     <div className="container max-w-[750px]">
16 |       <h1 className="mt-24 font-medium text-center text-5xl mb-16 leading-snug">
17 |         This is why we’re building <br />
18 |         Midday.
19 |       </h1>
20 |
21 |       <h3 className="font-medium text-xl mb-2">Problem</h3>
22 |       <p className="text-[#878787] mb-8">
23 |         After years of running our own businesses, we've always felt something
24 |         was missing, especially when it came to the mundane tasks. Your monthly
25 |         routine typically involves tracking time, sending invoices, collecting
26 |         receipts, and organizing documents. All which are scattered across
27 |         various platforms. We've observed that these tools are often provided by
28 |         large industry giants that struggle to adapt and innovate quickly.
29 |       </p>
30 |
31 |       <h3 className="font-medium text-xl mb-2">Solution</h3>
32 |       <p className="text-[#878787] mb-8">
33 |         So, we asked ourselves, why not create one comprehensive tool for all
34 |         these tasks? Inspired by companies like Notion that revolutionized
35 |         all-in-one tools, we embarked on developing an all-in-one business OS.
36 |         Our goal is to help entrepreneurs gain deeper business insights,
37 |         streamline tedious tasks, and serve as a bridge between you and your
38 |         accountant, allowing you to focus on the enjoyable aspects of your work.
39 |       </p>
40 |
41 |       <h3 className="font-medium text-xl mb-2">Open source</h3>
42 |       <p className="text-[#878787] mb-12">
43 |         We've always admired companies that prioritize transparency and
44 |         collaboration with users to build the best possible product. Whether
45 |         it's through 15-minute user calls, building in public, or open-sourcing
46 |         our system, these are values we hold dear and will continue to uphold,
47 |         regardless of how far or big we go.
48 |       </p>
49 |
50 |       <Image src={founders} width={800} height={514} alt="Pontus & Viktor" />
51 |
52 |       <div className="mt-6 mb-8">
53 |         <p className="text-sm text-[#878787] mb-2">Best regards, founders</p>
54 |
55 |         <DynamicImage
56 |           darkSrc={signatureDark}
57 |           lightSrc={signatureLight}
58 |           alt="Signature"
59 |           className="w-[143px] h-[20px]"
60 |         />
61 |       </div>
62 |     </div>
63 |   );
64 | }
```

apps/website/src/app/support/page.tsx
```
1 | import { SupportForm } from "@/components/support-form";
2 | import type { Metadata } from "next";
3 |
4 | export const metadata: Metadata = {
5 |   title: "Support",
6 |   description: "Get help with Midday",
7 | };
8 |
9 | export default function Page() {
10 |   return (
11 |     <div className="max-w-[750px] m-auto">
12 |       <h1 className="mt-24 font-medium text-center text-5xl mb-16 leading-snug">
13 |         Support
14 |       </h1>
15 |
16 |       <SupportForm />
17 |     </div>
18 |   );
19 | }
```

apps/website/src/app/terms/page.tsx
```
1 | import type { Metadata } from "next";
2 |
3 | export const metadata: Metadata = {
4 |   title: "Terms and Conditions",
5 |   description: "Terms and Conditions",
6 | };
7 |
8 | export default function Page() {
9 |   return (
10 |     <>
11 |       <div className="max-w-[600px] m-auto my-20">
12 |         <h1 className="scroll-m-20 text-2xl tracking-tight lg:text-3xl">
13 |           Terms and Conditions
14 |         </h1>
15 |
16 |         <div className="text-component line-height-lg v-space-md">
17 |           <p className="leading-7 mt-8">Last updated: October 26, 2023</p>
18 |
19 |           <p className="leading-7 mt-8">
20 |             These Terms and Conditions ("Terms", "Terms and Conditions") govern
21 |             your relationship with Midday application (the "Service") operated
22 |             by Midday Labs AB ("us", "we", or "our").
23 |           </p>
24 |
25 |           <p className="leading-7 mt-8">
26 |             Please read these Terms and Conditions carefully before using our
27 |             Midday application (the "Service").
28 |           </p>
29 |
30 |           <p className="leading-7 mt-8">
31 |             Your access to and use of the Service is conditioned on your
32 |             acceptance of and compliance with these Terms. These Terms apply to
33 |             all visitors, users and others who access or use the Service.
34 |           </p>
35 |
36 |           <p className="leading-7 mt-8">
37 |             By accessing or using the Service you agree to be bound by these
38 |             Terms. If you disagree with any part of the terms then you may not
39 |             access the Service.
40 |           </p>
41 |
42 |           <h2>Subscriptions</h2>
43 |
44 |           <p className="leading-7 mt-8">
45 |             Some parts of the Service are billed on a subscription basis
46 |             ("Subscription(s)"). You will be billed in advance on a recurring
47 |             and periodic basis ("Billing Cycle"). Billing cycles are set on a
48 |             monthly basis.
49 |           </p>
50 |
51 |           <p className="leading-7 mt-8">
52 |             At the end of each Billing Cycle, your Subscription will
53 |             automatically renew under the exact same conditions unless you
54 |             cancel it or Midday Labs AB cancels it. You may cancel your
55 |             Subscription renewal either through your online account management
56 |             page or by contacting Midday Labs AB customer support team.
57 |           </p>
58 |
59 |           <p className="leading-7 mt-8">
60 |             A valid payment method, including credit card, is required to
61 |             process the payment for your Subscription. You shall provide Midday
62 |             Labs AB with accurate and complete billing information including
63 |             full name, address, state, zip code, telephone number, and a valid
64 |             payment method information. By submitting such payment information,
65 |             you automatically authorize Midday Labs AB to charge all
66 |             Subscription fees incurred through your account to any such payment
67 |             instruments.
68 |           </p>
69 |
70 |           <p className="leading-7 mt-8">
71 |             Should automatic billing fail to occur for any reason, Midday Labs
72 |             AB will issue an electronic invoice indicating that you must proceed
73 |             manually, within a certain deadline date, with the full payment
74 |             corresponding to the billing period as indicated on the invoice.
75 |           </p>
76 |
77 |           <h2>Fee Changes</h2>
78 |
79 |           <p className="leading-7 mt-8">
80 |             Midday Labs AB, in its sole discretion and at any time, may modify
81 |             the Subscription fees for the Subscriptions. Any Subscription fee
82 |             change will become effective at the end of the then-current Billing
83 |             Cycle.
84 |           </p>
85 |
86 |           <p className="leading-7 mt-8">
87 |             Midday Labs AB will provide you with a reasonable prior notice of
88 |             any change in Subscription fees to give you an opportunity to
89 |             terminate your Subscription before such change becomes effective.
90 |           </p>
91 |
92 |           <p className="leading-7 mt-8">
93 |             Your continued use of the Service after the Subscription fee change
94 |             comes into effect constitutes your agreement to pay the modified
95 |             Subscription fee amount.
96 |           </p>
97 |
98 |           <h2>Refunds</h2>
99 |
100 |           <p className="leading-7 mt-8">
101 |             Certain refund requests for Subscriptions may be considered by
102 |             Midday Labs AB on a case-by-case basis and granted in sole
103 |             discretion of Midday Labs AB.
104 |           </p>
105 |
106 |           <h2>Content</h2>
107 |
[TRUNCATED]
```

apps/website/src/app/tracker/page.tsx
```
1 | import { CtaButton } from "@/components/cta-button";
2 | import { DynamicImage } from "@/components/dynamic-image";
3 | import type { Metadata } from "next";
4 | import ProjectsLight from "public/product-projects-light.png";
5 | import ProjectsDark from "public/product-projects.png";
6 | import SlotLight from "public/product-slot-light.png";
7 | import SlotDark from "public/product-slot.png";
8 | import TrackerLight from "public/product-tracker-light.jpg";
9 | import TrackerDark from "public/product-tracker.jpg";
10 |
11 | export const metadata: Metadata = {
12 |   title: "Time Tracker",
13 |   description:
14 |     "Track your projects time and gain insightful project overviews.",
15 | };
16 |
17 | export default function Page() {
18 |   return (
19 |     <div className="container mb-52">
20 |       <div className="mb-40">
21 |         <h1 className="mt-24 font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none text-stroke">
22 |           Time
23 |         </h1>
24 |
25 |         <h3 className="font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none">
26 |           Tracker
27 |         </h3>
28 |
29 |         <div className="flex items-center flex-col text-center relative">
30 |           <p className="text-lg mt-4 max-w-[600px]">
31 |             Track your hours with ease and gain a clear monthly breakdown of
32 |             billable amounts. Link tracked time to customers and generate
33 |             invoices.
34 |           </p>
35 |
36 |           <CtaButton>Start tracking time now</CtaButton>
37 |         </div>
38 |       </div>
39 |
40 |       <DynamicImage
41 |         darkSrc={TrackerDark}
42 |         lightSrc={TrackerLight}
43 |         alt="Tracker"
44 |       />
45 |
46 |       <div className="flex items-center flex-col text-center relative mt-28">
47 |         <div className="max-w-[600px]">
48 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
49 |             Have an overview of whats going on
50 |           </h4>
51 |           <p className="text-[#878787] text-sm">
52 |             Get a clear monthly overview of your tracked hours, set rates and
53 |             view the total billable amount with a detailed monthly breakdown.
54 |             Stay on top of your projects and manage your time effectively.
55 |           </p>
56 |         </div>
57 |
58 |         <DynamicImage
59 |           darkSrc={ProjectsDark}
60 |           lightSrc={ProjectsLight}
61 |           alt="Slot"
62 |           className="mt-10 max-w-[450px] w-full"
63 |         />
64 |         <div className="mt-32 max-w-[600px]">
65 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
66 |             Track all your projects
67 |           </h4>
68 |           <p className="text-[#878787] text-sm mb-10">
69 |             Easily link tracked time to a customer and generate invoices based
70 |             on recorded hours. Export your data as a CSV for seamless reporting
71 |             and analysis.
72 |           </p>
73 |         </div>
74 |
75 |         <DynamicImage
76 |           darkSrc={SlotDark}
77 |           lightSrc={SlotLight}
78 |           alt="Slot"
79 |           className="mt-10 max-w-[550px] w-full"
80 |         />
81 |       </div>
82 |     </div>
83 |   );
84 | }
```

apps/website/src/app/updates/page.tsx
```
1 | import { Article } from "@/components/article";
2 | import { UpdatesToolbar } from "@/components/updates-toolbar";
3 | import { getBlogPosts } from "@/lib/blog";
4 | import type { Metadata } from "next";
5 |
6 | export const metadata: Metadata = {
7 |   title: "Updates",
8 |   description: "Keep up to date with product updates and announcments.",
9 | };
10 |
11 | export default async function Page() {
12 |   const data = getBlogPosts();
13 |
14 |   const posts = data
15 |     .sort((a, b) => {
16 |       if (new Date(a.metadata.publishedAt) > new Date(b.metadata.publishedAt)) {
17 |         return -1;
18 |       }
19 |       return 1;
20 |     })
21 |     .map((post, index) => (
22 |       <Article data={post} firstPost={index === 0} key={post.slug} />
23 |     ));
24 |
25 |   return (
26 |     <div className="container flex justify-center scroll-smooth">
27 |       <div className="max-w-[680px] pt-[80px] md:pt-[150px] w-full">
28 |         {posts}
29 |       </div>
30 |
31 |       <UpdatesToolbar
32 |         posts={data.map((post) => ({
33 |           slug: post.slug,
34 |           title: post.metadata.title,
35 |         }))}
36 |       />
37 |     </div>
38 |   );
39 | }
```

apps/website/src/app/vault/page.tsx
```
1 | import { Assistant } from "@/components/assistant";
2 | import { CtaButton } from "@/components/cta-button";
3 | import { DynamicImage } from "@/components/dynamic-image";
4 | import type { Metadata } from "next";
5 | import FilesLight from "public/product-files-light.png";
6 | import FilesDark from "public/product-files.png";
7 | import VaultLight from "public/product-vault-light.jpg";
8 | import VaultDark from "public/product-vault.jpg";
9 |
10 | export const metadata: Metadata = {
11 |   title: "Vault",
12 |   description:
13 |     "Don’t waste time searching through old emails and random folders. Keep all your contracts, agreements and more safe in one place.",
14 | };
15 |
16 | export default function Page() {
17 |   return (
18 |     <div className="container mb-52">
19 |       <div className="mb-40">
20 |         <h1 className="mt-24 font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none text-stroke">
21 |           Your Files
22 |         </h1>
23 |
24 |         <h3 className="font-medium text-center text-[75px] md:text-[170px] mb-2 leading-none">
25 |           Vault
26 |         </h3>
27 |
28 |         <div className="flex items-center flex-col text-center relative">
29 |           <p className="text-lg mt-4 max-w-[600px]">
30 |             Don’t waste time searching through old emails and random folders.
31 |             Keep all your contracts, agreements and more safe in one place
32 |           </p>
33 |
34 |           <CtaButton>Centralize Your Files now</CtaButton>
35 |         </div>
36 |       </div>
37 |
38 |       <DynamicImage darkSrc={VaultDark} lightSrc={VaultLight} alt="Vault" />
39 |
40 |       <div className="flex items-center flex-col text-center relative mt-28">
41 |         <div className="max-w-[600px]">
42 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
43 |             All your files in one place
44 |           </h4>
45 |           <p className="text-[#878787] text-sm">
46 |             Store all your important files securely in Midday, including
47 |             contracts and agreements, keeping everything in one place for easy
48 |             access. Simplify your document management and stay organized with a
49 |             central repository for all your business needs.
50 |           </p>
51 |         </div>
52 |
53 |         <DynamicImage
54 |           darkSrc={FilesDark}
55 |           lightSrc={FilesLight}
56 |           alt="Files"
57 |           className="mt-10 max-w-[834px] w-full"
58 |         />
59 |
60 |         <div className="mt-32 max-w-[550px]">
61 |           <h4 className="font-medium text-xl md:text-2xl mb-4">
62 |             Find what you need faster
63 |           </h4>
64 |           <p className="text-[#878787] text-sm mb-10">
65 |             Use the assistant to search for your files or even within your
66 |             files. Say you want to find that old contract but can’t remember
67 |             which client it was for, just search for details around it and the
68 |             assistant will find it for you.
69 |           </p>
70 |         </div>
71 |
72 |         <div className="text-left scale-[0.45] md:scale-100 -mt-20 md:mt-0">
73 |           <Assistant />
74 |         </div>
75 |       </div>
76 |     </div>
77 |   );
78 | }
```

apps/website/src/components/assistant/chat-avatar.tsx
```
1 | "use client";
2 |
3 | import { Avatar, AvatarImage } from "@midday/ui/avatar";
4 |
5 | type Props = {
6 |   role: "assistant" | "user";
7 | };
8 |
9 | export function ChatAvatar({ role }: Props) {
10 |   switch (role) {
11 |     case "user": {
12 |       return (
13 |         <Avatar className="size-6">
14 |           <AvatarImage src="https://pbs.twimg.com/profile_images/1755611130368770048/JwLEqyeo_400x400.jpg" />
15 |         </Avatar>
16 |       );
17 |     }
18 |
19 |     default:
20 |       return (
21 |         <svg
22 |           xmlns="http://www.w3.org/2000/svg"
23 |           width={24}
24 |           height={24}
25 |           fill="none"
26 |         >
27 |           <path
28 |             fill="currentColor"
29 |             fillRule="evenodd"
30 |             d="M11.479 0a11.945 11.945 0 0 0-5.026 1.344l5.026 8.705V0Zm0 13.952-5.026 8.704A11.946 11.946 0 0 0 11.48 24V13.952ZM12.523 24V13.946l5.028 8.708A11.943 11.943 0 0 1 12.523 24Zm0-13.946V0c1.808.078 3.513.555 5.028 1.346l-5.028 8.708Zm-10.654 8.4 8.706-5.026-5.026 8.706a12.075 12.075 0 0 1-3.68-3.68ZM22.134 5.55l-8.706 5.026 5.027-8.706a12.075 12.075 0 0 1 3.679 3.68ZM1.868 5.547a12.075 12.075 0 0 1 3.68-3.68l5.028 8.708-8.708-5.028Zm-.523.904A11.945 11.945 0 0 0 0 11.479h10.054l-8.71-5.028Zm0 11.1A11.945 11.945 0 0 1 0 12.524h10.053L1.346 17.55Zm12.606-6.072H24a11.946 11.946 0 0 0-1.345-5.026l-8.705 5.026Zm8.705 6.07-8.704-5.025H24a11.945 11.945 0 0 1-1.344 5.025Zm-9.226-4.12 5.024 8.702a12.075 12.075 0 0 0 3.678-3.678l-8.702-5.025Z"
31 |             clipRule="evenodd"
32 |           />
33 |         </svg>
34 |       );
35 |   }
36 | }
```

apps/website/src/components/assistant/chat-empty.tsx
```
1 | import { Icons } from "@midday/ui/icons";
2 |
3 | export function ChatEmpty() {
4 |   return (
5 |     <div className="w-full mt-24 flex flex-col items-center justify-center text-center">
6 |       <Icons.LogoSmall />
7 |       <span className="font-medium text-xl mt-6">
8 |         Hello, how can I help <br />
9 |         you today?
10 |       </span>
11 |     </div>
12 |   );
13 | }
```

apps/website/src/components/assistant/chat-examples.tsx
```
1 | "use client";
2 |
3 | import { motion } from "framer-motion";
4 | import { useRef } from "react";
5 | import { useDraggable } from "react-use-draggable-scroll";
6 | import { chatExamples } from "./examples";
7 |
8 | const listVariant = {
9 |   hidden: { y: 45, opacity: 0 },
10 |   show: {
11 |     y: 0,
12 |     opacity: 1,
13 |     transition: {
14 |       duration: 0.3,
15 |       staggerChildren: 0.08,
16 |     },
17 |   },
18 | };
19 |
20 | const itemVariant = {
21 |   hidden: { y: 45, opacity: 0 },
22 |   show: { y: 0, opacity: 1 },
23 | };
24 |
25 | export function ChatExamples({ onSubmit }) {
26 |   const ref = useRef(undefined);
27 |   const { events } = useDraggable(ref);
28 |
29 |   const totalLength = chatExamples.reduce((accumulator, currentString) => {
30 |     return accumulator + currentString.title.length * 8.2 + 50;
31 |   }, 0);
32 |
33 |   return (
34 |     <div
35 |       className="absolute z-10 bottom-[100px] left-0 right-0 overflow-scroll scrollbar-hide cursor-grabbing"
36 |       {...events}
37 |       ref={ref}
38 |     >
39 |       <motion.ul
40 |         variants={listVariant}
41 |         initial="hidden"
42 |         animate="show"
43 |         className="flex space-x-4 ml-4 items-center"
44 |         style={{ width: `${totalLength}px` }}
45 |       >
46 |         {chatExamples.map((example) => (
47 |           <button
48 |             key={example.title}
49 |             type="button"
50 |             onClick={() => onSubmit(example.title)}
51 |           >
52 |             <motion.li
53 |               variants={itemVariant}
54 |               className="font-mono text-[#878787] text-xs dark:bg-[#1D1D1D] bg-white px-3 py-2 rounded-full cursor-default"
55 |             >
56 |               {example.title}
57 |             </motion.li>
58 |           </button>
59 |         ))}
60 |       </motion.ul>
61 |     </div>
62 |   );
63 | }
```

apps/website/src/components/assistant/chat-list.tsx
```
1 | "use client";
2 |
3 | type Props = {
4 |   messages: any;
5 | };
6 |
7 | export function ChatList({ messages }: Props) {
8 |   if (!messages.length) {
9 |     return null;
10 |   }
11 |
12 |   return (
13 |     <div className="flex flex-col  p-4 pb-8">
14 |       {messages
15 |         .filter((tool) => tool.display !== undefined)
16 |         .map((message, index) => (
17 |           <div key={message.id}>
18 |             {message.display}
19 |             {index < messages.length - 1 && <div className="my-6" />}
20 |           </div>
21 |         ))}
22 |     </div>
23 |   );
24 | }
```

apps/website/src/components/assistant/chat.tsx
```
1 | "use client";
2 |
3 | import { useEnterSubmit } from "@midday/ui/hooks";
4 | import { ScrollArea } from "@midday/ui/scroll-area";
5 | import { Textarea } from "@midday/ui/textarea";
6 | import { motion } from "framer-motion";
7 | import { nanoid } from "nanoid";
8 | import { useState } from "react";
9 | import { ChatEmpty } from "./chat-empty";
10 | import { ChatExamples } from "./chat-examples";
11 | import { ChatList } from "./chat-list";
12 | import { chatExamples } from "./examples";
13 | import { Footer } from "./footer";
14 | import { BotCard, SignUpCard, UserMessage } from "./messages";
15 |
16 | export function Chat({ messages, submitMessage, input, setInput }) {
17 |   const { formRef, onKeyDown } = useEnterSubmit();
18 |   const [isVisible, setVisible] = useState(false);
19 |
20 |   const onSubmit = (input: string) => {
21 |     const value = input.trim();
22 |
23 |     if (value.length === 0) {
24 |       return null;
25 |     }
26 |
27 |     setInput("");
28 |
29 |     submitMessage((message) => [
30 |       ...message,
31 |       {
32 |         id: nanoid(),
33 |         role: "user",
34 |         display: <UserMessage>{value}</UserMessage>,
35 |       },
36 |     ]);
37 |
38 |     const content = chatExamples.find(
39 |       (example) => example.title === input,
40 |     )?.content;
41 |
42 |     if (content) {
43 |       setTimeout(
44 |         () =>
45 |           submitMessage((message) => [
46 |             ...message,
47 |             {
48 |               id: nanoid(),
49 |               role: "assistant",
50 |               display: (
51 |                 <BotCard
52 |                   content={
53 |                     chatExamples.find((example) => example.title === input)
54 |                       ?.content
55 |                   }
56 |                 />
57 |               ),
58 |             },
59 |           ]),
60 |         500,
61 |       );
62 |     } else {
63 |       setTimeout(
64 |         () =>
65 |           submitMessage((message) => [
66 |             ...message,
67 |             {
68 |               id: nanoid(),
69 |               role: "assistant",
70 |               display: <SignUpCard />,
71 |             },
72 |           ]),
73 |         200,
74 |       );
75 |     }
76 |   };
77 |
78 |   const showExamples = isVisible && messages.length === 0 && !input;
79 |
80 |   return (
81 |     <div className="relative h-[420px]">
82 |       <ScrollArea className="h-[335px]">
83 |         {messages.length ? <ChatList messages={messages} /> : <ChatEmpty />}
84 |       </ScrollArea>
85 |
86 |       <div className="absolute bottom-[1px] left-[1px] right-[1px] h-[88px] border-border border-t-[1px]">
87 |         {showExamples && <ChatExamples onSubmit={onSubmit} />}
88 |
89 |         <form
90 |           ref={formRef}
91 |           onSubmit={(evt) => {
92 |             evt.preventDefault();
93 |             onSubmit(input);
94 |           }}
95 |         >
96 |           <Textarea
97 |             tabIndex={0}
98 |             rows={1}
99 |             spellCheck={false}
100 |             autoComplete="off"
101 |             autoCorrect="off"
102 |             value={input}
103 |             className="h-12 min-h-12 pt-3 resize-none border-none"
104 |             placeholder="Ask Midday a question..."
105 |             onKeyDown={onKeyDown}
106 |             onChange={(evt) => {
107 |               setInput(evt.target.value);
108 |             }}
109 |           />
110 |         </form>
111 |
112 |         <motion.div
113 |           onViewportEnter={() => {
114 |             if (!isVisible) {
115 |               setVisible(true);
116 |             }
117 |           }}
118 |           onViewportLeave={() => {
119 |             if (isVisible) {
120 |               setVisible(false);
121 |             }
122 |           }}
123 |         >
124 |           <Footer onSubmit={() => onSubmit(input)} />
125 |         </motion.div>
126 |       </div>
127 |     </div>
128 |   );
129 | }
```

apps/website/src/components/assistant/examples.tsx
```
1 | export const chatExamples = [
2 |   {
3 |     title: `What's my burn rate`,
4 |     content:
5 |       "Based on your historical data, your average burn rate is $8,933.33 per month. Your expected runway is 7 months, ending on January 5, 2025.",
6 |   },
7 |   {
8 |     title: `What's my runway`,
9 |     content:
10 |       "Based on your historical data, your expected runway is 7 months, ending in Jan 5, 2025.",
11 |   },
12 |   {
13 |     title: "What is my spending on Software",
14 |     content:
15 |       "You have spent $8,933.33 on Software between Jun 1, 2023 and Jun 5, 2024",
16 |   },
17 |   {
18 |     title: "Find a receipt or invoice",
19 |     content:
20 |       "Please provide the name of the receipt or invoice you are looking for.",
21 |   },
22 |   {
23 |     title: "Find a transaction",
24 |     content:
25 |       "Could you please provide more details about the transaction you are looking for?",
26 |   },
27 |   {
28 |     title: `What's my profit for last year`,
29 |     content:
30 |       "Based on the period from Jun 1, 2022 and Jun 1, 2023 your current profit is $18,933.33. In the previous period, your profit was $3,422.33",
31 |   },
32 |   {
33 |     title: `What's my revenue`,
34 |     content:
35 |       "Based on the period from Jun 1, 2023 and Jun 5, 2024 your revenue is $18,933.33. In the previous period, your profit was $20,933.33.",
36 |   },
37 |   {
38 |     title: "Create a report",
39 |     content:
40 |       "Could you please specify the type of report you would like to create?",
41 |   },
42 |   {
43 |     title: "Forecast profit",
44 |     content:
45 |       "Based on the last 12 months profit data, the forecasted profit for the next month is approximately $18,933.33. This is an indication of the forecast and should be verified.",
46 |   },
47 |   {
48 |     title: "Forecast revenue",
49 |     content:
50 |       "Based on the last 12 months revenue data, the average monthly revenue is $3,422.33. Therefore, the forecasted revenue for the next month is approximately $18,933.33. This is an indication of the forecast and should be verified.",
51 |   },
52 | ];
```

apps/website/src/components/assistant/footer.tsx
```
1 | import { Icons } from "@midday/ui/icons";
2 | import { Popover, PopoverContent, PopoverTrigger } from "@midday/ui/popover";
3 | import { useRouter } from "next/navigation";
4 |
5 | type Props = {
6 |   onSubmit: () => void;
7 | };
8 |
9 | export function Footer({ onSubmit }: Props) {
10 |   const router = useRouter();
11 |
12 |   return (
13 |     <div className="flex px-3 h-[40px] w-full border-t-[1px] items-center bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#151515]/[99]">
14 |       <Popover>
15 |         <PopoverTrigger>
16 |           <div className="scale-50 dark:opacity-50 -ml-2">
17 |             <Icons.LogoSmall />
18 |           </div>
19 |         </PopoverTrigger>
20 |
21 |         <PopoverContent
22 |           className="bg-background backdrop-filter dark:border-[#2C2C2C] backdrop-blur-lg dark:bg-[#1A1A1A]/95 p-2 rounded-lg -ml-2 w-auto"
23 |           side="top"
24 |           align="start"
25 |           sideOffset={10}
26 |         >
27 |           <ul className="flex flex-col space-y-2">
28 |             <li>
29 |               <button
30 |                 type="button"
31 |                 className="flex space-x-2 items-center text-xs hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
32 |                 onClick={() => router.push("https://x.com/middayai")}
33 |               >
34 |                 <Icons.X className="w-[16px] h-[16px]" />
35 |                 <span>Follow us</span>
36 |               </button>
37 |             </li>
38 |             <li>
39 |               <button
40 |                 type="button"
41 |                 className="flex space-x-2 items-center text-xs hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
42 |                 onClick={() => router.push("https://go.midday.ai/anPiuRx")}
43 |               >
44 |                 <Icons.Discord className="w-[16px] h-[16px]" />
45 |                 <span>Join Our Community</span>
46 |               </button>
47 |             </li>
48 |
49 |             <li>
50 |               <button
51 |                 type="button"
52 |                 className="flex space-x-2 items-center text-xs hover:bg-[#2b2b2b] rounded-md transition-colors w-full p-1"
53 |                 onClick={() => router.push("https://git.new/midday")}
54 |               >
55 |                 <Icons.GithubOutline className="w-[16px] h-[16px]" />
56 |                 <span>Github</span>
57 |               </button>
58 |             </li>
59 |           </ul>
60 |         </PopoverContent>
61 |       </Popover>
62 |
63 |       <div className="ml-auto flex space-x-4">
64 |         <button
65 |           className="flex space-x-2 items-center text-xs"
66 |           type="button"
67 |           onClick={onSubmit}
68 |         >
69 |           <span>Submit</span>
70 |           <kbd className="pointer-events-none h-5 select-none items-center gap-1 rounded border bg-accent px-1.5 font-mono text-[10px] font-medium">
71 |             <span>↵</span>
72 |           </kbd>
73 |         </button>
74 |       </div>
75 |     </div>
76 |   );
77 | }
```

apps/website/src/components/assistant/header.tsx
```
1 | import { Button } from "@midday/ui/button";
2 | import { Icons } from "@midday/ui/icons";
3 | // import { Experimental } from "../experimental";
4 |
5 | type Props = {
6 |   isExpanded: boolean;
7 |   toggleSidebar: () => void;
8 | };
9 |
10 | export function Header({ toggleSidebar, isExpanded }: Props) {
11 |   return (
12 |     <div className="px-4 py-3 flex justify-between items-center border-border border-b-[1px]">
13 |       <div className="flex items-center space-x-3">
14 |         <Button
15 |           variant="outline"
16 |           size="icon"
17 |           className="size-8 z-50 p-0"
18 |           onClick={toggleSidebar}
19 |         >
20 |           {isExpanded ? (
21 |             <Icons.SidebarFilled width={18} />
22 |           ) : (
23 |             <Icons.Sidebar width={18} />
24 |           )}
25 |         </Button>
26 |
27 |         <h2>Assistant</h2>
28 |       </div>
29 |
30 |       <div className="flex space-x-2 items-center">
31 |         {/* <Experimental className="border-border text-[#878787]" /> */}
32 |       </div>
33 |     </div>
34 |   );
35 | }
```

apps/website/src/components/assistant/index.tsx
```
1 | "use client";
2 |
3 | import { nanoid } from "nanoid";
4 | import { useState } from "react";
5 | import { useHotkeys } from "react-hotkeys-hook";
6 | import { Chat } from "./chat";
7 | import { chatExamples } from "./examples";
8 | import { Header } from "./header";
9 | import { BotCard, UserMessage } from "./messages";
10 | import { Sidebar } from "./sidebar";
11 |
12 | export function Assistant() {
13 |   const [isExpanded, setExpanded] = useState(false);
14 |   const [messages, setMessages] = useState([]);
15 |   const [input, setInput] = useState("");
16 |
17 |   const toggleOpen = () => setExpanded((prev) => !prev);
18 |
19 |   const onNewChat = () => {
20 |     setExpanded(false);
21 |     setInput("");
22 |     setMessages([]);
23 |   };
24 |
25 |   const handleOnSelect = (message: string) => {
26 |     const content = chatExamples.find(
27 |       (example) => example.title === message,
28 |     )?.content;
29 |
30 |     setExpanded(false);
31 |
32 |     if (content) {
33 |       setMessages([
34 |         {
35 |           id: nanoid(),
36 |           role: "user",
37 |           display: <UserMessage>{message}</UserMessage>,
38 |         },
39 |         {
40 |           id: nanoid(),
41 |           role: "assistant",
42 |           display: <BotCard content={content} />,
43 |         },
44 |       ]);
45 |     }
46 |   };
47 |
48 |   useHotkeys("meta+j", () => onNewChat(), {
49 |     enableOnFormTags: true,
50 |   });
51 |
52 |   return (
53 |     <div className="overflow-hidden p-0 w-[760px] h-full md:h-[480px] backdrop-filter backdrop-blur-xl dark:bg-[#121212] bg-white dark:bg-opacity-80 bg-opacity-95 border-border border rounded-md relative">
54 |       <Header toggleSidebar={toggleOpen} isExpanded={isExpanded} />
55 |       <Sidebar
56 |         setExpanded={setExpanded}
57 |         isExpanded={isExpanded}
58 |         onNewChat={onNewChat}
59 |         onSelect={handleOnSelect}
60 |       />
61 |
62 |       <Chat
63 |         onNewChat={onNewChat}
64 |         messages={messages}
65 |         setInput={setInput}
66 |         input={input}
67 |         submitMessage={setMessages}
68 |       />
69 |     </div>
70 |   );
71 | }
```

apps/website/src/components/assistant/message-uis.tsx
```
1 | export function BurnRateUI() {
2 |   return;
3 | }
```

apps/website/src/components/assistant/messages.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { cn } from "@midday/ui/cn";
5 | import { motion } from "framer-motion";
6 | import { useEffect, useState } from "react";
7 | import { ChatAvatar } from "./chat-avatar";
8 | import { spinner } from "./spinner";
9 |
10 | function getRandomDelay(min, max) {
11 |   return Math.floor(Math.random() * (max - min + 1)) + min;
12 | }
13 |
14 | async function concatCharacter(inputString, callback) {
15 |   const words = inputString.split(" ");
16 |   let result = "";
17 |   for (let i = 0; i < words.length; i++) {
18 |     result += (i > 0 ? " " : "") + words[i];
19 |     await new Promise((resolve) =>
20 |       setTimeout(resolve, getRandomDelay(70, 100))
21 |     );
22 |     callback(result); // Call the callback with the intermediate result
23 |   }
24 | }
25 |
26 | export function UserMessage({ children }: { children: React.ReactNode }) {
27 |   return (
28 |     <div className="group relative flex items-start">
29 |       <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
30 |         <ChatAvatar role="user" />
31 |       </div>
32 |
33 |       <div className="ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed">
34 |         {children}
35 |       </div>
36 |     </div>
37 |   );
38 | }
39 |
40 | export function SpinnerMessage() {
41 |   return (
42 |     <div className="group relative flex items-start">
43 |       <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
44 |         <ChatAvatar role="assistant" />
45 |       </div>
46 |
47 |       <div className="ml-4 flex-1 space-y-2 overflow-hidden pl-2">
48 |         {spinner}
49 |       </div>
50 |     </div>
51 |   );
52 | }
53 |
54 | export function BotCard({
55 |   content,
56 |   showAvatar = true,
57 |   className,
58 | }: {
59 |   content: string;
60 |   showAvatar?: boolean;
61 |   className?: string;
62 | }) {
63 |   const [text, setText] = useState();
64 |
65 |   useEffect(() => {
66 |     concatCharacter(content, (intermediateResult) => {
67 |       setText(intermediateResult);
68 |     });
69 |   }, []);
70 |
71 |   return (
72 |     <div className="group relative flex items-start">
73 |       <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
74 |         {showAvatar && <ChatAvatar role="assistant" />}
75 |       </div>
76 |
77 |       <div
78 |         className={cn(
79 |           "ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed",
80 |           className
81 |         )}
82 |       >
83 |         {text}
84 |       </div>
85 |     </div>
86 |   );
87 | }
88 |
89 | export function SignUpCard({
90 |   showAvatar = true,
91 |   className,
92 | }: {
93 |   showAvatar?: boolean;
94 |   className?: string;
95 | }) {
96 |   const [text, setText] = useState();
97 |
98 |   const content =
99 |     "I'm just a demo assistant. To ask questions about your business, you can sign up and get started in a matter of minutes.";
100 |
101 |   useEffect(() => {
102 |     concatCharacter(content, (intermediateResult) => {
103 |       setText(intermediateResult);
104 |     });
105 |   }, []);
106 |
107 |   return (
108 |     <div>
109 |       <div className="group relative flex items-start">
110 |         <div className="flex size-[25px] shrink-0 select-none items-center justify-center">
111 |           {showAvatar && <ChatAvatar role="assistant" />}
112 |         </div>
113 |
114 |         <div
115 |           className={cn(
116 |             "ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed",
117 |             className
118 |           )}
119 |         >
120 |           {text}
121 |         </div>
122 |       </div>
123 |
124 |       <motion.div
125 |         className="ml-12 mt-4"
126 |         initial={{ opacity: 0 }}
127 |         animate={{ opacity: 1 }}
128 |         transition={{ duration: 0.5, delay: 2.2 }}
129 |       >
130 |         <a href="https://app.midday.ai">
131 |           <Button>Sign up</Button>
132 |         </a>
133 |       </motion.div>
134 |     </div>
135 |   );
136 | }
```

apps/website/src/components/assistant/sidebar-item.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 |
3 | interface SidebarItemProps {
4 |   chat: any;
5 |   onSelect: (message: string) => void;
6 | }
7 |
8 | export function SidebarItem({ chat, onSelect }: SidebarItemProps) {
9 |   return (
10 |     <button
11 |       type="button"
12 |       className={cn(
13 |         "text-left transition-colors px-0 py-1 rounded-lg w-full text-[#878787] hover:text-primary"
14 |       )}
15 |       onClick={() => onSelect(chat.title)}
16 |     >
17 |       <span className="text-xs line-clamp-1">{chat.title}</span>
18 |     </button>
19 |   );
20 | }
```

apps/website/src/components/assistant/sidebar-items.tsx
```
1 | import { chatExamples } from "./examples";
2 | import { SidebarItem } from "./sidebar-item";
3 |
4 | interface SidebarItemsProps {
5 |   onSelect: (id: string) => void;
6 |   chatId?: string;
7 | }
8 |
9 | const formatRange = (key: string) => {
10 |   switch (key) {
11 |     case "1d":
12 |       return "Today";
13 |     case "2d":
14 |       return "Yesterday";
15 |     case "7d":
16 |       return "Last 7 days";
17 |     case "30d":
18 |       return "Last 30 days";
19 |     default:
20 |       return null;
21 |   }
22 | };
23 |
24 | const items = {
25 |   "1d": [
26 |     {
27 |       id: "1",
28 |       title: chatExamples.at(0).title,
29 |     },
30 |     {
31 |       id: "2",
32 |       title: chatExamples.at(2).title,
33 |     },
34 |   ],
35 |   "2d": [
36 |     {
37 |       id: "1",
38 |       title: chatExamples.at(3).title,
39 |     },
40 |     {
41 |       id: "2",
42 |       title: chatExamples.at(4).title,
43 |     },
44 |   ],
45 |   "7d": [
46 |     {
47 |       id: "1",
48 |       title: chatExamples.at(5).title,
49 |     },
50 |     {
51 |       id: "2",
52 |       title: chatExamples.at(6).title,
53 |     },
54 |     {
55 |       id: "3",
56 |       title: chatExamples.at(0).title,
57 |     },
58 |     {
59 |       id: "4",
60 |       title: chatExamples.at(2).title,
61 |     },
62 |     {
63 |       id: "5",
64 |       title: chatExamples.at(3).title,
65 |     },
66 |   ],
67 |   "30d": [
68 |     {
69 |       id: "1",
70 |       title: chatExamples.at(2).title,
71 |     },
72 |     {
73 |       id: "2",
74 |       title: chatExamples.at(3).title,
75 |     },
76 |     {
77 |       id: "3",
78 |       title: chatExamples.at(4).title,
79 |     },
80 |     {
81 |       id: "4",
82 |       title: chatExamples.at(5).title,
83 |     },
84 |     {
85 |       id: "5",
86 |       title: chatExamples.at(6).title,
87 |     },
88 |   ],
89 | };
90 |
91 | export function SidebarItems({ onSelect }: SidebarItemsProps) {
92 |   return (
93 |     <div className="overflow-auto relative h-full md:h-[410px] mt-4 scrollbar-hide p-4 pt-0 pb-[70px] flex flex-col space-y-6">
94 |       {!Object.keys(items).length && (
95 |         <div className="flex flex-col justify-center items-center h-full">
96 |           <div className="flex flex-col items-center -mt-12 text-xs space-y-1">
97 |             <span className="text-[#878787]">History</span>
98 |             <span>No results found</span>
99 |           </div>
100 |         </div>
101 |       )}
102 |
103 |       {Object.keys(items).map((key) => {
104 |         const section = items[key];
105 |
106 |         return (
107 |           <div key={key}>
108 |             {section?.length > 0 && (
109 |               <div className="sticky top-0 z-20 w-full bg-background dark:bg-[#131313] pb-1">
110 |                 <span className="font-mono text-xs">{formatRange(key)}</span>
111 |               </div>
112 |             )}
113 |
114 |             <div className="mt-1">
115 |               {section?.map((chat) => {
116 |                 return (
117 |                   <SidebarItem key={chat.id} chat={chat} onSelect={onSelect} />
118 |                 );
119 |               })}
120 |             </div>
121 |           </div>
122 |         );
123 |       })}
124 |     </div>
125 |   );
126 | }
```

apps/website/src/components/assistant/sidebar.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 | import { useClickAway } from "@uidotdev/usehooks";
3 | import { SidebarItems } from "./sidebar-items";
4 | import { Toolbar } from "./toolbar";
5 |
6 | type Props = {
7 |   isExpanded: boolean;
8 |   setExpanded: (value: boolean) => void;
9 |   onSelect: (id: string) => void;
10 |   onNewChat: () => void;
11 | };
12 |
13 | export function Sidebar({
14 |   isExpanded,
15 |   setExpanded,
16 |   onSelect,
17 |   onNewChat,
18 | }: Props) {
19 |   const ref = useClickAway(() => {
20 |     setExpanded(false);
21 |   });
22 |
23 |   return (
24 |     <div className="relative">
25 |       <div
26 |         ref={ref}
27 |         className={cn(
28 |           "w-[220px] h-full md:h-[422px] bg-background dark:bg-[#131313] absolute -left-[220px] top-0 bottom-[1px] duration-200 ease-out transition-all border-border border-r-[1px] z-20 invisible",
29 |           isExpanded && "visible translate-x-full"
30 |         )}
31 |       >
32 |         <Toolbar onNewChat={onNewChat} />
33 |         <SidebarItems onSelect={onSelect} />
34 |         <div className="absolute z-10 h-full md:h-[422px] w-[45px] bg-gradient-to-r from-background/30 dark:from-[#131313]/30 to-background right-0 top-0 pointer-events-none" />
35 |       </div>
36 |
37 |       <div
38 |         className={cn(
39 |           "duration-200 ease-out transition-all z-10 absolute left-[1px] right-[1px] top-[1px] bottom-[1px] invisible opacity-0 bg-background",
40 |           isExpanded && "visible opacity-80"
41 |         )}
42 |       />
43 |     </div>
44 |   );
45 | }
```

apps/website/src/components/assistant/spinner.tsx
```
1 | "use client";
2 |
3 | export const spinner = (
4 |   <svg
5 |     fill="none"
6 |     stroke="currentColor"
7 |     strokeWidth="1.5"
8 |     viewBox="0 0 24 24"
9 |     strokeLinecap="round"
10 |     strokeLinejoin="round"
11 |     xmlns="http://www.w3.org/2000/svg"
12 |     className="size-5 animate-spin stroke-zinc-400"
13 |   >
14 |     <path d="M12 3v3m6.366-.366-2.12 2.12M21 12h-3m.366 6.366-2.12-2.12M12 21v-3m-6.366.366 2.12-2.12M3 12h3m-.366-6.366 2.12 2.12" />
15 |   </svg>
16 | );
```

apps/website/src/components/assistant/toolbar.tsx
```
1 | type Props = {
2 |   onNewChat: () => void;
3 | };
4 |
5 | export function Toolbar({ onNewChat }: Props) {
6 |   return (
7 |     <button
8 |       onClick={onNewChat}
9 |       type="button"
10 |       className="left-4 right-4 absolute z-50 bottom-4 "
11 |     >
12 |       <div className="flex items-center justify-center">
13 |         <div className="dark:bg-[#1A1A1A]/95 bg-[#F6F6F3]/95 h-8 w-full justify-between items-center flex px-2 rounded-lg space-x-4 text-[#878787]">
14 |           <div className="flex items-center space-x-3">
15 |             <kbd className="pointer-events-none h-5 select-none items-center gap-1.5 rounded border bg-accent px-1.5 font-mono text-[11px] font-medium flex bg-[#2C2C2C]">
16 |               <span className="text-[16px]">⌘</span>J
17 |             </kbd>
18 |             <span className="text-xs">New chat</span>
19 |           </div>
20 |         </div>
21 |       </div>
22 |     </button>
23 |   );
24 | }
```

apps/website/src/components/charts/bank-accounts-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function BankAccountsChart() {
4 |   const { bankAccounts } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Bank Accounts</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of connected bank accounts.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {bankAccounts &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(
22 |               bankAccounts,
23 |             )}
24 |         </span>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/website/src/components/charts/bank-connections-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 | import Link from "next/link";
3 |
4 | export async function BankConnectionsChart() {
5 |   const { bankConnections } = await fetchStats();
6 |
7 |   return (
8 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
9 |       <h2 className="text-2xl">Bank Connections</h2>
10 |       <p className="text-[#878787] text-sm text-center">
11 |         Number of connected bank connections using{" "}
12 |         <Link href="/engine" className="underline">
13 |           Midday Engine
14 |         </Link>
15 |         .
16 |       </p>
17 |
18 |       <div className="flex items-center space-x-4">
19 |         <span className="relative ml-auto flex h-2 w-2">
20 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
21 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
22 |         </span>
23 |
24 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
25 |           {bankConnections}
26 |         </span>
27 |       </div>
28 |     </div>
29 |   );
30 | }
```

apps/website/src/components/charts/inbox-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function InboxChart() {
4 |   const { inboxItems } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Inbox</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of incoming inbox items.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {inboxItems &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(inboxItems)}
22 |         </span>
23 |       </div>
24 |     </div>
25 |   );
26 | }
```

apps/website/src/components/charts/invoice-customers.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function InvoiceCustomersChart() {
4 |   const { invoiceCustomers } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Invoice Customers</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of invoice customers.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {invoiceCustomers &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(
22 |               invoiceCustomers,
23 |             )}
24 |         </span>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/website/src/components/charts/invoices-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function InvoicesChart() {
4 |   const { invoices } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Invoices</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of invoices created.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {invoices &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(invoices)}
22 |         </span>
23 |       </div>
24 |     </div>
25 |   );
26 | }
```

apps/website/src/components/charts/reports-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function ReportsChart() {
4 |   const { reports } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Reports</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of generated reports.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {reports &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(reports)}
22 |         </span>
23 |       </div>
24 |     </div>
25 |   );
26 | }
```

apps/website/src/components/charts/tracker-entries-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function TrackerEntriesChart() {
4 |   const { trackerEntries } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Time Tracker Entries</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of tracked time entries.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {trackerEntries &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(
22 |               trackerEntries,
23 |             )}
24 |         </span>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/website/src/components/charts/tracker-projects-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function TrackerProjectsChart() {
4 |   const { trackerProjects } = await fetchStats();
5 |   return (
6 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
7 |       <h2 className="text-2xl">Time Tracker Projects</h2>
8 |       <p className="text-[#878787] text-sm text-center">
9 |         Number of created tracker projects.
10 |       </p>
11 |
12 |       <div className="flex items-center space-x-4">
13 |         <span className="relative ml-auto flex h-2 w-2">
14 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
15 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
16 |         </span>
17 |
18 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
19 |           {trackerProjects &&
20 |             Intl.NumberFormat("en", { notation: "compact" }).format(
21 |               trackerProjects,
22 |             )}
23 |         </span>
24 |       </div>
25 |     </div>
26 |   );
27 | }
```

apps/website/src/components/charts/transaction-enrichments-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 | import Link from "next/link";
3 |
4 | export async function TransactionEnrichmentsChart() {
5 |   const { transactionEnrichments } = await fetchStats();
6 |
7 |   return (
8 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
9 |       <h2 className="text-2xl">Enriched Categories</h2>
10 |       <p className="text-[#878787] text-sm text-center">
11 |         Number of enriched categories using{" "}
12 |         <Link href="/engine" className="underline">
13 |           Midday Engine
14 |         </Link>
15 |         .
16 |       </p>
17 |
18 |       <div className="flex items-center space-x-4">
19 |         <span className="relative ml-auto flex h-2 w-2">
20 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
21 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
22 |         </span>
23 |
24 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
25 |           {transactionEnrichments &&
26 |             Intl.NumberFormat("en", { notation: "compact" }).format(
27 |               transactionEnrichments,
28 |             )}
29 |         </span>
30 |       </div>
31 |     </div>
32 |   );
33 | }
```

apps/website/src/components/charts/transactions-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function TransactionsChart() {
4 |   const { transactions } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Transactions</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         We are already handling a significant amount of transactions.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {transactions &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(
22 |               transactions,
23 |             )}
24 |         </span>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

apps/website/src/components/charts/users-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function UsersChart() {
4 |   const { users } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Businesses</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         This is the number of customers currently using Midday.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {new Intl.NumberFormat("en-US", {
21 |             minimumFractionDigits: 0,
22 |             maximumFractionDigits: 0,
23 |             useGrouping: true,
24 |           }).format(users)}
25 |         </span>
26 |       </div>
27 |     </div>
28 |   );
29 | }
```

apps/website/src/components/charts/vault-chart.tsx
```
1 | import { fetchStats } from "@/lib/fetch-stats";
2 |
3 | export async function VaultChart() {
4 |   const { vaultObjects } = await fetchStats();
5 |
6 |   return (
7 |     <div className="flex border flex-col items-center justify-center border-border bg-background px-6 pt-8 pb-6 space-y-4">
8 |       <h2 className="text-2xl">Vault</h2>
9 |       <p className="text-[#878787] text-sm text-center">
10 |         Number of files in Vault.
11 |       </p>
12 |
13 |       <div className="flex items-center space-x-4">
14 |         <span className="relative ml-auto flex h-2 w-2">
15 |           <span className="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-green-400" />
16 |           <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
17 |         </span>
18 |
19 |         <span className="mt-auto font-mono text-[80px] md:text-[110px]">
20 |           {vaultObjects &&
21 |             Intl.NumberFormat("en", { notation: "compact" }).format(
22 |               vaultObjects,
23 |             )}
24 |         </span>
25 |       </div>
26 |     </div>
27 |   );
28 | }
```

packages/app-store/src/cal/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="79"
5 |       height="17"
6 |       viewBox="0 0 79 17"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <g clipPath="url(#clip0_1893_3733)">
11 |         <path
12 |           d="M8.27225 16.0859C3.83907 16.0859 0.5 12.5771 0.5 8.2453C0.5 3.89909 3.66857 0.36145 8.27225 0.36145C10.7162 0.36145 12.407 1.11229 13.7284 2.83057L11.5971 4.60661C10.7019 3.65361 9.62205 3.17712 8.27225 3.17712C5.27416 3.17712 3.62594 5.47297 3.62594 8.2453C3.62594 11.0177 5.43046 13.2702 8.27225 13.2702C9.60783 13.2702 10.7446 12.7937 11.6397 11.8407L13.7426 13.6889C12.478 15.335 10.7446 16.0859 8.27225 16.0859Z"
13 |           fill="currentColor"
14 |         />
15 |         <path
16 |           d="M22.9215 4.54829H25.7917V15.8109H22.9215V14.1649C22.3248 15.3345 21.3301 16.1142 19.4262 16.1142C16.3855 16.1142 13.9557 13.4718 13.9557 10.223C13.9557 6.97409 16.3855 4.3317 19.4262 4.3317C21.316 4.3317 22.3248 5.11142 22.9215 6.28101V4.54829ZM23.0068 10.223C23.0068 8.46137 21.799 7.00298 19.8951 7.00298C18.0621 7.00298 16.8685 8.47575 16.8685 10.223C16.8685 11.9267 18.0621 13.4429 19.8951 13.4429C21.7849 13.4429 23.0068 11.9701 23.0068 10.223Z"
17 |           fill="currentColor"
18 |         />
19 |         <path d="M27.8235 0H30.6937V15.7966H27.8235V0Z" fill="currentColor" />
20 |         <path
21 |           d="M31.9725 14.3095C31.9725 13.3854 32.7114 12.6057 33.7202 12.6057C34.729 12.6057 35.4395 13.3854 35.4395 14.3095C35.4395 15.2625 34.7148 16.0422 33.7202 16.0422C32.7256 16.0422 31.9725 15.2625 31.9725 14.3095Z"
22 |           fill="currentColor"
23 |         />
24 |         <path
25 |           d="M46.4229 13.9916C45.3572 15.2911 43.7374 16.1142 41.8192 16.1142C38.3949 16.1142 35.8799 13.4718 35.8799 10.223C35.8799 6.97409 38.3949 4.3317 41.8192 4.3317C43.6663 4.3317 45.272 5.11142 46.3376 6.33876L44.1211 8.20143C43.5669 7.50835 42.8422 6.98853 41.8192 6.98853C39.9863 6.98853 38.7927 8.46137 38.7927 10.2085C38.7927 11.9556 39.9863 13.4285 41.8192 13.4285C42.9275 13.4285 43.6948 12.8509 44.2631 12.0712L46.4229 13.9916Z"
26 |           fill="currentColor"
27 |         />
28 |         <path
29 |           d="M46.6644 10.223C46.6644 6.97409 49.1793 4.3317 52.6037 4.3317C56.028 4.3317 58.5429 6.97409 58.5429 10.223C58.5429 13.4718 56.028 16.1142 52.6037 16.1142C49.1793 16.0997 46.6644 13.4718 46.6644 10.223ZM55.6302 10.223C55.6302 8.46137 54.4366 7.00298 52.6037 7.00298C50.7708 6.98853 49.5772 8.46137 49.5772 10.223C49.5772 11.9701 50.7708 13.4429 52.6037 13.4429C54.4366 13.4429 55.6302 11.9701 55.6302 10.223Z"
30 |           fill="currentColor"
31 |         />
32 |         <path
33 |           d="M77.952 8.9236V15.7967H75.0821V9.63111C75.0821 7.68182 74.1727 6.84434 72.8087 6.84434C71.5298 6.84434 70.6205 7.47967 70.6205 9.63111V15.7967H67.7504V9.63111C67.7504 7.68182 66.8267 6.84434 65.4769 6.84434C64.1981 6.84434 63.0756 7.47967 63.0756 9.63111V15.7967H60.2054V4.53405H63.0756V6.09349C63.6724 4.88059 64.7522 4.27414 66.4147 4.27414C67.9919 4.27414 69.3133 5.05386 70.0379 6.36784C70.7626 5.02498 71.8283 4.27414 73.7606 4.27414C76.1193 4.28858 77.952 6.07905 77.952 8.9236Z"
34 |           fill="currentColor"
35 |         />
36 |       </g>
37 |       <defs>
38 |         <clipPath id="clip0_1893_3733">
39 |           <rect
40 |             width="78.0455"
41 |             height="17"
42 |             fill="white"
43 |             transform="translate(0.5)"
44 |           />
45 |         </clipPath>
46 |       </defs>
47 |     </svg>
48 |   );
49 | };
```

packages/app-store/src/fortnox/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="78"
5 |       height="17"
6 |       viewBox="0 0 78 17"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <g clipPath="url(#clip0_1893_3670)">
11 |         <path
12 |           d="M9.59554 1.10556H5.58402C2.792 1.10556 0.89856 2.99623 0.89856 5.78417V15.8143C0.89856 16.1027 1.05902 16.263 1.34785 16.263H3.57825C3.86708 16.263 4.02755 16.1027 4.02755 15.8143V11.6484H9.61158C9.90041 11.6484 10.0609 11.4882 10.0609 11.1998V9.06881C10.0609 8.7804 9.90041 8.62017 9.61158 8.62017H4.0115V5.70406C4.0115 4.77474 4.6373 4.14986 5.56797 4.14986H9.59554C9.88437 4.14986 10.0448 3.98964 10.0448 3.70123V1.5542C10.0448 1.26579 9.88437 1.10556 9.59554 1.10556Z"
13 |           fill="currentColor"
14 |         />
15 |         <path
16 |           d="M17.2816 3.78134C13.591 3.78134 10.9434 6.56928 10.9434 10.1423C10.9434 13.7154 13.6071 16.5033 17.2816 16.5033C20.9562 16.5033 23.6198 13.7154 23.6198 10.1423C23.6198 6.56928 20.9722 3.78134 17.2816 3.78134ZM17.2816 13.5071C15.3882 13.5071 13.9922 12.0971 13.9922 10.1423C13.9922 8.18756 15.3721 6.77757 17.2816 6.77757C19.1911 6.77757 20.5711 8.18756 20.5711 10.1423C20.5711 12.0971 19.1911 13.5071 17.2816 13.5071Z"
17 |           fill="currentColor"
18 |         />
19 |         <path
20 |           d="M38.8155 4.00566H35.0126V1.10556C35.0126 0.817155 34.8521 0.656929 34.5633 0.656929H32.3329C32.044 0.656929 31.8836 0.817155 31.8836 1.10556V4.00566H29.2039C26.4279 4.00566 24.5184 5.89633 24.5184 8.68426V15.8143C24.5184 16.1027 24.6789 16.263 24.9677 16.263H27.1981C27.487 16.263 27.6474 16.1027 27.6474 15.8143V8.58813C27.6474 7.65881 28.2732 7.03393 29.2039 7.03393H31.8836V11.5844C31.8836 14.3723 33.777 16.263 36.569 16.263H38.7994C39.0883 16.263 39.2487 16.1027 39.2487 15.8143V13.6833C39.2487 13.3949 39.0883 13.2347 38.7994 13.2347H36.5851C35.6544 13.2347 35.0286 12.6098 35.0286 11.6805V7.03393H38.8315C39.1204 7.03393 39.2808 6.87371 39.2808 6.5853V4.45429C39.2648 4.14986 39.1043 4.00566 38.8155 4.00566Z"
21 |           fill="currentColor"
22 |         />
23 |         <path
24 |           d="M45.7474 3.78134C42.3777 3.78134 40.1633 5.94439 40.1633 9.24505V15.8304C40.1633 16.1188 40.3238 16.279 40.6126 16.279H42.843C43.1319 16.279 43.2923 16.1188 43.2923 15.8304V9.24505C43.2923 7.75495 44.2711 6.79359 45.7474 6.80961C47.2236 6.79359 48.2024 7.73893 48.2024 9.24505V15.8304C48.2024 16.1188 48.3629 16.279 48.6517 16.279H50.8821C51.1709 16.279 51.3314 16.1188 51.3314 15.8304V9.24505C51.3314 5.94439 49.117 3.78134 45.7474 3.78134Z"
25 |           fill="currentColor"
26 |         />
27 |         <path
28 |           d="M58.5682 3.78134C54.8776 3.78134 52.23 6.56928 52.23 10.1423C52.23 13.7154 54.8936 16.5033 58.5682 16.5033C62.2588 16.5033 64.9064 13.7154 64.9064 10.1423C64.9064 6.56928 62.2427 3.78134 58.5682 3.78134ZM58.5682 13.5071C56.6747 13.5071 55.2787 12.0971 55.2787 10.1423C55.2787 8.18756 56.6587 6.77757 58.5682 6.77757C60.4616 6.77757 61.8576 8.18756 61.8576 10.1423C61.8576 12.0971 60.4616 13.5071 58.5682 13.5071Z"
29 |           fill="currentColor"
30 |         />
31 |         <path
32 |           d="M73.3306 10.1103L77.2779 6.16871C77.4865 5.96042 77.4865 5.75212 77.2779 5.54383L75.7215 3.98963C75.5129 3.78134 75.3043 3.78134 75.0957 3.98963L71.1483 7.9312L67.201 3.98963C66.9924 3.78134 66.7838 3.78134 66.5752 3.98963L65.0187 5.54383C64.8101 5.75212 64.8101 5.96042 65.0187 6.16871L68.9661 10.1103L64.9866 14.0518C64.7781 14.2601 64.7781 14.4684 64.9866 14.6767L66.5431 16.2309C66.7517 16.4392 66.9603 16.4392 67.1689 16.2309L71.1163 12.2894L75.0636 16.2309C75.2722 16.4392 75.4808 16.4392 75.6894 16.2309L77.2459 14.6767C77.4545 14.4684 77.4545 14.2601 77.2459 14.0518L73.3306 10.1103Z"
33 |           fill="currentColor"
34 |         />
35 |       </g>
36 |       <defs>
37 |         <clipPath id="clip0_1893_3670">
[TRUNCATED]
```

packages/app-store/src/quick-books/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="41"
5 |       height="40"
6 |       viewBox="0 0 41 40"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <path
11 |         d="M20.5 40C31.5456 40 40.5 31.0456 40.5 20C40.5 8.95437 31.5456 0 20.5 0C9.45437 0 0.5 8.95437 0.5 20C0.5 31.0456 9.45437 40 20.5 40Z"
12 |         fill="#F5F5F3"
13 |       />
14 |       <path
15 |         d="M6.05585 20C6.05585 22.0628 6.8753 24.0411 8.33392 25.4998C9.79255 26.9584 11.7709 27.7778 13.8337 27.7778H14.9446V24.8888H13.8337C13.1884 24.8939 12.5484 24.7713 11.9507 24.5279C11.3531 24.2845 10.8095 23.9252 10.3513 23.4707C9.8932 23.0163 9.52957 22.4756 9.28142 21.8799C9.03328 21.2841 8.90552 20.6452 8.90552 19.9999C8.90552 19.3545 9.03328 18.7156 9.28142 18.1199C9.52957 17.5242 9.8932 16.9835 10.3513 16.529C10.8095 16.0745 11.3531 15.7152 11.9507 15.4718C12.5484 15.2284 13.1884 15.1058 13.8337 15.111H16.5002V30.2222C16.5005 30.9883 16.8049 31.723 17.3466 32.2647C17.8883 32.8064 18.6229 33.1109 19.389 33.1113V12.2222H13.8337C12.8122 12.2222 11.8008 12.4233 10.8571 12.8142C9.91345 13.205 9.05599 13.7779 8.33372 14.5002C7.61145 15.2224 7.03851 16.0798 6.64762 17.0235C6.25673 17.9672 6.05585 18.9786 6.05585 20ZM27.1668 12.2222H26.0559V15.1113H27.1668C28.4538 15.1258 29.6831 15.6473 30.5881 16.5625C31.493 17.4778 32.0006 18.7129 32.0006 20C32.0006 21.2871 31.493 22.5223 30.5881 23.4375C29.6831 24.3527 28.4538 24.8742 27.1668 24.8888H24.5002V9.77815C24.5003 9.39876 24.4256 9.02309 24.2804 8.67257C24.1353 8.32206 23.9225 8.00357 23.6542 7.73529C23.386 7.46701 23.0675 7.2542 22.717 7.10901C22.3665 6.96381 21.9909 6.88908 21.6115 6.88908V27.7781H27.1668C29.2296 27.7781 31.2079 26.9587 32.6665 25.5001C34.1252 24.0415 34.9446 22.0631 34.9446 20.0003C34.9446 17.9375 34.1252 15.9592 32.6665 14.5006C31.2079 13.042 29.2296 12.2222 27.1668 12.2222Z"
16 |         fill="#121212"
17 |       />
18 |     </svg>
19 |   );
20 | };
```

packages/app-store/src/raycast/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="95"
5 |       height="25"
6 |       viewBox="0 0 95 25"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <path
[TRUNCATED]
```

packages/app-store/src/slack/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="40"
5 |       height="40"
6 |       viewBox="0 0 40 40"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <path
11 |         d="M9.85313 24.6172C9.85251 25.3442 9.63636 26.0547 9.23199 26.6589C8.82763 27.2631 8.25322 27.7339 7.58136 28.0117C6.9095 28.2895 6.17036 28.3618 5.45739 28.2196C4.74441 28.0774 4.0896 27.727 3.57574 27.2127C3.06187 26.6984 2.71203 26.0433 2.57042 25.3302C2.42881 24.6171 2.5018 23.878 2.78016 23.2064C3.05852 22.5348 3.52976 21.9607 4.1343 21.5569C4.73884 21.153 5.44954 20.9375 6.17656 20.9375H9.85313V24.6172Z"
12 |         fill="currentColor"
13 |       />
14 |       <path
15 |         d="M11.7063 24.6172C11.7063 23.6421 12.0936 22.7069 12.7831 22.0175C13.4726 21.328 14.4078 20.9406 15.3829 20.9406C16.3579 20.9406 17.2931 21.328 17.9826 22.0175C18.6721 22.7069 19.0594 23.6421 19.0594 24.6172V33.8234C19.0594 34.7985 18.6721 35.7337 17.9826 36.4231C17.2931 37.1126 16.3579 37.5 15.3829 37.5C14.4078 37.5 13.4726 37.1126 12.7831 36.4231C12.0936 35.7337 11.7063 34.7985 11.7063 33.8234V24.6172Z"
16 |         fill="currentColor"
17 |       />
18 |       <path
19 |         d="M15.3829 9.85313C14.6559 9.85251 13.9454 9.63636 13.3412 9.23199C12.737 8.82763 12.2662 8.25322 11.9884 7.58136C11.7106 6.9095 11.6383 6.17036 11.7805 5.45739C11.9227 4.74441 12.2731 4.0896 12.7874 3.57574C13.3017 3.06187 13.9568 2.71203 14.6699 2.57042C15.383 2.42881 16.1221 2.5018 16.7937 2.78016C17.4653 3.05852 18.0394 3.52976 18.4432 4.1343C18.8471 4.73884 19.0626 5.44954 19.0626 6.17656V9.85313H15.3829Z"
20 |         fill="currentColor"
21 |       />
22 |       <path
23 |         d="M15.3828 11.7062C16.3579 11.7062 17.293 12.0936 17.9825 12.7831C18.672 13.4726 19.0594 14.4077 19.0594 15.3828C19.0594 16.3579 18.672 17.293 17.9825 17.9825C17.293 18.672 16.3579 19.0594 15.3828 19.0594H6.17656C5.20148 19.0594 4.26633 18.672 3.57684 17.9825C2.88735 17.293 2.5 16.3579 2.5 15.3828C2.5 14.4077 2.88735 13.4726 3.57684 12.7831C4.26633 12.0936 5.20148 11.7062 6.17656 11.7062H15.3828Z"
24 |         fill="currentColor"
25 |       />
26 |       <path
27 |         d="M30.147 15.3828C30.1476 14.6558 30.3637 13.9453 30.7681 13.3411C31.1725 12.7369 31.7469 12.2661 32.4187 11.9883C33.0906 11.7106 33.8297 11.6382 34.5427 11.7804C35.2557 11.9226 35.9105 12.273 36.4244 12.7873C36.9382 13.3016 37.2881 13.9567 37.4297 14.6698C37.5713 15.3829 37.4983 16.122 37.2199 16.7936C36.9416 17.4652 36.4703 18.0393 35.8658 18.4431C35.2613 18.847 34.5506 19.0625 33.8235 19.0625H30.147V15.3828Z"
28 |         fill="currentColor"
29 |       />
30 |       <path
31 |         d="M28.2938 15.3828C28.2938 16.3579 27.9064 17.293 27.217 17.9825C26.5275 18.672 25.5923 19.0594 24.6172 19.0594C23.6422 19.0594 22.707 18.672 22.0175 17.9825C21.328 17.293 20.9407 16.3579 20.9407 15.3828V6.17656C20.9407 5.20148 21.328 4.26633 22.0175 3.57684C22.707 2.88735 23.6422 2.5 24.6172 2.5C25.5923 2.5 26.5275 2.88735 27.217 3.57684C27.9064 4.26633 28.2938 5.20148 28.2938 6.17656V15.3828Z"
32 |         fill="currentColor"
33 |       />
34 |       <path
35 |         d="M24.6172 30.1469C25.3442 30.1475 26.0547 30.3637 26.6589 30.768C27.2631 31.1724 27.7339 31.7468 28.0117 32.4186C28.2895 33.0905 28.3618 33.8296 28.2196 34.5426C28.0774 35.2556 27.727 35.9104 27.2127 36.4243C26.6984 36.9381 26.0433 37.288 25.3302 37.4296C24.6171 37.5712 23.878 37.4982 23.2064 37.2198C22.5348 36.9415 21.9607 36.4702 21.5569 35.8657C21.153 35.2612 20.9375 34.5505 20.9375 33.8234V30.1469H24.6172Z"
36 |         fill="currentColor"
37 |       />
38 |       <path
[TRUNCATED]
```

packages/app-store/src/slack/lib/client.ts
```
1 | import { LogLevel, App as SlackApp } from "@slack/bolt";
2 | import { InstallProvider } from "@slack/oauth";
3 | import { WebClient } from "@slack/web-api";
4 |
5 | const SLACK_CLIENT_ID = process.env.NEXT_PUBLIC_SLACK_CLIENT_ID;
6 | const SLACK_CLIENT_SECRET = process.env.SLACK_CLIENT_SECRET;
7 | const SLACK_OAUTH_REDIRECT_URL =
8 |   process.env.NEXT_PUBLIC_SLACK_OAUTH_REDIRECT_URL;
9 | const SLACK_STATE_SECRET = process.env.NEXT_PUBLIC_SLACK_STATE_SECRET;
10 | const SLACK_SIGNING_SECRET = process.env.SLACK_SIGNING_SECRET;
11 |
12 | export const slackInstaller = new InstallProvider({
13 |   clientId: SLACK_CLIENT_ID!,
14 |   clientSecret: SLACK_CLIENT_SECRET!,
15 |   stateSecret: SLACK_STATE_SECRET,
16 |   logLevel: process.env.NODE_ENV === "development" ? LogLevel.DEBUG : undefined,
17 | });
18 |
19 | export const createSlackApp = ({
20 |   token,
21 |   botId,
22 | }: { token: string; botId: string }) => {
23 |   return new SlackApp({
24 |     signingSecret: SLACK_SIGNING_SECRET,
25 |     token,
26 |     botId,
27 |   });
28 | };
29 |
30 | export const createSlackWebClient = ({
31 |   token,
32 | }: {
33 |   token: string;
34 | }) => {
35 |   return new WebClient(token);
36 | };
37 |
38 | export const getInstallUrl = ({
39 |   teamId,
40 |   userId,
41 | }: { teamId: string; userId: string }) => {
42 |   return slackInstaller.generateInstallUrl({
43 |     scopes: [
44 |       "incoming-webhook",
45 |       "chat:write",
46 |       "chat:write.public",
47 |       "team:read",
48 |       "assistant:write",
49 |       "im:history",
50 |       "commands",
51 |       "files:read",
52 |     ],
53 |     redirectUri: SLACK_OAUTH_REDIRECT_URL,
54 |     metadata: JSON.stringify({ teamId, userId }),
55 |   });
56 | };
57 |
58 | export const downloadFile = async ({
59 |   privateDownloadUrl,
60 |   token,
61 | }: { privateDownloadUrl: string; token: string }) => {
62 |   const response = await fetch(privateDownloadUrl, {
63 |     method: "GET",
64 |     headers: {
65 |       Authorization: `Bearer ${token}`,
66 |     },
67 |   });
68 |
69 |   return response.arrayBuffer();
70 | };
```

packages/app-store/src/slack/lib/index.ts
```
1 | export * from "./client";
2 | export * from "./events";
3 | export * from "./verify";
4 | export * from "./notifications";
```

packages/app-store/src/slack/lib/verify.ts
```
1 | import { createHmac } from "node:crypto";
2 |
3 | export async function verifySlackWebhook(req: Request) {
4 |   const SLACK_SIGNING_SECRET = process.env.SLACK_SIGNING_SECRET;
5 |
6 |   if (!SLACK_SIGNING_SECRET) {
7 |     throw new Error("SLACK_SIGNING_SECRET is not set");
8 |   }
9 |
10 |   const fiveMinutesInSeconds = 5 * 60;
11 |   const slackSignatureVersion = "v0";
12 |
13 |   const body = await req.text();
14 |   const timestamp = req.headers.get("x-slack-request-timestamp");
15 |   const slackSignature = req.headers.get("x-slack-signature");
16 |
17 |   if (!timestamp || !slackSignature) {
18 |     throw new Error("Missing required Slack headers");
19 |   }
20 |
21 |   const currentTime = Math.floor(Date.now() / 1000);
22 |   if (
23 |     Math.abs(currentTime - Number.parseInt(timestamp)) > fiveMinutesInSeconds
24 |   ) {
25 |     throw new Error("Request is too old");
26 |   }
27 |
28 |   const sigBasestring = `${slackSignatureVersion}:${timestamp}:${body}`;
29 |   const mySignature = createHmac("sha256", SLACK_SIGNING_SECRET)
30 |     .update(sigBasestring)
31 |     .digest("hex");
32 |
33 |   if (`${slackSignatureVersion}=${mySignature}` !== slackSignature) {
34 |     throw new Error("Invalid Slack signature");
35 |   }
36 |
37 |   return JSON.parse(body);
38 | }
```

packages/app-store/src/visma/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="92"
5 |       height="17"
6 |       viewBox="0 0 92 17"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <g clipPath="url(#clip0_1893_3698)">
11 |         <path
12 |           d="M9.37462 0C14.3437 0.421606 19.8265 2.94144 22.9523 6.53C26.9566 11.1147 25.58 15.7034 19.8736 16.774C14.1672 17.8467 6.29591 14.9974 2.29163 10.4088C-0.771384 6.89866 -0.685102 3.38854 2.07985 1.45111L17.944 13.1678L9.37462 0Z"
13 |           fill="currentColor"
14 |         />
15 |         <path
16 |           fillRule="evenodd"
17 |           clipRule="evenodd"
18 |           d="M83.7518 0.0372314L79.124 16.7249H82.5752L84.5951 8.7635C84.8501 7.80263 84.9284 6.84191 85.1049 5.88104H85.144C85.3401 6.83407 85.4576 7.78486 85.7518 8.73592L87.735 16.7249H91.2624L86.4381 0.0372314H83.7518ZM87.735 16.7249H87.7127L87.7403 16.7468L87.735 16.7249ZM35.069 0.0586794L35.0694 0.0609777H35.071L35.069 0.0586794ZM35.0694 0.0609777H31.5294L36.3536 16.7487H39.0538L43.6777 0.0648074H40.2265L38.2142 8.02623C37.9475 9.00278 37.8809 9.954 37.7045 10.9286H37.6593C37.4612 9.97557 37.3496 9.0244 37.0633 8.07334L35.0694 0.0609777ZM46.1561 0.0586794V16.7468H49.4564V0.0586794H46.1561ZM57.63 0.0586794C57.612 0.0713512 57.5953 0.0867908 57.5776 0.100044H57.63V0.0586794ZM57.5776 0.100044H53.6844C53.6844 0.100044 53.4002 0.629656 53.2669 0.943409C51.8942 4.25743 53.1885 6.68886 54.4435 9.02241C55.4847 10.9638 56.561 12.9836 55.6492 15.1799C55.3785 15.827 54.8884 16.3957 54.4373 16.7487H58.4083C58.4083 16.7487 58.6281 16.3172 58.7262 16.0819C60.0537 12.8777 59.3477 10.6282 57.5691 7.57697C57.4534 7.36715 57.3298 7.15551 57.2122 6.94961C56.3945 5.53968 55.4727 3.94161 56.3355 1.86299C56.6203 1.17561 57.0353 0.505181 57.5776 0.100044ZM68.0955 0.0586794L68.099 0.0805104H68.1269L68.0955 0.0586794ZM68.099 0.0805104H63.7737L62.303 16.7682H65.8523L66.323 4.74736H66.3659V5.06142L66.9189 8.76733L68.5367 16.7487H71.0783L72.4977 8.84585L73.0274 4.74736H73.0726L73.8704 16.7487H77.2553L75.5058 0.0609775H71.0783L69.7524 9.90867H69.7095L68.099 0.0805104Z"
19 |           fill="currentColor"
20 |         />
21 |       </g>
22 |       <defs>
23 |         <clipPath id="clip0_1893_3698">
24 |           <rect width="91.2624" height="17" fill="currentColor" />
25 |         </clipPath>
26 |       </defs>
27 |     </svg>
28 |   );
29 | };
```

packages/app-store/src/xero/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="40"
5 |       height="40"
6 |       viewBox="0 0 40 40"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <g clipPath="url(#clip0_1893_3614)">
11 |         <mask
12 |           id="mask0_1893_3614"
13 |           maskUnits="userSpaceOnUse"
14 |           x="-9"
15 |           y="-9"
16 |           width="58"
17 |           height="58"
18 |         >
19 |           <path
20 |             d="M-8.80334 -8.84987H48.8393V48.7927H-8.80334V-8.84987Z"
21 |             fill="white"
22 |           />
23 |         </mask>
24 |         <g mask="url(#mask0_1893_3614)">
25 |           <path
26 |             d="M20.0001 39.9237C31.0037 39.9237 39.9238 31.0037 39.9238 20C39.9238 8.99641 31.0037 0.0762529 20.0001 0.0762529C8.99645 0.0762529 0.0762939 8.99641 0.0762939 20C0.0762939 31.0037 8.99645 39.9237 20.0001 39.9237Z"
27 |             fill="#F5F5F3"
28 |           />
29 |           <path
30 |             d="M9.61353 19.9424L13.0137 16.5339C13.1264 16.419 13.1893 16.2669 13.1893 16.1055C13.1893 15.7693 12.916 15.4963 12.5798 15.4963C12.416 15.4963 12.2625 15.5605 12.1467 15.6777C12.1464 15.6784 8.74963 19.0732 8.74963 19.0732L5.33735 15.6726C5.22205 15.5589 5.06927 15.4963 4.90727 15.4963C4.57147 15.4963 4.2981 15.7692 4.2981 16.1051C4.2981 16.2689 4.36351 16.4226 4.48091 16.5385L7.88058 19.9377L4.48267 23.342C4.36324 23.4596 4.2981 23.6136 4.2981 23.7782C4.2981 24.1143 4.57147 24.387 4.90727 24.387C5.06954 24.387 5.22246 24.3241 5.33735 24.2091L8.74435 20.8067L12.1384 24.1967C12.2588 24.3212 12.4141 24.3874 12.5798 24.3874C12.9157 24.3874 13.189 24.1143 13.189 23.7782C13.189 23.616 13.1261 23.4636 13.0118 23.3487L9.61353 19.9424Z"
31 |             fill="#121212"
32 |           />
33 |           <path
34 |             d="M29.8268 19.9414C29.8268 20.5519 30.3232 21.0484 30.9344 21.0484C31.5441 21.0484 32.0407 20.5519 32.0407 19.9414C32.0407 19.3308 31.5441 18.8343 30.9344 18.8343C30.3232 18.8343 29.8268 19.3308 29.8268 19.9414Z"
35 |             fill="#121212"
36 |           />
37 |           <path
38 |             d="M27.7271 19.9419C27.7271 18.1741 29.1652 16.7358 30.9332 16.7358C32.7003 16.7358 34.1388 18.1741 34.1388 19.9419C34.1388 21.7093 32.7003 23.1471 30.9332 23.1471C29.1652 23.1471 27.7271 21.7093 27.7271 19.9419ZM26.4659 19.9419C26.4659 22.4048 28.47 24.4085 30.9332 24.4085C33.3964 24.4085 35.4014 22.4048 35.4014 19.9419C35.4014 17.4788 33.3964 15.4745 30.9332 15.4745C28.47 15.4745 26.4659 17.4788 26.4659 19.9419Z"
39 |             fill="#121212"
40 |           />
41 |           <path
42 |             d="M26.1489 15.5509L25.9614 15.5503C25.3988 15.5503 24.8561 15.7278 24.4028 16.0771C24.3431 15.8038 24.0988 15.5981 23.8078 15.5981C23.4729 15.5981 23.2045 15.8665 23.2037 16.2021C23.2037 16.2033 23.2058 23.726 23.2058 23.726C23.2066 24.061 23.4799 24.3333 23.815 24.3333C24.1501 24.3333 24.4232 24.061 24.4241 23.7253C24.4241 23.7238 24.4244 19.099 24.4244 19.099C24.4244 17.5571 24.5654 16.9343 25.8862 16.7693C26.0083 16.7541 26.1411 16.7565 26.1416 16.7565C26.503 16.7441 26.7599 16.4957 26.7599 16.16C26.7599 15.8242 26.4857 15.5509 26.1489 15.5509Z"
43 |             fill="#121212"
44 |           />
45 |           <path
[TRUNCATED]
```

packages/app-store/src/zapier/assets/logo.tsx
```
1 | export const Logo = () => {
2 |   return (
3 |     <svg
4 |       width="79"
5 |       height="22"
6 |       viewBox="0 0 79 22"
7 |       fill="none"
8 |       xmlns="http://www.w3.org/2000/svg"
9 |     >
10 |       <path
[TRUNCATED]
```

packages/documents/src/processors/expense/expense-processor.ts
```
1 | import {
2 |   type AnalyzeResultOperationOutput,
3 |   getLongRunningPoller,
4 |   isUnexpected,
5 | } from "@azure-rest/ai-document-intelligence";
6 | import { capitalCase } from "change-case";
7 | import type { Processor } from "../../interface";
8 | import { client } from "../../provider/azure";
9 | import type { GetDocumentRequest } from "../../types";
10 | import {
11 |   extractRootDomain,
12 |   getCurrency,
13 |   getDomainFromEmail,
14 | } from "../../utils";
15 | import { LlmProcessor } from "../llm/llm-processor";
16 |
17 | export class ExpenseProcessor implements Processor {
18 |   async #processDocument(content: string) {
19 |     const initialResponse = await client
20 |       .path("/documentModels/{modelId}:analyze", "prebuilt-receipt")
21 |       .post({
22 |         contentType: "application/json",
23 |         body: {
24 |           base64Source: content,
25 |         },
26 |         queryParameters: {
27 |           features: ["queryFields"],
28 |           queryFields: ["Email", "Website"],
29 |         },
30 |       });
31 |
32 |     if (isUnexpected(initialResponse)) {
33 |       throw initialResponse.body.error;
34 |     }
35 |     const poller = await getLongRunningPoller(client, initialResponse);
36 |     const result = (await poller.pollUntilDone())
37 |       .body as AnalyzeResultOperationOutput;
38 |
39 |     return this.#extractData(result);
40 |   }
41 |
42 |   #getWebsiteFromFields(
43 |     fields?: Record<string, { valueString?: string }>,
44 |     content?: string,
45 |   ) {
46 |     const website =
47 |       // First try to get the email domain
48 |       getDomainFromEmail(fields?.Email?.valueString) ||
49 |       fields?.Website?.valueString ||
50 |       // Then try to get the website from the content
51 |       extractRootDomain(content) ||
52 |       null;
53 |
54 |     return website;
55 |   }
56 |
57 |   async #extractData(data: AnalyzeResultOperationOutput) {
58 |     const fields = data.analyzeResult?.documents?.[0]?.fields;
59 |     const content = data.analyzeResult?.content;
60 |
61 |     const website = this.#getWebsiteFromFields(fields, content);
62 |
63 |     const result = {
64 |       name:
65 |         (fields?.MerchantName?.valueString &&
66 |           capitalCase(fields?.MerchantName?.valueString)) ??
67 |         null,
68 |       date: fields?.TransactionDate?.valueDate || null,
69 |       currency: getCurrency(fields?.Total),
70 |       amount: fields?.Total?.valueCurrency?.amount ?? null,
71 |       type: "expense",
72 |       website,
73 |     };
74 |
75 |     // Return if all values are not null
76 |     if (Object.values(result).every((value) => value !== null)) {
77 |       return result;
78 |     }
79 |
80 |     const fallback = content ? await this.#fallbackToLlm(content) : null;
81 |
82 |     // Only replace null values from LLM
83 |     const mappedResult = Object.fromEntries(
84 |       Object.entries(result).map(([key, value]) => [
85 |         key,
86 |         value ?? fallback?.[key as keyof typeof result] ?? null,
87 |       ]),
88 |     );
89 |
90 |     return {
91 |       ...mappedResult,
92 |       // We only have description from LLM
93 |       description: fallback?.description ?? null,
94 |     };
95 |   }
96 |
97 |   async #fallbackToLlm(content: string) {
98 |     const llm = new LlmProcessor();
99 |     const fallbackData = await llm.getStructuredData(content);
100 |     return { ...fallbackData, type: "expense" };
101 |   }
102 |
103 |   public async getDocument(params: GetDocumentRequest) {
104 |     return this.#processDocument(params.content);
105 |   }
106 | }
```

packages/documents/src/processors/invoice/invoice-processor.ts
```
1 | import {
2 |   type AnalyzeResultOperationOutput,
3 |   getLongRunningPoller,
4 |   isUnexpected,
5 | } from "@azure-rest/ai-document-intelligence";
6 | import { capitalCase } from "change-case";
7 | import type { Processor } from "../../interface";
8 | import { client } from "../../provider/azure";
9 | import type { GetDocumentRequest } from "../../types";
10 | import {
11 |   extractRootDomain,
12 |   getCurrency,
13 |   getDomainFromEmail,
14 | } from "../../utils";
15 | import { LlmProcessor } from "../llm/llm-processor";
16 |
17 | export class InvoiceProcessor implements Processor {
18 |   async #processDocument(content: string) {
19 |     const initialResponse = await client
20 |       .path("/documentModels/{modelId}:analyze", "prebuilt-invoice")
21 |       .post({
22 |         contentType: "application/json",
23 |         body: {
24 |           base64Source: content,
25 |         },
26 |         queryParameters: {
27 |           features: ["queryFields"],
28 |           queryFields: ["VendorEmail", "CustomerEmail"],
29 |           split: "none",
30 |         },
31 |       });
32 |
33 |     if (isUnexpected(initialResponse)) {
34 |       throw initialResponse.body.error;
35 |     }
36 |
37 |     const poller = await getLongRunningPoller(client, initialResponse);
38 |     const result = (await poller.pollUntilDone())
39 |       .body as AnalyzeResultOperationOutput;
40 |
41 |     return this.#extractData(result);
42 |   }
43 |
44 |   #getWebsiteFromFields(
45 |     fields?: Record<string, { valueString?: string }>,
46 |     content?: string,
47 |   ) {
48 |     const website =
49 |       // First try to get the email domain
50 |       getDomainFromEmail(fields?.VendorEmail?.valueString) ||
51 |       fields?.Website?.valueString ||
52 |       // Then try to get the website from the content
53 |       extractRootDomain(content) ||
54 |       null;
55 |
56 |     return website;
57 |   }
58 |
59 |   async #extractData(data: AnalyzeResultOperationOutput) {
60 |     const fields = data.analyzeResult?.documents?.[0]?.fields;
61 |     const content = data.analyzeResult?.content;
62 |
63 |     const website = this.#getWebsiteFromFields(fields, content);
64 |
65 |     const result = {
66 |       name:
67 |         (fields?.VendorName?.valueString &&
68 |           capitalCase(fields?.VendorName?.valueString)) ??
69 |         null,
70 |       date:
71 |         fields?.DueDate?.valueDate || fields?.InvoiceDate?.valueDate || null,
72 |       currency: getCurrency(fields?.InvoiceTotal),
73 |       amount: fields?.InvoiceTotal?.valueCurrency?.amount ?? null,
74 |       type: "invoice",
75 |       website,
76 |     };
77 |
78 |     // Return if all values are not null
79 |     if (Object.values(result).every((value) => value !== null)) {
80 |       return result;
81 |     }
82 |
83 |     const fallback = content ? await this.#fallbackToLlm(content) : null;
84 |
85 |     // Only replace null values from LLM
86 |     const mappedResult = Object.fromEntries(
87 |       Object.entries(result).map(([key, value]) => [
88 |         key,
89 |         value ?? fallback?.[key as keyof typeof result] ?? null,
90 |       ]),
91 |     );
92 |
93 |     return {
94 |       ...mappedResult,
95 |       // We only have description from LLM
96 |       description: fallback?.description ?? null,
97 |     };
98 |   }
99 |
100 |   async #fallbackToLlm(content: string) {
101 |     const llm = new LlmProcessor();
102 |     const fallbackData = await llm.getStructuredData(content);
103 |     return { ...fallbackData, type: "invoice" };
104 |   }
105 |
106 |   public async getDocument(params: GetDocumentRequest) {
107 |     return this.#processDocument(params.content);
108 |   }
109 | }
```

packages/documents/src/processors/layout/index.ts
```
1 | import {
2 |   type AnalyzeResultOperationOutput,
3 |   getLongRunningPoller,
4 |   isUnexpected,
5 | } from "@azure-rest/ai-document-intelligence";
6 | import { client } from "../../provider/azure";
7 | import type { GetDocumentRequest } from "../../types";
8 |
9 | export class LayoutProcessor {
10 |   async #processDocument(content: string) {
11 |     const initialResponse = await client
12 |       .path("/documentModels/{modelId}:analyze", "prebuilt-layout")
13 |       .post({
14 |         contentType: "application/json",
15 |         body: {
16 |           base64Source: content,
17 |         },
18 |       });
19 |
20 |     if (isUnexpected(initialResponse)) {
21 |       throw initialResponse.body.error;
22 |     }
23 |     const poller = await getLongRunningPoller(client, initialResponse);
24 |     const result = (await poller.pollUntilDone())
25 |       .body as AnalyzeResultOperationOutput;
26 |
27 |     return this.#extractData(result);
28 |   }
29 |
30 |   async #extractData(data: AnalyzeResultOperationOutput) {
31 |     const tables = data.analyzeResult?.tables;
32 |
33 |     const firstTable = tables?.at(0);
34 |
35 |     if (!firstTable?.cells?.length) return null;
36 |
37 |     const cellsByRow = firstTable.cells.reduce(
38 |       (acc, cell) => {
39 |         const rowIndex = cell.rowIndex ?? 0;
40 |
41 |         if (!acc[rowIndex]) acc[rowIndex] = [];
42 |
43 |         acc[rowIndex].push({
44 |           columnIndex: cell.columnIndex ?? 0,
45 |           content: cell.content ?? "",
46 |         });
47 |         return acc;
48 |       },
49 |       {} as Record<number, { columnIndex: number; content: string }[]>,
50 |     );
51 |
52 |     return Object.entries(cellsByRow)
53 |       .sort(([a], [b]) => Number(a) - Number(b))
54 |       .map(([rowIndex, cells]) => ({
55 |         rowIndex: Number(rowIndex),
56 |         cells: cells
57 |           .sort((a, b) => a.columnIndex - b.columnIndex)
58 |           .map((cell) => ({
59 |             columnIndex: cell.columnIndex,
60 |             content: cell.content,
61 |           })),
62 |       }));
63 |   }
64 |
65 |   public async getDocument(params: GetDocumentRequest) {
66 |     return this.#processDocument(params.content);
67 |   }
68 | }
```

packages/documents/src/processors/llm/llm-processor.ts
```
1 | import { openai } from "@ai-sdk/openai";
2 | import { generateObject } from "ai";
3 | import { z } from "zod";
4 |
5 | const schema = z.object({
6 |   name: z.string().describe("The supplier or company of the invoice."),
7 |   amount: z
8 |     .number()
9 |     .describe("The total amount of the invoice, usually the highest amount."),
10 |   date: z
11 |     .string()
12 |     .describe("The due date of the invoice (ISO 8601 date string)."),
13 |   website: z
14 |     .string()
15 |     .describe(
16 |       "Website of the supplier or company without protocol (e.g. example.com) and only return if it's not null otherwise get the domain namn from the supplier name.",
17 |     ),
18 |   currency: z.string().describe("Currency code of the invoice."),
19 |   description: z
20 |     .string()
21 |     .describe(
22 |       "Summarize the purchase details by focusing on the supplier name and the content of the purchase. Max 1 sentence. Ignore amounts.",
23 |     ),
24 | });
25 |
26 | export class LlmProcessor {
27 |   public async getStructuredData(content: string) {
28 |     try {
29 |       const { object } = await generateObject({
30 |         model: openai("gpt-4o-mini"),
31 |         mode: "json",
32 |         schema,
33 |         prompt: content,
34 |       });
35 |
36 |       return {
37 |         name: object.name,
38 |         amount: object.amount,
39 |         date: object.date,
40 |         website: object.website?.replace(/^https?:\/\//, ""),
41 |         currency: object.currency,
42 |         description: object.description,
43 |       };
44 |     } catch (error) {
45 |       return null;
46 |     }
47 |   }
48 | }
```

packages/invoice/src/templates/html/format.tsx
```
1 | import type { EditorDoc } from "../types";
2 |
3 | export function formatEditorContent(doc?: EditorDoc): JSX.Element | null {
4 |   if (!doc || !doc.content) {
5 |     return null;
6 |   }
7 |
8 |   return (
9 |     <>
10 |       {doc.content.map((node, nodeIndex) => {
11 |         if (node.type === "paragraph") {
12 |           return (
13 |             <p key={`paragraph-${nodeIndex.toString()}`}>
14 |               {node.content?.map((inlineContent, inlineIndex) => {
15 |                 if (inlineContent.type === "text") {
16 |                   let style = "text-[11px]";
17 |                   let href: string | undefined;
18 |
19 |                   if (inlineContent.marks) {
20 |                     for (const mark of inlineContent.marks) {
21 |                       if (mark.type === "bold") {
22 |                         style += " font-semibold";
23 |                       } else if (mark.type === "italic") {
24 |                         style += " italic";
25 |                       } else if (mark.type === "link") {
26 |                         href = mark.attrs?.href;
27 |                         style += " underline";
28 |                       } else if (mark.type === "strike") {
29 |                         style += " line-through";
30 |                       }
31 |                     }
32 |                   }
33 |
34 |                   const content = inlineContent.text || "";
35 |                   const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(content);
36 |
37 |                   if (href || isEmail) {
38 |                     const linkHref =
39 |                       href || (isEmail ? `mailto:${content}` : content);
40 |                     return (
41 |                       <a
42 |                         key={`link-${nodeIndex}-${inlineIndex.toString()}`}
43 |                         href={linkHref}
44 |                         className={`${style} underline`}
45 |                       >
46 |                         {content}
47 |                       </a>
48 |                     );
49 |                   }
50 |
51 |                   return (
52 |                     <span
53 |                       key={`text-${nodeIndex}-${inlineIndex.toString()}`}
54 |                       className={style}
55 |                     >
56 |                       {content}
57 |                     </span>
58 |                   );
59 |                 }
60 |
61 |                 if (inlineContent.type === "hardBreak") {
62 |                   return (
63 |                     <br key={`break-${nodeIndex}-${inlineIndex.toString()}`} />
64 |                   );
65 |                 }
66 |                 return null;
67 |               })}
68 |             </p>
69 |           );
70 |         }
71 |
72 |         return null;
73 |       })}
74 |     </>
75 |   );
76 | }
```

packages/invoice/src/templates/html/index.tsx
```
1 | import { ScrollArea } from "@midday/ui/scroll-area";
2 | import type { TemplateProps } from "../types";
3 | import { EditorContent } from "./components/editor-content";
4 | import { LineItems } from "./components/line-items";
5 | import { Logo } from "./components/logo";
6 | import { Meta } from "./components/meta";
7 | import { Summary } from "./components/summary";
8 |
9 | export function HtmlTemplate({
10 |   invoice_number,
11 |   issue_date,
12 |   due_date,
13 |   template,
14 |   line_items,
15 |   customer_details,
16 |   from_details,
17 |   payment_details,
18 |   note_details,
19 |   currency,
20 |   discount,
21 |   customer_name,
22 |   width,
23 |   height,
24 |   top_block,
25 |   bottom_block,
26 | }: TemplateProps) {
27 |   return (
28 |     <ScrollArea
29 |       className="bg-background border border-border w-full md:w-auto h-full [&>div]:h-full"
30 |       style={{
31 |         width: "100%",
32 |         maxWidth: width,
33 |         height,
34 |       }}
35 |       hideScrollbar
36 |     >
37 |       <div
38 |         className="p-4 sm:p-6 md:p-8 h-full flex flex-col"
39 |         style={{ minHeight: height - 5 }}
40 |       >
41 |         <div className="flex justify-between">
42 |           <Meta
43 |             template={template}
44 |             invoiceNumber={invoice_number}
45 |             issueDate={issue_date}
46 |             dueDate={due_date}
47 |             timezone={template.timezone}
48 |           />
49 |
50 |           {template.logo_url && (
51 |             <Logo logo={template.logo_url} customerName={customer_name || ""} />
52 |           )}
53 |         </div>
54 |
55 |         <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mt-6 mb-4">
56 |           <div>
57 |             <p className="text-[11px] text-[#878787] font-mono mb-2 block">
58 |               {template.from_label}
59 |             </p>
60 |             <EditorContent content={from_details} />
61 |           </div>
62 |           <div className="mt-4 md:mt-0">
63 |             <p className="text-[11px] text-[#878787] font-mono mb-2 block">
64 |               {template.customer_label}
65 |             </p>
66 |             <EditorContent content={customer_details} />
67 |           </div>
68 |         </div>
69 |
70 |         <EditorContent content={top_block} />
71 |
72 |         <LineItems
73 |           lineItems={line_items}
74 |           currency={currency}
75 |           descriptionLabel={template.description_label}
76 |           quantityLabel={template.quantity_label}
77 |           priceLabel={template.price_label}
78 |           totalLabel={template.total_label}
79 |           includeDecimals={template.include_decimals}
80 |           locale={template.locale}
81 |           includeUnits={template.include_units}
82 |         />
83 |
84 |         <div className="mt-10 md:mt-12 flex justify-end mb-6 md:mb-8">
85 |           <Summary
86 |             includeVAT={template.include_vat}
87 |             includeTax={template.include_tax}
88 |             taxRate={template.tax_rate}
89 |             vatRate={template.vat_rate}
90 |             currency={currency}
91 |             vatLabel={template.vat_label}
92 |             taxLabel={template.tax_label}
93 |             totalLabel={template.total_summary_label}
94 |             lineItems={line_items}
95 |             includeDiscount={template.include_discount}
96 |             discountLabel={template.discount_label}
97 |             discount={discount}
98 |             locale={template.locale}
99 |             includeDecimals={template.include_decimals}
100 |             subtotalLabel={template.subtotal_label}
101 |           />
102 |         </div>
103 |
104 |         <div className="flex flex-col space-y-6 md:space-y-8 mt-auto">
105 |           <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
106 |             <div>
107 |               <p className="text-[11px] text-[#878787] font-mono mb-2 block">
108 |                 {template.payment_label}
109 |               </p>
110 |               <EditorContent content={payment_details} />
111 |             </div>
112 |             {note_details && (
113 |               <div className="mt-4 md:mt-0">
114 |                 <p className="text-[11px] text-[#878787] font-mono mb-2 block">
115 |                   {template.note_label}
116 |                 </p>
117 |                 <EditorContent content={note_details} />
118 |               </div>
119 |             )}
120 |           </div>
121 |
122 |           <EditorContent content={bottom_block} />
123 |         </div>
124 |       </div>
125 |     </ScrollArea>
126 |   );
127 | }
```

packages/invoice/src/templates/og/format.tsx
```
1 | import type { EditorDoc } from "../types";
2 |
3 | export function formatEditorContent(doc?: EditorDoc): JSX.Element | null {
4 |   if (!doc || !doc.content) {
5 |     return null;
6 |   }
7 |
8 |   return (
9 |     <div tw="flex flex-col text-white">
10 |       {doc.content.map((node, nodeIndex) => {
11 |         if (node.type === "paragraph") {
12 |           return (
13 |             <p
14 |               key={`paragraph-${nodeIndex.toString()}`}
15 |               tw="flex flex-col mb-0"
16 |             >
17 |               {node.content?.map((inlineContent, inlineIndex) => {
18 |                 if (inlineContent.type === "text") {
19 |                   let style = "text-[22px]";
20 |
21 |                   if (inlineContent.marks) {
22 |                     for (const mark of inlineContent.marks) {
23 |                       if (mark.type === "bold") {
24 |                         style += " font-medium";
25 |                       } else if (mark.type === "italic") {
26 |                         style += " italic";
27 |                       }
28 |                     }
29 |                   }
30 |
31 |                   if (inlineContent.text) {
32 |                     return (
33 |                       <span
34 |                         key={`text-${nodeIndex}-${inlineIndex.toString()}`}
35 |                         tw={style}
36 |                       >
37 |                         {inlineContent.text}
38 |                       </span>
39 |                     );
40 |                   }
41 |                 }
42 |
43 |                 if (inlineContent.type === "hardBreak") {
44 |                   return (
45 |                     <br key={`break-${nodeIndex}-${inlineIndex.toString()}`} />
46 |                   );
47 |                 }
48 |
49 |                 return null;
50 |               })}
51 |             </p>
52 |           );
53 |         }
54 |
55 |         return null;
56 |       })}
57 |     </div>
58 |   );
59 | }
```

packages/invoice/src/templates/og/index.tsx
```
1 | import type { TemplateProps } from "../types";
2 | import { EditorContent } from "./components/editor-content";
3 | import { Header } from "./components/header";
4 | import { Logo } from "./components/logo";
5 | import { Meta } from "./components/meta";
6 |
7 | type Props = TemplateProps & {
8 |   isValidLogo: boolean;
9 |   name: string;
10 |   logoUrl: string;
11 |   status: "draft" | "overdue" | "paid" | "unpaid" | "canceled";
12 | };
13 |
14 | export function OgTemplate({
15 |   invoice_number,
16 |   issue_date,
17 |   due_date,
18 |   template,
19 |   customer_details,
20 |   from_details,
21 |   status,
22 |   name,
23 |   logoUrl,
24 |   isValidLogo,
25 | }: Props) {
26 |   return (
27 |     <div tw="h-full w-full flex flex-col bg-[#0C0C0C] font-[GeistMono] p-16 py-8">
28 |       <Header
29 |         customerName={name}
30 |         status={status}
31 |         logoUrl={logoUrl}
32 |         isValidLogo={isValidLogo}
33 |       />
34 |
35 |       <div tw="flex flex-col">
36 |         <Logo src={template.logo_url} customerName={name} />
37 |       </div>
38 |
39 |       <Meta
40 |         template={template}
41 |         invoiceNumber={invoice_number}
42 |         issueDate={issue_date}
43 |         dueDate={due_date}
44 |       />
45 |
46 |       <div tw="flex justify-between mt-10">
47 |         <div tw="flex flex-col flex-1 max-w-[50%]">
48 |           <span tw="text-[#858585] text-[22px] font-[GeistMono] mb-1">
49 |             {template.from_label}
50 |           </span>
51 |           <EditorContent content={from_details} />
52 |         </div>
53 |
54 |         <div tw="w-12" />
55 |
56 |         <div tw="flex flex-col flex-1 max-w-[50%]">
57 |           <span tw="text-[#858585] text-[22px] font-[GeistMono] mb-1">
58 |             {template.customer_label}
59 |           </span>
60 |           <EditorContent content={customer_details} />
61 |         </div>
62 |       </div>
63 |     </div>
64 |   );
65 | }
```

packages/invoice/src/templates/pdf/format.tsx
```
1 | import { Link, Text, View } from "@react-pdf/renderer";
2 | import type { Style } from "@react-pdf/types";
3 | import type { EditorDoc } from "../types";
4 |
5 | type PDFTextStyle = Style & {
6 |   fontFamily?: string;
7 |   fontStyle?: "normal" | "italic" | "oblique";
8 |   textDecoration?:
9 |     | "none"
10 |     | "underline"
11 |     | "line-through"
12 |     | "underline line-through";
13 | };
14 |
15 | export function formatEditorContent(doc?: EditorDoc): JSX.Element | null {
16 |   if (!doc || !doc.content) {
17 |     return null;
18 |   }
19 |
20 |   return (
21 |     <>
22 |       {doc.content.map((node, nodeIndex) => {
23 |         if (node.type === "paragraph") {
24 |           return (
25 |             <View
26 |               key={`paragraph-${nodeIndex.toString()}`}
27 |               style={{ alignItems: "flex-start" }}
28 |             >
29 |               <Text>
30 |                 {node.content?.map((inlineContent, inlineIndex) => {
31 |                   if (inlineContent.type === "text") {
32 |                     const style: PDFTextStyle = { fontSize: 9 };
33 |                     let href: string | undefined;
34 |                     if (inlineContent.marks) {
35 |                       for (const mark of inlineContent.marks) {
36 |                         if (mark.type === "bold") {
37 |                           style.fontFamily = "Helvetica-Bold";
38 |                         } else if (mark.type === "italic") {
39 |                           style.fontFamily = "Helvetica-Oblique";
40 |                         } else if (mark.type === "link") {
41 |                           href = mark.attrs?.href;
42 |                           style.textDecoration = "underline";
43 |                         } else if (mark.type === "strike") {
44 |                           style.textDecoration = "line-through";
45 |                         }
46 |                       }
47 |                     }
48 |
49 |                     const content = inlineContent.text || "";
50 |                     const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(content);
51 |
52 |                     if (href || isEmail) {
53 |                       const linkHref =
54 |                         href || (isEmail ? `mailto:${content}` : content);
55 |
56 |                       return (
57 |                         <Link
58 |                           key={`link-${nodeIndex.toString()}-${inlineIndex.toString()}`}
59 |                           src={linkHref}
60 |                           style={{
61 |                             ...style,
62 |                             color: "black",
63 |                             textDecoration: "underline",
64 |                           }}
65 |                         >
66 |                           {content}
67 |                         </Link>
68 |                       );
69 |                     }
70 |
71 |                     return (
72 |                       <Text
73 |                         key={`text-${nodeIndex.toString()}-${inlineIndex.toString()}`}
74 |                         style={style}
75 |                       >
76 |                         {content}
77 |                       </Text>
78 |                     );
79 |                   }
80 |
81 |                   if (inlineContent.type === "hardBreak") {
82 |                     // This is a hack to force a line break in the PDF to look like the web editor
83 |                     return (
84 |                       <Text
85 |                         key={`hard-break-${nodeIndex.toString()}-${inlineIndex.toString()}`}
86 |                         style={{ height: 12, fontSize: 12 }}
87 |                       >
88 |                         {"\n"}
89 |                       </Text>
90 |                     );
91 |                   }
92 |
93 |                   return null;
94 |                 })}
95 |               </Text>
96 |             </View>
97 |           );
98 |         }
99 |
100 |         return null;
101 |       })}
102 |     </>
103 |   );
104 | }
```

packages/invoice/src/templates/pdf/index.tsx
```
1 | import { Document, Image, Page, Text, View } from "@react-pdf/renderer";
2 | import QRCodeUtil from "qrcode";
3 | import type { TemplateProps } from "../types";
4 | import { EditorContent } from "./components/editor-content";
5 | import { LineItems } from "./components/line-items";
6 | import { Meta } from "./components/meta";
7 | import { Note } from "./components/note";
8 | import { PaymentDetails } from "./components/payment-details";
9 | import { QRCode } from "./components/qr-code";
10 | import { Summary } from "./components/summary";
11 |
12 | export async function PdfTemplate({
13 |   invoice_number,
14 |   issue_date,
15 |   due_date,
16 |   template,
17 |   line_items,
18 |   customer_details,
19 |   from_details,
20 |   discount,
21 |   payment_details,
22 |   note_details,
23 |   currency,
24 |   vat,
25 |   tax,
26 |   amount,
27 |   subtotal,
28 |   top_block,
29 |   bottom_block,
30 |   size = "a4",
31 |   token,
32 | }: TemplateProps) {
33 |   let qrCode = null;
34 |
35 |   if (template.include_qr) {
36 |     qrCode = await QRCodeUtil.toDataURL(`https://app.midday.ai/i/${token}`, {
37 |       width: 40 * 3,
38 |       height: 40 * 3,
39 |       margin: 0,
40 |     });
41 |   }
42 |
43 |   return (
44 |     <Document>
45 |       <Page
46 |         wrap
47 |         size={size.toUpperCase() as "LETTER" | "A4"}
48 |         style={{
49 |           padding: 20,
50 |           backgroundColor: "#fff",
51 |           color: "#000",
52 |           fontFamily: "Helvetica",
53 |         }}
54 |       >
55 |         <View
56 |           style={{
57 |             marginBottom: 20,
58 |             flexDirection: "row",
59 |             justifyContent: "space-between",
60 |           }}
61 |         >
62 |           <Meta
63 |             invoiceNoLabel={template.invoice_no_label}
64 |             issueDateLabel={template.issue_date_label}
65 |             dueDateLabel={template.due_date_label}
66 |             invoiceNo={invoice_number}
67 |             issueDate={issue_date}
68 |             dueDate={due_date}
69 |             timezone={template.timezone}
70 |             dateFormat={template.date_format}
71 |             title={template.title}
72 |           />
73 |
74 |           {template?.logo_url && (
75 |             <Image
76 |               src={template.logo_url}
77 |               style={{
78 |                 height: 75,
79 |                 objectFit: "contain",
80 |               }}
81 |             />
82 |           )}
83 |         </View>
84 |
85 |         <View style={{ flexDirection: "row", marginTop: 20 }}>
86 |           <View style={{ flex: 1, marginRight: 10 }}>
87 |             <View style={{ marginBottom: 20 }}>
88 |               <Text style={{ fontSize: 9, fontWeight: 500 }}>
89 |                 {template.from_label}
90 |               </Text>
91 |               <EditorContent content={from_details} />
92 |             </View>
93 |           </View>
94 |
95 |           <View style={{ flex: 1, marginLeft: 10 }}>
96 |             <View style={{ marginBottom: 20 }}>
97 |               <Text style={{ fontSize: 9, fontWeight: 500 }}>
98 |                 {template.customer_label}
99 |               </Text>
100 |               <EditorContent content={customer_details} />
101 |             </View>
102 |           </View>
103 |         </View>
104 |
105 |         <EditorContent content={top_block} />
106 |
107 |         <LineItems
108 |           lineItems={line_items}
109 |           currency={currency}
110 |           descriptionLabel={template.description_label}
111 |           quantityLabel={template.quantity_label}
112 |           priceLabel={template.price_label}
113 |           totalLabel={template.total_label}
114 |           locale={template.locale}
115 |           includeDecimals={template.include_decimals}
116 |           includeUnits={template.include_units}
117 |         />
118 |
119 |         <View
120 |           style={{
121 |             flex: 1,
122 |             flexDirection: "column",
123 |             justifyContent: "flex-end",
124 |           }}
125 |         >
126 |           <Summary
127 |             amount={amount}
128 |             tax={tax}
129 |             vat={vat}
130 |             currency={currency}
131 |             totalLabel={template.total_summary_label}
132 |             taxLabel={template.tax_label}
133 |             vatLabel={template.vat_label}
134 |             taxRate={template.tax_rate}
135 |             vatRate={template.vat_rate}
136 |             locale={template.locale}
137 |             discount={discount}
138 |             discountLabel={template.discount_label}
139 |             includeDiscount={template.include_discount}
140 |             includeVAT={template.include_vat}
141 |             includeTax={template.include_tax}
142 |             includeDecimals={template.include_decimals}
143 |             subtotalLabel={template.subtotal_label}
144 |             subtotal={subtotal}
145 |           />
146 |
147 |           <View style={{ flexDirection: "row", marginTop: 20 }}>
148 |             <View style={{ flex: 1, marginRight: 10 }}>
149 |               <PaymentDetails
150 |                 content={payment_details}
151 |                 paymentLabel={template.payment_label}
152 |               />
153 |
154 |               {qrCode && <QRCode data={qrCode} />}
155 |             </View>
156 |
157 |             <View style={{ flex: 1, marginLeft: 10 }}>
158 |               <Note content={note_details} noteLabel={template.note_label} />
159 |             </View>
160 |           </View>
161 |
162 |           <EditorContent content={bottom_block} />
163 |         </View>
164 |       </Page>
165 |     </Document>
166 |   );
167 | }
```

packages/ui/src/components/editor/index.tsx
```
1 | "use client";
2 |
3 | import "./styles.css";
4 |
5 | import {
6 |   EditorContent,
7 |   type Editor as EditorInstance,
8 |   type JSONContent,
9 |   useEditor,
10 | } from "@tiptap/react";
11 | import { BubbleMenu } from "./extentions/bubble-menu";
12 | import { registerExtensions } from "./extentions/register";
13 |
14 | type EditorProps = {
15 |   initialContent?: JSONContent | string;
16 |   placeholder?: string;
17 |   onUpdate?: (editor: EditorInstance) => void;
18 |   onBlur?: () => void;
19 |   onFocus?: () => void;
20 |   className?: string;
21 |   tabIndex?: number;
22 | };
23 |
24 | export function Editor({
25 |   initialContent,
26 |   placeholder,
27 |   onUpdate,
28 |   onBlur,
29 |   onFocus,
30 |   className,
31 |   tabIndex,
32 | }: EditorProps) {
33 |   const editor = useEditor({
34 |     extensions: registerExtensions({ placeholder }),
35 |     content: initialContent,
36 |     immediatelyRender: false,
37 |     onBlur,
38 |     onFocus,
39 |     onUpdate: ({ editor }) => {
40 |       onUpdate?.(editor);
41 |     },
42 |   });
43 |
44 |   if (!editor) return null;
45 |
46 |   return (
47 |     <>
48 |       <EditorContent
49 |         editor={editor}
50 |         className={className}
51 |         tabIndex={tabIndex}
52 |       />
53 |       <BubbleMenu editor={editor} />
54 |     </>
55 |   );
56 | }
```

packages/ui/src/components/editor/styles.css
```
1 | .ProseMirror-focused {
2 |   @apply outline-none;
3 | }
4 |
5 | .tiptap {
6 |   @apply font-mono text-xs leading-loose;
7 | }
8 |
9 | .tiptap h2 {
10 |   @apply text-2xl;
11 |   @apply font-sans;
12 |   margin-bottom: 1.5rem;
13 | }
14 |
15 | .tiptap a {
16 |   @apply underline;
17 | }
18 |
19 | .tiptap .bubble-menu {
20 |   @apply flex gap-2;
21 | }
22 |
23 | .tiptap p.is-empty::before {
24 |   color: #404040;
25 |   content: attr(data-placeholder);
26 |   float: left;
27 |   height: 0;
28 |   pointer-events: none;
29 | }
```

packages/ui/src/components/editor/utils.ts
```
1 | export function isValidUrlFormat(urlString: string) {
2 |   try {
3 |     new URL(urlString);
4 |     return true;
5 |   } catch (_error) {
6 |     return false;
7 |   }
8 | }
9 |
10 | export function formatUrlWithProtocol(rawUrlString: string) {
11 |   if (isValidUrlFormat(rawUrlString)) return rawUrlString;
12 |   try {
13 |     if (rawUrlString.includes(".") && !rawUrlString.includes(" ")) {
14 |       return new URL(`https://${rawUrlString}`).toString();
15 |     }
16 |   } catch (_error) {
17 |     return null;
18 |   }
19 | }
```

apps/dashboard/jobs/tasks/bank/notifications/disconnected.tsx
```
1 | import { resend } from "@/utils/resend";
2 | import ConnectionIssueEmail from "@midday/email/emails/connection-issue";
3 | import { render } from "@react-email/components";
4 | import { schemaTask } from "@trigger.dev/sdk/v3";
5 | import { z } from "zod";
6 |
7 | export const disconnectedNotifications = schemaTask({
8 |   id: "disconnected-notifications",
9 |   maxDuration: 300,
10 |   queue: {
11 |     concurrencyLimit: 1,
12 |   },
13 |   schema: z.object({
14 |     users: z.array(
15 |       z.object({
16 |         bankName: z.string(),
17 |         teamName: z.string(),
18 |         user: z.object({
19 |           id: z.string(),
20 |           email: z.string(),
21 |           full_name: z.string(),
22 |           locale: z.string(),
23 |         }),
24 |       }),
25 |     ),
26 |   }),
27 |   run: async ({ users }) => {
28 |     const emailPromises = users.map(async ({ user, bankName, teamName }) => {
29 |       const html = await render(
30 |         <ConnectionIssueEmail
31 |           fullName={user.full_name}
32 |           bankName={bankName}
33 |           teamName={teamName}
34 |         />,
35 |       );
36 |
37 |       return {
38 |         from: "Middaybot <middaybot@midday.ai>",
39 |         to: [user.email],
40 |         subject: "Bank Connection Expiring Soon",
41 |         html,
42 |       };
43 |     });
44 |
45 |     const emails = await Promise.all(emailPromises);
46 |
47 |     await resend.batch.send(emails);
48 |   },
49 | });
```

apps/dashboard/jobs/tasks/bank/notifications/expiring.tsx
```
1 | import { resend } from "@/utils/resend";
2 | import ConnectionExpireEmail from "@midday/email/emails/connection-expire";
3 | import { render } from "@react-email/components";
4 | import { schemaTask } from "@trigger.dev/sdk/v3";
5 | import { z } from "zod";
6 |
7 | export const expiringNotifications = schemaTask({
8 |   id: "expiring-notifications",
9 |   maxDuration: 300,
10 |   queue: {
11 |     concurrencyLimit: 1,
12 |   },
13 |   schema: z.object({
14 |     users: z.array(
15 |       z.object({
16 |         bankName: z.string(),
17 |         teamName: z.string(),
18 |         expiresAt: z.string(),
19 |         user: z.object({
20 |           id: z.string(),
21 |           email: z.string(),
22 |           full_name: z.string(),
23 |           locale: z.string(),
24 |         }),
25 |       }),
26 |     ),
27 |   }),
28 |   run: async ({ users }) => {
29 |     const emailPromises = users.map(
30 |       async ({ user, bankName, teamName, expiresAt }) => {
31 |         const html = await render(
32 |           <ConnectionExpireEmail
33 |             fullName={user.full_name}
34 |             bankName={bankName}
35 |             teamName={teamName}
36 |             expiresAt={expiresAt}
37 |           />,
38 |         );
39 |
40 |         return {
41 |           from: "Middaybot <middaybot@midday.ai>",
42 |           to: [user.email],
43 |           subject: "Bank Connection Expiring Soon",
44 |           html,
45 |         };
46 |       },
47 |     );
48 |
49 |     const emails = await Promise.all(emailPromises);
50 |
51 |     await resend.batch.send(emails);
52 |   },
53 | });
```

apps/dashboard/jobs/tasks/bank/notifications/transactions.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
3 | import {
4 |   handleTransactionEmails,
5 |   handleTransactionSlackNotifications,
6 | } from "jobs/utils/transaction-notifications";
7 | import { handleTransactionNotifications } from "jobs/utils/transaction-notifications";
8 | import { z } from "zod";
9 |
10 | export const transactionNotifications = schemaTask({
11 |   id: "transaction-notifications",
12 |   maxDuration: 300,
13 |   schema: z.object({
14 |     teamId: z.string(),
15 |   }),
16 |   run: async ({ teamId }) => {
17 |     const supabase = createClient();
18 |
19 |     try {
20 |       // Mark all transactions as notified and get the ones that need to be notified about
21 |       const { data: transactionsData } = await supabase
22 |         .from("transactions")
23 |         .update({ notified: true })
24 |         .eq("team_id", teamId)
25 |         .eq("notified", false)
26 |         .select("id, date, amount, name, currency, category, status")
27 |         .order("date", { ascending: false })
28 |         .throwOnError();
29 |
30 |       const { data: usersData } = await supabase
31 |         .from("users_on_team")
32 |         .select(
33 |           "id, team_id, team:teams(inbox_id, name), user:users(id, full_name, avatar_url, email, locale)",
34 |         )
35 |         .eq("team_id", teamId)
36 |         .eq("role", "owner")
37 |         .throwOnError();
38 |
39 |       const sortedTransactions = transactionsData?.sort((a, b) => {
40 |         return new Date(b.date).getTime() - new Date(a.date).getTime();
41 |       });
42 |
43 |       if (sortedTransactions && sortedTransactions.length > 0) {
44 |         await handleTransactionNotifications(usersData, sortedTransactions);
45 |         await handleTransactionEmails(usersData, sortedTransactions);
46 |         await handleTransactionSlackNotifications(teamId, sortedTransactions);
47 |       }
48 |     } catch (error) {
49 |       await logger.error("Transactions notification", { error });
50 |
51 |       throw error;
52 |     }
53 |   },
54 | });
```

apps/dashboard/jobs/tasks/bank/scheduler/bank-scheduler.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger, schedules } from "@trigger.dev/sdk/v3";
3 | import { syncConnection } from "../sync/connection";
4 |
5 | // This is a fan-out pattern. We want to trigger a job for each bank connection
6 | // Then in sync connection we check if the connection is connected and if not we update the status (Connected, Disconnected)
7 | export const bankSyncScheduler = schedules.task({
8 |   id: "bank-sync-scheduler",
9 |   maxDuration: 600,
10 |   run: async (payload) => {
11 |     // Only run in production (Set in Trigger.dev)
12 |     if (process.env.TRIGGER_ENVIRONMENT !== "production") return;
13 |
14 |     const supabase = createClient();
15 |
16 |     const teamId = payload.externalId;
17 |
18 |     if (!teamId) {
19 |       throw new Error("teamId is required");
20 |     }
21 |
22 |     try {
23 |       const { data: bankConnections } = await supabase
24 |         .from("bank_connections")
25 |         .select("id")
26 |         .eq("team_id", teamId)
27 |         .throwOnError();
28 |
29 |       const formattedConnections = bankConnections?.map((connection) => ({
30 |         payload: {
31 |           connectionId: connection.id,
32 |         },
33 |         tags: ["team_id", teamId],
34 |       }));
35 |
36 |       // If there are no bank connections to sync, return
37 |       if (!formattedConnections?.length) {
38 |         logger.info("No bank connections to sync");
39 |         return;
40 |       }
41 |
42 |       await syncConnection.batchTrigger(formattedConnections);
43 |     } catch (error) {
44 |       logger.error("Failed to sync bank connections", { error });
45 |
46 |       throw error;
47 |     }
48 |   },
49 | });
```

apps/dashboard/jobs/tasks/bank/scheduler/disconnected-scheduler.ts
```
1 | import { createClient } from "@midday/supabase/server";
2 | import { logger, schedules } from "@trigger.dev/sdk/v3";
3 | import { disconnectedNotifications } from "../notifications/disconnected";
4 |
5 | const BATCH_SIZE = 50;
6 |
7 | export const disconnectedScheduler = schedules.task({
8 |   id: "disconnected-scheduler",
9 |   // Every Monday at 2:30pm
10 |   cron: "30 14 * * 1",
11 |   run: async () => {
12 |     // Only run in production (Set in Trigger.dev)
13 |     if (process.env.TRIGGER_ENVIRONMENT !== "production") return;
14 |
15 |     // TODO: Enable soon
16 |     return null;
17 |
18 |     const supabase = createClient();
19 |
20 |     const { data: bankConnections } = await supabase
21 |       .from("bank_connections")
22 |       .select("name, team:team_id(id, name)")
23 |       .eq("status", "disconnected");
24 |
25 |     const usersPromises =
26 |       bankConnections?.map(async ({ team, name }) => {
27 |         const { data: users } = await supabase
28 |           .from("users_on_team")
29 |           .select("user:user_id(id, email, full_name, locale)")
30 |           .eq("team_id", team.id)
31 |           .eq("role", "owner");
32 |
33 |         return users?.map((user) => ({
34 |           ...user,
35 |           bankName: name,
36 |           teamName: team.name,
37 |         }));
38 |       }) ?? [];
39 |
40 |     const users = (await Promise.all(usersPromises)).flat();
41 |
42 |     if (users.length === 0) {
43 |       logger.info("No disconnected banks found");
44 |       return;
45 |     }
46 |
47 |     for (let i = 0; i < users.length; i += BATCH_SIZE) {
48 |       const userBatch = users.slice(i, i + BATCH_SIZE);
49 |       await disconnectedNotifications.triggerAndWait({
50 |         users: userBatch,
51 |       });
52 |     }
53 |   },
54 | });
```

apps/dashboard/jobs/tasks/bank/scheduler/expiring-scheduler.ts
```
1 | import { createClient } from "@midday/supabase/server";
2 | import { logger, schedules } from "@trigger.dev/sdk/v3";
3 | import { addDays } from "date-fns";
4 | import { expiringNotifications } from "../notifications/expiring";
5 |
6 | const BATCH_SIZE = 50;
7 |
8 | export const expiringScheduler = schedules.task({
9 |   id: "expiring-scheduler",
10 |   // Every Monday at 3:30pm
11 |   cron: "30 15 * * 1",
12 |   run: async () => {
13 |     // Only run in production (Set in Trigger.dev)
14 |     if (process.env.TRIGGER_ENVIRONMENT !== "production") return;
15 |
16 |     // TODO: Enable soon
17 |     return null;
18 |
19 |     const supabase = createClient();
20 |
21 |     const { data: bankConnections } = await supabase
22 |       .from("bank_connections")
23 |       .select("id, team:team_id(id, name), name, expires_at")
24 |       .eq("status", "connected")
25 |       .lte("expires_at", addDays(new Date(), 15).toISOString())
26 |       .gt("expires_at", new Date().toISOString());
27 |
28 |     const usersPromises =
29 |       bankConnections?.map(async ({ team, name, expires_at }) => {
30 |         const { data: users } = await supabase
31 |           .from("users_on_team")
32 |           .select("user:user_id(id, email, full_name, locale)")
33 |           .eq("team_id", team.id)
34 |           .eq("role", "owner");
35 |
36 |         return users?.map((user) => ({
37 |           ...user,
38 |           bankName: name,
39 |           teamName: team.name,
40 |           expiresAt: expires_at,
41 |         }));
42 |       }) ?? [];
43 |
44 |     const users = (await Promise.all(usersPromises)).flat();
45 |
46 |     if (users.length === 0) {
47 |       logger.info("No expiring banks found");
48 |       return;
49 |     }
50 |
51 |     for (let i = 0; i < users.length; i += BATCH_SIZE) {
52 |       const userBatch = users.slice(i, i + BATCH_SIZE);
53 |       await expiringNotifications.triggerAndWait({
54 |         users: userBatch,
55 |       });
56 |     }
57 |   },
58 | });
```

apps/dashboard/jobs/tasks/bank/setup/initial.ts
```
1 | import { schedules, schemaTask } from "@trigger.dev/sdk/v3";
2 | import { generateCronTag } from "jobs/utils/generate-cron-tag";
3 | import { z } from "zod";
4 | import { bankSyncScheduler } from "../scheduler/bank-scheduler";
5 | import { syncConnection } from "../sync/connection";
6 |
7 | // This task sets up the bank sync for a new team on a daily schedule and
8 | // runs the initial sync for transactions and balance
9 | export const initialBankSetup = schemaTask({
10 |   id: "initial-bank-setup",
11 |   schema: z.object({
12 |     teamId: z.string().uuid(),
13 |     connectionId: z.string().uuid(),
14 |   }),
15 |   maxDuration: 300,
16 |   queue: {
17 |     concurrencyLimit: 50,
18 |   },
19 |   run: async (payload) => {
20 |     const { teamId, connectionId } = payload;
21 |
22 |     // Schedule the bank sync task to run daily at a random time to distribute load
23 |     // Use a deduplication key to prevent duplicate schedules for the same team
24 |     // Add teamId as externalId to use it in the bankSyncScheduler task
25 |     await schedules.create({
26 |       task: bankSyncScheduler.id,
27 |       cron: generateCronTag(teamId),
28 |       timezone: "UTC",
29 |       externalId: teamId,
30 |       deduplicationKey: `${teamId}-${bankSyncScheduler.id}`,
31 |     });
32 |
33 |     // Run initial sync for transactions and balance for the connection
34 |     await syncConnection.triggerAndWait({
35 |       connectionId,
36 |       manualSync: true,
37 |     });
38 |
39 |     // And run once more to ensure all transactions are fetched on the providers side
40 |     // GoCardLess, Teller and Plaid can take up to 3 minutes to fetch all transactions
41 |     // For Teller and Plaid we also listen on the webhook to fetch any new transactions
42 |     await syncConnection.trigger(
43 |       {
44 |         connectionId,
45 |         manualSync: true,
46 |       },
47 |       {
48 |         delay: "5m",
49 |       },
50 |     );
51 |   },
52 | });
```

apps/dashboard/jobs/tasks/bank/sync/account.ts
```
1 | import { client } from "@midday/engine/client";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { parseAPIError } from "jobs/utils/parse-error";
5 | import { getClassification } from "jobs/utils/transform";
6 | import { z } from "zod";
7 | import { upsertTransactions } from "../transactions/upsert";
8 |
9 | const BATCH_SIZE = 500;
10 |
11 | export const syncAccount = schemaTask({
12 |   id: "sync-account",
13 |   maxDuration: 300,
14 |   retry: {
15 |     maxAttempts: 2,
16 |   },
17 |   schema: z.object({
18 |     id: z.string().uuid(),
19 |     teamId: z.string(),
20 |     accountId: z.string(),
21 |     accessToken: z.string().optional(),
22 |     errorRetries: z.number().optional(),
23 |     provider: z.enum(["gocardless", "plaid", "teller"]),
24 |     manualSync: z.boolean().optional(),
25 |     accountType: z.enum([
26 |       "credit",
27 |       "other_asset",
28 |       "other_liability",
29 |       "depository",
30 |       "loan",
31 |     ]),
32 |   }),
33 |   run: async ({
34 |     id,
35 |     teamId,
36 |     accountId,
37 |     accountType,
38 |     accessToken,
39 |     errorRetries,
40 |     provider,
41 |     manualSync,
42 |   }) => {
43 |     const supabase = createClient();
44 |     const classification = getClassification(accountType);
45 |
46 |     // Get the balance
47 |     try {
48 |       const balanceResponse = await client.accounts.balance.$get({
49 |         query: {
50 |           provider,
51 |           id: accountId,
52 |           accessToken,
53 |         },
54 |       });
55 |
56 |       if (!balanceResponse.ok) {
57 |         throw new Error("Failed to get balance");
58 |       }
59 |
60 |       const { data: balanceData } = await balanceResponse.json();
61 |
62 |       // Only update the balance if it's greater than 0
63 |       const balance = balanceData?.amount ?? undefined;
64 |
65 |       // Reset error details and retries if we successfully got the balance
66 |       await supabase
67 |         .from("bank_accounts")
68 |         .update({
69 |           balance,
70 |           error_details: null,
71 |           error_retries: null,
72 |         })
73 |         .eq("id", id);
74 |     } catch (error) {
75 |       const parsedError = parseAPIError(error);
76 |
77 |       logger.error("Failed to sync account balance", { error: parsedError });
78 |
79 |       if (parsedError.code === "disconnected") {
80 |         const retries = errorRetries ? errorRetries + 1 : 1;
81 |
82 |         // Update the account with the error details and retries
83 |         await supabase
84 |           .from("bank_accounts")
85 |           .update({
86 |             error_details: parsedError.message,
87 |             error_retries: retries,
88 |           })
89 |           .eq("id", id);
90 |
91 |         throw error;
92 |       }
93 |     }
94 |
95 |     // Get the transactions
96 |     try {
97 |       const transactionsResponse = await client.transactions.$get({
98 |         query: {
99 |           provider,
100 |           accountId,
101 |           accountType: classification,
102 |           accessToken,
103 |           // If the transactions are being synced manually, we want to get all transactions
104 |           latest: manualSync ? "false" : "true",
105 |         },
106 |       });
107 |
108 |       if (!transactionsResponse.ok) {
109 |         throw new Error("Failed to get transactions");
110 |       }
111 |
112 |       // Reset error details and retries if we successfully got the transactions
113 |       await supabase
114 |         .from("bank_accounts")
115 |         .update({
116 |           error_details: null,
117 |           error_retries: null,
118 |         })
119 |         .eq("id", id);
120 |
121 |       const { data: transactionsData } = await transactionsResponse.json();
122 |
123 |       if (!transactionsData) {
124 |         logger.info(`No transactions to upsert for account ${accountId}`);
125 |         return;
126 |       }
127 |
128 |       // Upsert transactions in batches of 500
129 |       // This is to avoid memory issues with the DB
130 |       for (let i = 0; i < transactionsData.length; i += BATCH_SIZE) {
131 |         const transactionBatch = transactionsData.slice(i, i + BATCH_SIZE);
132 |         await upsertTransactions.trigger({
133 |           transactions: transactionBatch,
134 |           teamId,
135 |           bankAccountId: id,
136 |           manualSync,
137 |         });
138 |       }
139 |     } catch (error) {
140 |       logger.error("Failed to sync transactions", { error });
141 |
142 |       throw error;
143 |     }
144 |   },
145 | });
```

apps/dashboard/jobs/tasks/bank/sync/connection.ts
```
1 | import { client } from "@midday/engine/client";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { revalidateCache } from "jobs/utils/revalidate-cache";
5 | import { triggerSequenceAndWait } from "jobs/utils/trigger-sequence";
6 | import { z } from "zod";
7 | import { transactionNotifications } from "../notifications/transactions";
8 | import { syncAccount } from "./account";
9 |
10 | // Fan-out pattern. We want to trigger a task for each bank account (Transactions, Balance)
11 | export const syncConnection = schemaTask({
12 |   id: "sync-connection",
13 |   maxDuration: 1000,
14 |   retry: {
15 |     maxAttempts: 2,
16 |   },
17 |   schema: z.object({
18 |     connectionId: z.string().uuid(),
19 |     manualSync: z.boolean().optional(),
20 |   }),
21 |   run: async ({ connectionId, manualSync }, { ctx }) => {
22 |     const supabase = createClient();
23 |
24 |     try {
25 |       const { data } = await supabase
26 |         .from("bank_connections")
27 |         .select("provider, access_token, reference_id, team_id")
28 |         .eq("id", connectionId)
29 |         .single()
30 |         .throwOnError();
31 |
32 |       if (!data) {
33 |         logger.error("Connection not found");
34 |         throw new Error("Connection not found");
35 |       }
36 |
37 |       const connectionResponse = await client.connections.status.$get({
38 |         query: {
39 |           id: data.reference_id,
40 |           provider: data.provider,
41 |           accessToken: data.access_token,
42 |         },
43 |       });
44 |
45 |       logger.info("Connection response", { connectionResponse });
46 |
47 |       if (!connectionResponse.ok) {
48 |         logger.error("Failed to get connection status");
49 |         throw new Error("Failed to get connection status");
50 |       }
51 |
52 |       const { data: connectionData } = await connectionResponse.json();
53 |
54 |       if (connectionData.status === "connected") {
55 |         await supabase
56 |           .from("bank_connections")
57 |           .update({
58 |             status: "connected",
59 |             last_accessed: new Date().toISOString(),
60 |           })
61 |           .eq("id", connectionId);
62 |
63 |         const query = supabase
64 |           .from("bank_accounts")
65 |           .select(
66 |             "id, team_id, account_id, type, bank_connection:bank_connection_id(id, provider, access_token, status)",
67 |           )
68 |           .eq("bank_connection_id", connectionId)
69 |           .eq("enabled", true)
70 |           .eq("manual", false);
71 |
72 |         // Skip accounts with more than 3 error retries during background sync
73 |         // Allow all accounts during manual sync to clear errors after reconnect
74 |         if (!manualSync) {
75 |           query.or("error_retries.lt.4,error_retries.is.null");
76 |         }
77 |
78 |         const { data: bankAccountsData } = await query.throwOnError();
79 |
80 |         if (!bankAccountsData) {
81 |           logger.info("No bank accounts found");
82 |           return;
83 |         }
84 |
85 |         const bankAccounts = bankAccountsData.map((account) => ({
86 |           id: account.id,
87 |           accountId: account.account_id,
88 |           accessToken: account.bank_connection?.access_token ?? undefined,
89 |           provider: account.bank_connection?.provider,
90 |           connectionId: account.bank_connection?.id,
91 |           teamId: account.team_id,
92 |           accountType: account.type ?? "depository",
93 |           manualSync,
94 |         }));
95 |
96 |         // Only run the sync if there are bank accounts enabled
97 |         // We don't want to delay the sync if it's a manual sync
98 |         // but we do want to delay it if it's an background sync to avoid rate limiting
99 |         if (bankAccounts.length > 0) {
100 |           await triggerSequenceAndWait(bankAccounts, syncAccount, {
101 |             tags: ctx.run.tags,
102 |             delayMinutes: manualSync ? 0 : 1,
103 |           });
104 |         }
105 |
106 |         logger.info("Synced bank accounts completed");
107 |
108 |         // Trigger a notification for new transactions if it's an background sync
109 |         // We delay it by 1 minutes to allow for more transactions to be notified
110 |         if (!manualSync) {
111 |           await transactionNotifications.trigger(
112 |             { teamId: data.team_id },
113 |             { delay: "1m" },
114 |           );
115 |         }
116 |
117 |         // Check connection status by accounts
118 |         // If all accounts have 3+ error retries, disconnect the connection
119 |         // So the user will get a notification and can reconnect the bank
120 |         try {
121 |           const { data: bankAccountsData } = await supabase
122 |             .from("bank_accounts")
123 |             .select("id, error_retries")
124 |             .eq("bank_connection_id", connectionId)
125 |             .eq("manual", false)
126 |             .eq("enabled", true)
127 |             .throwOnError();
128 |
129 |           if (
130 |             bankAccountsData?.every(
131 |               (account) => (account.error_retries ?? 0) >= 3,
132 |             )
133 |           ) {
134 |             logger.info(
135 |               "All bank accounts have 3+ error retries, disconnecting connection",
136 |             );
137 |
138 |             await supabase
139 |               .from("bank_connections")
140 |               .update({ status: "disconnected" })
141 |               .eq("id", connectionId);
142 |           }
143 |         } catch (error) {
144 |           logger.error("Failed to check connection status by accounts", {
145 |             error,
146 |           });
147 |         }
148 |
[TRUNCATED]
```

apps/dashboard/jobs/tasks/bank/transactions/upsert.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
3 | import { transformTransaction } from "jobs/utils/transform";
4 | import { z } from "zod";
5 |
6 | const transactionSchema = z.object({
7 |   id: z.string(),
8 |   description: z.string().nullable(),
9 |   method: z.string().nullable(),
10 |   date: z.string(),
11 |   name: z.string(),
12 |   status: z.enum(["pending", "posted"]),
13 |   balance: z.number().nullable(),
14 |   currency: z.string(),
15 |   amount: z.number(),
16 |   category: z.string().nullable(),
17 | });
18 |
19 | export const upsertTransactions = schemaTask({
20 |   id: "upsert-transactions",
21 |   maxDuration: 300,
22 |   queue: {
23 |     concurrencyLimit: 10,
24 |   },
25 |   schema: z.object({
26 |     teamId: z.string().uuid(),
27 |     bankAccountId: z.string().uuid(),
28 |     manualSync: z.boolean().optional(),
29 |     transactions: z.array(transactionSchema),
30 |   }),
31 |   run: async ({ transactions, teamId, bankAccountId, manualSync }) => {
32 |     const supabase = createClient();
33 |
34 |     try {
35 |       // Transform transactions to match our DB schema
36 |       const formattedTransactions = transactions.map((transaction) => {
37 |         return transformTransaction({
38 |           transaction,
39 |           teamId,
40 |           bankAccountId,
41 |           notified: manualSync,
42 |         });
43 |       });
44 |
45 |       // Upsert transactions into the transactions table, skipping duplicates based on internal_id
46 |       await supabase
47 |         .from("transactions")
48 |         .upsert(formattedTransactions, {
49 |           onConflict: "internal_id",
50 |           ignoreDuplicates: true,
51 |         })
52 |         .throwOnError();
53 |     } catch (error) {
54 |       logger.error("Failed to upsert transactions", { error });
55 |
56 |       throw error;
57 |     }
58 |   },
59 | });
```

apps/dashboard/jobs/tasks/invoice/email/send-email.tsx
```
1 | import { resend } from "@/utils/resend";
2 | import InvoiceEmail from "@midday/email/emails/invoice";
3 | import { createClient } from "@midday/supabase/job";
4 | import { getAppUrl } from "@midday/utils/envs";
5 | import { render } from "@react-email/render";
6 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
7 | import { nanoid } from "nanoid";
8 | import { z } from "zod";
9 |
10 | export const sendInvoiceEmail = schemaTask({
11 |   id: "send-invoice-email",
12 |   schema: z.object({
13 |     invoiceId: z.string().uuid(),
14 |   }),
15 |   maxDuration: 300,
16 |   queue: {
17 |     concurrencyLimit: 10,
18 |   },
19 |   run: async ({ invoiceId }) => {
20 |     const supabase = createClient();
21 |
22 |     const { data: invoice } = await supabase
23 |       .from("invoices")
24 |       .select(
25 |         "id, token, customer:customer_id(name, website, email), team:team_id(name, email)",
26 |       )
27 |       .eq("id", invoiceId)
28 |       .single();
29 |
30 |     if (!invoice) {
31 |       logger.error("Invoice not found");
32 |       return;
33 |     }
34 |
35 |     const customerEmail = invoice?.customer?.email;
36 |
37 |     if (!customerEmail) {
38 |       logger.error("Invoice customer email not found");
39 |       return;
40 |     }
41 |
42 |     const response = await resend.emails.send({
43 |       from: "Midday <middaybot@midday.ai>",
44 |       to: customerEmail,
45 |       replyTo: invoice?.team.email ?? undefined,
46 |       subject: `${invoice?.team.name} sent you an invoice`,
47 |       headers: {
48 |         "X-Entity-Ref-ID": nanoid(),
49 |       },
50 |       html: await render(
51 |         <InvoiceEmail
52 |           customerName={invoice?.customer.name}
53 |           teamName={invoice?.team.name}
54 |           link={`${getAppUrl()}/i/${invoice?.token}`}
55 |         />,
56 |       ),
57 |     });
58 |
59 |     if (response.error) {
60 |       logger.error("Invoice email failed to send", {
61 |         invoiceId,
62 |         error: response.error,
63 |       });
64 |
65 |       throw new Error("Invoice email failed to send");
66 |     }
67 |
68 |     logger.info("Invoice email sent");
69 |
70 |     await supabase
71 |       .from("invoices")
72 |       .update({
73 |         status: "unpaid",
74 |         sent_to: customerEmail,
75 |       })
76 |       .eq("id", invoiceId);
77 |   },
78 | });
```

apps/dashboard/jobs/tasks/invoice/notifications/send-notifications.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { schemaTask } from "@trigger.dev/sdk/v3";
3 | import {
4 |   handleOverdueInvoiceNotifications,
5 |   handlePaidInvoiceNotifications,
6 | } from "jobs/utils/invoice-notifications";
7 | import { z } from "zod";
8 |
9 | export const sendInvoiceNotifications = schemaTask({
10 |   id: "invoice-notifications",
11 |   schema: z.object({
12 |     invoiceId: z.string().uuid(),
13 |     invoiceNumber: z.string(),
14 |     status: z.enum(["paid", "overdue"]),
15 |     teamId: z.string(),
16 |     customerName: z.string(),
17 |   }),
18 |   run: async ({ invoiceId, invoiceNumber, status, teamId, customerName }) => {
19 |     const supabase = createClient();
20 |
21 |     const { data: user } = await supabase
22 |       .from("users_on_team")
23 |       .select(
24 |         "id, team_id, user:users(id, full_name, avatar_url, email, locale)",
25 |       )
26 |       .eq("team_id", teamId)
27 |       .eq("role", "owner");
28 |
29 |     switch (status) {
30 |       case "paid":
31 |         await handlePaidInvoiceNotifications({
32 |           user,
33 |           invoiceId,
34 |           invoiceNumber,
35 |         });
36 |         break;
37 |       case "overdue":
38 |         await handleOverdueInvoiceNotifications({
39 |           user,
40 |           invoiceId,
41 |           invoiceNumber,
42 |           customerName,
43 |         });
44 |         break;
45 |     }
46 |   },
47 | });
```

apps/dashboard/jobs/tasks/invoice/operations/check-status.ts
```
1 | import { TZDate } from "@date-fns/tz";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { subDays } from "date-fns";
5 | import { updateInvoiceStatus } from "jobs/utils/update-invocie";
6 | import { z } from "zod";
7 |
8 | export const checkInvoiceStatus = schemaTask({
9 |   id: "check-invoice-status",
10 |   schema: z.object({
11 |     invoiceId: z.string().uuid(),
12 |   }),
13 |   queue: {
14 |     concurrencyLimit: 10,
15 |   },
16 |   run: async ({ invoiceId }) => {
17 |     const supabase = createClient();
18 |
19 |     const { data: invoice } = await supabase
20 |       .from("invoices")
21 |       .select(
22 |         "id, status, due_date, currency, amount, team_id, file_path, invoice_number, file_size, template",
23 |       )
24 |       .eq("id", invoiceId)
25 |       .single();
26 |
27 |     if (!invoice) {
28 |       logger.error("Invoice data is missing");
29 |       return;
30 |     }
31 |
32 |     if (!invoice.amount || !invoice.currency || !invoice.due_date) {
33 |       logger.error("Invoice data is missing");
34 |       return;
35 |     }
36 |
37 |     const timezone = invoice.template?.timezone || "UTC";
38 |
39 |     // Find recent transactions matching invoice amount, currency, and team_id
40 |     const { data: transactions } = await supabase
41 |       .from("transactions")
42 |       .select("id")
43 |       .eq("team_id", invoice.team_id)
44 |       .eq("amount", invoice.amount)
45 |       .eq("currency", invoice.currency?.toUpperCase())
46 |       .gte(
47 |         "date",
48 |         // Get the transactions from the last 3 days
49 |         subDays(new TZDate(new Date(), timezone), 3).toISOString(),
50 |       )
51 |       .eq("is_fulfilled", false);
52 |
53 |     // We have a match
54 |     if (transactions && transactions.length === 1) {
55 |       const transactionId = transactions.at(0)?.id;
56 |       const filename = `${invoice.invoice_number}.pdf`;
57 |
58 |       // Attach the invoice file to the transaction and mark as paid
59 |       await supabase
60 |         .from("transaction_attachments")
61 |         .insert({
62 |           type: "application/pdf",
63 |           path: invoice.file_path,
64 |           transaction_id: transactionId,
65 |           team_id: invoice.team_id,
66 |           name: filename,
67 |           size: invoice.file_size,
68 |         })
69 |         .select()
70 |         .single();
71 |
72 |       await updateInvoiceStatus({
73 |         invoiceId,
74 |         status: "paid",
75 |       });
76 |     } else {
77 |       // Check if the invoice is overdue
78 |       const isOverdue =
79 |         new TZDate(invoice.due_date, timezone) <
80 |         new TZDate(new Date(), timezone);
81 |
82 |       // Update invoice status to overdue if it's past due date and currently unpaid
83 |       if (isOverdue && invoice.status === "unpaid") {
84 |         await updateInvoiceStatus({
85 |           invoiceId,
86 |           status: "overdue",
87 |         });
88 |       }
89 |     }
90 |   },
91 | });
```

apps/dashboard/jobs/tasks/invoice/operations/generate-invoice.ts
```
1 | import { PdfTemplate, renderToBuffer } from "@midday/invoice";
2 | import { createClient } from "@midday/supabase/job";
3 | import { logger, schemaTask } from "@trigger.dev/sdk/v3";
4 | import { z } from "zod";
5 |
6 | export const generateInvoice = schemaTask({
7 |   id: "generate-invoice",
8 |   schema: z.object({
9 |     invoiceId: z.string().uuid(),
10 |   }),
11 |   maxDuration: 300,
12 |   queue: {
13 |     concurrencyLimit: 10,
14 |   },
15 |   run: async (payload) => {
16 |     const supabase = createClient();
17 |
18 |     const { invoiceId } = payload;
19 |
20 |     const { data: invoiceData } = await supabase
21 |       .from("invoices")
22 |       .select(
23 |         "*, team_id, customer:customer_id(name), user:user_id(timezone, locale)",
24 |       )
25 |       .eq("id", invoiceId)
26 |       .single()
27 |       .throwOnError();
28 |
29 |     const { user, ...invoice } = invoiceData;
30 |
31 |     const buffer = await renderToBuffer(await PdfTemplate(invoice));
32 |
33 |     const filename = `${invoiceData?.invoice_number}.pdf`;
34 |
35 |     await supabase.storage
36 |       .from("vault")
37 |       .upload(`${invoiceData?.team_id}/invoices/${filename}`, buffer, {
38 |         contentType: "application/pdf",
39 |         upsert: true,
40 |       });
41 |
42 |     logger.debug("PDF uploaded to storage");
43 |
44 |     await supabase
45 |       .from("invoices")
46 |       .update({
47 |         file_path: [invoiceData?.team_id, "invoices", filename],
48 |         file_size: buffer.length,
49 |       })
50 |       .eq("id", invoiceId);
51 |
52 |     logger.info("Invoice generation completed", { invoiceId, filename });
53 |   },
54 | });
```

apps/dashboard/jobs/tasks/invoice/scheduler/schedule-invoice.ts
```
1 | import { createClient } from "@midday/supabase/job";
2 | import { logger, schedules } from "@trigger.dev/sdk/v3";
3 | import { triggerBatch } from "jobs/utils/trigger-batch";
4 | import { checkInvoiceStatus } from "../operations/check-status";
5 |
6 | export const invoiceScheduler = schedules.task({
7 |   id: "invoice-scheduler",
8 |   cron: "0 0,12 * * *",
9 |   run: async () => {
10 |     // Only run in production (Set in Trigger.dev)
11 |     if (process.env.TRIGGER_ENVIRONMENT !== "production") return;
12 |
13 |     const supabase = createClient();
14 |
15 |     const { data: invoices } = await supabase
16 |       .from("invoices")
17 |       .select("id")
18 |       .in("status", ["unpaid", "overdue"]);
19 |
20 |     if (!invoices) return;
21 |
22 |     const formattedInvoices = invoices.map((invoice) => ({
23 |       invoiceId: invoice.id,
24 |     }));
25 |
26 |     await triggerBatch(formattedInvoices, checkInvoiceStatus);
27 |
28 |     logger.info("Invoice status check jobs started", {
29 |       count: invoices.length,
30 |     });
31 |   },
32 | });
```

apps/dashboard/src/actions/ai/chat/get-chats-action.ts
```
1 | "use server";
2 |
3 | import { addMonths, addWeeks, isAfter, isBefore, isToday } from "date-fns";
4 | import { getChats } from "../storage";
5 | import type { Chat } from "../types";
6 |
7 | export async function getChatsAction() {
8 |   const data = await getChats();
9 |
10 |   if (!data.length) {
11 |     return [];
12 |   }
13 |
14 |   const base: { "1d": Chat[]; "7d": Chat[]; "30d": Chat[] } = {
15 |     "1d": [],
16 |     "7d": [],
17 |     "30d": [],
18 |   };
19 |
20 |   for (const obj of data) {
21 |     const currentDate = new Date(obj.createdAt);
22 |
23 |     if (isToday(currentDate)) {
24 |       base["1d"].push(obj);
25 |     }
26 |
27 |     if (
28 |       !isToday(currentDate) &&
29 |       isBefore(currentDate, addWeeks(currentDate, 1))
30 |     ) {
31 |       base["7d"].push(obj);
32 |     }
33 |
34 |     if (
35 |       isAfter(currentDate, addWeeks(currentDate, 1)) &&
36 |       isBefore(currentDate, addMonths(currentDate, 1))
37 |     ) {
38 |       base["30d"].push(obj);
39 |     }
40 |   }
41 |
42 |   return base;
43 | }
```

apps/dashboard/src/actions/ai/chat/index.tsx
```
1 | "use server";
2 |
3 | import { BotMessage, SpinnerMessage } from "@/components/chat/messages";
4 | import { openai } from "@ai-sdk/openai";
5 | import { client as RedisClient } from "@midday/kv";
6 | import { getUser } from "@midday/supabase/cached-queries";
7 | import { Ratelimit } from "@upstash/ratelimit";
8 | import {
9 |   createAI,
10 |   createStreamableValue,
11 |   getMutableAIState,
12 |   streamUI,
13 | } from "ai/rsc";
14 | import { startOfMonth, subMonths } from "date-fns";
15 | import { nanoid } from "nanoid";
16 | import { headers } from "next/headers";
17 | import { getAssistantSettings, saveChat } from "../storage";
18 | import type { AIState, Chat, ClientMessage, UIState } from "../types";
19 | import { getBurnRateTool } from "./tools/burn-rate";
20 | import { getForecastTool } from "./tools/forecast";
21 | import { getDocumentsTool } from "./tools/get-documents";
22 | import { getInvoicesTool } from "./tools/get-invoces";
23 | import { getTransactionsTool } from "./tools/get-transactions";
24 | import { getProfitTool } from "./tools/profit";
25 | import { createReport } from "./tools/report";
26 | import { getRevenueTool } from "./tools/revenue";
27 | import { getRunwayTool } from "./tools/runway";
28 | import { getSpendingTool } from "./tools/spending";
29 |
30 | const ratelimit = new Ratelimit({
31 |   limiter: Ratelimit.fixedWindow(10, "10s"),
32 |   redis: RedisClient,
33 | });
34 |
35 | export async function submitUserMessage(
36 |   content: string,
37 | ): Promise<ClientMessage> {
38 |   "use server";
39 |   const ip = headers().get("x-forwarded-for");
40 |   const { success } = await ratelimit.limit(ip);
41 |
42 |   const aiState = getMutableAIState<typeof AI>();
43 |
44 |   if (!success) {
45 |     aiState.update({
46 |       ...aiState.get(),
47 |       messages: [
48 |         ...aiState.get().messages,
49 |         {
50 |           id: nanoid(),
51 |           role: "assistant",
52 |           content:
53 |             "Not so fast, tiger. You've reached your message limit. Please wait a minute and try again.",
54 |         },
55 |       ],
56 |     });
57 |
58 |     return {
59 |       id: nanoid(),
60 |       role: "assistant",
61 |       display: (
62 |         <BotMessage content="Not so fast, tiger. You've reached your message limit. Please wait a minute and try again." />
63 |       ),
64 |     };
65 |   }
66 |
67 |   const user = await getUser();
68 |   const teamId = user?.data?.team_id as string;
69 |
70 |   const defaultValues = {
71 |     from: subMonths(startOfMonth(new Date()), 12).toISOString(),
72 |     to: new Date().toISOString(),
73 |   };
74 |
75 |   aiState.update({
76 |     ...aiState.get(),
77 |     messages: [
78 |       ...aiState.get().messages,
79 |       {
80 |         id: nanoid(),
81 |         role: "user",
82 |         content,
83 |       },
84 |     ],
85 |   });
86 |
87 |   let textStream: undefined | ReturnType<typeof createStreamableValue<string>>;
88 |   let textNode: undefined | React.ReactNode;
89 |
90 |   const result = await streamUI({
91 |     model: openai("gpt-4o-mini"),
92 |     initial: <SpinnerMessage />,
93 |     system: `\
94 |     You are a helpful assistant in Midday who can help users ask questions about their transactions, revenue, spending find invoices and more.
95 |
96 |     If the user wants the burn rate, call \`getBurnRate\` function.
97 |     If the user wants the runway, call \`getRunway\` function.
98 |     If the user wants the profit, call \`getProfit\` function.
99 |     If the user wants to find transactions or expenses, call \`getTransactions\` function.
100 |     If the user wants to see spending based on a category, call \`getSpending\` function.
101 |     If the user wants to find invoices or receipts, call \`getInvoices\` function.
102 |     If the user wants to find documents, call \`getDocuments\` function.
103 |     Don't return markdown, just plain text.
104 |
105 |     Always try to call the functions with default values, otherwise ask the user to respond with parameters.
106 |     Current date is: ${new Date().toISOString().split("T")[0]} \n
107 |     `,
108 |     messages: [
109 |       ...aiState.get().messages.map((message: any) => ({
110 |         role: message.role,
111 |         content: message.content,
112 |         name: message.name,
113 |         display: null,
114 |       })),
115 |     ],
116 |     text: ({ content, done, delta }) => {
117 |       if (!textStream) {
118 |         textStream = createStreamableValue("");
119 |         textNode = <BotMessage content={textStream.value} />;
120 |       }
121 |
122 |       if (done) {
123 |         textStream.done();
124 |         aiState.done({
125 |           ...aiState.get(),
126 |           messages: [
127 |             ...aiState.get().messages,
128 |             {
129 |               id: nanoid(),
130 |               role: "assistant",
131 |               content,
132 |             },
133 |           ],
134 |         });
135 |       } else {
136 |         textStream.update(delta);
137 |       }
138 |
139 |       return textNode;
140 |     },
141 |     tools: {
142 |       getSpending: getSpendingTool({
143 |         aiState,
144 |         dateFrom: defaultValues.from,
145 |         dateTo: defaultValues.to,
146 |       }),
147 |       getBurnRate: getBurnRateTool({
148 |         aiState,
149 |         dateFrom: defaultValues.from,
150 |         dateTo: defaultValues.to,
151 |       }),
152 |       getRunway: getRunwayTool({
153 |         aiState,
[TRUNCATED]
```

apps/dashboard/src/actions/ai/chat/utils.tsx
```
1 | import { BotMessage, UserMessage } from "@/components/chat/messages";
2 | import type { Chat } from "../types";
3 | import { BurnRateUI } from "./tools/ui/burn-rate-ui";
4 | import { DocumentsUI } from "./tools/ui/documents-ui";
5 | import { ProfitUI } from "./tools/ui/profit-ui";
6 | import { ReportUI } from "./tools/ui/report-ui";
7 | import { RevenueUI } from "./tools/ui/revenue-ui";
8 | import { RunwayUI } from "./tools/ui/runway-ui";
9 | import { SpendingUI } from "./tools/ui/spending-ui";
10 | import { TransactionsUI } from "./tools/ui/transactions-ui";
11 |
12 | export const sleep = (ms: number) =>
13 |   new Promise((resolve) => setTimeout(resolve, ms));
14 |
15 | function getUIComponentFromMessage(message) {
16 |   if (message.role === "user") {
17 |     return <UserMessage>{message.content}</UserMessage>;
18 |   }
19 |
20 |   if (message.role === "assistant" && typeof message.content === "string") {
21 |     return <BotMessage content={message.content} />;
22 |   }
23 |
24 |   if (message.role === "tool") {
25 |     return message.content.map((tool) => {
26 |       switch (tool.toolName) {
27 |         case "getRunway": {
28 |           return <RunwayUI {...tool.result} />;
29 |         }
30 |
31 |         case "getBurnRate": {
32 |           return <BurnRateUI {...tool.result} />;
33 |         }
34 |
35 |         case "getSpending": {
36 |           return <SpendingUI {...tool.result} />;
37 |         }
38 |
39 |         case "getTransactions": {
40 |           return <TransactionsUI {...tool.result} />;
41 |         }
42 |
43 |         case "getDocuments": {
44 |           return <DocumentsUI {...tool.result} />;
45 |         }
46 |
47 |         case "createReport": {
48 |           return <ReportUI {...tool.result} />;
49 |         }
50 |
51 |         case "getProfit": {
52 |           return <ProfitUI {...tool.result} />;
53 |         }
54 |
55 |         case "getRevenue": {
56 |           return <RevenueUI {...tool.result} />;
57 |         }
58 |
59 |         default:
60 |           return null;
61 |       }
62 |     });
63 |   }
64 | }
65 |
66 | export const getUIStateFromAIState = (aiState: Chat) => {
67 |   return aiState?.messages
68 |     .filter((message) => message.role !== "system")
69 |     .map((message, index) => ({
70 |       id: `${aiState.id}-${index}`,
71 |       display: getUIComponentFromMessage(message),
72 |     }));
73 | };
```

apps/dashboard/src/actions/ai/editor/generate-editor-content.ts
```
1 | "use server";
2 |
3 | import { openai } from "@ai-sdk/openai";
4 | import { streamText } from "ai";
5 | import { createStreamableValue } from "ai/rsc";
6 |
7 | type Params = {
8 |   input: string;
9 |   context?: string;
10 | };
11 |
12 | export async function generateEditorContent({ input, context }: Params) {
13 |   const stream = createStreamableValue("");
14 |
15 |   (async () => {
16 |     const { textStream } = await streamText({
17 |       model: openai("gpt-4o-mini"),
18 |       prompt: input,
19 |       temperature: 0.8,
20 |       system: `
21 |         You are an expert AI assistant specializing in invoice-related content generation and improvement. Your task is to enhance or modify invoice text based on specific instructions. Follow these guidelines:
22 |
23 |         1. Language: Always respond in the same language as the input prompt.
24 |         2. Conciseness: Keep responses brief and precise, with a maximum of 200 characters.
25 |
26 |         You will perform one of these primary functions:
27 |         - Fix grammar: Rectify any grammatical errors while preserving the original meaning.
28 |         - Improve text: Refine the text to improve clarity and professionalism.
29 |         - Condense text: Remove any unnecessary text and only keep the invoice-related content and make it more concise.
30 |
31 |         Format your response as plain text, using '\n' for line breaks when necessary.
32 |         Do not include any titles or headings in your response.
33 |         Provide only invoice-relevant content without any extraneous information.
34 |         Begin your response directly with the relevant invoice text or information.
35 |
36 |         For custom prompts, maintain focus on invoice-related content. Ensure all generated text is appropriate for formal business communications and adheres to standard invoice practices.
37 |         Current date is: ${new Date().toISOString().split("T")[0]} \n
38 |       ${context}
39 | `,
40 |     });
41 |
42 |     for await (const delta of textStream) {
43 |       stream.update(delta);
44 |     }
45 |
46 |     stream.done();
47 |   })();
48 |
49 |   return { output: stream.value };
50 | }
```

apps/dashboard/src/actions/ai/filters/generate-invoice-filters.ts
```
1 | "use server";
2 |
3 | import { filterInvoiceSchema } from "@/actions/schema";
4 | import { openai } from "@ai-sdk/openai";
5 | import { streamObject } from "ai";
6 | import { createStreamableValue } from "ai/rsc";
7 |
8 | const VALID_FILTERS = [
9 |   "name",
10 |   "due_date",
11 |   "start",
12 |   "end",
13 |   "customers",
14 |   "statuses",
15 | ];
16 |
17 | export async function generateInvoiceFilters(prompt: string, context?: string) {
18 |   const stream = createStreamableValue();
19 |
20 |   (async () => {
21 |     const { partialObjectStream } = await streamObject({
22 |       model: openai("gpt-4o-mini"),
23 |       system: `You are a helpful assistant that generates filters for a given prompt. \n
24 |                Current date is: ${new Date().toISOString().split("T")[0]} \n
25 |                ${context}
26 |       `,
27 |       schema: filterInvoiceSchema.pick({
28 |         ...(VALID_FILTERS.reduce((acc, filter) => {
29 |           acc[filter] = true;
30 |           return acc;
31 |         }, {}) as any),
32 |       }),
33 |       prompt,
34 |       temperature: 0.7,
35 |     });
36 |
37 |     for await (const partialObject of partialObjectStream) {
38 |       stream.update(partialObject);
39 |     }
40 |
41 |     stream.done();
42 |   })();
43 |
44 |   return { object: stream.value };
45 | }
```

apps/dashboard/src/actions/ai/filters/generate-tracker-filters.ts
```
1 | "use server";
2 |
3 | import { filterTrackerSchema } from "@/actions/schema";
4 | import { openai } from "@ai-sdk/openai";
5 | import { streamObject } from "ai";
6 | import { createStreamableValue } from "ai/rsc";
7 |
8 | const VALID_FILTERS = ["name", "start", "end", "status"];
9 |
10 | export async function generateTrackerFilters(prompt: string, context?: string) {
11 |   const stream = createStreamableValue();
12 |
13 |   (async () => {
14 |     const { partialObjectStream } = await streamObject({
15 |       model: openai("gpt-4o-mini"),
16 |       system: `You are a helpful assistant that generates filters for a given prompt. \n
17 |                Current date is: ${new Date().toISOString().split("T")[0]} \n
18 |                ${context}
19 |       `,
20 |       schema: filterTrackerSchema.pick({
21 |         ...(VALID_FILTERS.reduce((acc, filter) => {
22 |           acc[filter] = true;
23 |           return acc;
24 |         }, {}) as any),
25 |       }),
26 |       prompt,
27 |       temperature: 0.7,
28 |     });
29 |
30 |     for await (const partialObject of partialObjectStream) {
31 |       stream.update(partialObject);
32 |     }
33 |
34 |     stream.done();
35 |   })();
36 |
37 |   return { object: stream.value };
38 | }
```

apps/dashboard/src/actions/ai/filters/generate-transactions-filters.ts
```
1 | "use server";
2 |
3 | import { filterTransactionsSchema } from "@/actions/schema";
4 | import { openai } from "@ai-sdk/openai";
5 | import { streamObject } from "ai";
6 | import { createStreamableValue } from "ai/rsc";
7 |
8 | const VALID_FILTERS = [
9 |   "name",
10 |   "attachments",
11 |   "categories",
12 |   "tags",
13 |   "start",
14 |   "end",
15 |   "accounts",
16 |   "assignees",
17 |   "recurring",
18 |   "amount_range",
19 | ];
20 |
21 | export async function generateTransactionsFilters(
22 |   prompt: string,
23 |   context?: string,
24 | ) {
25 |   const stream = createStreamableValue();
26 |
27 |   (async () => {
28 |     const { partialObjectStream } = await streamObject({
29 |       model: openai("gpt-4o-mini"),
30 |       system: `You are a helpful assistant that generates filters for a given prompt. \n
31 |                Current date is: ${new Date().toISOString().split("T")[0]} \n
32 |                ${context}
33 |       `,
34 |       schema: filterTransactionsSchema.pick({
35 |         ...(VALID_FILTERS.reduce((acc, filter) => {
36 |           acc[filter] = true;
37 |           return acc;
38 |         }, {}) as any),
39 |       }),
40 |       prompt,
41 |       temperature: 0.7,
42 |     });
43 |
44 |     for await (const partialObject of partialObjectStream) {
45 |       stream.update(partialObject);
46 |     }
47 |
48 |     stream.done();
49 |   })();
50 |
51 |   return { object: stream.value };
52 | }
```

apps/dashboard/src/actions/ai/filters/generate-vault-filters.ts
```
1 | "use server";
2 |
3 | import { filterVaultSchema } from "@/actions/schema";
4 | import { openai } from "@ai-sdk/openai";
5 | import { streamObject } from "ai";
6 | import { createStreamableValue } from "ai/rsc";
7 |
8 | const VALID_FILTERS = ["name", "start", "end", "owners", "tags"];
9 |
10 | export async function generateVaultFilters(prompt: string, context?: string) {
11 |   const stream = createStreamableValue();
12 |
13 |   (async () => {
14 |     const { partialObjectStream } = await streamObject({
15 |       model: openai("gpt-4o-mini"),
16 |       system: `You are a helpful assistant that generates filters for a given prompt. \n
17 |                Current date is: ${new Date().toISOString().split("T")[0]} \n
18 |                ${context}
19 |       `,
20 |       schema: filterVaultSchema.pick({
21 |         ...(VALID_FILTERS.reduce((acc, filter) => {
22 |           acc[filter] = true;
23 |           return acc;
24 |         }, {}) as any),
25 |       }),
26 |       prompt,
27 |       temperature: 0.7,
28 |     });
29 |
30 |     for await (const partialObject of partialObjectStream) {
31 |       stream.update(partialObject);
32 |     }
33 |
34 |     stream.done();
35 |   })();
36 |
37 |   return { object: stream.value };
38 | }
```

apps/dashboard/src/app/[locale]/(public)/layout.tsx
```
1 | import { UserProvider } from "@/store/user/provider";
2 |
3 | export default function Layout({ children }: { children: React.ReactNode }) {
4 |   return <UserProvider data={null}>{children}</UserProvider>;
5 | }
```

apps/dashboard/src/app/api/proxy/route.ts
```
1 | import { getSession } from "@midday/supabase/cached-queries";
2 | import { type NextRequest, NextResponse } from "next/server";
3 |
4 | export async function GET(req: NextRequest) {
5 |   const requestUrl = new URL(req.url);
6 |   const filePath = requestUrl.searchParams.get("filePath");
7 |
8 |   const {
9 |     data: { session },
10 |   } = await getSession();
11 |
12 |   if (!session) {
13 |     return new NextResponse("Unauthorized", { status: 401 });
14 |   }
15 |
16 |   return fetch(
17 |     `${process.env.NEXT_PUBLIC_SUPABASE_URL}/storage/v1/object/${filePath}`,
18 |     {
19 |       headers: {
20 |         authorization: `Bearer ${session?.access_token}`,
21 |       },
22 |     },
23 |   );
24 | }
```

apps/dashboard/src/components/modals/import-modal/context.tsx
```
1 | import { createContext, useContext } from "react";
2 | import type { Control, UseFormSetValue, UseFormWatch } from "react-hook-form";
3 | import { z } from "zod";
4 |
5 | export const mappableFields = {
6 |   date: {
7 |     label: "Date",
8 |     required: true,
9 |   },
10 |   description: {
11 |     label: "Description",
12 |     required: true,
13 |   },
14 |   amount: {
15 |     label: "Amount",
16 |     required: true,
17 |   },
18 |   balance: {
19 |     label: "Balance",
20 |     required: false,
21 |   },
22 | } as const;
23 |
24 | export const importSchema = z.object({
25 |   file: z.custom<File>(),
26 |   currency: z.string(),
27 |   bank_account_id: z.string(),
28 |   amount: z.string(),
29 |   balance: z.string().optional(),
30 |   date: z.string(),
31 |   description: z.string(),
32 |   inverted: z.boolean(),
33 |   table: z.array(z.record(z.string(), z.string())).optional(),
34 |   import_type: z.enum(["csv", "image"]),
35 | });
36 |
37 | export type ImportCsvFormData = {
38 |   file: File | null;
39 |   currency: string;
40 |   bank_account_id: string;
41 |   inverted: boolean;
42 |   table: Record<string, string>[] | null;
43 |   import_type: "csv" | "image";
44 | } & Record<keyof typeof mappableFields, string>;
45 |
46 | export const ImportCsvContext = createContext<{
47 |   fileColumns: string[] | null;
48 |   setFileColumns: (columns: string[] | null) => void;
49 |   firstRows: Record<string, string>[] | null;
50 |   setFirstRows: (rows: Record<string, string>[] | null) => void;
51 |   control: Control<ImportCsvFormData>;
52 |   watch: UseFormWatch<ImportCsvFormData>;
53 |   setValue: UseFormSetValue<ImportCsvFormData>;
54 | } | null>(null);
55 |
56 | export function useCsvContext() {
57 |   const context = useContext(ImportCsvContext);
58 |
59 |   if (!context)
60 |     throw new Error(
61 |       "useCsvContext must be used within an ImportCsvContext.Provider",
62 |     );
63 |
64 |   return context;
65 | }
```

apps/dashboard/src/components/modals/import-modal/field-mapping.tsx
```
1 | "use client";
2 |
3 | import { generateCsvMapping } from "@/actions/ai/generate-csv-mapping";
4 | import { SelectAccount } from "@/components/select-account";
5 | import { SelectCurrency } from "@/components/select-currency";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { formatAmount } from "@/utils/format";
8 | import { formatAmountValue, formatDate } from "@midday/import";
9 | import {
10 |   Accordion,
11 |   AccordionContent,
12 |   AccordionItem,
13 |   AccordionTrigger,
14 | } from "@midday/ui/accordion";
15 | import { Icons } from "@midday/ui/icons";
16 | import { Input } from "@midday/ui/input";
17 | import { Label } from "@midday/ui/label";
18 | import {
19 |   Select,
20 |   SelectContent,
21 |   SelectGroup,
22 |   SelectItem,
23 |   SelectLabel,
24 |   SelectTrigger,
25 |   SelectValue,
26 | } from "@midday/ui/select";
27 | import { Spinner } from "@midday/ui/spinner";
28 | import { Switch } from "@midday/ui/switch";
29 | import {
30 |   Tooltip,
31 |   TooltipContent,
32 |   TooltipProvider,
33 |   TooltipTrigger,
34 | } from "@midday/ui/tooltip";
35 | import { readStreamableValue } from "ai/rsc";
36 | import { capitalCase } from "change-case";
37 | import { useEffect, useState } from "react";
38 | import { Controller } from "react-hook-form";
39 | import { mappableFields, useCsvContext } from "./context";
40 |
41 | export function FieldMapping({ currencies }: { currencies: string[] }) {
42 |   const { fileColumns, firstRows, setValue, control, watch } = useCsvContext();
43 |   const [isStreaming, setIsStreaming] = useState(true);
44 |   const [showCurrency, setShowCurrency] = useState(false);
45 |
46 |   useEffect(() => {
47 |     if (!fileColumns || !firstRows) return;
48 |
49 |     generateCsvMapping(fileColumns, firstRows)
50 |       .then(async ({ object }) => {
51 |         setIsStreaming(true);
52 |
53 |         for await (const partialObject of readStreamableValue(object)) {
54 |           if (partialObject) {
55 |             for (const [field, value] of Object.entries(partialObject)) {
56 |               if (
57 |                 Object.keys(mappableFields).includes(field) &&
58 |                 fileColumns.includes(value as string)
59 |               ) {
60 |                 setValue(field as keyof typeof mappableFields, value, {
61 |                   shouldValidate: true,
62 |                 });
63 |               }
64 |             }
65 |           }
66 |         }
67 |       })
68 |       .finally(() => setIsStreaming(false));
69 |   }, [fileColumns, firstRows]);
70 |
71 |   return (
72 |     <div className="mt-6">
73 |       <div className="grid grid-cols-2 gap-x-4 gap-y-2">
74 |         <div className="text-sm">CSV Data column</div>
75 |         <div className="text-sm">Midday data column</div>
76 |         {(Object.keys(mappableFields) as (keyof typeof mappableFields)[]).map(
77 |           (field) => (
78 |             <FieldRow
79 |               key={field}
80 |               field={field}
81 |               isStreaming={isStreaming}
82 |               currency={watch("currency")}
83 |             />
84 |           ),
85 |         )}
86 |       </div>
87 |
88 |       <Accordion
89 |         defaultValue={undefined}
90 |         collapsible
91 |         type="single"
92 |         className="w-full mt-6 border-t-[1px] border-border"
93 |       >
94 |         <AccordionItem value="settings">
95 |           <AccordionTrigger className="text-sm">Settings</AccordionTrigger>
96 |           <AccordionContent>
97 |             <div className="flex flex-col gap-4">
98 |               <Controller
99 |                 control={control}
100 |                 name="inverted"
101 |                 render={({ field: { onChange, value } }) => (
102 |                   <div className="space-y-1">
103 |                     <Label htmlFor="inverted">Inverted amount</Label>
104 |                     <p className="text-sm text-[#606060]">
105 |                       If the transactions are from credit account, you can
106 |                       invert the amount.
107 |                     </p>
108 |                     <div className="flex justify-end">
109 |                       <Switch
110 |                         id="inverted"
111 |                         checked={value}
112 |                         onCheckedChange={onChange}
113 |                       />
114 |                     </div>
115 |                   </div>
116 |                 )}
117 |               />
118 |             </div>
119 |           </AccordionContent>
120 |         </AccordionItem>
121 |       </Accordion>
122 |
123 |       <div className="mt-6">
124 |         <Label className="mb-2 block">Account</Label>
125 |         <Controller
126 |           control={control}
127 |           name="bank_account_id"
128 |           render={({ field: { value, onChange } }) => (
129 |             <SelectAccount
130 |               className="w-full"
131 |               placeholder="Select account"
132 |               value={value}
133 |               onChange={(account) => {
134 |                 onChange(account.id);
135 |
136 |                 if (account.type === "credit") {
137 |                   setValue("inverted", true, {
138 |                     shouldValidate: true,
139 |                   });
140 |                 }
141 |
142 |                 if (account?.currency) {
143 |                   setValue("currency", account.currency, {
144 |                     shouldValidate: true,
145 |                   });
146 |
147 |                   setShowCurrency(false);
148 |                 } else {
149 |                   // Show currency select if account has no currency
150 |                   setShowCurrency(!account.currency);
151 |                 }
152 |               }}
153 |             />
154 |           )}
155 |         />
156 |       </div>
157 |
158 |       {showCurrency && (
159 |         <>
160 |           <Label className="mb-2 mt-4 block">Currency</Label>
161 |           <Controller
162 |             control={control}
163 |             name="currency"
164 |             render={({ field: { onChange, value } }) => (
165 |               <SelectCurrency
166 |                 className="w-full text-xs"
167 |                 value={value}
168 |                 onChange={onChange}
[TRUNCATED]
```

apps/dashboard/src/components/modals/import-modal/index.tsx
```
1 | "use client";
2 |
3 | import { importTransactionsAction } from "@/actions/transactions/import-transactions";
4 | import { useSyncStatus } from "@/hooks/use-sync-status";
5 | import { useUpload } from "@/hooks/use-upload";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { zodResolver } from "@hookform/resolvers/zod";
8 | import { AnimatedSizeContainer } from "@midday/ui/animated-size-container";
9 | import { Button } from "@midday/ui/button";
10 | import {
11 |   Dialog,
12 |   DialogContent,
13 |   DialogDescription,
14 |   DialogHeader,
15 |   DialogTitle,
16 | } from "@midday/ui/dialog";
17 | import { Icons } from "@midday/ui/icons";
18 | import { useToast } from "@midday/ui/use-toast";
19 | import { stripSpecialCharacters } from "@midday/utils";
20 | import { ErrorBoundary } from "@sentry/nextjs";
21 | import { Loader2 } from "lucide-react";
22 | import { useAction } from "next-safe-action/hooks";
23 | import { useRouter } from "next/navigation";
24 | import { parseAsBoolean, parseAsString, useQueryStates } from "nuqs";
25 | import { useEffect, useState } from "react";
26 | import { useForm } from "react-hook-form";
27 | import {
28 |   ImportCsvContext,
29 |   type ImportCsvFormData,
30 |   importSchema,
31 | } from "./context";
32 | import { FieldMapping } from "./field-mapping";
33 | import { SelectFile } from "./select-file";
34 |
35 | const pages = ["select-file", "confirm-import"] as const;
36 |
37 | type Props = {
38 |   currencies: string[];
39 |   defaultCurrency: string;
40 | };
41 |
42 | export function ImportModal({ currencies, defaultCurrency }: Props) {
43 |   const [runId, setRunId] = useState<string | undefined>();
44 |   const [accessToken, setAccessToken] = useState<string | undefined>();
45 |   const [isImporting, setIsImporting] = useState(false);
46 |   const [fileColumns, setFileColumns] = useState<string[] | null>(null);
47 |   const [firstRows, setFirstRows] = useState<Record<string, string>[] | null>(
48 |     null,
49 |   );
50 |
51 |   const { team_id: teamId } = useUserContext((state) => state.data);
52 |
53 |   const [pageNumber, setPageNumber] = useState<number>(0);
54 |   const page = pages[pageNumber];
55 |
56 |   const { uploadFile } = useUpload();
57 |
58 |   const { toast } = useToast();
59 |   const router = useRouter();
60 |
61 |   const { status, setStatus } = useSyncStatus({ runId, accessToken });
62 |
63 |   const [params, setParams] = useQueryStates({
64 |     step: parseAsString,
65 |     accountId: parseAsString,
66 |     type: parseAsString,
67 |     hide: parseAsBoolean.withDefault(false),
68 |   });
69 |
70 |   const isOpen = params.step === "import";
71 |
72 |   const importTransactions = useAction(importTransactionsAction, {
73 |     onSuccess: ({ data }) => {
74 |       if (data) {
75 |         setRunId(data.id);
76 |         setAccessToken(data.publicAccessToken);
77 |       }
78 |     },
79 |     onError: () => {
80 |       setIsImporting(false);
81 |       setRunId(undefined);
82 |       setStatus("FAILED");
83 |
84 |       toast({
85 |         duration: 3500,
86 |         variant: "error",
87 |         title: "Something went wrong please try again.",
88 |       });
89 |     },
90 |   });
91 |
92 |   const {
93 |     control,
94 |     watch,
95 |     setValue,
96 |     handleSubmit,
97 |     reset,
98 |     formState: { isValid },
99 |   } = useForm<ImportCsvFormData>({
100 |     resolver: zodResolver(importSchema),
101 |     defaultValues: {
102 |       currency: defaultCurrency,
103 |       bank_account_id: params.accountId ?? undefined,
104 |       inverted: params.type === "credit",
105 |     },
106 |   });
107 |
108 |   const file = watch("file");
109 |
110 |   const onclose = () => {
111 |     setFileColumns(null);
112 |     setFirstRows(null);
113 |     setPageNumber(0);
114 |     reset();
115 |
116 |     setParams({
117 |       step: null,
118 |       accountId: null,
119 |       type: null,
120 |       hide: null,
121 |     });
122 |   };
123 |
124 |   useEffect(() => {
125 |     if (params.accountId) {
126 |       setValue("bank_account_id", params.accountId);
127 |     }
128 |   }, [params.accountId]);
129 |
130 |   useEffect(() => {
131 |     if (params.type) {
132 |       setValue("inverted", params.type === "credit");
133 |     }
134 |   }, [params.type]);
135 |
136 |   useEffect(() => {
137 |     if (status === "FAILED") {
138 |       setIsImporting(false);
139 |       setRunId(undefined);
140 |
141 |       toast({
142 |         duration: 3500,
143 |         variant: "error",
144 |         title: "Something went wrong please try again or contact support.",
145 |       });
146 |     }
147 |   }, [status]);
148 |
149 |   useEffect(() => {
150 |     if (status === "COMPLETED") {
151 |       setRunId(undefined);
152 |       setIsImporting(false);
153 |       onclose();
154 |       router.refresh();
155 |
156 |       toast({
157 |         duration: 3500,
158 |         variant: "success",
159 |         title: "Transactions imported successfully.",
160 |       });
161 |     }
162 |   }, [status]);
163 |
164 |   // Go to second page if file looks good
165 |   useEffect(() => {
166 |     if (file && fileColumns && pageNumber === 0) {
167 |       setPageNumber(1);
168 |     }
169 |   }, [file, fileColumns, pageNumber]);
170 |
171 |   return (
172 |     <Dialog open={isOpen} onOpenChange={onclose}>
173 |       <DialogContent>
174 |         <ErrorBoundary>
175 |           <div className="p-4 pb-0">
176 |             <DialogHeader>
177 |               <div className="flex space-x-4 items-center mb-4">
[TRUNCATED]
```

apps/dashboard/src/components/modals/import-modal/select-file.tsx
```
1 | import { getTransactionsFromLayout } from "@/actions/transactions/get-transactions-from-layout";
2 | import { useUpload } from "@/hooks/use-upload";
3 | import { useUserContext } from "@/store/user/hook";
4 | import { createClient } from "@midday/supabase/client";
5 | import { cn } from "@midday/ui/cn";
6 | import { Spinner } from "@midday/ui/spinner";
7 | import { stripSpecialCharacters } from "@midday/utils";
8 | import { useAction } from "next-safe-action/hooks";
9 | import Papa from "papaparse";
10 | import { useEffect, useState } from "react";
11 | import Dropzone from "react-dropzone";
12 | import { Controller } from "react-hook-form";
13 | import { useCsvContext } from "./context";
14 | import { readLines } from "./utils";
15 |
16 | export function SelectFile() {
17 |   const supabase = createClient();
18 |   const { watch, control, setFileColumns, setFirstRows, setValue } =
19 |     useCsvContext();
20 |   const [error, setError] = useState<string | null>(null);
21 |   const [isLoading, setIsLoading] = useState(false);
22 |   const { uploadFile } = useUpload();
23 |
24 |   const { team_id: teamId } = useUserContext((state) => state.data);
25 |
26 |   const getTransactions = useAction(getTransactionsFromLayout, {
27 |     onSuccess: ({ data }) => {
28 |       const { columns, results } = data;
29 |
30 |       setValue("table", results);
31 |       setFileColumns(columns);
32 |
33 |       // Skip the first row because it can be the header row
34 |       setFirstRows(results.slice(1, 4));
35 |       setIsLoading(false);
36 |     },
37 |     onError: () => {
38 |       setError("Something went wrong while processing the file.");
39 |       setIsLoading(false);
40 |     },
41 |   });
42 |
43 |   const file = watch("file");
44 |
45 |   async function processFile() {
46 |     if (!file) {
47 |       setFileColumns(null);
48 |       return;
49 |     }
50 |
51 |     setIsLoading(true);
52 |
53 |     if (file?.type !== "text/csv") {
54 |       try {
55 |         setValue("import_type", "image");
56 |
57 |         const filename = stripSpecialCharacters(file.name);
58 |
59 |         const { path } = await uploadFile({
60 |           bucket: "vault",
61 |           path: [teamId, "imports", filename],
62 |           file,
63 |         });
64 |
65 |         getTransactions.execute({ filePath: path });
66 |       } catch (error) {
67 |         setError("Something went wrong while processing the file.");
68 |         setIsLoading(false);
69 |       }
70 |
71 |       return;
72 |     }
73 |
74 |     setValue("import_type", "csv");
75 |
76 |     readLines(file, 4)
77 |       .then((lines) => {
78 |         const { data, meta } = Papa.parse(lines, {
79 |           worker: false,
80 |           skipEmptyLines: true,
81 |           header: true,
82 |         });
83 |
84 |         if (!data || data.length < 2) {
85 |           setError("CSV file must have at least 2 rows.");
86 |           setFileColumns(null);
87 |           setFirstRows(null);
88 |           setIsLoading(false);
89 |           return;
90 |         }
91 |
92 |         if (!meta || !meta.fields || meta.fields.length <= 1) {
93 |           setError("Failed to retrieve CSV column data.");
94 |           setFileColumns(null);
95 |           setFirstRows(null);
96 |           setIsLoading(false);
97 |           return;
98 |         }
99 |
100 |         setFileColumns(meta.fields);
101 |         setFirstRows(data);
102 |         setIsLoading(false);
103 |       })
104 |       .catch(() => {
105 |         setError("Failed to read CSV file.");
106 |         setFileColumns(null);
107 |         setFirstRows(null);
108 |         setIsLoading(false);
109 |       });
110 |   }
111 |
112 |   useEffect(() => {
113 |     processFile();
114 |   }, [file]);
115 |
116 |   return (
117 |     <div className="flex flex-col gap-3">
118 |       <Controller
119 |         control={control}
120 |         name="file"
121 |         render={({ field: { onChange, onBlur } }) => (
122 |           <Dropzone
123 |             onDrop={([file]) => onChange(file)}
124 |             maxFiles={1}
125 |             accept={{
126 |               "text/csv": [".csv"],
127 |               "image/jpeg": [".jpg"],
128 |               "image/png": [".png"],
129 |             }}
130 |             maxSize={5000000}
131 |           >
132 |             {({ getRootProps, getInputProps, isDragActive, isDragReject }) => (
133 |               <div
134 |                 {...getRootProps()}
135 |                 className={cn(
136 |                   "w-full border border-dashed h-[200px] mt-8 mb-8 flex items-center justify-center",
137 |                   isDragActive && "bg-secondary text-primary",
138 |                   isDragReject && "border-destructive",
139 |                 )}
140 |               >
141 |                 <div className="text-center flex items-center justify-center flex-col text-xs text-[#878787]">
142 |                   <input {...getInputProps()} onBlur={onBlur} />
143 |
144 |                   {isLoading ? (
145 |                     <div className="flex space-x-1 items-center">
146 |                       <Spinner />
147 |                       <span>Loading...</span>
148 |                     </div>
149 |                   ) : (
150 |                     <div>
151 |                       <p>Drop your file here, or click to browse.</p>
152 |                       <span>5MB file limit.</span>
153 |                       <span className="mt-2 text-[10px]">
154 |                         CSV, PDF, jpg or png
155 |                       </span>
156 |                     </div>
157 |                   )}
158 |
159 |                   {error && (
160 |                     <p className="text-center text-sm text-red-600 mt-4">
161 |                       {error}
162 |                     </p>
163 |                   )}
164 |                 </div>
[TRUNCATED]
```

apps/dashboard/src/components/modals/import-modal/utils.ts
```
1 | export const readLines = async (file: File, count = 4): Promise<string> => {
2 |   const reader = file.stream().getReader();
3 |   const decoder = new TextDecoder("utf-8");
4 |   let { value: chunk, done: readerDone } = await reader.read();
5 |   let content = "";
6 |   const result: string[] = [];
7 |
8 |   while (!readerDone) {
9 |     content += decoder.decode(chunk, { stream: true });
10 |     const lines = content.split("\n");
11 |     if (lines.length >= count) {
12 |       reader.cancel();
13 |       return lines.slice(0, count).join("\n");
14 |     }
15 |     ({ value: chunk, done: readerDone } = await reader.read());
16 |   }
17 |
18 |   return result.join("\n");
19 | };
```

apps/dashboard/src/components/tables/categories/columns.tsx
```
1 | "use client";
2 |
3 | import { EditCategoryModal } from "@/components/modals/edit-category-modal";
4 | import { Button } from "@midday/ui/button";
5 | import { Checkbox } from "@midday/ui/checkbox";
6 | import {
7 |   DropdownMenu,
8 |   DropdownMenuContent,
9 |   DropdownMenuItem,
10 |   DropdownMenuTrigger,
11 | } from "@midday/ui/dropdown-menu";
12 | import {
13 |   Tooltip,
14 |   TooltipContent,
15 |   TooltipProvider,
16 |   TooltipTrigger,
17 | } from "@midday/ui/tooltip";
18 | import { DotsHorizontalIcon } from "@radix-ui/react-icons";
19 | import type { ColumnDef } from "@tanstack/react-table";
20 | import * as React from "react";
21 |
22 | export type Category = {
23 |   id: string;
24 |   name: string;
25 |   system: boolean;
26 |   vat?: string;
27 |   color: string;
28 | };
29 |
30 | export const columns: ColumnDef<Category>[] = [
31 |   {
32 |     header: "Name",
33 |     accessorKey: "name",
34 |     cell: ({ row }) => (
35 |       <div className="flex space-x-2 items-center">
36 |         <div
37 |           className="size-3"
38 |           style={{ backgroundColor: row.original.color }}
39 |         />
40 |         <TooltipProvider delayDuration={0}>
41 |           <Tooltip>
42 |             <TooltipTrigger asChild>
43 |               <span className="cursor-default">{row.getValue("name")}</span>
44 |             </TooltipTrigger>
45 |             {row.original?.description && (
46 |               <TooltipContent
47 |                 className="px-3 py-1.5 text-xs"
48 |                 side="right"
49 |                 sideOffset={10}
50 |               >
51 |                 {row.original.description}
52 |               </TooltipContent>
53 |             )}
54 |           </Tooltip>
55 |         </TooltipProvider>
56 |
57 |         {row.original.system && (
58 |           <div className="pl-2">
59 |             <span className="border border-border rounded-full py-1.5 px-3 text-xs text-[#878787] font-mono">
60 |               System
61 |             </span>
62 |           </div>
63 |         )}
64 |       </div>
65 |     ),
66 |   },
67 |   {
68 |     header: "VAT",
69 |     accessorKey: "vat",
70 |     cell: ({ row }) => (row.getValue("vat") ? `${row.getValue("vat")}%` : "-"),
71 |   },
72 |   {
73 |     id: "actions",
74 |     cell: ({ row, table }) => {
75 |       const [isOpen, setOpen] = React.useState(false);
76 |
77 |       return (
78 |         <div className="text-right">
79 |           <DropdownMenu>
80 |             <DropdownMenuTrigger asChild>
81 |               <Button variant="ghost" className="h-8 w-8 p-0">
82 |                 <DotsHorizontalIcon className="h-4 w-4" />
83 |               </Button>
84 |             </DropdownMenuTrigger>
85 |             <DropdownMenuContent align="end">
86 |               <DropdownMenuItem onClick={() => setOpen(true)}>
87 |                 Edit
88 |               </DropdownMenuItem>
89 |               {!row.original.system && (
90 |                 <DropdownMenuItem
91 |                   onClick={() =>
92 |                     table.options.meta?.deleteCategories.execute({
93 |                       ids: [row.original.id],
94 |                       revalidatePath: "/settings/categories",
95 |                     })
96 |                   }
97 |                 >
98 |                   Remove
99 |                 </DropdownMenuItem>
100 |               )}
101 |             </DropdownMenuContent>
102 |           </DropdownMenu>
103 |
104 |           <EditCategoryModal
105 |             id={row.id}
106 |             defaultValue={row.original}
107 |             isOpen={isOpen}
108 |             onOpenChange={setOpen}
109 |           />
110 |         </div>
111 |       );
112 |     },
113 |   },
114 | ];
```

apps/dashboard/src/components/tables/categories/header.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Input } from "@midday/ui/input";
5 | import type { Table } from "@tanstack/react-table";
6 | import type { Category } from "./columns";
7 |
8 | type Props = {
9 |   table?: Table<Category[]>;
10 |   onOpenChange?: (isOpen: boolean) => void;
11 | };
12 |
13 | export function Header({ table, onOpenChange }: Props) {
14 |   return (
15 |     <div className="flex items-center py-4 justify-between">
16 |       <Input
17 |         placeholder="Search..."
18 |         value={(table?.getColumn("name")?.getFilterValue() as string) ?? ""}
19 |         onChange={(event) =>
20 |           table?.getColumn("name")?.setFilterValue(event.target.value)
21 |         }
22 |         className="max-w-sm"
23 |       />
24 |
25 |       <Button onClick={() => onOpenChange?.(true)}>Create</Button>
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/components/tables/categories/index.tsx
```
1 | import { getCategories } from "@midday/supabase/cached-queries";
2 | import { DataTable } from "./table";
3 |
4 | export async function CategoriesTable() {
5 |   const categories = await getCategories();
6 |
7 |   return <DataTable data={categories?.data} />;
8 | }
```

apps/dashboard/src/components/tables/categories/skeleton.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 | import {
3 |   Table,
4 |   TableBody,
5 |   TableCell,
6 |   TableHead,
7 |   TableHeader,
8 |   TableRow,
9 | } from "@midday/ui/table";
10 | import { Header } from "./header";
11 |
12 | export function CategoriesSkeleton() {
13 |   return (
14 |     <div className="w-full">
15 |       <Header />
16 |
17 |       <Table>
18 |         <TableHeader>
19 |           <TableRow>
20 |             <TableHead>Name</TableHead>
21 |             <TableHead>VAT</TableHead>
22 |           </TableRow>
23 |         </TableHeader>
24 |
25 |         <TableBody>
26 |           {[...Array(15)].map((_, index) => (
27 |             <TableRow
28 |               key={index.toString()}
29 |               className="hover:bg-transparent h-[49px]"
30 |             >
31 |               <TableCell className="w-[50px]">
32 |                 <Skeleton className="size-4 rounded-md" />
33 |               </TableCell>
34 |               <TableCell>
35 |                 <Skeleton className="w-[20%] h-2" />
36 |               </TableCell>
37 |               <TableCell className="w-[65px]">
38 |                 <Skeleton className="w-5 h-1" />
39 |               </TableCell>
40 |             </TableRow>
41 |           ))}
42 |         </TableBody>
43 |       </Table>
44 |     </div>
45 |   );
46 | }
```

apps/dashboard/src/components/tables/categories/table.tsx
```
1 | "use client";
2 |
3 | import { deleteCategoriesAction } from "@/actions/delete-categories-action";
4 | import { CreateCategoriesModal } from "@/components/modals/create-categories-modal";
5 | import {
6 |   AlertDialog,
7 |   AlertDialogAction,
8 |   AlertDialogCancel,
9 |   AlertDialogContent,
10 |   AlertDialogDescription,
11 |   AlertDialogFooter,
12 |   AlertDialogHeader,
13 |   AlertDialogTitle,
14 | } from "@midday/ui/alert-dialog";
15 | import { cn } from "@midday/ui/cn";
16 | import { Dialog } from "@midday/ui/dialog";
17 | import {
18 |   Table,
19 |   TableBody,
20 |   TableCell,
21 |   TableHead,
22 |   TableHeader,
23 |   TableRow,
24 | } from "@midday/ui/table";
25 | import { useToast } from "@midday/ui/use-toast";
26 | import {
27 |   flexRender,
28 |   getCoreRowModel,
29 |   getFilteredRowModel,
30 |   useReactTable,
31 | } from "@tanstack/react-table";
32 | import { useAction } from "next-safe-action/hooks";
33 | import React from "react";
34 | import { type Category, columns } from "./columns";
35 | import { Header } from "./header";
36 |
37 | type Props = {
38 |   data: Category[];
39 | };
40 |
41 | export function DataTable({ data }: Props) {
42 |   const [isOpen, onOpenChange] = React.useState(false);
43 |   const { toast } = useToast();
44 |
45 |   const deleteCategories = useAction(deleteCategoriesAction, {
46 |     onSuccess: ({ data }) => {
47 |       toast({
48 |         title:
49 |           data && data?.length > 1 ? "Categories removed." : "Category removed",
50 |         duration: 3500,
51 |         variant: "success",
52 |       });
53 |     },
54 |   });
55 |
56 |   const table = useReactTable({
57 |     data,
58 |     getRowId: ({ id }) => id,
59 |     columns,
60 |     getCoreRowModel: getCoreRowModel(),
61 |     getFilteredRowModel: getFilteredRowModel(),
62 |     meta: {
63 |       deleteCategories,
64 |     },
65 |   });
66 |
67 |   return (
68 |     <AlertDialog>
69 |       <div className="w-full">
70 |         <Header table={table} onOpenChange={onOpenChange} />
71 |
72 |         <Table>
73 |           <TableHeader>
74 |             {table.getHeaderGroups().map((headerGroup) => (
75 |               <TableRow key={headerGroup.id}>
76 |                 {headerGroup.headers.map((header) => {
77 |                   return (
78 |                     <TableHead key={header.id}>
79 |                       {header.isPlaceholder
80 |                         ? null
81 |                         : flexRender(
82 |                             header.column.columnDef.header,
83 |                             header.getContext()
84 |                           )}
85 |                     </TableHead>
86 |                   );
87 |                 })}
88 |               </TableRow>
89 |             ))}
90 |           </TableHeader>
91 |           <TableBody>
92 |             {table.getRowModel().rows.map((row) => (
93 |               <TableRow
94 |                 className="hover:bg-transparent"
95 |                 key={row.id}
96 |                 data-state={row.getIsSelected() && "selected"}
97 |               >
98 |                 {row.getVisibleCells().map((cell, index) => (
99 |                   <TableCell
100 |                     key={cell.id}
101 |                     className={cn(index === 2 && "w-[50px]")}
102 |                   >
103 |                     {flexRender(cell.column.columnDef.cell, cell.getContext())}
104 |                   </TableCell>
105 |                 ))}
106 |               </TableRow>
107 |             ))}
108 |           </TableBody>
109 |         </Table>
110 |
111 |         <Dialog open={isOpen} onOpenChange={onOpenChange}>
112 |           <CreateCategoriesModal onOpenChange={onOpenChange} isOpen={isOpen} />
113 |         </Dialog>
114 |       </div>
115 |
116 |       <AlertDialogContent>
117 |         <AlertDialogHeader>
118 |           <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
119 |           <AlertDialogDescription>
120 |             This action cannot be undone. This will permanently delete your
121 |             categories and mark assigned transactions to Uncategorized.
122 |           </AlertDialogDescription>
123 |         </AlertDialogHeader>
124 |         <AlertDialogFooter>
125 |           <AlertDialogCancel>Cancel</AlertDialogCancel>
126 |           <AlertDialogAction
127 |             onClick={() =>
128 |               deleteCategories.execute({
129 |                 ids: selectedIds,
130 |                 revalidatePath: "/settings/categories",
131 |               })
132 |             }
133 |           >
134 |             Continue
135 |           </AlertDialogAction>
136 |         </AlertDialogFooter>
137 |       </AlertDialogContent>
138 |     </AlertDialog>
139 |   );
140 | }
```

apps/dashboard/src/components/tables/customers/columns.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
5 | import { Badge } from "@midday/ui/badge";
6 | import { Button } from "@midday/ui/button";
7 | import {
8 |   DropdownMenu,
9 |   DropdownMenuContent,
10 |   DropdownMenuItem,
11 |   DropdownMenuTrigger,
12 | } from "@midday/ui/dropdown-menu";
13 | import { ScrollArea, ScrollBar } from "@midday/ui/scroll-area";
14 | import { DotsHorizontalIcon } from "@radix-ui/react-icons";
15 | import type { ColumnDef } from "@tanstack/react-table";
16 | import Link from "next/link";
17 | import * as React from "react";
18 |
19 | export type Customer = {
20 |   id: string;
21 |   name: string;
22 |   customer_name?: string;
23 |   website: string;
24 |   contact?: string;
25 |   email: string;
26 |   invoices: { id: string }[];
27 |   projects: { id: string }[];
28 |   tags: { tag: { id: string; name: string } }[];
29 | };
30 |
31 | export const columns: ColumnDef<Customer>[] = [
32 |   {
33 |     header: "Name",
34 |     accessorKey: "name",
35 |     cell: ({ row }) => {
36 |       const name = row.original.name ?? row.original.customer_name;
37 |
38 |       if (!name) return "-";
39 |
40 |       return (
41 |         <div className="flex items-center space-x-2">
42 |           <Avatar className="size-5">
43 |             {row.original.website && (
44 |               <AvatarImageNext
45 |                 src={`https://img.logo.dev/${row.original.website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
46 |                 alt={`${name} logo`}
47 |                 width={20}
48 |                 height={20}
49 |                 quality={100}
50 |               />
51 |             )}
52 |             <AvatarFallback className="text-[9px] font-medium">
53 |               {name?.[0]}
54 |             </AvatarFallback>
55 |           </Avatar>
56 |           <span className="truncate">{name}</span>
57 |         </div>
58 |       );
59 |     },
60 |   },
61 |   {
62 |     header: "Contact person",
63 |     accessorKey: "contact",
64 |     cell: ({ row }) => row.getValue("contact") ?? "-",
65 |   },
66 |   {
67 |     header: "Email",
68 |     accessorKey: "email",
69 |     cell: ({ row }) => row.getValue("email") ?? "-",
70 |   },
71 |   {
72 |     header: "Invoices",
73 |     accessorKey: "invoices",
74 |     cell: ({ row }) => {
75 |       if (row.original.invoices.length > 0) {
76 |         return (
77 |           <Link href={`/invoices?customers=${row.original.id}`}>
78 |             {row.original.invoices.length}
79 |           </Link>
80 |         );
81 |       }
82 |
83 |       return "-";
84 |     },
85 |   },
86 |   {
87 |     header: "Projects",
88 |     accessorKey: "projects",
89 |     cell: ({ row }) => {
90 |       if (row.original.projects.length > 0) {
91 |         return (
92 |           <Link href={`/tracker?customers=${row.original.id}`}>
93 |             {row.original.projects.length}
94 |           </Link>
95 |         );
96 |       }
97 |
98 |       return "-";
99 |     },
100 |   },
101 |   {
102 |     header: "Tags",
103 |     accessorKey: "tags",
104 |     cell: ({ row }) => {
105 |       return (
106 |         <div className="relative">
107 |           <ScrollArea className="max-w-[170px] whitespace-nowrap">
108 |             <div className="flex items-center space-x-2">
109 |               {row.original.tags?.map(({ tag }) => (
110 |                 <Link href={`/transactions?tags=${tag.id}`} key={tag.id}>
111 |                   <Badge variant="tag" className="whitespace-nowrap">
112 |                     {tag.name}
113 |                   </Badge>
114 |                 </Link>
115 |               ))}
116 |             </div>
117 |
118 |             <ScrollBar orientation="horizontal" />
119 |           </ScrollArea>
120 |
121 |           <div className="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-background to-transparent pointer-events-none z-10" />
122 |         </div>
123 |       );
124 |     },
125 |   },
126 |   {
127 |     id: "actions",
128 |     header: "Actions",
129 |     cell: ({ row, table }) => {
130 |       const { setParams } = useCustomerParams();
131 |
132 |       return (
133 |         <div>
134 |           <DropdownMenu>
135 |             <DropdownMenuTrigger asChild className="relative">
136 |               <Button variant="ghost" className="h-8 w-8 p-0">
137 |                 <DotsHorizontalIcon className="h-4 w-4" />
138 |               </Button>
139 |             </DropdownMenuTrigger>
140 |
141 |             <DropdownMenuContent align="end">
142 |               <DropdownMenuItem
143 |                 onClick={() =>
144 |                   setParams({
145 |                     customerId: row.original.id,
146 |                   })
147 |                 }
148 |               >
149 |                 Edit customer
150 |               </DropdownMenuItem>
151 |
152 |               <DropdownMenuItem
153 |                 onClick={() =>
154 |                   table.options.meta?.deleteCustomer(row.original.id)
155 |                 }
156 |                 className="text-[#FF3638]"
157 |               >
158 |                 Delete
159 |               </DropdownMenuItem>
160 |             </DropdownMenuContent>
161 |           </DropdownMenu>
162 |         </div>
163 |       );
164 |     },
165 |   },
166 | ];
```

apps/dashboard/src/components/tables/customers/empty-states.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function EmptyState() {
7 |   const { setParams } = useCustomerParams();
8 |
9 |   return (
10 |     <div className="flex items-center justify-center ">
11 |       <div className="flex flex-col items-center mt-40">
12 |         <div className="text-center mb-6 space-y-2">
13 |           <h2 className="font-medium text-lg">No customers</h2>
14 |           <p className="text-[#606060] text-sm">
15 |             You haven't created any customers yet. <br />
16 |             Go ahead and create your first one.
17 |           </p>
18 |         </div>
19 |
20 |         <Button
21 |           variant="outline"
22 |           onClick={() =>
23 |             setParams({
24 |               createCustomer: true,
25 |             })
26 |           }
27 |         >
28 |           Create customer
29 |         </Button>
30 |       </div>
31 |     </div>
32 |   );
33 | }
34 |
35 | export function NoResults() {
36 |   const { setParams } = useCustomerParams();
37 |
38 |   return (
39 |     <div className="flex items-center justify-center ">
40 |       <div className="flex flex-col items-center mt-40">
41 |         <div className="text-center mb-6 space-y-2">
42 |           <h2 className="font-medium text-lg">No results</h2>
43 |           <p className="text-[#606060] text-sm">
44 |             Try another search, or adjusting the filters
45 |           </p>
46 |         </div>
47 |
48 |         <Button
49 |           variant="outline"
50 |           onClick={() => setParams(null, { shallow: false })}
51 |         >
52 |           Clear filters
53 |         </Button>
54 |       </div>
55 |     </div>
56 |   );
57 | }
```

apps/dashboard/src/components/tables/customers/index.tsx
```
1 | import { getCustomers } from "@midday/supabase/cached-queries";
2 | import { EmptyState, NoResults } from "./empty-states";
3 | import { DataTable } from "./table";
4 |
5 | type Props = {
6 |   page: number;
7 |   query?: string | null;
8 |   sort?: string[] | null;
9 |   start?: string | null;
10 |   end?: string | null;
11 | };
12 |
13 | const pageSize = 25;
14 |
15 | export async function CustomersTable({ query, sort, start, end, page }: Props) {
16 |   const filter = {
17 |     start,
18 |     end,
19 |   };
20 |
21 |   async function loadMore({ from, to }: { from: number; to: number }) {
22 |     "use server";
23 |
24 |     return getCustomers({
25 |       to,
26 |       from: from + 1,
27 |       searchQuery: query,
28 |       sort,
29 |     });
30 |   }
31 |
32 |   const { data, meta } = await getCustomers({
33 |     searchQuery: query,
34 |     sort,
35 |     to: pageSize,
36 |   });
37 |
38 |   const hasNextPage = Boolean(
39 |     meta?.count && meta.count / (page + 1) > pageSize,
40 |   );
41 |
42 |   if (!data?.length) {
43 |     if (
44 |       query?.length ||
45 |       Object.values(filter).some((value) => value !== null)
46 |     ) {
47 |       return <NoResults />;
48 |     }
49 |
50 |     return <EmptyState />;
51 |   }
52 |
53 |   return (
54 |     <DataTable
55 |       data={data}
56 |       loadMore={loadMore}
57 |       pageSize={pageSize}
58 |       hasNextPage={hasNextPage}
59 |       page={page}
60 |     />
61 |   );
62 | }
```

apps/dashboard/src/components/tables/customers/row.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { TableCell, TableRow } from "@midday/ui/table";
5 | import { type Row, flexRender } from "@tanstack/react-table";
6 | import type { Customer } from "./columns";
7 |
8 | type Props = {
9 |   row: Row<Customer>;
10 |   setOpen: (id?: string) => void;
11 | };
12 |
13 | export function CustomerRow({ row, setOpen }: Props) {
14 |   return (
15 |     <>
16 |       <TableRow
17 |         className="hover:bg-transparent cursor-default h-[45px]"
18 |         key={row.id}
19 |       >
20 |         {row.getVisibleCells().map((cell, index) => (
21 |           <TableCell
22 |             key={cell.id}
23 |             onClick={() => ![3, 4, 5, 6].includes(index) && setOpen(row.id)}
24 |             className={cn(index !== 0 && "hidden md:table-cell")}
25 |           >
26 |             {flexRender(cell.column.columnDef.cell, cell.getContext())}
27 |           </TableCell>
28 |         ))}
29 |       </TableRow>
30 |     </>
31 |   );
32 | }
```

apps/dashboard/src/components/tables/customers/skeleton.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
3 | import { TableHeader } from "./table-header";
4 |
5 | export function CustomersSkeleton() {
6 |   return (
7 |     <Table>
8 |       <TableHeader />
9 |       <TableBody>
10 |         {Array.from({ length: 25 }).map((_, index) => (
11 |           <TableRow key={index.toString()} className="h-[45px]">
12 |             <TableCell>
13 |               <Skeleton className="h-4 w-24" />
14 |             </TableCell>
15 |             <TableCell>
16 |               <Skeleton className="h-4 w-32" />
17 |             </TableCell>
18 |             <TableCell>
19 |               <Skeleton className="h-4 w-20" />
20 |             </TableCell>
21 |             <TableCell>
22 |               <Skeleton className="h-4 w-24" />
23 |             </TableCell>
24 |             <TableCell>
25 |               <Skeleton className="h-4 w-16" />
26 |             </TableCell>
27 |             <TableCell>
28 |               <Skeleton className="h-4 w-8" />
29 |             </TableCell>
30 |           </TableRow>
31 |         ))}
32 |       </TableBody>
33 |     </Table>
34 |   );
35 | }
```

apps/dashboard/src/components/tables/customers/table-header.tsx
```
1 | "use client";
2 |
3 | import { useCustomerParams } from "@/hooks/use-customer-params";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   TableHeader as BaseTableHeader,
7 |   TableHead,
8 |   TableRow,
9 | } from "@midday/ui/table";
10 | import { ArrowDown, ArrowUp } from "lucide-react";
11 |
12 | export function TableHeader() {
13 |   const { setParams, sort } = useCustomerParams({ shallow: false });
14 |   const [column, value] = sort || [];
15 |
16 |   const createSortQuery = (name: string) => {
17 |     const [currentColumn, currentValue] = sort || [];
18 |
19 |     if (name === currentColumn) {
20 |       if (currentValue === "asc") {
21 |         setParams({ sort: [name, "desc"] });
22 |       } else if (currentValue === "desc") {
23 |         setParams({ sort: null });
24 |       } else {
25 |         setParams({ sort: [name, "asc"] });
26 |       }
27 |     } else {
28 |       setParams({ sort: [name, "asc"] });
29 |     }
30 |   };
31 |
32 |   return (
33 |     <BaseTableHeader>
34 |       <TableRow>
35 |         <TableHead>
36 |           <Button
37 |             className="p-0 hover:bg-transparent space-x-2"
38 |             variant="ghost"
39 |             onClick={() => createSortQuery("name")}
40 |           >
41 |             <span>Name</span>
42 |             {"name" === column && value === "asc" && <ArrowDown size={16} />}
43 |             {"name" === column && value === "desc" && <ArrowUp size={16} />}
44 |           </Button>
45 |         </TableHead>
46 |         <TableHead className="hidden md:table-cell">
47 |           <Button
48 |             className="p-0 hover:bg-transparent space-x-2"
49 |             variant="ghost"
50 |             onClick={() => createSortQuery("contact")}
51 |           >
52 |             <span>Contact person</span>
53 |             {"contact" === column && value === "asc" && <ArrowDown size={16} />}
54 |             {"contact" === column && value === "desc" && <ArrowUp size={16} />}
55 |           </Button>
56 |         </TableHead>
57 |         <TableHead className="hidden md:table-cell">
58 |           <Button
59 |             className="p-0 hover:bg-transparent space-x-2"
60 |             variant="ghost"
61 |             onClick={() => createSortQuery("email")}
62 |           >
63 |             <span>Email</span>
64 |             {"email" === column && value === "asc" && <ArrowDown size={16} />}
65 |             {"email" === column && value === "desc" && <ArrowUp size={16} />}
66 |           </Button>
67 |         </TableHead>
68 |         <TableHead className="w-[200px] hidden md:table-cell">
69 |           <Button
70 |             className="p-0 hover:bg-transparent space-x-2"
71 |             variant="ghost"
72 |             // onClick={() => createSortQuery("customer")}
73 |           >
74 |             <span>Invoices</span>
75 |             {"invoices" === column && value === "asc" && (
76 |               <ArrowDown size={16} />
77 |             )}
78 |             {"invoices" === column && value === "desc" && <ArrowUp size={16} />}
79 |           </Button>
80 |         </TableHead>
81 |         <TableHead className="hidden md:table-cell">
82 |           <Button
83 |             className="p-0 hover:bg-transparent space-x-2"
84 |             variant="ghost"
85 |             // onClick={() => createSortQuery("projects")}
86 |           >
87 |             <span>Projects</span>
88 |             {"projects" === column && value === "asc" && (
89 |               <ArrowDown size={16} />
90 |             )}
91 |             {"projects" === column && value === "desc" && <ArrowUp size={16} />}
92 |           </Button>
93 |         </TableHead>
94 |
95 |         <TableHead className="hidden md:table-cell">
96 |           <Button
97 |             className="p-0 hover:bg-transparent space-x-2"
98 |             variant="ghost"
99 |             onClick={() => createSortQuery("tags")}
100 |           >
101 |             <span>Tags</span>
102 |             {"tags" === column && value === "asc" && <ArrowDown size={16} />}
103 |             {"tags" === column && value === "desc" && <ArrowUp size={16} />}
104 |           </Button>
105 |         </TableHead>
106 |
107 |         <TableHead className="hidden md:table-cell">Actions</TableHead>
108 |       </TableRow>
109 |     </BaseTableHeader>
110 |   );
111 | }
```

apps/dashboard/src/components/tables/customers/table.tsx
```
1 | "use client";
2 |
3 | import { deleteCustomerAction } from "@/actions/delete-customer-action";
4 | import { useCustomerParams } from "@/hooks/use-customer-params";
5 | import { Spinner } from "@midday/ui/spinner";
6 | import { Table, TableBody } from "@midday/ui/table";
7 | import {
8 |   getCoreRowModel,
9 |   getFilteredRowModel,
10 |   useReactTable,
11 | } from "@tanstack/react-table";
12 | import { useAction } from "next-safe-action/hooks";
13 | import React, { useEffect, useState } from "react";
14 | import { useInView } from "react-intersection-observer";
15 | import { type Customer, columns } from "./columns";
16 | import { CustomerRow } from "./row";
17 | import { TableHeader } from "./table-header";
18 |
19 | type Props = {
20 |   data: Customer[];
21 |   loadMore: ({
22 |     from,
23 |     to,
24 |   }: {
25 |     from: number;
26 |     to: number;
27 |   }) => Promise<{ data: Customer[]; meta: { count: number } }>;
28 |   pageSize: number;
29 |   hasNextPage: boolean;
30 | };
31 |
32 | export function DataTable({
33 |   data: initialData,
34 |   loadMore,
35 |   pageSize,
36 |   hasNextPage: initialHasNextPage,
37 | }: Props) {
38 |   const [data, setData] = useState(initialData);
39 |   const [from, setFrom] = useState(pageSize);
40 |   const { ref, inView } = useInView();
41 |   const [hasNextPage, setHasNextPage] = useState(initialHasNextPage);
42 |   const { setParams } = useCustomerParams();
43 |
44 |   const deleteCustomer = useAction(deleteCustomerAction);
45 |
46 |   const setOpen = (id?: string) => {
47 |     if (id) {
48 |       setParams({ customerId: id });
49 |     } else {
50 |       setParams(null);
51 |     }
52 |   };
53 |
54 |   const handleDeleteCustomer = (id: string) => {
55 |     setData((prev) => {
56 |       return prev.filter((item) => item.id !== id);
57 |     });
58 |
59 |     deleteCustomer.execute({ id });
60 |   };
61 |
62 |   const table = useReactTable({
63 |     data,
64 |     getRowId: ({ id }) => id,
65 |     columns,
66 |     getCoreRowModel: getCoreRowModel(),
67 |     getFilteredRowModel: getFilteredRowModel(),
68 |     meta: {
69 |       deleteCustomer: handleDeleteCustomer,
70 |     },
71 |   });
72 |
73 |   const loadMoreData = async () => {
74 |     const formatedFrom = from;
75 |     const to = formatedFrom + pageSize * 2;
76 |
77 |     try {
78 |       const { data, meta } = await loadMore({
79 |         from: formatedFrom,
80 |         to,
81 |       });
82 |
83 |       setData((prev) => [...prev, ...data]);
84 |       setFrom(to);
85 |       setHasNextPage(meta.count > to);
86 |     } catch {
87 |       setHasNextPage(false);
88 |     }
89 |   };
90 |
91 |   useEffect(() => {
92 |     if (inView) {
93 |       loadMoreData();
94 |     }
95 |   }, [inView]);
96 |
97 |   useEffect(() => {
98 |     setData(initialData);
99 |   }, [initialData]);
100 |
101 |   return (
102 |     <div>
103 |       <Table>
104 |         <TableHeader />
105 |
106 |         <TableBody>
107 |           {table.getRowModel().rows.map((row) => (
108 |             <CustomerRow key={row.id} row={row} setOpen={setOpen} />
109 |           ))}
110 |         </TableBody>
111 |       </Table>
112 |
113 |       {hasNextPage && (
114 |         <div className="flex items-center justify-center mt-6" ref={ref}>
115 |           <div className="flex items-center space-x-2 px-6 py-5">
116 |             <Spinner />
117 |             <span className="text-sm text-[#606060]">Loading more...</span>
118 |           </div>
119 |         </div>
120 |       )}
121 |     </div>
122 |   );
123 | }
```

apps/dashboard/src/components/tables/invoices/columns.tsx
```
1 | "use client";
2 |
3 | import type { InvoiceTemplate } from "@/actions/invoice/schema";
4 | import { updateInvoiceAction } from "@/actions/invoice/update-invoice-action";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { InvoiceStatus } from "@/components/invoice-status";
7 | import { OpenURL } from "@/components/open-url";
8 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
9 | import { formatDate, getDueDateStatus } from "@/utils/format";
10 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
11 | import { Button } from "@midday/ui/button";
12 | import { cn } from "@midday/ui/cn";
13 | import {
14 |   DropdownMenu,
15 |   DropdownMenuContent,
16 |   DropdownMenuItem,
17 |   DropdownMenuTrigger,
18 | } from "@midday/ui/dropdown-menu";
19 | import { Icons } from "@midday/ui/icons";
20 | import { Tooltip, TooltipContent, TooltipTrigger } from "@midday/ui/tooltip";
21 | import { TooltipProvider } from "@midday/ui/tooltip";
22 | import { useToast } from "@midday/ui/use-toast";
23 | import { DotsHorizontalIcon } from "@radix-ui/react-icons";
24 | import type { ColumnDef } from "@tanstack/react-table";
25 | import { formatDistanceToNow } from "date-fns";
26 | import { useAction } from "next-safe-action/hooks";
27 | import * as React from "react";
28 |
29 | export type Invoice = {
30 |   id: string;
31 |   due_date: string;
32 |   issue_date?: string;
33 |   paid_at?: string;
34 |   status: string;
35 |   currency: string;
36 |   invoice_number: string;
37 |   amount?: number;
38 |   vat?: number;
39 |   tax?: number;
40 |   updated_at?: string;
41 |   viewed_at?: string;
42 |   template: InvoiceTemplate;
43 |   token: string;
44 |   sent_to?: string | null;
45 |   customer_details?: JSON;
46 |   internal_note?: string | null;
47 |   customer?: {
48 |     id: string;
49 |     name: string;
50 |     website: string;
51 |   };
52 |   // Used when relation is deleted
53 |   customer_name?: string;
54 | };
55 |
56 | export const columns: ColumnDef<Invoice>[] = [
57 |   {
58 |     header: "Invoice no.",
59 |     accessorKey: "invoice_number",
60 |     cell: ({ row }) => row.getValue("invoice_number"),
61 |   },
62 |   {
63 |     header: "Status",
64 |     accessorKey: "status",
65 |     cell: ({ row }) => <InvoiceStatus status={row.getValue("status")} />,
66 |   },
67 |   {
68 |     header: "Due date",
69 |     accessorKey: "due_date",
70 |     cell: ({ row, table }) => {
71 |       const date = row.getValue("due_date");
72 |
73 |       const showDate =
74 |         row.original.status === "unpaid" ||
75 |         row.original.status === "overdue" ||
76 |         row.original.status === "pending";
77 |
78 |       return (
79 |         <div className="flex flex-col space-y-1 w-[80px]">
80 |           <span>
81 |             {date ? formatDate(date, table.options.meta?.dateFormat) : "-"}
82 |           </span>
83 |           {showDate && (
84 |             <span className="text-xs text-muted-foreground">
85 |               {date ? getDueDateStatus(date) : "-"}
86 |             </span>
87 |           )}
88 |         </div>
89 |       );
90 |     },
91 |   },
92 |   {
93 |     header: "Customer",
94 |     accessorKey: "customer",
95 |     cell: ({ row }) => {
96 |       const customer = row.original.customer;
97 |       const name = customer?.name || row.original.customer_name;
98 |       const viewAt = row.original.viewed_at;
99 |
100 |       if (!name) return "-";
101 |
102 |       return (
103 |         <div className="flex items-center space-x-2">
104 |           <Avatar className="size-5">
105 |             {customer?.website && (
106 |               <AvatarImageNext
107 |                 src={`https://img.logo.dev/${customer?.website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
108 |                 alt={`${name} logo`}
109 |                 width={20}
110 |                 height={20}
111 |                 quality={100}
112 |               />
113 |             )}
114 |             <AvatarFallback className="text-[9px] font-medium">
115 |               {name?.[0]}
116 |             </AvatarFallback>
117 |           </Avatar>
118 |           <span className="truncate">{name}</span>
119 |
120 |           {viewAt && row.original.status !== "paid" && (
121 |             <TooltipProvider delayDuration={0}>
122 |               <Tooltip>
123 |                 <TooltipTrigger className="flex items-center space-x-2">
124 |                   <Icons.Visibility className="size-4 text-[#878787]" />
125 |                 </TooltipTrigger>
126 |                 <TooltipContent
127 |                   className="text-xs py-1 px-2"
128 |                   side="right"
129 |                   sideOffset={5}
130 |                 >
131 |                   {`Viewed ${formatDistanceToNow(viewAt)} ago`}
132 |                 </TooltipContent>
133 |               </Tooltip>
134 |             </TooltipProvider>
135 |           )}
136 |         </div>
137 |       );
138 |     },
139 |   },
140 |   {
141 |     header: "Amount",
142 |     accessorKey: "amount",
143 |     cell: ({ row }) => (
144 |       <span
145 |         className={cn({
146 |           "line-through": row.original.status === "canceled",
147 |         })}
148 |       >
149 |         <FormatAmount
150 |           amount={row.getValue("amount")}
151 |           currency={row.original.currency}
152 |         />
153 |       </span>
154 |     ),
155 |   },
156 |   {
157 |     header: "Issue date",
158 |     accessorKey: "issue_date",
159 |     cell: ({ row, table }) => {
[TRUNCATED]
```

apps/dashboard/src/components/tables/invoices/empty-states.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function EmptyState() {
7 |   const { setParams } = useInvoiceParams();
8 |
9 |   return (
10 |     <div className="flex items-center justify-center ">
11 |       <div className="flex flex-col items-center mt-40">
12 |         <div className="text-center mb-6 space-y-2">
13 |           <h2 className="font-medium text-lg">No invoices</h2>
14 |           <p className="text-[#606060] text-sm">
15 |             You haven't created any invoices yet. <br />
16 |             Go ahead and create your first one.
17 |           </p>
18 |         </div>
19 |
20 |         <Button
21 |           variant="outline"
22 |           onClick={() =>
23 |             setParams({
24 |               type: "create",
25 |             })
26 |           }
27 |         >
28 |           Create invoice
29 |         </Button>
30 |       </div>
31 |     </div>
32 |   );
33 | }
34 |
35 | export function NoResults() {
36 |   const { setParams } = useInvoiceParams();
37 |
38 |   return (
39 |     <div className="flex items-center justify-center ">
40 |       <div className="flex flex-col items-center mt-40">
41 |         <div className="text-center mb-6 space-y-2">
42 |           <h2 className="font-medium text-lg">No results</h2>
43 |           <p className="text-[#606060] text-sm">
44 |             Try another search, or adjusting the filters
45 |           </p>
46 |         </div>
47 |
48 |         <Button
49 |           variant="outline"
50 |           onClick={() => setParams(null, { shallow: false })}
51 |         >
52 |           Clear filters
53 |         </Button>
54 |       </div>
55 |     </div>
56 |   );
57 | }
```

apps/dashboard/src/components/tables/invoices/index.tsx
```
1 | import { getInvoices } from "@midday/supabase/cached-queries";
2 | import { EmptyState, NoResults } from "./empty-states";
3 | import { DataTable } from "./table";
4 |
5 | type Props = {
6 |   page: number;
7 |   query?: string | null;
8 |   sort?: string[] | null;
9 |   start?: string | null;
10 |   end?: string | null;
11 |   statuses?: string[] | null;
12 |   customers?: string[] | null;
13 | };
14 |
15 | const pageSize = 25;
16 |
17 | export async function InvoicesTable({
18 |   query,
19 |   sort,
20 |   start,
21 |   end,
22 |   statuses,
23 |   customers,
24 |   page,
25 | }: Props) {
26 |   const filter = {
27 |     start,
28 |     end,
29 |     statuses,
30 |     customers,
31 |   };
32 |
33 |   async function loadMore({ from, to }: { from: number; to: number }) {
34 |     "use server";
35 |
36 |     return getInvoices({
37 |       to,
38 |       from: from + 1,
39 |       searchQuery: query,
40 |       sort,
41 |       filter,
42 |     });
43 |   }
44 |
45 |   const { data, meta } = await getInvoices({
46 |     searchQuery: query,
47 |     sort,
48 |     filter,
49 |     to: pageSize,
50 |   });
51 |
52 |   const hasNextPage = Boolean(
53 |     meta?.count && meta.count / (page + 1) > pageSize,
54 |   );
55 |
56 |   if (!data?.length) {
57 |     if (
58 |       query?.length ||
59 |       Object.values(filter).some((value) => value !== null)
60 |     ) {
61 |       return <NoResults />;
62 |     }
63 |
64 |     return <EmptyState />;
65 |   }
66 |
67 |   return (
68 |     <DataTable
69 |       data={data}
70 |       loadMore={loadMore}
71 |       pageSize={pageSize}
72 |       hasNextPage={hasNextPage}
73 |       page={page}
74 |     />
75 |   );
76 | }
```

apps/dashboard/src/components/tables/invoices/row.tsx
```
1 | "use client";
2 |
3 | import { cn } from "@midday/ui/cn";
4 | import { TableCell, TableRow } from "@midday/ui/table";
5 | import { type Row, flexRender } from "@tanstack/react-table";
6 | import type { Invoice } from "./columns";
7 |
8 | type Props = {
9 |   row: Row<Invoice>;
10 |   setOpen: (id?: string) => void;
11 | };
12 |
13 | export function InvoiceRow({ row, setOpen }: Props) {
14 |   return (
15 |     <>
16 |       <TableRow
17 |         className="hover:bg-transparent cursor-default h-[57px] cursor-pointer"
18 |         key={row.id}
19 |       >
20 |         {row.getVisibleCells().map((cell, index) => (
21 |           <TableCell
22 |             key={cell.id}
23 |             className={cn(
24 |               index === 2 && "w-[50px]",
25 |               (cell.column.id === "actions" ||
26 |                 cell.column.id === "recurring" ||
27 |                 cell.column.id === "invoice_number" ||
28 |                 cell.column.id === "issue_date") &&
29 |                 "hidden md:table-cell",
30 |             )}
31 |             onClick={() =>
32 |               index !== row.getVisibleCells().length - 1 && setOpen(row.id)
33 |             }
34 |           >
35 |             {flexRender(cell.column.columnDef.cell, cell.getContext())}
36 |           </TableCell>
37 |         ))}
38 |       </TableRow>
39 |     </>
40 |   );
41 | }
```

apps/dashboard/src/components/tables/invoices/skeleton.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
3 | import { TableHeader } from "./table-header";
4 |
5 | export function InvoiceSkeleton() {
6 |   return (
7 |     <Table>
8 |       <TableHeader />
9 |       <TableBody>
10 |         {Array.from({ length: 25 }).map((_, index) => (
11 |           <TableRow key={index.toString()} className="h-[57px]">
12 |             <TableCell>
13 |               <Skeleton className="h-4 w-24" />
14 |             </TableCell>
15 |             <TableCell>
16 |               <Skeleton className="h-4 w-32" />
17 |             </TableCell>
18 |             <TableCell>
19 |               <Skeleton className="h-4 w-20" />
20 |             </TableCell>
21 |             <TableCell>
22 |               <Skeleton className="h-4 w-24" />
23 |             </TableCell>
24 |             <TableCell>
25 |               <Skeleton className="h-4 w-16" />
26 |             </TableCell>
27 |             <TableCell>
28 |               <Skeleton className="h-4 w-8" />
29 |             </TableCell>
30 |           </TableRow>
31 |         ))}
32 |       </TableBody>
33 |     </Table>
34 |   );
35 | }
```

apps/dashboard/src/components/tables/invoices/table-header.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   TableHeader as BaseTableHeader,
7 |   TableHead,
8 |   TableRow,
9 | } from "@midday/ui/table";
10 | import { ArrowDown, ArrowUp } from "lucide-react";
11 |
12 | export function TableHeader() {
13 |   const { setParams, sort } = useInvoiceParams({ shallow: false });
14 |   const [column, value] = sort || [];
15 |
16 |   const createSortQuery = (name: string) => {
17 |     const [currentColumn, currentValue] = sort || [];
18 |
19 |     if (name === currentColumn) {
20 |       if (currentValue === "asc") {
21 |         setParams({ sort: [name, "desc"] });
22 |       } else if (currentValue === "desc") {
23 |         setParams({ sort: null });
24 |       } else {
25 |         setParams({ sort: [name, "asc"] });
26 |       }
27 |     } else {
28 |       setParams({ sort: [name, "asc"] });
29 |     }
30 |   };
31 |
32 |   return (
33 |     <BaseTableHeader>
34 |       <TableRow>
35 |         <TableHead className="hidden md:table-cell">
36 |           <Button
37 |             className="p-0 hover:bg-transparent space-x-2"
38 |             variant="ghost"
39 |             onClick={() => createSortQuery("invoice_number")}
40 |           >
41 |             <span>Invoice no.</span>
42 |             {"invoice_number" === column && value === "asc" && (
43 |               <ArrowDown size={16} />
44 |             )}
45 |             {"invoice_number" === column && value === "desc" && (
46 |               <ArrowUp size={16} />
47 |             )}
48 |           </Button>
49 |         </TableHead>
50 |         <TableHead>
51 |           <Button
52 |             className="p-0 hover:bg-transparent space-x-2"
53 |             variant="ghost"
54 |             onClick={() => createSortQuery("status")}
55 |           >
56 |             <span>Status</span>
57 |             {"status" === column && value === "asc" && <ArrowDown size={16} />}
58 |             {"status" === column && value === "desc" && <ArrowUp size={16} />}
59 |           </Button>
60 |         </TableHead>
61 |         <TableHead>
62 |           <Button
63 |             className="p-0 hover:bg-transparent space-x-2"
64 |             variant="ghost"
65 |             onClick={() => createSortQuery("due_date")}
66 |           >
67 |             <span>Due Date</span>
68 |             {"due_date" === column && value === "asc" && (
69 |               <ArrowDown size={16} />
70 |             )}
71 |             {"due_date" === column && value === "desc" && <ArrowUp size={16} />}
72 |           </Button>
73 |         </TableHead>
74 |         <TableHead className="w-[200px]">
75 |           <Button
76 |             className="p-0 hover:bg-transparent space-x-2"
77 |             variant="ghost"
78 |             onClick={() => createSortQuery("customer")}
79 |           >
80 |             <span>Customer</span>
81 |             {"customer" === column && value === "asc" && (
82 |               <ArrowDown size={16} />
83 |             )}
84 |             {"customer" === column && value === "desc" && <ArrowUp size={16} />}
85 |           </Button>
86 |         </TableHead>
87 |         <TableHead>
88 |           <Button
89 |             className="p-0 hover:bg-transparent space-x-2"
90 |             variant="ghost"
91 |             onClick={() => createSortQuery("amount")}
92 |           >
93 |             <span>Amount</span>
94 |             {"amount" === column && value === "asc" && <ArrowDown size={16} />}
95 |             {"amount" === column && value === "desc" && <ArrowUp size={16} />}
96 |           </Button>
97 |         </TableHead>
98 |
99 |         <TableHead className="hidden md:table-cell">
100 |           <Button
101 |             className="p-0 hover:bg-transparent space-x-2"
102 |             variant="ghost"
103 |             onClick={() => createSortQuery("issue_date")}
104 |           >
105 |             <span>Issue Date</span>
106 |             {"issue_date" === column && value === "asc" && (
107 |               <ArrowDown size={16} />
108 |             )}
109 |             {"issue_date" === column && value === "desc" && (
110 |               <ArrowUp size={16} />
111 |             )}
112 |           </Button>
113 |         </TableHead>
114 |         <TableHead className="hidden md:table-cell">
115 |           <Button
116 |             className="p-0 hover:bg-transparent space-x-2"
117 |             variant="ghost"
118 |             onClick={() => createSortQuery("recurring")}
119 |           >
120 |             <span>Recurring</span>
121 |             {"recurring" === column && value === "asc" && (
122 |               <ArrowDown size={16} />
123 |             )}
124 |             {"recurring" === column && value === "desc" && (
125 |               <ArrowUp size={16} />
126 |             )}
127 |           </Button>
128 |         </TableHead>
129 |         <TableHead className="hidden md:table-cell">Actions</TableHead>
130 |       </TableRow>
131 |     </BaseTableHeader>
132 |   );
133 | }
```

apps/dashboard/src/components/tables/invoices/table.tsx
```
1 | "use client";
2 |
3 | import { deleteInvoiceAction } from "@/actions/invoice/delete-invoice-action";
4 | import { InvoiceDetailsSheet } from "@/components/sheets/invoice-details-sheet";
5 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { Spinner } from "@midday/ui/spinner";
8 | import { Table, TableBody } from "@midday/ui/table";
9 | import {
10 |   getCoreRowModel,
11 |   getFilteredRowModel,
12 |   useReactTable,
13 | } from "@tanstack/react-table";
14 | import { useAction } from "next-safe-action/hooks";
15 | import React, { useEffect, useState } from "react";
16 | import { useInView } from "react-intersection-observer";
17 | import { type Invoice, columns } from "./columns";
18 | import { InvoiceRow } from "./row";
19 | import { TableHeader } from "./table-header";
20 |
21 | type Props = {
22 |   data: Invoice[];
23 |   loadMore: ({
24 |     from,
25 |     to,
26 |   }: {
27 |     from: number;
28 |     to: number;
29 |   }) => Promise<{ data: Invoice[]; meta: { count: number } }>;
30 |   pageSize: number;
31 |   hasNextPage: boolean;
32 | };
33 |
34 | export function DataTable({
35 |   data: initialData,
36 |   loadMore,
37 |   pageSize,
38 |   hasNextPage: initialHasNextPage,
39 | }: Props) {
40 |   const [data, setData] = useState(initialData);
41 |   const [from, setFrom] = useState(pageSize);
42 |   const { ref, inView } = useInView();
43 |   const [hasNextPage, setHasNextPage] = useState(initialHasNextPage);
44 |   const { setParams, invoiceId, type } = useInvoiceParams();
45 |
46 |   const deleteInvoice = useAction(deleteInvoiceAction);
47 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
48 |
49 |   const selectedInvoice = data.find((invoice) => invoice?.id === invoiceId);
50 |
51 |   const setOpen = (id?: string) => {
52 |     if (id) {
53 |       setParams({ type: "details", invoiceId: id });
54 |     } else {
55 |       setParams(null);
56 |     }
57 |   };
58 |
59 |   const handleDeleteInvoice = (id: string) => {
60 |     setData((prev) => {
61 |       return prev.filter((item) => item.id !== id);
62 |     });
63 |
64 |     deleteInvoice.execute({ id });
65 |   };
66 |
67 |   const table = useReactTable({
68 |     data,
69 |     getRowId: ({ id }) => id,
70 |     columns,
71 |     getCoreRowModel: getCoreRowModel(),
72 |     getFilteredRowModel: getFilteredRowModel(),
73 |     meta: {
74 |       deleteInvoice: handleDeleteInvoice,
75 |       dateFormat,
76 |     },
77 |   });
78 |
79 |   const loadMoreData = async () => {
80 |     const formatedFrom = from;
81 |     const to = formatedFrom + pageSize * 2;
82 |
83 |     try {
84 |       const { data, meta } = await loadMore({
85 |         from: formatedFrom,
86 |         to,
87 |       });
88 |
89 |       setData((prev) => [...prev, ...data]);
90 |       setFrom(to);
91 |       setHasNextPage(meta.count > to);
92 |     } catch {
93 |       setHasNextPage(false);
94 |     }
95 |   };
96 |
97 |   useEffect(() => {
98 |     if (inView) {
99 |       loadMoreData();
100 |     }
101 |   }, [inView]);
102 |
103 |   useEffect(() => {
104 |     setData(initialData);
105 |   }, [initialData]);
106 |
107 |   return (
108 |     <div>
109 |       <Table>
110 |         <TableHeader />
111 |
112 |         <TableBody>
113 |           {table.getRowModel().rows.map((row) => (
114 |             <InvoiceRow key={row.id} row={row} setOpen={setOpen} />
115 |           ))}
116 |         </TableBody>
117 |       </Table>
118 |
119 |       {hasNextPage && (
120 |         <div className="flex items-center justify-center mt-6" ref={ref}>
121 |           <div className="flex items-center space-x-2 px-6 py-5">
122 |             <Spinner />
123 |             <span className="text-sm text-[#606060]">Loading more...</span>
124 |           </div>
125 |         </div>
126 |       )}
127 |
128 |       <InvoiceDetailsSheet
129 |         data={selectedInvoice}
130 |         isOpen={type === "details" && !!invoiceId}
131 |         setOpen={setOpen}
132 |       />
133 |     </div>
134 |   );
135 | }
```

apps/dashboard/src/components/tables/members/columns.tsx
```
1 | import { changeUserRoleAction } from "@/actions/change-user-role-action";
2 | import { deleteTeamMemberAction } from "@/actions/delete-team-member-action";
3 | import { leaveTeamAction } from "@/actions/leave-team-action";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   AlertDialog,
7 |   AlertDialogAction,
8 |   AlertDialogCancel,
9 |   AlertDialogContent,
10 |   AlertDialogDescription,
11 |   AlertDialogFooter,
12 |   AlertDialogHeader,
13 |   AlertDialogTitle,
14 |   AlertDialogTrigger,
15 | } from "@midday/ui/alert-dialog";
16 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
17 | import { Button } from "@midday/ui/button";
18 | import {
19 |   DropdownMenu,
20 |   DropdownMenuContent,
21 |   DropdownMenuItem,
22 |   DropdownMenuTrigger,
23 | } from "@midday/ui/dropdown-menu";
24 | import {
25 |   Select,
26 |   SelectContent,
27 |   SelectItem,
28 |   SelectTrigger,
29 |   SelectValue,
30 | } from "@midday/ui/select";
31 | import { useToast } from "@midday/ui/use-toast";
32 | import type { ColumnDef } from "@tanstack/react-table";
33 | import { MoreHorizontal } from "lucide-react";
34 | import { Loader2 } from "lucide-react";
35 | import { useAction } from "next-safe-action/hooks";
36 | import { useRouter } from "next/navigation";
37 |
38 | export const columns: ColumnDef[] = [
39 |   {
40 |     id: "member",
41 |     accessorKey: "user.full_name",
42 |     cell: ({ row }) => {
43 |       return (
44 |         <div>
45 |           <div className="flex items-center space-x-4">
46 |             <Avatar className="rounded-full w-8 h-8">
47 |               <AvatarImageNext
48 |                 src={row.original.user?.avatar_url}
49 |                 alt={row.original.user?.full_name ?? ""}
50 |                 width={32}
51 |                 height={32}
52 |               />
53 |               <AvatarFallback>
54 |                 <span className="text-xs">
55 |                   {row.original.user.full_name?.charAt(0)?.toUpperCase()}
56 |                 </span>
57 |               </AvatarFallback>
58 |             </Avatar>
59 |             <div className="flex flex-col">
60 |               <span className="font-medium text-sm">
61 |                 {row.original.user.full_name}
62 |               </span>
63 |               <span className="text-sm text-[#606060]">
64 |                 {row.original.user.email}
65 |               </span>
66 |             </div>
67 |           </div>
68 |         </div>
69 |       );
70 |     },
71 |   },
72 |   {
73 |     id: "actions",
74 |     cell: ({ row, table }) => {
75 |       const t = useI18n();
76 |       const router = useRouter();
77 |       const { toast } = useToast();
78 |
79 |       const changeUserRole = useAction(changeUserRoleAction, {
80 |         onSuccess: () => {
81 |           toast({
82 |             title: "Team role has been updated.",
83 |             duration: 3500,
84 |             variant: "success",
85 |           });
86 |         },
87 |         onError: () => {
88 |           toast({
89 |             duration: 3500,
90 |             variant: "error",
91 |             title: "Something went wrong please try again.",
92 |           });
93 |         },
94 |       });
95 |
96 |       const deleteTeamMember = useAction(deleteTeamMemberAction, {
97 |         onSuccess: () => {
98 |           toast({
99 |             title: "Team member removed.",
100 |             duration: 3500,
101 |             variant: "success",
102 |           });
103 |         },
104 |         onError: () => {
105 |           toast({
106 |             duration: 3500,
107 |             variant: "error",
108 |             title: "Something went wrong please try again.",
109 |           });
110 |         },
111 |       });
112 |
113 |       const leaveTeam = useAction(leaveTeamAction, {
114 |         onSuccess: () => router.push("/teams"),
115 |         onError: () => {
116 |           toast({
117 |             duration: 3500,
118 |             variant: "error",
119 |             title:
120 |               "You cannot leave since you are the only remaining owner of the team. Delete this team instead.",
121 |           });
122 |         },
123 |       });
124 |
125 |       return (
126 |         <div className="flex justify-end">
127 |           <div className="flex space-x-2 items-center">
128 |             {(table.options.meta.currentUser.role === "owner" &&
129 |               table.options.meta.currentUser.user.id !==
130 |                 row.original.user.id) ||
131 |             (table.options.meta.currentUser.role === "owner" &&
132 |               table.options.meta.totalOwners > 1) ? (
133 |               <Select
134 |                 value={row.original.role}
135 |                 onValueChange={(role) => {
136 |                   changeUserRole.execute({
137 |                     userId: row.original.user.id,
138 |                     teamId: row.original.team_id,
139 |                     role,
140 |                     revalidatePath: "/settings/members",
141 |                   });
142 |                 }}
143 |               >
144 |                 <SelectTrigger>
145 |                   <SelectValue placeholder={t(`roles.${row.original.role}`)} />
146 |                 </SelectTrigger>
147 |                 <SelectContent>
148 |                   <SelectItem value="owner">Owner</SelectItem>
149 |                   <SelectItem value="member">Member</SelectItem>
150 |                 </SelectContent>
151 |               </Select>
152 |             ) : (
153 |               <span className="text-sm text-[#606060]">
154 |                 {t(`roles.${row.original.role}`)}
155 |               </span>
156 |             )}
157 |
158 |             {table.options.meta.currentUser.role === "owner" && (
159 |               <DropdownMenu>
160 |                 <DropdownMenuTrigger asChild>
161 |                   <Button variant="ghost" className="h-8 w-8 p-0">
162 |                     <MoreHorizontal className="h-4 w-4" />
163 |                   </Button>
164 |                 </DropdownMenuTrigger>
165 |                 <DropdownMenuContent align="end">
[TRUNCATED]
```

apps/dashboard/src/components/tables/members/index.tsx
```
1 | import { getTeamUser } from "@midday/supabase/cached-queries";
2 | import { getTeamMembersQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { DataTable } from "./table";
5 |
6 | export async function MembersTable() {
7 |   const supabase = createClient();
8 |   const user = await getTeamUser();
9 |   const teamMembers = await getTeamMembersQuery(supabase, user.data.team_id);
10 |
11 |   return <DataTable data={teamMembers?.data} currentUser={user?.data} />;
12 | }
```

apps/dashboard/src/components/tables/members/table.tsx
```
1 | "use client";
2 |
3 | import { changeUserRoleAction } from "@/actions/change-user-role-action";
4 | import { deleteTeamMemberAction } from "@/actions/delete-team-member-action";
5 | import { leaveTeamAction } from "@/actions/leave-team-action";
6 | import { InviteTeamMembersModal } from "@/components/modals/invite-team-members-modal";
7 | import { useI18n } from "@/locales/client";
8 | import {
9 |   AlertDialog,
10 |   AlertDialogAction,
11 |   AlertDialogCancel,
12 |   AlertDialogContent,
13 |   AlertDialogDescription,
14 |   AlertDialogFooter,
15 |   AlertDialogHeader,
16 |   AlertDialogTitle,
17 |   AlertDialogTrigger,
18 | } from "@midday/ui/alert-dialog";
19 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
20 | import { Button } from "@midday/ui/button";
21 | import { cn } from "@midday/ui/cn";
22 | import { Dialog } from "@midday/ui/dialog";
23 | import {
24 |   DropdownMenu,
25 |   DropdownMenuContent,
26 |   DropdownMenuItem,
27 |   DropdownMenuTrigger,
28 | } from "@midday/ui/dropdown-menu";
29 | import { Input } from "@midday/ui/input";
30 | import {
31 |   Select,
32 |   SelectContent,
33 |   SelectItem,
34 |   SelectTrigger,
35 |   SelectValue,
36 | } from "@midday/ui/select";
37 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
38 | import { useToast } from "@midday/ui/use-toast";
39 | import {
40 |   type ColumnDef,
41 |   flexRender,
42 |   getCoreRowModel,
43 |   useReactTable,
44 | } from "@tanstack/react-table";
45 | import { MoreHorizontal } from "lucide-react";
46 | import { Loader2 } from "lucide-react";
47 | import { useAction } from "next-safe-action/hooks";
48 | import { useRouter } from "next/navigation";
49 | import * as React from "react";
50 |
51 | export const columns: ColumnDef[] = [
52 |   {
53 |     id: "member",
54 |     accessorKey: "user.full_name",
55 |     header: () => "Select all",
56 |     cell: ({ row }) => {
57 |       return (
58 |         <div>
59 |           <div className="flex items-center space-x-4">
60 |             <Avatar className="rounded-full w-8 h-8">
61 |               <AvatarImageNext
62 |                 src={row.original.user?.avatar_url}
63 |                 alt={row.original.user?.full_name ?? ""}
64 |                 width={32}
65 |                 height={32}
66 |               />
67 |               <AvatarFallback>
68 |                 <span className="text-xs">
69 |                   {row.original.user?.full_name?.charAt(0)?.toUpperCase()}
70 |                 </span>
71 |               </AvatarFallback>
72 |             </Avatar>
73 |             <div className="flex flex-col">
74 |               <span className="font-medium text-sm">
75 |                 {row.original.user?.full_name}
76 |               </span>
77 |               <span className="text-sm text-[#606060]">
78 |                 {row.original.user?.email}
79 |               </span>
80 |             </div>
81 |           </div>
82 |         </div>
83 |       );
84 |     },
85 |   },
86 |   {
87 |     id: "actions",
88 |     cell: ({ row, table }) => {
89 |       const t = useI18n();
90 |       const router = useRouter();
91 |       const { toast } = useToast();
92 |
93 |       const changeUserRole = useAction(changeUserRoleAction, {
94 |         onSuccess: () =>
95 |           toast({
96 |             title: "Team role has been updated.",
97 |             duration: 3500,
98 |             variant: "success",
99 |           }),
100 |         onError: () => {
101 |           toast({
102 |             duration: 3500,
103 |             variant: "error",
104 |             title: "Something went wrong please try again.",
105 |           });
106 |         },
107 |       });
108 |
109 |       const deleteTeamMember = useAction(deleteTeamMemberAction, {
110 |         onSuccess: () =>
111 |           toast({
112 |             title: "Team member removed.",
113 |             duration: 3500,
114 |             variant: "success",
115 |           }),
116 |         onError: () => {
117 |           toast({
118 |             duration: 3500,
119 |             variant: "error",
120 |             title: "Something went wrong please try again.",
121 |           });
122 |         },
123 |       });
124 |
125 |       const leaveTeam = useAction(leaveTeamAction, {
126 |         onSuccess: () => router.push("/teams"),
127 |         onError: () => {
128 |           toast({
129 |             duration: 3500,
130 |             variant: "error",
131 |             title:
132 |               "You cannot leave since you are the only remaining owner of the team. Delete this team instead.",
133 |           });
134 |         },
135 |       });
136 |
137 |       return (
138 |         <div className="flex justify-end">
139 |           <div className="flex space-x-2 items-center">
140 |             {(table.options.meta.currentUser.role === "owner" &&
141 |               table.options.meta.currentUser.user.id !==
142 |                 row.original.user?.id) ||
143 |             (table.options.meta.currentUser.role === "owner" &&
144 |               table.options.meta.totalOwners > 1) ? (
145 |               <Select
146 |                 value={row.original.role}
147 |                 onValueChange={(role) => {
148 |                   changeUserRole.execute({
149 |                     userId: row.original.user?.id,
150 |                     teamId: row.original.team_id,
151 |                     role,
152 |                     revalidatePath: "/settings/members",
153 |                   });
154 |                 }}
155 |               >
156 |                 <SelectTrigger>
157 |                   <SelectValue placeholder={t(`roles.${row.original.role}`)} />
158 |                 </SelectTrigger>
159 |                 <SelectContent>
160 |                   <SelectItem value="owner">Owner</SelectItem>
161 |                   <SelectItem value="member">Member</SelectItem>
162 |                 </SelectContent>
163 |               </Select>
164 |             ) : (
[TRUNCATED]
```

apps/dashboard/src/components/tables/pending-invites/index.tsx
```
1 | import { getTeamUser } from "@midday/supabase/cached-queries";
2 | import { getTeamInvitesQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { DataTable } from "./table";
5 |
6 | export async function PendingInvitesTable() {
7 |   const supabase = createClient();
8 |   const user = await getTeamUser();
9 |   const teamInvites = await getTeamInvitesQuery(supabase, user.data.team_id);
10 |
11 |   return <DataTable data={teamInvites?.data} currentUser={user?.data} />;
12 | }
```

apps/dashboard/src/components/tables/pending-invites/table.tsx
```
1 | "use client";
2 |
3 | import { deleteInviteAction } from "@/actions/delete-invite-action";
4 | import { InviteTeamMembersModal } from "@/components/modals/invite-team-members-modal";
5 | import { useI18n } from "@/locales/client";
6 | import { Avatar, AvatarFallback } from "@midday/ui/avatar";
7 | import { Button } from "@midday/ui/button";
8 | import { cn } from "@midday/ui/cn";
9 | import { Dialog } from "@midday/ui/dialog";
10 | import {
11 |   DropdownMenu,
12 |   DropdownMenuContent,
13 |   DropdownMenuItem,
14 |   DropdownMenuTrigger,
15 | } from "@midday/ui/dropdown-menu";
16 | import { Input } from "@midday/ui/input";
17 | import { Skeleton } from "@midday/ui/skeleton";
18 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
19 | import { useToast } from "@midday/ui/use-toast";
20 | import {
21 |   type ColumnDef,
22 |   flexRender,
23 |   getCoreRowModel,
24 |   useReactTable,
25 | } from "@tanstack/react-table";
26 | import { MoreHorizontal } from "lucide-react";
27 | import { useAction } from "next-safe-action/hooks";
28 | import * as React from "react";
29 |
30 | export type Payment = {
31 |   id: string;
32 |   amount: number;
33 |   status: "pending" | "processing" | "success" | "failed";
34 |   email: string;
35 | };
36 |
37 | export const columns: ColumnDef<Payment>[] = [
38 |   {
39 |     id: "member",
40 |     accessorKey: "user.full_name",
41 |     header: () => "Select all",
42 |     cell: ({ row }) => {
43 |       return (
44 |         <div className="flex items-center space-x-4">
45 |           <Avatar className="rounded-full w-8 h-8">
46 |             <AvatarFallback>
47 |               <span className="text-xs">P</span>
48 |             </AvatarFallback>
49 |           </Avatar>
50 |           <div className="flex flex-col">
51 |             <span className="font-medium text-sm">Pending Invitation</span>
52 |             <span className="text-sm text-[#606060]">{row.original.email}</span>
53 |           </div>
54 |         </div>
55 |       );
56 |     },
57 |   },
58 |   {
59 |     id: "actions",
60 |     cell: ({ row, table }) => {
61 |       const t = useI18n();
62 |       const { toast } = useToast();
63 |
64 |       const deleteInvite = useAction(deleteInviteAction, {
65 |         onSuccess: () => {
66 |           toast({
67 |             title: "Team invite removed.",
68 |             duration: 3500,
69 |             variant: "success",
70 |           });
71 |         },
72 |         onError: () => {
73 |           toast({
74 |             duration: 3500,
75 |             variant: "error",
76 |             title: "Something went wrong please try again.",
77 |           });
78 |         },
79 |       });
80 |
81 |       return (
82 |         <div className="flex justify-end">
83 |           <div className="flex space-x-2 items-center">
84 |             <span className="text-[#606060]">
85 |               {t(`roles.${row.original.role}`)}
86 |             </span>
87 |             {table.options.meta.currentUser.role === "owner" && (
88 |               <DropdownMenu>
89 |                 <DropdownMenuTrigger asChild>
90 |                   <Button variant="ghost" className="h-8 w-8 p-0">
91 |                     <span className="sr-only">Open menu</span>
92 |                     <MoreHorizontal className="h-4 w-4" />
93 |                   </Button>
94 |                 </DropdownMenuTrigger>
95 |                 <DropdownMenuContent align="end">
96 |                   <DropdownMenuItem
97 |                     className="text-destructive"
98 |                     onClick={() =>
99 |                       deleteInvite.execute({
100 |                         id: row.original.id,
101 |                         revalidatePath: "settings/members",
102 |                       })
103 |                     }
104 |                   >
105 |                     Remove
106 |                   </DropdownMenuItem>
107 |                 </DropdownMenuContent>
108 |               </DropdownMenu>
109 |             )}
110 |           </div>
111 |         </div>
112 |       );
113 |     },
114 |     meta: {
115 |       className: "text-right",
116 |     },
117 |   },
118 | ];
119 |
120 | export function PendingInvitesSkeleton() {
121 |   return (
122 |     <div className="w-full">
123 |       <DataTableHeader />
124 |
125 |       <Table>
126 |         <TableBody>
127 |           {[...Array(6)].map((_, index) => (
128 |             <TableRow key={index.toString()} className="hover:bg-transparent">
129 |               <TableCell className="border-r-[0px] py-4">
130 |                 <div className="flex items-center space-x-4">
131 |                   <Skeleton className="rounded-full w-8 h-8" />
132 |
133 |                   <div className="flex flex-col space-y-2">
134 |                     <Skeleton className="w-[200px] h-3" />
135 |                     <Skeleton className="w-[150px] h-2" />
136 |                   </div>
137 |                 </div>
138 |               </TableCell>
139 |             </TableRow>
140 |           ))}
141 |         </TableBody>
142 |       </Table>
143 |     </div>
144 |   );
145 | }
146 |
147 | export function DataTableHeader({ table }) {
148 |   const [isOpen, onOpenChange] = React.useState(false);
149 |
150 |   return (
151 |     <div className="flex items-center pb-4 space-x-4">
152 |       <Input
153 |         className="flex-1"
154 |         placeholder="Search..."
155 |         value={(table?.getColumn("member")?.getFilterValue() as string) ?? ""}
156 |         onChange={(event) =>
157 |           table?.getColumn("member")?.setFilterValue(event.target.value)
158 |         }
159 |         autoComplete="off"
160 |         autoCapitalize="none"
[TRUNCATED]
```

apps/dashboard/src/components/tables/select-team/table.tsx
```
1 | "use client";
2 |
3 | import { changeTeamAction } from "@/actions/change-team-action";
4 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
5 | import { Button } from "@midday/ui/button";
6 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
7 | import { useAction } from "next-safe-action/hooks";
8 |
9 | export function SelectTeamTable({ data }) {
10 |   const changeTeam = useAction(changeTeamAction);
11 |
12 |   return (
13 |     <Table>
14 |       <TableBody>
15 |         {data.map((row) => (
16 |           <TableRow key={row.id} className="hover:bg-transparent">
17 |             <TableCell className="border-r-[0px] py-4">
18 |               <div className="flex items-center space-x-4">
19 |                 <Avatar className="rounded-full w-8 h-8">
20 |                   <AvatarImageNext
21 |                     src={row.team?.logo_url}
22 |                     alt={row.team?.name ?? ""}
23 |                     width={32}
24 |                     height={32}
25 |                   />
26 |                   <AvatarFallback>
27 |                     <span className="text-xs">
28 |                       {row.team.name?.charAt(0)?.toUpperCase()}
29 |                     </span>
30 |                   </AvatarFallback>
31 |                 </Avatar>
32 |                 <div className="flex flex-col">
33 |                   <span className="font-medium text-sm">{row.team.name}</span>
34 |                 </div>
35 |               </div>
36 |             </TableCell>
37 |             <TableCell>
38 |               <div className="flex justify-end">
39 |                 <div className="flex space-x-3 items-center">
40 |                   <Button
41 |                     variant="outline"
42 |                     onClick={() =>
43 |                       changeTeam.execute({
44 |                         teamId: row.team.id,
45 |                         redirectTo: "/",
46 |                       })
47 |                     }
48 |                   >
49 |                     Launch
50 |                   </Button>
51 |                 </div>
52 |               </div>
53 |             </TableCell>
54 |           </TableRow>
55 |         ))}
56 |       </TableBody>
57 |     </Table>
58 |   );
59 | }
```

apps/dashboard/src/components/tables/teams/index.tsx
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import {
3 |   getTeamsByUserIdQuery,
4 |   getUserInvitesQuery,
5 | } from "@midday/supabase/queries";
6 | import { createClient } from "@midday/supabase/server";
7 | import { DataTable } from "./table";
8 |
9 | export async function TeamsTable() {
10 |   const supabase = createClient();
11 |   const user = await getUser();
12 |
13 |   const [teams, invites] = await Promise.all([
14 |     getTeamsByUserIdQuery(supabase, user.data?.id),
15 |     getUserInvitesQuery(supabase, user.data?.email),
16 |   ]);
17 |
18 |   return (
19 |     <DataTable
20 |       data={[
21 |         ...teams?.data,
22 |         ...invites?.data?.map((invite) => ({ ...invite, isInvite: true })),
23 |       ]}
24 |     />
25 |   );
26 | }
```

apps/dashboard/src/components/tables/teams/table.tsx
```
1 | "use client";
2 |
3 | import { acceptInviteAction } from "@/actions/accept-invite-action";
4 | import { changeTeamAction } from "@/actions/change-team-action";
5 | import { declineInviteAction } from "@/actions/decline-invite-action";
6 | import { leaveTeamAction } from "@/actions/leave-team-action";
7 | import { CreateTeamModal } from "@/components/modals/create-team-modal";
8 | import { useI18n } from "@/locales/client";
9 | import {
10 |   AlertDialog,
11 |   AlertDialogAction,
12 |   AlertDialogCancel,
13 |   AlertDialogContent,
14 |   AlertDialogDescription,
15 |   AlertDialogFooter,
16 |   AlertDialogHeader,
17 |   AlertDialogTitle,
18 |   AlertDialogTrigger,
19 | } from "@midday/ui/alert-dialog";
20 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
21 | import { Button } from "@midday/ui/button";
22 | import { cn } from "@midday/ui/cn";
23 | import { Dialog, DialogTrigger } from "@midday/ui/dialog";
24 | import {
25 |   DropdownMenu,
26 |   DropdownMenuContent,
27 |   DropdownMenuItem,
28 |   DropdownMenuTrigger,
29 | } from "@midday/ui/dropdown-menu";
30 | import { Input } from "@midday/ui/input";
31 | import { Skeleton } from "@midday/ui/skeleton";
32 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
33 | import { useToast } from "@midday/ui/use-toast";
34 | import {
35 |   type ColumnDef,
36 |   flexRender,
37 |   getCoreRowModel,
38 |   useReactTable,
39 | } from "@tanstack/react-table";
40 | import { MoreHorizontal } from "lucide-react";
41 | import { Loader2 } from "lucide-react";
42 | import { useAction } from "next-safe-action/hooks";
43 | import * as React from "react";
44 |
45 | export type Payment = {
46 |   id: string;
47 |   amount: number;
48 |   status: "pending" | "processing" | "success" | "failed";
49 |   email: string;
50 | };
51 |
52 | export const columns: ColumnDef<Payment>[] = [
53 |   {
54 |     id: "team",
55 |     accessorKey: "team.name",
56 |     cell: ({ row }) => {
57 |       const t = useI18n();
58 |
59 |       return (
60 |         <div className="flex items-center space-x-4">
61 |           <Avatar className="rounded-full w-8 h-8">
62 |             <AvatarImageNext
63 |               src={row.original.team?.logo_url}
64 |               alt={row.original.team?.name ?? ""}
65 |               width={32}
66 |               height={32}
67 |             />
68 |             <AvatarFallback>
69 |               <span className="text-xs">
70 |                 {row.original.team.name?.charAt(0)?.toUpperCase()}
71 |               </span>
72 |             </AvatarFallback>
73 |           </Avatar>
74 |           <div className="flex flex-col">
75 |             <span className="font-medium text-sm">
76 |               {row.original.team.name}
77 |             </span>
78 |             <span className="text-sm text-[#606060]">
79 |               {t(`roles.${row.original.role}`)}
80 |             </span>
81 |           </div>
82 |         </div>
83 |       );
84 |     },
85 |   },
86 |   {
87 |     id: "actions",
88 |     cell: ({ row }) => {
89 |       const { toast } = useToast();
90 |       const manageTeam = useAction(changeTeamAction);
91 |       const viewTeam = useAction(changeTeamAction);
92 |
93 |       const leaveTeam = useAction(leaveTeamAction, {
94 |         onError: () => {
95 |           toast({
96 |             duration: 3500,
97 |             variant: "error",
98 |             title:
99 |               "You cannot leave since you are the only remaining owner of the team. Delete this team instead.",
100 |           });
101 |         },
102 |       });
103 |
104 |       const declineInvite = useAction(declineInviteAction);
105 |       const acceptInvite = useAction(acceptInviteAction);
106 |
107 |       if (row.original.isInvite) {
108 |         return (
109 |           <div className="flex justify-end">
110 |             <div className="flex space-x-3 items-center">
111 |               <Button
112 |                 variant="outline"
113 |                 onClick={() =>
114 |                   declineInvite.execute({
115 |                     id: row.original.id,
116 |                     revalidatePath: "/account/teams",
117 |                   })
118 |                 }
119 |               >
120 |                 Decline
121 |               </Button>
122 |
123 |               <Button
124 |                 variant="outline"
125 |                 onClick={() =>
126 |                   acceptInvite.execute({
127 |                     id: row.original.id,
128 |                     revalidatePath: "/account/teams",
129 |                   })
130 |                 }
131 |               >
132 |                 Accept
133 |               </Button>
134 |             </div>
135 |           </div>
136 |         );
137 |       }
138 |
139 |       return (
140 |         <div className="flex justify-end">
141 |           <div className="flex space-x-3 items-center">
142 |             <Button
143 |               variant="outline"
144 |               onClick={() =>
145 |                 viewTeam.execute({
146 |                   teamId: row.original.team.id,
147 |                   redirectTo: "/",
148 |                 })
149 |               }
150 |             >
151 |               View
152 |             </Button>
153 |             {row.original.role === "owner" && (
154 |               <Button
155 |                 variant="outline"
156 |                 onClick={() =>
157 |                   manageTeam.execute({
158 |                     teamId: row.original.team.id,
159 |                     redirectTo: "/settings",
160 |                   })
161 |                 }
162 |               >
163 |                 Manage
164 |               </Button>
165 |             )}
166 |
167 |             <DropdownMenu>
168 |               <DropdownMenuTrigger asChild>
169 |                 <Button variant="ghost" className="h-8 w-8 p-0">
170 |                   <MoreHorizontal className="h-4 w-4" />
[TRUNCATED]
```

apps/dashboard/src/components/tables/tracker/data-table-header.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { TableHead, TableHeader, TableRow } from "@midday/ui/table";
5 | import { ArrowDown, ArrowUp } from "lucide-react";
6 | import { usePathname, useRouter, useSearchParams } from "next/navigation";
7 | import { useCallback } from "react";
8 |
9 | export function DataTableHeader() {
10 |   const searchParams = useSearchParams();
11 |   const pathname = usePathname();
12 |   const router = useRouter();
13 |   const [column, value] = searchParams.get("sort")
14 |     ? searchParams.get("sort")?.split(":")
15 |     : [];
16 |
17 |   const createSortQuery = useCallback(
18 |     (name: string) => {
19 |       const params = new URLSearchParams(searchParams);
20 |       const prevSort = params.get("sort");
21 |
22 |       if (`${name}:asc` === prevSort) {
23 |         params.set("sort", `${name}:desc`);
24 |       } else if (`${name}:desc` === prevSort) {
25 |         params.delete("sort");
26 |       } else {
27 |         params.set("sort", `${name}:asc`);
28 |       }
29 |
30 |       router.replace(`${pathname}?${params.toString()}`);
31 |     },
32 |     [searchParams, router, pathname],
33 |   );
34 |
35 |   return (
36 |     <TableHeader>
37 |       <TableRow className="h-[45px]">
38 |         <TableHead className="w-[320px]">
39 |           <Button
40 |             className="p-0 hover:bg-transparent space-x-2"
41 |             variant="ghost"
42 |             onClick={() => createSortQuery("name")}
43 |           >
44 |             <span>Project</span>
45 |             {"name" === column && value === "asc" && <ArrowDown size={16} />}
46 |             {"name" === column && value === "desc" && <ArrowUp size={16} />}
47 |           </Button>
48 |         </TableHead>
49 |         <TableHead className="w-[180px]">
50 |           <Button
51 |             className="p-0 hover:bg-transparent space-x-2"
52 |             variant="ghost"
53 |             onClick={() => createSortQuery("customer")}
54 |           >
55 |             <span>Customer</span>
56 |             {"customer" === column && value === "asc" && (
57 |               <ArrowDown size={16} />
58 |             )}
59 |             {"customer" === column && value === "desc" && <ArrowUp size={16} />}
60 |           </Button>
61 |         </TableHead>
62 |
63 |         <TableHead className="w-[180px]">
64 |           <Button
65 |             className="p-0 hover:bg-transparent space-x-2"
66 |             variant="ghost"
67 |             onClick={() => createSortQuery("time")}
68 |           >
69 |             <span>Total Time</span>
70 |             {"time" === column && value === "asc" && <ArrowDown size={16} />}
71 |             {"time" === column && value === "desc" && <ArrowUp size={16} />}
72 |           </Button>
73 |         </TableHead>
74 |         <TableHead className="w-[160px]">
75 |           <Button
76 |             className="p-0 hover:bg-transparent space-x-2"
77 |             variant="ghost"
78 |             onClick={() => createSortQuery("amount")}
79 |           >
80 |             <span>Total Amount</span>
81 |             {"amount" === column && value === "asc" && <ArrowDown size={16} />}
82 |             {"amount" === column && value === "desc" && <ArrowUp size={16} />}
83 |           </Button>
84 |         </TableHead>
85 |         <TableHead className="w-[330px]">
86 |           <Button
87 |             className="p-0 hover:bg-transparent space-x-2"
88 |             variant="ghost"
89 |             onClick={() => createSortQuery("description")}
90 |           >
91 |             <span className="line-clamp-1 text-ellipsis">Description</span>
92 |             {"description" === column && value === "asc" && (
93 |               <ArrowDown size={16} />
94 |             )}
95 |             {"description" === column && value === "desc" && (
96 |               <ArrowUp size={16} />
97 |             )}
98 |           </Button>
99 |         </TableHead>
100 |
101 |         <TableHead className="min-w-[170px]">
102 |           <Button
103 |             className="p-0 hover:bg-transparent space-x-2"
104 |             variant="ghost"
105 |             onClick={() => createSortQuery("tags")}
106 |           >
107 |             <span>Tags</span>
108 |             {"tags" === column && value === "asc" && <ArrowDown size={16} />}
109 |             {"tags" === column && value === "desc" && <ArrowUp size={16} />}
110 |           </Button>
111 |         </TableHead>
112 |
113 |         <TableHead className="w-[140px]">
114 |           <Button
115 |             className="p-0 hover:bg-transparent space-x-2"
116 |             variant="ghost"
117 |             onClick={() => createSortQuery("assigned")}
118 |           >
119 |             <span>Assigned</span>
120 |             {"assigned" === column && value === "asc" && (
121 |               <ArrowDown size={16} />
122 |             )}
123 |             {"assigned" === column && value === "desc" && <ArrowUp size={16} />}
124 |           </Button>
125 |         </TableHead>
126 |         <TableHead className="w-[170px]">
127 |           <Button
128 |             className="p-0 hover:bg-transparent space-x-2"
129 |             variant="ghost"
130 |             onClick={() => createSortQuery("status")}
131 |           >
132 |             <span>Status</span>
133 |             {"status" === column && value === "asc" && <ArrowDown size={16} />}
134 |             {"status" === column && value === "desc" && <ArrowUp size={16} />}
135 |           </Button>
136 |         </TableHead>
137 |       </TableRow>
138 |     </TableHeader>
139 |   );
140 | }
```

apps/dashboard/src/components/tables/tracker/data-table-row.tsx
```
1 | "use client";
2 |
3 | import { deleteProjectAction } from "@/actions/project/delete-project-action";
4 | import { TrackerExportCSV } from "@/components/tracker-export-csv";
5 | import { TrackerStatus } from "@/components/tracker-status";
6 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
7 | import { useTrackerParams } from "@/hooks/use-tracker-params";
8 | import { useUserContext } from "@/store/user/hook";
9 | import { formatAmount, secondsToHoursAndMinutes } from "@/utils/format";
10 | import {
11 |   AlertDialog,
12 |   AlertDialogAction,
13 |   AlertDialogCancel,
14 |   AlertDialogContent,
15 |   AlertDialogDescription,
16 |   AlertDialogFooter,
17 |   AlertDialogHeader,
18 |   AlertDialogTitle,
19 |   AlertDialogTrigger,
20 | } from "@midday/ui/alert-dialog";
21 | import { Avatar, AvatarFallback, AvatarImageNext } from "@midday/ui/avatar";
22 | import { Badge } from "@midday/ui/badge";
23 | import {
24 |   DropdownMenu,
25 |   DropdownMenuContent,
26 |   DropdownMenuItem,
27 |   DropdownMenuSeparator,
28 |   DropdownMenuTrigger,
29 | } from "@midday/ui/dropdown-menu";
30 | import { Icons } from "@midday/ui/icons";
31 | import { ScrollArea, ScrollBar } from "@midday/ui/scroll-area";
32 | import { TableCell, TableRow } from "@midday/ui/table";
33 | import { useToast } from "@midday/ui/use-toast";
34 | import { useAction } from "next-safe-action/hooks";
35 | import Link from "next/link";
36 | import type { TrackerProject } from "./data-table";
37 |
38 | type DataTableCellProps = {
39 |   children: React.ReactNode;
40 |   className?: string;
41 |   onClick?: () => void;
42 | };
43 |
44 | export function DataTableCell({
45 |   children,
46 |   className,
47 |   onClick,
48 | }: DataTableCellProps) {
49 |   return (
50 |     <TableCell className={className} onClick={onClick}>
51 |       {children}
52 |     </TableCell>
53 |   );
54 | }
55 |
56 | type RowProps = {
57 |   children: React.ReactNode;
58 | };
59 |
60 | export function Row({ children }: RowProps) {
61 |   return <TableRow className="h-[45px]">{children}</TableRow>;
62 | }
63 |
64 | type DataTableRowProps = {
65 |   row: TrackerProject;
66 |   userId: string;
67 | };
68 |
69 | export function DataTableRow({ row, userId }: DataTableRowProps) {
70 |   const { toast } = useToast();
71 |   const { setParams } = useTrackerParams();
72 |   const { setParams: setInvoiceParams } = useInvoiceParams();
73 |   const { locale } = useUserContext((state) => state.data);
74 |
75 |   const deleteAction = useAction(deleteProjectAction, {
76 |     onError: () => {
77 |       toast({
78 |         duration: 2500,
79 |         variant: "error",
80 |         title: "Something went wrong please try again.",
81 |       });
82 |     },
83 |   });
84 |
85 |   const onClick = () => {
86 |     setParams({
87 |       projectId: row.id,
88 |       update: true,
89 |     });
90 |   };
91 |
92 |   return (
93 |     <AlertDialog>
94 |       <DropdownMenu>
95 |         <Row>
96 |           <DataTableCell onClick={onClick} className="cursor-pointer">
97 |             {row.name}
98 |           </DataTableCell>
99 |           <DataTableCell onClick={onClick} className="cursor-pointer">
100 |             {row.customer ? (
101 |               <div className="flex items-center space-x-2">
102 |                 <Avatar className="size-5">
103 |                   {row.customer?.website && (
104 |                     <AvatarImageNext
105 |                       src={`https://img.logo.dev/${row.customer?.website}?token=pk_X-1ZO13GSgeOoUrIuJ6GMQ&size=60`}
106 |                       alt={`${row.customer?.name} logo`}
107 |                       width={20}
108 |                       height={20}
109 |                       quality={100}
110 |                     />
111 |                   )}
112 |                   <AvatarFallback className="text-[9px] font-medium">
113 |                     {row.customer?.name?.[0]}
114 |                   </AvatarFallback>
115 |                 </Avatar>
116 |                 <span className="truncate">{row.customer?.name}</span>
117 |               </div>
118 |             ) : (
119 |               "-"
120 |             )}
121 |           </DataTableCell>
122 |
123 |           <DataTableCell onClick={onClick} className="cursor-pointer">
124 |             <span className="text-sm">
125 |               {row.estimate
126 |                 ? `${secondsToHoursAndMinutes(row.total_duration)} / ${secondsToHoursAndMinutes(row.estimate * 3600)}`
127 |                 : secondsToHoursAndMinutes(row?.total_duration)}
128 |             </span>
129 |           </DataTableCell>
130 |           <DataTableCell onClick={onClick} className="cursor-pointer">
131 |             <span className="text-sm">
132 |               {formatAmount({
133 |                 currency: row.currency,
134 |                 amount: row.total_amount,
135 |                 minimumFractionDigits: 0,
136 |                 maximumFractionDigits: 0,
137 |                 locale,
138 |               })}
139 |             </span>
140 |           </DataTableCell>
141 |           <DataTableCell onClick={onClick} className="cursor-pointer">
142 |             {row.description}
143 |           </DataTableCell>
144 |           <DataTableCell>
145 |             <div className="relative">
146 |               <ScrollArea className="w-[170px] whitespace-nowrap">
147 |                 <div className="flex items-center space-x-2">
148 |                   {row.tags?.map((tag) => (
149 |                     <Link
150 |                       href={`/transactions?tags=${tag.tag.id}`}
151 |                       key={tag.id}
152 |                     >
153 |                       <Badge variant="tag" className="whitespace-nowrap">
154 |                         {tag.tag.name}
155 |                       </Badge>
156 |                     </Link>
157 |                   ))}
158 |                 </div>
159 |
160 |                 <ScrollBar orientation="horizontal" />
161 |               </ScrollArea>
162 |
[TRUNCATED]
```

apps/dashboard/src/components/tables/tracker/data-table.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Spinner } from "@midday/ui/spinner";
5 | import { Table, TableBody } from "@midday/ui/table";
6 | import { useEffect, useState } from "react";
7 | import { useInView } from "react-intersection-observer";
8 | import { DataTableHeader } from "./data-table-header";
9 | import { DataTableRow } from "./data-table-row";
10 |
11 | export type TrackerProject = {
12 |   id: string;
13 |   name: string;
14 |   description: string;
15 |   status: "active" | "completed";
16 |   total_duration: number;
17 |   estimate?: number;
18 |   rate?: number;
19 |   currency?: string;
20 |   customer?: {
21 |     id: string;
22 |     name: string;
23 |     website: string;
24 |   };
25 |   users: {
26 |     id: string;
27 |     full_name: string;
28 |     avatar_url?: string;
29 |   }[];
30 | };
31 |
32 | type DataTableProps = {
33 |   data: TrackerProject[];
34 |   pageSize: number;
35 |   userId: string;
36 |   meta: {
37 |     count: number;
38 |   };
39 |   loadMore: (params: { from: number; to: number }) => Promise<{
40 |     data: TrackerProject[];
41 |     meta: { count: number };
42 |   }>;
43 | };
44 |
45 | export function DataTable({
46 |   data: initialData,
47 |   pageSize,
48 |   meta,
49 |   loadMore,
50 |   userId,
51 | }: DataTableProps) {
52 |   const [data, setData] = useState(initialData);
53 |   const [from, setFrom] = useState(pageSize);
54 |   const { ref, inView } = useInView();
55 |   const [hasNextPage, setHasNextPage] = useState(meta.count > pageSize);
56 |
57 |   useEffect(() => {
58 |     if (inView) {
59 |       loadMoreData();
60 |     }
61 |   }, [inView]);
62 |
63 |   useEffect(() => {
64 |     setData(initialData);
65 |   }, [initialData]);
66 |
67 |   const loadMoreData = async () => {
68 |     const formatedFrom = from;
69 |     const to = formatedFrom + pageSize;
70 |
71 |     try {
72 |       const { data, meta } = await loadMore({
73 |         from: formatedFrom,
74 |         to,
75 |       });
76 |
77 |       setData((prev) => [...prev, ...data]);
78 |       setFrom(to);
79 |       setHasNextPage(meta.count > to);
80 |     } catch {
81 |       setHasNextPage(false);
82 |     }
83 |   };
84 |
85 |   return (
86 |     <>
87 |       <Table>
88 |         <DataTableHeader />
89 |
90 |         <TableBody>
91 |           {data.map((row) => (
92 |             <DataTableRow row={row} key={row.id} userId={userId} />
93 |           ))}
94 |         </TableBody>
95 |       </Table>
96 |
97 |       {hasNextPage && (
98 |         <div className="flex items-center justify-center mt-6" ref={ref}>
99 |           <Button variant="outline" className="space-x-2 px-6 py-5">
100 |             <Spinner />
101 |             <span className="text-sm text-[#606060]">Loading more...</span>
102 |           </Button>
103 |         </div>
104 |       )}
105 |     </>
106 |   );
107 | }
```

apps/dashboard/src/components/tables/tracker/empty-states.tsx
```
1 | "use client";
2 |
3 | import { useTrackerParams } from "@/hooks/use-tracker-params";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function EmptyState() {
7 |   const { setParams } = useTrackerParams();
8 |
9 |   return (
10 |     <div className="flex items-center justify-center ">
11 |       <div className="flex flex-col items-center mt-14">
12 |         <div className="text-center mb-6 space-y-2">
13 |           <h2 className="font-medium text-lg">No projects</h2>
14 |           <p className="text-[#606060] text-sm">
15 |             You haven't created any projects yet. <br />
16 |             Go ahead and create your first one.
17 |           </p>
18 |         </div>
19 |
20 |         <Button
21 |           variant="outline"
22 |           onClick={() =>
23 |             setParams({
24 |               create: true,
25 |             })
26 |           }
27 |         >
28 |           Create project
29 |         </Button>
30 |       </div>
31 |     </div>
32 |   );
33 | }
34 |
35 | export function NoResults() {
36 |   const { setParams } = useTrackerParams();
37 |
38 |   return (
39 |     <div className="flex items-center justify-center ">
40 |       <div className="flex flex-col items-center mt-14">
41 |         <div className="text-center mb-6 space-y-2">
42 |           <h2 className="font-medium text-lg">No results</h2>
43 |           <p className="text-[#606060] text-sm">
44 |             Try another search, or adjusting the filters
45 |           </p>
46 |         </div>
47 |
48 |         <Button
49 |           variant="outline"
50 |           onClick={() => setParams(null, { shallow: false })}
51 |         >
52 |           Clear filters
53 |         </Button>
54 |       </div>
55 |     </div>
56 |   );
57 | }
```

apps/dashboard/src/components/tables/tracker/index.tsx
```
1 | import { DataTable } from "@/components/tables/tracker/data-table";
2 | import { getTrackerProjects } from "@midday/supabase/cached-queries";
3 | import { EmptyState, NoResults } from "./empty-states";
4 |
5 | const pageSize = 20;
6 |
7 | type Props = {
8 |   status?: string;
9 |   sort?: string;
10 |   q?: string;
11 |   start?: string;
12 |   end?: string;
13 |   userId: string;
14 |   customerIds?: string[];
15 | };
16 |
17 | export async function Table({
18 |   status,
19 |   sort,
20 |   q,
21 |   start,
22 |   end,
23 |   userId,
24 |   customerIds,
25 | }: Props) {
26 |   const hasFilters = Boolean(status || q);
27 |
28 |   const { data, meta } = await getTrackerProjects({
29 |     from: 0,
30 |     to: pageSize,
31 |     sort,
32 |     start,
33 |     end,
34 |     filter: { status, customers: customerIds },
35 |     search: {
36 |       query: q,
37 |       fuzzy: true,
38 |     },
39 |   });
40 |
41 |   async function loadMore({ from, to }) {
42 |     "use server";
43 |
44 |     return getTrackerProjects({
45 |       to,
46 |       from: from + 1,
47 |       sort,
48 |       filter: {
49 |         status,
50 |         customers: customerIds,
51 |       },
52 |       search: {
53 |         query: q,
54 |         fuzzy: true,
55 |       },
56 |     });
57 |   }
58 |
59 |   if (!data?.length && !hasFilters) {
60 |     return <EmptyState />;
61 |   }
62 |
63 |   if (!data?.length && hasFilters) {
64 |     return <NoResults />;
65 |   }
66 |
67 |   return (
68 |     <DataTable
69 |       data={data}
70 |       pageSize={pageSize}
71 |       loadMore={loadMore}
72 |       meta={meta}
73 |       userId={userId}
74 |     />
75 |   );
76 | }
```

apps/dashboard/src/components/tables/tracker/loading.tsx
```
1 | "use client";
2 | import { Skeleton } from "@midday/ui/skeleton";
3 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
4 | import { DataTableHeader } from "./data-table-header";
5 |
6 | const data = [...Array(10)].map((_, i) => ({ id: i.toString() }));
7 |
8 | export function Loading() {
9 |   return (
10 |     <Table>
11 |       <DataTableHeader />
12 |
13 |       <TableBody>
14 |         {data?.map((row) => (
15 |           <TableRow key={row.id} className="h-[45px]">
16 |             <TableCell className="w-[440px]">
17 |               <Skeleton className="h-3.5 w-[305px]" />
18 |             </TableCell>
19 |
20 |             <TableCell className="w-[140px]">
21 |               <Skeleton className="h-3.5 w-[60%]" />
22 |             </TableCell>
23 |             <TableCell className="w-[430px]">
24 |               <Skeleton className="h-3.5 w-[50%]" />
25 |             </TableCell>
26 |
27 |             <TableCell>
28 |               <Skeleton className="h-3.5 w-[50%]" />
29 |             </TableCell>
30 |           </TableRow>
31 |         ))}
32 |       </TableBody>
33 |     </Table>
34 |   );
35 | }
```

apps/dashboard/src/components/tables/transactions/bottom-bar.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { formatAmount } from "@/utils/format";
6 | import { Icons } from "@midday/ui/icons";
7 | import {
8 |   Tooltip,
9 |   TooltipContent,
10 |   TooltipProvider,
11 |   TooltipTrigger,
12 | } from "@midday/ui/tooltip";
13 | import { AnimatePresence, motion } from "framer-motion";
14 |
15 | type Props = {
16 |   count: number;
17 |   show: boolean;
18 |   totalAmount?: {
19 |     amount: number;
20 |     currency: string;
21 |   }[];
22 | };
23 |
24 | export function BottomBar({ count, show, totalAmount }: Props) {
25 |   const { locale } = useUserContext((state) => state.data);
26 |   const multiCurrency = totalAmount && totalAmount.length > 1;
27 |   const t = useI18n();
28 |   const first = totalAmount && totalAmount.at(0);
29 |
30 |   const amountPerCurrency =
31 |     totalAmount &&
32 |     totalAmount
33 |       .map((total) =>
34 |         formatAmount({
35 |           amount: total?.amount,
36 |           currency: total.currency,
37 |           locale,
38 |         }),
39 |       )
40 |       .join(", ");
41 |
42 |   return (
43 |     <AnimatePresence>
44 |       <motion.div
45 |         className="h-12 fixed bottom-2 left-0 right-0 pointer-events-none flex justify-center"
46 |         animate={{ y: show ? 0 : 100 }}
47 |         initial={{ y: 100 }}
48 |       >
49 |         <div className="pointer-events-auto backdrop-filter backdrop-blur-lg dark:bg-[#1A1A1A]/80 bg-[#F6F6F3]/80 h-12 justify-between items-center flex px-4 border dark:border-[#2C2C2C] border-[#DCDAD2] rounded-full space-x-2">
50 |           <TooltipProvider delayDuration={0}>
51 |             <Tooltip>
52 |               <TooltipTrigger className="flex items-center space-x-2">
53 |                 <Icons.Info className="text-[#606060]" />
54 |                 <span className="text-sm">
55 |                   {multiCurrency
56 |                     ? t("bottom_bar.multi_currency")
57 |                     : first &&
58 |                       formatAmount({
59 |                         amount: first?.amount,
60 |                         currency: first?.currency,
61 |                         locale,
62 |                         maximumFractionDigits: 0,
63 |                         minimumFractionDigits: 0,
64 |                       })}
65 |                 </span>
66 |               </TooltipTrigger>
67 |               <TooltipContent sideOffset={30} className="px-3 py-1.5 text-xs">
68 |                 {multiCurrency
69 |                   ? amountPerCurrency
70 |                   : t("bottom_bar.description")}
71 |               </TooltipContent>
72 |             </Tooltip>
73 |           </TooltipProvider>
74 |
75 |           <span className="text-sm text-[#878787]">
76 |             ({t("bottom_bar.transactions", { count })})
77 |           </span>
78 |         </div>
79 |       </motion.div>
80 |     </AnimatePresence>
81 |   );
82 | }
```

apps/dashboard/src/components/tables/transactions/columns.tsx
```
1 | "use client";
2 |
3 | import { AssignedUser } from "@/components/assigned-user";
4 | import { Category } from "@/components/category";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { TransactionBankAccount } from "@/components/transaction-bank-account";
7 | import { TransactionMethod } from "@/components/transaction-method";
8 | import { TransactionStatus } from "@/components/transaction-status";
9 | import { formatDate } from "@/utils/format";
10 | import {
11 |   AlertDialog,
12 |   AlertDialogAction,
13 |   AlertDialogCancel,
14 |   AlertDialogContent,
15 |   AlertDialogDescription,
16 |   AlertDialogFooter,
17 |   AlertDialogHeader,
18 |   AlertDialogTitle,
19 |   AlertDialogTrigger,
20 | } from "@midday/ui/alert-dialog";
21 | import { Badge } from "@midday/ui/badge";
22 | import { Button } from "@midday/ui/button";
23 | import { Checkbox } from "@midday/ui/checkbox";
24 | import { cn } from "@midday/ui/cn";
25 | import {
26 |   DropdownMenu,
27 |   DropdownMenuContent,
28 |   DropdownMenuItem,
29 |   DropdownMenuSeparator,
30 |   DropdownMenuTrigger,
31 | } from "@midday/ui/dropdown-menu";
32 | import { Icons } from "@midday/ui/icons";
33 | import { ScrollArea, ScrollBar } from "@midday/ui/scroll-area";
34 | import {
35 |   Tooltip,
36 |   TooltipContent,
37 |   TooltipProvider,
38 |   TooltipTrigger,
39 | } from "@midday/ui/tooltip";
40 | import type { ColumnDef } from "@tanstack/react-table";
41 | import { Loader2 } from "lucide-react";
42 |
43 | export type Transaction = {
44 |   id: string;
45 |   amount: number;
46 |   status: "posted" | "excluded" | "included" | "pending" | "completed";
47 |   frequency?: string;
48 |   recurring?: boolean;
49 |   manual?: boolean;
50 |   date: string;
51 |   category?: {
52 |     slug: string;
53 |     name: string;
54 |     color: string;
55 |   };
56 |   name: string;
57 |   description?: string;
58 |   currency: string;
59 |   method: string;
60 |   attachments?: {
61 |     id: string;
62 |     path: string;
63 |     name: string;
64 |     type: string;
65 |     size: number;
66 |   }[];
67 |   assigned?: {
68 |     avatar_url: string;
69 |     full_name: string;
70 |   };
71 |   bank_account?: {
72 |     name: string;
73 |     bank_connection: {
74 |       logo_url: string;
75 |     };
76 |   };
77 |   tags?: {
78 |     id: string;
79 |     name: string;
80 |   }[];
81 | };
82 |
83 | export const columns: ColumnDef<Transaction>[] = [
84 |   {
85 |     id: "select",
86 |     cell: ({ row }) => (
87 |       <Checkbox
88 |         checked={row.getIsSelected()}
89 |         onCheckedChange={(value) => row.toggleSelected(!!value)}
90 |       />
91 |     ),
92 |     enableSorting: false,
93 |     enableHiding: false,
94 |   },
95 |   {
96 |     accessorKey: "date",
97 |     header: "Date",
98 |     cell: ({ row, table }) => {
99 |       return formatDate(row.original.date, table.options.meta?.dateFormat);
100 |     },
101 |   },
102 |   {
103 |     accessorKey: "description",
104 |     header: "Description",
105 |     cell: ({ row }) => {
106 |       return (
107 |         <div className="flex items-center space-x-2">
108 |           <TooltipProvider delayDuration={20}>
109 |             <Tooltip>
110 |               <TooltipTrigger asChild>
111 |                 <span
112 |                   className={cn(
113 |                     row.original?.category?.slug === "income" &&
114 |                       "text-[#00C969]",
115 |                   )}
116 |                 >
117 |                   <div className="flex space-x-2 items-center">
118 |                     <span className="line-clamp-1 text-ellipsis max-w-[100px] md:max-w-none">
119 |                       {row.original.name}
120 |                     </span>
121 |
122 |                     {row.original.status === "pending" && (
123 |                       <div className="flex space-x-1 items-center border rounded-md text-[10px] py-1 px-2 h-[22px] text-[#878787]">
124 |                         <span>Pending</span>
125 |                       </div>
126 |                     )}
127 |                   </div>
128 |                 </span>
129 |               </TooltipTrigger>
130 |
131 |               {row.original?.description && (
132 |                 <TooltipContent
133 |                   className="px-3 py-1.5 text-xs max-w-[380px]"
134 |                   side="left"
135 |                   sideOffset={10}
136 |                 >
137 |                   {row.original.description}
138 |                 </TooltipContent>
139 |               )}
140 |             </Tooltip>
141 |           </TooltipProvider>
142 |         </div>
143 |       );
144 |     },
145 |   },
146 |   {
147 |     accessorKey: "amount",
148 |     header: "Amount",
149 |     cell: ({ row }) => {
150 |       return (
151 |         <span
152 |           className={cn(
153 |             "text-sm",
154 |             row.original?.category?.slug === "income" && "text-[#00C969]",
155 |           )}
156 |         >
157 |           <FormatAmount
158 |             amount={row.original.amount}
159 |             currency={row.original.currency}
160 |           />
161 |         </span>
162 |       );
163 |     },
164 |   },
165 |   {
166 |     accessorKey: "category",
167 |     header: "Category",
168 |     cell: ({ row }) => {
169 |       return (
170 |         <Category
171 |           name={row.original?.category?.name}
172 |           color={row.original?.category?.color}
173 |         />
174 |       );
175 |     },
176 |   },
177 |   {
178 |     accessorKey: "tags",
179 |     header: "Tags",
180 |     cell: ({ row }) => {
181 |       return (
182 |         <div className="relative">
183 |           <ScrollArea className="max-w-[170px] whitespace-nowrap">
[TRUNCATED]
```

apps/dashboard/src/components/tables/transactions/data-table-header.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import { Checkbox } from "@midday/ui/checkbox";
5 | import { TableHead, TableHeader, TableRow } from "@midday/ui/table";
6 | import { ArrowDown, ArrowUp } from "lucide-react";
7 | import { usePathname, useRouter, useSearchParams } from "next/navigation";
8 | import { useCallback } from "react";
9 |
10 | type Props = {
11 |   table?: any;
12 |   loading?: boolean;
13 | };
14 |
15 | export function DataTableHeader({ table, loading }: Props) {
16 |   const searchParams = useSearchParams();
17 |   const pathname = usePathname();
18 |   const router = useRouter();
19 |   const [column, value] = searchParams.get("sort")
20 |     ? searchParams.get("sort")?.split(":")
21 |     : [];
22 |
23 |   const createSortQuery = useCallback(
24 |     (name: string) => {
25 |       const params = new URLSearchParams(searchParams);
26 |       const prevSort = params.get("sort");
27 |
28 |       if (`${name}:asc` === prevSort) {
29 |         params.set("sort", `${name}:desc`);
30 |       } else if (`${name}:desc` === prevSort) {
31 |         params.delete("sort");
32 |       } else {
33 |         params.set("sort", `${name}:asc`);
34 |       }
35 |
36 |       router.replace(`${pathname}?${params.toString()}`);
37 |     },
38 |     [searchParams, router, pathname],
39 |   );
40 |
41 |   const isVisible = (id) =>
42 |     loading ||
43 |     table
44 |       ?.getAllLeafColumns()
45 |       .find((col) => col.id === id)
46 |       .getIsVisible();
47 |
48 |   return (
49 |     <TableHeader>
50 |       <TableRow className="h-[45px] hover:bg-transparent">
51 |         <TableHead className="min-w-[50px] hidden md:table-cell px-3 md:px-4 py-2">
52 |           <Checkbox
53 |             checked={
54 |               table?.getIsAllPageRowsSelected() ||
55 |               (table?.getIsSomePageRowsSelected() && "indeterminate")
56 |             }
57 |             onCheckedChange={(value) =>
58 |               table.toggleAllPageRowsSelected(!!value)
59 |             }
60 |           />
61 |         </TableHead>
62 |
63 |         {isVisible("date") && (
64 |           <TableHead className="min-w-[120px] px-3 md:px-4 py-2">
65 |             <Button
66 |               className="p-0 hover:bg-transparent space-x-2"
67 |               variant="ghost"
68 |               onClick={() => createSortQuery("date")}
69 |             >
70 |               <span>Date</span>
71 |               {"date" === column && value === "asc" && <ArrowDown size={16} />}
72 |               {"date" === column && value === "desc" && <ArrowUp size={16} />}
73 |             </Button>
74 |           </TableHead>
75 |         )}
76 |
77 |         {isVisible("description") && (
78 |           <TableHead className="w-[100px] md:w-[320px] px-3 md:px-4 py-2">
79 |             <Button
80 |               className="p-0 hover:bg-transparent space-x-2"
81 |               variant="ghost"
82 |               onClick={() => createSortQuery("name")}
83 |             >
84 |               <span>Description</span>
85 |               {"name" === column && value === "asc" && <ArrowDown size={16} />}
86 |               {"name" === column && value === "desc" && <ArrowUp size={16} />}
87 |             </Button>
88 |           </TableHead>
89 |         )}
90 |
91 |         {isVisible("amount") && (
92 |           <TableHead className="md:min-w-[200px] px-3 md:px-4 py-2">
93 |             <Button
94 |               className="p-0 hover:bg-transparent space-x-2"
95 |               variant="ghost"
96 |               onClick={() => createSortQuery("amount")}
97 |             >
98 |               <span>Amount</span>
99 |               {"amount" === column && value === "asc" && (
100 |                 <ArrowDown size={16} />
101 |               )}
102 |               {"amount" === column && value === "desc" && <ArrowUp size={16} />}
103 |             </Button>
104 |           </TableHead>
105 |         )}
106 |
107 |         {isVisible("category") && (
108 |           <TableHead className="md:min-w-[200px] hidden md:table-cell px-3 md:px-4 py-2">
109 |             <Button
110 |               className="p-0 hover:bg-transparent space-x-2"
111 |               variant="ghost"
112 |               onClick={() => createSortQuery("category")}
113 |             >
114 |               <span>Category</span>
115 |               {"category" === column && value === "asc" && (
116 |                 <ArrowDown size={16} />
117 |               )}
118 |               {"category" === column && value === "desc" && (
119 |                 <ArrowUp size={16} />
120 |               )}
121 |             </Button>
122 |           </TableHead>
123 |         )}
124 |
125 |         {isVisible("tags") && (
126 |           <TableHead className="md:min-w-[170px] hidden md:table-cell px-3 md:px-4 py-2">
127 |             <Button
128 |               className="p-0 hover:bg-transparent space-x-2"
129 |               variant="ghost"
130 |               onClick={() => createSortQuery("tags")}
131 |             >
132 |               <span>Tags</span>
133 |             </Button>
134 |           </TableHead>
135 |         )}
136 |
137 |         {isVisible("bank_account") && (
138 |           <TableHead className="md:w-[250px] hidden md:table-cell px-3 md:px-4 py-2">
139 |             <Button
140 |               className="p-0 hover:bg-transparent space-x-2"
141 |               variant="ghost"
142 |               onClick={() => createSortQuery("bank_account")}
143 |             >
144 |               <span>Account</span>
145 |               {"bank_account" === column && value === "asc" && (
[TRUNCATED]
```

apps/dashboard/src/components/tables/transactions/data-table.tsx
```
1 | "use client";
2 |
3 | import { deleteTransactionsAction } from "@/actions/delete-transactions-action";
4 | import type { UpdateTransactionValues } from "@/actions/schema";
5 | import { updateColumnVisibilityAction } from "@/actions/update-column-visibility-action";
6 | import { updateTransactionAction } from "@/actions/update-transaction-action";
7 | import { TransactionSheet } from "@/components/sheets/transaction-sheet";
8 | import { useTransactionsStore } from "@/store/transactions";
9 | import { useUserContext } from "@/store/user/hook";
10 | import { Cookies } from "@/utils/constants";
11 | import { Button } from "@midday/ui/button";
12 | import { cn } from "@midday/ui/cn";
13 | import { Spinner } from "@midday/ui/spinner";
14 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
15 | import { useToast } from "@midday/ui/use-toast";
16 | import {
17 |   type ColumnDef,
18 |   type VisibilityState,
19 |   flexRender,
20 |   getCoreRowModel,
21 |   useReactTable,
22 | } from "@tanstack/react-table";
23 | import { useAction } from "next-safe-action/hooks";
24 | import { useQueryState } from "nuqs";
25 | import { useEffect } from "react";
26 | import { useState } from "react";
27 | import { useInView } from "react-intersection-observer";
28 | import { BottomBar } from "./bottom-bar";
29 | import { DataTableHeader } from "./data-table-header";
30 | import { ExportBar } from "./export-bar";
31 |
32 | interface DataTableProps<TData, TValue> {
33 |   columns: ColumnDef<TData, TValue>[];
34 |   data: TData[];
35 |   hasNextPage?: boolean;
36 |   hasFilters?: boolean;
37 |   loadMore: () => void;
38 |   query?: string;
39 |   pageSize: number;
40 |   meta: Record<string, string>;
41 |   initialColumnVisibility: VisibilityState;
42 | }
43 |
44 | export function DataTable<TData, TValue>({
45 |   columns,
46 |   query,
47 |
48 |   data: initialData,
49 |   pageSize,
50 |   loadMore,
51 |   meta: pageMeta,
52 |   hasFilters,
53 |   hasNextPage: initialHasNextPage,
54 |   initialColumnVisibility,
55 | }: DataTableProps<TData, TValue>) {
56 |   const { toast } = useToast();
57 |   const [data, setData] = useState(initialData);
58 |   const [from, setFrom] = useState(pageSize);
59 |   const { ref, inView } = useInView();
60 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
61 |
62 |   const [hasNextPage, setHasNextPage] = useState(initialHasNextPage);
63 |   const { setColumns, setCanDelete, rowSelection, setRowSelection } =
64 |     useTransactionsStore();
65 |
66 |   const [transactionId, setTransactionId] = useQueryState("id");
67 |   const selectedRows = Object.keys(rowSelection).length;
68 |
69 |   const showBottomBar =
70 |     (hasFilters && !selectedRows) || (query && !selectedRows);
71 |
72 |   const [columnVisibility, setColumnVisibility] = useState<VisibilityState>(
73 |     initialColumnVisibility ?? {},
74 |   );
75 |
76 |   const updateTransaction = useAction(updateTransactionAction, {
77 |     onSuccess: ({ data }) => {
78 |       if (data?.status === "excluded") {
79 |         toast({
80 |           duration: 3500,
81 |           title: "Transaction excluded",
82 |           description:
83 |             "You can view excluded transactions by adding the filter excluded.",
84 |         });
85 |       }
86 |     },
87 |     onError: () => {
88 |       toast({
89 |         duration: 3500,
90 |         variant: "error",
91 |         title: "Something went wrong please try again.",
92 |       });
93 |     },
94 |   });
95 |
96 |   const handleUpdateTransaction = (
97 |     values: UpdateTransactionValues,
98 |     optimisticData?: any,
99 |   ) => {
100 |     setData((prev) => {
101 |       return prev.map((item) => {
102 |         if (item.id === values.id) {
103 |           return {
104 |             ...item,
105 |             ...values,
106 |             ...(optimisticData ?? {}),
107 |           };
108 |         }
109 |
110 |         return item;
111 |       });
112 |     });
113 |
114 |     updateTransaction.execute(values);
115 |   };
116 |
117 |   const deleteTransactions = useAction(deleteTransactionsAction, {
118 |     onError: () => {
119 |       toast({
120 |         duration: 3500,
121 |         variant: "error",
122 |         title: "Something went wrong please try again.",
123 |       });
124 |     },
125 |   });
126 |
127 |   const handleDeleteTransactions = ({ ids }) => {
128 |     setData((prev) => {
129 |       return prev.filter((item) => !ids?.includes(item.id));
130 |     });
131 |
132 |     deleteTransactions.execute({ ids });
133 |   };
134 |
135 |   const setOpen = (id: string | boolean) => {
136 |     if (id) {
137 |       setTransactionId(id);
138 |     } else {
139 |       setTransactionId(null);
140 |     }
141 |   };
142 |
143 |   const handleCopyUrl = async (id: string) => {
144 |     try {
145 |       await navigator.clipboard.writeText(
146 |         `${window.location.origin}/transactions?id=${id}`,
147 |       );
148 |
149 |       toast({
150 |         duration: 4000,
151 |         title: "Copied URL to clipboard.",
152 |         variant: "success",
153 |       });
154 |     } catch {}
155 |   };
156 |
157 |   const table = useReactTable({
158 |     getRowId: (row) => row.id,
159 |     data,
160 |     columns,
161 |     getCoreRowModel: getCoreRowModel(),
162 |     onRowSelectionChange: setRowSelection,
163 |     onColumnVisibilityChange: setColumnVisibility,
164 |     meta: {
165 |       setOpen,
166 |       copyUrl: handleCopyUrl,
167 |       updateTransaction: handleUpdateTransaction,
168 |       deleteTransactions: handleDeleteTransactions,
169 |       dateFormat,
170 |     },
171 |     state: {
172 |       rowSelection,
173 |       columnVisibility,
174 |     },
175 |   });
176 |
177 |   const loadMoreData = async () => {
178 |     const formatedFrom = from;
179 |     const to = formatedFrom + pageSize * 2;
180 |
181 |     try {
[TRUNCATED]
```

apps/dashboard/src/components/tables/transactions/empty-states.tsx
```
1 | "use client";
2 |
3 | import { AddAccountButton } from "@/components/add-account-button";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import { useRouter } from "next/navigation";
7 |
8 | type Props = {
9 |   hasFilters?: boolean;
10 | };
11 |
12 | export function NoResults({ hasFilters }: Props) {
13 |   const router = useRouter();
14 |
15 |   return (
16 |     <div className="h-[calc(100vh-300px)] flex items-center justify-center">
17 |       <div className="flex flex-col items-center">
18 |         <Icons.Transactions2 className="mb-4" />
19 |         <div className="text-center mb-6 space-y-2">
20 |           <h2 className="font-medium text-lg">No results</h2>
21 |           <p className="text-[#606060] text-sm">
22 |             {hasFilters
23 |               ? "Try another search, or adjusting the filters"
24 |               : "There are no transactions imported yet"}
25 |           </p>
26 |         </div>
27 |
28 |         {hasFilters && (
29 |           <Button
30 |             variant="outline"
31 |             onClick={() => router.push("/transactions")}
32 |           >
33 |             Clear filters
34 |           </Button>
35 |         )}
36 |       </div>
37 |     </div>
38 |   );
39 | }
40 |
41 | export function NoAccounts() {
42 |   return (
43 |     <div className="absolute w-full h-[calc(100vh-300px)] top-0 left-0 flex items-center justify-center z-20">
44 |       <div className="text-center max-w-sm mx-auto flex flex-col items-center justify-center">
45 |         <h2 className="text-xl font-medium mb-2">Connect bank account</h2>
46 |         <p className="text-sm text-[#878787] mb-6">
47 |           Get instant transaction insights. Easily spot missing receipts,
48 |           categorize expenses, and reconcile everything seamlessly for
49 |           accounting.
50 |         </p>
51 |
52 |         <AddAccountButton />
53 |       </div>
54 |     </div>
55 |   );
56 | }
```

apps/dashboard/src/components/tables/transactions/export-bar.tsx
```
1 | import { exportTransactionsAction } from "@/actions/export-transactions-action";
2 | import { useExportStore } from "@/store/export";
3 | import { useTransactionsStore } from "@/store/transactions";
4 | import { Button } from "@midday/ui/button";
5 | import { useToast } from "@midday/ui/use-toast";
6 | import { AnimatePresence, motion } from "framer-motion";
7 | import { Loader2 } from "lucide-react";
8 | import { useAction } from "next-safe-action/hooks";
9 | import { useEffect, useState } from "react";
10 |
11 | type Props = {
12 |   selected: boolean;
13 | };
14 |
15 | export function ExportBar({ selected }: Props) {
16 |   const { toast } = useToast();
17 |   const { setExportData } = useExportStore();
18 |   const { rowSelection, setRowSelection } = useTransactionsStore();
19 |   const [isOpen, setOpen] = useState(false);
20 |
21 |   const { execute, status } = useAction(exportTransactionsAction, {
22 |     onSuccess: ({ data }) => {
23 |       if (data?.id && data?.publicAccessToken) {
24 |         setExportData({
25 |           runId: data.id,
26 |           accessToken: data.publicAccessToken,
27 |         });
28 |
29 |         setRowSelection(() => ({}));
30 |       }
31 |
32 |       setOpen(false);
33 |     },
34 |     onError: () => {
35 |       toast({
36 |         duration: 3500,
37 |         variant: "error",
38 |         title: "Something went wrong please try again.",
39 |       });
40 |     },
41 |   });
42 |
43 |   useEffect(() => {
44 |     if (selected) {
45 |       setOpen(true);
46 |     } else {
47 |       setOpen(false);
48 |     }
49 |   }, [selected]);
50 |
51 |   return (
52 |     <AnimatePresence>
53 |       <motion.div
54 |         className="h-12 fixed left-[50%] bottom-2 w-[400px] -ml-[200px]"
55 |         animate={{ y: isOpen ? 0 : 100 }}
56 |         initial={{ y: 100 }}
57 |       >
58 |         <div className="mx-2 md:mx-0 backdrop-filter backdrop-blur-lg dark:bg-[#1A1A1A]/80 bg-[#F6F6F3]/80 h-12 justify-between items-center flex px-4 border dark:border-[#2C2C2C] border-[#DCDAD2] rounded-full">
59 |           <span className="text-sm">{selected} selected</span>
60 |
61 |           <div className="flex items-center space-x-4">
62 |             <button
63 |               type="button"
64 |               onClick={() => setRowSelection(() => ({}))}
65 |               className="text-sm"
66 |             >
67 |               Deselect all
68 |             </button>
69 |             <Button
70 |               className="h-8 text-sm"
71 |               onClick={() => execute(Object.keys(rowSelection))}
72 |               disabled={status === "executing"}
73 |             >
74 |               {status === "executing" ? (
75 |                 <Loader2 className="h-4 w-4 animate-spin" />
76 |               ) : (
77 |                 `Export (${selected})`
78 |               )}
79 |             </Button>
80 |           </div>
81 |         </div>
82 |       </motion.div>
83 |     </AnimatePresence>
84 |   );
85 | }
```

apps/dashboard/src/components/tables/transactions/index.tsx
```
1 | import { DataTable } from "@/components/tables/transactions/data-table";
2 | import { Cookies } from "@/utils/constants";
3 | import { getTransactions } from "@midday/supabase/cached-queries";
4 | import { cookies } from "next/headers";
5 | import { columns } from "./columns";
6 | import { NoResults } from "./empty-states";
7 |
8 | const pageSize = 50;
9 | const maxItems = 100000;
10 |
11 | type Props = {
12 |   filter: any;
13 |   page: number;
14 |   sort: any;
15 |   query: string | null;
16 | };
17 |
18 | export async function Table({ filter, page, sort, query }: Props) {
19 |   const hasFilters = Object.values(filter).some((value) => value !== null);
20 |   const initialColumnVisibility = JSON.parse(
21 |     cookies().get(Cookies.TransactionsColumns)?.value || "[]",
22 |   );
23 |
24 |   // NOTE: When we have a filter we want to show all results so users can select
25 |   // And handle all in once (export etc)
26 |   const transactions = await getTransactions({
27 |     to: hasFilters ? maxItems : page > 0 ? pageSize : pageSize - 1,
28 |     from: 0,
29 |     filter,
30 |     sort,
31 |     searchQuery: query ?? undefined,
32 |   });
33 |
34 |   const { data, meta } = transactions ?? {};
35 |
36 |   async function loadMore({ from, to }: { from: number; to: number }) {
37 |     "use server";
38 |
39 |     return getTransactions({
40 |       to,
41 |       from: from + 1,
42 |       filter,
43 |       sort,
44 |       searchQuery: query ?? undefined,
45 |     });
46 |   }
47 |
48 |   if (!data?.length) {
49 |     if (query?.length) {
50 |       return <NoResults hasFilters />;
51 |     }
52 |
53 |     return <NoResults hasFilters={hasFilters} />;
54 |   }
55 |
56 |   const hasNextPage = Boolean(
57 |     meta?.count && meta.count / (page + 1) > pageSize,
58 |   );
59 |
60 |   return (
61 |     <DataTable
62 |       initialColumnVisibility={initialColumnVisibility}
63 |       columns={columns}
64 |       data={data}
65 |       pageSize={pageSize}
66 |       loadMore={loadMore}
67 |       hasNextPage={hasNextPage}
68 |       meta={meta}
69 |       hasFilters={hasFilters}
70 |       page={page}
71 |       query={query}
72 |     />
73 |   );
74 | }
```

apps/dashboard/src/components/tables/transactions/loading.tsx
```
1 | "use client";
2 | import { cn } from "@midday/ui/cn";
3 | import { Skeleton } from "@midday/ui/skeleton";
4 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
5 | import { DataTableHeader } from "./data-table-header";
6 |
7 | const data = [...Array(40)].map((_, i) => ({ id: i.toString() }));
8 |
9 | export function Loading({ isEmpty }: { isEmpty?: boolean }) {
10 |   return (
11 |     <Table
12 |       className={cn(isEmpty && "opacity-20 pointer-events-none blur-[7px]")}
13 |     >
14 |       <DataTableHeader loading />
15 |
16 |       <TableBody>
17 |         {data?.map((row) => (
18 |           <TableRow key={row.id} className="h-[45px]">
19 |             <TableCell className="w-[50px]">
20 |               <Skeleton
21 |                 className={cn("h-3.5 w-[15px]", isEmpty && "animate-none")}
22 |               />
23 |             </TableCell>
24 |
25 |             <TableCell className="w-[100px]">
26 |               <Skeleton
27 |                 className={cn("h-3.5 w-[60%]", isEmpty && "animate-none")}
28 |               />
29 |             </TableCell>
30 |             <TableCell className="w-[430px]">
31 |               <Skeleton
32 |                 className={cn("h-3.5 w-[50%]", isEmpty && "animate-none")}
33 |               />
34 |             </TableCell>
35 |             <TableCell className="w-[200px]">
36 |               <Skeleton
37 |                 className={cn("h-3.5 w-[50%]", isEmpty && "animate-none")}
38 |               />
39 |             </TableCell>
40 |
41 |             <TableCell className="w-[200px]">
42 |               <Skeleton
43 |                 className={cn("h-3.5 w-[60%]", isEmpty && "animate-none")}
44 |               />
45 |             </TableCell>
46 |             <TableCell className="w-[150px]">
47 |               <Skeleton
48 |                 className={cn("h-3.5 w-[80px]", isEmpty && "animate-none")}
49 |               />
50 |             </TableCell>
51 |             <TableCell className="w-[200px]">
52 |               <div className="flex items-center space-x-2 w-[80%]">
53 |                 <Skeleton className="h-5 w-5 rounded-full" />
54 |                 <Skeleton
55 |                   className={cn("h-3.5 w-[70%]", isEmpty && "animate-none")}
56 |                 />
57 |               </div>
58 |             </TableCell>
59 |             <TableCell className="w-50px">
60 |               <Skeleton
61 |                 className={cn(
62 |                   "h-[20px] w-[20px] rounded-full",
63 |                   isEmpty && "animate-none",
64 |                 )}
65 |               />
66 |             </TableCell>
67 |             <TableCell className="w-60px" />
68 |           </TableRow>
69 |         ))}
70 |       </TableBody>
71 |     </Table>
72 |   );
73 | }
```

apps/dashboard/src/components/tables/vault/contants.ts
```
1 | export const DEFAULT_FOLDER_NAME = "Untitled Folder";
2 |
3 | export const TAGS = [
4 |   "bylaws",
5 |   "shareholder_agreements",
6 |   "board_meeting",
7 |   "corporate_policies",
8 |   "annual_reports",
9 |   "budget_reports",
10 |   "audit_reports",
11 |   "tax_returns",
12 |   "invoices_and_receipts",
13 |   "employee_handbook",
14 |   "payroll_records",
15 |   "performance_reviews",
16 |   "employee_training_materials",
17 |   "benefits_documentation",
18 |   "termination_letters",
19 |   "patents",
20 |   "trademarks",
21 |   "copyrights",
22 |   "client_contracts",
23 |   "vendor_agreements",
24 |   "compliance_reports",
25 |   "regulatory_filings",
26 |   "financial_records",
27 |   "advertising_copy",
28 |   "press_releases",
29 |   "branding_guidelines",
30 |   "market_research_reports",
31 |   "campaign_performance_reports",
32 |   "customer_surveys",
33 |   "quality_control_reports",
34 |   "inventory_reports",
35 |   "maintenance_logs",
36 |   "production_schedules",
37 |   "vendor_agreements",
38 |   "supplier_agreements",
39 |   "sales_contracts",
40 |   "sales_reports",
41 |   "client_proposals",
42 |   "customer_order_forms",
43 |   "sales_presentations",
44 |   "data_security_plans",
45 |   "system_architecture_diagrams",
46 |   "incident_response_plans",
47 |   "user_manuals",
48 |   "software_licenses",
49 |   "data_backup_logs",
50 |   "project_plans",
51 |   "task_lists",
52 |   "risk_management_plans",
53 |   "project_status_reports",
54 |   "meeting_agendas",
55 |   "lab_notebooks",
56 |   "experiment_results",
57 |   "product_design_documents",
58 |   "prototypes_and_models",
59 |   "testing_reports",
60 |   "newsletters",
61 |   "email_correspondence",
62 |   "support_tickets",
63 |   "faqs_and_knowledge",
64 |   "user_guides",
65 |   "warranty_information",
66 |   "swot_analysis",
67 |   "strategic_objectives",
68 |   "roadmaps",
69 |   "competitive_analysis",
70 |   "safety_data_sheets",
71 |   "compliance_certificates",
72 |   "incident_reports",
73 |   "emergency_response_plans",
74 |   "certification_records",
75 |   "training_schedules",
76 |   "e_learning_materials",
77 |   "competency_assessment_forms",
78 | ];
```

apps/dashboard/src/components/tables/vault/data-table-row.tsx
```
1 | "use client";
2 |
3 | import { createFolderAction } from "@/actions/create-folder-action";
4 | import { deleteFileAction } from "@/actions/delete-file-action";
5 | import { deleteFolderAction } from "@/actions/delete-folder-action";
6 | import { shareFileAction } from "@/actions/share-file-action";
7 | import { updateDocumentAction } from "@/actions/update-document-action";
8 | import { AssignedUser } from "@/components/assigned-user";
9 | import { FileIcon } from "@/components/file-icon";
10 | import { FilePreview } from "@/components/file-preview";
11 | import { SelectTag } from "@/components/select-tag";
12 | import { useI18n } from "@/locales/client";
13 | import { useUserContext } from "@/store/user/hook";
14 | import { useVaultContext } from "@/store/vault/hook";
15 | import { formatDate, formatSize } from "@/utils/format";
16 | import {
17 |   AlertDialog,
18 |   AlertDialogAction,
19 |   AlertDialogCancel,
20 |   AlertDialogContent,
21 |   AlertDialogDescription,
22 |   AlertDialogFooter,
23 |   AlertDialogHeader,
24 |   AlertDialogTitle,
25 |   AlertDialogTrigger,
26 | } from "@midday/ui/alert-dialog";
27 | import {
28 |   ContextMenu,
29 |   ContextMenuContent,
30 |   ContextMenuItem,
31 |   ContextMenuSub,
32 |   ContextMenuSubContent,
33 |   ContextMenuSubTrigger,
34 |   ContextMenuTrigger,
35 | } from "@midday/ui/context-menu";
36 | import {
37 |   DropdownMenu,
38 |   DropdownMenuContent,
39 |   DropdownMenuItem,
40 |   DropdownMenuPortal,
41 |   DropdownMenuSub,
42 |   DropdownMenuSubContent,
43 |   DropdownMenuSubTrigger,
44 |   DropdownMenuTrigger,
45 | } from "@midday/ui/dropdown-menu";
46 | import {
47 |   HoverCard,
48 |   HoverCardContent,
49 |   HoverCardTrigger,
50 | } from "@midday/ui/hover-card";
51 | import { Icons } from "@midday/ui/icons";
52 | import { Input } from "@midday/ui/input";
53 | import { TableCell, TableRow } from "@midday/ui/table";
54 | import { useToast } from "@midday/ui/use-toast";
55 | import { isSupportedFilePreview } from "@midday/utils";
56 | import ms from "ms";
57 | import { useAction } from "next-safe-action/hooks";
58 | import Link from "next/link";
59 | import { useParams, usePathname } from "next/navigation";
60 | import { useEffect, useRef, useState } from "react";
61 | import { useHotkeys } from "react-hotkeys-hook";
62 | import { DEFAULT_FOLDER_NAME } from "./contants";
63 | import { Tag } from "./tag";
64 |
65 | export const translatedFolderName = (t: any, folder: string) => {
66 |   switch (folder) {
67 |     case "all":
68 |       return t("folders.all");
69 |     case "exports":
70 |       return t("folders.exports");
71 |     case "inbox":
72 |       return t("folders.inbox");
73 |     case "imports":
74 |       return t("folders.imports");
75 |     case "transactions":
76 |       return t("folders.transactions");
77 |     case "invoices":
78 |       return t("folders.invoices");
79 |     default:
80 |       return decodeURIComponent(folder);
81 |   }
82 | };
83 |
84 | type Props = {
85 |   isEditing: boolean;
86 |   name: string;
87 |   path: string;
88 |   href: string;
89 | };
90 |
91 | function RowTitle({ name: initialName, isEditing, path, href }: Props) {
92 |   const inputRef = useRef<HTMLInputElement>(null);
93 |   const t = useI18n();
94 |   const [canceled, setCanceled] = useState(false);
95 |   const { toast } = useToast();
96 |   const [name, setName] = useState(initialName ?? DEFAULT_FOLDER_NAME);
97 |   const { deleteItem, data } = useVaultContext((s) => s);
98 |
99 |   useEffect(() => {
100 |     if (isEditing) {
101 |       setTimeout(() => {
102 |         inputRef.current?.focus();
103 |       }, 200);
104 |     }
105 |   }, [isEditing]);
106 |
107 |   useHotkeys(
108 |     "esc",
109 |     () => {
110 |       const name = initialName ?? DEFAULT_FOLDER_NAME;
111 |       deleteItem(name);
112 |       setCanceled(true);
113 |     },
114 |     { enableOnFormTags: true, enabled: isEditing },
115 |   );
116 |
117 |   const createFolder = useAction(createFolderAction, {
118 |     onExecute: () => {},
119 |     onError: () => {
120 |       toast({
121 |         duration: 3500,
122 |         variant: "error",
123 |         title:
124 |           "A folder with this name already exists. Please use a different name.",
125 |       });
126 |     },
127 |   });
128 |
129 |   const checkAndCreateFolder = () => {
130 |     if (
131 |       !canceled &&
132 |       name === initialName &&
133 |       data.some((folder) => folder.name === name && folder.isFolder)
134 |     ) {
135 |       return;
136 |     }
137 |
138 |     createFolder.execute({ path, name });
139 |   };
140 |
141 |   const handleOnKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {
142 |     if (evt.key === "Enter") {
143 |       checkAndCreateFolder();
144 |     }
145 |   };
146 |
147 |   if (isEditing) {
148 |     return (
149 |       <Input
150 |         ref={inputRef}
151 |         className="w-auto border-0 h-auto p-0"
152 |         value={name}
153 |         onBlur={checkAndCreateFolder}
154 |         onKeyDown={handleOnKeyDown}
155 |         onChange={(evt) => setName(evt.target.value)}
156 |         onFocus={(evt) => evt.target.select()}
157 |       />
158 |     );
159 |   }
160 |
161 |   if (href) {
162 |     return (
163 |       <Link prefetch href={href}>
164 |         {translatedFolderName(t, name)}
165 |       </Link>
166 |     );
167 |   }
168 |
169 |   return (
170 |     <span className="line-clamp-1 max-w-[70%]">
171 |       {translatedFolderName(t, name)}
172 |     </span>
173 |   );
174 | }
[TRUNCATED]
```

apps/dashboard/src/components/tables/vault/data-table.loading.tsx
```
1 | import { Skeleton } from "@midday/ui/skeleton";
2 | import { Table, TableBody, TableCell, TableRow } from "@midday/ui/table";
3 | import { DataTableHeader } from "./date-table-header";
4 |
5 | export function Loading() {
6 |   return (
7 |     <div className="mt-3 h-[calc(100vh-370px)] border overflow-scroll relative">
8 |       <Table>
9 |         <DataTableHeader />
10 |         <TableBody className="border-r-0 border-l-0">
11 |           {[...Array(20)].map((_, index) => (
12 |             <TableRow
13 |               className="h-[45px] cursor-default"
14 |               key={index.toString()}
15 |             >
16 |               <TableCell>
17 |                 <Skeleton className="h-[20px] w-[20%]" />
18 |               </TableCell>
19 |               <TableCell>
20 |                 <Skeleton className="h-[20px] w-[25%]" />
21 |               </TableCell>
22 |               <TableCell>
23 |                 <Skeleton className="w-24 h-7 rounded-full" />
24 |               </TableCell>
25 |               <TableCell>
26 |                 <Skeleton className="h-[15px] w-[50%]" />
27 |               </TableCell>
28 |             </TableRow>
29 |           ))}
30 |         </TableBody>
31 |       </Table>
32 |     </div>
33 |   );
34 | }
```

apps/dashboard/src/components/tables/vault/data-table.server.tsx
```
1 | import { VaultProvider } from "@/store/vault/provider";
2 | import { getVaultQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { DataTable } from "./data-table";
5 | import { EmptyTable } from "./empty-table";
6 | import { UploadZone } from "./upload-zone";
7 | import { VaultActions } from "./vault-actions";
8 |
9 | type Props = {
10 |   folders: string[];
11 |   disableActions: boolean;
12 |   teamId: string;
13 | };
14 |
15 | export async function DataTableServer({
16 |   folders,
17 |   disableActions,
18 |   filter,
19 |   teamId,
20 | }: Props) {
21 |   const parentId = folders.at(-1);
22 |   const supabase = createClient();
23 |
24 |   const { data } = await getVaultQuery(supabase, {
25 |     teamId,
26 |     parentId: parentId && decodeURIComponent(parentId),
27 |     filter,
28 |     searchQuery: filter?.q,
29 |   });
30 |
31 |   const isSearch = Object.values(filter).some((value) => value !== null);
32 |
33 |   return (
34 |     <VaultProvider data={data}>
35 |       <div className="relative">
36 |         <VaultActions disableActions={disableActions} />
37 |
38 |         <div className="mt-3 h-[calc(100vh-380px)] border">
39 |           <UploadZone>
40 |             <DataTable teamId={teamId} />
41 |
42 |             {data.length === 0 && (
43 |               <EmptyTable type={isSearch ? "search" : parentId} />
44 |             )}
45 |           </UploadZone>
46 |         </div>
47 |       </div>
48 |     </VaultProvider>
49 |   );
50 | }
```

apps/dashboard/src/components/tables/vault/data-table.tsx
```
1 | "use client";
2 |
3 | import { useVaultContext } from "@/store/vault/hook";
4 | import { createClient } from "@midday/supabase/client";
5 | import { Table, TableBody } from "@midday/ui/table";
6 | import { useEffect } from "react";
7 | import { DataTableRow } from "./data-table-row";
8 | import { DataTableHeader } from "./date-table-header";
9 |
10 | export function DataTable({ teamId }: { teamId: string }) {
11 |   const { data, updateItem } = useVaultContext((s) => s);
12 |   const supabase = createClient();
13 |
14 |   useEffect(() => {
15 |     const channel = supabase
16 |       .channel("realtime_documents")
17 |       .on(
18 |         "postgres_changes",
19 |         {
20 |           event: "UPDATE",
21 |           schema: "public",
22 |           table: "documents",
23 |           filter: `team_id=eq.${teamId}`,
24 |         },
25 |         (payload) => {
26 |           // Update if the document is not classified
27 |           if (!payload.old.tag && payload.old.id) {
28 |             updateItem(payload.old.id, {
29 |               tag: payload.new?.tag,
30 |             });
31 |           }
32 |         },
33 |       )
34 |       .subscribe();
35 |
36 |     return () => {
37 |       supabase.removeChannel(channel);
38 |     };
39 |   }, []);
40 |
41 |   return (
42 |     <Table>
43 |       <DataTableHeader />
44 |
45 |       <TableBody className="border-r-0 border-l-0 select-text">
46 |         {data?.map((row) => (
47 |           <DataTableRow key={row.name} data={row} />
48 |         ))}
49 |       </TableBody>
50 |     </Table>
51 |   );
52 | }
```

apps/dashboard/src/components/tables/vault/date-table-header.tsx
```
1 | import { TableHead, TableHeader, TableRow } from "@midday/ui/table";
2 |
3 | export function DataTableHeader() {
4 |   return (
5 |     <TableHeader className="border-0">
6 |       <TableRow>
7 |         <TableHead className="w-[45%]">Name</TableHead>
8 |         <TableHead className="w-[20%]">Owner</TableHead>
9 |         <TableHead className="w-[20%]">Tag</TableHead>
10 |         <TableHead className="w-[15%]">Created at</TableHead>
11 |       </TableRow>
12 |     </TableHeader>
13 |   );
14 | }
```

apps/dashboard/src/components/tables/vault/empty-table.tsx
```
1 | type Props = {
2 |   type?: string;
3 | };
4 |
5 | export function EmptyTable({ type }: Props) {
6 |   switch (type) {
7 |     case "exports":
8 |       return (
9 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
10 |           <div className="items-center flex flex-col text-center">
11 |             <h2 className="mb-2">Exports</h2>
12 |             <p className="text-sm text-[#878787]">
13 |               This is where your exports based from <br />
14 |               transactions will end up.
15 |             </p>
16 |           </div>
17 |         </div>
18 |       );
19 |
20 |     case "transactions":
21 |       return (
22 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
23 |           <div className="items-center flex flex-col text-center">
24 |             <h2 className="mb-2">Transactions</h2>
25 |             <p className="text-sm text-[#878787]">
26 |               This is where your attachments from <br />
27 |               transactions will end up.
28 |             </p>
29 |           </div>
30 |         </div>
31 |       );
32 |
33 |     case "imports":
34 |       return (
35 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
36 |           <div className="items-center flex flex-col text-center">
37 |             <h2 className="mb-2">Imports</h2>
38 |             <p className="text-sm text-[#878787]">
39 |               This is where your imports
40 |               <br />
41 |               will end up.
42 |             </p>
43 |           </div>
44 |         </div>
45 |       );
46 |
47 |     case "inbox":
48 |       return (
49 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
50 |           <div className="items-center flex flex-col text-center">
51 |             <h2 className="mb-2">Inbox</h2>
52 |             <p className="text-sm text-[#878787]">
53 |               This is where your inbox attachments
54 |               <br />
55 |               will end up.
56 |             </p>
57 |           </div>
58 |         </div>
59 |       );
60 |
61 |     case "invoices":
62 |       return (
63 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
64 |           <div className="items-center flex flex-col text-center">
65 |             <h2 className="mb-2">Invoices</h2>
66 |             <p className="text-sm text-[#878787]">
67 |               This is where your created
68 |               <br />
69 |               invoices will end up.
70 |             </p>
71 |           </div>
72 |         </div>
73 |       );
74 |
75 |     case "search":
76 |       return (
77 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
78 |           <div className="items-center flex flex-col text-center">
79 |             <h2 className="mb-2">No results found.</h2>
80 |             <p className="text-sm text-[#878787]">Try adjusting your search.</p>
81 |           </div>
82 |         </div>
83 |       );
84 |
85 |     default:
86 |       return (
87 |         <div className="h-[calc(100%-80px)] p-4 flex justify-center items-center">
88 |           <div className="items-center flex flex-col text-center">
89 |             <h2 className="mb-2">Drop your files here</h2>
90 |             <p className="text-sm text-[#878787]">
91 |               Or upload them via the <br /> "Upload file" button above
92 |             </p>
93 |           </div>
94 |         </div>
95 |       );
96 |   }
97 | }
```

apps/dashboard/src/components/tables/vault/index.tsx
```
1 | import { Breadcrumbs } from "@/components/breadcrumbs";
2 | import { VaultSettingsModal } from "@/components/modals/vault-settings-modal";
3 | import { VaultSearchFilter } from "@/components/vault-search-filter";
4 | import { getTeamMembers, getUser } from "@midday/supabase/cached-queries";
5 | import { Suspense } from "react";
6 | import { Loading } from "./data-table.loading";
7 | import { DataTableServer } from "./data-table.server";
8 |
9 | type Props = {
10 |   folders: string[];
11 |   disableActions: boolean;
12 |   hideBreadcrumbs?: boolean;
13 | };
14 |
15 | export async function Table({ folders, disableActions, filter }: Props) {
16 |   const [members, user] = await Promise.all([getTeamMembers(), getUser()]);
17 |
18 |   const team = user?.data?.team;
19 |
20 |   return (
21 |     <div>
22 |       <div className="h-[32px] mt-6 mb-[21px] flex items-center justify-between mr-11">
23 |         <Breadcrumbs
24 |           folders={folders}
25 |           hide={Object.values(filter).some((value) => value !== null)}
26 |         />
27 |
28 |         <div className="flex items-center gap-2">
29 |           <VaultSearchFilter
30 |             members={members?.data?.map((member) => ({
31 |               id: member?.user?.id,
32 |               name: member.user?.full_name,
33 |             }))}
34 |           />
35 |
36 |           <VaultSettingsModal
37 |             documentClassification={team?.document_classification}
38 |           />
39 |         </div>
40 |       </div>
41 |
42 |       <Suspense fallback={<Loading />}>
43 |         <DataTableServer
44 |           folders={folders}
45 |           disableActions={disableActions}
46 |           filter={filter}
47 |           teamId={team?.id}
48 |         />
49 |       </Suspense>
50 |     </div>
51 |   );
52 | }
```

apps/dashboard/src/components/tables/vault/search-params.ts
```
1 | import {
2 |   createSearchParamsCache,
3 |   parseAsArrayOf,
4 |   parseAsString,
5 | } from "nuqs/server";
6 |
7 | export const searchParamsCache = createSearchParamsCache({
8 |   q: parseAsString,
9 |   start: parseAsString,
10 |   end: parseAsString,
11 |   owners: parseAsArrayOf(parseAsString),
12 |   tags: parseAsArrayOf(parseAsString),
13 | });
```

apps/dashboard/src/components/tables/vault/tag.tsx
```
1 | "use client";
2 |
3 | import { useI18n } from "@/locales/client";
4 | import { cn } from "@midday/ui/cn";
5 | import { Skeleton } from "@midday/ui/skeleton";
6 |
7 | export function Tag({
8 |   name,
9 |   isLoading,
10 |   className,
11 | }: {
12 |   name?: string;
13 |   isLoading?: boolean;
14 |   className?: string;
15 | }) {
16 |   const t = useI18n();
17 |
18 |   if (isLoading) {
19 |     return <Skeleton className="w-24 h-6 rounded-full" />;
20 |   }
21 |
22 |   if (!name) {
23 |     return null;
24 |   }
25 |
26 |   return (
27 |     <div
28 |       className={cn(
29 |         "p-1 text-[#878787] bg-[#F2F1EF] text-[10px] dark:bg-[#1D1D1D] px-3 py-1 rounded-full cursor-default font-mono inline-flex max-w-full",
30 |         className,
31 |       )}
32 |     >
33 |       <span className="line-clamp-1 truncate inline-block">
34 |         {t(`tags.${name}`)}
35 |       </span>
36 |     </div>
37 |   );
38 | }
```

apps/dashboard/src/components/tables/vault/upload-zone.tsx
```
1 | "use client";
2 |
3 | import { invalidateCacheAction } from "@/actions/invalidate-cache-action";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { useVaultContext } from "@/store/vault/hook";
6 | import { resumableUpload } from "@/utils/upload";
7 | import { createClient } from "@midday/supabase/client";
8 | import { cn } from "@midday/ui/cn";
9 | import {
10 |   ContextMenu,
11 |   ContextMenuContent,
12 |   ContextMenuItem,
13 |   ContextMenuTrigger,
14 | } from "@midday/ui/context-menu";
15 | import { useToast } from "@midday/ui/use-toast";
16 | import { useParams } from "next/navigation";
17 | import { useEffect, useRef, useState } from "react";
18 | import { useDropzone } from "react-dropzone";
19 | import { DEFAULT_FOLDER_NAME } from "./contants";
20 |
21 | type Props = {
22 |   children: React.ReactNode;
23 | };
24 |
25 | export function UploadZone({ children }: Props) {
26 |   const supabase = createClient();
27 |   const [progress, setProgress] = useState(0);
28 |   const [showProgress, setShowProgress] = useState(false);
29 |   const [toastId, setToastId] = useState(null);
30 |   const uploadProgress = useRef([]);
31 |   const params = useParams();
32 |   const folders = params?.folders ?? [];
33 |   const { toast, dismiss, update } = useToast();
34 |   const { createFolder } = useVaultContext((s) => s);
35 |
36 |   const { team_id: teamId } = useUserContext((state) => state.data);
37 |
38 |   const isDefaultFolder = [
39 |     "exports",
40 |     "inbox",
41 |     "import",
42 |     "transactions",
43 |   ].includes(folders?.at(0) ?? "");
44 |
45 |   useEffect(() => {
46 |     if (!toastId && showProgress) {
47 |       const { id } = toast({
48 |         title: `Uploading ${uploadProgress.current.length} files`,
49 |         progress,
50 |         variant: "progress",
51 |         description: "Please do not close browser until completed",
52 |         duration: Number.POSITIVE_INFINITY,
53 |       });
54 |
55 |       setToastId(id);
56 |     } else {
57 |       update(toastId, {
58 |         progress,
59 |         title: `Uploading ${uploadProgress.current.length} files`,
60 |       });
61 |     }
62 |   }, [showProgress, progress, toastId]);
63 |
64 |   const onDrop = async (files) => {
65 |     // NOTE: If onDropRejected
66 |     if (!files.length) {
67 |       return;
68 |     }
69 |
70 |     // Set default progress
71 |     uploadProgress.current = files.map(() => 0);
72 |
73 |     setShowProgress(true);
74 |
75 |     const filePath = [teamId, ...folders];
76 |
77 |     try {
78 |       await Promise.all(
79 |         files.map(async (file, idx) => {
80 |           await resumableUpload(supabase, {
81 |             bucket: "vault",
82 |             path: filePath,
83 |             file,
84 |             onProgress: (bytesUploaded, bytesTotal) => {
85 |               uploadProgress.current[idx] = (bytesUploaded / bytesTotal) * 100;
86 |
87 |               const _progress = uploadProgress.current.reduce(
88 |                 (acc, currentValue) => {
89 |                   return acc + currentValue;
90 |                 },
91 |                 0,
92 |               );
93 |
94 |               setProgress(Math.round(_progress / files.length));
95 |             },
96 |           });
97 |         }),
98 |       );
99 |
100 |       // Reset once done
101 |       uploadProgress.current = [];
102 |
103 |       setProgress(0);
104 |       toast({
105 |         title: "Upload successful.",
106 |         variant: "success",
107 |         duration: 2000,
108 |       });
109 |
110 |       setShowProgress(false);
111 |       setToastId(null);
112 |       dismiss(toastId);
113 |       invalidateCacheAction([`vault_${teamId}`]);
114 |     } catch {
115 |       toast({
116 |         duration: 2500,
117 |         variant: "error",
118 |         title: "Something went wrong please try again.",
119 |       });
120 |     }
121 |   };
122 |
123 |   const { getRootProps, getInputProps, isDragActive } = useDropzone({
124 |     onDrop,
125 |     onDropRejected: ([reject]) => {
126 |       if (reject?.errors.find(({ code }) => code === "file-too-large")) {
127 |         toast({
128 |           duration: 2500,
129 |           variant: "error",
130 |           title: "File size to large.",
131 |         });
132 |       }
133 |
134 |       if (reject?.errors.find(({ code }) => code === "file-invalid-type")) {
135 |         toast({
136 |           duration: 2500,
137 |           variant: "error",
138 |           title: "File type not supported.",
139 |         });
140 |       }
141 |     },
142 |     maxSize: 8000000, // 8MB
143 |     accept: {
144 |       "image/png": [".png"],
145 |       "image/jpeg": [".jpg", ".jpeg"],
146 |       "application/pdf": [".pdf"],
147 |       "application/zip": [".zip"],
148 |       "text/csv": [".csv"],
149 |       "application/vnd.openxmlformats-officedocument.presentationml.presentation":
150 |         [".pptx"],
151 |     },
152 |   });
153 |
154 |   return (
155 |     <ContextMenu>
156 |       <ContextMenuTrigger asChild>
157 |         <div
158 |           {...getRootProps({ onClick: (evt) => evt.stopPropagation() })}
159 |           className="relative h-full"
160 |         >
161 |           <div className="absolute top-0 bottom-0 right-0 left-0 z-50 pointer-events-none">
162 |             <div
163 |               className={cn(
164 |                 "bg-background dark:bg-[#1A1A1A] h-full flex items-center justify-center text-center invisible",
165 |                 isDragActive && "visible",
166 |               )}
167 |             >
168 |               <input {...getInputProps()} id="upload-files" />
169 |
170 |               <p className="text-xs">
171 |                 Drop your files here, to
[TRUNCATED]
```

apps/dashboard/src/components/tables/vault/vault-actions.tsx
```
1 | "use client";
2 |
3 | import { useVaultContext } from "@/store/vault/hook";
4 | import { Button } from "@midday/ui/button";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuContent,
8 |   DropdownMenuItem,
9 |   DropdownMenuShortcut,
10 |   DropdownMenuTrigger,
11 | } from "@midday/ui/dropdown-menu";
12 | import { Icons } from "@midday/ui/icons";
13 | import { useHotkeys } from "react-hotkeys-hook";
14 | import { DEFAULT_FOLDER_NAME } from "./contants";
15 |
16 | export function VaultActions({ disableActions }: { disableActions: boolean }) {
17 |   const createFolder = useVaultContext((s) => s.createFolder);
18 |
19 |   const handleCreateFolder = () => {
20 |     createFolder({ name: DEFAULT_FOLDER_NAME });
21 |   };
22 |
23 |   useHotkeys("shift+meta+u", (evt) => {
24 |     evt.preventDefault();
25 |     document.getElementById("upload-files")?.click();
26 |   });
27 |
28 |   useHotkeys("shift+meta+f", (evt) => {
29 |     evt.preventDefault();
30 |     handleCreateFolder();
31 |   });
32 |
33 |   return (
34 |     <div className="absolute -top-[55px] right-0">
35 |       <DropdownMenu>
36 |         <DropdownMenuTrigger asChild>
37 |           <Button variant="outline" size="icon">
38 |             <Icons.Add size={17} />
39 |           </Button>
40 |         </DropdownMenuTrigger>
41 |         <DropdownMenuContent align="end" className="w-[200px]" sideOffset={10}>
42 |           <DropdownMenuItem
43 |             className="flex items-center gap-2"
44 |             disabled={disableActions}
45 |             onClick={handleCreateFolder}
46 |           >
47 |             <Icons.CreateNewFolder size={17} />
48 |             <span>Create folder</span>
49 |             <DropdownMenuShortcut>⇧⌘F</DropdownMenuShortcut>
50 |           </DropdownMenuItem>
51 |
52 |           <DropdownMenuItem
53 |             className="flex items-center gap-2"
54 |             disabled={disableActions}
55 |             onClick={() => document.getElementById("upload-files")?.click()}
56 |           >
57 |             <Icons.FileUpload size={17} />
58 |             <span>Upload files</span>
59 |             <DropdownMenuShortcut>⇧⌘U</DropdownMenuShortcut>
60 |           </DropdownMenuItem>
61 |         </DropdownMenuContent>
62 |       </DropdownMenu>
63 |     </div>
64 |   );
65 | }
```

apps/dashboard/src/components/widgets/account-balance/account-balance-widget.tsx
```
1 | import { getBankAccountsBalances } from "@midday/supabase/cached-queries";
2 | import { AccountBalance } from "./account-balance";
3 |
4 | export function AccountBalanceSkeleton() {
5 |   return null;
6 | }
7 |
8 | export async function AccountBalanceWidget() {
9 |   const accountsData = await getBankAccountsBalances();
10 |
11 |   return (
12 |     <div className="h-full">
13 |       <div className="flex justify-between">
14 |         <div>
15 |           <h2 className="text-lg">Account balance</h2>
16 |         </div>
17 |       </div>
18 |
19 |       <AccountBalance data={accountsData?.data} />
20 |     </div>
21 |   );
22 | }
```

apps/dashboard/src/components/widgets/account-balance/account-balance.tsx
```
1 | "use client";
2 |
3 | import { AddAccountButton } from "@/components/add-account-button";
4 | import { FormatAmount } from "@/components/format-amount";
5 | import { useI18n } from "@/locales/client";
6 | import { formatAccountName } from "@/utils/format";
7 | import { cn } from "@midday/ui/cn";
8 | import Image from "next/image";
9 | import { useState } from "react";
10 |
11 | type Props = {
12 |   data: {
13 |     id: string;
14 |     name: string;
15 |     balance: number;
16 |     currency: string;
17 |     logo_url?: string;
18 |   }[];
19 | };
20 |
21 | export function AccountBalance({ data }: Props) {
22 |   const [activeIndex, setActiveIndex] = useState(0);
23 |   const t = useI18n();
24 |
25 |   const formattedData = data.map((account) => {
26 |     if (account.name === "total_balance") {
27 |       return {
28 |         ...account,
29 |         id: account.name,
30 |         name: t("account_balance.total_balance"),
31 |       };
32 |     }
33 |
34 |     return account;
35 |   });
36 |
37 |   const activeAccount = formattedData.at(activeIndex);
38 |
39 |   if (!activeAccount) {
40 |     return (
41 |       <div className="flex justify-center items-center h-full flex-col">
42 |         <h2 className="font-medium mb-1">No accounts connected</h2>
43 |         <p className="text-[#606060] text-sm mb-8 text-center">
44 |           Get your balance in real-time by connecting <br />
45 |           your bank account.
46 |         </p>
47 |         <AddAccountButton />
48 |       </div>
49 |     );
50 |   }
51 |
52 |   return (
53 |     <div className="flex justify-between mt-12 items-center flex-col space-y-6">
54 |       <div className="-mt-6 w-[80%] md:w-[75%] lg:w-[85%] 2xl:w-[80%] aspect-square rounded-full bg-[#F2F1EF] dark:bg-secondary flex items-center justify-center p-8 flex-col space-y-2">
55 |         <h2 className="font-mono font-medium text-2xl">
56 |           <FormatAmount
57 |             amount={activeAccount.balance}
58 |             currency={activeAccount.currency}
59 |           />
60 |         </h2>
61 |
62 |         <div className="flex space-x-2 items-center">
63 |           {activeAccount?.logo_url && (
64 |             <Image
65 |               src={activeAccount.logo_url}
66 |               alt=""
67 |               width={24}
68 |               height={24}
69 |               quality={100}
70 |               className="rounded-full border border-1 aspect-square"
71 |             />
72 |           )}
73 |
74 |           <span className="text-xs font-medium text-[#606060]">
75 |             {formatAccountName({
76 |               name: activeAccount.name,
77 |               currency: activeAccount.currency,
78 |             })}
79 |           </span>
80 |         </div>
81 |       </div>
82 |
83 |       {formattedData.length > 1 && (
84 |         <div className="flex space-x-2">
85 |           {formattedData.map((account, idx) => (
86 |             <button
87 |               type="button"
88 |               onMouseEnter={() => setActiveIndex(idx)}
89 |               onClick={() => setActiveIndex(idx)}
90 |               key={account.id}
91 |               className={cn(
92 |                 "w-[8px] h-[8px] rounded-full bg-[#1D1D1D] dark:bg-[#D9D9D9] opacity-30 transition-all cursor-pointer",
93 |                 idx === activeIndex && "opacity-1",
94 |               )}
95 |             />
96 |           ))}
97 |         </div>
98 |       )}
99 |     </div>
100 |   );
101 | }
```

apps/dashboard/src/components/widgets/account-balance/index.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
3 | import { Suspense } from "react";
4 | import {
5 |   AccountBalanceSkeleton,
6 |   AccountBalanceWidget,
7 | } from "./account-balance-widget";
8 |
9 | export async function AccountBalance() {
10 |   return (
11 |     <div className="border relative aspect-square overflow-hidden p-4 md:p-8">
12 |       <ErrorBoundary errorComponent={ErrorFallback}>
13 |         <Suspense fallback={<AccountBalanceSkeleton />}>
14 |           <AccountBalanceWidget />
15 |         </Suspense>
16 |       </ErrorBoundary>
17 |     </div>
18 |   );
19 | }
```

apps/dashboard/src/components/widgets/inbox/data.ts
```
1 | export const inboxData = [];
```

apps/dashboard/src/components/widgets/inbox/inbox-header.tsx
```
1 | "use client";
2 |
3 | import { changeInboxFilterAction } from "@/actions/inbox/filter";
4 | import { useI18n } from "@/locales/client";
5 | import {
6 |   DropdownMenu,
7 |   DropdownMenuCheckboxItem,
8 |   DropdownMenuContent,
9 |   DropdownMenuTrigger,
10 | } from "@midday/ui/dropdown-menu";
11 | import { Icons } from "@midday/ui/icons";
12 | import { useOptimisticAction } from "next-safe-action/hooks";
13 | import Link from "next/link";
14 |
15 | const options = ["all", "todo", "done"];
16 |
17 | type Props = {
18 |   filter: string;
19 |   disabled: boolean;
20 | };
21 |
22 | export function InboxHeader({ filter, disabled }: Props) {
23 |   const t = useI18n();
24 |   const { execute, optimisticState } = useOptimisticAction(
25 |     changeInboxFilterAction,
26 |     {
27 |       currentState: filter,
28 |       updateFn: (_, newState) => newState,
29 |     },
30 |   );
31 |
32 |   return (
33 |     <div className="flex justify-between">
34 |       <div>
35 |         <Link href="/inbox" prefetch>
36 |           <h2 className="text-lg">Inbox</h2>
37 |         </Link>
38 |       </div>
39 |
40 |       <DropdownMenu>
41 |         <DropdownMenuTrigger disabled={disabled}>
42 |           <div className="flex items-center space-x-2">
43 |             <span>{t(`inbox_filter.${optimisticState}`)}</span>
44 |             <Icons.ChevronDown />
45 |           </div>
46 |         </DropdownMenuTrigger>
47 |         <DropdownMenuContent className="w-[130px]">
48 |           {options.map((option) => (
49 |             <DropdownMenuCheckboxItem
50 |               key={option}
51 |               onCheckedChange={() => execute(option)}
52 |               checked={option === optimisticState}
53 |             >
54 |               {t(`inbox_filter.${option}`)}
55 |             </DropdownMenuCheckboxItem>
56 |           ))}
57 |         </DropdownMenuContent>
58 |       </DropdownMenu>
59 |     </div>
60 |   );
61 | }
```

apps/dashboard/src/components/widgets/inbox/inbox-list.tsx
```
1 | "use client";
2 |
3 | import { FormatAmount } from "@/components/format-amount";
4 | import { InboxStatus } from "@/components/inbox-status";
5 | import { Icons } from "@midday/ui/icons";
6 | import { format } from "date-fns";
7 | import Link from "next/link";
8 |
9 | export function InboxList({ data }) {
10 |   return (
11 |     <div className="flex flex-col gap-4 overflow-auto scrollbar-hide aspect-square pb-14 mt-8">
12 |       {data.map((item) => {
13 |         const tab = item.transaction_id ? "done" : "todo";
14 |
15 |         return (
16 |           <Link
17 |             key={item.id}
18 |             href={`/inbox?inboxId=${item.id}&tab=${tab}`}
19 |             className="flex flex-col items-start gap-2 border p-4 text-left text-sm transition-all"
20 |           >
21 |             <div className="flex w-full flex-col gap-1">
22 |               <div className="flex items-center mb-1">
23 |                 <div className="flex items-center gap-2">
24 |                   <div className="flex items-center space-x-2">
25 |                     <div className="font-semibold">{item?.display_name}</div>
26 |                     {item.status === "handled" && <Icons.Check />}
27 |                   </div>
28 |                 </div>
29 |                 <div className="ml-auto text-xs text-muted-foreground">
30 |                   {item.date && format(new Date(item.date), "MMM d")}
31 |                 </div>
32 |               </div>
33 |               <div className="flex">
34 |                 {item?.currency && item?.amount && (
35 |                   <div className="text-xs font-medium">
36 |                     <FormatAmount
37 |                       amount={item.amount}
38 |                       currency={item.currency}
39 |                     />
40 |                   </div>
41 |                 )}
42 |                 <div className="ml-auto">
43 |                   <InboxStatus item={item} />
44 |                 </div>
45 |               </div>
46 |             </div>
47 |           </Link>
48 |         );
49 |       })}
50 |     </div>
51 |   );
52 | }
```

apps/dashboard/src/components/widgets/inbox/inbox-widget.tsx
```
1 | import { CopyInput } from "@/components/copy-input";
2 | import { getInboxEmail } from "@midday/inbox";
3 | import { getUser } from "@midday/supabase/cached-queries";
4 | import { getInboxQuery } from "@midday/supabase/queries";
5 | import { createClient } from "@midday/supabase/server";
6 | import { inboxData } from "./data";
7 | import { InboxList } from "./inbox-list";
8 |
9 | export async function InboxWidget({ filter, disabled }) {
10 |   const user = await getUser();
11 |   const supabase = createClient();
12 |
13 |   const { data } = disabled
14 |     ? inboxData
15 |     : await getInboxQuery(supabase, {
16 |         to: 15,
17 |         from: 0,
18 |         teamId: user.data.team_id,
19 |         done: filter === "done",
20 |         todo: filter === "todo",
21 |       });
22 |
23 |   if (!data?.length) {
24 |     return (
25 |       <div className="flex flex-col space-y-4 items-center justify-center h-full text-center">
26 |         <div>
27 |           <CopyInput value={getInboxEmail(user?.data?.team?.inbox_id)} />
28 |         </div>
29 |
30 |         <p className="text-sm text-[#606060]">
31 |           Use this email for online purchases to seamlessly
32 |           <br />
33 |           match invoices againsts transactions.
34 |         </p>
35 |       </div>
36 |     );
37 |   }
38 |
39 |   return <InboxList data={data} />;
40 | }
```

apps/dashboard/src/components/widgets/inbox/index.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { InboxListSkeleton } from "@/components/inbox-list-skeleton";
3 | import { Cookies } from "@/utils/constants";
4 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
5 | import { cookies } from "next/headers";
6 | import { Suspense } from "react";
7 | import { InboxHeader } from "./inbox-header";
8 | import { InboxWidget } from "./inbox-widget";
9 |
10 | export async function Inbox({ disabled }) {
11 |   const filter = cookies().get(Cookies.InboxFilter)?.value ?? "all";
12 |
13 |   return (
14 |     <div className="border relative aspect-square overflow-hidden p-4 md:p-8">
15 |       <InboxHeader filter={filter} disabled={disabled} />
16 |
17 |       <ErrorBoundary errorComponent={ErrorFallback}>
18 |         <Suspense
19 |           key={filter}
20 |           fallback={<InboxListSkeleton numberOfItems={3} className="pt-8" />}
21 |         >
22 |           <InboxWidget disabled={disabled} filter={filter} />
23 |         </Suspense>
24 |       </ErrorBoundary>
25 |     </div>
26 |   );
27 | }
```

apps/dashboard/src/components/widgets/insights/index.tsx
```
1 | import { Suspense } from "react";
2 | import { InsightsWidget } from "./insights-widget";
3 |
4 | export function Insights() {
5 |   return (
6 |     <div className="border aspect-square overflow-hidden relative flex flex-col p-4 md:p-8">
7 |       <h2 className="text-lg">Assistant</h2>
8 |
9 |       <Suspense>
10 |         <InsightsWidget />
11 |       </Suspense>
12 |     </div>
13 |   );
14 | }
```

apps/dashboard/src/components/widgets/insights/insight-input.tsx
```
1 | "use client";
2 |
3 | import { useAssistantStore } from "@/store/assistant";
4 | import { Icons } from "@midday/ui/icons";
5 | import { Input } from "@midday/ui/input";
6 |
7 | export function InsightInput() {
8 |   const { setOpen } = useAssistantStore();
9 |
10 |   return (
11 |     <div>
12 |       <div className="absolute bottom-4 left-4 right-4 md:bottom-8 md:left-8 md:right-8">
13 |         <div className="relative z-20">
14 |           <Input
15 |             placeholder="Ask Midday a question..."
16 |             className="w-full h-11 cursor-pointer bg-background"
17 |             onFocus={() => setOpen()}
18 |           />
19 |           <Icons.LogoIcon className="absolute right-3 bottom-3.5 pointer-events-none" />
20 |         </div>
21 |       </div>
22 |       <div className="absolute h-[76px] bg-gradient-to-t from-background to-[#fff]/70 dark:to-[#121212]/90 bottom-0 left-0 right-0 w-full z-10" />
23 |     </div>
24 |   );
25 | }
```

apps/dashboard/src/components/widgets/insights/insight-list.tsx
```
1 | "use client";
2 |
3 | import { chatExamples } from "@/components/chat/examples";
4 | import { useAssistantStore } from "@/store/assistant";
5 | import { shuffle } from "@midday/utils";
6 | import { useEffect, useState } from "react";
7 |
8 | export function InsightList() {
9 |   const { setOpen } = useAssistantStore();
10 |   const [items, setItems] = useState([]);
11 |
12 |   useEffect(() => {
13 |     const items = shuffle(chatExamples).slice(0, 4);
14 |     setItems(items);
15 |   }, []);
16 |
17 |   return (
18 |     <div className="mb-16">
19 |       <ul className="flex flex-col justify-center items-center space-y-3 flex-shrink">
20 |         {items.map((example) => (
21 |           <li
22 |             key={example}
23 |             className="rounded-full dark:bg-secondary bg-[#F2F1EF] text-xs font-mono text-[#606060] hover:opacity-80 transition-all cursor-default"
24 |           >
25 |             <button
26 |               onClick={() => setOpen(example)}
27 |               type="button"
28 |               className="inline-block p-3 py-2"
29 |             >
30 |               <span>{example}</span>
31 |             </button>
32 |           </li>
33 |         ))}
34 |       </ul>
35 |     </div>
36 |   );
37 | }
```

apps/dashboard/src/components/widgets/insights/insights-widget.tsx
```
1 | import { getUIStateFromAIState } from "@/actions/ai/chat/utils";
2 | import { getLatestChat } from "@/actions/ai/storage";
3 | import { ChatList } from "@/components/chat/chat-list";
4 | import { InsightInput } from "./insight-input";
5 | import { InsightList } from "./insight-list";
6 |
7 | export async function InsightsWidget() {
8 |   const chat = await getLatestChat();
9 |
10 |   return (
11 |     <div>
12 |       <div className="mt-8 overflow-auto scrollbar-hide pb-32 aspect-square flex flex-col-reverse">
13 |         {chat ? (
14 |           <ChatList messages={getUIStateFromAIState(chat)} />
15 |         ) : (
16 |           <InsightList />
17 |         )}
18 |       </div>
19 |       <InsightInput />
20 |     </div>
21 |   );
22 | }
```

apps/dashboard/src/components/widgets/invoice/empty-state.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 |
6 | export function EmptyState() {
7 |   const { setParams } = useInvoiceParams();
8 |
9 |   return (
10 |     <div className="flex flex-col space-y-4 items-center justify-center h-full text-center mt-16">
11 |       <p className="text-sm text-[#606060]">
12 |         No invoices created yet.
13 |         <br />
14 |         Create an invoice to get started.
15 |       </p>
16 |
17 |       <Button variant="outline" onClick={() => setParams({ type: "create" })}>
18 |         Create invoice
19 |       </Button>
20 |     </div>
21 |   );
22 | }
```

apps/dashboard/src/components/widgets/invoice/index.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
3 | import { Suspense } from "react";
4 | import { InvoiceWidgetHeader } from "./invoice-header";
5 | import { InvoiceWidget, InvoiceWidgetSkeleton } from "./invoice-widget";
6 |
7 | export function Invoice() {
8 |   return (
9 |     <div className="border aspect-square overflow-hidden relative p-4 md:p-8">
10 |       <InvoiceWidgetHeader />
11 |
12 |       <ErrorBoundary errorComponent={ErrorFallback}>
13 |         <Suspense fallback={<InvoiceWidgetSkeleton />}>
14 |           <InvoiceWidget />
15 |         </Suspense>
16 |       </ErrorBoundary>
17 |     </div>
18 |   );
19 | }
```

apps/dashboard/src/components/widgets/invoice/invoice-header.tsx
```
1 | "use client";
2 |
3 | import { useInvoiceParams } from "@/hooks/use-invoice-params";
4 | import { Button } from "@midday/ui/button";
5 | import { Icons } from "@midday/ui/icons";
6 | import Link from "next/link";
7 |
8 | export function InvoiceWidgetHeader() {
9 |   const { setParams } = useInvoiceParams();
10 |
11 |   return (
12 |     <div className="flex justify-between items-center">
13 |       <Link href="/invoices" prefetch>
14 |         <h2 className="text-lg">Invoices</h2>
15 |       </Link>
16 |
17 |       <Button
18 |         variant="outline"
19 |         size="icon"
20 |         onClick={() => setParams({ type: "create" })}
21 |       >
22 |         <Icons.Add />
23 |       </Button>
24 |     </div>
25 |   );
26 | }
```

apps/dashboard/src/components/widgets/invoice/invoice-row.tsx
```
1 | "use client";
2 |
3 | import { FormatAmount } from "@/components/format-amount";
4 | import { InvoiceStatus } from "@/components/invoice-status";
5 | import { InvoiceDetailsSheet } from "@/components/sheets/invoice-details-sheet";
6 | import type { Invoice } from "@/components/tables/invoices/columns";
7 | import { getDueDateStatus } from "@/utils/format";
8 | import { formatDate } from "@/utils/format";
9 | import { cn } from "@midday/ui/cn";
10 | import { Skeleton } from "@midday/ui/skeleton";
11 | import { useState } from "react";
12 |
13 | type Props = {
14 |   invoice: Invoice;
15 | };
16 |
17 | export function InvoiceRowSkeleton() {
18 |   return (
19 |     <li className="h-[57px] flex items-center w-full">
20 |       <div className="flex items-center w-full">
21 |         <div className="flex flex-col space-y-1 w-1/4">
22 |           <Skeleton className="h-4 w-20" />
23 |           <Skeleton className="h-3 w-16" />
24 |         </div>
25 |
26 |         <div className="w-1/4">
27 |           <Skeleton className="h-5 w-16" />
28 |         </div>
29 |
30 |         <div className="w-1/4">
31 |           <Skeleton className="h-4 w-24" />
32 |         </div>
33 |
34 |         <div className="w-1/4 flex justify-end">
35 |           <Skeleton className="h-4 w-16" />
36 |         </div>
37 |       </div>
38 |     </li>
39 |   );
40 | }
41 |
42 | export function InvoiceRow({ invoice }: Props) {
43 |   const [isOpen, setOpen] = useState(false);
44 |
45 |   const showDate =
46 |     invoice.status === "unpaid" ||
47 |     invoice.status === "overdue" ||
48 |     invoice.status === "pending";
49 |
50 |   return (
51 |     <>
52 |       <li
53 |         key={invoice.id}
54 |         className="h-[57px] flex items-center w-full"
55 |         onClick={() => setOpen(true)}
56 |       >
57 |         <div className="flex items-center w-full">
58 |           <div className="flex flex-col space-y-1 w-1/4">
59 |             <span className="text-sm">
60 |               {invoice.due_date ? formatDate(invoice.due_date) : "-"}
61 |             </span>
62 |             {showDate && (
63 |               <span className="text-xs text-muted-foreground">
64 |                 {invoice.due_date ? getDueDateStatus(invoice.due_date) : "-"}
65 |               </span>
66 |             )}
67 |           </div>
68 |
69 |           <div className="w-1/4">
70 |             <InvoiceStatus status={invoice.status} />
71 |           </div>
72 |
73 |           <div className="w-1/4 text-sm">{invoice.customer?.name}</div>
74 |
75 |           <div
76 |             className={cn(
77 |               "w-1/4 flex justify-end text-sm",
78 |               invoice.status === "canceled" && "line-through",
79 |             )}
80 |           >
81 |             <FormatAmount amount={invoice.amount} currency={invoice.currency} />
82 |           </div>
83 |         </div>
84 |       </li>
85 |
86 |       <InvoiceDetailsSheet data={invoice} setOpen={setOpen} isOpen={isOpen} />
87 |     </>
88 |   );
89 | }
```

apps/dashboard/src/components/widgets/invoice/invoice-widget.tsx
```
1 | import { PaymentScoreVisualizer } from "@/components/payment-score-visualizer";
2 | import { getI18n } from "@/locales/server";
3 | import { getInvoices, getPaymentStatus } from "@midday/supabase/cached-queries";
4 | import { Skeleton } from "@midday/ui/skeleton";
5 | import { Invoice } from "./invoice";
6 | import { InvoiceRowSkeleton } from "./invoice-row";
7 |
8 | export function InvoiceWidgetSkeleton() {
9 |   return (
10 |     <div className="mt-8">
11 |       <div className="flex justify-between items-center p-3 py-2 border border-border">
12 |         <div className="w-1/2">
13 |           <div className="flex flex-col gap-2">
14 |             <Skeleton className="h-4 w-3/4" />
15 |             <Skeleton className="h-3 w-1/2" />
16 |           </div>
17 |         </div>
18 |       </div>
19 |       <div className="mt-4 space-y-2">
20 |         {Array.from({ length: 10 }).map((_, index) => (
21 |           <InvoiceRowSkeleton key={index.toString()} />
22 |         ))}
23 |       </div>
24 |     </div>
25 |   );
26 | }
27 |
28 | export async function InvoiceWidget() {
29 |   const [t, { data: paymentStatusData }, { data: invoicesData }] =
30 |     await Promise.all([getI18n(), getPaymentStatus(), getInvoices()]);
31 |
32 |   const { payment_status, score } = paymentStatusData ?? {};
33 |   const invoices = invoicesData ?? [];
34 |
35 |   return (
36 |     <div className="mt-8">
37 |       <div className="flex justify-between items-center p-3 py-2 border border-border">
38 |         <div>
39 |           <div className="flex flex-col gap-2">
40 |             <div>{t(`payment_status.${payment_status}`)}</div>
41 |             <div className="text-sm text-muted-foreground">Payment score</div>
42 |           </div>
43 |         </div>
44 |         <PaymentScoreVisualizer score={score} paymentStatus={payment_status} />
45 |       </div>
46 |
47 |       <Invoice invoices={invoices} />
48 |     </div>
49 |   );
50 | }
```

apps/dashboard/src/components/widgets/invoice/invoice.tsx
```
1 | import type { Invoice as InvoiceType } from "@/components/tables/invoices/columns";
2 | import { EmptyState } from "./empty-state";
3 | import { InvoiceRow } from "./invoice-row";
4 |
5 | type Props = {
6 |   invoices: InvoiceType[];
7 | };
8 |
9 | export function Invoice({ invoices }: Props) {
10 |   if (!invoices.length) {
11 |     return <EmptyState />;
12 |   }
13 |
14 |   return (
15 |     <ul className="bullet-none divide-y cursor-pointer overflow-auto scrollbar-hide aspect-square pb-32 mt-4">
16 |       {invoices?.map((invoice) => {
17 |         return <InvoiceRow key={invoice.id} invoice={invoice} />;
18 |       })}
19 |     </ul>
20 |   );
21 | }
```

apps/dashboard/src/components/widgets/tracker/index.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
3 | import { Suspense } from "react";
4 | import {
5 |   TrackerWidgetServer,
6 |   TrackerWidgetSkeleton,
7 | } from "./tracker-widget.server";
8 |
9 | type Props = {
10 |   date: string;
11 | };
12 |
13 | export function Tracker({ date }: Props) {
14 |   return (
15 |     <div className="border aspect-square overflow-hidden relative p-4 md:p-8">
16 |       <ErrorBoundary errorComponent={ErrorFallback}>
17 |         <Suspense fallback={<TrackerWidgetSkeleton key={date} />}>
18 |           <TrackerWidgetServer date={date} />
19 |         </Suspense>
20 |       </ErrorBoundary>
21 |     </div>
22 |   );
23 | }
```

apps/dashboard/src/components/widgets/tracker/tracker-header.tsx
```
1 | "use client";
2 |
3 | import { TrackerMonthSelect } from "@/components/tracker-month-select";
4 | import { secondsToHoursAndMinutes } from "@/utils/format";
5 | import Link from "next/link";
6 |
7 | type Props = {
8 |   totalDuration?: number;
9 | };
10 |
11 | export function TrackerHeader({ totalDuration }: Props) {
12 |   return (
13 |     <div className="flex justify-between">
14 |       <div>
15 |         <Link href="/tracker" prefetch>
16 |           <h2 className="text-lg">Tracker</h2>
17 |         </Link>
18 |         <span className="text-[#878787] text-sm">
19 |           {totalDuration ? secondsToHoursAndMinutes(totalDuration) : "0h"}
20 |         </span>
21 |       </div>
22 |
23 |       <TrackerMonthSelect />
24 |     </div>
25 |   );
26 | }
```

apps/dashboard/src/components/widgets/tracker/tracker-indicator.tsx
```
1 | import { cn } from "@midday/ui/cn";
2 |
3 | interface Props {
4 |   count: number;
5 |   isToday: boolean;
6 | }
7 |
8 | export function TrackerIndicator({ count, isToday }: Props) {
9 |   if (count === 1) {
10 |     return (
11 |       <div className="absolute bottom-2 left-3 right-3">
12 |         <div
13 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
14 |         />
15 |       </div>
16 |     );
17 |   }
18 |
19 |   if (count === 2) {
20 |     return (
21 |       <div className="absolute bottom-2 left-3 right-3 flex justify-center space-x-1">
22 |         <div
23 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
24 |         />
25 |         <div
26 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
27 |         />
28 |       </div>
29 |     );
30 |   }
31 |
32 |   if (count === 3) {
33 |     return (
34 |       <div className="absolute bottom-2 left-3 right-3 flex justify-center space-x-1">
35 |         <div
36 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
37 |         />
38 |         <div
39 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
40 |         />
41 |         <div
42 |           className={cn("h-1 w-1/2 bg-border", isToday && "bg-background")}
43 |         />
44 |       </div>
45 |     );
46 |   }
47 |
48 |   if (count > 3) {
49 |     return (
50 |       <div className="absolute bottom-2 left-3 right-3">
51 |         <div
52 |           className={cn("h-1 w-full bg-border", isToday && "bg-background")}
53 |         />
54 |       </div>
55 |     );
56 |   }
57 |
58 |   return null;
59 | }
```

apps/dashboard/src/components/widgets/tracker/tracker-widget.server.tsx
```
1 | import {
2 |   getTrackerRecordsByRange,
3 |   getUser,
4 | } from "@midday/supabase/cached-queries";
5 | import { endOfMonth, formatISO, startOfMonth } from "date-fns";
6 | import { TrackerHeader } from "./tracker-header";
7 | import { TrackerWidget } from "./tracker-widget";
8 |
9 | export function TrackerWidgetSkeleton() {
10 |   return <TrackerHeader />;
11 | }
12 |
13 | type Props = {
14 |   date?: string;
15 | };
16 |
17 | export async function TrackerWidgetServer({ date }: Props) {
18 |   const currentDate = date ?? formatISO(new Date(), { representation: "date" });
19 |
20 |   const [{ data: userData }, trackerData] = await Promise.all([
21 |     getUser(),
22 |     getTrackerRecordsByRange({
23 |       from: formatISO(startOfMonth(new Date(currentDate)), {
24 |         representation: "date",
25 |       }),
26 |       to: formatISO(endOfMonth(new Date(currentDate)), {
27 |         representation: "date",
28 |       }),
29 |     }),
30 |   ]);
31 |
32 |   return (
33 |     <TrackerWidget
34 |       data={trackerData?.data}
35 |       date={currentDate}
36 |       meta={trackerData?.meta}
37 |       weekStartsOnMonday={userData?.week_starts_on_monday}
38 |     />
39 |   );
40 | }
```

apps/dashboard/src/components/widgets/tracker/tracker-widget.tsx
```
1 | "use client";
2 |
3 | import { useTrackerParams } from "@/hooks/use-tracker-params";
4 | import { sortDates } from "@/utils/tracker";
5 | import { cn } from "@midday/ui/cn";
6 | import { useClickAway } from "@uidotdev/usehooks";
7 | import {
8 |   eachDayOfInterval,
9 |   endOfMonth,
10 |   endOfWeek,
11 |   format,
12 |   formatISO,
13 |   isToday,
14 |   startOfMonth,
15 |   startOfWeek,
16 | } from "date-fns";
17 | import { useEffect, useState } from "react";
18 | import { TrackerHeader } from "./tracker-header";
19 | import { TrackerIndicator } from "./tracker-indicator";
20 |
21 | type TrackerMeta = {
22 |   totalDuration?: number;
23 | };
24 |
25 | type TrackerRecord = {
26 |   id: string;
27 |   duration: number;
28 |   date: string;
29 | };
30 |
31 | type Props = {
32 |   date?: string;
33 |   meta?: TrackerMeta;
34 |   data?: Record<string, TrackerRecord[]>;
35 |   weekStartsOnMonday?: boolean;
36 | };
37 |
38 | export function TrackerWidget({
39 |   date: initialDate,
40 |   meta,
41 |   data,
42 |   weekStartsOnMonday = false,
43 | }: Props) {
44 |   const {
45 |     date: currentDate,
46 |     range,
47 |     setParams,
48 |     selectedDate,
49 |   } = useTrackerParams(initialDate);
50 |
51 |   const [isDragging, setIsDragging] = useState(false);
52 |   const [dragStart, setDragStart] = useState<string | null>(null);
53 |   const [dragEnd, setDragEnd] = useState<string | null>(null);
54 |
55 |   const monthStart = startOfMonth(currentDate);
56 |   const monthEnd = endOfMonth(currentDate);
57 |   const calendarStart = startOfWeek(monthStart, {
58 |     weekStartsOn: weekStartsOnMonday ? 1 : 0,
59 |   });
60 |   const calendarEnd = endOfWeek(monthEnd, {
61 |     weekStartsOn: weekStartsOnMonday ? 1 : 0,
62 |   });
63 |   const calendarDays = eachDayOfInterval({
64 |     start: calendarStart,
65 |     end: calendarEnd,
66 |   });
67 |
68 |   const sortedDates = sortDates(range ?? []);
69 |
70 |   const firstWeek = eachDayOfInterval({
71 |     start: calendarStart,
72 |     end: endOfWeek(calendarStart, { weekStartsOn: weekStartsOnMonday ? 1 : 0 }),
73 |   });
74 |
75 |   const ref = useClickAway<HTMLDivElement>(() => {
76 |     if (range?.length === 1) {
77 |       setParams({ range: null });
78 |     }
79 |   });
80 |
81 |   const getEventCount = (date: Date) => {
82 |     return data?.[formatISO(date, { representation: "date" })]?.length ?? 0;
83 |   };
84 |
85 |   const handleMouseDown = (date: Date) => {
86 |     setIsDragging(true);
87 |     const dateStr = formatISO(date, { representation: "date" });
88 |     setDragStart(dateStr);
89 |     setDragEnd(null);
90 |     setParams({ range: [dateStr] });
91 |   };
92 |
93 |   const handleMouseEnter = (date: Date) => {
94 |     if (isDragging) {
95 |       setDragEnd(formatISO(date, { representation: "date" }));
96 |     }
97 |   };
98 |
99 |   const handleMouseUp = () => {
100 |     setIsDragging(false);
101 |     if (dragStart && dragEnd) {
102 |       setParams({
103 |         range: [dragStart, dragEnd].sort(),
104 |       });
105 |     } else if (dragStart) {
106 |       setParams({ selectedDate: dragStart, range: null });
107 |     }
108 |     setDragStart(null);
109 |     setDragEnd(null);
110 |   };
111 |
112 |   useEffect(() => {
113 |     const handleGlobalMouseUp = () => {
114 |       if (isDragging) {
115 |         handleMouseUp();
116 |       }
117 |     };
118 |
119 |     document.addEventListener("mouseup", handleGlobalMouseUp);
120 |     return () => {
121 |       document.removeEventListener("mouseup", handleGlobalMouseUp);
122 |     };
123 |   }, [isDragging, dragStart, dragEnd]);
124 |
125 |   return (
126 |     <div ref={ref}>
127 |       <TrackerHeader totalDuration={meta?.totalDuration} />
128 |
129 |       <div className="mt-4">
130 |         <div className="grid grid-cols-7 gap-px border border-border bg-border">
131 |           {firstWeek.map((day) => (
132 |             <div
133 |               key={day.toString()}
134 |               className="py-4 px-3 bg-background text-xs font-medium text-[#878787] font-mono"
135 |             >
136 |               {format(day, "EEE").toUpperCase()}
137 |             </div>
138 |           ))}
139 |           {calendarDays.map((date, index) => {
140 |             const isCurrentMonth =
141 |               new Date(date).getMonth() === new Date(currentDate).getMonth();
142 |             const dateStr = formatISO(date, { representation: "date" });
143 |             const isInDragRange =
144 |               dragStart &&
145 |               dragEnd &&
146 |               ((dateStr >= dragStart && dateStr <= dragEnd) ||
147 |                 (dateStr <= dragStart && dateStr >= dragEnd));
148 |
149 |             return (
150 |               <button
151 |                 type="button"
152 |                 onMouseDown={() => handleMouseDown(date)}
153 |                 onMouseEnter={() => handleMouseEnter(date)}
154 |                 key={index.toString()}
155 |                 className={cn(
156 |                   "pt-2 pb-5 px-3 font-mono text-sm relative transition-all duration-100 text-left aspect-square",
157 |                   isCurrentMonth && isToday(date)
158 |                     ? "bg-[#f0f0f0] dark:bg-[#202020]"
159 |                     : "bg-background",
160 |                   !isCurrentMonth &&
161 |                     "bg-[repeating-linear-gradient(-60deg,#DBDBDB,#DBDBDB_1px,transparent_1px,transparent_5px)] dark:bg-[repeating-linear-gradient(-60deg,#2C2C2C,#2C2C2C_1px,transparent_1px,transparent_5px)]",
162 |                   selectedDate === dateStr && "ring-1 ring-primary",
163 |                   (range?.includes(dateStr) ||
164 |                     (sortedDates.length === 2 &&
165 |                       date >= new Date(sortedDates[0] || 0) &&
166 |                       date <= new Date(sortedDates[1] || 0))) &&
[TRUNCATED]
```

apps/dashboard/src/components/widgets/vault/index.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
3 | import { Suspense } from "react";
4 | import {
5 |   VaultWidget,
6 |   VaultWidgetHeader,
7 |   VaultWidgetSkeleton,
8 | } from "./vault-widget";
9 |
10 | export function Vault() {
11 |   return (
12 |     <div className="border aspect-square overflow-hidden relative p-4 md:p-8">
13 |       <VaultWidgetHeader />
14 |
15 |       <ErrorBoundary errorComponent={ErrorFallback}>
16 |         <Suspense fallback={<VaultWidgetSkeleton />}>
17 |           <VaultWidget />
18 |         </Suspense>
19 |       </ErrorBoundary>
20 |     </div>
21 |   );
22 | }
```

apps/dashboard/src/components/widgets/vault/vault-widget.tsx
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { getVaultActivityQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import Link from "next/link";
5 | import { Vault } from "./vault";
6 |
7 | export function VaultWidgetSkeleton() {
8 |   return null;
9 | }
10 |
11 | export function VaultWidgetHeader() {
12 |   return (
13 |     <div>
14 |       <Link href="/vault" prefetch>
15 |         <h2 className="text-lg">Recent files</h2>
16 |       </Link>
17 |       <div className="flex py-3 border-b-[1px] justify-between mt-4">
18 |         <span className="font-medium text-sm">Name</span>
19 |         <span className="font-medium text-sm">Tag</span>
20 |       </div>
21 |     </div>
22 |   );
23 | }
24 |
25 | export async function VaultWidget() {
26 |   const supabase = createClient();
27 |   const { data: userData } = await getUser();
28 |
29 |   const { data: storageData } = await getVaultActivityQuery(
30 |     supabase,
31 |     userData?.team_id,
32 |   );
33 |
34 |   const files = storageData
35 |     ?.filter((file) => file?.path_tokens.pop() !== ".emptyFolderPlaceholder")
36 |     .map((file) => {
37 |       const [_, ...pathWithoutTeamId] = file?.path_tokens ?? [];
38 |
39 |       return {
40 |         id: file.id,
41 |         name: file.name?.split("/").at(-1),
42 |         path: file.path_tokens,
43 |         mimetype: file.metadata?.mimetype,
44 |         team_id: file.team_id,
45 |         tag: file.tag,
46 |         filePath: pathWithoutTeamId?.join("/"),
47 |       };
48 |     });
49 |
50 |   if (!files?.length) {
51 |     return (
52 |       <div className="flex items-center justify-center aspect-square">
53 |         <p className="text-sm text-[#606060] -mt-12">No files found</p>
54 |       </div>
55 |     );
56 |   }
57 |
58 |   return <Vault files={files} />;
59 | }
```

apps/dashboard/src/components/widgets/vault/vault.tsx
```
1 | import { FilePreview } from "@/components/file-preview";
2 | import { Tag } from "@/components/tables/vault/tag";
3 | import {
4 |   HoverCard,
5 |   HoverCardContent,
6 |   HoverCardTrigger,
7 | } from "@midday/ui/hover-card";
8 | import { isSupportedFilePreview } from "@midday/utils";
9 |
10 | type Props = {
11 |   files: {
12 |     id: string;
13 |     name: string;
14 |     tag?: string;
15 |     mimetype: string;
16 |     team_id: string;
17 |     filePath: string;
18 |   }[];
19 | };
20 |
21 | export function Vault({ files }: Props) {
22 |   return (
23 |     <ul className="bullet-none divide-y cursor-pointer overflow-auto scrollbar-hide aspect-square pb-24">
24 |       {files?.map((file) => {
25 |         const filePreviewSupported = isSupportedFilePreview(file.mimetype);
26 |
27 |         return (
28 |           <li key={file.id}>
29 |             <HoverCard openDelay={200}>
30 |               <HoverCardTrigger asChild>
31 |                 <div className="flex items-center py-3">
32 |                   <div className="w-[55%]">
33 |                     <span className="text-sm line-clamp-1">{file.name}</span>
34 |                   </div>
35 |
36 |                   <div className="ml-auto w-[40%] flex justify-end">
37 |                     <Tag name={file.tag} />
38 |                   </div>
39 |                 </div>
40 |               </HoverCardTrigger>
41 |               {filePreviewSupported && (
42 |                 <HoverCardContent className="w-[273px] h-[358px] p-0 overflow-hidden">
43 |                   <FilePreview
44 |                     width={280}
45 |                     height={365}
46 |                     src={`/api/proxy?filePath=vault/${file.team_id}/${file.filePath}/${file.name}`}
47 |                     downloadUrl={`/api/download/file?path=${file.filePath}/${file.name}&filename=${file.name}`}
48 |                     name={file.name}
49 |                     type={file?.mimetype}
50 |                   />
51 |                 </HoverCardContent>
52 |               )}
53 |             </HoverCard>
54 |           </li>
55 |         );
56 |       })}
57 |     </ul>
58 |   );
59 | }
```

apps/engine/src/providers/gocardless/__snapshots__/transform.test.ts.snap
```
1 | // Bun Snapshot v1, https://goo.gl/fbAQLP
2 |
3 | exports[`Transform income transaction 1`] = `
4 | {
5 |   "amount": -38000,
6 |   "balance": null,
7 |   "category": "transfer",
8 |   "currency": "SEK",
9 |   "currency_rate": null,
10 |   "currency_source": null,
11 |   "date": "2024-02-23",
12 |   "description": null,
13 |   "id": "86b1bc36e6a6d2a5dee8ff7138920255",
14 |   "method": "transfer",
15 |   "name": "Lön 160434262327",
16 |   "status": "posted",
17 | }
18 | `;
19 |
20 | exports[`Transform accounts 1`] = `
21 | {
22 |   "balance": {
23 |     "amount": 1942682.86,
24 |     "currency": "SEK",
25 |   },
26 |   "currency": "SEK",
27 |   "enrollment_id": null,
28 |   "id": "b11e5627-cac8-41c9-a74a-2b88438fe07d",
29 |   "institution": {
30 |     "id": "PLEO_PLEODK00",
31 |     "logo": "https://cdn-engine.midday.ai/PLEO_PLEODK00.png",
32 |     "name": "Pleo",
33 |     "provider": "gocardless",
34 |   },
35 |   "name": "Pleo Account",
36 |   "resource_id": "3133",
37 |   "type": "depository",
38 | }
39 | `;
40 |
41 | exports[`Transform account balance 1`] = `
42 | {
43 |   "amount": 1942682.86,
44 |   "currency": "SEK",
45 | }
46 | `;
```

apps/engine/src/providers/plaid/__snapshots__/transform.test.ts.snap
```
1 | // Bun Snapshot v1, https://goo.gl/fbAQLP
2 |
3 | exports[`Transform pending transaction 1`] = `
4 | {
5 |   "amount": -5.4,
6 |   "balance": null,
7 |   "category": "travel",
8 |   "currency": "CAD",
9 |   "currency_rate": null,
10 |   "currency_source": null,
11 |   "date": "2024-02-24",
12 |   "description": "Uber",
13 |   "id": "NxkDjlyk45cQoDm5PEqJuKJaw6qrj9cy89zBA",
14 |   "method": "other",
15 |   "name": "Uber 063015 SF**POOL**",
16 |   "status": "pending",
17 | }
18 | `;
19 |
20 | exports[`Transform income transaction 1`] = `
21 | {
22 |   "amount": -1500,
23 |   "balance": null,
24 |   "category": "travel",
25 |   "currency": "CAD",
26 |   "currency_rate": null,
27 |   "currency_source": null,
28 |   "date": "2024-02-22",
29 |   "description": null,
30 |   "id": "5QKmMdaKWgtzkvKEPmqriLZR1mV3kMF5X9EeX",
31 |   "method": "other",
32 |   "name": "United Airlines",
33 |   "status": "posted",
34 | }
35 | `;
36 |
37 | exports[`Transform type transfer 1`] = `
38 | {
39 |   "amount": -31.53,
40 |   "balance": null,
41 |   "category": "travel",
42 |   "currency": "CAD",
43 |   "currency_rate": null,
44 |   "currency_source": null,
45 |   "date": "2024-02-24",
46 |   "description": "Uber",
47 |   "id": "NxkDjlyk45cQoDm5PEqJuKJaw6qrj9cy89zBA",
48 |   "method": "transfer",
49 |   "name": "Uber 063015 SF**POOL**",
50 |   "status": "pending",
51 | }
52 | `;
53 |
54 | exports[`Transform accounts 1`] = `
55 | {
56 |   "balance": {
57 |     "amount": 56302.06,
58 |     "currency": "CAD",
59 |   },
60 |   "currency": "CAD",
61 |   "enrollment_id": null,
62 |   "id": "kKZWQnoZVqcBeN71qdyoh8mVoErgb7tL7gmBL",
63 |   "institution": {
64 |     "id": "ins_100546",
65 |     "logo": "https://cdn-engine.midday.ai/ins_100546.jpg",
66 |     "name": "American Funds Retirement Solutions",
67 |     "provider": "plaid",
68 |   },
69 |   "name": "Plaid Mortgage",
70 |   "resource_id": null,
71 |   "type": "other_asset",
72 | }
73 | `;
74 |
75 | exports[`Transform account balance 1`] = `
76 | {
77 |   "amount": 2000,
78 |   "currency": "USD",
79 | }
80 | `;
```

apps/engine/src/providers/teller/__snapshots__/transform.test.ts.snap
```
1 | // Bun Snapshot v1, https://goo.gl/fbAQLP
2 |
3 | exports[`Transform pending transaction 1`] = `
4 | {
5 |   "amount": -83.62,
6 |   "balance": null,
7 |   "category": null,
8 |   "currency": "USD",
9 |   "currency_rate": null,
10 |   "currency_source": null,
11 |   "date": "2024-03-05",
12 |   "description": "Bank Of Many",
13 |   "id": "txn_os41r5u90e29shubl2000",
14 |   "method": "other",
15 |   "name": "Online Check Deposit",
16 |   "status": "pending",
17 | }
18 | `;
19 |
20 | exports[`Transform pending transaction 2`] = `
21 | {
22 |   "amount": -29,
23 |   "balance": null,
24 |   "category": null,
25 |   "currency": "USD",
26 |   "currency_rate": null,
27 |   "currency_source": null,
28 |   "date": "2024-03-05",
29 |   "description": "Bank Of Many",
30 |   "id": "txn_os41r5u90e29shubl2000",
31 |   "method": "other",
32 |   "name": "Technology",
33 |   "status": "pending",
34 | }
35 | `;
36 |
37 | exports[`Transform card payment transaction 1`] = `
38 | {
39 |   "amount": -68.9,
40 |   "balance": 83431.46,
41 |   "category": null,
42 |   "currency": "USD",
43 |   "currency_rate": null,
44 |   "currency_source": null,
45 |   "date": "2024-03-01",
46 |   "description": null,
47 |   "id": "txn_os41r5u90e29shubl2005",
48 |   "method": "card_purchase",
49 |   "name": "Nordstrom",
50 |   "status": "posted",
51 | }
52 | `;
53 |
54 | exports[`Transform income transaction 1`] = `
55 | {
56 |   "amount": 1000000,
57 |   "balance": 83296.4,
58 |   "category": "income",
59 |   "currency": "USD",
60 |   "currency_rate": null,
61 |   "currency_source": null,
62 |   "date": "2024-03-03",
63 |   "description": null,
64 |   "id": "txn_os41r5u90e29shubl2002",
65 |   "method": "card_purchase",
66 |   "name": "Exxon Mobil",
67 |   "status": "posted",
68 | }
69 | `;
70 |
71 | exports[`Transform type transfer 1`] = `
72 | {
73 |   "amount": -37.99,
74 |   "balance": 85897.25,
75 |   "category": null,
76 |   "currency": "USD",
77 |   "currency_rate": null,
78 |   "currency_source": null,
79 |   "date": "2024-01-27",
80 |   "description": "Yourself",
81 |   "id": "txn_os41r5ua0e29shubl2001",
82 |   "method": "transfer",
83 |   "name": "Recurring Transfer To Savings",
84 |   "status": "posted",
85 | }
86 | `;
87 |
88 | exports[`Transform accounts 1`] = `
89 | {
90 |   "balance": {
91 |     "amount": 2011100,
92 |     "currency": "USD",
93 |   },
94 |   "currency": "USD",
95 |   "enrollment_id": "enr_os557c8pck2deoskak000",
96 |   "id": "acc_os557c2mge29shubl2000",
97 |   "institution": {
98 |     "id": "mercury",
99 |     "logo": "https://cdn-engine.midday.ai/mercury.jpg",
100 |     "name": "Mercury",
101 |     "provider": "teller",
102 |   },
103 |   "name": "Platinum Card",
104 |   "resource_id": null,
105 |   "type": "credit",
106 | }
107 | `;
108 |
109 | exports[`Transform account balance 1`] = `
110 | {
111 |   "amount": 2011100,
112 |   "currency": "USD",
113 | }
114 | `;
```

apps/website/src/app/components/editor/page.tsx
```
1 | import { Editor } from "@midday/ui/editor";
2 | import type { Metadata } from "next";
3 |
4 | export const metadata: Metadata = {
5 |   title: "Editor | Midday",
6 |   description: "A rich text editor with AI tools powered by Vercel AI SDK.",
7 | };
8 |
9 | const defaultContent = `
10 | <h2>Introducing Midday Editor</h2>
11 |
12 | <p>We have developed a text editor based on Tiptap, which is a core component of our Invoicing feature. This editor has been enhanced with AI capabilities using the Vercel AI SDK, allowing for intelligent text processing and generation. After extensive internal use and refinement, we have now released this editor as an open-source tool for the wider developer community.</p>
13 |
14 | <br />
15 |
16 | <strong>Easy Integration</strong>
17 |
18 | <p>To ensure seamless integration and consistency within your codebase, we've made it easy to add the Midday Editor to your project. You can simply copy and paste the necessary code from our dedicated documentation. This method allows you to quickly incorporate all required dependencies and components directly into your project repository.</p>
19 |
20 | <br />
21 |
22 | <p>We're actively working on adding the Midday Editor to the shadcn/cli, which will soon allow you to install it with just one command. Stay tuned for this upcoming feature!</p>
23 |
24 | <br />
25 |
26 | <strong>Ongoing Development</strong>
27 |
28 | <p>As we continue to develop and expand Midday's features, we're constantly adding new functionality to the editor. Our team is committed to enhancing its capabilities, improving performance, and introducing innovative AI-powered tools to make your editing experience even more powerful and efficient.</p>
29 |
30 | <br />
31 | `;
32 |
33 | export default function Page() {
34 |   return (
35 |     <div className="container mt-24 max-w-[540px]">
36 |       <Editor initialContent={defaultContent} />
37 |
38 |       <div className="mt-8">
39 |         <div className="border bg-card text-card-foreground shadow-sm">
40 |           <div className="flex flex-col space-y-1.5 p-6">
41 |             <h3 className="text-xl font-medium">Install Midday Editor</h3>
42 |             <p className="text-sm text-[#878787]">
43 |               Get started with our powerful AI-enhanced text editor
44 |             </p>
45 |           </div>
46 |           <div className="p-6 pt-0">
47 |             <a
48 |               href="https://go.midday.ai/editor-code"
49 |               target="_blank"
50 |               rel="noopener noreferrer"
51 |               className="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
52 |             >
53 |               View implementation
54 |             </a>
55 |           </div>
56 |         </div>
57 |       </div>
58 |     </div>
59 |   );
60 | }
```

apps/website/src/app/components/invoice/page.tsx
```
1 | import type { Metadata } from "next";
2 | import Image from "next/image";
3 | import invoice from "public/images/update/invoice-pdf/pdf-invoice.jpg";
4 |
5 | export const metadata: Metadata = {
6 |   title: "React PDF Invoice Template | Midday",
7 |   description: "A React PDF invoice template with Tiptap JSON support.",
8 | };
9 |
10 | export default function Page() {
11 |   return (
12 |     <div className="container mt-24 max-w-[540px]">
13 |       <Image src={invoice} alt="Invoice" />
14 |       <div className="mt-8">
15 |         <div className="border bg-card text-card-foreground shadow-sm">
16 |           <div className="flex flex-col space-y-1.5 p-6">
17 |             <h3 className="text-xl font-medium">Use Midday Invoice Template</h3>
18 |             <p className="text-sm text-[#878787]">
19 |               Get started with our powerful React PDF invoice template
20 |             </p>
21 |           </div>
22 |           <div className="p-6 pt-0">
23 |             <a
24 |               href="https://go.midday.ai/inv"
25 |               target="_blank"
26 |               rel="noopener noreferrer"
27 |               className="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
28 |             >
29 |               View implementation
30 |             </a>
31 |           </div>
32 |         </div>
33 |       </div>
34 |     </div>
35 |   );
36 | }
```

apps/website/src/app/components/invoice-og/page.tsx
```
1 | import type { Metadata } from "next";
2 | import Image from "next/image";
3 | import ogInvoice from "../invoice-og.png";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Open Graph Template | Midday",
7 |   description: "A Next.js Open Graph template for invoices.",
8 | };
9 |
10 | export default function Page() {
11 |   return (
12 |     <div className="container mt-24 max-w-[540px]">
13 |       <Image src={ogInvoice} alt="Invoice" className="border border-border" />
14 |       <div className="mt-8">
15 |         <div className="border bg-card text-card-foreground shadow-sm">
16 |           <div className="flex flex-col space-y-1.5 p-6">
17 |             <h3 className="text-xl font-medium">Open Graph Template</h3>
18 |             <p className="text-sm text-[#878787]">
19 |               Get started with our Next.js Open Graph template
20 |             </p>
21 |           </div>
22 |           <div className="p-6 pt-0">
23 |             <a
24 |               href="https://go.midday.ai/inv-og"
25 |               target="_blank"
26 |               rel="noopener noreferrer"
27 |               className="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
28 |             >
29 |               View implementation
30 |             </a>
31 |           </div>
32 |         </div>
33 |       </div>
34 |     </div>
35 |   );
36 | }
```

apps/website/src/app/components/invoice-react/page.tsx
```
1 | import type { Metadata } from "next";
2 | import Image from "next/image";
3 | import invoice from "./invoice-react.jpg";
4 |
5 | export const metadata: Metadata = {
6 |   title: "React Invoice Template | Midday",
7 |   description: "A React invoice template with Tiptap JSON support.",
8 | };
9 |
10 | export default function Page() {
11 |   return (
12 |     <div className="container mt-24 max-w-[540px]">
13 |       <Image src={invoice} alt="Invoice" className="border border-border" />
14 |       <div className="mt-8">
15 |         <div className="border bg-card text-card-foreground shadow-sm">
16 |           <div className="flex flex-col space-y-1.5 p-6">
17 |             <h3 className="text-xl font-medium">Use Midday Invoice Template</h3>
18 |             <p className="text-sm text-[#878787]">
19 |               Get started with our powerful React invoice template
20 |             </p>
21 |           </div>
22 |           <div className="p-6 pt-0">
23 |             <a
24 |               href="https://go.midday.ai/inv-react"
25 |               target="_blank"
26 |               rel="noopener noreferrer"
27 |               className="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
28 |             >
29 |               View implementation
30 |             </a>
31 |           </div>
32 |         </div>
33 |       </div>
34 |     </div>
35 |   );
36 | }
```

apps/website/src/app/components/invoice-toolbar/page.tsx
```
1 | import type { Metadata } from "next";
2 | import Image from "next/image";
3 | import invoiceToolbar from "../invoice-toolbar.png";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Invoice Toolbar | Midday",
7 |   description: "A Next.js Invoice Toolbar for invoices.",
8 | };
9 |
10 | export default function Page() {
11 |   return (
12 |     <div className="container mt-24 max-w-[540px]">
13 |       <div className="py-[200px] flex items-center justify-center">
14 |         <Image
15 |           src={invoiceToolbar}
16 |           alt="Invoice Toolbar"
17 |           className="max-w-[240px]"
18 |         />
19 |       </div>
20 |       <div className="mt-8">
21 |         <div className="border bg-card text-card-foreground shadow-sm">
22 |           <div className="flex flex-col space-y-1.5 p-6">
23 |             <h3 className="text-xl font-medium">Invoice Toolbar</h3>
24 |             <p className="text-sm text-[#878787]">
25 |               Get started with our Invoice Toolbar
26 |             </p>
27 |           </div>
28 |           <div className="p-6 pt-0">
29 |             <a
30 |               href="https://go.midday.ai/83E5GCe"
31 |               target="_blank"
32 |               rel="noopener noreferrer"
33 |               className="inline-flex items-center justify-center text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
34 |             >
35 |               View implementation
36 |             </a>
37 |           </div>
38 |         </div>
39 |       </div>
40 |     </div>
41 |   );
42 | }
```

apps/website/src/app/updates/[slug]/page.tsx
```
1 | import { baseUrl } from "@/app/sitemap";
2 | import { CustomMDX } from "@/components/mdx";
3 | import { PostAuthor } from "@/components/post-author";
4 | import { PostStatus } from "@/components/post-status";
5 | import { getBlogPosts } from "@/lib/blog";
6 | import type { Metadata } from "next";
7 | import Image from "next/image";
8 | import { notFound } from "next/navigation";
9 |
10 | export async function generateStaticParams() {
11 |   const posts = getBlogPosts();
12 |
13 |   return posts.map((post) => ({
14 |     slug: post.slug,
15 |   }));
16 | }
17 |
18 | export async function generateMetadata(props): Promise<Metadata | undefined> {
19 |   const params = await props.params;
20 |   const post = getBlogPosts().find((post) => post.slug === params.slug);
21 |   if (!post) {
22 |     return;
23 |   }
24 |
25 |   const {
26 |     title,
27 |     publishedAt: publishedTime,
28 |     summary: description,
29 |     image,
30 |   } = post.metadata;
31 |
32 |   return {
33 |     title,
34 |     description,
35 |     openGraph: {
36 |       title,
37 |       description,
38 |       type: "article",
39 |       publishedTime,
40 |       url: `${baseUrl}/blog/${post.slug}`,
41 |       images: [
42 |         {
43 |           url: image,
44 |         },
45 |       ],
46 |     },
47 |     twitter: {
48 |       card: "summary_large_image",
49 |       title,
50 |       description,
51 |       images: [image],
52 |     },
53 |   };
54 | }
55 |
56 | export default async function Page(props: {
57 |   params: Promise<{ slug: string }>;
58 | }) {
59 |   const params = await props.params;
60 |
61 |   const { slug } = params;
62 |
63 |   const post = getBlogPosts().find((post) => post.slug === slug);
64 |
65 |   if (!post) {
66 |     notFound();
67 |   }
68 |
69 |   return (
70 |     <div className="container max-w-[1140px] flex justify-center">
71 |       <script
72 |         type="application/ld+json"
73 |         suppressHydrationWarning
74 |         dangerouslySetInnerHTML={{
75 |           __html: JSON.stringify({
76 |             "@context": "https://schema.org",
77 |             "@type": "BlogPosting",
78 |             headline: post.metadata.title,
79 |             datePublished: post.metadata.publishedAt,
80 |             dateModified: post.metadata.publishedAt,
81 |             description: post.metadata.summary,
82 |             image: `${baseUrl}${post.metadata.image}`,
83 |             url: `${baseUrl}/updates/${post.slug}`,
84 |           }),
85 |         }}
86 |       />
87 |
88 |       <article className="max-w-[680px] pt-[80px] md:pt-[150px] w-full">
89 |         <PostStatus status={post.metadata.tag} />
90 |
91 |         <h2 className="font-medium text-2xl mb-6">{post.metadata.title}</h2>
92 |
93 |         <div className="updates">
94 |           {post.metadata.image && (
95 |             <Image
96 |               src={post.metadata.image}
97 |               alt={post.metadata.title}
98 |               width={680}
99 |               height={442}
100 |               className="mb-12"
101 |             />
102 |           )}
103 |           <CustomMDX source={post.content} />
104 |         </div>
105 |
106 |         <div className="mt-10">
107 |           <PostAuthor author="pontus" />
108 |         </div>
109 |       </article>
110 |     </div>
111 |   );
112 | }
```

apps/website/src/app/updates/posts/apps.mdx
```
1 | ---
2 | title: "Introducing Apps"
3 | publishedAt: "2024-09-29"
4 | summary: "We are excited to announce the launch of Apps in the Midday. You can now easily connect your favorite tools to streamline your workflow."
5 | image: "/images/update/apps/apps.jpg"
6 | tag: "Updates"
7 | ---
8 |
9 | We are excited to announce the launch of Apps in Midday. You can now easily connect your favorite tools to streamline your workflow. Starting with Slack, we will continue to expand to other tools that you love.
10 | <br />
11 |
12 |
13 | ## Install Apps
14 | ![Apps overview](/images/update/apps/apps-1.png)
15 | <br />
16 | There is a new Apps menu in the sidebar. Here you can find all the apps available to you.
17 |
18 | To install an app, you can either click the "Install" button, or click the "Details" button to learn more about the app.
19 |
20 | <br />
21 | ## App Details
22 | ![App details](/images/update/apps/apps-2.png)
23 | <br />
24 |
25 | You can read more about the specific app in the details page, in this example we are looking at the Slack app that will enable you to connect your Slack workspace to Midday and get notifications about new transactions and give you Midday Assistant right in your Slack workspace.
26 |
27 |
28 | <br/>
29 | ## Slack Assistant
30 | ![Slack Assistant](/images/update/apps/slack.png)
31 | <br />
32 |
33 | In the example above we are using the Slack Assistant to send a message to the channel. You can use the Slack Assistant to know your burn rate, track your expenses, and get insights about your transactions.
34 |
35 | You can also upload receipts and invoices to Midday right from Slack and we will extract the data and match it to your transactions.
36 | <br />
37 | While this is just the beginning, we are excited to bring more apps to you.
38 | <br />
39 | <br />
40 |
41 | [Sign up for an account](https://app.midday.ai) and start using Midday today.
```

apps/website/src/app/updates/posts/assistant.mdx
```
1 | ---
2 | title: "Introducing Midday Assistant"
3 | publishedAt: "2024-05-20"
4 | summary: "Our most requested feature is now ready for you to try! Introducing Midday Assistant. With help from the community, we have implemented many great features."
5 | image: "/images/assistant.png"
6 | tag: "Updates"
7 | ---
8 |
9 | Our most requested feature is now ready for you to try! Introducing Midday Assistant. With help from the community, we have implemented many great features. Here are some highlights of what you can do using the assistant today:
10 |
11 | <br />
12 |
13 | - Find the things you are looking for (transactions, invoices, documents, and more)
14 | - Watch your spending
15 | - View your profit, revenue, burn rate, and revenue graphs
16 | - Find transactions without receipts
17 |
18 | <br />
19 | These are just some examples. You can ask follow-up questions and dig deeper into
20 | your data.
21 |
22 | <br />
23 |
24 | This is just the beginning of Midday Assistant, and we will continue to invest and listen to your feedback so you have everything you need to run your business. Don't hesitate to give us feedback directly from the assistant or by scheduling a quick [15-minute call](https://cal.com/pontus-midday/15min) with us to share your thoughts!
25 |
26 | <br />
27 | If you are running Midday on Mac, you should update to `v1.9` for the latest version.
28 |
29 | <br />
30 |
31 | To get started you can [sign in here](https://app.midday.ai).
```

apps/website/src/app/updates/posts/august-product-updates.mdx
```
1 | ---
2 | title: "August Product Update"
3 | publishedAt: "2024-09-03"
4 | summary: "In this release, we're introducing three major updates along with a few helpful additions. You'll enjoy a much better vault experience with search and filters, document classifications, and significantly improved speed. Plus, we've added AI filters for transactions and a much better import feature."
5 | tag: "Updates"
6 | ---
7 |
8 | In this release, we're introducing three major updates along with a few helpful additions. You'll enjoy a much better vault experience with search and filters, document classifications, and significantly improved speed. Plus, we've added AI filters for transactions and a much better import feature.
9 | <br />
10 |
11 |
12 | ## Vault
13 | ![Vault](/images/update/august-product-updates/vault.jpg)
14 | <br />
15 | We have rebuilt our Vault to be much faster, added a search where you can search for content within your documents, plus we have added the option for you to enable classifications of documents, for example invoices and receipts, so it's easy to filter.
16 |
17 | #### Search and filters
18 | We extract information and make your documents easy to find by simply searching for what you are looking for.
19 |
20 | #### Classifications (off by default)
21 | With the help of AI, we can classify your documents for an even easier way to find and identify them. You can enable this feature in your Vault settings.
22 |
23 | <br />
24 | <br />
25 |
26 | ## Import transactions
27 | ![Import transactions](/images/update/august-product-updates/import.jpg)
28 | <br />
29 | We have updated our import solution to support CSV, PDF, and screenshots of transactions to help as many users as possible get started with Midday.
30 |
31 | #### AI Mapping
32 | We have updated our UI to support manual override on mapping fields when we can't figure them out for you.
33 |
34 | #### Screenshots and PDFs
35 | We added support for uploading images of transactions to assist users whose banks don't have CSV files available.
36 |
37 | #### Create Transaction
38 | You can also manually create transactions from the transactions page.
39 |
40 | <br />
41 | <br />
42 |
43 | ## Filters for transactions
44 | ![Filters](/images/update/august-product-updates/filters.jpg)
45 | <br />
46 | It's now easier than ever to find the transaction you are looking for, or filter based on a specific date range. For example, you can search for: "Transactions from Q1 this year without receipts". You get what I mean - give it a try and let us know what you think.
47 |
48 | <br />
49 | ### Updated filters
50 | A much cleaner look, context-based filters, and the ability to navigate them using your keyboard for fast access.
51 |
52 | #### Bulk actions
53 | Sometimes, you want to change many transactions at the same time. We have now updated the UI to be much better for this purpose.
54 |
55 | <br />
56 | <br />
57 |
58 | ## What's coming next
59 |
60 | ![Time Tracker](/images/update/august-product-updates/tracker.jpg)
61 | <br />
62 | #### Time Tracker
63 | Our time tracker is getting a much-needed UI update that's much easier to understand and navigate. Along with that, our native app will also get a timer and command menu.
64 |
65 | <br />
66 | <br />
67 |
68 | ![Invoicing](/images/update/august-product-updates/invoice.jpg)
69 | <br />
70 | #### Invoicing
71 | Viktor is working hard on the design and prototyping extensively to create the best possible experience with creating invoices. We will update you all along the way, and we are really excited to deliver this feature to all of you soon!
72 |
73 |
74 | <br />
75 |
76 | Give these a try and let us know what you think [get started here](https://app.midday.ai).
```

apps/website/src/app/updates/posts/dub.mdx
```
1 | ---
2 | title: "How we implemented link-sharing using Dub.co"
3 | publishedAt: "2024-04-04"
4 | summary: "We have some features like Time Tracker, Reports and files from Vault that our users shares outside their company and with that we have an authorization layer on our side using Supabase, but these links are often really long because they include a unique token."
5 | image: "/images/dub.png"
6 | tag: "Engineering"
7 | ---
8 |
9 | Earlier this week [Dub.co](http://Dub.co) shared our [customer story](https://dub.co/customers/midday) on why we choose Dub as our link-sharing infrastructure.
10 |
11 | <br />
12 | In this blog post where gonna share a little more in details how we implemented this
13 | functionality.
14 |
15 | <br />
16 | We have some features like Time Tracker, Reports and files from Vault that our users
17 | shares outside their company and with that we have an authorization layer on our
18 | side using Supabase, but these links are often really long because they include a
19 | unique token.
20 | <br />
21 | Our solution was to implement Dub to generate unique short URLs.
22 |
23 | <br />
24 | ### How we implemented sharing for our reports
25 |
26 | <br />
27 | ![Midday - Overview](/images/overview.png)
28 |
29 | <br />
30 | If you look closely you can se our link looks like this: [https://go.midday.ai/5eYKrmV](https://go.midday.ai/5eYKrmV)
31 |
32 | <br />
33 | When the user clicks `Share` we execute a server action using the library `next-safe-action`
34 |
35 | that looks like this:
36 |
37 | ```typescript
38 | const createReport = useAction(createReportAction, {
39 |   onError: () => {
40 |     toast({
41 |       duration: 2500,
42 |       variant: "error",
43 |       title: "Something went wrong pleaase try again.",
44 |     });
45 |   },
46 |   onSuccess: (data) => {
47 |     setOpen(false);
48 |
49 |     const { id } = toast({
50 |       title: "Report published",
51 |       description: "Your report is ready to share.",
52 |       variant: "success",
53 |       footer: (
54 |         <div className="mt-4 space-x-2 flex w-full">
55 |           <CopyInput
56 |             value={data.short_link}
57 |             className="border-[#2C2C2C] w-full"
58 |           />
59 |
60 |           <Link href={data.short_link} onClick={() => dismiss(id)}>
61 |             <Button>View</Button>
62 |           </Link>
63 |         </div>
64 |       ),
65 |     });
66 |   },
67 | });
68 | ```
69 |
70 | <br />
71 |
72 | The nice thing with next-safe-action is that you get callbacks on onError and onSuccess so in this case we show a toast based on the callback.
73 |
74 | <br />
75 |
76 | The action is pretty straightforward too, we first save the report based on the current parameters (from, to and type) depending on what kind of report we are creating.
77 |
78 | <br />
79 | We save it in Supabase and get a id back that we use to generate our sharable URL.
80 |
81 | ```typescript
82 | const dub = new Dub({ projectSlug: "midday" });
83 |
84 | export const createReportAction = action(schema, async (params) => {
85 |   const supabase = createClient();
86 |   const user = await getUser();
87 |
88 |   const { data } = await supabase
89 |     .from("reports")
90 |     .insert({
91 |       team_id: user.data.team_id,
92 |       from: params.from,
93 |       to: params.to,
94 |       type: params.type,
95 |       expire_at: params.expiresAt,
96 |     })
97 |     .select("*")
98 |     .single();
99 |
100 |   const link = await dub.links.create({
101 |     url: `${params.baseUrl}/report/${data.id}`,
102 |     rewrite: true,
103 |     expiresAt: params.expiresAt,
104 |   });
105 |
106 |   const { data: linkData } = await supabase
107 |     .from("reports")
108 |     .update({
109 |       link_id: link.id,
110 |       short_link: link.shortLink,
111 |     })
112 |     .eq("id", data.id)
113 |     .select("*")
114 |     .single();
115 |
116 |   const logsnag = await setupLogSnag();
117 |
118 |   logsnag.track({
119 |     event: LogEvents.OverviewReport.name,
120 |     icon: LogEvents.OverviewReport.icon,
121 |     channel: LogEvents.OverviewReport.channel,
122 |   });
123 |
124 |   return linkData;
125 | });
126 | ```
127 |
128 | <br />
129 | With the combination of server actions, Supabase and Dub we can create really beautiful
130 | URLs with analytics on top.
131 |
132 | <br />
[TRUNCATED]
```

apps/website/src/app/updates/posts/early-adopter.mdx
```
1 | ---
2 | title: "The Early Adopter Plan"
3 | publishedAt: "2024-03-15"
4 | summary: "We are currently collaborating with our first group of beta users to refine our product and find the right fit for the market. If you're interested in shaping the future of Midday and becoming an early adopter, feel free to join our community. There's no obligation to contribute, and we're thrilled that you want to try out the system."
5 | image: "/images/plan.png"
6 | tag: "Update"
7 | ---
8 |
9 | ### Being an Early Adopter
10 |
11 | We are currently collaborating with our first group of beta users to refine our product and find the right fit for the market. If you're interested in shaping the future of Midday and becoming an early adopter, feel free to join our community. There's no obligation to contribute, and we're thrilled that you want to try out the system.
12 |
13 | <br />
14 | During our private beta phase, you may encounter some bugs, but we genuinely want
15 | all your feedback.
16 |
17 | <br />
18 | ### The Early Adopter Plan
19 |
20 | - This plan includes access to all features.
21 | - Priced at $30 per month but free while in beta.
22 | - Your subscription price will remain unchanged for life as a token of appreciation for supporting Midday in its early stage, regardless of the additional features we introduce.
23 |
24 | <br />
25 | ### Community-Driven Development
26 |
27 | As we continue to enhance Midday, we highly value your input and ideas. Here are three ways you can share your thoughts with us:
28 |
29 | - [Join our Discord server](https://go.midday.ai/anPiuRx).
30 | - Leave feedback directly through the system (control+space).
31 | - [Schedule a 15-minute call with our team](/talk-to-us).
```

apps/website/src/app/updates/posts/engine.mdx
```
1 | ---
2 | title: "Midday Engine"
3 | publishedAt: "2024-06-18"
4 | summary: "The core of Midday is based on our customers transactions. Using this data, we can do a lot to help you run your business smarter when it comes to financial insights, reconciling receipts, and more."
5 | image: "/images/engine.png"
6 | tag: "Updates"
7 | ---
8 |
9 | The core of Midday is based on our customers transactions. Using this data, we can do a lot to help you run your business smarter when it comes to financial insights, reconciling receipts, and more.
10 |
11 | <br />
12 |
13 | Today we support 3 different banking providers which enables us to connect to over
14 | 20 000+ banks in 33 countries across US, Canada, UK and Europe and more to come.
15 |
16 | <br />
17 | Here is an overview of the technologies and services we use to build our engine.
18 |
19 | <br />
20 | ![Engine - Providers](/images/providers.png)
21 | <br />
22 |
23 | ### Architecture
24 |
25 | We provide an API that gives our services transformed transactions, accounts, and balances for Midday to use. Here is how we built it and the technologies we chose.
26 |
27 | <br />
28 |
29 | - **[Cloudflare](https://www.cloudflare.com/)** - (workers, cron, mTLS)
30 | - **[Hono](https://hono.dev/)**- (framework, OpenAPI, RPC)
31 | - **[Typesense](https://typesense.org/)** - search index
32 | - **[Trigger.dev](https://trigger.dev/)** - background jobs
33 | - **[Unkey](https://unkey.dev/)** - API keys, rate limiting, and usage analytics
34 | - **[Sentry](https://sentry.io)** - Observability
35 | - **[OpenStatus](https://www.openstatus.dev/)** - monitoring and alerts
36 |
37 | <br />
38 | ### Cloudflare
39 |
40 | We use a lot of services in Cloudflare. Workers is the compute where our API is hosted, using Hono as our framework.
41 |
42 | <br />
43 | The API uses OpenAPI v3.0 and exposes endpoints for transactions, accounts, search,
44 | and balances.
45 |
46 | We use Cloudflare KV for session caching with GoCardless to avoid hitting any rate limits and for general caching purposes.
47 |
48 | <br />
49 | In the end, we have one interface for our customers to search for their institution.
50 | To support this, we retrieve all institutions from our providers, transform the information,
51 | and store it in Typesense. We use a simple Cron job in Cloudflare every 24 hours
52 | to ensure we have the most recent information.
53 |
54 | <br />
55 | To connect to Teller, you need to use mTLS to authenticate. Thanks to Cloudflare,
56 | we can just upload our certificate and configure our worker to use it when needed.
57 |
58 | <br />
59 | ### Hono
60 |
61 | We chose to use the Hono framework because it's portable, super lightweight, and provides an incredible developer experience among other features:
62 |
63 | - **Caching** - we cache directly in Cloudflare
64 | - **Zod** - for parsing and validating payloads
65 | - **OpenAPI** - generate our specification
66 |
67 | <br />
68 | ### Typesense
69 |
70 | For our customers, we want just one interface for them to search and find their bank. For that to be possible, we needed an index, and we went with Typesense because it's super powerful and easy to use.
71 |
72 | We show banks based on country, fuzzy search, and priority.
73 |
74 | <br />
75 | ### Unkey
76 |
77 | We will soon offer Engine to other companies to use. We will use Unkey for API key management, rate limits, and analytics.
78 |
79 | <br />
80 | ### Trigger.dev
81 |
82 | Our platform fetches transactions regularly with the help of background jobs hosted by Trigger.dev, communicating with our Engine API via RPC. We also use:
83 |
84 | - **Retries**
85 | - **Logging**
86 | - **Error handling**
87 |
88 | <br />
89 | ### Sentry
90 |
91 | To deliver a great service, it's super important to fix bugs and issues fast. With the help of Sentry, we can see what's going on and where we have issues. Additionally, we can also know when external APIs underperform or if we have any other bottlenecks.
92 |
93 | - **Logging and debugging**
94 | - **Alerts**
95 | - **Performance metrics**
96 |
97 | <br />
98 | ### OpenStatus
99 |
[TRUNCATED]
```

apps/website/src/app/updates/posts/incident-report-for-june-22-2024.mdx
```
1 | ---
2 | title: "Incident report for June 22"
3 | publishedAt: "2024-06-22"
4 | summary: ""
5 | tag: "Security"
6 | ---
7 |
8 | On June 22nd, we got notified by [Lunchcat](https://lunchcat.dev) that users' email addresses and names could be accessed through our API.
9 |
10 | <br />
11 | We have addressed the issue and revised our security policy accordingly.
12 | <br />
13 | We deeply apologize for any impact this incident may have had on our users. Our commitment
14 | to transparency and prevention remains steadfast. Below is a summary of what occurred,
15 | how we resolved the issue, and the measures we are implementing to prevent future
16 | occurrences.
17 |
18 | <br />
19 | ### Incident timeline
20 |
21 | - On June 22nd, at 3:01 PM, we got notified about the issue.
22 | - On June 22nd, at 3:44 PM, we identified the issue.
23 | - On June 22nd, at 3:49 PM, we resolved the issue.
24 |
25 | <br />
26 | ### How this affects you
27 |
28 | No user action is required to continue safely. <br />
29 | Accessed: User email and name.
30 |
31 | <br />
32 | ### Actions and remediations
33 |
34 | These are the preventative measures that we have **already taken**:
35 |
36 | - Fixed our misconfigured access policy
37 |
38 | <br />
39 | These are the preventative measures that we will be taking **immediately**:
40 |
41 | - Improving monitoring and alerting
42 |
43 | <br />
44 | ### Conclusion
45 |
46 | We sincerely apologize to everyone affected by this incident, and we appreciate your understanding.
47 |
48 | Please reach out to us at support@midday.ai if you have any questions.
```

apps/website/src/app/updates/posts/invoice-pdf.mdx
```
1 | ---
2 | title: "Generating PDF Invoices: Our Approach"
3 | publishedAt: "2024-10-23"
4 | summary: "Discover how we're implementing PDF invoice generation in Midday, using React-based solutions for customizable, efficient document creation."
5 | image: "/images/update/invoice-pdf/pdf.jpg"
6 | tag: "Updates"
7 | ---
8 | With our upcoming Invoicing feature, we have explored various methods to generate PDF invoices, ranging from running Puppeteer to using a headless browser on Cloudflare, as well as considering paid services and generating PDFs using React.
9 |
10 | <br />
11 | We've noticed that generating PDF invoices is a common challenge in the developer community, so we decided to share our solution with you.
12 | <br />
13 |
14 |
15 | ## Invoice in Midday
16 | ![PDF Invoices](/images/update/invoice-pdf/invoice.jpg)
17 | <br />
18 | We are building a new experience for invoices in Midday. You'll be able to create and send invoices to your customers, as well as generate PDFs for each invoice.
19 |
20 | <br />
21 |
22 | Our interface is highly customizable with a visual editor where you can easily change the layout, add your logo, and tailor the text to your preferences.
23 |
24 | <br />
25 |
26 | We use an editor based on Tiptap to support rich text, with AI-powered grammar checking and text improvement available at the click of a button.
27 |
28 | <br />
29 |
30 | While the editor saves the content using JSON, we also needed to ensure compatibility with our PDF generation process.
31 |
32 | <br/>
33 |
34 | When you send an invoice to a customer, they will receive an email with a unique link to the invoice. Clicking this link will render the invoice on a web page where you and the
35 | customer can communicate in real-time using our chat interface.
36 |
37 | <br />
38 |
39 | You'll also be able to track when the customer has viewed the invoice and if they have any questions about it.
40 |
41 | <br />
42 |
43 | ## PDF Generation
44 | ![PDF Invoices](/images/update/invoice-pdf/pdf-invoice.jpg)
45 | <br />
46 |
47 | There are numerous ways to generate PDFs, and we've explored many different solutions. While we considered paid services, we ultimately decided to prioritize giving you full control over the invoices without relying on external services.
48 |
49 | <br />
50 |
51 | We went with `react-pdf` to generate the PDFs. This is a great library that allows us to generate PDFs using React. We can easily customize the layout and add our own styles to the documents and it feels just like `react-email` concept where we use react to generate our templates.
52 |
53 | <br />
54 |
55 | The invoice is then generated and saved to your [Vault](https://midday.ai/vault), so we can match it to incoming transactions and mark it as paid.
56 |
57 | <br />
58 |
59 | We first create an API endpoint that will generate the PDF and return the PDF as Content Type `application/pdf`.
60 |
61 | ```tsx
62 | import { InvoiceTemplate, renderToStream } from "@midday/invoice";
63 | import { getInvoiceQuery } from "@midday/supabase/queries";
64 | import { createClient } from "@midday/supabase/server";
65 | import type { NextRequest } from "next/server";
66 |
67 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
68 | export const dynamic = "force-dynamic";
69 |
70 | export async function GET(req: NextRequest) {
71 |   const supabase = createClient();
72 |   const requestUrl = new URL(req.url);
73 |   const id = requestUrl.searchParams.get("id");
74 |   const size = requestUrl.searchParams.get("size") as "letter" | "a4";
75 |   const preview = requestUrl.searchParams.get("preview") === "true";
76 |
77 |   if (!id) {
78 |     return new Response("No invoice id provided", { status: 400 });
79 |   }
80 |
81 |   const { data } = await getInvoiceQuery(supabase, id);
82 |
83 |   if (!data) {
84 |     return new Response("Invoice not found", { status: 404 });
85 |   }
86 |
87 |   const stream = await renderToStream(await InvoiceTemplate({ ...data, size }));
88 |
89 |   const blob = await new Response(stream).blob();
90 |
91 |   const headers: Record<string, string> = {
92 |     "Content-Type": "application/pdf",
93 |     "Cache-Control": "no-store, max-age=0",
94 |   };
95 |
96 |   if (!preview) {
97 |     headers["Content-Disposition"] =
98 |       `attachment; filename="${data.invoice_number}.pdf"`;
99 |   }
100 |
101 |   return new Response(blob, { headers });
102 | }
103 | ```
104 |
[TRUNCATED]
```

apps/website/src/app/updates/posts/july-product-updates.mdx
```
1 | ---
2 | title: "July Product Updates"
3 | publishedAt: "2024-08-02"
4 | summary: "In this release, we’re introducing three major updates along with a few helpful additions. You’ll enjoy a much better inbox experience with improved company names, logos, and bulk upload using drag-and-drop. Plus, our Assistant has received several upgrades."
5 | tag: "Updates"
6 | ---
7 |
8 | In this release, we’re introducing three major updates along with a few helpful additions. You’ll enjoy a much better inbox experience with improved company names, logos, and bulk upload using drag-and-drop. Plus, our Assistant has received several upgrades.
9 | <br />
10 |
11 |
12 | ## Inbox
13 | ![Inbox](/images/update/july-product-updates/inbox.png)
14 |
15 | We have rebuilt our Inbox to extract information more reliably and quickly. You can now bulk upload using drag-and-drop, and we will reconcile these with your transactions.
16 |
17 | #### Bulk Uploading (Finally!)
18 | Easily upload multiple files at once with our new drag-and-drop feature.
19 |
20 | #### Improved Accuracy
21 | Experience higher accuracy in identifying names, amounts, and logos.
22 |
23 | <br />
24 | <br />
25 |
26 | ## Assistant
27 | ![Assitant](/images/update/july-product-updates/assistant.png)
28 |
29 | We have updated our assistant to be nearly 30% faster thanks to GPT-4o and several performance improvements in our data layer.
30 |
31 | #### Create Reports
32 | You can now create reports directly from the Assistant.
33 |
34 | #### Documents (Beta)
35 | Upload documents and ask questions around them.
36 |
37 | #### Voice (Alpha)
38 | We are exploring new ways to interact with your Assistant using voice commands.
39 |
40 | <br />
41 | <br />
42 |
43 | ![Engine](/images/update/july-product-updates/engine.png)
44 |
45 | Thanks to our new engine, you can now search for your bank directly. It's much more reliable, and you can view the status of your connection. You can also manually sync your connection in the Settings.
46 |
47 | #### Search for banks
48 | It's now possible to just search for your bank.
49 |
50 | #### Connection status
51 | Sometimes, the connection to your bank may change. We now clearly display this in the Settings and provide instructions on how to resolve it, either through a sync or a reconnection.
52 |
53 | #### Reconnect flow
54 | Especially for banks in the EU, you need to reconnect your bank every 3-6 months. We now send a reminder email and provide an easy flow that takes just 60 seconds to get you back on track.
55 |
56 | <br />
57 | <br />
58 |
59 | ## What's coming next
60 |
61 | #### Time Tracker
62 | Our time tracker will soon includes real-time tracking capabilities, allowing you to monitor productivity and manage your time more effectively.
63 |
64 | #### Invoicing
65 | We have started developing our invoice feature and have created designs based on feedback from many of you to ensure the best possible experience.
66 |
67 | #### Multi-Currency Support
68 | Soon, you will gain a clear picture of your business finances, even if you operate with multiple currencies.
69 |
70 |
71 | <br />
72 |
73 | Give these a try and let us know what you think [get started here](https://app.midday.ai).
```

apps/website/src/app/updates/posts/lognsag.mdx
```
1 | ---
2 | title: "How we take data-driven decisions with LogSnag"
3 | publishedAt: "2024-04-16"
4 | summary: "It's important for every new product to take the right decisions as often you can, and thanks for our public roadmap"
5 | image: "/images/logsnag.png"
6 | tag: "Engineering"
7 | ---
8 |
9 | It's important for every new product to take the right decisions as often you can, and thanks for our public roadmap, votes on feature request and building in public we have a deep connection with our users, but on top of that we also want data to back our decisions.
10 | And thats why we have implemented LogSnag to track a lot of events so we can take data-driven decisions too.
11 |
12 | <br />
13 | There are planty of ways how you can implement analytics, in this blog post we will
14 | share how we solved it in Midday using NextJS and server-actions.
15 |
16 | <br />
17 | Because we have a monorepo we started with creating a new package called `@midday/events`
18 | where we install `@logsnag/next`.
19 |
20 | <br />
21 | The package includes all the events we want to track in Midday for example:
22 |
23 | ```typescript
24 | {
25 |     SignIn: {
26 |         name: "User Signed In",
27 |         icon: "🌝",
28 |         channel: "login",
29 |     },
30 |         SignOut: {
31 |         name: "User Signed Out",
32 |         icon: "🌝",
33 |         channel: "login",
34 |     },
35 | }
36 | ```
37 |
38 | <br />
39 | And based of these realtime events we can make clear graphs like Line Chart, Bar
40 | Chart and Funnel Charts.
41 | <br />
42 |
43 | ![LogSnag - Events](/images/graph.png)
44 |
45 | <br />
46 | ### How we implemented LogSnag
47 |
48 | When you sign in to Midday we first ask you about tracking, we want you to keep your privacy. This is done by showing a `Toast` component with the option to Accept or Decline, we save this decision
49 | in a cookie so we now if we should add a identifier for the events or not.
50 |
51 | <br />
52 | ![LogSnag - Events](/images/signin.png)
53 | <br />
54 |
55 | We run a server action called `tracking-consent-action.ts`:
56 |
57 | ```typescript
58 | "use server";
59 |
60 | import { Cookies } from "@/utils/constants";
61 | import { addYears } from "date-fns";
62 | import { cookies } from "next/headers";
63 | import { action } from "./safe-action";
64 | import { trackingConsentSchema } from "./schema";
65 |
66 | export const trackingConsentAction = action(
67 |   trackingConsentSchema,
68 |   async (value) => {
69 |     cookies().set({
70 |       name: Cookies.TrackingConsent,
71 |       value: value ? "1" : "0",
72 |       expires: addYears(new Date(), 1),
73 |     });
74 |
75 |     return value;
76 |   }
77 | );
78 | ```
79 |
80 | <br />
81 |
82 | We then wrap the `track` method from LogSnag to enable or disabled the `user_id` to the event.
83 |
84 | ```typescript
85 | export const setupLogSnag = async (options?: Props) => {
86 |   const { userId, fullName } = options ?? {};
87 |   const consent = cookies().get(Cookies.TrackingConsent)?.value === "0";
88 |
89 |   const logsnag = new LogSnag({
90 |     token: process.env.LOGSNAG_PRIVATE_TOKEN!,
91 |     project: process.env.NEXT_PUBLIC_LOGSNAG_PROJECT!,
92 |     disableTracking: Boolean(process.env.NEXT_PUBLIC_LOGSNAG_DISABLED!),
93 |   });
94 |
95 |   if (consent && userId && fullName) {
96 |     await logsnag.identify({
97 |       user_id: userId,
98 |       properties: {
99 |         name: fullName,
100 |       },
101 |     });
102 |   }
103 |
104 |   return {
105 |     ...logsnag,
106 |     track: (options: TrackOptions) =>
107 |       logsnag.track({
108 |         ...options,
109 |         user_id: consent ? userId : undefined,
110 |       }),
111 |   };
112 | };
113 | ```
114 |
115 | <br />
116 | We use the `setupLogSnag` function like this:
117 |
118 | ```typescript
119 | export const exportTransactionsAction = action(
120 |   exportTransactionsSchema,
121 |   async (transactionIds) => {
122 |     const user = await getUser();
123 |
124 |     const event = await client.sendEvent({
125 |       name: Events.TRANSACTIONS_EXPORT,
126 |       payload: {
127 |         transactionIds,
128 |         teamId: user.data.team_id,
129 |         locale: user.data.locale,
130 |       },
131 |     });
132 |
133 |     const logsnag = await setupLogSnag({
134 |       userId: user.data.id,
135 |       fullName: user.data.full_name,
136 |     });
137 |
138 |     logsnag.track({
139 |       event: LogEvents.ExportTransactions.name,
140 |       icon: LogEvents.ExportTransactions.icon,
141 |       channel: LogEvents.ExportTransactions.channel,
142 |     });
143 |
[TRUNCATED]
```

apps/website/src/app/updates/posts/midday-resend.mdx
```
1 | ---
2 | title: "Why Midday trusts Resend to send financial notifications"
3 | publishedAt: "2024-03-20"
4 | summary: "From sign up, to implementing the SDK, Resend was different - we were setup in less than an hour"
5 | image: "/images/resend.png"
6 | tag: "Engineering"
7 | ---
8 |
9 | > From sign up, to implementing the SDK, Resend was different - we were setup in less than an hour.
10 |
11 | <br />
12 | Here at Midday, we care deeply about design, and we knew from the beginning that
13 | we wanted branded emails with reusable components.
14 |
15 | <br />
16 | By integrating [react.email](https://react.email/) with [Tailwind CSS](https://react.email/docs/components/tailwind),
17 | we've crafted an optimal user experience. **This combination has been transformative**,
18 | allowing us to enable our local development and online hosting.
19 |
20 | <br />
21 | The transition to Resend was strikingly smooth. I'm used to other services where
22 | you need to request access, quotes, and other information before getting started.
23 | From sign up, to implementing the SDK, Resend was different - **we were setup in
24 | less than an hour.**
25 |
26 | <br />
27 | We use Resend to ensure that our clients receive notifications for new bank transactions,
28 | invitations, and other significant interactions. What truly sets Resend apart for
29 | us are the continuous changes and improvements, like the Batch API, which specifically
30 | helped optimize our invite system.
31 |
32 | <br />
33 |
34 | I didn't think that you could further innovate an email API, but **Resend keeps
35 | shipping features that we did not know we needed.**
36 |
37 | <br />
38 | We haven't had the need to contact Resend for support yet, but the team has supported
39 | us while we shared our journey building emails on X, which truly showed me how **they
40 | differ from other email providers in the best way.**
41 |
42 | <br />
43 | I'm really excited for our launch, along side my co-founder Viktor Hofte.
44 |
45 | <br />
46 | Resend is a **game changer when it comes to developer experience and design.** If
47 | you care deeply about your product you should use Resend.
48 |
49 | <br />
50 | This is a cross post from [Resend](https://resend.com/customers/midday)
```

apps/website/src/app/updates/posts/novu.mdx
```
1 | ---
2 | title: "How we are sending notifications easy with Novu"
3 | publishedAt: "2024-04-29"
4 | summary: "Midday is all about being on top of your business. Stay informed about your business insights, track when you get paid, receive updates on new transactions"
5 | image: "/images/novu.png"
6 | tag: "Engineering"
7 | ---
8 |
9 | Midday is all about being on top of your business. Stay informed about your business insights, track when you get paid, receive updates on new transactions, and access general information how your business actually are doing. And that includes well-timed notifications via emails and push notifications, carefully curated for your convenience.
10 |
11 | <br />
12 | ### The challenge: Implementing a unified infrastructure for notifications
13 |
14 | From the beginning, we knew the importance of a unified approach to managing our notifications. From past experiences of stitching together different solutions to support various notification needs, we were determined to create a system that could seamlessly support web, desktop, and mobile applications. Our goal is to ensure that our notification system can scale alongside our growth.
15 |
16 | <br />
17 | ### The solution: Novu
18 |
19 | While we tried a bunch of different providers we decided to
20 | go with Novu based on our requirements:
21 |
22 | - Support Resend, Expo
23 | - In App notifications
24 | - User Preferences
25 |
26 | <br />
27 | Novu not only ticked every box they also got a huge bonus for being open source and
28 | you get 30K events/month for free.
29 |
30 | <br />
31 | ### Implementation and SDKs
32 |
33 | We started with created our own package `@midday/notifications` where
34 | we installed `@novu/node` dependency, where we register our notification
35 | types for convenience:
36 |
37 | ```typescript
38 | // Our notification templates
39 | export enum Templates {
40 |   Transaction = "transaction",
41 |   Transactions = "transactions",
42 |   Inbox = "inbox",
43 |   Match = "match",
44 | }
45 |
46 | // Our notification types (email|in-app)
47 | export enum Events {
48 |   TransactionNewInApp = "transaction_new_in_app",
49 |   TransactionsNewInApp = "transactions_new_in_app",
50 |   TransactionNewEmail = "transaction_new_email",
51 |   InboxNewInApp = "inbox_new_in_app",
52 |   MatchNewInApp = "match_in_app",
53 | }
54 | ```
55 |
56 | And using our [New Transactions email](https://email.midday.ai/preview/transactions) as an example, which is sent from a background job using Trigger.dev when you have new transactions.
57 |
58 | ```typescript
59 | import { Notifications, Types, Events } from "@midday/notifications";
60 |
61 | // Generate html from react-email
62 | const html = await renderAsync(
63 |   TransactionsEmail({
64 |     fullName: user.full_name,
65 |     transactions,
66 |     locale: user.locale,
67 |   })
68 | );
69 |
70 | await Notifications.trigger({
71 |   name: Events.TransactionNewEmail,
72 |   payload: {
73 |     type: Types.Transaction,
74 |     subject: t("transactions.subject"),
75 |     html,
76 |   },
77 |   user: {
78 |     subscriberId: user.id,
79 |     teamId: team_id,
80 |     email: user.email,
81 |     fullName: user.full_name,
82 |     avatarUrl: user.avatar_url,
83 |   },
84 | });
85 | ```
86 |
87 | Because we are sending the email with the variables `subject` and `html` with the generated content we are just adding those to Novu and then we're done.
88 |
89 | <br />
90 | ![Novu - Variables](/images/variables.png)
91 |
92 | <br />
93 | And to send In App Notifications it's just a matter of changing the `Events` and
94 | `Types`.
95 |
96 | ```typescript
97 | import { Notifications, Types, Events } from "@midday/notifications";
98 |
99 | await Notifications.trigger({
100 |   name: Events.TransactionNewInApp,
101 |   payload: {
102 |     recordId: transaction.id,
103 |     type: Types.Transaction,
104 |     description: t("notifications.transaction", {
105 |       from: transaction.name,
106 |     }),
107 |   },
108 |   user: {
109 |     subscriberId: user.id,
110 |     teamId: team_id,
111 |     email: user.email,
112 |     fullName: user.full_name,
113 |     avatarUrl: user.avatar_url,
114 |   },
115 | });
116 | ```
117 |
118 | <br />
119 | ### The results: Beautiful In App Notificaitons and Emails
120 | <br />
121 | ![Midday - In App Notifications](/images/notification-center.gif)
122 | <br />
123 | Thanks to the SDK `@novu/headless` we implemented the notification center for Midday
124 | in a matter of hours to match our branding exacly like we wanted while Novu delivers
125 | the notifications in realtime.
126 |
127 | <br />
128 |
[TRUNCATED]
```

apps/website/src/app/updates/posts/october-product-updates.mdx
```
1 | ---
2 | title: "October Product Updates"
3 | publishedAt: "2024-10-31"
4 | summary: "I’m incredibly excited to announce that our most requested feature is finally here—Invoicing!  Let’s dive into how it works and what we’re focusing on for the next month."
5 | tag: "Updates"
6 | ---
7 |
8 | I’m incredibly excited to announce that our most requested feature is finally here—Invoicing!  Let’s dive into how it works and what we’re focusing on for the next month.
9 | <br />
10 |
11 |
12 | ## Invoicing
13 | ![Invoicing](/images/update/october-product-updates/invoicing.jpg)
14 | <br />
15 | We have designed and developed a new visual editor from the ground up, based on extensive research and feedback from early users. While it may look simple, it’s incredibly powerful for all your needs.
16 | <br />
17 | Here are some features we support from the start:
18 |
19 | - Edit and change labels and names
20 | - Rich text editor for content, including links, bold, italic, and more
21 | - AI-enhanced editor with grammar assistance
22 | - Date formats, currencies, VAT, sales tax, discounts, QR codes
23 |
24 | <br />
25 | And much more!
26 |
27 | <br />
28 | ## Web invoice
29 | ![Web invoice](/images/update/october-product-updates/web-invoice.jpg)
30 | <br />
31 | You can choose to send an email to your customers with the newly created invoice. This will open a web-based invoice where they can communicate in real-time instead of exchanging emails back and forth.
32 | <br />
33 | They can also download a PDF, and as the owner, you can see the last view date.
34 |
35 | <br />
36 | <br />
37 |
38 | ## Invoice status
39 | ![Invoice status](/images/update/october-product-updates/invoice-status.png)
40 | <br />
41 | If you have a bank account connected to Midday, we will automatically mark an invoice as paid when we find a match. You’ll be notified, and the generated PDF will be attached to your transaction for bookkeeping.<br />
42 |
43 | <br />
44 | You’ll also be notified when invoices become overdue, allowing you to send a reminder email with the press of a button.
45 | <br />
46 |
47 |
48 |
49 | ## What's coming next
50 |
51 | #### Stability and improvements
52 | Our main focus right now is to prepare Midday for our v1 release in Q1 next year. We’re working on our banking integrations to handle various edge cases more effectively, ironing out all the small bugs, and improving the overall experience with Midday.
53 |
54 | If you find any bugs or have any feedback, just let us know!
55 |
56 | <br />
57 |
58 | Create your first invoice and let us know what you think [get started here](https://app.midday.ai).
```

apps/website/src/app/updates/posts/public-beta.mdx
```
1 | ---
2 | title: "Announcing Public Beta"
3 | publishedAt: "2024-06-24"
4 | summary: "For the past three months, we have been working hard in private beta with our customers. Today, we are excited to announce our public beta."
5 | image: "/images/public-beta.jpg"
6 | tag: "Updates"
7 | ---
8 |
9 | For the past three months, we have been working hard in private beta with our customers. Today, we are excited to announce our public beta.
10 |
11 | <br />
12 |
13 | Both Viktor and I want to personally thank all of you who have given us feedback, attended meetings, and supported us during this time. We are super excited to continue our journey together to make Midday the best all-in-one tool for running our business smarter.
14 |
15 | <br />
16 |
17 | As we enter our public beta, new customers will have access to a special deal of $49/month, but it will be free during the beta period.
18 |
19 | <br />
20 | ### What's next
21 |
22 | We aim to have Midday `v1` ready in October, which is also when we will start charging for the service.
23 |
24 | <br />
25 | Until then, here are our focus areas:
26 |
27 | - **Invoicing** - Deliver the first version of our invoicing service
28 | - **Budget** - Add support for budgeting
29 | - **Apps & Integrations** - Integrate with Xero, Fortnox, and QuickBooks
30 | - **Bug Fixes & Improvements** - General improvements to the platform
31 |
32 | <br />
33 | ### ProductHunt
34 |
35 | Along with this milestone, we are launching on Product Hunt on Wednesday, June 26 (12:00 am PST). We would love to have your support by voting for us. [You can subscribe for a notification here](https://go.midday.ai/ph).
36 |
37 | <br />
38 | ### Get started
39 |
40 | Now that Middays is in public beta, feel free to try us out by [signing in here](https://app.midday.ai).
```

apps/website/src/app/updates/posts/slack-assistant.mdx
```
1 | ---
2 | title: "Building the Midday Slack Assistant"
3 | publishedAt: "2024-09-29"
4 | summary: "This is a technical deep dive into how we built the Midday Slack Assistant using Vercel AI SDK, Trigger.dev and Supabase."
5 | image: "/images/update/apps/slack.png"
6 | tag: "Updates"
7 | ---
8 |
9 | In this technical deep dive, we’ll explore how we built the Midday Slack Assistant by leveraging the Vercel AI SDK, Trigger.dev, and Supabase. Our goal was to create an AI-powered assistant that helps users gain financial insights, upload receipts, and manage invoices—all seamlessly from within their Slack workspace.
10 |
11 | ## Background
12 | Midday already has an assistant available on both web and desktop via Electron, but we haven’t yet built a dedicated mobile app. As we continue iterating on our web app, we plan to eventually create a mobile version using Expo. In the meantime, we wanted to give our users a way to interact with Midday on the go. With that in mind, we turned to Slack, where users can quickly upload receipts and invoices without leaving the app they’re already using for work.
13 |
14 | <br />
15 | ## Goals
16 | We aimed to enable our users to:
17 |
18 | - Upload receipts and invoices, and match them to transactions.
19 | - Query their financial status (e.g., burn rate, cash flow).
20 | - Receive notifications about transactions.
21 |
22 | <br />
23 | ## Slack Assistant
24 | Slack recently introduced a new messaging experience for app agents and assistants, making them more discoverable and accessible in user workflows. This update allows developers to build AI assistants based on their own APIs, seamlessly integrated into the Slack interface.
25 | <br />
26 |
27 | When users install our Slack app from the <a href="https://midday.ai/updates/apps">Apps section within Midday</a>, we obtain the necessary permissions to interact with the Slack API, send messages, and listen to events.
28 | <br />
29 |
30 |
31 | ## Authentication
32 | To connect the Slack app to a user’s workspace, we utilize Slack’s OAuth flow to retrieve an access token with the required scopes. These scopes include:
33 |
34 | - `assistant_thread_context_changed`: Detects changes in the assistant thread context.
35 | - `assistant_thread_started`: Tracks when an assistant thread starts.
36 | - `file_created`: Monitors file uploads.
37 | - `message.channel`: Captures messages posted in public channels.
38 | - `message.im`: Captures direct messages.
39 | <br />
40 |
41 | Once authenticated, we store this data in our `apps` table along with the team ID and access token, structured as a JSONB column for flexibility.
42 |
43 | <br />
44 |
45 | ## Event Subscriptions
46 |
47 | Here’s where the magic happens: We use a Next.js route to handle incoming Slack events and route them to our internal handler. This handler checks the event payload to determine the appropriate action. If it detects a file upload, it triggers a background job via Trigger.dev. If it’s a message, we forward it to our Assistant logic.
48 |
49 | <br />
50 |
51 | ## File Upload Handling
52 |
53 | When a file upload event occurs, we send the file to a background job and save it in our Supabase database. Using OCR, we extract key details such as `amount`, `currency`, `date`, and `merchant` from the receipt. Then, we attempt to match the data with existing transactions in our system using Azure Document Intelligence Models.
54 | <br />
55 |
56 | Here’s a quick demo of how the file upload works in Slack:
57 | <br />
58 | <div className="relative" style={{ paddingTop: '71.05263157894737%' }}>
59 |   <iframe
60 |     src="https://customer-oh6t55xltlgrfayh.cloudflarestream.com/7ac615c3849c444f56c555f7b1ff3e31/iframe?poster=https%3A%2F%2Fcustomer-oh6t55xltlgrfayh.cloudflarestream.com%2F7ac615c3849c444f56c555f7b1ff3e31%2Fthumbnails%2Fthumbnail.jpg%3Ftime%3D%26height%3D600"
61 |     loading="lazy"
62 |     className="border-none absolute inset-0 h-full w-full"
63 |     allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
64 |     allowFullScreen
65 |   />
66 | </div>
67 |
68 | <br />
69 | ## Slack Assistant Features
70 |
71 | When you open the Slack Assistant, you’re greeted with a welcome message and a set of suggested actions. This welcome message is triggered by the `assistant_thread_started` event and looks like this:
72 |
73 | ```
74 | import type { AssistantThreadStartedEvent, WebClient } from "@slack/web-api";
75 |
76 | export async function assistantThreadStarted(
77 |   event: AssistantThreadStartedEvent,
78 |   client: WebClient,
79 | ) {
80 |   const prompts = [
81 |     { title: "What’s my runway?", message: "What's my runway?" },
[TRUNCATED]
```

apps/website/src/app/updates/posts/trigger-dev.mdx
```
1 | ---
2 | title: "How we are using Trigger.dev for our background jobs"
3 | publishedAt: "2024-03-19"
4 | summary: "At Midday, we use background jobs extensively. Here's an in-depth exploration of our approach."
5 | image: "/images/trigger.png"
6 | tag: "Engineering"
7 | ---
8 |
9 | At Midday, we use background jobs extensively. Here's an in-depth exploration of our approach.
10 |
11 | <br />
12 | ### Transactions Setup
13 |
14 | Upon successful user authentication of their bank, we initiate the creation of a **`bank_connection`** containing essential data and provider information (Plaid, GoCardLess, Teller). This facilitates subsequent retrieval of transactions on their behalf. Additionally, we store bank connection accounts in **`bank_accounts`**, along with an enable/disable flag, enabling us to determine which accounts to fetch transactions from.
15 |
16 | Once **`bank_connection`** and **`bank_accounts`** are securely stored in the database, we trigger the **`transactions-setup`** job. This job orchestrates the initial synchronization from the providers through batch requests, ensuring resilience against extensive transaction loads. Moreover, it dynamically schedules intervals for running **`transactions-sync`** every hour for each team. Clients subscribe to the **`eventId`** to track the completion of the initial sync process.
17 |
18 | <br />
19 | ### Transactions Sync
20 |
21 | The **`transactions-sync`** task fetches transactions for each team hourly. A team may have multiple connected bank accounts, requiring one request per account. We aim to consolidate new transactions into a single collection for notification purposes. Transactions are limited to the last 30 days, streamlining data retrieval.
22 |
23 | This approach offers a 30-day window for rectifying any potential errors and acquiring new transactions. Moreover, teams can seamlessly enable/disable accounts between sync runs, as transactions are fetched exclusively for enabled accounts. If a **`team_id`** is not found, indicating deletion, the scheduler is promptly removed.
24 |
25 | <br />
26 | ### Process Document
27 |
28 | Upon receipt of a new inbound email from Postmarks, we upload the attachments (invoices) to Supabase and create an **`inbox`** record. Subsequently, we trigger the **`process-document`** job, responsible for parsing the invoice using Google Document AI to extract vital information such as **`due_date`**, **`amount`**, and currency. Successful extraction triggers the **`match-inbox`** event.
29 |
30 | <br />
31 | ### **Match Inbox**
32 |
33 | The **`match-inbox`** process utilizes the **`inboxId`**, **`teamId`**, and **`amount`** to verify transactions matching the invoice amount, accounting for sign differences (transactions are always signed, whereas invoices are not). This verification extends back 45 days, considering cases where no attachments are available yet. Currently, encountering multiple matches necessitates further validation, a feature we plan to address in future UI enhancements.
34 |
35 | <br />
36 | ### Export Transactions
37 |
38 | The **`export-transactions`** task retrieves selected **`transactionIds`**, gathers their attachments, compiles a CSV file, and uploads it to our Vault. Clients subscribe to monitor the progress status of this operation.
39 |
40 | <br />
41 | ### GitHub
42 |
43 | You can find all of our jobs in our [GitHub repository](https://github.com/midday-ai/midday/tree/main/packages/jobs/src).
```

packages/app-store/src/slack/lib/events/index.ts
```
1 | import { createSlackWebClient } from "@midday/app-store/slack";
2 | import type { SlackEvent } from "@slack/bolt";
3 | import { waitUntil } from "@vercel/functions";
4 | import { fileShare } from "./file";
5 | import { assistantThreadMessage, assistantThreadStarted } from "./thread";
6 |
7 | export async function handleSlackEvent(
8 |   event: SlackEvent,
9 |   options: { token: string; teamId: string },
10 | ) {
11 |   const client = createSlackWebClient({
12 |     token: options.token,
13 |   });
14 |
15 |   if (event.type === "assistant_thread_started") {
16 |     waitUntil(assistantThreadStarted(event, client));
17 |     return;
18 |   }
19 |
20 |   // In Assisant Threads
21 |   if (event.subtype === "file_share") {
22 |     waitUntil(fileShare(event, options));
23 |     return;
24 |   }
25 |
26 |   if (
27 |     event.text &&
28 |     event.type === "message" &&
29 |     event.channel_type === "im" &&
30 |     !event.bot_id && // Ignore bot messages
31 |     event.subtype !== "assistant_app_thread"
32 |   ) {
33 |     waitUntil(assistantThreadMessage(event, client, options));
34 |     return;
35 |   }
36 | }
```

packages/app-store/src/slack/lib/notifications/index.ts
```
1 | export * from "./transactions";
```

packages/app-store/src/slack/lib/notifications/transactions.ts
```
1 | import type { SupabaseClient } from "@supabase/supabase-js";
2 | import { z } from "zod";
3 | import { createSlackWebClient } from "../client";
4 |
5 | const transactionSchema = z.object({
6 |   amount: z.string(),
7 |   name: z.string(),
8 | });
9 |
10 | export async function sendSlackTransactionNotifications({
11 |   teamId,
12 |   transactions,
13 |   supabase,
14 | }: {
15 |   teamId: string;
16 |   transactions: z.infer<typeof transactionSchema>[];
17 |   supabase: SupabaseClient;
18 | }) {
19 |   const { data } = await supabase
20 |     .from("apps")
21 |     .select("settings, config")
22 |     .eq("team_id", teamId)
23 |     .eq("app_id", "slack")
24 |     .single();
25 |
26 |   const enabled = data?.settings?.find(
27 |     (setting: { id: string; value: boolean }) => setting.id === "transactions",
28 |   )?.value;
29 |
30 |   if (!enabled || !data?.config?.access_token) {
31 |     return;
32 |   }
33 |
34 |   const client = createSlackWebClient({
35 |     token: data.config.access_token,
36 |   });
37 |
38 |   try {
39 |     await client.chat.postMessage({
40 |       channel: data.config.channel_id,
41 |
42 |       blocks: [
43 |         {
44 |           type: "section",
45 |           text: {
46 |             type: "mrkdwn",
47 |             text: "You got some new transactions! We'll do our best to match these with receipts in your Inbox or you can simply upload them in your <slack://app?id=A07PN48FW3A|Midday Assistant>.",
48 |           },
49 |         },
50 |         {
51 |           type: "divider",
52 |         },
53 |         ...transactions.map((transaction) => ({
54 |           type: "section",
55 |           fields: [
56 |             {
57 |               type: "mrkdwn",
58 |               text: transaction.name,
59 |             },
60 |             {
61 |               type: "mrkdwn",
62 |               text: transaction.amount,
63 |             },
64 |           ],
65 |         })),
66 |         {
67 |           type: "divider",
68 |         },
69 |         {
70 |           type: "actions",
71 |           elements: [
72 |             {
73 |               type: "button",
74 |               text: {
75 |                 type: "plain_text",
76 |                 text: "View transactions",
77 |               },
78 |               url: "https://app.midday.ai/transactions",
79 |               action_id: "button_click",
80 |             },
81 |           ],
82 |         },
83 |       ],
84 |     });
85 |   } catch (error) {
86 |     console.error(error);
87 |   }
88 | }
```

packages/app-store/src/slack/lib/tools/get-burn-rate.ts
```
1 | import { getBurnRateQuery } from "@midday/supabase/queries";
2 | import type { Client } from "@midday/supabase/types";
3 | import { startOfMonth } from "date-fns";
4 | import { z } from "zod";
5 |
6 | export function getBurnRateTool({
7 |   defaultValues,
8 |   supabase,
9 |   teamId,
10 | }: {
11 |   defaultValues: {
12 |     from: string;
13 |     to: string;
14 |   };
15 |   supabase: Client;
16 |   teamId: string;
17 | }) {
18 |   return {
19 |     description: "Get burn rate",
20 |     parameters: z.object({
21 |       startDate: z.coerce
22 |         .date()
23 |         .describe("The start date of the burn rate, in ISO-8601 format")
24 |         .default(new Date(defaultValues.from)),
25 |       endDate: z.coerce
26 |         .date()
27 |         .describe("The end date of the burn rate, in ISO-8601 format")
28 |         .default(new Date(defaultValues.to)),
29 |       currency: z
30 |         .string()
31 |         .describe("The currency for the burn rate")
32 |         .optional(),
33 |     }),
34 |     execute: async ({
35 |       currency,
36 |       startDate,
37 |       endDate,
38 |     }: { currency?: string; startDate: Date; endDate: Date }) => {
39 |       const { data } = await getBurnRateQuery(supabase, {
40 |         currency,
41 |         from: startOfMonth(startDate).toISOString(),
42 |         to: endDate.toISOString(),
43 |         teamId,
44 |       });
45 |
46 |       if (!data) {
47 |         return "No burn rate found";
48 |       }
49 |
50 |       const averageBurnRate =
51 |         data?.reduce((acc, curr) => acc + curr.value, 0) / data?.length;
52 |
53 |       return `Based on your historical data, your average burn rate is ${Intl.NumberFormat(
54 |         "en-US",
55 |         {
56 |           style: "currency",
57 |           currency: data.at(0)?.currency,
58 |         },
59 |       ).format(averageBurnRate)} per month.`;
60 |     },
61 |   };
62 | }
```

packages/app-store/src/slack/lib/tools/get-profit.ts
```
1 | import { getMetricsQuery } from "@midday/supabase/queries";
2 | import type { Client } from "@midday/supabase/types";
3 | import { startOfMonth } from "date-fns";
4 | import { z } from "zod";
5 |
6 | export function getProfitTool({
7 |   defaultValues,
8 |   supabase,
9 |   teamId,
10 | }: {
11 |   defaultValues: {
12 |     from: string;
13 |     to: string;
14 |   };
15 |   supabase: Client;
16 |   teamId: string;
17 | }) {
18 |   return {
19 |     description: "Get profit",
20 |     parameters: z.object({
21 |       startDate: z.coerce
22 |         .date()
23 |         .describe("The start date of the profit, in ISO-8601 format")
24 |         .default(new Date(defaultValues.from)),
25 |       endDate: z.coerce
26 |         .date()
27 |         .describe("The end date of the profit, in ISO-8601 format")
28 |         .default(new Date(defaultValues.to)),
29 |       currency: z.string().describe("The currency for profit").optional(),
30 |     }),
31 |     execute: async ({
32 |       currency,
33 |       startDate,
34 |       endDate,
35 |     }: { currency?: string; startDate: Date; endDate: Date }) => {
36 |       const data = await getMetricsQuery(supabase, {
37 |         teamId,
38 |         from: startOfMonth(new Date(startDate)).toISOString(),
39 |         to: new Date(endDate).toISOString(),
40 |         type: "profit",
41 |         currency,
42 |       });
43 |
44 |       if (!data) {
45 |         return "No profit data found";
46 |       }
47 |
48 |       return `Based on the period from ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}, the current profit is ${Intl.NumberFormat(
49 |         "en-US",
50 |         {
51 |           style: "currency",
52 |           currency: data.summary.currency,
53 |         },
54 |       ).format(data.summary.currentTotal)}`;
55 |     },
56 |   };
57 | }
```

packages/app-store/src/slack/lib/tools/get-revenue.ts
```
1 | import { getMetricsQuery } from "@midday/supabase/queries";
2 | import type { Client } from "@midday/supabase/types";
3 | import { startOfMonth } from "date-fns";
4 | import { z } from "zod";
5 |
6 | export function getRevenueTool({
7 |   defaultValues,
8 |   supabase,
9 |   teamId,
10 | }: {
11 |   defaultValues: {
12 |     from: string;
13 |     to: string;
14 |   };
15 |   supabase: Client;
16 |   teamId: string;
17 | }) {
18 |   return {
19 |     description: "Get revenue",
20 |     parameters: z.object({
21 |       startDate: z.coerce
22 |         .date()
23 |         .describe("The start date of the revenue, in ISO-8601 format")
24 |         .default(new Date(defaultValues.from)),
25 |       endDate: z.coerce
26 |         .date()
27 |         .describe("The end date of the revenue, in ISO-8601 format")
28 |         .default(new Date(defaultValues.to)),
29 |       currency: z.string().describe("The currency for revenue").optional(),
30 |     }),
31 |     execute: async ({
32 |       currency,
33 |       startDate,
34 |       endDate,
35 |     }: { currency?: string; startDate: Date; endDate: Date }) => {
36 |       const data = await getMetricsQuery(supabase, {
37 |         teamId,
38 |         from: startOfMonth(new Date(startDate)).toISOString(),
39 |         to: new Date(endDate).toISOString(),
40 |         type: "revenue",
41 |         currency,
42 |       });
43 |
44 |       if (!data) {
45 |         return "No revenue data found";
46 |       }
47 |
48 |       return `Based on the period from ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}, the current revenue is ${Intl.NumberFormat(
49 |         "en-US",
50 |         {
51 |           style: "currency",
52 |           currency: data.summary.currency,
53 |         },
54 |       ).format(data.summary.currentTotal)}`;
55 |     },
56 |   };
57 | }
```

packages/app-store/src/slack/lib/tools/get-runway.ts
```
1 | import { getRunwayQuery } from "@midday/supabase/queries";
2 | import type { Client } from "@midday/supabase/types";
3 | import { startOfMonth } from "date-fns";
4 | import { z } from "zod";
5 |
6 | export function getRunwayTool({
7 |   defaultValues,
8 |   supabase,
9 |   teamId,
10 | }: {
11 |   defaultValues: {
12 |     from: string;
13 |     to: string;
14 |   };
15 |   supabase: Client;
16 |   teamId: string;
17 | }) {
18 |   return {
19 |     description: "Get the runway",
20 |     parameters: z.object({
21 |       currency: z.string().describe("The currency for the runway").optional(),
22 |       startDate: z.coerce
23 |         .date()
24 |         .describe("The start date of the runway, in ISO-8601 format")
25 |         .default(new Date(defaultValues.from)),
26 |       endDate: z.coerce
27 |         .date()
28 |         .describe("The end date of the runway, in ISO-8601 format")
29 |         .default(new Date(defaultValues.to)),
30 |     }),
31 |     execute: async ({
32 |       currency,
33 |       startDate,
34 |       endDate,
35 |     }: { currency?: string; startDate: Date; endDate: Date }) => {
36 |       const { data } = await getRunwayQuery(supabase, {
37 |         currency,
38 |         from: startOfMonth(startDate).toISOString(),
39 |         to: endDate.toISOString(),
40 |         teamId,
41 |       });
42 |
43 |       if (!data) {
44 |         return "No runway found";
45 |       }
46 |
47 |       return `Runway with currency ${currency} is ${data} months. Based on the data from ${startDate.toISOString()} to ${endDate.toISOString()}.`;
48 |     },
49 |   };
50 | }
```

packages/app-store/src/slack/lib/tools/get-spending.ts
```
1 | import { getSpendingQuery } from "@midday/supabase/queries";
2 | import type { Client } from "@midday/supabase/types";
3 | import { startOfMonth } from "date-fns";
4 | import { z } from "zod";
5 |
6 | export function getSpendingTool({
7 |   defaultValues,
8 |   supabase,
9 |   teamId,
10 | }: {
11 |   defaultValues: {
12 |     from: string;
13 |     to: string;
14 |   };
15 |   supabase: Client;
16 |   teamId: string;
17 | }) {
18 |   return {
19 |     description: "Get spending from category",
20 |     parameters: z.object({
21 |       currency: z.string().describe("The currency for spending").optional(),
22 |       category: z.string().describe("The category for spending"),
23 |       startDate: z.coerce
24 |         .date()
25 |         .describe("The start date of the spending, in ISO-8601 format")
26 |         .default(new Date(defaultValues.from)),
27 |       endDate: z.coerce
28 |         .date()
29 |         .describe("The end date of the spending, in ISO-8601 format")
30 |         .default(new Date(defaultValues.to)),
31 |     }),
32 |     execute: async ({
33 |       category,
34 |       currency,
35 |       startDate,
36 |       endDate,
37 |     }: {
38 |       currency?: string;
39 |       startDate: Date;
40 |       endDate: Date;
41 |       category: string;
42 |     }) => {
43 |       const { data } = await getSpendingQuery(supabase, {
44 |         currency,
45 |         from: startOfMonth(startDate).toISOString(),
46 |         to: endDate.toISOString(),
47 |         teamId,
48 |       });
49 |
50 |       const found = data?.find(
51 |         (c) => category?.toLowerCase() === c?.name?.toLowerCase(),
52 |       );
53 |
54 |       if (!found) {
55 |         return "No spending on this category found";
56 |       }
57 |
58 |       return `You have spent ${Intl.NumberFormat("en-US", {
59 |         style: "currency",
60 |         currency: found.currency,
61 |       }).format(
62 |         Math.abs(found.amount),
63 |       )} on ${found.name} from ${startDate.toISOString()} to ${endDate.toISOString()}.`;
64 |     },
65 |   };
66 | }
```

packages/app-store/src/slack/lib/tools/index.ts
```
1 | export * from "./get-burn-rate";
2 | export * from "./get-runway";
3 | export * from "./get-spending";
4 | export * from "./system-prompt";
```

packages/app-store/src/slack/lib/tools/system-prompt.ts
```
1 | export const systemPrompt = `\
2 |     You are a helpful assistant in Midday who can help users ask questions about their transactions, revenue, spending find invoices and more.
3 |     If the user wants the runway, call \`getRunway\` function.
4 |     If the user wants the burn rate, call \`getBurnRate\` function.
5 |     If the user wants the profit, call \`getProfit\` function.
6 |     If the user wants to see spending based on a category, call \`getSpending\` function.
7 |     If the user wants to see revenue, call \`getRevenue\` function.
8 |     Always try to call the functions with default values, otherwise ask the user to respond with parameters.
9 |     Don't ever return markdown, just plain text.
10 |     Current date is: ${new Date().toISOString().split("T")[0]} \n
11 |     `;
```

packages/invoice/src/templates/html/components/description.tsx
```
1 | import { isValidJSON } from "../../../utils/content";
2 | import { EditorContent } from "./editor-content";
3 |
4 | export function Description({ content }: { content: string }) {
5 |   const value = isValidJSON(content) ? JSON.parse(content) : null;
6 |
7 |   // If the content is not valid JSON, return the content as a string
8 |   if (!value) {
9 |     return <div className="font-mono leading-4 text-[11px]">{content}</div>;
10 |   }
11 |
12 |   return <EditorContent content={value} />;
13 | }
```

packages/invoice/src/templates/html/components/editor-content.tsx
```
1 | import { formatEditorContent } from "../format";
2 |
3 | export function EditorContent({ content }: { content?: JSON }) {
4 |   if (!content) {
5 |     return null;
6 |   }
7 |
8 |   return (
9 |     <div className="font-mono leading-4">{formatEditorContent(content)}</div>
10 |   );
11 | }
```

packages/invoice/src/templates/html/components/line-items.tsx
```
1 | import { formatAmount } from "@midday/utils/format";
2 | import { calculateLineItemTotal } from "../../../utils/calculate";
3 | import type { LineItem } from "../../types";
4 | import { Description } from "./description";
5 |
6 | type Props = {
7 |   lineItems: LineItem[];
8 |   currency: string;
9 |   descriptionLabel: string;
10 |   quantityLabel: string;
11 |   priceLabel: string;
12 |   totalLabel: string;
13 |   includeDecimals?: boolean;
14 |   locale: string;
15 |   includeUnits?: boolean;
16 | };
17 |
18 | export function LineItems({
19 |   lineItems,
20 |   currency,
21 |   descriptionLabel,
22 |   quantityLabel,
23 |   priceLabel,
24 |   totalLabel,
25 |   includeDecimals = false,
26 |   includeUnits = false,
27 |   locale,
28 | }: Props) {
29 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
30 |
31 |   return (
32 |     <div className="mt-5 font-mono">
33 |       <div className="grid grid-cols-[1.5fr_15%_15%_15%] gap-4 items-end relative group mb-2 w-full pb-1 border-b border-border">
34 |         <div className="text-[11px] text-[#878787]">{descriptionLabel}</div>
35 |         <div className="text-[11px] text-[#878787]">{quantityLabel}</div>
36 |         <div className="text-[11px] text-[#878787]">{priceLabel}</div>
37 |         <div className="text-[11px] text-[#878787] text-right">
38 |           {totalLabel}
39 |         </div>
40 |       </div>
41 |
42 |       {lineItems.map((item, index) => (
43 |         <div
44 |           key={`line-item-${index.toString()}`}
45 |           className="grid grid-cols-[1.5fr_15%_15%_15%] gap-4 items-start relative group mb-1 w-full py-1"
46 |         >
47 |           <div className="self-start">
48 |             <Description content={item.name} />
49 |           </div>
50 |           <div className="text-[11px] self-start">{item.quantity}</div>
51 |           <div className="text-[11px] self-start">
52 |             {includeUnits && item.unit
53 |               ? `${formatAmount({
54 |                   currency,
55 |                   amount: item.price,
56 |                   maximumFractionDigits,
57 |                   locale,
58 |                 })}/${item.unit}`
59 |               : formatAmount({
60 |                   currency,
61 |                   amount: item.price,
62 |                   maximumFractionDigits,
63 |                   locale,
64 |                 })}
65 |           </div>
66 |           <div className="text-[11px] text-right self-start">
67 |             {formatAmount({
68 |               maximumFractionDigits,
69 |               currency,
70 |               amount: calculateLineItemTotal({
71 |                 price: item.price,
72 |                 quantity: item.quantity,
73 |               }),
74 |               locale,
75 |             })}
76 |           </div>
77 |         </div>
78 |       ))}
79 |     </div>
80 |   );
81 | }
```

packages/invoice/src/templates/html/components/logo.tsx
```
1 | type Props = {
2 |   logo: string;
3 |   customerName: string;
4 | };
5 |
6 | export function Logo({ logo, customerName }: Props) {
7 |   return (
8 |     <img
9 |       src={logo}
10 |       alt={customerName}
11 |       style={{
12 |         height: 80,
13 |         objectFit: "contain",
14 |       }}
15 |     />
16 |   );
17 | }
```

packages/invoice/src/templates/html/components/meta.tsx
```
1 | import { TZDate } from "@date-fns/tz";
2 | import { format } from "date-fns";
3 | import type { Template } from "../../types";
4 |
5 | type Props = {
6 |   template: Template;
7 |   invoiceNumber: string;
8 |   issueDate: string;
9 |   dueDate: string;
10 |   timezone: string;
11 | };
12 |
13 | export function Meta({
14 |   template,
15 |   invoiceNumber,
16 |   issueDate,
17 |   dueDate,
18 |   timezone,
19 | }: Props) {
20 |   return (
21 |     <div className="mb-2">
22 |       <h2 className="text-[21px] font-medium font-mono mb-1 w-fit min-w-[100px]">
23 |         {template.title}
24 |       </h2>
25 |       <div className="flex flex-col gap-0.5">
26 |         <div className="flex space-x-1 items-center">
27 |           <div className="flex items-center flex-shrink-0 space-x-1">
28 |             <span className="truncate font-mono text-[11px] text-[#878787]">
29 |               {template.invoice_no_label}:
30 |             </span>
31 |             <span className="text-[11px] font-mono flex-shrink-0">
32 |               {invoiceNumber}
33 |             </span>
34 |           </div>
35 |         </div>
36 |
37 |         <div>
38 |           <div>
39 |             <div className="flex space-x-1 items-center">
40 |               <div className="flex items-center flex-shrink-0 space-x-1">
41 |                 <span className="truncate font-mono text-[11px] text-[#878787]">
42 |                   {template.issue_date_label}:
43 |                 </span>
44 |                 <span className="text-[11px] font-mono flex-shrink-0">
45 |                   {format(
46 |                     new TZDate(issueDate, timezone),
47 |                     template.date_format,
48 |                   )}
49 |                 </span>
50 |               </div>
51 |             </div>
52 |           </div>
53 |         </div>
54 |         <div>
55 |           <div>
56 |             <div className="flex space-x-1 items-center">
57 |               <div className="flex items-center flex-shrink-0 space-x-1">
58 |                 <span className="truncate font-mono text-[11px] text-[#878787]">
59 |                   {template.due_date_label}:
60 |                 </span>
61 |                 <span className="text-[11px] font-mono flex-shrink-0">
62 |                   {format(new TZDate(dueDate, timezone), template.date_format)}
63 |                 </span>
64 |               </div>
65 |             </div>
66 |           </div>
67 |         </div>
68 |       </div>
69 |     </div>
70 |   );
71 | }
```

packages/invoice/src/templates/html/components/summary.tsx
```
1 | import { calculateTotal } from "../../../utils/calculate";
2 | import type { LineItem } from "../../types";
3 |
4 | type Props = {
5 |   includeVAT: boolean;
6 |   includeTax: boolean;
7 |   includeDiscount: boolean;
8 |   discount?: number;
9 |   discountLabel: string;
10 |   taxRate: number;
11 |   vatRate: number;
12 |   locale: string;
13 |   currency: string;
14 |   vatLabel: string;
15 |   taxLabel: string;
16 |   totalLabel: string;
17 |   lineItems: LineItem[];
18 |   includeDecimals?: boolean;
19 |   subtotalLabel: string;
20 | };
21 |
22 | export function Summary({
23 |   includeVAT,
24 |   includeTax,
25 |   includeDiscount,
26 |   discountLabel,
27 |   locale,
28 |   discount,
29 |   taxRate,
30 |   vatRate,
31 |   currency,
32 |   vatLabel,
33 |   taxLabel,
34 |   totalLabel,
35 |   lineItems,
36 |   includeDecimals,
37 |   subtotalLabel,
38 | }: Props) {
39 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
40 |
41 |   const {
42 |     subTotal,
43 |     total,
44 |     vat: totalVAT,
45 |     tax: totalTax,
46 |   } = calculateTotal({
47 |     lineItems,
48 |     taxRate,
49 |     vatRate,
50 |     discount: discount ?? 0,
51 |     includeVAT,
52 |     includeTax,
53 |   });
54 |
55 |   return (
56 |     <div className="w-[320px] flex flex-col">
57 |       <div className="flex justify-between items-center py-1">
58 |         <span className="text-[11px] text-[#878787] font-mono">
59 |           {subtotalLabel}
60 |         </span>
61 |         <span className="text-right font-mono text-[11px] text-[#878787]">
62 |           {new Intl.NumberFormat(locale, {
63 |             style: "currency",
64 |             currency: currency,
65 |             maximumFractionDigits,
66 |           }).format(subTotal)}
67 |         </span>
68 |       </div>
69 |
70 |       {includeDiscount && (
71 |         <div className="flex justify-between items-center py-1">
72 |           <span className="text-[11px] text-[#878787] font-mono">
73 |             {discountLabel}
74 |           </span>
75 |           <span className="text-right font-mono text-[11px] text-[#878787]">
76 |             {new Intl.NumberFormat(locale, {
77 |               style: "currency",
78 |               currency: currency,
79 |               maximumFractionDigits,
80 |             }).format(discount ?? 0)}
81 |           </span>
82 |         </div>
83 |       )}
84 |
85 |       {includeVAT && (
86 |         <div className="flex justify-between items-center py-1">
87 |           <span className="text-[11px] text-[#878787] font-mono">
88 |             {vatLabel} ({vatRate}%)
89 |           </span>
90 |           <span className="text-right font-mono text-[11px] text-[#878787]">
91 |             {new Intl.NumberFormat(locale, {
92 |               style: "currency",
93 |               currency: currency,
94 |               maximumFractionDigits,
95 |             }).format(totalVAT)}
96 |           </span>
97 |         </div>
98 |       )}
99 |
100 |       {includeTax && (
101 |         <div className="flex justify-between items-center py-1">
102 |           <span className="text-[11px] text-[#878787] font-mono">
103 |             {taxLabel} ({taxRate}%)
104 |           </span>
105 |           <span className="text-right font-mono text-[11px] text-[#878787]">
106 |             {new Intl.NumberFormat(locale, {
107 |               style: "currency",
108 |               currency: currency,
109 |               maximumFractionDigits,
110 |             }).format(totalTax)}
111 |           </span>
112 |         </div>
113 |       )}
114 |
115 |       <div className="flex justify-between items-center py-4 mt-2 border-t border-border">
116 |         <span className="text-[11px] text-[#878787] font-mono">
117 |           {totalLabel}
118 |         </span>
119 |         <span className="text-right font-mono text-[21px]">
120 |           {new Intl.NumberFormat(locale, {
121 |             style: "currency",
122 |             currency: currency,
123 |             maximumFractionDigits,
124 |           }).format(total)}
125 |         </span>
126 |       </div>
127 |     </div>
128 |   );
129 | }
```

packages/invoice/src/templates/og/components/avatar.tsx
```
1 | type Props = {
2 |   customerName?: string;
3 |   logoUrl?: string;
4 |   isValidLogo: boolean;
5 | };
6 |
7 | export function Avatar({ logoUrl, isValidLogo, customerName }: Props) {
8 |   if (isValidLogo) {
9 |     return (
10 |       <img
11 |         src={logoUrl}
12 |         alt="Avatar"
13 |         tw="w-10 h-10 border-[0.5px] border-[#2D2D2D] rounded-full overflow-hidden"
14 |       />
15 |     );
16 |   }
17 |
18 |   return (
19 |     <div tw="w-10 h-10 rounded-full border-[0.5px] border-[#2D2D2D] bg-[#1C1C1C] text-[#F2F2F2] flex items-center justify-center">
20 |       {customerName?.[0]}
21 |     </div>
22 |   );
23 | }
```

packages/invoice/src/templates/og/components/editor-content.tsx
```
1 | import { formatEditorContent } from "../format";
2 |
3 | export function EditorContent({ content }: { content?: JSON }) {
4 |   if (!content) {
5 |     return null;
6 |   }
7 |
8 |   return (
9 |     <div tw="flex" style={{ lineHeight: 1.5 }}>
10 |       {formatEditorContent(content)}
11 |     </div>
12 |   );
13 | }
```

packages/invoice/src/templates/og/components/header.tsx
```
1 | import { Avatar } from "./avatar";
2 | import { Status } from "./status";
3 |
4 | type Props = {
5 |   customerName: string;
6 |   status: "draft" | "overdue" | "paid" | "unpaid" | "canceled";
7 |   logoUrl?: string;
8 |   isValidLogo: boolean;
9 | };
10 |
11 | export function Header({ customerName, status, logoUrl, isValidLogo }: Props) {
12 |   return (
13 |     <div tw="flex mb-12 items-center justify-between w-full">
14 |       <Avatar
15 |         logoUrl={logoUrl}
16 |         isValidLogo={isValidLogo}
17 |         customerName={customerName}
18 |       />
19 |       <Status status={status} />
20 |     </div>
21 |   );
22 | }
```

packages/invoice/src/templates/og/components/logo.tsx
```
1 | export function Logo({
2 |   src,
3 |   customerName,
4 | }: { src: string; customerName: string }) {
5 |   if (!src) return null;
6 |   return <img src={src} alt={customerName} width={112} height={112} />;
7 | }
```

packages/invoice/src/templates/og/components/meta.tsx
```
1 | import { TZDate } from "@date-fns/tz";
2 | import { format } from "date-fns";
3 | import type { Template } from "../../types";
4 |
5 | type Props = {
6 |   template: Template;
7 |   invoiceNumber: string;
8 |   issueDate: string;
9 |   dueDate: string;
10 | };
11 |
12 | export function Meta({ template, invoiceNumber, issueDate, dueDate }: Props) {
13 |   return (
14 |     <div tw="flex justify-between items-center mt-14 mb-2">
15 |       <div tw="flex items-center">
16 |         <span tw="text-[22px] text-[#878787] font-mono mr-2">
17 |           {template.invoice_no_label}:
18 |         </span>
19 |         <span tw="text-[22px] text-white font-mono">{invoiceNumber}</span>
20 |       </div>
21 |
22 |       <div tw="flex items-center">
23 |         <span tw="text-[22px] text-[#878787] font-mono mr-2">
24 |           {template.issue_date_label}:
25 |         </span>
26 |         <span tw="text-[22px] text-white font-mono">
27 |           {format(
28 |             new TZDate(issueDate, template.timezone),
29 |             template.date_format,
30 |           )}
31 |         </span>
32 |       </div>
33 |
34 |       <div tw="flex items-center">
35 |         <span tw="text-[22px] text-[#878787] font-mono mr-2">
36 |           {template.due_date_label}:
37 |         </span>
38 |         <span tw="text-[22px] text-white font-mono">
39 |           {format(new TZDate(dueDate, template.timezone), template.date_format)}
40 |         </span>
41 |       </div>
42 |     </div>
43 |   );
44 | }
```

packages/invoice/src/templates/og/components/status.tsx
```
1 | export function Status({
2 |   status,
3 | }: {
4 |   status: "draft" | "overdue" | "paid" | "unpaid" | "canceled";
5 | }) {
6 |   const getStatusStyles = () => {
7 |     if (status === "draft" || status === "canceled") {
8 |       return "text-[#878787] bg-[#1D1D1D] text-[20px]";
9 |     }
10 |
11 |     if (status === "overdue") {
12 |       return "bg-[#262111] text-[#FFD02B]";
13 |     }
14 |
15 |     if (status === "paid") {
16 |       return "text-[#00C969] bg-[#17241B]";
17 |     }
18 |
19 |     return "text-[#F5F5F3] bg-[#292928]";
20 |   };
21 |
22 |   return (
23 |     <div
24 |       tw={`flex px-4 py-1 rounded-full font-mono max-w-full text-[22px] ${getStatusStyles()}`}
25 |     >
26 |       <span tw="font-mono">
27 |         {status.charAt(0).toUpperCase() + status.slice(1)}
28 |       </span>
29 |     </div>
30 |   );
31 | }
```

packages/invoice/src/templates/pdf/components/description.tsx
```
1 | import { Text, View } from "@react-pdf/renderer";
2 | import { isValidJSON } from "../../../utils/content";
3 | import { EditorContent } from "./editor-content";
4 |
5 | export function Description({ content }: { content: string }) {
6 |   const value = isValidJSON(content) ? JSON.parse(content) : null;
7 |
8 |   // If the content is not valid JSON, return the content as a string
9 |   if (!value) {
10 |     return (
11 |       <Text style={{ fontFamily: "Helvetica", fontSize: 9 }}>{content}</Text>
12 |     );
13 |   }
14 |
15 |   return (
16 |     <View
17 |       style={{
18 |         alignSelf: "flex-start",
19 |         marginTop: -10,
20 |       }}
21 |     >
22 |       <EditorContent content={value} />
23 |     </View>
24 |   );
25 | }
```

packages/invoice/src/templates/pdf/components/editor-content.tsx
```
1 | import { View } from "@react-pdf/renderer";
2 | import { formatEditorContent } from "../format";
3 |
4 | export function EditorContent({ content }: { content?: JSON }) {
5 |   if (!content) {
6 |     return null;
7 |   }
8 |
9 |   return (
10 |     <View style={{ marginTop: 10, lineHeight: 0.9 }}>
11 |       {formatEditorContent(content)}
12 |     </View>
13 |   );
14 | }
```

packages/invoice/src/templates/pdf/components/line-items.tsx
```
1 | import { formatAmount } from "@midday/utils/format";
2 | import { Text, View } from "@react-pdf/renderer";
3 | import type { LineItem } from "../../types";
4 | import { Description } from "./description";
5 |
6 | type Props = {
7 |   lineItems: LineItem[];
8 |   currency: string;
9 |   descriptionLabel: string;
10 |   quantityLabel: string;
11 |   priceLabel: string;
12 |   totalLabel: string;
13 |   locale: string;
14 |   includeDecimals?: boolean;
15 |   includeUnits?: boolean;
16 | };
17 |
18 | export function LineItems({
19 |   lineItems,
20 |   currency,
21 |   descriptionLabel,
22 |   quantityLabel,
23 |   priceLabel,
24 |   totalLabel,
25 |   locale,
26 |   includeDecimals,
27 |   includeUnits,
28 | }: Props) {
29 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
30 |   return (
31 |     <View style={{ marginTop: 20 }}>
32 |       <View
33 |         style={{
34 |           flexDirection: "row",
35 |           borderBottomWidth: 0.5,
36 |           borderBottomColor: "#000",
37 |           paddingBottom: 5,
38 |           marginBottom: 5,
39 |         }}
40 |       >
41 |         <Text style={{ flex: 3, fontSize: 9, fontWeight: 500 }}>
42 |           {descriptionLabel}
43 |         </Text>
44 |         <Text style={{ flex: 1, fontSize: 9, fontWeight: 500 }}>
45 |           {quantityLabel}
46 |         </Text>
47 |         <Text style={{ flex: 1, fontSize: 9, fontWeight: 500 }}>
48 |           {priceLabel}
49 |         </Text>
50 |         <Text
51 |           style={{
52 |             flex: 1,
53 |             fontSize: 9,
54 |             fontWeight: 500,
55 |             textAlign: "right",
56 |           }}
57 |         >
58 |           {totalLabel}
59 |         </Text>
60 |       </View>
61 |       {lineItems.map((item, index) => (
62 |         <View
63 |           key={`line-item-${index.toString()}`}
64 |           style={{
65 |             flexDirection: "row",
66 |             paddingVertical: 5,
67 |             alignItems: "flex-start",
68 |           }}
69 |         >
70 |           <View style={{ flex: 3 }}>
71 |             <Description content={item.name} />
72 |           </View>
73 |
74 |           <Text style={{ flex: 1, fontSize: 9 }}>{item.quantity}</Text>
75 |
76 |           <Text style={{ flex: 1, fontSize: 9 }}>
77 |             {formatAmount({
78 |               currency,
79 |               amount: item.price,
80 |               locale,
81 |               maximumFractionDigits,
82 |             })}
83 |             {includeUnits && item.unit ? ` / ${item.unit}` : null}
84 |           </Text>
85 |
86 |           <Text style={{ flex: 1, fontSize: 9, textAlign: "right" }}>
87 |             {formatAmount({
88 |               currency,
89 |               amount: item.quantity * item.price,
90 |               locale,
91 |               maximumFractionDigits,
92 |             })}
93 |           </Text>
94 |         </View>
95 |       ))}
96 |     </View>
97 |   );
98 | }
```

packages/invoice/src/templates/pdf/components/meta.tsx
```
1 | import { TZDate } from "@date-fns/tz";
2 | import { Text, View } from "@react-pdf/renderer";
3 | import { format } from "date-fns";
4 |
5 | interface MetaProps {
6 |   invoiceNo: string;
7 |   issueDate: string;
8 |   dueDate: string;
9 |   invoiceNoLabel: string;
10 |   issueDateLabel: string;
11 |   dueDateLabel: string;
12 |   dateFormat?: string;
13 |   timezone: string;
14 |   title: string;
15 | }
16 |
17 | export function Meta({
18 |   invoiceNo,
19 |   issueDate,
20 |   dueDate,
21 |   invoiceNoLabel,
22 |   issueDateLabel,
23 |   dueDateLabel,
24 |   dateFormat = "MM/dd/yyyy",
25 |   timezone,
26 |   title,
27 | }: MetaProps) {
28 |   return (
29 |     <View>
30 |       <Text style={{ fontSize: 21, fontWeight: 500, marginBottom: 8 }}>
31 |         {title}
32 |       </Text>
33 |       <View style={{ flexDirection: "column", gap: 4 }}>
34 |         <View style={{ flexDirection: "row", alignItems: "center" }}>
35 |           <Text style={{ fontSize: 9, fontWeight: 500, marginRight: 2 }}>
36 |             {invoiceNoLabel}:
37 |           </Text>
38 |           <Text style={{ fontSize: 9 }}>{invoiceNo}</Text>
39 |         </View>
40 |         <View style={{ flexDirection: "row", alignItems: "center" }}>
41 |           <Text style={{ fontSize: 9, fontWeight: 500, marginRight: 2 }}>
42 |             {issueDateLabel}:
43 |           </Text>
44 |           <Text style={{ fontSize: 9 }}>
45 |             {format(new TZDate(issueDate, timezone), dateFormat)}
46 |           </Text>
47 |         </View>
48 |         <View style={{ flexDirection: "row", alignItems: "center" }}>
49 |           <Text style={{ fontSize: 9, fontWeight: 500, marginRight: 2 }}>
50 |             {dueDateLabel}:
51 |           </Text>
52 |           <Text style={{ fontSize: 9 }}>
53 |             {format(new TZDate(dueDate, timezone), dateFormat)}
54 |           </Text>
55 |         </View>
56 |       </View>
57 |     </View>
58 |   );
59 | }
```

packages/invoice/src/templates/pdf/components/note.tsx
```
1 | import { Text, View } from "@react-pdf/renderer";
2 | import { EditorContent } from "./editor-content";
3 |
4 | type Props = {
5 |   content?: JSON;
6 |   noteLabel?: string;
7 | };
8 |
9 | export function Note({ content, noteLabel }: Props) {
10 |   if (!content) return null;
11 |   return (
12 |     <View style={{ marginTop: 20 }}>
13 |       <Text style={{ fontSize: 9, fontWeight: 500 }}>{noteLabel}</Text>
14 |       <EditorContent content={content} />
15 |     </View>
16 |   );
17 | }
```

packages/invoice/src/templates/pdf/components/payment-details.tsx
```
1 | import { Text, View } from "@react-pdf/renderer";
2 | import { EditorContent } from "./editor-content";
3 |
4 | type Props = {
5 |   content?: JSON;
6 |   paymentLabel?: string;
7 | };
8 |
9 | export function PaymentDetails({ content, paymentLabel }: Props) {
10 |   if (!content) return null;
11 |
12 |   return (
13 |     <View style={{ marginTop: 20 }}>
14 |       <Text style={{ fontSize: 9, fontWeight: 500 }}>{paymentLabel}</Text>
15 |       <EditorContent content={content} />
16 |     </View>
17 |   );
18 | }
```

packages/invoice/src/templates/pdf/components/qr-code.tsx
```
1 | import { Image, View } from "@react-pdf/renderer";
2 |
3 | interface QRCodeProps {
4 |   data: string;
5 |   size?: number;
6 | }
7 |
8 | export function QRCode({ data, size = 40 }: QRCodeProps) {
9 |   return (
10 |     <View style={{ marginTop: 20 }}>
11 |       <Image src={data} style={{ width: size, height: size }} />
12 |     </View>
13 |   );
14 | }
```

packages/invoice/src/templates/pdf/components/summary.tsx
```
1 | import { formatAmount } from "@midday/utils/format";
2 | import { Text, View } from "@react-pdf/renderer";
3 |
4 | interface SummaryProps {
5 |   amount: number;
6 |   tax?: number;
7 |   taxRate?: number;
8 |   vat?: number;
9 |   vatRate?: number;
10 |   currency: string;
11 |   totalLabel: string;
12 |   taxLabel: string;
13 |   vatLabel: string;
14 |   locale: string;
15 |   discount?: number;
16 |   discountLabel: string;
17 |   includeDiscount: boolean;
18 |   includeVAT: boolean;
19 |   includeTax: boolean;
20 |   includeDecimals: boolean;
21 |   subtotalLabel: string;
22 |   subtotal: number;
23 | }
24 |
25 | export function Summary({
26 |   amount,
27 |   tax,
28 |   taxRate,
29 |   vat,
30 |   vatRate,
31 |   currency,
32 |   totalLabel,
33 |   taxLabel,
34 |   vatLabel,
35 |   locale,
36 |   discount,
37 |   discountLabel,
38 |   includeDiscount,
39 |   includeVAT,
40 |   includeTax,
41 |   includeDecimals,
42 |   subtotalLabel,
43 |   subtotal,
44 | }: SummaryProps) {
45 |   const maximumFractionDigits = includeDecimals ? 2 : 0;
46 |
47 |   return (
48 |     <View
49 |       style={{
50 |         marginTop: 60,
51 |         marginBottom: 40,
52 |         alignItems: "flex-end",
53 |         marginLeft: "auto",
54 |         width: 250,
55 |       }}
56 |     >
57 |       <View style={{ flexDirection: "row", marginBottom: 5, width: "100%" }}>
58 |         <Text style={{ fontSize: 9, flex: 1 }}>{subtotalLabel}</Text>
59 |         <Text style={{ fontSize: 9, textAlign: "right" }}>
60 |           {formatAmount({
61 |             currency,
62 |             amount: subtotal,
63 |             locale,
64 |             maximumFractionDigits,
65 |           })}
66 |         </Text>
67 |       </View>
68 |
69 |       {includeDiscount && discount && (
70 |         <View style={{ flexDirection: "row", marginBottom: 5, width: "100%" }}>
71 |           <Text style={{ fontSize: 9, flex: 1 }}>{discountLabel}</Text>
72 |           <Text style={{ fontSize: 9, textAlign: "right" }}>
73 |             {formatAmount({
74 |               currency,
75 |               amount: discount,
76 |               locale,
77 |               maximumFractionDigits,
78 |             })}
79 |           </Text>
80 |         </View>
81 |       )}
82 |
83 |       {includeVAT && (
84 |         <View style={{ flexDirection: "row", marginBottom: 5, width: "100%" }}>
85 |           <Text style={{ fontSize: 9, flex: 1 }}>
86 |             {vatLabel} ({vatRate}%)
87 |           </Text>
88 |           <Text style={{ fontSize: 9, textAlign: "right" }}>
89 |             {formatAmount({
90 |               currency,
91 |               amount: vat,
92 |               locale,
93 |               maximumFractionDigits,
94 |             })}
95 |           </Text>
96 |         </View>
97 |       )}
98 |
99 |       {includeTax && (
100 |         <View style={{ flexDirection: "row", marginBottom: 5, width: "100%" }}>
101 |           <Text style={{ fontSize: 9, flex: 1 }}>
102 |             {taxLabel} ({taxRate}%)
103 |           </Text>
104 |           <Text style={{ fontSize: 9, textAlign: "right" }}>
105 |             {formatAmount({
106 |               currency,
107 |               amount: tax,
108 |               locale,
109 |               maximumFractionDigits,
110 |             })}
111 |           </Text>
112 |         </View>
113 |       )}
114 |
115 |       <View
116 |         style={{
117 |           flexDirection: "row",
118 |           marginTop: 5,
119 |           borderTopWidth: 0.5,
120 |           borderTopColor: "#000",
121 |           justifyContent: "space-between",
122 |           alignItems: "center",
123 |           paddingTop: 5,
124 |           width: "100%",
125 |         }}
126 |       >
127 |         <Text style={{ fontSize: 9, marginRight: 10 }}>{totalLabel}</Text>
128 |         <Text style={{ fontSize: 21 }}>
129 |           {formatAmount({ currency, amount, locale, maximumFractionDigits })}
130 |         </Text>
131 |       </View>
132 |     </View>
133 |   );
134 | }
```

packages/ui/src/components/editor/extentions/register.ts
```
1 | // You can find the list of extensions here: https://tiptap.dev/docs/editor/extensions/functionality
2 |
3 | import Link from "@tiptap/extension-link";
4 | import Placeholder from "@tiptap/extension-placeholder";
5 | import Underline from "@tiptap/extension-underline";
6 | import StarterKit from "@tiptap/starter-kit";
7 |
8 | // Add your extensions here
9 | const extensions = [
10 |   StarterKit,
11 |   Underline,
12 |   Link.configure({
13 |     openOnClick: false,
14 |     autolink: true,
15 |     defaultProtocol: "https",
16 |   }),
17 | ];
18 |
19 | export function registerExtensions(options?: { placeholder?: string }) {
20 |   const { placeholder } = options ?? {};
21 |   return [...extensions, Placeholder.configure({ placeholder })];
22 | }
```

apps/dashboard/src/actions/ai/chat/tools/burn-rate.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { calculateAvgBurnRate } from "@/utils/format";
3 | import { getBurnRate, getRunway } from "@midday/supabase/cached-queries";
4 | import { startOfMonth } from "date-fns";
5 | import { nanoid } from "nanoid";
6 | import { z } from "zod";
7 | import { BurnRateUI } from "./ui/burn-rate-ui";
8 |
9 | type Args = {
10 |   aiState: MutableAIState;
11 |   currency: string;
12 |   dateFrom: string;
13 |   dateTo: string;
14 | };
15 |
16 | export function getBurnRateTool({ aiState, dateFrom, dateTo }: Args) {
17 |   return {
18 |     description: "Get burn rate",
19 |     parameters: z.object({
20 |       startDate: z.coerce
21 |         .date()
22 |         .describe("The start date of the burn rate, in ISO-8601 format")
23 |         .default(new Date(dateFrom)),
24 |       endDate: z.coerce
25 |         .date()
26 |         .describe("The end date of the burn rate, in ISO-8601 format")
27 |         .default(new Date(dateTo)),
28 |       currency: z
29 |         .string()
30 |         .describe("The currency for the burn rate")
31 |         .optional(),
32 |     }),
33 |     generate: async (args) => {
34 |       const toolCallId = nanoid();
35 |
36 |       const { currency, startDate, endDate } = args;
37 |
38 |       const [{ data: months }, { data: burnRateData }] = await Promise.all([
39 |         getRunway({
40 |           currency,
41 |           from: startOfMonth(new Date(startDate)).toISOString(),
42 |           to: endDate.toISOString(),
43 |         }),
44 |         getBurnRate({
45 |           from: startDate.toISOString(),
46 |           to: endDate.toISOString(),
47 |           currency,
48 |         }),
49 |       ]);
50 |
51 |       const averageBurnRate = calculateAvgBurnRate(burnRateData);
52 |
53 |       const props = {
54 |         averageBurnRate,
55 |         currency,
56 |         startDate,
57 |         endDate,
58 |         months,
59 |         data: burnRateData,
60 |       };
61 |
62 |       aiState.done({
63 |         ...aiState.get(),
64 |         messages: [
65 |           ...aiState.get().messages,
66 |           {
67 |             id: nanoid(),
68 |             role: "assistant",
69 |             content: [
70 |               {
71 |                 type: "tool-call",
72 |                 toolName: "getBurnRate",
73 |                 toolCallId,
74 |                 args,
75 |               },
76 |             ],
77 |           },
78 |           {
79 |             id: nanoid(),
80 |             role: "tool",
81 |             content: [
82 |               {
83 |                 type: "tool-result",
84 |                 toolName: "getBurnRate",
85 |                 toolCallId,
86 |                 result: props,
87 |               },
88 |             ],
89 |           },
90 |         ],
91 |       });
92 |
93 |       return <BurnRateUI {...props} />;
94 |     },
95 |   };
96 | }
```

apps/dashboard/src/actions/ai/chat/tools/forecast.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { openai } from "@ai-sdk/openai";
3 | import { getMetrics } from "@midday/supabase/cached-queries";
4 | import { generateText } from "ai";
5 | import { startOfMonth } from "date-fns";
6 | import { nanoid } from "nanoid";
7 | import { z } from "zod";
8 | import { ForecastUI } from "./ui/forecast-ui";
9 |
10 | type Args = {
11 |   aiState: MutableAIState;
12 |   dateFrom: string;
13 |   dateTo: string;
14 | };
15 |
16 | export function getForecastTool({ aiState, dateFrom, dateTo }: Args) {
17 |   return {
18 |     description: "Forecast profit or revenue",
19 |     parameters: z.object({
20 |       startDate: z.coerce
21 |         .date()
22 |         .describe("The start date of the forecast, in ISO-8601 format")
23 |         .default(new Date(dateFrom)),
24 |       endDate: z.coerce
25 |         .date()
26 |         .describe("The end date of the forecast, in ISO-8601 format")
27 |         .default(new Date(dateTo)),
28 |       type: z.enum(["profit", "revenue"]).describe("The type of forecast"),
29 |       currency: z.string().describe("The currency for forecast").optional(),
30 |     }),
31 |     generate: async (args) => {
32 |       const { currency, startDate, endDate, type } = args;
33 |
34 |       const data = await getMetrics({
35 |         from: startOfMonth(new Date(startDate)).toISOString(),
36 |         to: new Date(endDate).toISOString(),
37 |         type,
38 |         currency,
39 |       });
40 |
41 |       const prev = data?.result?.map((d) => {
42 |         return `${d.current.date}: ${Intl.NumberFormat("en", {
43 |           style: "currency",
44 |           currency: data.meta.currency,
45 |         }).format(d.current.value)}\n`;
46 |       });
47 |
48 |       const { text } = await generateText({
49 |         model: openai("gpt-4o-mini"),
50 |         system:
51 |           "You are a financial forecaster and analyst. Your task is to provide simple, clear, and concise content. Return only the result with a short description only with text. Make sure to mention that this is an indication of the forecast and should be verified.",
52 |         prompt: `forecast next month ${type} based on the last 12 months ${type}:\n${prev}
53 |           Current date: ${new Date().toISOString()}
54 |         `,
55 |       });
56 |
57 |       const toolCallId = nanoid();
58 |
59 |       const props = {
60 |         content: text,
61 |       };
62 |
63 |       aiState.done({
64 |         ...aiState.get(),
65 |         messages: [
66 |           ...aiState.get().messages,
67 |           {
68 |             id: nanoid(),
69 |             role: "assistant",
70 |             content: [
71 |               {
72 |                 type: "tool-call",
73 |                 toolName: "getForecast",
74 |                 toolCallId,
75 |                 args,
76 |               },
77 |             ],
78 |           },
79 |           {
80 |             id: nanoid(),
81 |             role: "tool",
82 |             content: [
83 |               {
84 |                 type: "tool-result",
85 |                 toolName: "getForecast",
86 |                 toolCallId,
87 |                 result: props,
88 |               },
89 |             ],
90 |           },
91 |         ],
92 |       });
93 |
94 |       return <ForecastUI {...props} />;
95 |     },
96 |   };
97 | }
```

apps/dashboard/src/actions/ai/chat/tools/get-documents.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getVaultQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { DocumentsUI } from "./ui/documents-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   teamId: string;
11 | };
12 |
13 | export function getDocumentsTool({ aiState, teamId }: Args) {
14 |   return {
15 |     description: "Find documents",
16 |     parameters: z.object({
17 |       name: z.string().describe("The name of the document"),
18 |     }),
19 |     generate: async (args) => {
20 |       const { name } = args;
21 |       const supabase = createClient();
22 |
23 |       const { data } = await getVaultQuery(supabase, {
24 |         teamId,
25 |         searchQuery: name,
26 |       });
27 |
28 |       const formattedData = data?.map((item) => ({
29 |         ...item,
30 |         content_type: item?.metadata?.mimetype,
31 |         display_name: item?.name,
32 |         file_path: item?.path_tokens,
33 |       }));
34 |
35 |       const props = {
36 |         data: formattedData,
37 |       };
38 |
39 |       const toolCallId = nanoid();
40 |
41 |       aiState.done({
42 |         ...aiState.get(),
43 |         messages: [
44 |           ...aiState.get().messages,
45 |           {
46 |             id: nanoid(),
47 |             role: "assistant",
48 |             content: [
49 |               {
50 |                 type: "tool-call",
51 |                 toolName: "getDocuments",
52 |                 toolCallId,
53 |                 args,
54 |               },
55 |             ],
56 |           },
57 |           {
58 |             id: nanoid(),
59 |             role: "tool",
60 |             content: [
61 |               {
62 |                 type: "tool-result",
63 |                 toolName: "getDocuments",
64 |                 toolCallId,
65 |                 result: props,
66 |               },
67 |             ],
68 |           },
69 |         ],
70 |       });
71 |
72 |       return <DocumentsUI {...props} />;
73 |     },
74 |   };
75 | }
```

apps/dashboard/src/actions/ai/chat/tools/get-invoces.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getInboxSearchQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { DocumentsUI } from "./ui/documents-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   teamId: string;
11 | };
12 |
13 | export function getInvoicesTool({ aiState, teamId }: Args) {
14 |   return {
15 |     description: "Find receipt or invoice",
16 |     parameters: z.object({
17 |       name: z.string().describe("The name of the invoice or receipt"),
18 |     }),
19 |     generate: async (args) => {
20 |       const { name, amount } = args;
21 |       const supabase = createClient();
22 |
23 |       const searchQuery = name || amount;
24 |
25 |       const data = await getInboxSearchQuery(supabase, {
26 |         teamId,
27 |         q: searchQuery,
28 |       });
29 |
30 |       const props = {
31 |         data,
32 |       };
33 |
34 |       const toolCallId = nanoid();
35 |
36 |       aiState.done({
37 |         ...aiState.get(),
38 |         messages: [
39 |           ...aiState.get().messages,
40 |           {
41 |             id: nanoid(),
42 |             role: "assistant",
43 |             content: [
44 |               {
45 |                 type: "tool-call",
46 |                 toolName: "getInvoices",
47 |                 toolCallId,
48 |                 args,
49 |               },
50 |             ],
51 |           },
52 |           {
53 |             id: nanoid(),
54 |             role: "tool",
55 |             content: [
56 |               {
57 |                 type: "tool-result",
58 |                 toolName: "getInvoices",
59 |                 toolCallId,
60 |                 result: props,
61 |               },
62 |             ],
63 |           },
64 |         ],
65 |       });
66 |
67 |       return <DocumentsUI {...props} />;
68 |     },
69 |   };
70 | }
```

apps/dashboard/src/actions/ai/chat/tools/get-transactions.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getTransactions } from "@midday/supabase/cached-queries";
3 | import { nanoid } from "nanoid";
4 | import { z } from "zod";
5 | import { TransactionsUI } from "./ui/transactions-ui";
6 |
7 | type Args = {
8 |   aiState: MutableAIState;
9 | };
10 |
11 | export function getTransactionsTool({ aiState }: Args) {
12 |   return {
13 |     description: "Find transactions or show expenses",
14 |     parameters: z.object({
15 |       name: z.string().describe("The name of the transactions").optional(),
16 |       categories: z
17 |         .array(z.string())
18 |         .describe("The categories of the transactions")
19 |         .optional(),
20 |       amount: z.string().describe("The amount of the transactions").optional(),
21 |       expense: z
22 |         .boolean()
23 |         .describe("Filter for expense transactions")
24 |         .optional(),
25 |       recurring: z
26 |         .array(z.enum(["all", "weekly", "monthly", "annually"]))
27 |         .describe("Filter for recurring transactions")
28 |         .optional(),
29 |       attachments: z
30 |         .enum(["include", "exclude"])
31 |         .describe(
32 |           "Filter transactions if they are completed or not, if they have receipts or attachments",
33 |         )
34 |         .optional(),
35 |       limit: z.number().describe("Limit the number of transactions").optional(),
36 |       fromDate: z.coerce
37 |         .date()
38 |         .describe("Filter transactions from this date, in ISO-8601 format")
39 |         .optional(),
40 |       toDate: z.coerce
41 |         .date()
42 |         .describe("Filter transactions to this date, in ISO-8601 format")
43 |         .optional(),
44 |     }),
45 |     generate: async (args) => {
46 |       const {
47 |         name,
48 |         categories,
49 |         amount,
50 |         expense,
51 |         limit = 4,
52 |         fromDate,
53 |         toDate,
54 |         attachments,
55 |         recurring,
56 |       } = args;
57 |
58 |       const toolCallId = nanoid();
59 |
60 |       const searchQuery = name || amount;
61 |
62 |       const filter = {
63 |         start: fromDate,
64 |         end: toDate,
65 |         categories,
66 |         attachments,
67 |         recurring,
68 |       };
69 |
70 |       const sort = expense ? ["amount", "asc"] : undefined;
71 |
72 |       const { data, meta } = await getTransactions({
73 |         searchQuery,
74 |         from: 0,
75 |         to: limit,
76 |         filter,
77 |         sort,
78 |       });
79 |
80 |       const props = {
81 |         data,
82 |         meta,
83 |         q: searchQuery,
84 |         filter,
85 |         sort,
86 |       };
87 |
88 |       aiState.done({
89 |         ...aiState.get(),
90 |         messages: [
91 |           ...aiState.get().messages,
92 |           {
93 |             id: nanoid(),
94 |             role: "assistant",
95 |             content: [
96 |               {
97 |                 type: "tool-call",
98 |                 toolName: "getTransactions",
99 |                 toolCallId,
100 |                 args,
101 |               },
102 |             ],
103 |           },
104 |           {
105 |             id: nanoid(),
106 |             role: "tool",
107 |             content: [
108 |               {
109 |                 type: "tool-result",
110 |                 toolName: "getTransactions",
111 |                 toolCallId,
112 |                 result: props,
113 |               },
114 |             ],
115 |           },
116 |         ],
117 |       });
118 |
119 |       return <TransactionsUI {...props} />;
120 |     },
121 |   };
122 | }
```

apps/dashboard/src/actions/ai/chat/tools/profit.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getMetrics } from "@midday/supabase/cached-queries";
3 | import { startOfMonth } from "date-fns";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { ProfitUI } from "./ui/profit-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   dateFrom: string;
11 |   dateTo: string;
12 | };
13 |
14 | export function getProfitTool({ aiState, dateFrom, dateTo }: Args) {
15 |   return {
16 |     description: "Get profit",
17 |     parameters: z.object({
18 |       startDate: z.coerce
19 |         .date()
20 |         .describe("The start date of the profit, in ISO-8601 format")
21 |         .default(new Date(dateFrom)),
22 |       endDate: z.coerce
23 |         .date()
24 |         .describe("The end date of the profit, in ISO-8601 format")
25 |         .default(new Date(dateTo)),
26 |       currency: z.string().describe("The currency for profit").optional(),
27 |     }),
28 |     generate: async (args) => {
29 |       const { currency, startDate, endDate } = args;
30 |
31 |       const data = await getMetrics({
32 |         from: startOfMonth(new Date(startDate)).toISOString(),
33 |         to: new Date(endDate).toISOString(),
34 |         type: "profit",
35 |         currency,
36 |       });
37 |
38 |       const toolCallId = nanoid();
39 |
40 |       const props = {
41 |         data,
42 |         startDate: startOfMonth(new Date(startDate)).toISOString(),
43 |         endDate: new Date(endDate).toISOString(),
44 |       };
45 |
46 |       aiState.done({
47 |         ...aiState.get(),
48 |         messages: [
49 |           ...aiState.get().messages,
50 |           {
51 |             id: nanoid(),
52 |             role: "assistant",
53 |             content: [
54 |               {
55 |                 type: "tool-call",
56 |                 toolName: "getProfit",
57 |                 toolCallId,
58 |                 args,
59 |               },
60 |             ],
61 |           },
62 |           {
63 |             id: nanoid(),
64 |             role: "tool",
65 |             content: [
66 |               {
67 |                 type: "tool-result",
68 |                 toolName: "getProfit",
69 |                 toolCallId,
70 |                 result: props,
71 |               },
72 |             ],
73 |           },
74 |         ],
75 |       });
76 |
77 |       return <ProfitUI {...props} />;
78 |     },
79 |   };
80 | }
```

apps/dashboard/src/actions/ai/chat/tools/report.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { dub } from "@/utils/dub";
3 | import { createClient } from "@midday/supabase/server";
4 | import { startOfMonth } from "date-fns";
5 | import { nanoid } from "nanoid";
6 | import { z } from "zod";
7 | import { ReportUI } from "./ui/report-ui";
8 |
9 | type Args = {
10 |   aiState: MutableAIState;
11 |   userId: string;
12 |   teamId: string;
13 |   dateFrom: string;
14 |   dateTo: string;
15 | };
16 |
17 | export function createReport({
18 |   aiState,
19 |   userId,
20 |   teamId,
21 |   dateFrom,
22 |   dateTo,
23 | }: Args) {
24 |   return {
25 |     description: "Create report",
26 |     parameters: z.object({
27 |       startDate: z.coerce
28 |         .date()
29 |         .describe("The start date of the report, in ISO-8601 format")
30 |         .default(new Date(dateFrom)),
31 |       endDate: z.coerce
32 |         .date()
33 |         .describe("The end date of the report, in ISO-8601 format")
34 |         .default(new Date(dateTo)),
35 |       type: z
36 |         .enum(["profit", "revenue", "burn_rate", "expense"])
37 |         .describe("The report type"),
38 |       currency: z.string().describe("The currency for the report").optional(),
39 |     }),
40 |     generate: async (args) => {
41 |       const { currency, startDate, endDate, type, expiresAt } = args;
42 |
43 |       const supabase = createClient();
44 |
45 |       const { data } = await supabase
46 |         .from("reports")
47 |         .insert({
48 |           team_id: teamId,
49 |           from: startOfMonth(new Date(startDate)).toISOString(),
50 |           to: new Date(endDate).toISOString(),
51 |           type,
52 |           expire_at: expiresAt,
53 |           currency,
54 |           created_by: userId,
55 |         })
56 |         .select("*")
57 |         .single();
58 |
59 |       const link = await dub.links.create({
60 |         url: `https://app.midday.ai/report/${data.id}`,
61 |         expiresAt,
62 |       });
63 |
64 |       const { data: linkData } = await supabase
65 |         .from("reports")
66 |         .update({
67 |           link_id: link.id,
68 |           short_link: link.shortLink,
69 |         })
70 |         .eq("id", data.id)
71 |         .select("*")
72 |         .single();
73 |
74 |       const props = {
75 |         startDate: linkData?.from,
76 |         endDate: linkData?.to,
77 |         shortLink: linkData?.short_link,
78 |         type: linkData?.type,
79 |       };
80 |
81 |       const toolCallId = nanoid();
82 |
83 |       aiState.done({
84 |         ...aiState.get(),
85 |         messages: [
86 |           ...aiState.get().messages,
87 |           {
88 |             id: nanoid(),
89 |             role: "assistant",
90 |             content: [
91 |               {
92 |                 type: "tool-call",
93 |                 toolName: "createReport",
94 |                 toolCallId,
95 |                 args,
96 |               },
97 |             ],
98 |           },
99 |           {
100 |             id: nanoid(),
101 |             role: "tool",
102 |             content: [
103 |               {
104 |                 type: "tool-result",
105 |                 toolName: "createReport",
106 |                 toolCallId,
107 |                 result: props,
108 |               },
109 |             ],
110 |           },
111 |         ],
112 |       });
113 |       return <ReportUI {...props} />;
114 |     },
115 |   };
116 | }
```

apps/dashboard/src/actions/ai/chat/tools/revenue.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getMetrics } from "@midday/supabase/cached-queries";
3 | import { startOfMonth } from "date-fns";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { RevenueUI } from "./ui/revenue-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   dateFrom: string;
11 |   dateTo: string;
12 | };
13 |
14 | export function getRevenueTool({ aiState, dateFrom, dateTo }: Args) {
15 |   return {
16 |     description: "Get revenue",
17 |     parameters: z.object({
18 |       startDate: z.coerce
19 |         .date()
20 |         .describe("The start date of the revenue, in ISO-8601 format")
21 |         .default(new Date(dateFrom)),
22 |       endDate: z.coerce
23 |         .date()
24 |         .describe("The end date of the revenue, in ISO-8601 format")
25 |         .default(new Date(dateTo)),
26 |       currency: z.string().describe("The currency for revenue").optional(),
27 |     }),
28 |     generate: async (args) => {
29 |       const { currency, startDate, endDate } = args;
30 |
31 |       const data = await getMetrics({
32 |         from: startOfMonth(new Date(startDate)).toISOString(),
33 |         to: new Date(endDate).toISOString(),
34 |         type: "revenue",
35 |         currency,
36 |       });
37 |
38 |       const toolCallId = nanoid();
39 |
40 |       const props = {
41 |         data,
42 |         startDate,
43 |         endDate,
44 |       };
45 |
46 |       aiState.done({
47 |         ...aiState.get(),
48 |         messages: [
49 |           ...aiState.get().messages,
50 |           {
51 |             id: nanoid(),
52 |             role: "assistant",
53 |             content: [
54 |               {
55 |                 type: "tool-call",
56 |                 toolName: "getRevenue",
57 |                 toolCallId,
58 |                 args,
59 |               },
60 |             ],
61 |           },
62 |           {
63 |             id: nanoid(),
64 |             role: "tool",
65 |             content: [
66 |               {
67 |                 type: "tool-result",
68 |                 toolName: "getRevenue",
69 |                 toolCallId,
70 |                 result: props,
71 |               },
72 |             ],
73 |           },
74 |         ],
75 |       });
76 |
77 |       return <RevenueUI {...props} />;
78 |     },
79 |   };
80 | }
```

apps/dashboard/src/actions/ai/chat/tools/runway.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getRunway } from "@midday/supabase/cached-queries";
3 | import { startOfMonth } from "date-fns";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { RunwayUI } from "./ui/runway-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   dateFrom: string;
11 |   dateTo: string;
12 | };
13 |
14 | export function getRunwayTool({ aiState, dateFrom, dateTo }: Args) {
15 |   return {
16 |     description: "Get runway",
17 |     parameters: z.object({
18 |       startDate: z.coerce
19 |         .date()
20 |         .describe("The start date of the runway, in ISO-8601 format")
21 |         .default(new Date(dateFrom)),
22 |       endDate: z.coerce
23 |         .date()
24 |         .describe("The end date of the runway, in ISO-8601 format")
25 |         .default(new Date(dateTo)),
26 |       currency: z.string().describe("The currency for the runway").optional(),
27 |     }),
28 |     generate: async (args) => {
29 |       const { currency, startDate, endDate } = args;
30 |
31 |       const { data } = await getRunway({
32 |         currency,
33 |         from: startOfMonth(new Date(startDate)).toISOString(),
34 |         to: endDate.toISOString(),
35 |       });
36 |
37 |       const toolCallId = nanoid();
38 |
39 |       const props = {
40 |         months: data,
41 |       };
42 |
43 |       aiState.done({
44 |         ...aiState.get(),
45 |         messages: [
46 |           ...aiState.get().messages,
47 |           {
48 |             id: nanoid(),
49 |             role: "assistant",
50 |             content: [
51 |               {
52 |                 type: "tool-call",
53 |                 toolName: "getRunway",
54 |                 toolCallId,
55 |                 args,
56 |               },
57 |             ],
58 |           },
59 |           {
60 |             id: nanoid(),
61 |             role: "tool",
62 |             content: [
63 |               {
64 |                 type: "tool-result",
65 |                 toolName: "getRunway",
66 |                 toolCallId,
67 |                 result: props,
68 |               },
69 |             ],
70 |           },
71 |         ],
72 |       });
73 |
74 |       return <RunwayUI {...props} />;
75 |     },
76 |   };
77 | }
```

apps/dashboard/src/actions/ai/chat/tools/spending.tsx
```
1 | import type { MutableAIState } from "@/actions/ai/types";
2 | import { getSpending } from "@midday/supabase/cached-queries";
3 | import { startOfMonth } from "date-fns";
4 | import { nanoid } from "nanoid";
5 | import { z } from "zod";
6 | import { SpendingUI } from "./ui/spending-ui";
7 |
8 | type Args = {
9 |   aiState: MutableAIState;
10 |   dateFrom: string;
11 |   dateTo: string;
12 | };
13 |
14 | export function getSpendingTool({ aiState, dateFrom, dateTo }: Args) {
15 |   return {
16 |     description: "Get spending from category",
17 |     parameters: z.object({
18 |       currency: z.string().describe("The currency for spending").optional(),
19 |       category: z.string().describe("The category for spending"),
20 |       startDate: z.coerce
21 |         .date()
22 |         .describe("The start date of the spending, in ISO-8601 format")
23 |         .default(new Date(dateFrom)),
24 |       endDate: z.coerce
25 |         .date()
26 |         .describe("The end date of the spending, in ISO-8601 format")
27 |         .default(new Date(dateTo)),
28 |     }),
29 |     generate: async (args) => {
30 |       const { startDate, endDate, currency, category } = args;
31 |       const toolCallId = nanoid();
32 |
33 |       const { data } = await getSpending({
34 |         from: startOfMonth(new Date(startDate)).toISOString(),
35 |         to: new Date(endDate).toISOString(),
36 |         currency,
37 |       });
38 |
39 |       const found = data.find(
40 |         (c) => category.toLowerCase() === c?.name?.toLowerCase(),
41 |       );
42 |
43 |       const props = {
44 |         currency: found?.currency,
45 |         category,
46 |         amount: found?.amount,
47 |         name: found?.name,
48 |         startDate,
49 |         endDate,
50 |       };
51 |
52 |       aiState.done({
53 |         ...aiState.get(),
54 |         messages: [
55 |           ...aiState.get().messages,
56 |           {
57 |             id: nanoid(),
58 |             role: "assistant",
59 |             content: [
60 |               {
61 |                 type: "tool-call",
62 |                 toolName: "getSpending",
63 |                 toolCallId,
64 |                 args,
65 |               },
66 |             ],
67 |           },
68 |           {
69 |             id: nanoid(),
70 |             role: "tool",
71 |             content: [
72 |               {
73 |                 type: "tool-result",
74 |                 toolName: "getSpending",
75 |                 toolCallId,
76 |                 result: props,
77 |               },
78 |             ],
79 |           },
80 |         ],
81 |       });
82 |
83 |       return <SpendingUI {...props} />;
84 |     },
85 |   };
86 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/error.tsx
```
1 | "use client";
2 |
3 | import { Button } from "@midday/ui/button";
4 | import * as Sentry from "@sentry/nextjs";
5 | import Link from "next/link";
6 | import { useEffect } from "react";
7 |
8 | export default function ErrorPage({
9 |   reset,
10 |   error,
11 | }: { reset: () => void; error: Error & { digest?: string } }) {
12 |   useEffect(() => {
13 |     Sentry.captureException(error);
14 |   }, [error]);
15 |
16 |   return (
17 |     <div className="h-[calc(100vh-200px)] w-full">
18 |       <div className="mt-8 flex flex-col items-center justify-center h-full">
19 |         <div className="flex justify-between items-center flex-col mt-8 text-center mb-8">
20 |           <h2 className="font-medium mb-4">Something went wrong</h2>
21 |           <p className="text-sm text-[#878787]">
22 |             An unexpected error has occurred. Please try again
23 |             <br /> or contact support if the issue persists.
24 |           </p>
25 |         </div>
26 |
27 |         <div className="flex space-x-4">
28 |           <Button onClick={() => reset()} variant="outline">
29 |             Try again
30 |           </Button>
31 |
32 |           <Link href="/account/support">
33 |             <Button>Contact us</Button>
34 |           </Link>
35 |         </div>
36 |       </div>
37 |     </div>
38 |   );
39 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/layout.tsx
```
1 | import { AI } from "@/actions/ai/chat";
2 | import { DefaultSettings } from "@/components/default-settings.server";
3 | import { Header } from "@/components/header";
4 | import { GlobalSheets } from "@/components/sheets/global-sheets";
5 | import { Sidebar } from "@/components/sidebar";
6 | import { UserProvider } from "@/store/user/provider";
7 | import { setupAnalytics } from "@midday/events/server";
8 | import { getCountryCode, getCurrency } from "@midday/location";
9 | import { uniqueCurrencies } from "@midday/location/currencies";
10 | import { getUser } from "@midday/supabase/cached-queries";
11 | import { nanoid } from "nanoid";
12 | import dynamic from "next/dynamic";
13 | import { redirect } from "next/navigation";
14 | import { Suspense } from "react";
15 |
16 | const AssistantModal = dynamic(
17 |   () =>
18 |     import("@/components/assistant/assistant-modal").then(
19 |       (mod) => mod.AssistantModal,
20 |     ),
21 |   {
22 |     ssr: false,
23 |   },
24 | );
25 |
26 | const ExportStatus = dynamic(
27 |   () => import("@/components/export-status").then((mod) => mod.ExportStatus),
28 |   {
29 |     ssr: false,
30 |   },
31 | );
32 |
33 | const SelectBankAccountsModal = dynamic(
34 |   () =>
35 |     import("@/components/modals/select-bank-accounts").then(
36 |       (mod) => mod.SelectBankAccountsModal,
37 |     ),
38 |   {
39 |     ssr: false,
40 |   },
41 | );
42 |
43 | const ImportModal = dynamic(
44 |   () =>
45 |     import("@/components/modals/import-modal").then((mod) => mod.ImportModal),
46 |   {
47 |     ssr: false,
48 |   },
49 | );
50 |
51 | const HotKeys = dynamic(
52 |   () => import("@/components/hot-keys").then((mod) => mod.HotKeys),
53 |   {
54 |     ssr: false,
55 |   },
56 | );
57 |
58 | const ConnectTransactionsModal = dynamic(
59 |   () =>
60 |     import("@/components/modals/connect-transactions-modal").then(
61 |       (mod) => mod.ConnectTransactionsModal,
62 |     ),
63 |   {
64 |     ssr: false,
65 |   },
66 | );
67 |
68 | export default async function Layout({
69 |   children,
70 | }: {
71 |   children: React.ReactNode;
72 | }) {
73 |   const user = await getUser();
74 |   const countryCode = getCountryCode();
75 |   const currency = getCurrency();
76 |
77 |   if (!user?.data?.team) {
78 |     redirect("/teams");
79 |   }
80 |
81 |   if (user) {
82 |     await setupAnalytics({ userId: user.data.id });
83 |   }
84 |
85 |   return (
86 |     <UserProvider data={user.data}>
87 |       <div className="relative">
88 |         <AI
89 |           initialAIState={{ user: user.data, messages: [], chatId: nanoid() }}
90 |         >
91 |           <Sidebar />
92 |
93 |           <div className="mx-4 md:ml-[95px] md:mr-10 pb-8">
94 |             <Header />
95 |             {children}
96 |           </div>
97 |
98 |           {/* This is used to make the header draggable on macOS */}
99 |           <div className="hidden todesktop:block todesktop:[-webkit-app-region:drag] fixed top-0 w-full h-4 pointer-events-none" />
100 |
101 |           <AssistantModal />
102 |           <ConnectTransactionsModal countryCode={countryCode} />
103 |           <SelectBankAccountsModal />
104 |           <ImportModal
105 |             currencies={uniqueCurrencies}
106 |             defaultCurrency={currency}
107 |           />
108 |           <ExportStatus />
109 |           <HotKeys />
110 |
111 |           <Suspense>
112 |             <GlobalSheets defaultCurrency={currency} />
113 |           </Suspense>
114 |
115 |           <Suspense>
116 |             {/* Set default user timezone and locale */}
117 |             <DefaultSettings />
118 |           </Suspense>
119 |         </AI>
120 |       </div>
121 |     </UserProvider>
122 |   );
123 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/page.tsx
```
1 | import { ChartSelectors } from "@/components/charts/chart-selectors";
2 | import { Charts } from "@/components/charts/charts";
3 | import { EmptyState } from "@/components/charts/empty-state";
4 | import { OverviewModal } from "@/components/modals/overview-modal";
5 | import { Widgets } from "@/components/widgets";
6 | import { Cookies } from "@/utils/constants";
7 | import { getTeamBankAccounts } from "@midday/supabase/cached-queries";
8 | import { cn } from "@midday/ui/cn";
9 | import { startOfMonth, startOfYear, subMonths } from "date-fns";
10 | import type { Metadata } from "next";
11 | import { cookies } from "next/headers";
12 |
13 | // NOTE: GoCardLess serverAction needs this currently
14 | // (Fetch accounts takes up to 20s and default limit is 15s)
15 | export const maxDuration = 30;
16 |
17 | export const metadata: Metadata = {
18 |   title: "Overview | Midday",
19 | };
20 |
21 | const defaultValue = {
22 |   from: subMonths(startOfMonth(new Date()), 12).toISOString(),
23 |   to: new Date().toISOString(),
24 |   period: "monthly",
25 | };
26 |
27 | export default async function Overview({ searchParams }) {
28 |   const accounts = await getTeamBankAccounts();
29 |   const chartType = cookies().get(Cookies.ChartType)?.value ?? "profit";
30 |
31 |   const hideConnectFlow = cookies().has(Cookies.HideConnectFlow);
32 |
33 |   const initialPeriod = cookies().has(Cookies.SpendingPeriod)
34 |     ? JSON.parse(cookies().get(Cookies.SpendingPeriod)?.value)
35 |     : {
36 |         id: "this_year",
37 |         from: startOfYear(new Date()).toISOString(),
38 |         to: new Date().toISOString(),
39 |       };
40 |
41 |   const value = {
42 |     ...(searchParams.from && { from: searchParams.from }),
43 |     ...(searchParams.to && { to: searchParams.to }),
44 |   };
45 |
46 |   const isEmpty = !accounts?.data?.length;
47 |
48 |   return (
49 |     <>
50 |       <div>
51 |         <div className="h-[530px] mb-4">
52 |           <ChartSelectors defaultValue={defaultValue} />
53 |
54 |           <div className="mt-8 relative">
55 |             {isEmpty && <EmptyState />}
56 |
57 |             <div className={cn(isEmpty && "blur-[8px] opacity-20")}>
58 |               <Charts
59 |                 value={value}
60 |                 defaultValue={defaultValue}
61 |                 disabled={isEmpty}
62 |                 type={chartType}
63 |                 currency={searchParams.currency}
64 |               />
65 |             </div>
66 |           </div>
67 |         </div>
68 |
69 |         <Widgets
70 |           initialPeriod={initialPeriod}
71 |           disabled={isEmpty}
72 |           searchParams={searchParams}
73 |         />
74 |       </div>
75 |
76 |       <OverviewModal defaultOpen={isEmpty && !hideConnectFlow} />
77 |     </>
78 |   );
79 | }
```

apps/dashboard/src/app/[locale]/(app)/setup/page.tsx
```
1 | import { SetupForm } from "@/components/setup-form";
2 | import { getSession, getUser } from "@midday/supabase/cached-queries";
3 | import { Icons } from "@midday/ui/icons";
4 | import type { Metadata } from "next";
5 | import Link from "next/link";
6 | import { redirect } from "next/navigation";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Setup account | Midday",
10 | };
11 |
12 | export default async function Page() {
13 |   const { data } = await getUser();
14 |
15 |   if (!data?.id) {
16 |     return redirect("/");
17 |   }
18 |
19 |   return (
20 |     <div>
21 |       <div className="absolute left-5 top-4 md:left-10 md:top-10">
22 |         <Link href="/">
23 |           <Icons.Logo />
24 |         </Link>
25 |       </div>
26 |
27 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
28 |         <div className="relative z-20 m-auto flex w-full max-w-[380px] flex-col">
29 |           <h1 className="text-2xl font-medium pb-4">Update your account</h1>
30 |           <p className="text-sm text-[#878787] mb-8">
31 |             Add your name and an optional avatar.
32 |           </p>
33 |
34 |           <SetupForm
35 |             userId={data.id}
36 |             avatarUrl={data.avatar_url}
37 |             fullName={data.full_name}
38 |           />
39 |         </div>
40 |       </div>
41 |     </div>
42 |   );
43 | }
```

apps/dashboard/src/app/[locale]/(app)/teams/page.tsx
```
1 | import { SelectTeamTable } from "@/components/tables/select-team/table";
2 | import { UserMenu } from "@/components/user-menu";
3 | import { getUser } from "@midday/supabase/cached-queries";
4 | import { getTeamsByUserIdQuery } from "@midday/supabase/queries";
5 | import { createClient } from "@midday/supabase/server";
6 | import { Icons } from "@midday/ui/icons";
7 | import type { Metadata } from "next";
8 | import Link from "next/link";
9 | import { redirect } from "next/navigation";
10 | import { Suspense } from "react";
11 |
12 | export const metadata: Metadata = {
13 |   title: "Teams | Midday",
14 | };
15 |
16 | export default async function Teams() {
17 |   const supabase = createClient();
18 |   const user = await getUser();
19 |
20 |   const teams = await getTeamsByUserIdQuery(supabase, user?.data?.id);
21 |
22 |   if (!teams?.data?.length) {
23 |     redirect("/teams/create");
24 |   }
25 |
26 |   return (
27 |     <>
28 |       <header className="w-full absolute left-0 right-0 flex justify-between items-center">
29 |         <div className="ml-5 mt-4 md:ml-10 md:mt-10">
30 |           <Link href="/">
31 |             <Icons.Logo />
32 |           </Link>
33 |         </div>
34 |
35 |         <div className="mr-5 mt-4 md:mr-10 md:mt-10">
36 |           <Suspense>
37 |             <UserMenu onlySignOut />
38 |           </Suspense>
39 |         </div>
40 |       </header>
41 |
42 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
43 |         <div className="relative z-20 m-auto flex w-full max-w-[480px] flex-col">
44 |           <div>
45 |             <h1 className="text-2xl font-medium pb-4">Welcome back</h1>
46 |             <p className="text-sm text-[#878787] mb-8">
47 |               Select team or create a new one.
48 |             </p>
49 |           </div>
50 |
51 |           <SelectTeamTable data={teams.data} />
52 |
53 |           <div className="text-center mt-8 border-t-[1px] border-border pt-6">
54 |             <Link href="/teams/create" className="text-sm">
55 |               Create team
56 |             </Link>
57 |           </div>
58 |         </div>
59 |       </div>
60 |     </>
61 |   );
62 | }
```

apps/dashboard/src/app/[locale]/(public)/all-done/event-emitter.tsx
```
1 | "use client";
2 |
3 | import { useEffect } from "react";
4 | import type { WindowEvent } from "./schema";
5 |
6 | type Props = {
7 |   event: WindowEvent;
8 | };
9 |
10 | export const EventEmitter = ({ event }: Props) => {
11 |   useEffect(() => {
12 |     if (!window?.opener) {
13 |       return;
14 |     }
15 |
16 |     if (event) {
17 |       window.opener.postMessage(event, "*");
18 |     }
19 |   }, [event]);
20 |
21 |   return null;
22 | };
```

apps/dashboard/src/app/[locale]/(public)/all-done/page.tsx
```
1 | import Image from "next/image";
2 | import { notFound } from "next/navigation";
3 | import appIcon from "public/appicon.png";
4 | import { EventEmitter } from "./event-emitter";
5 | import { searchParamsSchema } from "./schema";
6 |
7 | type Props = {
8 |   searchParams: Record<string, string | string[] | undefined>;
9 | };
10 |
11 | const AllDonePage = ({ searchParams }: Props) => {
12 |   const parsedSearchParams = searchParamsSchema.safeParse(searchParams);
13 |
14 |   if (!parsedSearchParams.success) {
15 |     notFound();
16 |   }
17 |
18 |   return (
19 |     <>
20 |       <EventEmitter event={parsedSearchParams.data.event} />
21 |       <div>
22 |         <div className="h-screen flex flex-col items-center justify-center text-center text-sm text-[#606060]">
23 |           <Image
24 |             src={appIcon}
25 |             width={80}
26 |             height={80}
27 |             alt="Midday"
28 |             quality={100}
29 |             className="mb-10"
30 |           />
31 |
32 |           <p>You may close this browser tab when done</p>
33 |         </div>
34 |       </div>
35 |     </>
36 |   );
37 | };
38 |
39 | export default AllDonePage;
```

apps/dashboard/src/app/[locale]/(public)/all-done/schema.ts
```
1 | import { z } from "zod";
2 |
3 | export const searchParamsSchema = z.object({
4 |   event: z.literal("app_oauth_completed"),
5 | });
6 |
7 | export type WindowEvent = z.infer<typeof searchParamsSchema>["event"];
```

apps/dashboard/src/app/[locale]/(public)/login/page.tsx
```
1 | import { AppleSignIn } from "@/components/apple-sign-in";
2 | import { ConsentBanner } from "@/components/consent-banner";
3 | import { DesktopCommandMenuSignIn } from "@/components/desktop-command-menu-sign-in";
4 | import { GithubSignIn } from "@/components/github-sign-in";
5 | import { GoogleSignIn } from "@/components/google-sign-in";
6 | import { OTPSignIn } from "@/components/otp-sign-in";
7 | import { SlackSignIn } from "@/components/slack-sign-in";
8 | import { Cookies } from "@/utils/constants";
9 | import { isEU } from "@midday/location";
10 | import {
11 |   Accordion,
12 |   AccordionContent,
13 |   AccordionItem,
14 |   AccordionTrigger,
15 | } from "@midday/ui/accordion";
16 | import { Icons } from "@midday/ui/icons";
17 | import type { Metadata } from "next";
18 | import { cookies, headers } from "next/headers";
19 | import Link from "next/link";
20 | import { userAgent } from "next/server";
21 |
22 | export const metadata: Metadata = {
23 |   title: "Login | Midday",
24 | };
25 |
26 | export default async function Page(params) {
27 |   if (params?.searchParams?.return_to === "desktop/command") {
28 |     return <DesktopCommandMenuSignIn />;
29 |   }
30 |
31 |   const cookieStore = cookies();
32 |   const preferred = cookieStore.get(Cookies.PreferredSignInProvider);
33 |   const showTrackingConsent =
34 |     isEU() && !cookieStore.has(Cookies.TrackingConsent);
35 |   const { device } = userAgent({ headers: headers() });
36 |
37 |   let moreSignInOptions = null;
38 |   let preferredSignInOption =
39 |     device?.vendor === "Apple" ? (
40 |       <div className="flex flex-col space-y-2">
41 |         <GoogleSignIn />
42 |         <AppleSignIn />
43 |       </div>
44 |     ) : (
45 |       <GoogleSignIn />
46 |     );
47 |
48 |   switch (preferred?.value) {
49 |     case "apple":
50 |       preferredSignInOption = <AppleSignIn />;
51 |       moreSignInOptions = (
52 |         <>
53 |           <GoogleSignIn />
54 |           <SlackSignIn />
55 |           <GithubSignIn />
56 |           <OTPSignIn className="border-t-[1px] border-border pt-8" />
57 |         </>
58 |       );
59 |       break;
60 |
61 |     case "slack":
62 |       preferredSignInOption = <SlackSignIn />;
63 |       moreSignInOptions = (
64 |         <>
65 |           <GoogleSignIn />
66 |           <AppleSignIn />
67 |           <GithubSignIn />
68 |           <OTPSignIn className="border-t-[1px] border-border pt-8" />
69 |         </>
70 |       );
71 |       break;
72 |
73 |     case "github":
74 |       preferredSignInOption = <GithubSignIn />;
75 |       moreSignInOptions = (
76 |         <>
77 |           <GoogleSignIn />
78 |           <AppleSignIn />
79 |           <SlackSignIn />
80 |           <OTPSignIn className="border-t-[1px] border-border pt-8" />
81 |         </>
82 |       );
83 |       break;
84 |
85 |     case "google":
86 |       preferredSignInOption = <GoogleSignIn />;
87 |       moreSignInOptions = (
88 |         <>
89 |           <AppleSignIn />
90 |           <GithubSignIn />
91 |           <SlackSignIn />
92 |           <OTPSignIn className="border-t-[1px] border-border pt-8" />
93 |         </>
94 |       );
95 |       break;
96 |
97 |     case "otp":
98 |       preferredSignInOption = <OTPSignIn />;
99 |       moreSignInOptions = (
100 |         <>
101 |           <GoogleSignIn />
102 |           <AppleSignIn />
103 |           <GithubSignIn />
104 |           <SlackSignIn />
105 |         </>
106 |       );
107 |       break;
108 |
109 |     default:
110 |       if (device?.vendor === "Apple") {
111 |         moreSignInOptions = (
112 |           <>
113 |             <SlackSignIn />
114 |             <GithubSignIn />
115 |             <OTPSignIn className="border-t-[1px] border-border pt-8" />
116 |           </>
117 |         );
118 |       } else {
119 |         moreSignInOptions = (
120 |           <>
121 |             <AppleSignIn />
122 |             <SlackSignIn />
123 |             <GithubSignIn />
124 |             <OTPSignIn className="border-t-[1px] border-border pt-8" />
125 |           </>
126 |         );
127 |       }
128 |   }
129 |
130 |   return (
131 |     <div>
132 |       <header className="w-full fixed left-0 right-0">
133 |         <div className="ml-5 mt-4 md:ml-10 md:mt-10">
134 |           <Link href="https://midday.ai">
135 |             <Icons.Logo />
136 |           </Link>
137 |         </div>
138 |       </header>
139 |
140 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
141 |         <div className="relative z-20 m-auto flex w-full max-w-[380px] flex-col py-8">
142 |           <div className="flex w-full flex-col relative">
143 |             <div className="pb-4 bg-gradient-to-r from-primary dark:via-primary dark:to-[#848484] to-[#000] inline-block text-transparent bg-clip-text">
144 |               <h1 className="font-medium pb-1 text-3xl">Login to midday.</h1>
145 |             </div>
146 |
147 |             <p className="font-medium pb-1 text-2xl text-[#878787]">
148 |               Automate financial tasks, <br /> stay organized, and make
149 |               <br />
150 |               informed decisions
151 |               <br /> effortlessly.
152 |             </p>
153 |
[TRUNCATED]
```

apps/dashboard/src/app/[locale]/(public)/verify/page.tsx
```
1 | import { DesktopSignInVerifyCode } from "@/components/desktop-sign-in-verify-code";
2 |
3 | export default async function Verify({ searchParams }) {
4 |   return <DesktopSignInVerifyCode code={searchParams?.code} />;
5 | }
```

apps/dashboard/src/app/api/auth/callback/route.ts
```
1 | import { Cookies } from "@/utils/constants";
2 | import { LogEvents } from "@midday/events/events";
3 | import { setupAnalytics } from "@midday/events/server";
4 | import { getSession } from "@midday/supabase/cached-queries";
5 | import { createClient } from "@midday/supabase/server";
6 | import { addYears } from "date-fns";
7 | import { cookies } from "next/headers";
8 | import { NextResponse } from "next/server";
9 | import type { NextRequest } from "next/server";
10 |
11 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
12 |
13 | export async function GET(req: NextRequest) {
14 |   const cookieStore = cookies();
15 |   const requestUrl = new URL(req.url);
16 |   const code = requestUrl.searchParams.get("code");
17 |   const client = requestUrl.searchParams.get("client");
18 |   const returnTo = requestUrl.searchParams.get("return_to");
19 |   const provider = requestUrl.searchParams.get("provider");
20 |   const mfaSetupVisited = cookieStore.has(Cookies.MfaSetupVisited);
21 |
22 |   if (client === "desktop") {
23 |     return NextResponse.redirect(`${requestUrl.origin}/verify?code=${code}`);
24 |   }
25 |
26 |   if (provider) {
27 |     cookieStore.set(Cookies.PreferredSignInProvider, provider, {
28 |       expires: addYears(new Date(), 1),
29 |     });
30 |   }
31 |
32 |   if (code) {
33 |     const supabase = createClient(cookieStore);
34 |     await supabase.auth.exchangeCodeForSession(code);
35 |
36 |     const {
37 |       data: { session },
38 |     } = await getSession();
39 |
40 |     if (session) {
41 |       const userId = session.user.id;
42 |
43 |       const analytics = await setupAnalytics({
44 |         userId,
45 |         fullName: session.user.user_metadata?.full_name,
46 |       });
47 |
48 |       await analytics.track({
49 |         event: LogEvents.SignIn.name,
50 |         channel: LogEvents.SignIn.channel,
51 |       });
52 |
53 |       // If user have no teams, redirect to team creation
54 |       const { count } = await supabase
55 |         .from("users_on_team")
56 |         .select("*", { count: "exact" })
57 |         .eq("user_id", userId);
58 |
59 |       if (count === 0 && !returnTo?.startsWith("teams/invite/")) {
60 |         return NextResponse.redirect(`${requestUrl.origin}/teams/create`);
61 |       }
62 |     }
63 |   }
64 |
65 |   if (!mfaSetupVisited) {
66 |     cookieStore.set(Cookies.MfaSetupVisited, "true", {
67 |       expires: addYears(new Date(), 1),
68 |     });
69 |
70 |     return NextResponse.redirect(`${requestUrl.origin}/mfa/setup`);
71 |   }
72 |
73 |   if (returnTo) {
74 |     return NextResponse.redirect(`${requestUrl.origin}/${returnTo}`);
75 |   }
76 |
77 |   return NextResponse.redirect(requestUrl.origin);
78 | }
```

apps/dashboard/src/app/api/download/file/route.ts
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { createClient } from "@midday/supabase/server";
3 | import { download } from "@midday/supabase/storage";
4 |
5 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
6 |
7 | export async function GET(req, res) {
8 |   const supabase = createClient();
9 |   const user = await getUser();
10 |   const requestUrl = new URL(req.url);
11 |   const path = requestUrl.searchParams.get("path");
12 |   const filename = requestUrl.searchParams.get("filename");
13 |
14 |   const { data } = await download(supabase, {
15 |     bucket: "vault",
16 |     path: `${user.data.team_id}/${path}`,
17 |   });
18 |
19 |   const responseHeaders = new Headers(res.headers);
20 |
21 |   responseHeaders.set(
22 |     "Content-Disposition",
23 |     `attachment; filename="${filename}"`,
24 |   );
25 |
26 |   return new Response(data, {
27 |     headers: responseHeaders,
28 |   });
29 | }
```

apps/dashboard/src/app/api/download/invoice/route.ts
```
1 | import { PdfTemplate, renderToStream } from "@midday/invoice";
2 | import { getInvoiceQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import type { NextRequest } from "next/server";
5 | import { z } from "zod";
6 |
7 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
8 | export const dynamic = "force-dynamic";
9 |
10 | const paramsSchema = z.object({
11 |   id: z.string().uuid(),
12 |   size: z.enum(["letter", "a4"]).default("a4"),
13 |   preview: z.preprocess((val) => val === "true", z.boolean().default(false)),
14 | });
15 |
16 | export async function GET(req: NextRequest) {
17 |   const supabase = createClient({ admin: true });
18 |   const requestUrl = new URL(req.url);
19 |
20 |   const result = paramsSchema.safeParse(
21 |     Object.fromEntries(requestUrl.searchParams.entries()),
22 |   );
23 |
24 |   if (!result.success) {
25 |     return new Response("Invalid parameters", { status: 400 });
26 |   }
27 |
28 |   const { id, size, preview } = result.data;
29 |
30 |   const { data } = await getInvoiceQuery(supabase, id);
31 |
32 |   if (!data) {
33 |     return new Response("Invoice not found", { status: 404 });
34 |   }
35 |
36 |   const stream = await renderToStream(await PdfTemplate({ ...data, size }));
37 |
38 |   const blob = await new Response(stream).blob();
39 |
40 |   const headers: Record<string, string> = {
41 |     "Content-Type": "application/pdf",
42 |     "Cache-Control": "no-store, max-age=0",
43 |   };
44 |
45 |   if (!preview) {
46 |     headers["Content-Disposition"] =
47 |       `attachment; filename="${data.invoice_number}.pdf"`;
48 |   }
49 |
50 |   return new Response(blob, { headers });
51 | }
```

apps/dashboard/src/app/api/download/zip/route.ts
```
1 | import { getUser } from "@midday/supabase/cached-queries";
2 | import { getVaultRecursiveQuery } from "@midday/supabase/queries";
3 | import { createClient } from "@midday/supabase/server";
4 | import { download } from "@midday/supabase/storage";
5 | import { BlobReader, BlobWriter, ZipWriter } from "@zip.js/zip.js";
6 | import type { NextRequest, NextResponse } from "next/server";
7 |
8 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
9 | export const dynamic = "force-dynamic";
10 |
11 | export async function GET(req: NextRequest, res: NextResponse) {
12 |   const requestUrl = new URL(req.url);
13 |   const supabase = createClient();
14 |   const user = await getUser();
15 |   const path = requestUrl.searchParams.get("path");
16 |   const filename = requestUrl.searchParams.get("filename");
17 |
18 |   const promises: any = [];
19 |
20 |   const files = await getVaultRecursiveQuery(supabase, {
21 |     teamId: user.data.team_id,
22 |     path,
23 |   });
24 |
25 |   files.forEach((file) => {
26 |     promises.push(
27 |       download(supabase, {
28 |         bucket: "vault",
29 |         path: `${file.basePath}/${file.name}`,
30 |       }),
31 |     );
32 |   });
33 |
34 |   const response = await Promise.allSettled(promises);
35 |
36 |   const zipFileWriter = new BlobWriter("application/zip");
37 |   const zipWriter = new ZipWriter(zipFileWriter, { bufferedWrite: true });
38 |
39 |   const downloadedFiles = response.map((result, index) => {
40 |     if (result.status === "fulfilled") {
41 |       return {
42 |         name: files[index].name,
43 |         blob: result.value.data,
44 |       };
45 |     }
46 |   });
47 |
48 |   downloadedFiles.forEach((downloadedFile) => {
49 |     if (downloadedFile?.blob) {
50 |       zipWriter.add(downloadedFile.name, new BlobReader(downloadedFile.blob));
51 |     }
52 |   });
53 |
54 |   const responseHeaders = new Headers(res.headers);
55 |
56 |   responseHeaders.set(
57 |     "Content-Disposition",
58 |     `attachment; filename="${filename}.zip"`,
59 |   );
60 |
61 |   const data = await zipWriter.close();
62 |
63 |   return new Response(data, {
64 |     headers: responseHeaders,
65 |   });
66 | }
```

apps/dashboard/src/app/api/gocardless/reconnect/route.ts
```
1 | import { getSession } from "@midday/supabase/cached-queries";
2 | import { updateBankConnection } from "@midday/supabase/mutations";
3 | import { createClient } from "@midday/supabase/server";
4 | import { revalidateTag } from "next/cache";
5 | import { type NextRequest, NextResponse } from "next/server";
6 |
7 | export const dynamic = "force-dynamic";
8 | export const preferredRegion = ["fra1", "sfo1", "iad1"];
9 |
10 | export async function GET(req: NextRequest) {
11 |   const {
12 |     data: { session },
13 |   } = await getSession();
14 |
15 |   if (!session) {
16 |     return NextResponse.redirect(new URL("/", req.url));
17 |   }
18 |
19 |   const supabase = createClient();
20 |   const requestUrl = new URL(req.url);
21 |   const id = requestUrl.searchParams.get("id");
22 |   const referenceId = requestUrl.searchParams.get("reference_id") ?? undefined;
23 |   const isDesktop = requestUrl.searchParams.get("desktop");
24 |
25 |   if (id) {
26 |     const { data } = await updateBankConnection(supabase, { id, referenceId });
27 |     revalidateTag(`bank_connections_${data?.team_id}`);
28 |   }
29 |
30 |   if (isDesktop === "true") {
31 |     return NextResponse.redirect(
32 |       `midday://settings/accounts?id=${id}&step=reconnect`,
33 |     );
34 |   }
35 |
36 |   return NextResponse.redirect(
37 |     `${requestUrl.origin}/settings/accounts?id=${id}&step=reconnect`,
38 |   );
39 | }
```

apps/dashboard/src/app/api/webhook/inbox/route.ts
```
1 | import { env } from "@/env.mjs";
2 | import { logger } from "@/utils/logger";
3 | import { getAllowedAttachments, prepareDocument } from "@midday/documents";
4 | import { LogEvents } from "@midday/events/events";
5 | import { setupAnalytics } from "@midday/events/server";
6 | import { getInboxIdFromEmail, inboxWebhookPostSchema } from "@midday/inbox";
7 | import { client as RedisClient } from "@midday/kv";
8 | import { createClient } from "@midday/supabase/server";
9 | import { inboxDocument } from "jobs/tasks/inbox/document";
10 | import { nanoid } from "nanoid";
11 | import { headers } from "next/headers";
12 | import { NextResponse } from "next/server";
13 | import { Resend } from "resend";
14 |
15 | export const runtime = "nodejs";
16 | export const maxDuration = 300; // 5min
17 |
18 | // https://postmarkapp.com/support/article/800-ips-for-firewalls#webhooks
19 | const ipRange = [
20 |   "3.134.147.250",
21 |   "50.31.156.6",
22 |   "50.31.156.77",
23 |   "18.217.206.57",
24 | ];
25 |
26 | const FORWARD_FROM_EMAIL = "inbox@midday.ai";
27 |
28 | const resend = new Resend(env.RESEND_API_KEY);
29 |
30 | export async function POST(req: Request) {
31 |   const clientIp = headers().get("x-forwarded-for") ?? "";
32 |
33 |   if (
34 |     process.env.NODE_ENV !== "development" &&
35 |     (!clientIp || !ipRange.includes(clientIp))
36 |   ) {
37 |     return NextResponse.json({ error: "Invalid IP address" }, { status: 403 });
38 |   }
39 |
40 |   const parsedBody = inboxWebhookPostSchema.safeParse(await req.json());
41 |
42 |   if (!parsedBody.success) {
43 |     const errors = parsedBody.error.errors.map((error) => ({
44 |       path: error.path.join("."),
45 |       message: error.message,
46 |     }));
47 |
48 |     return NextResponse.json(
49 |       { error: "Invalid request body", errors },
50 |       { status: 400 },
51 |     );
52 |   }
53 |
54 |   const {
55 |     MessageID,
56 |     FromFull,
57 |     Subject,
58 |     Attachments,
59 |     TextBody,
60 |     HtmlBody,
61 |     OriginalRecipient,
62 |   } = parsedBody.data;
63 |
64 |   const inboxId = getInboxIdFromEmail(OriginalRecipient);
65 |
66 |   if (!inboxId) {
67 |     return NextResponse.json(
68 |       { error: "Invalid OriginalRecipient email" },
69 |       { status: 400 },
70 |     );
71 |   }
72 |
73 |   // Ignore emails from our own domain to fix infinite loop
74 |   if (FromFull.Email === FORWARD_FROM_EMAIL) {
75 |     return NextResponse.json({ success: true });
76 |   }
77 |
78 |   const supabase = createClient({ admin: true });
79 |
80 |   try {
81 |     const { data: teamData } = await supabase
82 |       .from("teams")
83 |       .select("id, inbox_email, inbox_forwarding")
84 |       .eq("inbox_id", inboxId)
85 |       .single()
86 |       .throwOnError();
87 |
88 |     const analytics = await setupAnalytics();
89 |
90 |     analytics.track({
91 |       event: LogEvents.InboxInbound.name,
92 |       channel: LogEvents.InboxInbound.channel,
93 |     });
94 |
95 |     const teamId = teamData?.id;
96 |
97 |     const fallbackName = Subject ?? FromFull?.Name;
98 |     const forwardEmail = teamData?.inbox_email;
99 |     const forwardingEnabled = teamData?.inbox_forwarding && forwardEmail;
100 |
101 |     if (forwardingEnabled) {
102 |       const messageKey = `message-id:${MessageID}`;
103 |       const isForwarded = await RedisClient.exists(messageKey);
104 |
105 |       if (!isForwarded) {
106 |         const { error } = await resend.emails.send({
107 |           from: `${FromFull?.Name} <${FORWARD_FROM_EMAIL}>`,
108 |           to: [forwardEmail],
109 |           subject: fallbackName,
110 |           text: TextBody,
111 |           html: HtmlBody,
112 |           attachments: Attachments?.map((a) => ({
113 |             filename: a.Name,
114 |             content: a.Content,
115 |           })),
116 |           react: null,
117 |           headers: {
118 |             "X-Entity-Ref-ID": nanoid(),
119 |           },
120 |         });
121 |
122 |         if (!error) {
123 |           await RedisClient.set(messageKey, true, { ex: 9600 });
124 |         }
125 |       }
126 |     }
127 |
128 |     const allowedAttachments = getAllowedAttachments(Attachments);
129 |
130 |     // If no attachments we just want to forward the email
131 |     if (!allowedAttachments?.length && forwardEmail) {
132 |       const messageKey = `message-id:${MessageID}`;
133 |       const isForwarded = await RedisClient.exists(messageKey);
134 |
135 |       if (!isForwarded) {
136 |         const { error } = await resend.emails.send({
137 |           from: `${FromFull?.Name} <${FORWARD_FROM_EMAIL}>`,
138 |           to: [forwardEmail],
139 |           subject: fallbackName,
140 |           text: TextBody,
141 |           html: HtmlBody,
142 |           attachments: Attachments?.map((a) => ({
143 |             filename: a.Name,
144 |             content: a.Content,
145 |           })),
146 |           react: null,
147 |           headers: {
148 |             "X-Entity-Ref-ID": nanoid(),
149 |           },
150 |         });
151 |
152 |         if (!error) {
153 |           await RedisClient.set(messageKey, true, { ex: 9600 });
154 |         }
155 |       }
156 |
157 |       return NextResponse.json({
158 |         success: true,
159 |       });
160 |     }
161 |
162 |     // Transform and upload files, filtering out attachments smaller than 100kb except PDFs
[TRUNCATED]
```

apps/dashboard/src/app/api/webhook/plaid/route.ts
```
1 | import { logger } from "@/utils/logger";
2 | import { createClient } from "@midday/supabase/server";
3 | import { isAfter, subDays } from "date-fns";
4 | import { syncConnection } from "jobs/tasks/bank/sync/connection";
5 | import { type NextRequest, NextResponse } from "next/server";
6 | import { z } from "zod";
7 |
8 | // https://plaid.com/docs/api/webhooks/#configuring-webhooks
9 | const ALLOWED_IPS = [
10 |   "52.21.26.131",
11 |   "52.21.47.157",
12 |   "52.41.247.19",
13 |   "52.88.82.239",
14 | ];
15 |
16 | const webhookSchema = z.object({
17 |   webhook_type: z.enum([
18 |     "TRANSACTIONS",
19 |     "HISTORICAL_UPDATE",
20 |     "INITIAL_UPDATE",
21 |     "TRANSACTIONS_REMOVED",
22 |   ]),
23 |   webhook_code: z.enum(["SYNC_UPDATES_AVAILABLE", "HISTORICAL_UPDATE"]),
24 |   item_id: z.string(),
25 |   error: z
26 |     .object({
27 |       error_type: z.string(),
28 |       error_code: z.string(),
29 |       error_code_reason: z.string(),
30 |       error_message: z.string(),
31 |       display_message: z.string(),
32 |       request_id: z.string(),
33 |       causes: z.array(z.string()),
34 |       status: z.number(),
35 |     })
36 |     .nullable(),
37 |   new_transactions: z.number().optional(),
38 |   environment: z.enum(["sandbox", "production"]),
39 | });
40 |
41 | export async function POST(req: NextRequest) {
42 |   const clientIp = req.headers.get("x-forwarded-for") || "";
43 |
44 |   if (!ALLOWED_IPS.includes(clientIp)) {
45 |     return NextResponse.json(
46 |       { error: "Unauthorized IP address" },
47 |       { status: 403 },
48 |     );
49 |   }
50 |
51 |   const body = await req.json();
52 |
53 |   const result = webhookSchema.safeParse(body);
54 |
55 |   if (!result.success) {
56 |     logger("Invalid plaid webhook payload", {
57 |       details: result.error.issues,
58 |     });
59 |
60 |     return NextResponse.json(
61 |       { error: "Invalid webhook payload", details: result.error.issues },
62 |       { status: 400 },
63 |     );
64 |   }
65 |
66 |   const supabase = createClient({ admin: true });
67 |
68 |   const { data: connectionData } = await supabase
69 |     .from("bank_connections")
70 |     .select("id, created_at")
71 |     .eq("reference_id", result.data.item_id)
72 |     .single();
73 |
74 |   if (!connectionData) {
75 |     return NextResponse.json(
76 |       { error: "Connection not found" },
77 |       { status: 404 },
78 |     );
79 |   }
80 |
81 |   switch (result.data.webhook_type) {
82 |     case "TRANSACTIONS": {
83 |       // Only run manual sync if the historical update is complete and the connection was created in the last 24 hours
84 |       const manualSync =
85 |         result.data.webhook_code === "HISTORICAL_UPDATE" &&
86 |         isAfter(new Date(connectionData.created_at), subDays(new Date(), 1));
87 |
88 |       logger("Triggering manual sync", {
89 |         connectionId: connectionData.id,
90 |         manualSync,
91 |       });
92 |
93 |       await syncConnection.trigger({
94 |         connectionId: connectionData.id,
95 |         manualSync,
96 |       });
97 |
98 |       break;
99 |     }
100 |   }
101 |
102 |   return NextResponse.json({ success: true });
103 | }
```

apps/dashboard/src/app/api/webhook/registered/route.ts
```
1 | import * as crypto from "node:crypto";
2 | import { env } from "@/env.mjs";
3 | import { logger } from "@/utils/logger";
4 | import { resend } from "@/utils/resend";
5 | import WelcomeEmail from "@midday/email/emails/welcome";
6 | import { LogEvents } from "@midday/events/events";
7 | import { setupAnalytics } from "@midday/events/server";
8 | import { render } from "@react-email/render";
9 | import { nanoid } from "nanoid";
10 | import { headers } from "next/headers";
11 | import { NextResponse } from "next/server";
12 |
13 | export const dynamic = "force-dynamic";
14 |
15 | // NOTE: This is trigger from supabase database webhook
16 | export async function POST(req: Request) {
17 |   const text = await req.clone().text();
18 |   const signature = headers().get("x-supabase-signature");
19 |
20 |   if (!signature) {
21 |     return NextResponse.json({ message: "Missing signature" }, { status: 401 });
22 |   }
23 |
24 |   const decodedSignature = Buffer.from(signature, "base64");
25 |
26 |   const calculatedSignature = crypto
27 |     .createHmac("sha256", process.env.WEBHOOK_SECRET_KEY!)
28 |     .update(text)
29 |     .digest();
30 |
31 |   const hmacMatch = crypto.timingSafeEqual(
32 |     decodedSignature,
33 |     calculatedSignature,
34 |   );
35 |
36 |   if (!hmacMatch) {
37 |     return NextResponse.json({ message: "Not Authorized" }, { status: 401 });
38 |   }
39 |
40 |   const body = await req.json();
41 |
42 |   const email = body.record.email;
43 |   const userId = body.record.id;
44 |   const fullName = body.record.raw_user_meta_data.full_name;
45 |
46 |   const analytics = await setupAnalytics({
47 |     userId,
48 |     fullName,
49 |   });
50 |
51 |   analytics.track({
52 |     event: LogEvents.Registered.name,
53 |     channel: LogEvents.Registered.channel,
54 |   });
55 |
56 |   if (fullName) {
57 |     await resend.emails.send({
58 |       to: email,
59 |       subject: "Welcome to Midday",
60 |       from: "Pontus from Midday <pontus@midday.ai>",
61 |       html: await render(
62 |         WelcomeEmail({
63 |           fullName,
64 |         }),
65 |       ),
66 |       headers: {
67 |         "X-Entity-Ref-ID": nanoid(),
68 |       },
69 |     });
70 |   }
71 |
72 |   try {
73 |     const [firstName, lastName] = fullName?.split(" ") ?? [];
74 |
75 |     await resend.contacts.create({
76 |       email,
77 |       firstName,
78 |       lastName,
79 |       unsubscribed: false,
80 |       audienceId: env.RESEND_AUDIENCE_ID,
81 |     });
82 |   } catch (error) {
83 |     logger(error as string);
84 |   }
85 |
86 |   return NextResponse.json({ success: true });
87 | }
```

apps/dashboard/src/app/api/webhook/teller/route.ts
```
1 | import { validateTellerSignature } from "@/utils/teller";
2 | import { createClient } from "@midday/supabase/server";
3 | import { isAfter, subDays } from "date-fns";
4 | import { syncConnection } from "jobs/tasks/bank/sync/connection";
5 | import { type NextRequest, NextResponse } from "next/server";
6 | import { z } from "zod";
7 |
8 | const webhookSchema = z.object({
9 |   id: z.string(),
10 |   payload: z.object({
11 |     enrollment_id: z.string().optional(),
12 |     reason: z.string().optional(),
13 |   }),
14 |   timestamp: z.string(),
15 |   type: z.enum([
16 |     "enrollment.disconnected",
17 |     "transactions.processed",
18 |     "account.number_verification.processed",
19 |     "webhook.test",
20 |   ]),
21 | });
22 |
23 | export async function POST(req: NextRequest) {
24 |   const text = await req.clone().text();
25 |   const body = await req.json();
26 |
27 |   const signatureValid = validateTellerSignature({
28 |     signatureHeader: req.headers.get("teller-signature"),
29 |     text,
30 |   });
31 |
32 |   if (!signatureValid) {
33 |     return NextResponse.json(
34 |       { error: "Invalid webhook signature" },
35 |       { status: 401 },
36 |     );
37 |   }
38 |
39 |   // Parse and validate webhook body
40 |   const result = webhookSchema.safeParse(body);
41 |
42 |   if (!result.success) {
43 |     return NextResponse.json(
44 |       { error: "Invalid webhook payload", details: result.error.issues },
45 |       { status: 400 },
46 |     );
47 |   }
48 |
49 |   const { type, payload } = result.data;
50 |
51 |   if (type === "webhook.test") {
52 |     return NextResponse.json({ success: true });
53 |   }
54 |
55 |   if (!payload.enrollment_id) {
56 |     return NextResponse.json(
57 |       { error: "Missing enrollment_id" },
58 |       { status: 400 },
59 |     );
60 |   }
61 |
62 |   const supabase = createClient({ admin: true });
63 |
64 |   const { data: connectionData } = await supabase
65 |     .from("bank_connections")
66 |     .select("id, created_at")
67 |     .eq("enrollment_id", payload.enrollment_id)
68 |     .single();
69 |
70 |   if (!connectionData) {
71 |     return NextResponse.json(
72 |       { error: "Connection not found" },
73 |       { status: 404 },
74 |     );
75 |   }
76 |
77 |   switch (type) {
78 |     case "transactions.processed":
79 |       {
80 |         // Only run manual sync if the connection was created in the last 24 hours
81 |         const manualSync = isAfter(
82 |           new Date(connectionData.created_at),
83 |           subDays(new Date(), 1),
84 |         );
85 |
86 |         await syncConnection.trigger({
87 |           connectionId: connectionData.id,
88 |           manualSync,
89 |         });
90 |       }
91 |       break;
92 |   }
93 |
94 |   return NextResponse.json({ success: true });
95 | }
```

packages/app-store/src/slack/lib/events/file/index.ts
```
1 | export * from "./share";
```

packages/app-store/src/slack/lib/events/file/share.ts
```
1 | import { inboxSlackUpload } from "@midday/dashboard/jobs/tasks/inbox/slack-upload";
2 | import type { FileShareMessageEvent } from "@slack/web-api";
3 |
4 | export async function fileShare(
5 |   event: FileShareMessageEvent,
6 |   { teamId, token }: { teamId: string; token: string },
7 | ) {
8 |   const files = event?.files?.map((file) => ({
9 |     id: file.id,
10 |     name: file.name,
11 |     mimetype: file.mimetype,
12 |     size: file.size,
13 |     url: file.url_private_download,
14 |   }));
15 |
16 |   if (files && files.length > 0) {
17 |     await inboxSlackUpload.batchTrigger(
18 |       files.map((file) => ({
19 |         payload: {
20 |           teamId,
21 |           token,
22 |           channelId: event.channel,
23 |           threadId: event.thread_ts,
24 |           file: {
25 |             id: file.id,
26 |             name: file.name!,
27 |             mimetype: file.mimetype,
28 |             size: file.size,
29 |             url: file.url!,
30 |           },
31 |         },
32 |       })),
33 |     );
34 |   }
35 | }
```

packages/app-store/src/slack/lib/events/thread/index.ts
```
1 | export * from "./message";
2 | export * from "./started";
```

packages/app-store/src/slack/lib/events/thread/message.ts
```
1 | import { openai } from "@ai-sdk/openai";
2 | import { createClient } from "@midday/supabase/server";
3 | import type { AssistantThreadStartedEvent, WebClient } from "@slack/web-api";
4 | import { generateText } from "ai";
5 | import { startOfMonth, subMonths } from "date-fns";
6 | import {
7 |   getBurnRateTool,
8 |   getRunwayTool,
9 |   getSpendingTool,
10 |   systemPrompt,
11 | } from "../../tools";
12 | import { getProfitTool } from "../../tools/get-profit";
13 | import { getRevenueTool } from "../../tools/get-revenue";
14 |
15 | const defaultValues = {
16 |   from: subMonths(startOfMonth(new Date()), 12).toISOString(),
17 |   to: new Date().toISOString(),
18 | };
19 |
20 | export async function assistantThreadMessage(
21 |   event: AssistantThreadStartedEvent,
22 |   client: WebClient,
23 |   { teamId }: { teamId: string },
24 | ) {
25 |   const supabase = createClient({ admin: true });
26 |
27 |   // Update the status of the thread
28 |   await client.assistant.threads.setStatus({
29 |     channel_id: event.channel,
30 |     thread_ts: event.thread_ts,
31 |     status: "Is thinking...",
32 |   });
33 |
34 |   const threadHistory = await client.conversations.replies({
35 |     channel: event.channel,
36 |     ts: event.thread_ts,
37 |     limit: 5,
38 |     inclusive: true,
39 |   });
40 |
41 |   const lastTwoMessages = threadHistory.messages
42 |     ?.map((msg) => ({
43 |       role: msg.bot_id ? "assistant" : "user",
44 |       content: msg.text || "",
45 |     }))
46 |     .reverse();
47 |
48 |   if (!lastTwoMessages || lastTwoMessages.length === 0) {
49 |     console.warn("No messages found in the thread");
50 |   }
51 |
52 |   const { text } = await generateText({
53 |     model: openai("gpt-4o-mini"),
54 |     maxToolRoundtrips: 5,
55 |     system: systemPrompt,
56 |     messages: [
57 |       ...(lastTwoMessages ?? []),
58 |       {
59 |         role: "user",
60 |         content: event.text,
61 |       },
62 |     ],
63 |     tools: {
64 |       getRunway: getRunwayTool({
65 |         defaultValues,
66 |         supabase,
67 |         teamId,
68 |       }),
69 |       getBurnRate: getBurnRateTool({
70 |         defaultValues,
71 |         supabase,
72 |         teamId,
73 |       }),
74 |       getSpending: getSpendingTool({
75 |         defaultValues,
76 |         supabase,
77 |         teamId,
78 |       }),
79 |       getProfit: getProfitTool({
80 |         defaultValues,
81 |         supabase,
82 |         teamId,
83 |       }),
84 |       getRevenue: getRevenueTool({
85 |         defaultValues,
86 |         supabase,
87 |         teamId,
88 |       }),
89 |     },
90 |   });
91 |
92 |   if (text) {
93 |     // Send the message to the thread
94 |     await client.chat.postMessage({
95 |       channel: event.channel,
96 |       thread_ts: event.thread_ts,
97 |       blocks: [
98 |         {
99 |           type: "section",
100 |           text: {
101 |             type: "mrkdwn",
102 |             text: text,
103 |           },
104 |         },
105 |       ],
106 |     });
107 |   } else {
108 |     // If no previous message found, post the new message
109 |     await client.chat.postMessage({
110 |       channel: event.channel,
111 |       thread_ts: event.thread_ts,
112 |       text: "Sorry I couldn't find an answer to that question",
113 |     });
114 |
115 |     await client.assistant.threads.setStatus({
116 |       channel_id: event.channel,
117 |       thread_ts: event.thread_ts,
118 |       status: "",
119 |     });
120 |   }
121 | }
```

packages/app-store/src/slack/lib/events/thread/started.ts
```
1 | import type { AssistantThreadStartedEvent, WebClient } from "@slack/web-api";
2 |
3 | export async function assistantThreadStarted(
4 |   event: AssistantThreadStartedEvent,
5 |   client: WebClient,
6 | ) {
7 |   const prompts = [
8 |     {
9 |       title: "What's my profit?",
10 |       message: "What's my profit?",
11 |     },
12 |     {
13 |       title: "What did I spend on software last month?",
14 |       message: "How much did I spend on software last month?",
15 |     },
16 |     {
17 |       title: "What's my burn rate?",
18 |       message: "What's my burn rate?",
19 |     },
20 |     {
21 |       title: "What's my runway?",
22 |       message: "What's my runway?",
23 |     },
24 |     {
25 |       title: "What's my revenue?",
26 |       message: "What's my revenue?",
27 |     },
28 |   ];
29 |
30 |   try {
31 |     // Post welcome message
32 |     await client.chat.postMessage({
33 |       channel: event.assistant_thread.channel_id,
34 |       thread_ts: event.assistant_thread.thread_ts,
35 |       text: "Welcome! I'm your financial assistant. Here are some suggestions on what you can do:",
36 |     });
37 |
38 |     // Set suggested prompts
39 |     await client.assistant.threads.setSuggestedPrompts({
40 |       channel_id: event.assistant_thread.channel_id,
41 |       thread_ts: event.assistant_thread.thread_ts,
42 |       prompts: prompts.sort(() => 0.5 - Math.random()).slice(0, 4),
43 |     });
44 |   } catch (error) {
45 |     console.error("Error handling assistant thread start:", error);
46 |     // Set an error status if something goes wrong
47 |     await client.assistant.threads.setStatus({
48 |       channel_id: event.assistant_thread.channel_id,
49 |       thread_ts: event.assistant_thread.thread_ts,
50 |       status: "Something went wrong",
51 |     });
52 |   }
53 | }
```

packages/ui/src/components/editor/extentions/ai/ask-ai.tsx
```
1 | "use client";
2 |
3 | import { MdOutlineAutoAwesome } from "react-icons/md";
4 | import { BubbleMenuButton } from "../bubble-menu/bubble-menu-button";
5 |
6 | type Props = {
7 |   onSelect: () => void;
8 | };
9 |
10 | export function AskAI({ onSelect }: Props) {
11 |   return (
12 |     <BubbleMenuButton
13 |       action={onSelect}
14 |       isActive={false}
15 |       className="flex space-x-2 items-center"
16 |     >
17 |       <MdOutlineAutoAwesome className="size-4" />
18 |     </BubbleMenuButton>
19 |   );
20 | }
```

packages/ui/src/components/editor/extentions/ai/example-action.ts
```
1 | "use server";
2 |
3 | import { openai } from "@ai-sdk/openai";
4 | import { streamText } from "ai";
5 | import { createStreamableValue } from "ai/rsc";
6 |
7 | type Params = {
8 |   input: string;
9 |   context?: string;
10 | };
11 |
12 | export async function generateEditorContent({ input, context }: Params) {
13 |   const stream = createStreamableValue("");
14 |
15 |   (async () => {
16 |     const { textStream } = await streamText({
17 |       model: openai("gpt-4o-mini"),
18 |       prompt: input,
19 |       temperature: 0.8,
20 |       system: `
21 |         You are an expert AI assistant specializing in content generation and improvement. Your task is to enhance or modify text based on specific instructions. Follow these guidelines:
22 |
23 |         1. Language: Always respond in the same language as the input prompt.
24 |         2. Conciseness: Keep responses brief and precise, with a maximum of 200 characters.
25 |
26 |         Format your response as plain text, using '\n' for line breaks when necessary.
27 |         Do not include any titles or headings in your response.
28 |         Begin your response directly with the relevant text or information.
29 |       ${context}
30 | `,
31 |     });
32 |
33 |     for await (const delta of textStream) {
34 |       stream.update(delta);
35 |     }
36 |
37 |     stream.done();
38 |   })();
39 |
40 |   return { output: stream.value };
41 | }
```

packages/ui/src/components/editor/extentions/ai/index.tsx
```
1 | "use client";
2 |
3 | import type { Editor } from "@tiptap/react";
4 | import { useClickAway } from "@uidotdev/usehooks";
5 | import { readStreamableValue } from "ai/rsc";
6 | import { motion } from "framer-motion";
7 | import { useState } from "react";
8 | import {
9 |   MdOutlineAutoAwesome,
10 |   MdOutlineCloseFullscreen,
11 |   MdOutlineSpellcheck,
12 |   MdOutlineWrapText,
13 | } from "react-icons/md";
14 | import { BubbleMenuButton } from "../bubble-menu/bubble-menu-button";
15 | import { generateEditorContent } from "./example-action";
16 |
17 | const selectors = [
18 |   {
19 |     name: "Grammar",
20 |     icon: MdOutlineSpellcheck,
21 |     instructions:
22 |       "Fix grammar: Rectify any grammatical errors while preserving the original meaning.",
23 |   },
24 |   {
25 |     name: "Improve",
26 |     icon: MdOutlineWrapText,
27 |     instructions:
28 |       "Improve text: Refine the text to improve clarity and professionalism.",
29 |   },
30 |   {
31 |     name: "Condense",
32 |     icon: MdOutlineCloseFullscreen,
33 |     instructions:
34 |       "Condense text: Remove any unnecessary text and only keep the invoice-related content and make it more concise.",
35 |   },
36 | ];
37 |
38 | interface AIMenuProps {
39 |   editor: Editor;
40 |   onOpenChange: (open: boolean) => void;
41 | }
42 |
43 | function formatEditorContent(content: string): string {
44 |   return content.replace(/\n/g, "<br />");
45 | }
46 |
47 | export function AIMenu({ onOpenChange, editor }: AIMenuProps) {
48 |   const [isTypingPrompt, setIsTypingPrompt] = useState(false);
49 |
50 |   const ref = useClickAway<HTMLDivElement>(() => {
51 |     onOpenChange(false);
52 |     setIsTypingPrompt(false);
53 |   });
54 |
55 |   const handleGenerate = async (instructions: string) => {
56 |     const selectedText = editor?.state.doc.textBetween(
57 |       editor?.state.selection?.from,
58 |       editor?.state.selection?.to,
59 |       "",
60 |     );
61 |
62 |     if (!selectedText) {
63 |       return;
64 |     }
65 |
66 |     try {
67 |       const { output } = await generateEditorContent({
68 |         input: selectedText,
69 |         context: instructions,
70 |       });
71 |
72 |       let generatedContent = "";
73 |       for await (const delta of readStreamableValue(output)) {
74 |         generatedContent += delta;
75 |         editor?.commands.insertContent(formatEditorContent(delta ?? ""));
76 |       }
77 |     } catch (error) {
78 |       console.error("Error generating content:", error);
79 |     } finally {
80 |       onOpenChange(false);
81 |     }
82 |   };
83 |
84 |   return (
85 |     <div ref={ref} className="flex whitespace-nowrap divide-x">
86 |       <motion.div
87 |         initial={{ opacity: 0, y: 10 }}
88 |         animate={{ opacity: 1, y: 0 }}
89 |         transition={{ duration: 0.2 }}
90 |       >
91 |         {isTypingPrompt ? (
92 |           <div className="relative">
93 |             <input
94 |               autoFocus
95 |               placeholder="Type your prompt…"
96 |               onBlur={() => setIsTypingPrompt(false)}
97 |               className="w-[280px] text-[11px] border-none px-4 h-8 bg-background focus:outline-none"
98 |               onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {
99 |                 if (e.key === "Enter") {
100 |                   e.preventDefault();
101 |                   onOpenChange(false);
102 |                   handleGenerate(`Custom prompt: ${e.currentTarget.value}`);
103 |                 }
104 |               }}
105 |             />
106 |             <kbd className="pointer-events-none h-5 select-none items-center gap-1 px-1.5 font-mono text-[13px] font-medium absolute right-2 top-1/2 -translate-y-1/2">
107 |               <span>↵</span>
108 |             </kbd>
109 |           </div>
110 |         ) : (
111 |           <BubbleMenuButton
112 |             action={() => setIsTypingPrompt(true)}
113 |             isActive={false}
114 |           >
115 |             <div className="flex items-center space-x-1">
116 |               <MdOutlineAutoAwesome className="size-3" />
117 |               <span className="text-[11px] font-mono">Ask AI</span>
118 |             </div>
119 |           </BubbleMenuButton>
120 |         )}
121 |       </motion.div>
122 |
123 |       {!isTypingPrompt &&
124 |         selectors.map((selector, index) => (
125 |           <motion.div
126 |             key={selector.name}
127 |             initial={{ opacity: 0, y: 10 }}
128 |             animate={{ opacity: 1, y: 0 }}
129 |             transition={{ duration: 0.2, delay: (index + 1) * 0.05 }}
130 |           >
131 |             <BubbleMenuButton
132 |               action={() => handleGenerate(selector.instructions)}
133 |               isActive={false}
134 |             >
135 |               <div className="flex items-center space-x-1">
136 |                 <selector.icon className="size-3" />
137 |                 <span>{selector.name}</span>
138 |               </div>
139 |             </BubbleMenuButton>
140 |           </motion.div>
141 |         ))}
142 |     </div>
143 |   );
144 | }
```

packages/ui/src/components/editor/extentions/bubble-menu/bubble-item.tsx
```
1 | "use client";
2 |
3 | import type { Editor } from "@tiptap/react";
4 | import { BubbleMenuButton } from "./bubble-menu-button";
5 |
6 | interface BubbleItemProps {
7 |   editor: Editor;
8 |   action: () => void;
9 |   isActive: boolean;
10 |   children: React.ReactNode;
11 | }
12 |
13 | export function BubbleMenuItem({
14 |   editor,
15 |   action,
16 |   isActive,
17 |   children,
18 | }: BubbleItemProps) {
19 |   return (
20 |     <BubbleMenuButton
21 |       action={() => {
22 |         editor.chain().focus();
23 |         action();
24 |       }}
25 |       isActive={isActive}
26 |     >
27 |       {children}
28 |     </BubbleMenuButton>
29 |   );
30 | }
```

packages/ui/src/components/editor/extentions/bubble-menu/bubble-menu-button.tsx
```
1 | "use client";
2 |
3 | interface BubbleMenuButtonProps {
4 |   action: () => void;
5 |   isActive: boolean;
6 |   children: React.ReactNode;
7 |   className?: string;
8 | }
9 |
10 | export function BubbleMenuButton({
11 |   action,
12 |   isActive,
13 |   children,
14 |   className,
15 | }: BubbleMenuButtonProps) {
16 |   return (
17 |     <button
18 |       type="button"
19 |       onClick={action}
20 |       className={`px-2.5 py-1.5 text-[11px] font-mono transition-colors ${className} ${
21 |         isActive
22 |           ? "bg-white dark:bg-stone-900 text-primary"
23 |           : "bg-transparent hover:bg-muted"
24 |       }`}
25 |     >
26 |       {children}
27 |     </button>
28 |   );
29 | }
```

packages/ui/src/components/editor/extentions/bubble-menu/index.tsx
```
1 | import { type Editor, BubbleMenu as TiptapBubbleMenu } from "@tiptap/react";
2 | import { useState } from "react";
3 | import {
4 |   MdOutlineFormatBold,
5 |   MdOutlineFormatItalic,
6 |   MdOutlineFormatStrikethrough,
7 | } from "react-icons/md";
8 | import type { Props as TippyOptions } from "tippy.js";
9 | import { AIMenu } from "../ai";
10 | import { AskAI } from "../ai/ask-ai";
11 | import { BubbleMenuItem } from "./bubble-item";
12 | import { LinkItem } from "./link-item";
13 |
14 | export function BubbleMenu({
15 |   editor,
16 |   tippyOptions,
17 | }: {
18 |   editor: Editor;
19 |   tippyOptions?: TippyOptions;
20 | }) {
21 |   const [showAI, setShowAI] = useState(false);
22 |   const [openLink, setOpenLink] = useState(false);
23 |
24 |   if (!editor) {
25 |     return null;
26 |   }
27 |
28 |   return (
29 |     <div>
30 |       <TiptapBubbleMenu editor={editor} tippyOptions={tippyOptions}>
31 |         <div className="flex w-fit max-w-[90vw] overflow-hidden rounded-full border border-border bg-background text-mono font-regular">
32 |           {showAI ? (
33 |             <AIMenu onOpenChange={setShowAI} editor={editor} />
34 |           ) : (
35 |             <>
36 |               <AskAI onSelect={() => setShowAI(true)} />
37 |
38 |               <BubbleMenuItem
39 |                 editor={editor}
40 |                 action={() => editor.chain().focus().toggleBold().run()}
41 |                 isActive={editor.isActive("bold")}
42 |               >
43 |                 <MdOutlineFormatBold className="size-4" />
44 |                 <span className="sr-only">Bold</span>
45 |               </BubbleMenuItem>
46 |
47 |               <BubbleMenuItem
48 |                 editor={editor}
49 |                 action={() => editor.chain().focus().toggleItalic().run()}
50 |                 isActive={editor.isActive("italic")}
51 |               >
52 |                 <MdOutlineFormatItalic className="size-4" />
53 |                 <span className="sr-only">Italic</span>
54 |               </BubbleMenuItem>
55 |
56 |               <BubbleMenuItem
57 |                 editor={editor}
58 |                 action={() => editor.chain().focus().toggleStrike().run()}
59 |                 isActive={editor.isActive("strike")}
60 |               >
61 |                 <MdOutlineFormatStrikethrough className="size-4" />
62 |                 <span className="sr-only">Strike</span>
63 |               </BubbleMenuItem>
64 |
65 |               <LinkItem editor={editor} open={openLink} setOpen={setOpenLink} />
66 |             </>
67 |           )}
68 |         </div>
69 |       </TiptapBubbleMenu>
70 |     </div>
71 |   );
72 | }
```

packages/ui/src/components/editor/extentions/bubble-menu/link-item.tsx
```
1 | "use client";
2 |
3 | import type { Editor } from "@tiptap/react";
4 | import { useRef, useState } from "react";
5 | import {
6 |   MdOutlineAddLink,
7 |   MdOutlineCheck,
8 |   MdOutlineDelete,
9 |   MdOutlineLinkOff,
10 | } from "react-icons/md";
11 | import { Button } from "../../../button";
12 | import { Popover, PopoverContent, PopoverTrigger } from "../../../popover";
13 | import { formatUrlWithProtocol } from "../../utils";
14 | import { BubbleMenuButton } from "./bubble-menu-button";
15 |
16 | interface LinkItemProps {
17 |   editor: Editor;
18 |   open: boolean;
19 |   setOpen: (open: boolean) => void;
20 | }
21 |
22 | export function LinkItem({ editor, open, setOpen }: LinkItemProps) {
23 |   const [value, setValue] = useState("");
24 |   const isActive = editor.isActive("link");
25 |   const inputRef = useRef<HTMLInputElement>(null);
26 |   const linkValue = editor.getAttributes("link").href;
27 |
28 |   const handleSubmit = () => {
29 |     const url = formatUrlWithProtocol(value);
30 |
31 |     if (url) {
32 |       editor
33 |         .chain()
34 |         .focus()
35 |         .extendMarkRange("link")
36 |         .setLink({ href: url })
37 |         .run();
38 |
39 |       setOpen(false);
40 |     }
41 |   };
42 |
43 |   return (
44 |     <Popover modal={false} open={open} onOpenChange={setOpen}>
45 |       <PopoverTrigger asChild>
46 |         <div>
47 |           <BubbleMenuButton isActive={isActive} action={() => setOpen(true)}>
48 |             {linkValue ? (
49 |               <MdOutlineLinkOff className="size-4" />
50 |             ) : (
51 |               <MdOutlineAddLink className="size-4" />
52 |             )}
53 |           </BubbleMenuButton>
54 |         </div>
55 |       </PopoverTrigger>
56 |       <PopoverContent align="end" className="w-60 p-0" sideOffset={10}>
57 |         <div className="flex p-1">
58 |           <input
59 |             ref={inputRef}
60 |             type="text"
61 |             placeholder="Paste a link"
62 |             className="flex-1 bg-background p-0.5 h-7 text-xs outline-none placeholder:text-[#878787]"
63 |             defaultValue={linkValue || ""}
64 |             onChange={(e) => setValue(e.target.value)}
65 |             onKeyDown={(e) => {
66 |               if (e.key === "Enter") {
67 |                 handleSubmit();
68 |               }
69 |             }}
70 |           />
71 |
72 |           {linkValue ? (
73 |             <Button
74 |               size="icon"
75 |               variant="outline"
76 |               type="button"
77 |               className="flex size-7 items-center p-1 text-red-600 transition-all hover:bg-red-100 dark:hover:bg-red-800 hover:border-none"
78 |               onClick={() => {
79 |                 editor.chain().focus().unsetLink().run();
80 |                 if (inputRef.current) {
81 |                   inputRef.current.value = "";
82 |                 }
83 |                 setOpen(false);
84 |               }}
85 |             >
86 |               <MdOutlineDelete className="size-4" />
87 |             </Button>
88 |           ) : (
89 |             <Button
90 |               size="icon"
91 |               className="size-7"
92 |               type="button"
93 |               onClick={handleSubmit}
94 |             >
95 |               <MdOutlineCheck className="size-4" />
96 |             </Button>
97 |           )}
98 |         </div>
99 |       </PopoverContent>
100 |     </Popover>
101 |   );
102 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/burn-rate-ui.tsx
```
1 | "use client";
2 |
3 | import { AreaChart } from "@/components/charts/area-chart";
4 | import { BotCard } from "@/components/chat/messages";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { formatDate } from "@/utils/format";
8 | import { addMonths } from "date-fns";
9 |
10 | type Props = {
11 |   averageBurnRate: number;
12 |   data: any;
13 |   months: number;
14 | };
15 |
16 | export function BurnRateUI({ averageBurnRate, months, data }: Props) {
17 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
18 |
19 |   if (!data?.length) {
20 |     return (
21 |       <BotCard>
22 |         We couldn't find any historical data to provide you with a burn rate.
23 |       </BotCard>
24 |     );
25 |   }
26 |   return (
27 |     <BotCard className="font-sans space-y-4">
28 |       <p className="font-mono">
29 |         Based on your historical data, your avarage burn rate is{" "}
30 |         <FormatAmount amount={averageBurnRate} currency={data.currency} />
31 |         per month. Your expected runway is {months} months, ending in{" "}
32 |         {formatDate(addMonths(new Date(), months).toISOString(), dateFormat)}.
33 |       </p>
34 |
35 |       <AreaChart data={data} height={200} />
36 |     </BotCard>
37 |   );
38 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/documents-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard } from "@/components/chat/messages";
4 | import { FilePreview } from "@/components/file-preview";
5 | import type { FileType } from "@midday/utils";
6 |
7 | type Document = {
8 |   id: string;
9 |   display_name: string;
10 |   size: number;
11 |   file_path: string[];
12 |   content_type: FileType;
13 | };
14 |
15 | type Props = {
16 |   data?: Document[];
17 | };
18 |
19 | export function DocumentsUI({ data }: Props) {
20 |   if (!data?.length) {
21 |     return (
22 |       <BotCard>
23 |         No documents were found for your request. Please try a different
24 |         message.
25 |       </BotCard>
26 |     );
27 |   }
28 |
29 |   return (
30 |     <BotCard className="font-sans space-y-4">
31 |       <p className="font-mono">
32 |         We found {data.length} documents based on your search
33 |       </p>
34 |
35 |       <div className="w-full overflow-auto space-x-4 flex scrollbar-hide max-w-[671px] pr-4">
36 |         {data?.map((item) => {
37 |           const filename = item.file_path?.at(-1);
38 |           const [, ...rest] = item.file_path;
39 |           // Without team_id
40 |           const downloadPath = rest.join("/");
41 |
42 |           return (
43 |             <div key={item.id}>
44 |               <FilePreview
45 |                 width={150}
46 |                 height={198}
47 |                 preview
48 |                 disableFullscreen
49 |                 name={item.display_name}
50 |                 type={item.content_type}
51 |                 download
52 |                 downloadUrl={`/api/download/file?path=${downloadPath}&filename=${filename}`}
53 |                 src={`/api/proxy?filePath=vault/${item?.file_path?.join("/")}`}
54 |               />
55 |             </div>
56 |           );
57 |         })}
58 |       </div>
59 |     </BotCard>
60 |   );
61 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/error-fallback.tsx
```
1 | export function ErrorFallback() {
2 |   return (
3 |     <div className="ml-4 flex-1 space-y-2 overflow-hidden pl-2 text-xs font-mono leading-relaxed">
4 |       Something went wrong. Please try again.
5 |     </div>
6 |   );
7 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/forecast-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard, BotMessage } from "@/components/chat/messages";
4 |
5 | type Props = {
6 |   content: string;
7 | };
8 |
9 | export function ForecastUI({ content }: Props) {
10 |   if (!content) {
11 |     return (
12 |       <BotCard>
13 |         We couldn't find any historical data to provide you with a forecast.
14 |       </BotCard>
15 |     );
16 |   }
17 |
18 |   return <BotMessage content={content} />;
19 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/profit-ui.tsx
```
1 | "use client";
2 |
3 | import { BarChart } from "@/components/charts/bar-chart";
4 | import { BotCard } from "@/components/chat/messages";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { formatDate } from "@/utils/format";
8 |
9 | type Props = {
10 |   data: any;
11 |   startDate: string;
12 |   endDate: string;
13 | };
14 |
15 | export function ProfitUI({ data, startDate, endDate }: Props) {
16 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
17 |
18 |   if (!data?.result?.length) {
19 |     return (
20 |       <BotCard>
21 |         We couldn't find any data to provide you with a profit summary.
22 |       </BotCard>
23 |     );
24 |   }
25 |   return (
26 |     <BotCard className="font-sans space-y-16">
27 |       <div>
28 |         <p className="font-mono">
29 |           Based on the period from {formatDate(startDate, dateFormat)} and{" "}
30 |           {formatDate(endDate, dateFormat)} your current profit is{" "}
31 |           <FormatAmount
32 |             amount={data.summary.currentTotal}
33 |             currency={data.summary.currency}
34 |           />
35 |           . In the previous period, your profit was{" "}
36 |           <FormatAmount
37 |             maximumFractionDigits={0}
38 |             minimumFractionDigits={0}
39 |             amount={data.summary.prevTotal || 0}
40 |             currency={data.summary.currency}
41 |           />
42 |           .
43 |         </p>
44 |       </div>
45 |
46 |       <BarChart data={data} currency={data.summary.currency} height={200} />
47 |     </BotCard>
48 |   );
49 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/report-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard } from "@/components/chat/messages";
4 | import { CopyInput } from "@/components/copy-input";
5 | import { useI18n } from "@/locales/client";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { formatDate } from "@/utils/format";
8 |
9 | type Props = {
10 |   shortLink: string;
11 |   type: "burn_rate" | "profit" | "revenue";
12 |   startDate: string;
13 |   endDate: string;
14 | };
15 |
16 | export function ReportUI({ shortLink, type, startDate, endDate }: Props) {
17 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
18 |   const t = useI18n();
19 |
20 |   if (!shortLink) {
21 |     return (
22 |       <BotCard>We couldn't create a report for you, please try again.</BotCard>
23 |     );
24 |   }
25 |
26 |   return (
27 |     <BotCard className="font-sans space-y-4">
28 |       <p className="font-mono">
29 |         Here is your report for {t(`chart_type.${type}`)} between{" "}
30 |         {formatDate(startDate, dateFormat)} and{" "}
31 |         {formatDate(endDate, dateFormat)}
32 |       </p>
33 |
34 |       <div className="flex">
35 |         <CopyInput value={shortLink} className="w-auto" />
36 |       </div>
37 |     </BotCard>
38 |   );
39 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/revenue-ui.tsx
```
1 | "use client";
2 |
3 | import { BarChart } from "@/components/charts/bar-chart";
4 | import { BotCard } from "@/components/chat/messages";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { useUserContext } from "@/store/user/hook";
7 | import { formatDate } from "@/utils/format";
8 |
9 | type Props = {
10 |   data: any;
11 |   startDate: string;
12 |   endDate: string;
13 | };
14 |
15 | export function RevenueUI({ data, startDate, endDate }: Props) {
16 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
17 |
18 |   if (!data?.result?.length) {
19 |     return (
20 |       <BotCard>
21 |         We couldn't find any data to provide you with a revenue summary.
22 |       </BotCard>
23 |     );
24 |   }
25 |   return (
26 |     <BotCard className="font-sans space-y-16">
27 |       <div>
28 |         <p className="font-mono">
29 |           Based on the period from {formatDate(startDate, dateFormat)} and{" "}
30 |           {formatDate(endDate, dateFormat)} your revenue is{" "}
31 |           <FormatAmount
32 |             amount={data.summary.currentTotal}
33 |             currency={data.summary.currency}
34 |           />
35 |           . In the previous period, your profit was{" "}
36 |           <FormatAmount
37 |             maximumFractionDigits={0}
38 |             minimumFractionDigits={0}
39 |             amount={data.summary.prevTotal || 0}
40 |             currency={data.summary.currency}
41 |           />
42 |           .
43 |         </p>
44 |       </div>
45 |
46 |       <BarChart data={data} currency={data.summary.currency} height={200} />
47 |     </BotCard>
48 |   );
49 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/runway-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard } from "@/components/chat/messages";
4 | import { useUserContext } from "@/store/user/hook";
5 | import { formatDate } from "@/utils/format";
6 | import { addMonths } from "date-fns";
7 |
8 | type Props = {
9 |   months: number;
10 | };
11 |
12 | export function RunwayUI({ months }: Props) {
13 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
14 |
15 |   if (!months) {
16 |     return (
17 |       <BotCard>
18 |         We couldn't find any historical data to provide you with a runway.
19 |       </BotCard>
20 |     );
21 |   }
22 |
23 |   return (
24 |     <BotCard>
25 |       Based on your historical data, your expected runway is {months} months,
26 |       ending in{" "}
27 |       {formatDate(addMonths(new Date(), months).toISOString(), dateFormat)}.
28 |     </BotCard>
29 |   );
30 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/show-all-button.tsx
```
1 | "use client";
2 |
3 | import { useAssistantStore } from "@/store/assistant";
4 | import { isDesktopApp } from "@todesktop/client-core/platform/todesktop";
5 | import { useRouter } from "next/navigation";
6 |
7 | type Props = {
8 |   filter: Record<string, string>;
9 |   sort?: string[];
10 |   q: string;
11 | };
12 |
13 | export function ShowAllButton({ filter, q, sort }: Props) {
14 |   const { setOpen } = useAssistantStore();
15 |   const router = useRouter();
16 |
17 |   const params = new URLSearchParams();
18 |
19 |   if (q) {
20 |     params.append("q", q);
21 |   }
22 |
23 |   if (Object.keys(filter).length > 0) {
24 |     for (const [key, value] of Object.entries(filter)) {
25 |       params.append(key, value);
26 |     }
27 |   }
28 |
29 |   if (sort) {
30 |     params.append("sort", `${sort.at(0)}:${sort.at(1)}`);
31 |   }
32 |
33 |   const handleOnClick = () => {
34 |     setOpen();
35 |     router.push(`/transactions?${params.toString()}`);
36 |   };
37 |
38 |   if (isDesktopApp()) {
39 |     // TODO: Fix link in desktop
40 |     return null;
41 |   }
42 |
43 |   return (
44 |     <button
45 |       type="button"
46 |       onClick={handleOnClick}
47 |       className="text-[#878787] font-sans"
48 |     >
49 |       Show all
50 |     </button>
51 |   );
52 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/spending-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard } from "@/components/chat/messages";
4 | import { FormatAmount } from "@/components/format-amount";
5 | import { useUserContext } from "@/store/user/hook";
6 | import { formatDate } from "@/utils/format";
7 |
8 | type Props = {
9 |   amount: number;
10 |   currency: string;
11 |   category: string;
12 |   name?: string;
13 |   startDate: string;
14 |   endDate: string;
15 | };
16 |
17 | export function SpendingUI({
18 |   amount,
19 |   currency,
20 |   category,
21 |   name,
22 |   startDate,
23 |   endDate,
24 | }: Props) {
25 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
26 |
27 |   if (!amount) {
28 |     return (
29 |       <BotCard>
30 |         We couldn't find any spending in this category {category} between{" "}
31 |         {formatDate(startDate, dateFormat)} and{" "}
32 |         {formatDate(endDate, dateFormat)}
33 |       </BotCard>
34 |     );
35 |   }
36 |
37 |   return (
38 |     <BotCard>
39 |       You have spent{" "}
40 |       <FormatAmount amount={Math.abs(amount)} currency={currency} /> on {name}{" "}
41 |       between {formatDate(startDate, dateFormat)} and{" "}
42 |       {formatDate(endDate, dateFormat)}
43 |     </BotCard>
44 |   );
45 | }
```

apps/dashboard/src/actions/ai/chat/tools/ui/transactions-ui.tsx
```
1 | "use client";
2 |
3 | import { BotCard } from "@/components/chat/messages";
4 | import { FormatAmount } from "@/components/format-amount";
5 | import { TransactionStatus } from "@/components/transaction-status";
6 | import { useI18n } from "@/locales/client";
7 | import { useUserContext } from "@/store/user/hook";
8 | import { formatDate } from "@/utils/format";
9 | import { cn } from "@midday/ui/cn";
10 | import {
11 |   Table,
12 |   TableBody,
13 |   TableCell,
14 |   TableHead,
15 |   TableHeader,
16 |   TableRow,
17 | } from "@midday/ui/table";
18 | import { ShowAllButton } from "./show-all-button";
19 |
20 | type Props = {
21 |   meta: any;
22 |   data: any;
23 |   q: string;
24 |   filter: Record<string, string>;
25 |   sort?: Record<string, string>;
26 | };
27 |
28 | export function TransactionsUI({ meta, data, q, filter, sort }: Props) {
29 |   const t = useI18n();
30 |   const { date_format: dateFormat } = useUserContext((state) => state.data);
31 |
32 |   if (!meta.count) {
33 |     return (
34 |       <BotCard>
35 |         No transactions were found for your request. Please try a different
36 |         message.
37 |       </BotCard>
38 |     );
39 |   }
40 |
41 |   return (
42 |     <BotCard className="space-y-4">
43 |       {meta.totalAmount.length === 1 && (
44 |         <p>
45 |           We found {meta.count}{" "}
46 |           {filter.recurring ? "recurring transactions" : "transactions"} with a
47 |           total amount of{" "}
48 |           <FormatAmount
49 |             amount={meta.totalAmount.at(0).amount}
50 |             currency={meta.totalAmount.at(0).currency}
51 |           />
52 |         </p>
53 |       )}
54 |
55 |       {meta.totalAmount.length > 1 && (
56 |         <p>We found {meta.count} transactions </p>
57 |       )}
58 |
59 |       {meta.count > 0 && (
60 |         <Table className="text-xs font-sans">
61 |           <TableHeader>
62 |             <TableRow>
63 |               <TableHead className="w-[45%] h-10">Description</TableHead>
64 |               <TableHead className="h-10 min-w-[80px]">Date</TableHead>
65 |               <TableHead className="h-10">Amount</TableHead>
66 |               <TableHead className="h-10 text-right w-[50px]">Status</TableHead>
67 |             </TableRow>
68 |           </TableHeader>
69 |           <TableBody>
70 |             {data?.map((transaction) => {
71 |               const fullfilled =
72 |                 transaction.status === "completed" ||
73 |                 transaction?.attachments?.length > 0;
74 |
75 |               return (
76 |                 <TableRow key={transaction.id} className="h-[34px]">
77 |                   <TableCell
78 |                     className={cn(
79 |                       "font-normal",
80 |                       transaction.category?.slug === "income" &&
81 |                         "text-[#00C969]",
82 |                     )}
83 |                   >
84 |                     <span className="line-clamp-1">{transaction.name}</span>
85 |                   </TableCell>
86 |                   <TableCell className="font-normal">
87 |                     {formatDate(transaction.date, dateFormat)}
88 |                   </TableCell>
89 |                   <TableCell
90 |                     className={cn(
91 |                       "font-normal",
92 |                       transaction.category?.slug === "income" &&
93 |                         "text-[#00C969]",
94 |                     )}
95 |                   >
96 |                     <FormatAmount
97 |                       amount={transaction.amount}
98 |                       currency={transaction.currency}
99 |                     />
100 |                   </TableCell>
101 |                   <TableCell className="text-right font-normal">
102 |                     <TransactionStatus fullfilled={fullfilled} />
103 |                   </TableCell>
104 |                 </TableRow>
105 |               );
106 |             })}
107 |           </TableBody>
108 |         </Table>
109 |       )}
110 |
111 |       {meta.count > 5 && <ShowAllButton filter={filter} q={q} sort={sort} />}
112 |     </BotCard>
113 |   );
114 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/layout.tsx
```
1 | import { SecondaryMenu } from "@/components/secondary-menu";
2 |
3 | export default function Layout({ children }: { children: React.ReactNode }) {
4 |   return (
5 |     <div className="max-w-[800px]">
6 |       <SecondaryMenu
7 |         items={[
8 |           { path: "/account", label: "General" },
9 |           { path: "/account/date-and-locale", label: "Date & Locale" },
10 |           { path: "/account/security", label: "Security" },
11 |           { path: "/account/assistant", label: "Assistant" },
12 |           { path: "/account/teams", label: "Teams" },
13 |           { path: "/account/support", label: "Support" },
14 |         ]}
15 |       />
16 |
17 |       <main className="mt-8">{children}</main>
18 |     </div>
19 |   );
20 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/page.tsx
```
1 | import { ChangeEmail } from "@/components/change-email";
2 | import { ChangeTheme } from "@/components/change-theme";
3 | import { DeleteAccount } from "@/components/delete-account";
4 | import { DisplayName } from "@/components/display-name";
5 | import { UserAvatar } from "@/components/user-avatar";
6 | import { getUser } from "@midday/supabase/cached-queries";
7 | import type { Metadata } from "next";
8 |
9 | export const metadata: Metadata = {
10 |   title: "Account Settings | Midday",
11 | };
12 |
13 | export default async function Account() {
14 |   const { data: userData } = await getUser();
15 |
16 |   return (
17 |     <div className="space-y-12">
18 |       <UserAvatar
19 |         userId={userData.id}
20 |         fullName={userData.full_name}
21 |         avatarUrl={userData?.avatar_url}
22 |       />
23 |       <DisplayName fullName={userData.full_name} />
24 |       <ChangeEmail email={userData.email} />
25 |       <ChangeTheme />
26 |       <DeleteAccount />
27 |     </div>
28 |   );
29 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/apps/page.tsx
```
1 | import { AppsHeader } from "@/components/apps-header";
2 | import { AppsServer } from "@/components/apps.server";
3 | import { AppsSkeleton } from "@/components/apps.skeleton";
4 | import { getUser } from "@midday/supabase/cached-queries";
5 | import type { Metadata } from "next";
6 | import { Suspense } from "react";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Apps | Midday",
10 | };
11 |
12 | export default async function Page() {
13 |   const { data } = await getUser();
14 |
15 |   return (
16 |     <div className="mt-4">
17 |       <AppsHeader  />
18 |
19 |       <Suspense fallback={<AppsSkeleton />}>
20 |         <AppsServer user={data} />
21 |       </Suspense>
22 |     </div>
23 |   );
24 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/customers/page.tsx
```
1 | import { CustomersHeader } from "@/components/customers-header";
2 | import { ErrorFallback } from "@/components/error-fallback";
3 | import { CustomersTable } from "@/components/tables/customers";
4 | import { CustomersSkeleton } from "@/components/tables/customers/skeleton";
5 | import type { Metadata } from "next";
6 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
7 | import { Suspense } from "react";
8 | import { searchParamsCache } from "./search-params";
9 |
10 | export const metadata: Metadata = {
11 |   title: "Customers | Midday",
12 | };
13 |
14 | export default async function Page({
15 |   searchParams,
16 | }: {
17 |   searchParams: Record<string, string | string[] | undefined>;
18 | }) {
19 |   const {
20 |     q: query,
21 |     sort,
22 |     start,
23 |     end,
24 |     page,
25 |   } = searchParamsCache.parse(searchParams);
26 |
27 |   return (
28 |     <div className="flex flex-col pt-6 gap-6">
29 |       <CustomersHeader />
30 |
31 |       <ErrorBoundary errorComponent={ErrorFallback}>
32 |         <Suspense fallback={<CustomersSkeleton />}>
33 |           <CustomersTable
34 |             query={query}
35 |             sort={sort}
36 |             start={start}
37 |             end={end}
38 |             page={page}
39 |           />
40 |         </Suspense>
41 |       </ErrorBoundary>
42 |     </div>
43 |   );
44 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/customers/search-params.ts
```
1 | import {
2 |   createSearchParamsCache,
3 |   parseAsArrayOf,
4 |   parseAsInteger,
5 |   parseAsString,
6 | } from "nuqs/server";
7 |
8 | export const searchParamsCache = createSearchParamsCache({
9 |   page: parseAsInteger.withDefault(0),
10 |   q: parseAsString.withDefault(""),
11 |   sort: parseAsArrayOf(parseAsString),
12 |   start: parseAsString,
13 |   end: parseAsString,
14 | });
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/inbox/page.tsx
```
1 | import { Inbox } from "@/components/inbox";
2 | import { InboxViewSkeleton } from "@/components/inbox-skeleton";
3 | import { Cookies } from "@/utils/constants";
4 | import { uniqueCurrencies } from "@midday/location/currencies";
5 | import type { Metadata } from "next";
6 | import { cookies } from "next/headers";
7 | import { Suspense } from "react";
8 |
9 | export const metadata: Metadata = {
10 |   title: "Inbox | Midday",
11 | };
12 |
13 | type Props = {
14 |   searchParams: { [key: string]: string | string[] | undefined };
15 | };
16 |
17 | export default async function InboxPage({ searchParams }: Props) {
18 |   const ascending =
19 |     cookies().get(Cookies.InboxOrder)?.value === "true" ?? false;
20 |
21 |   return (
22 |     <Suspense
23 |       key={ascending.toString()}
24 |       fallback={<InboxViewSkeleton ascending />}
25 |     >
26 |       <Inbox
27 |         ascending={ascending}
28 |         query={searchParams?.q}
29 |         currencies={uniqueCurrencies}
30 |       />
31 |     </Suspense>
32 |   );
33 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/invoices/page.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { InvoiceHeader } from "@/components/invoice-header";
3 | import {
4 |   InvoicePaymentScore,
5 |   InvoicePaymentScoreSkeleton,
6 | } from "@/components/invoice-payment-score";
7 | import { InvoiceSummarySkeleton } from "@/components/invoice-summary";
8 | import { InvoicesOpen } from "@/components/invoices-open";
9 | import { InvoicesOverdue } from "@/components/invoices-overdue";
10 | import { InvoicesPaid } from "@/components/invoices-paid";
11 | import { InvoicesTable } from "@/components/tables/invoices";
12 | import { InvoiceSkeleton } from "@/components/tables/invoices/skeleton";
13 | import { getDefaultSettings } from "@midday/invoice/default";
14 | import type { Metadata } from "next";
15 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
16 | import { Suspense } from "react";
17 | import { searchParamsCache } from "./search-params";
18 |
19 | export const metadata: Metadata = {
20 |   title: "Invoices | Midday",
21 | };
22 |
23 | export default async function Page({
24 |   searchParams,
25 | }: {
26 |   searchParams: Record<string, string | string[] | undefined>;
27 | }) {
28 |   const {
29 |     q: query,
30 |     sort,
31 |     start,
32 |     end,
33 |     statuses,
34 |     customers,
35 |     page,
36 |   } = searchParamsCache.parse(searchParams);
37 |
38 |   const defaultSettings = await getDefaultSettings();
39 |
40 |   const loadingKey = JSON.stringify({
41 |     q: query,
42 |     sort,
43 |     start,
44 |     end,
45 |     statuses,
46 |     customers,
47 |     page,
48 |   });
49 |
50 |   return (
51 |     <div className="flex flex-col gap-6">
52 |       <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 pt-6">
53 |         <Suspense fallback={<InvoiceSummarySkeleton />}>
54 |           <InvoicesOpen defaultCurrency={defaultSettings.currency} />
55 |         </Suspense>
56 |         <Suspense fallback={<InvoiceSummarySkeleton />}>
57 |           <InvoicesOverdue defaultCurrency={defaultSettings.currency} />
58 |         </Suspense>
59 |         <Suspense fallback={<InvoiceSummarySkeleton />}>
60 |           <InvoicesPaid defaultCurrency={defaultSettings.currency} />
61 |         </Suspense>
62 |         <Suspense fallback={<InvoicePaymentScoreSkeleton />}>
63 |           <InvoicePaymentScore />
64 |         </Suspense>
65 |       </div>
66 |
67 |       <InvoiceHeader />
68 |
69 |       <ErrorBoundary errorComponent={ErrorFallback}>
70 |         <Suspense fallback={<InvoiceSkeleton />} key={loadingKey}>
71 |           <InvoicesTable
72 |             query={query}
73 |             sort={sort}
74 |             start={start}
75 |             end={end}
76 |             statuses={statuses}
77 |             customers={customers}
78 |             page={page}
79 |           />
80 |         </Suspense>
81 |       </ErrorBoundary>
82 |     </div>
83 |   );
84 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/invoices/search-params.ts
```
1 | import {
2 |   createSearchParamsCache,
3 |   parseAsArrayOf,
4 |   parseAsInteger,
5 |   parseAsString,
6 | } from "nuqs/server";
7 |
8 | export const searchParamsCache = createSearchParamsCache({
9 |   page: parseAsInteger.withDefault(0),
10 |   q: parseAsString.withDefault(""),
11 |   sort: parseAsArrayOf(parseAsString),
12 |   start: parseAsString,
13 |   end: parseAsString,
14 |   statuses: parseAsArrayOf(parseAsString),
15 |   customers: parseAsArrayOf(parseAsString),
16 | });
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/layout.tsx
```
1 | import { Header } from "@/components/header";
2 | import { SecondaryMenu } from "@/components/secondary-menu";
3 |
4 | export default function Layout({ children }: { children: React.ReactNode }) {
5 |   return (
6 |     <div className="max-w-[800px]">
7 |       <SecondaryMenu
8 |         items={[
9 |           { path: "/settings", label: "General" },
10 |           { path: "/settings/accounts", label: "Bank Connections" },
11 |           { path: "/settings/categories", label: "Categories" },
12 |           { path: "/settings/members", label: "Members" },
13 |           { path: "/settings/notifications", label: "Notifications" },
14 |         ]}
15 |       />
16 |
17 |       <main className="mt-8">{children}</main>
18 |     </div>
19 |   );
20 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/page.tsx
```
1 | import { DeleteTeam } from "@/components/delete-team";
2 | import { TeamAvatar } from "@/components/team-avatar";
3 | import { TeamName } from "@/components/team-name";
4 | import { getUser } from "@midday/supabase/cached-queries";
5 | import type { Metadata } from "next";
6 |
7 | export const metadata: Metadata = {
8 |   title: "Team Settings | Midday",
9 | };
10 |
11 | export default async function Account() {
12 |   const user = await getUser();
13 |
14 |   return (
15 |     <div className="space-y-12">
16 |       <TeamAvatar
17 |         teamId={user?.data?.team?.id}
18 |         name={user?.data?.team?.name}
19 |         logoUrl={user?.data?.team?.logo_url}
20 |       />
21 |
22 |       <TeamName name={user?.data?.team?.name} />
23 |       <DeleteTeam name={user?.data?.team?.name} teamId={user?.data?.team?.id} />
24 |     </div>
25 |   );
26 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/tracker/page.tsx
```
1 | import { OpenTrackerSheet } from "@/components/open-tracker-sheet";
2 | import { Table } from "@/components/tables/tracker";
3 | import { Loading } from "@/components/tables/tracker/loading";
4 | import { TrackerCalendar } from "@/components/tracker-calendar";
5 | import { TrackerSearchFilter } from "@/components/tracker-search-filter";
6 | import {
7 |   getCustomers,
8 |   getTrackerRecordsByRange,
9 |   getUser,
10 | } from "@midday/supabase/cached-queries";
11 | import { endOfMonth, formatISO, startOfMonth } from "date-fns";
12 | import type { Metadata } from "next";
13 | import { Suspense } from "react";
14 | import { searchParamsCache } from "./search-params";
15 |
16 | export const metadata: Metadata = {
17 |   title: "Tracker | Midday",
18 | };
19 |
20 | type Props = {
21 |   searchParams: {
22 |     statuses: string;
23 |     sort: string;
24 |     q: string;
25 |     start?: string;
26 |     end?: string;
27 |     customers?: string[];
28 |   };
29 | };
30 |
31 | export default async function Tracker({ searchParams }: Props) {
32 |   const {
33 |     sort: sortParams,
34 |     statuses,
35 |     customers,
36 |   } = searchParamsCache.parse(searchParams);
37 |
38 |   const sort = sortParams?.split(":") ?? ["status", "asc"];
39 |
40 |   const currentDate =
41 |     searchParams?.date ?? formatISO(new Date(), { representation: "date" });
42 |
43 |   const [{ data: userData }, { data, meta }, { data: customersData }] =
44 |     await Promise.all([
45 |       getUser(),
46 |       getTrackerRecordsByRange({
47 |         from: formatISO(startOfMonth(new Date(currentDate)), {
48 |           representation: "date",
49 |         }),
50 |         to: formatISO(endOfMonth(new Date(currentDate)), {
51 |           representation: "date",
52 |         }),
53 |       }),
54 |       getCustomers(),
55 |     ]);
56 |
57 |   return (
58 |     <div>
59 |       <TrackerCalendar
60 |         weekStartsOnMonday={userData?.week_starts_on_monday}
61 |         timeFormat={userData?.time_format}
62 |         data={data}
63 |         meta={meta}
64 |       />
65 |
66 |       <div className="mt-14 mb-6 flex items-center justify-between space-x-4">
67 |         <h2 className="text-md font-medium">Projects</h2>
68 |
69 |         <div className="flex space-x-2">
70 |           <TrackerSearchFilter customers={customersData} />
71 |           <OpenTrackerSheet />
72 |         </div>
73 |       </div>
74 |
75 |       <Suspense fallback={<Loading />}>
76 |         <Table
77 |           status={statuses}
78 |           sort={sort}
79 |           q={searchParams?.q}
80 |           start={searchParams?.start}
81 |           end={searchParams?.end}
82 |           userId={userData?.id}
83 |           customerIds={customers}
84 |         />
85 |       </Suspense>
86 |     </div>
87 |   );
88 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/tracker/search-params.ts
```
1 | import {
2 |   createSearchParamsCache,
3 |   parseAsArrayOf,
4 |   parseAsString,
5 | } from "nuqs/server";
6 |
7 | export const searchParamsCache = createSearchParamsCache({
8 |   customers: parseAsArrayOf(parseAsString),
9 |   statuses: parseAsArrayOf(parseAsString),
10 |   sort: parseAsString,
11 | });
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/transactions/page.tsx
```
1 | import { ErrorFallback } from "@/components/error-fallback";
2 | import { TransactionsModal } from "@/components/modals/transactions-modal";
3 | import { CreateTransactionSheet } from "@/components/sheets/create-transaction-sheet";
4 | import { Table } from "@/components/tables/transactions";
5 | import { NoAccounts } from "@/components/tables/transactions/empty-states";
6 | import { Loading } from "@/components/tables/transactions/loading";
7 | import { TransactionsActions } from "@/components/transactions-actions";
8 | import { TransactionsSearchFilter } from "@/components/transactions-search-filter";
9 | import { Cookies } from "@/utils/constants";
10 | import {
11 |   getCategories,
12 |   getTags,
13 |   getTeamBankAccounts,
14 |   getTeamMembers,
15 |   getUser,
16 | } from "@midday/supabase/cached-queries";
17 | import type { Metadata } from "next";
18 | import { ErrorBoundary } from "next/dist/client/components/error-boundary";
19 | import { cookies } from "next/headers";
20 | import { Suspense } from "react";
21 | import { searchParamsCache } from "./search-params";
22 |
23 | export const metadata: Metadata = {
24 |   title: "Transactions | Midday",
25 | };
26 |
27 | export default async function Transactions({
28 |   searchParams,
29 | }: {
30 |   searchParams: Record<string, string | string[] | undefined>;
31 | }) {
32 |   const {
33 |     q: query,
34 |     page,
35 |     attachments,
36 |     start,
37 |     end,
38 |     categories,
39 |     assignees,
40 |     statuses,
41 |     recurring,
42 |     accounts,
43 |     tags,
44 |     amount_range,
45 |     amount,
46 |   } = searchParamsCache.parse(searchParams);
47 |
48 |   // Move this in a suspense
49 |   const [accountsData, categoriesData, teamMembersData, userData, tagsData] =
50 |     await Promise.all([
51 |       getTeamBankAccounts(),
52 |       getCategories(),
53 |       getTeamMembers(),
54 |       getUser(),
55 |       getTags(),
56 |     ]);
57 |
58 |   const filter = {
59 |     attachments,
60 |     start,
61 |     end,
62 |     categories,
63 |     assignees,
64 |     statuses,
65 |     recurring,
66 |     accounts,
67 |     tags,
68 |     amount_range,
69 |     amount,
70 |   };
71 |
72 |   const sort = searchParams?.sort?.split(":");
73 |   const hideConnectFlow = cookies().has(Cookies.HideConnectFlow);
74 |
75 |   const isOpen = Boolean(searchParams.step);
76 |   const isEmpty = !accountsData?.data?.length && !isOpen;
77 |   const loadingKey = JSON.stringify({
78 |     page,
79 |     filter,
80 |     sort,
81 |     query,
82 |   });
83 |
84 |   return (
85 |     <>
86 |       <div className="flex justify-between py-6">
87 |         <TransactionsSearchFilter
88 |           placeholder="Search or type filter"
89 |           categories={[
90 |             ...categoriesData?.data?.map((category) => ({
91 |               slug: category.slug,
92 |               name: category.name,
93 |             })),
94 |             {
95 |               // TODO, move this to the database
96 |               id: "uncategorized",
97 |               name: "Uncategorized",
98 |               slug: "uncategorized",
99 |             },
100 |           ]}
101 |           accounts={accountsData?.data?.map((account) => ({
102 |             id: account.id,
103 |             name: account.name,
104 |             currency: account.currency,
105 |           }))}
106 |           members={teamMembersData?.data?.map((member) => ({
107 |             id: member?.user?.id,
108 |             name: member.user?.full_name,
109 |           }))}
110 |           tags={tagsData?.data?.map((tag) => ({
111 |             id: tag.id,
112 |             name: tag.name,
113 |           }))}
114 |         />
115 |         <TransactionsActions
116 |           isEmpty={isEmpty}
117 |           tags={tagsData?.data?.map((tag) => ({
118 |             id: tag.id,
119 |             name: tag.name,
120 |           }))}
121 |         />
122 |       </div>
123 |
124 |       {isEmpty ? (
125 |         <div className="relative h-[calc(100vh-200px)] overflow-hidden">
126 |           <NoAccounts />
127 |           <Loading isEmpty />
128 |         </div>
129 |       ) : (
130 |         <ErrorBoundary errorComponent={ErrorFallback}>
131 |           <Suspense fallback={<Loading />} key={loadingKey}>
132 |             <Table filter={filter} page={page} sort={sort} query={query} />
133 |           </Suspense>
134 |         </ErrorBoundary>
135 |       )}
136 |
137 |       <TransactionsModal defaultOpen={isEmpty && !hideConnectFlow} />
138 |       <CreateTransactionSheet
139 |         categories={categoriesData?.data}
140 |         userId={userData?.data?.id}
141 |         accountId={accountsData?.data?.at(0)?.id}
142 |         currency={accountsData?.data?.at(0)?.currency}
143 |       />
144 |     </>
145 |   );
146 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/transactions/search-params.ts
```
1 | import {
2 |   createSearchParamsCache,
3 |   parseAsArrayOf,
4 |   parseAsInteger,
5 |   parseAsString,
6 |   parseAsStringLiteral,
7 | } from "nuqs/server";
8 |
9 | export const searchParamsCache = createSearchParamsCache({
10 |   q: parseAsString,
11 |   page: parseAsInteger.withDefault(0),
12 |   attachments: parseAsStringLiteral(["exclude", "include"] as const),
13 |   start: parseAsString,
14 |   end: parseAsString,
15 |   categories: parseAsArrayOf(parseAsString),
16 |   tags: parseAsArrayOf(parseAsString),
17 |   amount_range: parseAsArrayOf(parseAsInteger),
18 |   accounts: parseAsArrayOf(parseAsString),
19 |   assignees: parseAsArrayOf(parseAsString),
20 |   amount: parseAsArrayOf(parseAsString),
21 |   recurring: parseAsArrayOf(
22 |     parseAsStringLiteral(["all", "weekly", "monthly", "annually"] as const),
23 |   ),
24 |   statuses: parseAsStringLiteral([
25 |     "completed",
26 |     "uncompleted",
27 |     "archived",
28 |     "excluded",
29 |   ] as const),
30 | });
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/vault/layout.tsx
```
1 | import { VaultActivity } from "@/components/vault-activity";
2 | import { Loading } from "@/components/vault-activity.loading";
3 | import { type ReactNode, Suspense } from "react";
4 |
5 | export default function Layout({
6 |   children,
7 | }: {
8 |   children: ReactNode;
9 | }) {
10 |   return (
11 |     <div>
12 |       <Suspense fallback={<Loading />}>
13 |         <VaultActivity />
14 |       </Suspense>
15 |
16 |       {children}
17 |     </div>
18 |   );
19 | }
```

apps/dashboard/src/app/[locale]/(app)/desktop/command/page.tsx
```
1 | import { AI } from "@/actions/ai/chat";
2 | import { Assistant } from "@/components/assistant";
3 | import { getUser } from "@midday/supabase/cached-queries";
4 | import { nanoid } from "nanoid";
5 |
6 | export default async function Page() {
7 |   const user = await getUser();
8 |
9 |   return (
10 |     <AI initialAIState={{ user: user.data, messages: [], chatId: nanoid() }}>
11 |       <Assistant />
12 |     </AI>
13 |   );
14 | }
```

apps/dashboard/src/app/[locale]/(app)/mfa/setup/page.tsx
```
1 | import { SetupMfa } from "@/components/setup-mfa";
2 | import type { Metadata } from "next";
3 |
4 | export const metadata: Metadata = {
5 |   title: "Setup MFA | Midday",
6 | };
7 |
8 | export default function Setup() {
9 |   return <SetupMfa />;
10 | }
```

apps/dashboard/src/app/[locale]/(app)/mfa/verify/page.tsx
```
1 | "use client";
2 |
3 | import { VerifyMfa } from "@/components/verify-mfa";
4 | import { Icons } from "@midday/ui/icons";
5 | import Link from "next/link";
6 |
7 | export default function Verify() {
8 |   return (
9 |     <div>
10 |       <div className="absolute left-5 top-4 md:left-10 md:top-10">
11 |         <Link href="https://midday.ai">
12 |           <Icons.Logo />
13 |         </Link>
14 |       </div>
15 |
16 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
17 |         <div className="relative z-20 m-auto flex w-full max-w-[380px] flex-col">
18 |           <VerifyMfa />
19 |         </div>
20 |       </div>
21 |     </div>
22 |   );
23 | }
```

apps/dashboard/src/app/[locale]/(app)/teams/create/page.tsx
```
1 | import { CreateTeamForm } from "@/components/forms/create-team-form";
2 | import { UserMenu } from "@/components/user-menu";
3 | import { Icons } from "@midday/ui/icons";
4 | import type { Metadata } from "next";
5 | import Link from "next/link";
6 | import { Suspense } from "react";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Create Team | Midday",
10 | };
11 |
12 | export default async function CreateTeam() {
13 |   return (
14 |     <>
15 |       <header className="w-full absolute left-0 right-0 flex justify-between items-center">
16 |         <div className="ml-5 mt-4 md:ml-10 md:mt-10">
17 |           <Link href="/">
18 |             <Icons.Logo />
19 |           </Link>
20 |         </div>
21 |
22 |         <div className="mr-5 mt-4 md:mr-10 md:mt-10">
23 |           <Suspense>
24 |             <UserMenu onlySignOut />
25 |           </Suspense>
26 |         </div>
27 |       </header>
28 |
29 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
30 |         <div className="relative z-20 m-auto flex w-full max-w-[340px] flex-col">
31 |           <div>
32 |             <h1 className="text-2xl font-medium mb-8">
33 |               What’s the name of your company or team?
34 |             </h1>
35 |           </div>
36 |
37 |           <div className="mb-2">
38 |             <p className="text-sm">
39 |               This will be the name of your Midday workspace — choose something
40 |               that your team will recognize.
41 |             </p>
42 |           </div>
43 |
44 |           <CreateTeamForm />
45 |         </div>
46 |       </div>
47 |     </>
48 |   );
49 | }
```

apps/dashboard/src/app/[locale]/(app)/teams/invite/page.tsx
```
1 | import { InviteForm } from "@/components/forms/invite-form";
2 | import { UserMenu } from "@/components/user-menu";
3 | import { Icons } from "@midday/ui/icons";
4 | import type { Metadata } from "next";
5 | import Link from "next/link";
6 | import { Suspense } from "react";
7 |
8 | export const metadata: Metadata = {
9 |   title: "Invite Team Member | Midday",
10 | };
11 |
12 | export default async function InviteMembers() {
13 |   return (
14 |     <>
15 |       <header className="w-full absolute left-0 right-0 flex justify-between items-center">
16 |         <div className="ml-5 mt-4 md:ml-10 md:mt-10">
17 |           <Link href="/">
18 |             <Icons.Logo />
19 |           </Link>
20 |         </div>
21 |
22 |         <div className="mr-5 mt-4 md:mr-10 md:mt-10">
23 |           <Suspense>
24 |             <UserMenu onlySignOut />
25 |           </Suspense>
26 |         </div>
27 |       </header>
28 |
29 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
30 |         <div className="relative z-20 m-auto flex w-full max-w-[340px] flex-col">
31 |           <h1 className="text-2xl font-medium pb-4">Invite team members</h1>
32 |           <p className="text-sm text-[#878787] mb-8">
33 |             Add the email addresses of the people you want on your team and send
34 |             them invites to join.
35 |           </p>
36 |
37 |           <InviteForm />
38 |         </div>
39 |       </div>
40 |     </>
41 |   );
42 | }
```

apps/dashboard/src/app/[locale]/(public)/report/[id]/page.tsx
```
1 | import { AnimatedNumber } from "@/components/animated-number";
2 | import { AreaChart } from "@/components/charts/area-chart";
3 | import { BarChart } from "@/components/charts/bar-chart";
4 | import { StackedBarChart } from "@/components/charts/stacked-bar-chart";
5 | import { FormatAmount } from "@/components/format-amount";
6 | import { calculateAvgBurnRate } from "@/utils/format";
7 | import {
8 |   getBurnRateQuery,
9 |   getExpensesQuery,
10 |   getMetricsQuery,
11 |   getRunwayQuery,
12 | } from "@midday/supabase/queries";
13 | import { createClient } from "@midday/supabase/server";
14 | import { Button } from "@midday/ui/button";
15 | import { format } from "date-fns";
16 | import type { Metadata } from "next";
17 | import Link from "next/link";
18 | import { notFound } from "next/navigation";
19 |
20 | export const revalidate = 3600;
21 | export const fetchCache = "force-cache";
22 |
23 | function getReportMeta(data) {
24 |   const period = `${format(new Date(data.from), "LLL dd, y")} - ${format(
25 |     new Date(data.to),
26 |     "LLL dd, y",
27 |   )}`;
28 |
29 |   switch (data.type) {
30 |     case "profit":
31 |       return {
32 |         title: `Profit for ${data.team.name} (${period})`,
33 |         description: `Profit for ${data.team.name} based on the period ${period}`,
34 |         shortTitle: "Profit",
35 |       };
36 |     case "revenue":
37 |       return {
38 |         title: `Revenue for ${data.team.name} (${period})`,
39 |         description: `Revenue for ${data.team.name} based on the period ${period}`,
40 |         shortTitle: "Revenue",
41 |       };
42 |     case "burn_rate":
43 |       return {
44 |         title: `Burn rate for ${data.team.name} (${period})`,
45 |         description: `Burn rate for ${data.team.name} based on the period ${period}`,
46 |         shortTitle: "Burn rate",
47 |       };
48 |     case "expense":
49 |       return {
50 |         title: `Expense report for ${data.team.name} (${period})`,
51 |         description: `Expense report for ${data.team.name} based on the period ${period}`,
52 |         shortTitle: "Expense report",
53 |       };
54 |
55 |     default:
56 |       return {};
57 |   }
58 | }
59 |
60 | export async function generateMetadata({ params }): Promise<Metadata> {
61 |   const supabase = createClient({ admin: true });
62 |
63 |   const { data, error } = await supabase
64 |     .from("reports")
65 |     .select("*, team:team_id(name)")
66 |     .eq("id", params.id)
67 |     .single();
68 |
69 |   if (error) {
70 |     return {};
71 |   }
72 |
73 |   return {
74 |     ...getReportMeta(data),
75 |     robots: {
76 |       index: false,
77 |     },
78 |   };
79 | }
80 |
81 | export default async function Report({ params }) {
82 |   const supabase = createClient({ admin: true });
83 |
84 |   const { data, error } = await supabase
85 |     .from("reports")
86 |     .select("*, team:team_id(name)")
87 |     .eq("id", params.id)
88 |     .single();
89 |
90 |   if (error) {
91 |     return notFound();
92 |   }
93 |
94 |   async function getContent() {
95 |     switch (data?.type) {
96 |       case "profit":
97 |       case "revenue": {
98 |         const metricsData = await getMetricsQuery(supabase, {
99 |           teamId: data.team_id,
100 |           from: data.from,
101 |           to: data.to,
102 |           type: data.type,
103 |           currency: data.currency,
104 |         });
105 |
106 |         return (
107 |           <>
108 |             <div className="flex flex-col space-y-2 items-start mb-16">
109 |               <div>
110 |                 <h1 className="text-4xl font-mono">
111 |                   <FormatAmount
112 |                     amount={metricsData.summary.currentTotal}
113 |                     currency={metricsData.summary.currency}
114 |                   />
115 |                 </h1>
116 |               </div>
117 |               <div className="text-[#878787]">
118 |                 {format(new Date(data.from), "LLL dd, y")} -{" "}
119 |                 {format(new Date(data.to), "LLL dd, y")}
120 |               </div>
121 |             </div>
122 |
123 |             <BarChart data={metricsData} currency={data.currency} />
124 |           </>
125 |         );
126 |       }
127 |       case "burn_rate": {
128 |         const [{ data: burnRateData }, { data: runway }] = await Promise.all([
129 |           getBurnRateQuery(supabase, {
130 |             teamId: data.team_id,
131 |             from: data.from,
132 |             to: data.to,
133 |             type: data.type,
134 |             currency: data.currency,
135 |           }),
136 |           getRunwayQuery(supabase, {
137 |             teamId: data.team_id,
138 |             from: data.from,
139 |             to: data.to,
140 |             type: data.type,
141 |             currency: data.currency,
142 |           }),
143 |         ]);
144 |
145 |         return (
146 |           <>
147 |             <div className="flex flex-col space-y-2 items-start mb-16">
148 |               <div>
149 |                 <h1 className="text-4xl font-mono">
150 |                   <FormatAmount
151 |                     amount={calculateAvgBurnRate(burnRateData)}
152 |                     currency={data.currency}
153 |                   />
154 |                 </h1>
155 |               </div>
[TRUNCATED]
```

apps/dashboard/src/app/api/apps/slack/events/route.ts
```
1 | import {
2 |   config,
3 |   handleSlackEvent,
4 |   verifySlackRequest,
5 | } from "@midday/app-store/slack";
6 | import { createClient } from "@midday/supabase/server";
7 | import { headers } from "next/headers";
8 | import { NextResponse } from "next/server";
9 |
10 | export async function POST(req: Request) {
11 |   const rawBody = await req.text();
12 |
13 |   const { challenge, team_id, event } = JSON.parse(rawBody);
14 |
15 |   if (challenge) {
16 |     return new NextResponse(challenge);
17 |   }
18 |
19 |   try {
20 |     verifySlackRequest({
21 |       signingSecret: process.env.SLACK_SIGNING_SECRET!,
22 |       body: rawBody,
23 |       // @ts-expect-error - headers are not typed
24 |       headers: Object.fromEntries(headers().entries()),
25 |     });
26 |   } catch (error) {
27 |     console.error("Slack request verification failed:", error);
28 |     return NextResponse.json(
29 |       { error: "Invalid Slack request" },
30 |       { status: 401 },
31 |     );
32 |   }
33 |
34 |   // We don't need to handle message_deleted events
35 |   if (event?.type === "message_deleted") {
36 |     return NextResponse.json({
37 |       success: true,
38 |     });
39 |   }
40 |
41 |   const supabase = createClient({ admin: true });
42 |
43 |   const { data } = await supabase
44 |     .from("apps")
45 |     .select("team_id, config")
46 |     .eq("app_id", config.id)
47 |     .eq("config->>team_id", team_id)
48 |     .single();
49 |
50 |   if (!data) {
51 |     return NextResponse.json(
52 |       { error: "Unauthorized: No matching team found" },
53 |       { status: 401 },
54 |     );
55 |   }
56 |
57 |   if (event) {
58 |     await handleSlackEvent(event, {
59 |       token: data?.config.access_token,
60 |       teamId: data.team_id,
61 |     });
62 |   }
63 |
64 |   return NextResponse.json({
65 |     success: true,
66 |   });
67 | }
```

apps/dashboard/src/app/api/apps/slack/install-url/route.ts
```
1 | import { getInstallUrl } from "@midday/app-store/slack";
2 | import { getUser } from "@midday/supabase/cached-queries";
3 | import { NextResponse } from "next/server";
4 |
5 | export async function GET() {
6 |   const { data } = await getUser();
7 |
8 |   if (!data) {
9 |     return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
10 |   }
11 |
12 |   const url = await getInstallUrl({
13 |     teamId: data.team_id,
14 |     userId: data.id,
15 |   });
16 |
17 |   return NextResponse.json({
18 |     url,
19 |   });
20 | }
```

apps/dashboard/src/app/api/apps/slack/interactive/route.ts
```
1 | export async function POST() {
2 |   return new Response(null, { status: 200 });
3 | }
```

apps/dashboard/src/app/api/apps/slack/oauth_callback/route.ts
```
1 | import { createApp } from "@midday/app-store/db";
2 | import {
3 |   config,
4 |   createSlackApp,
5 |   slackInstaller,
6 | } from "@midday/app-store/slack";
7 | import { type NextRequest, NextResponse } from "next/server";
8 | import { z } from "zod";
9 |
10 | const paramsSchema = z.object({
11 |   code: z.string(),
12 |   state: z.string(),
13 | });
14 |
15 | const metadataSchema = z.object({
16 |   teamId: z.string(),
17 |   userId: z.string(),
18 | });
19 |
20 | const slackAuthResponseSchema = z.object({
21 |   ok: z.literal(true),
22 |   app_id: z.string(),
23 |   authed_user: z.object({
24 |     id: z.string(),
25 |   }),
26 |   scope: z.string(),
27 |   token_type: z.literal("bot"),
28 |   access_token: z.string(),
29 |   bot_user_id: z.string(),
30 |   team: z.object({
31 |     id: z.string(),
32 |     name: z.string(),
33 |   }),
34 |   incoming_webhook: z.object({
35 |     channel: z.string(),
36 |     channel_id: z.string(),
37 |     configuration_url: z.string().url(),
38 |     url: z.string().url(),
39 |   }),
40 | });
41 |
42 | export async function GET(request: NextRequest) {
43 |   const requestUrl = new URL(request.url);
44 |
45 |   const rawParams = Object.fromEntries(requestUrl.searchParams.entries());
46 |   const parsedParams = paramsSchema.safeParse(rawParams);
47 |
48 |   if (!parsedParams.success) {
49 |     console.error("Invalid params", parsedParams.error.errors);
50 |     return NextResponse.json({ error: "Invalid params" }, { status: 400 });
51 |   }
52 |
53 |   const veryfiedState = await slackInstaller.stateStore?.verifyStateParam(
54 |     new Date(),
55 |     parsedParams.data.state,
56 |   );
57 |   const parsedMetadata = metadataSchema.safeParse(
58 |     JSON.parse(veryfiedState?.metadata ?? "{}"),
59 |   );
60 |
61 |   if (!parsedMetadata.success) {
62 |     console.error("Invalid metadata", parsedMetadata.error.errors);
63 |     return NextResponse.json({ error: "Invalid metadata" }, { status: 400 });
64 |   }
65 |
66 |   try {
67 |     const slackOauthAccessUrl = [
68 |       "https://slack.com/api/oauth.v2.access",
69 |       `?client_id=${process.env.NEXT_PUBLIC_SLACK_CLIENT_ID}`,
70 |       `&client_secret=${process.env.SLACK_CLIENT_SECRET}`,
71 |       `&code=${parsedParams.data.code}`,
72 |       `&redirect_uri=${process.env.NEXT_PUBLIC_SLACK_OAUTH_REDIRECT_URL}`,
73 |     ].join("");
74 |
75 |     const response = await fetch(slackOauthAccessUrl);
76 |     const json = await response.json();
77 |
78 |     const parsedJson = slackAuthResponseSchema.safeParse(json);
79 |
80 |     if (!parsedJson.success) {
81 |       console.error(
82 |         "Invalid JSON response from slack",
83 |         parsedJson.error.errors,
84 |       );
85 |       return NextResponse.json(
86 |         { error: "Failed to exchange code for token" },
87 |         { status: 500 },
88 |       );
89 |     }
90 |
91 |     const createdSlackIntegration = await createApp({
92 |       team_id: parsedMetadata.data.teamId,
93 |       created_by: parsedMetadata.data.userId,
94 |       app_id: config.id,
95 |       settings: config.settings,
96 |       config: {
97 |         access_token: parsedJson.data.access_token,
98 |         team_id: parsedJson.data.team.id,
99 |         team_name: parsedJson.data.team.name,
100 |         channel: parsedJson.data.incoming_webhook.channel,
101 |         channel_id: parsedJson.data.incoming_webhook.channel_id,
102 |         slack_configuration_url:
103 |           parsedJson.data.incoming_webhook.configuration_url,
104 |         url: parsedJson.data.incoming_webhook.url,
105 |         bot_user_id: parsedJson.data.bot_user_id,
106 |       },
107 |     });
108 |
109 |     if (createdSlackIntegration) {
110 |       const slackApp = createSlackApp({
111 |         token: createdSlackIntegration.config.access_token,
112 |         botId: createdSlackIntegration.config.bot_user_id,
113 |       });
114 |
115 |       try {
116 |         await slackApp.client.chat.postMessage({
117 |           channel: createdSlackIntegration.config.channel_id,
118 |           unfurl_links: false,
119 |           unfurl_media: false,
120 |           blocks: [
121 |             {
122 |               type: "section",
123 |               text: {
124 |                 type: "mrkdwn",
125 |                 text: "Hello there! 👋 I'm your new Midday bot, I'll send notifications in this channel regarding new transactions and other important updates.\n\n Head over to the <slack://app?id=A07PN48FW3A&tab=home|Midday Assistant> to ask questions.",
126 |               },
127 |             },
128 |             {
129 |               type: "divider",
130 |             },
131 |             {
132 |               type: "context",
133 |               elements: [
134 |                 {
135 |                   type: "mrkdwn",
136 |                   text: "<https://app.midday.ai/apps?app=slack&settings=true|Notification settings>",
137 |                 },
138 |               ],
139 |             },
140 |           ],
141 |         });
142 |       } catch (err) {
143 |         console.error(err);
144 |       }
145 |
146 |       const requestUrl = new URL(request.url);
147 |
148 |       if (process.env.NODE_ENV === "development") {
149 |         requestUrl.protocol = "http";
150 |       }
151 |
152 |       // This window will be in a popup so we redirect to the all-done route which closes the window
[TRUNCATED]
```

apps/dashboard/src/app/api/webhook/cache/revalidate/route.ts
```
1 | import { revalidateTag } from "next/cache";
2 | import { NextResponse } from "next/server";
3 | import { z } from "zod";
4 |
5 | const schema = z.object({
6 |   tag: z.enum(["bank"]),
7 |   id: z.string(),
8 | });
9 |
10 | const cacheTags = {
11 |   bank: [
12 |     "transactions",
13 |     "bank_connections",
14 |     "bank_accounts",
15 |     "insights",
16 |     "spending",
17 |     "bank_accounts_currencies",
18 |     "bank_accounts_balances",
19 |     "metrics",
20 |     "expenses",
21 |     "burn_rate",
22 |     "runway",
23 |   ],
24 |   vault: ["vault"],
25 | } as const;
26 |
27 | export async function POST(req: Request) {
28 |   const authHeader = req.headers.get("Authorization");
29 |   const apiKey = authHeader?.split("Bearer ")?.at(1);
30 |
31 |   if (apiKey !== process.env.MIDDAY_CACHE_API_SECRET) {
32 |     return NextResponse.json(
33 |       { error: "Unauthorized request" },
34 |       { status: 401 },
35 |     );
36 |   }
37 |
38 |   const parsedBody = schema.safeParse(await req.json());
39 |
40 |   if (!parsedBody.success) {
41 |     return NextResponse.json(
42 |       { error: "Invalid request body" },
43 |       { status: 400 },
44 |     );
45 |   }
46 |
47 |   const { tag, id } = parsedBody.data;
48 |
49 |   if (!(tag in cacheTags)) {
50 |     return NextResponse.json({ error: "Invalid tag" }, { status: 400 });
51 |   }
52 |
53 |   for (const cacheTag of cacheTags[tag]) {
54 |     revalidateTag(`${cacheTag}_${id}`);
55 |   }
56 |
57 |   return NextResponse.json({ success: true });
58 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/assistant/page.tsx
```
1 | import { getAssistantSettings } from "@/actions/ai/storage";
2 | import { AssistantHistory } from "@/components/assistant-history";
3 | import type { Metadata } from "next";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Assistant | Midday",
7 | };
8 |
9 | export default async function Page() {
10 |   const settings = await getAssistantSettings();
11 |
12 |   return (
13 |     <div className="space-y-12">
14 |       <AssistantHistory enabled={settings?.enabled} />
15 |     </div>
16 |   );
17 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/date-and-locale/page.tsx
```
1 | import { ChangeTimezone } from "@/components/change-timezone";
2 | import { DateFormatSettings } from "@/components/date-format-settings";
3 | import { LocaleSettings } from "@/components/locale-settings";
4 | import { TimeFormatSettings } from "@/components/time-format-settings";
5 | import { WeekSettings } from "@/components/week-settings";
6 | import { getTimezones } from "@midday/location";
7 | import { getUser } from "@midday/supabase/cached-queries";
8 | import type { Metadata } from "next";
9 |
10 | export const metadata: Metadata = {
11 |   title: "Date & Locale | Midday",
12 | };
13 |
14 | export default async function Page() {
15 |   const { data: userData } = await getUser();
16 |
17 |   const timezones = getTimezones();
18 |
19 |   return (
20 |     <div className="space-y-12">
21 |       <LocaleSettings locale={userData?.locale} />
22 |       <ChangeTimezone timezone={userData?.timezone} timezones={timezones} />
23 |       <TimeFormatSettings timeFormat={userData?.time_format} />
24 |       <DateFormatSettings dateFormat={userData?.date_format} />
25 |       <WeekSettings weekStartsOnMonday={userData?.week_starts_on_monday} />
26 |     </div>
27 |   );
28 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/security/page.tsx
```
1 | import { MfaSettingsList } from "@/components/mfa-settings-list";
2 | import { AddNewDeviceModal } from "@/components/modals/add-new-device";
3 | import type { Metadata } from "next";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Security | Midday",
7 | };
8 |
9 | export default async function Security() {
10 |   return (
11 |     <div className="space-y-12">
12 |       <MfaSettingsList />
13 |       <AddNewDeviceModal />
14 |     </div>
15 |   );
16 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/support/page.tsx
```
1 | import { SupportForm } from "@/components/support-form";
2 | import { getUser } from "@midday/supabase/cached-queries";
3 | import type { Metadata } from "next";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Support | Midday",
7 | };
8 |
9 | export default async function Support() {
10 |   const { data: userData } = await getUser();
11 |
12 |   return (
13 |     <div className="space-y-12">
14 |       <div className="max-w-[450px]">
15 |         <SupportForm
16 |           email={userData.email}
17 |           avatarUrl={userData.avatar_url}
18 |           fullName={userData.full_name}
19 |           teamName={userData.team.name}
20 |         />
21 |       </div>
22 |     </div>
23 |   );
24 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/account/teams/page.tsx
```
1 | import { TeamsTable } from "@/components/tables/teams";
2 | import { TeamsSkeleton } from "@/components/tables/teams/table";
3 | import type { Metadata } from "next";
4 | import { Suspense } from "react";
5 |
6 | export const metadata: Metadata = {
7 |   title: "Teams | Midday",
8 | };
9 |
10 | export default function Teams() {
11 |   return (
12 |     <Suspense fallback={<TeamsSkeleton />}>
13 |       <TeamsTable />
14 |     </Suspense>
15 |   );
16 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/accounts/page.tsx
```
1 | import { BaseCurrency } from "@/components/base-currency/base-currency";
2 | import { ConnectedAccounts } from "@/components/connected-accounts";
3 | import type { Metadata } from "next";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Accounts | Midday",
7 | };
8 |
9 | export default function Page() {
10 |   return (
11 |     <div className="space-y-12">
12 |       <ConnectedAccounts />
13 |       <BaseCurrency />
14 |     </div>
15 |   );
16 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/billing/page.tsx
```
1 | import { Metadata } from "next";
2 |
3 | export const metadata: Metadata = {
4 |   title: "Billing | Midday",
5 | };
6 |
7 | export default async function Billing() {
8 |   return (
9 |     <div className="space-y-12">
10 |       <div>Plan</div>
11 |       <div>Payment Method</div>
12 |       <div>Add-Ons</div>
13 |       <div>Billing Address</div>
14 |     </div>
15 |   );
16 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/categories/page.tsx
```
1 | import { CategoriesTable } from "@/components/tables/categories";
2 | import { CategoriesSkeleton } from "@/components/tables/categories/skeleton";
3 | import type { Metadata } from "next";
4 | import { Suspense } from "react";
5 |
6 | export const metadata: Metadata = {
7 |   title: "Categories | Midday",
8 | };
9 |
10 | export default function Categories() {
11 |   return (
12 |     <Suspense fallback={<CategoriesSkeleton />}>
13 |       <CategoriesTable />
14 |     </Suspense>
15 |   );
16 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/members/page.tsx
```
1 | import { TeamMembers } from "@/components/team-members";
2 | import type { Metadata } from "next";
3 |
4 | export const metadata: Metadata = {
5 |   title: "Members | Midday",
6 | };
7 |
8 | export default async function Members() {
9 |   return <TeamMembers />;
10 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/notifications/page.tsx
```
1 | import { NotificationsSettingsList } from "@/components/notifications-settings-list";
2 | import type { Metadata } from "next";
3 | import { Suspense } from "react";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Notifications | Midday",
7 | };
8 |
9 | export default async function Notifications() {
10 |   return (
11 |     <Suspense>
12 |       <NotificationsSettingsList />
13 |     </Suspense>
14 |   );
15 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/settings/team/page.tsx
```
1 | import { Metadata } from "next";
2 |
3 | export const metadata: Metadata = {
4 |   title: "Team | Midday",
5 | };
6 |
7 | export default async function Team() {
8 |   return null;
9 | }
```

apps/dashboard/src/app/[locale]/(app)/(sidebar)/vault/[[...folders]]/page.tsx
```
1 | import { Table } from "@/components/tables/vault";
2 | import { searchParamsCache } from "@/components/tables/vault/search-params";
3 | import type { Metadata } from "next";
4 |
5 | export const metadata: Metadata = {
6 |   title: "Vault | Midday",
7 | };
8 |
9 | type Props = {
10 |   searchParams: { [key: string]: string | string[] | undefined };
11 |   params: {
12 |     folders: string[];
13 |     q?: string;
14 |     owners?: string;
15 |     start?: string;
16 |     end?: string;
17 |   };
18 | };
19 |
20 | export default function Vault({ params, searchParams }: Props) {
21 |   const disableActions = [
22 |     "exports",
23 |     "inbox",
24 |     "imports",
25 |     "transactions",
26 |     "invoices",
27 |   ].includes(params.folders?.[0] ?? "");
28 |
29 |   const filter = searchParamsCache.parse(searchParams);
30 |
31 |   return (
32 |     <Table
33 |       folders={params.folders ?? []}
34 |       disableActions={disableActions}
35 |       filter={filter}
36 |     />
37 |   );
38 | }
```

apps/dashboard/src/app/[locale]/(app)/teams/invite/[code]/page.tsx
```
1 | import { SignOutButton } from "@/components/sign-out-button";
2 | import { UserMenu } from "@/components/user-menu";
3 | import { joinTeamByInviteCode } from "@midday/supabase/mutations";
4 | import { createClient } from "@midday/supabase/server";
5 | import { Button } from "@midday/ui/button";
6 | import { Icons } from "@midday/ui/icons";
7 | import type { Metadata } from "next";
8 | import { revalidateTag } from "next/cache";
9 | import Link from "next/link";
10 | import { redirect } from "next/navigation";
11 | import { Suspense } from "react";
12 |
13 | export const metadata: Metadata = {
14 |   title: "Join team | Midday",
15 | };
16 |
17 | export default async function InviteCode({
18 |   params,
19 | }: { params: { code: string } }) {
20 |   const supabase = createClient();
21 |   const { code } = params;
22 |
23 |   if (code) {
24 |     const user = await joinTeamByInviteCode(supabase, code);
25 |
26 |     if (user) {
27 |       revalidateTag(`user_${user.id}`);
28 |       revalidateTag(`teams_${user.id}`);
29 |
30 |       if (!user.full_name) {
31 |         redirect("/setup");
32 |       }
33 |
34 |       redirect("/");
35 |     }
36 |   }
37 |
38 |   return (
39 |     <div>
40 |       <header className="w-full absolute left-0 right-0 flex justify-between items-center">
41 |         <div className="ml-5 mt-4 md:ml-10 md:mt-10">
42 |           <Link href="/">
43 |             <Icons.Logo />
44 |           </Link>
45 |         </div>
46 |
47 |         <div className="mr-5 mt-4 md:mr-10 md:mt-10">
48 |           <Suspense>
49 |             <UserMenu onlySignOut />
50 |           </Suspense>
51 |         </div>
52 |       </header>
53 |
54 |       <div className="flex min-h-screen justify-center items-center overflow-hidden p-6 md:p-0">
55 |         <div className="relative z-20 m-auto flex w-full max-w-[380px] flex-col">
56 |           <div className="flex w-full flex-col relative">
57 |             <div className="pb-4">
58 |               <h1 className="font-medium pb-1 text-3xl">
59 |                 {" "}
60 |                 This invite link is not associated with your current account.
61 |               </h1>
62 |             </div>
63 |
64 |             <p className="text-sm text-[#606060] mt-2">
65 |               Please sign in with the email address that received the invite, or
66 |               contact the team admin for assistance.
67 |             </p>
68 |
69 |             <div className="pointer-events-auto mt-6 flex flex-col mb-4 space-y-4">
70 |               <SignOutButton />
71 |               <Link href="/teams" className="w-full">
72 |                 <Button className="w-full">Go to teams</Button>
73 |               </Link>
74 |             </div>
75 |           </div>
76 |         </div>
77 |       </div>
78 |     </div>
79 |   );
80 | }
```
